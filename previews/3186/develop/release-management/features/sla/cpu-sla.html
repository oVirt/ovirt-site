<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>CPU SLA | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="CPU SLA" />
<meta name="author" content="Andrew Dahms" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3186/develop/release-management/features/sla/cpu-sla.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3186/develop/release-management/features/sla/cpu-sla.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CPU SLA" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Dahms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew Dahms"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"CPU SLA","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3186/images/logo.svg"},"name":"Andrew Dahms"},"url":"https://ovirt.github.io/ovirt-site/previews/3186/develop/release-management/features/sla/cpu-sla.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3186/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3186/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3186/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3186/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3186/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3186/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3186/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3186/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3186/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/release-management/features/sla/">
              <span property="name">Sla</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Andrew Dahms">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Dahms</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/078f051e48904011be38593c0eb497f8?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/078f051e48904011be38593c0eb497f8?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Kobi Ianko">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Kobi Ianko</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Roy Golan">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Roy Golan</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3186/documentation/'>Documentation is available here.</a></div>

<h1 id="cpu-sla">CPU SLA</h1>

<p><strong>CPU SLA</strong></p>

<h2 id="summary">Summary</h2>

<p>The CPU SLA feature enables users to limit the CPU usage of a virtual machine.</p>

<h2 id="owners">Owners</h2>

<h4 id="initial-design-and-implementation">Initial design and implementation</h4>

<ul>
  <li>Name: Kobi Ianko (kianku) <s>kobi@redhat.com</s></li>
</ul>

<h4 id="maintainers">Maintainers</h4>

<ul>
  <li>Name: Roy Golan (rgolan) rgolan@redhat.com</li>
  <li>Name: Martin Sivak (msivak) msivak@redhat.com</li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Target Release: 3.5</li>
  <li>Status: completed</li>
  <li>Last updated: April 14, 2015</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>CPU is one of the important component which each guest has.</p>

<p>Currently RHEV doesn’t support SLA features which limits guest’s and qemu’s cpu resource consumption. Therefore all guests working on the same host may be affected by other guests’ cpu workload.</p>

<p>On the other hand, customers expect that virtualized systems work as stably as the systems on bare servers.</p>

<p>To provide same stability in virtualized environment, we need to limit cpu bandwidth of each guest and isolate each guest from others.</p>

<p>To accomplish this target a CPU Profile element will be introduced.
The CPU Profile will be selected by the end user from a predefined list in the Add VM popup window, and will be created in the Cluster level of the system.</p>

<p>Each cluster will contain its own list of CPU Profile that are available for the use of the VMs running in that Cluster.</p>

<p>Each CPU Profile will contain a Qos element.
The Qos element will be defined in the DataCenter level of the system, and will be constructed out of a single field that represent the CPU processing power that is permitted for this VM out of the total CPU Processing capacity.</p>

<p>For representing the CPU qos we have three different approaches:</p>
<ol>
  <li>using a percentage number - currently this is the preferred approach</li>
</ol>

<p>This approach will be consistent over different hosts, when a VM migrate to host with different CPU capabilities.</p>

<ol>
  <li>using a fixed MHz number</li>
</ol>

<p>This is the old school approach, it will be clear to the user what exact input he is giving, but on different host this input could act slightly different.</p>

<ol>
  <li>using bogomips</li>
</ol>

<p>This is an unscientific measurement of CPU speed (http://en.wikipedia.org/wiki/BogoMips)</p>

<p><strong>The selected approach is the percentage (1).</strong></p>

<h2 id="gui">GUI</h2>

<p>The user will configure the CPU limitation at the VM popup, our goal is to create a new side-bar for SLA and to place Cpu Profile in it.
The following is a draft using the existing Resource Allocation side-bar, for getting the look and feel of using the CPU limits feature
<img src="/ovirt-site/previews/3186/images/wiki/CpuLimit.png" alt="" /></p>

<p>The administrator will allocate CPU profiles to be used in the Cluster at the Cluster main tab, using the CPU Profile sub tab.
<img src="/ovirt-site/previews/3186/images/wiki/CpuLimitClusterSubTab.png" alt="" /></p>

<h2 id="vdsm">VDSM</h2>

<p><strong>TODO - this section needs update</strong></p>

<p>In the VDSM we will be using the libvirt API of CPU tuning (http://libvirt.org/formatdomain.html#elementsCPUTuning), and MOM. The Qos entered by the user will be picked by the engine’s “Sync MOM Policy”, and forward to Libvirt dom xml meta-data section.
For using the metadata section we will define a URI that will serve as a namespace from vm tunable parameters (“vm/tune/1.0”). A MOM policy will convert Qos value into the libvirt period and quota parameters, and set the value to Libvirt using a MOM controller, ensuring that the CPU limits are enforced.</p>

<p>To do that we will use the following algorithm:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     1. pick a fixed number to be used as anchor [1000 - 1000000], we will use the minimum*100 (because we use percentage)   = 100000 = anchor.
     2. period = anchor / #NumOfCpuInHost
     3. quota = (anchor*(#userSelection/100)) / #numOfVcpusInVm
</code></pre></div></div>

<h2 id="db">DB</h2>

<p>The VM_STATIC will introduce a new field of CPU_PROFILE, this field will be a FK to the new table of CPU_PROFILES. CPU_PROFILES table will contain the following fields:
id (PK)
name
qos_id (FK)
cluster_id (FK)</p>

<h2 id="rest-api">Rest API</h2>

<p>A new element of cpu_profile will be added to the API, and the VM element will extend to contain the new CPU profile property.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;cpu_profile href="/ovirt-site/previews/3186/ovirt-engine/api/cpuprofiles/dd806259-d121-4914-9b32-5998dd40b26f" id="dd806259-d121-4914-9b32-5998dd40b26f"&gt;
    &lt;name&gt;gold_profile&lt;/name&gt;
    &lt;link href="/ovirt-site/previews/3186/ovirt-engine/api/cpuprofiles/dd806259-d121-4914-9b32-5998dd40b26f/permissions" rel="permissions"/&gt;
    &lt;cluster href="/ovirt-site/previews/3186/ovirt-engine/api/clusters/3e9dacfa-65bf-4433-b584-07383c50aef6" id="3e9dacfa-65bf-4433-b584-07383c50aef6"/&gt;
&lt;/cpu_profile&gt;

&lt;vm&gt;
    ...
    ...
    &lt;memory&gt;1073741824&lt;/memory&gt;
    &lt;cpu&gt;
        &lt;topology sockets="1" cores="1"/&gt;
        &lt;architecture&gt;X86_64&lt;/architecture&gt;
    &lt;/cpu&gt;
    &lt;cpu_shares&gt;0&lt;/cpu_shares&gt;
    &lt;cpu_limit&gt;25&lt;/cpu_limit&gt;
    &lt;os type="other"&gt;
        &lt;boot dev="hd"/&gt;
    &lt;/os&gt;
    ...
    ...
&lt;/vm&gt;
</code></pre></div></div>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>When running a VM, the VM should run as an independent unit and should be affected by other VMs as little as possible.
This feature enable the user to limit the CPU resources of a specific VM, this will ensure that in cases were several VMs are running on the same host, one VM will not cause performance decline in another VMs.
Another good use for this feature is in cases a growth in the number of VMs is expected, the user can limit the CPU resource to a VM leaving enough CPU resources for the future VMs, this way users of the guests will not have an impact on performance once other VMs will join the host.</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3186/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3186/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3186/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3186/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/sla/cpu-sla.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/sla/cpu-sla.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
