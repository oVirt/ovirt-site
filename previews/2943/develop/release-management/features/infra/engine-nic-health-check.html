<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>engine NIC health check | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="engine NIC health check" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2943/develop/release-management/features/infra/engine-nic-health-check.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2943/develop/release-management/features/infra/engine-nic-health-check.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="engine NIC health check" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"engine NIC health check","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2943/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2943/develop/release-management/features/infra/engine-nic-health-check.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2943/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2943/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2943/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2943/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2943/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2943/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2943/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2943/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2943/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2943/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2943/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2943/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2943/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2943/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2943/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2943/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2943/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2943/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2943/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2943/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2943/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2943/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2943//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2943//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2943/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2943/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2943/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2943/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2943/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f5cf134eaa80bea1e03db147a440fa2d?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f5cf134eaa80bea1e03db147a440fa2d?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Mucha</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2943/documentation/'>Documentation is available here.</a></div>

<h1 id="engine-nic-health-check">Engine NIC health check</h1>

<h2 id="summary">Summary</h2>

<p>Fencing can occur on healthy hosts, just as a result of failing NIC of engine or other problem while communicating with hosts. Fencing should occur after most of these potential problems are checked and unconfirmed. This feature aims at engine nics health.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Martin Mucha (mmucha)</li>
  <li>IRC: mmucha at #ovirt (irc.oftc.net)</li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>In case that specific NIC(s) of engine is ‘not healhy’, QoS will be improved, since unhurt hosts will not be (improperly) fenced. NIC is reported as not healthy, when it was not present at all, or it’s status was anything else but up at least once for given period of time. This feature does not solve routing problems, defective hw, or configuration issues, when improper fence still can occur regardless of this feature.</p>

<h2 id="implementation">Implementation</h2>

<ul>
  <li>engine will periodically check health of it’s own nics</li>
  <li>gathered data over last period is recorded, and stored in db, just for case engine restart so we cannot lose that data. Data are stored in table:</li>
</ul>

<p>CREATE TABLE engine_nics_health ( id CHARACTER VARYING(255) NOT NULL PRIMARY KEY, healthy BOOLEAN NOT NULL, last_failure TIMESTAMP NOT NULL);</p>

<p>where id is name of NIC and last_failure is moment when given nic become unhealthy. From this table is fed hashmap on startup and all successive queries proceed in memory only. Only when nic change it’s health, db is updated.</p>

<ul>
  <li>if there’s need to fence some host, due to its unresponsiveness, it will be performed if and only if there wasn’t any problem in any given (by configuration) engine NIC during last N minutes. Check for NIC status will be performed each 5 seconds. If there’s fence request, it will be performed only if during last N minutes all NICs was always up. Number of minutes wasn’t decided yet, see Opened Issues section.</li>
  <li>User denotes NICs to be periodically checked using engine-config property “EngineNics”, only NICs specified here will be scanned. Multiple NICs are separated by comma. If engine machine contains multiple NICs, but only some of them are used by engine, then user will specify only significant NICs, others won’t be scanned. By default “EngineNics” property is unset, NICs won’t be scanned at all, providing backward compatibility. If inexisting NICs are provided i “EngineNics” property, they’re simply ignored.</li>
  <li>regular scanning will be implemented using quartz job</li>
  <li>for simplicity reasons NIC status will be read using java.net.NetworkInterface#isUp. This method does not return actual NIC status, but we do not need that at this moment and do not want to add new dependency to the project. As a sideeffect of java.net.NetworkInterface#isUp NICs without IP address will not be considered as valid ones as well as not being able to get current status.</li>
  <li>check, whether engine NICs are healthy and fencing should proceed will be done in org.ovirt.engine.core.bll.VdsEventListener#vdsNotResponding and org.ovirt.engine.core.bll.VdsNotRespondingTreatmentCommand#shouldFencingBeSkipped</li>
  <li>frequency of NIC checking can be specified via engine-config property “EngineNicsHealthCheckDelay” in seconds grade.</li>
  <li>time interval during which there must be no problems to allow fencing can be specified via engine-config property “EngineNicsHaveToBeUpAtLeast” in seconds grade. Suggestions for better name are welcomed.</li>
</ul>

<h2 id="ux">UX</h2>

<p>This feature options currently cannot be set from gui, since there’s no ‘engine’ related tab to accommodate this feature. NICs to be monitored has to be setup via engine-config.</p>

<p>Example: Depending where you’ve installed oVirt to you can issue either:</p>

<p>$HOME/ovirt-engine/bin/engine-config -s EngineNics=”eno1,eno2” or /usr/local/ovirt-engine/bin/engine-config -s EngineNics=”eno1,eno2”</p>

<h2 id="opened-issues">Opened Issues</h2>

<ul>
  <li>for how long (n minutes) all monitored NICs must be always up so the fencing can occur?</li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2943/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2943/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2943/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2943/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/engine-nic-health-check.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/infra/engine-nic-health-check.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
