<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TaskManagerCancelTask | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="TaskManagerCancelTask" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/infra/taskmanagercanceltask.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/infra/taskmanagercanceltask.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="TaskManagerCancelTask" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"TaskManagerCancelTask","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3192/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/infra/taskmanagercanceltask.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3192/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3192/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3192/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3192/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3192/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3192/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3192/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3192/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3192/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9942503c8cf556c85339e8454f375905?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9942503c8cf556c85339e8454f375905?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Michael Kublin">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Michael Kublin</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3192/documentation/'>Documentation is available here.</a></div>

<h1 id="task-manager-cancel-task">Task Manager Cancel Task</h1>

<h2 id="task-cancellation">Task Cancellation</h2>

<h3 id="summary">Summary</h3>

<p>A Task Cancellation it is feature which should allow to cancel currently running tasks.
It is not clear which task should be allow to cancel - the whole command or task which is running at vdsm side, what engine should do roll forward or revert</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Michael Kublin</li>
  <li>GUI Component owner: Michael Kublin</li>
  <li>REST Component owner: Michael Kublin</li>
  <li>QA Owner: Yaniv Kaul <a href="mailto:ykaul@redhat.com">ykaul@redhat.com</a></li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>Target Release: 3.2</li>
  <li>Status: Coding ( Engine-Not started, UI-Not started, API-Not started )</li>
  <li>Last updated date: 3/12/2012</li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<p>A Task Manager cancellation it is a feature which is build upon Task Manager and should allow to cancel a tasks/jobs/commands</p>

<h4 id="terminology">Terminology</h4>

<ul>
  <li>Command - An execution unit which performs a business logic.</li>
  <li>Job - An action API (RunAction) running in the system. The Job may extend beyond the life cycle of the Command which is the entry point for the action.</li>
  <li>Step - A meaningful part of the job which the user should be aware of.</li>
  <li>Task - known as VDSM task, executed by VDSM.</li>
</ul>

<p>The job supports the following scenarios:</p>

<ol>
  <li>A simple command - a command which consists of 2 steps: validation (<em>CanDoAction</em>) and execution.
    <ul>
      <li>The job ends when the command of the job ends.</li>
    </ul>
  </li>
  <li>A command with VDSM tasks - a command which consists of 3 steps: validation (<em>CanDoAction</em>), execution and finalization (<em>endAction</em>).
    <ul>
      <li>The job ends when the tasks are reported from VDSM as completed and the command <em>endAction</em> is invoked.</li>
    </ul>
  </li>
  <li>A command which invokes internal commands
    <ul>
      <li>By default, the internal command will not be presented as a step of the parent command.</li>
    </ul>
  </li>
  <li>A customized command - an asynchronous job which its termination is decided by an event other than tasks. There are few types of scenarios for it:
    <ul>
      <li>Commands which implements the <em>IVdcAsyncCommand</em> interface - triggered by <em>VDSBrokerFrontendImpl.RunAsyncVdsCommand</em>, the command instance is maintained with its context and finalized by the monitors (<em>VdsUpdateRuntimeInfo</em>).</li>
      <li>Invocation of command in a detached thread, e.g <em>AddVdsCommand</em> which delegates job resolution to the internal command <em>InstallVdsCommand</em>.</li>
      <li>The command execution is ended, but the resolution for the success of the Action is determined by other event in the system:
        <ul>
          <li>Other events which reported by the <em>monitors</em> (e.g. Host Maintenance reported by <em>VdsEventListener</em>).</li>
          <li>Requires heuristic decision to select the correct Step for the Job by entity type and entity id associated with the Job.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Multiple Action Runner - describes multiple commands invocation in a single API call. Each command will be reflected as a single job.</li>
</ol>

<h4 id="requirements">Requirements</h4>

<p>Not defined yet</p>

<h3 id="backend">Backend</h3>

<p>This section describes the backend design for this feature.</p>

<h4 id="entity-description">Entity Description</h4>

<p>A new command will be added <code class="language-plaintext highlighter-rouge">CancelTaskCommand</code></p>

<h5 id="enumerators">Enumerators</h5>

<p><strong>Updated Enumerators</strong>
The new value will be added to <code class="language-plaintext highlighter-rouge">VdcActionType</code></p>

<h5 id="annotations">Annotations</h5>

<h4 id="db-design">DB Design</h4>

<h5 id="crud">CRUD</h5>

<h4 id="user-work-flows">User work-flows</h4>

<p>User will send request to backend for cancel task and backend will try to cancel task. When we are running internal command which
parent jobId is cancelled engine can try not to run it. If a job has tasks which is running on vdsm, engine can try to send a Stop/Revert verb to vdsm,
at that case by default behaviour all command will be finished as failed.</p>

<h5 id="simple-command-invocation-sequence-diagram">Simple Command Invocation Sequence Diagram</h5>

<p>Not provided, not clear what are requirements</p>

<h5 id="async-command-invocation-sequence-diagram">Async Command Invocation Sequence Diagram</h5>

<p>Not provided, not clear what are requirements</p>

<h4 id="events">Events</h4>

<h3 id="rest-api">REST API</h3>

<h3 id="user-experience">User Experience</h3>

<h3 id="installationupgrade">Installation/Upgrade</h3>

<h3 id="dependencies--related-features-and-projects">Dependencies / Related Features and Projects</h3>

<p>The cancellation of the task is depend on VDSM API, on internal Async task manger, on correct handling of each command and on task monitoring.
Most of these mechanism are independent and not related to each other, most of them has a lot of luck and problems in implementation,
the cancellation of task which is build upon on it well not work well until those mechanism will be fixed.</p>

<h3 id="documentation--external-references">Documentation / External references</h3>

<h3 id="comments-and-discussion">Comments and Discussion</h3>

<p>I suppose that a number of races, and unexpected behaviour will be extreme high
I suppose that part of the flows will be difficult or almost impossible to integrate with task cancellation</p>

<h3 id="open-issues">Open Issues</h3>

<ol>
  <li>What expected API should be called at VDSM side and what it suppose to do?</li>
  <li>What should be allowed to cancel? Maintenance host, Migrate VM? Hibernate VM or only storage flows</li>
</ol>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3192/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3192/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3192/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3192/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/taskmanagercanceltask.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/infra/taskmanagercanceltask.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
