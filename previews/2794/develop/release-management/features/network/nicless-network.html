<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Nicless Network | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Nicless Network" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2794/develop/release-management/features/network/nicless-network.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2794/develop/release-management/features/network/nicless-network.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Nicless Network" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2794/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Nicless Network","url":"https://ovirt.github.io/ovirt-site/previews/2794/develop/release-management/features/network/nicless-network.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2794/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2794/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2794/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2794/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2794/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2794/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2794/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2794/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2794/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2794/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2794/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2794/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2794/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2794/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2794/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2794/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2794/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2794/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2794/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2794/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2794/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2794/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2794/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2794/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2794/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2794/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2794/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2794/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2794/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2794/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2794/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2794/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2794/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2794/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2794/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2794//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2794//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2794/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2794/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2794/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2794/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2794/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2794/documentation/'>Documentation is available here.</a></div>

<h1 id="nic-less-network">Nic-less Network</h1>

<h2 id="summary">Summary</h2>

<p>Create an in-host-only network, with no external communication</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Yevgeny Zaspitsky (yevgenyz)</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>In oVirt, after a VM network is defined in the Data Center level and added to a cluster, it needs to be implemented on each host. All VM networks are (currently) based on a Linux software bridge. The specific implementation controls how traffic from that bridge reaches the outer world. For example, the bridge may be connected externally via <code class="language-plaintext highlighter-rouge">eth3</code>, or <code class="language-plaintext highlighter-rouge">bond3</code> over <code class="language-plaintext highlighter-rouge">eth2</code> and <code class="language-plaintext highlighter-rouge">p1p2</code>. This feature is about implementing a network with no network interfaces (NICs) at all.</p>

<p>Having a disconnected network may first seem to add complexity to VM placement. Until now, we assumed that if a network (say, <em>blue</em>) is defined on two hosts, the two hosts lie in the same broadcast domain. If a couple of VMs are connected to <em>blue</em> it does not matter where they a run - they would always hear each other. This is of course no longer true if one of the hosts implements <em>blue</em> as nicless. However, this is nothing new. oVirt never validates the single broadcast domain assumption, which can be easily broken by an admin: on one host, an admin can implement <em>blue</em> using a nic that has completely unrelated physical connectivity.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<ul>
  <li><a href="/ovirt-site/previews/2794/develop/release-management/features/integration/allinone.html">All-in-One</a> use case: we’d like to have a complete oVirt deployment that does not rely on external resources, such as layer-2 connectivity or DNS.</li>
  <li>Collaborative computing: an oVirt user may wish to have a group of VMs with heavy in-group secret communication, where only one of the VMs exposes an external web service. The in-group secret communication could be limited to a nic-less network, no need to let it spill outside.</li>
  <li>Nic-less networks can be tunneled to remote network segments over IP, a layer 2 NIC may not be part of its definition.</li>
</ul>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<h2 id="vdsm">Vdsm</h2>

<p>Vdsm already supports defining a network with no nics attached.</p>

<h2 id="engine">Engine</h2>

<p>Implementing this in Engine is quite a pain, as network external interfaces are currently used as keys of the NetworkAttachment entity. Currently 20 different places in the engine code refer to NetworkAttachement.getNicId method. All those should be amended in order to support that it might return null and/or alternatively use <em>getHostId</em> instead. Also we might think of declaring NetworkAttachmentKey class that will be used as the attachment identifier. Initially the class will hold networkId and nicId and then change that to hold hostId instead of the nicId.</p>

<h3 id="db-changes">DB changes</h3>

<ul>
  <li>Network table
    <ul>
      <li>new field: <em>is_isolated</em> boolean (not nullable with default value ‘false’). True value indicates an isolated (nicless) network whereas is for a regular network.</li>
    </ul>
  </li>
  <li>Network_attachements table
    <ul>
      <li>new field: <em>host_id</em> UUID (not nullable). The new field references vds_static.vds_id field.</li>
      <li>modified field: <em>nic_id</em> - becomes nullable and isn’t a part of the unique key.</li>
      <li><em>network_attachments_network_id_nic_id_key</em> - the unique constraint will be changed to include host_id instead of nic_id.</li>
    </ul>
  </li>
</ul>

<h3 id="java-domain-objects">Java Domain Objects</h3>

<ul>
  <li>Network class
    <ul>
      <li>New property: <em>isolated</em> - correspondent to network.is_isolated DB field.</li>
    </ul>
  </li>
  <li>NetworkAttachment
    <ul>
      <li>New propertty: <em>hostId</em> - correspondent to network_attachments.host_id DB field.</li>
    </ul>

    <p>The main high-level logic that would be impacted by the change is <code class="language-plaintext highlighter-rouge">*</code>HostSetupNetworksCommand<code class="language-plaintext highlighter-rouge">*</code> but other flows should be evaluated too.</p>
  </li>
</ul>

<h3 id="usage">Usage</h3>

<ul>
  <li>Defining an isolated (nic-less) network will be possible by checking <em>isolated</em> checkbox during creating the network on the DC level.</li>
  <li>An isolated network that is attached to a cluster will be set as a required network permanently (DK: please explain why this makes sense).</li>
  <li>An isolated network is inherently a VM network. It could not bear any other role.</li>
</ul>

<p>Any oVirt-managed host is able to support an isolated network unconditionally and does not require any additional info to that was supplied at the network creating. Thus defining such network on the hosts could be automated. That removes from a user the need of defining an isolated network manually on each host prior to be able running a VM that uses the network.</p>

<ul>
  <li>Upon attaching an isolated network to a cluster, the engine will deploy the network on all active hosts in the cluster.</li>
  <li>The existence of the network would be re-validated upon a host becoming active and the network would be created if that is missing on the host.</li>
</ul>

<h4 id="alternative-approaches">Alternative approaches</h4>

<ul>
  <li>Similar to the described above, but creating the network on a host would be done just before running a VM that uses the network.</li>
  <li><a href="/ovirt-site/previews/2794/develop/release-management/features/network/isolatednetworks.html">Features/IsolatedNetworks</a> - this approach is about to treat an isolated network like any other network and let it be attached to a host rather than a NIC. The network would not be defined as isolated in advance and being such or not would be determined by the usage. This approach leads another sub-feature “host label” in order to automate an isolated network creating.</li>
</ul>

<h3 id="ui">UI</h3>

<ul>
  <li>mock-up (or a simple-but-clear) description of required UI changes - TBD</li>
  <li><strong>TBD</strong> should we present isolated networks on the the Setup Networks dialog?</li>
</ul>

<h3 id="rest">REST</h3>

<table>
  <tbody>
    <tr>
      <td>No changes will be done to the REST API, but the implementation will allow specifying a network attachment to a host without specifying which NIC the network [is</td>
      <td>to be] connected to.</td>
    </tr>
  </tbody>
</table>

<h2 id="testing">Testing</h2>

<p><strong>TBD</strong></p>

<h2 id="documentation--external-references">Documentation / External references</h2>

<ul>
  <li><a href="/ovirt-site/previews/2794/develop/release-management/features/integration/allinone.html">All-in-One</a> - an oVirt deployment that needs to fire up VMs with no external network connectivity.</li>
</ul>

<!-- -->

<ul>
  <li>NAT-based host-only network requested by DHC <a href="https://lists.ovirt.org/pipermail/users/2012-April/001751.html">https://lists.ovirt.org/pipermail/users/2012-April/001751.html</a></li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2794/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2794/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2794/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2794/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/nicless-network.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/nicless-network.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
