<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Proxy | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Proxy" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3012/develop/infra/proxy.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3012/develop/infra/proxy.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Proxy" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Proxy","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3012/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3012/develop/infra/proxy.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3012/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3012/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3012/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3012/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3012/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3012/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3012/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3012/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3012/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3012/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3012/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3012/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3012/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3012/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3012/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3012/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3012/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3012/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3012/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3012/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3012/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3012/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3012//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3012//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3012/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3012/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3012/develop/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/bcb2aef8cc1559485f70f69eed60b9bb?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/bcb2aef8cc1559485f70f69eed60b9bb?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of David">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">David</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>This developer documentation is <strong>outdated</strong>, but provides historical context.<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3012/documentation/'>Documentation is available here.</a></div>

<h1 id="proxy">Proxy</h1>

<p><strong>NOTE</strong>: for the latest version of this doc, see <a href="http://ovirt-infra-docs.readthedocs.org/en/latest/">http://ovirt-infra-docs.readthedocs.org/en/latest/</a></p>

<p>In the <a href="/ovirt-site/previews/3012/develop/infra/phoenix-lab-overview.html">Phoenix lab</a> setup we have now a proxy VM that is also serving as repository proxy for all the slaves,
mainly for mock usage but can be used as a generic proxy.</p>

<p>The proxy has two services to be able to provide a reliable and fast cache, the <a href="#squid">Squid</a> proxy and the <code class="language-plaintext highlighter-rouge">repoproxy.py</code>.
The second is only used for the yum repositories, to be able to get the failover and speed increases from the mirrorlists but being able to properly cache the results.</p>

<h2 id="squid">Squid</h2>

<p>The squid proxy is configured to reply only to ips from the Phoenix lab, it has a huge disk cache to allow caching as many files as possible.</p>

<p>To invalidate a cache object, you must login to the squid server and run:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">[root@proxy ~]#</span><span class="w"> </span>squidclient <span class="nt">-m</span> PURGE &lt;URL_TO_PURGE&gt;
</code></pre></div></div>

<p>Where <code class="language-plaintext highlighter-rouge">&lt;URL_TO_PURGE&gt;</code> is the url you want to invalidate, you should get a 200 response if everything went well:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    HTTP/1.1 200 OK
    Server: squid
    Mime-Version: 1.0
    Date: Tue, 03 Feb 2015 11:59:27 GMT
    Content-Length: 0
    X-Cache: MISS from proxy.phx.ovirt.org
    X-Cache-Lookup: NONE from proxy.phx.ovirt.org:3128
    Via: 1.1 proxy.phx.ovirt.org (squid)
    Connection: close
</code></pre></div></div>

<h2 id="repoproxy">Repoproxy</h2>

<p>The repoproxy is a small python script that proxies yum repo requests to mirrors, it’s configured using the repos.yaml file (in the puppet module), where you define each repo it’s serving, and the mirrorlist to use. For example:</p>
<div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nn">[myrepo]</span>
    <span class="py">mirrorurl</span><span class="p">=</span><span class="s">http://wherever.com/mirrorlist?repo=myrepo&amp;ver={releasever}&amp;arch={arch}</span>
</code></pre></div></div>

<p>That will allow you to transparently get a response from the first working mirror through the proxy using the url:</p>

<p><code class="language-plaintext highlighter-rouge">http://myproxy:5000/myrepo/21/x86_64</code></p>

<p>Where the next two path sections after the repository name are the releasever and arch parameters you see in the mirrorlist url. That will get the mirrorlist from the url:</p>

<p><code class="language-plaintext highlighter-rouge">http://wherever.com/mirrorlist?repo=myrepo$ver=21&amp;arc=x86_64</code></p>

<p>Then try each of the mirrors until finds one that responde to the requested path (in this case, just ‘<code class="language-plaintext highlighter-rouge">/</code>’) and return it.
It caches the responding mirrors so the tests will only be done once per path tops.</p>

<p>The logs are located at <code class="language-plaintext highlighter-rouge">/var/log/repoproxy.log</code>, and the files under <code class="language-plaintext highlighter-rouge">/opt/repoproxy</code></p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3012/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3012/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3012/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3012/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/infra/proxy.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/infra/proxy.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
