<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Audit Logs and Event Notifications | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Audit Logs and Event Notifications" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2936/develop/developer-guide/events/audit-logs-and-event-notifications.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2936/develop/developer-guide/events/audit-logs-and-event-notifications.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Audit Logs and Event Notifications" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Audit Logs and Event Notifications","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2936/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2936/develop/developer-guide/events/audit-logs-and-event-notifications.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2936/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2936/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2936/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2936/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2936/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2936/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2936/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2936/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2936/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2936/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2936/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2936/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2936/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2936/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2936/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2936/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2936/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2936/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2936/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2936/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2936/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2936/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2936//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2936//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2936/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2936/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2936/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2936/develop/developer-guide/events/">
              <span property="name">Events</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shireesh Anjal</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="audit-logs-and-event-notifications">Audit Logs and Event Notifications</h1>

<h2 id="introduction">Introduction</h2>

<p>This article explains how to introduce audit logging and email notifications on predefined events in the oVirt engine.</p>

<h2 id="audit-logs">Audit Logs</h2>

<h3 id="audit-log-support-for-a-new-entity">Audit Log Support for a new Entity</h3>

<p>You must read this section if you are trying to introduce a new entity, operations on which need to be audited. In case you want to introduce audit logging on new events on an existing entity which is already supported by the audit log framework, you can safely skip to the next section.</p>

<p>In order to log useful information about the event e.g. name of the entity on which the event occurred, it is required to add audit support for the entity. This involves following changes:</p>

<ul>
  <li>
    <p>Upgrade script to add new fields in audit_log table for id and name of the entity</p>

    <p>’’   select fn_db_add_column(‘audit_log’, ‘gluster_volume_id’, ‘uuid’);
  ‘’   select fn_db_add_column(‘audit_log’, ‘gluster_volume_name’, ‘VARCHAR(255)’);</p>
  </li>
  <li>Modifications in related stored procedures in <em>backend/manager/dbscripts/audit_log_sp.sql</em></li>
  <li>
    <p>New variables with getters / setters in <em>org.ovirt.engine.core.common.businessentities.AuditLog</em> and <em>org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase</em> for these fields e.g.</p>

    <p>’’   private NGuid glusterVolumeId;
  ‘’   private String glusterVolumeName;
  ‘’
  ‘’   public NGuid getGlusterVolumeId() {
  ‘’       return glusterVolumeId;
  ‘’   }
  ‘’
  ‘’   public void setGlusterVolumeId(NGuid value) {
  ‘’       glusterVolumeId = value;
  ‘’   }
  ‘’
  ‘’   public String getGlusterVolumeName() {
  ‘’       return glusterVolumeName;
  ‘’   }
  ‘’
  ‘’   public void setGlusterVolumeName(String value) {
  ‘’       glusterVolumeName = value;
  ‘’   }</p>
  </li>
  <li>
    <p>Modify the method <em>org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector#log</em> to set the new fields in the <em>AuditLog</em> object. e.g.</p>

    <p>’’   tempVar.setGlusterVolumeId(auditLogable.getGlusterVolumeId());
  ‘’   tempVar.setGlusterVolumeName(auditLogable.getGlusterVolumeName());</p>
  </li>
  <li>Modify various methods in <em>org.ovirt.engine.core.dao.AuditLogDAODbFacadeImpl</em> to save / retrieve the new fields also. Don’t forget to update the test case class as well (<em>AuditLogDAOTest</em>)</li>
</ul>

<h3 id="audit-log-types">Audit Log Types</h3>

<p>Introduce the new Audit Log Type(s) in the enum <em>org.ovirt.engine.core.common.AuditLogType</em> e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   GLUSTER_VOLUME_CREATE(3000),
  ''   GLUSTER_VOLUME_CREATE_FAILED(3001),
  ''   GLUSTER_VOLUME_DELETE(3002),
  ''   GLUSTER_VOLUME_DELETE_FAILED(3003),
</code></pre></div></div>

<h3 id="audit-log-messages">Audit Log Messages</h3>

<p>Add corresponding messages in <em>backend/manager/modules/dal/target/classes/bundles/AuditLogMessages.properties</em> e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   GLUSTER_VOLUME_CREATE=Gluster Volume ${glusterVolumeName} created.
  ''   GLUSTER_VOLUME_CREATE_FAILED=Creation of Gluster Volume ${glusterVolumeName} failed.
  ''   GLUSTER_VOLUME_DELETE=Gluster Volume ${glusterVolumeName} deleted.
  ''   GLUSTER_VOLUME_DELETE_FAILED=Gluster Volume ${glusterVolumeName} could not be deleted.
</code></pre></div></div>

<p>Note that the variable used here <strong>${glusterVolumeName}</strong> is same as the name of the variable added in <em>org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogableBase</em></p>

<h3 id="audit-log-severities">Audit Log Severities</h3>

<p>Map corresponding severities in <em>org.ovirt.engine.core.dal.dbbroker.auditloghandling.AuditLogDirector</em> e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''    private static void initGlusterVolumeSeverities() {
  ''       mSeverities.put(AuditLogType.GLUSTER_VOLUME_CREATE, AuditLogSeverity.NORMAL);
  ''       mSeverities.put(AuditLogType.GLUSTER_VOLUME_CREATE_FAILED, AuditLogSeverity.ERROR);
  ''       mSeverities.put(AuditLogType.GLUSTER_VOLUME_DELETE, AuditLogSeverity.NORMAL);
  ''       mSeverities.put(AuditLogType.GLUSTER_VOLUME_DELETE_FAILED, AuditLogSeverity.ERROR);
  ''   }
</code></pre></div></div>

<p>This makes sure that the log messages will be shown in the UI with appropriate severity icons.</p>

<h3 id="enable-audit-in-commands-for-the-events">Enable Audit in command(s) for the event(s)</h3>

<p>Implement method <em>getAuditLogTypeValue</em> inside the command class to return appropriate enum from <em>AuditLogType</em> based on success / failure of the command. e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   @Override
  ''   public AuditLogType getAuditLogTypeValue() {
  ''       if (getSucceeded()) {
  ''           return AuditLogType.GLUSTER_VOLUME_CREATE;
  ''       } else {
  ''           return AuditLogType.GLUSTER_VOLUME_CREATE_FAILED;
  ''       }
  ''   }
</code></pre></div></div>

<p>At this point, you should see the events getting audited and seen in the “Events” tab in the UI.</p>

<h2 id="event-notifications">Event Notifications</h2>

<p>In order to allow users to subscribe to your audit event types so that they receive email notifications, following steps are required:</p>

<h3 id="introduce-your-new-event-notification-entity">Introduce your new event notification entity</h3>

<p>By adding a new entry in the enum <em>org.ovirt.engine.core.common.EventNotificationEntity</em></p>

<h3 id="add-notification-events">Add notification events</h3>

<p>In <em>org.ovirt.engine.core.common.VdcEventNotificationUtils</em> by mapping them with the corresponding notification entity e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   AddEventNotificationEntry(EventNotificationEntity.GlusterVolume, AuditLogType.GLUSTER_VOLUME_CREATE);
  ''   AddEventNotificationEntry(EventNotificationEntity.GlusterVolume, AuditLogType.GLUSTER_VOLUME_CREATE_FAILED);
  ''   AddEventNotificationEntry(EventNotificationEntity.GlusterVolume, AuditLogType.GLUSTER_VOLUME_DELETE);
  ''   AddEventNotificationEntry(EventNotificationEntity.GlusterVolume, AuditLogType.GLUSTER_VOLUME_DELETE_FAILED);
</code></pre></div></div>

<p>These events will appear in the the “Add Event Notification” screen that appears when you click on the “Manage Events” button on the “Event Notifier” sub-tab under the “Users” tab. At this point though, you will see the enum name as it is. To get more user friendly descriptions on the UI, refer the following sections.</p>

<h3 id="changes-in-ui-gwt-code">Changes in UI (GWT) code</h3>

<ul>
  <li>
    <p>Add entries in <em>org.ovirt.engine.ui.uicompat.Enums</em> for these audit log types</p>

    <p>’’   String AuditLogType__<em>GLUSTER_VOLUME_CREATE();
  ‘’   String AuditLogType</em><strong>GLUSTER_VOLUME_CREATE_FAILED();
  ‘’   String AuditLogType</strong><em>GLUSTER_VOLUME_DELETE();
  ‘’   String AuditLogType</em>__GLUSTER_VOLUME_DELETE_FAILED();</p>
  </li>
</ul>

<p>(Note the special syntax starting with <strong>AuditLogType___</strong>)</p>

<ul>
  <li>
    <p>Add corresponding descriptions in <em>frontend/webadmin/modules/uicompat/src/main/resources/org/ovirt/engine/ui/uicompat/Enums.properties</em></p>

    <p>’’   AuditLogType__<em>GLUSTER_VOLUME_CREATE=Gluster Volume Created
  ‘’   AuditLogType</em><strong>GLUSTER_VOLUME_CREATE_FAILED=Gluster Volume could not be created
  ‘’   AuditLogType</strong><em>GLUSTER_VOLUME_DELETE=Gluster Volume deleted
  ‘’   AuditLogType</em>__GLUSTER_VOLUME_DELETE_FAILED=Gluster Volume could not be deleted</p>
  </li>
</ul>

<p>These descriptions will appear on the event subscription screen.</p>

<p>That’s it. Once all these changes are done, and user subscribes to the events, the system will start sending emails of subscribed events to the provided email id.</p>

<p><strong><code class="language-plaintext highlighter-rouge">Note:</code></strong><code class="language-plaintext highlighter-rouge"> The Notification service must be running for the notifications to be sent.</code></p>

<p>«Details of configuring / running the notification service to be added»</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2936/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2936/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2936/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2936/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/events/audit-logs-and-event-notifications.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/developer-guide/events/audit-logs-and-event-notifications.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
