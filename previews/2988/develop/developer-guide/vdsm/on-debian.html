<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>VDSM on Debian | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="VDSM on Debian" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2988/develop/developer-guide/vdsm/on-debian.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2988/develop/developer-guide/vdsm/on-debian.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VDSM on Debian" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"VDSM on Debian","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2988/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2988/develop/developer-guide/vdsm/on-debian.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2988/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2988/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2988/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2988/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2988/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2988/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2988/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2988/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2988/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2988/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2988/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2988/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2988/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2988/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2988/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2988/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2988/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2988/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2988/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2988/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2988/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2988/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2988//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2988//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2988/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2988/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2988/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2988/develop/developer-guide/vdsm/">
              <span property="name">Vdsm</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/aa67dddf03cc269feeaf822b83e8c1d6?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/aa67dddf03cc269feeaf822b83e8c1d6?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Simone Tiraboschi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Simone Tiraboschi</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<p>The aim is this page is tracking the progress to have oVirt managing a Debian based host for virtualizaion purposes.
oVirt require to have an agent on each host, the agent is called VDSM so the first step is to have VDSM running on Debian.</p>

<p>Targeted Debian Version: Debian Jessie (8), is current testing and feature frozen, it should be releases when ready so it’s about months.</p>

<h1 id="vdsm-on-debian">VDSM on Debian</h1>

<p>The aim is to have VDSM 4.17 on Debian.
Here we have a patch for the packaging work.
<a href="http://gerrit.ovirt.org/#/c/37737/">http://gerrit.ovirt.org/#/c/37737/</a> Currently VDSM is just running on Fedora/RHEL/Centos and derivates.
No positive feedback on other distribution till today.</p>

<h3 id="building-it">Building it</h3>

<p>The build command is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  fakeroot debian/rules binary
</code></pre></div></div>

<p>The clean up one:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  fakeroot debian/rules binary
</code></pre></div></div>

<h3 id="creating-a-simple-repo-for-it">Creating a simple repo for it</h3>

<p>To build a simple repo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ mkdir ~/debian
  $ mkdir ~/debian/binary
  $ mkdir ~/debian/source
</code></pre></div></div>

<p>copy all the .deb to ~/debian/binary than regenerate Packages.gz and Source.gz</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ cd ~/debian
  $ dpkg-scanpackages binary /dev/null | gzip -9c &gt; binary/Packages.gz
  $ cd ~/debian
  $ dpkg-scansources source /dev/null | gzip -9c &gt; source/Sources.gz
</code></pre></div></div>

<p>Than add Release files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  stirabos@debian8t1:~/archive_20150624$ cat ~/debian/binary/Release 
  Archive: unstable
  Component: contrib
  Origin: stirabos
  Label: First attempt to have VDSM on Debian Jessie (still not working)
  Architecture: amd64
  stirabos@debian8t1:~/archive_20150624$ cat ~/debian/source/Release 
  Archive: unstable
  Component: contrib
  Origin: stirabos
  Label: First attempt to have VDSM on Debian Jessie (still not working)
  Architecture: source
</code></pre></div></div>

<p>Upload it to the destination folder</p>

<p>You can use it adding</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  # vdsm 4.17
  deb `[`http://resources.ovirt.org/pub/ovirt-3.6-pre/debian/`](http://resources.ovirt.org/pub/ovirt-3.6-pre/debian/)` binary/
</code></pre></div></div>

<p>under /etc/apt/sources.list Than $ sudo apt-get update $ sudo apt-get install vdsm to install vdsm</p>

<h2 id="dependency-packages">Dependency Packages</h2>

<ul>
  <li>python-cpopen - Creates a subprocess in simpler safer manner
    <ul>
      <li>Currently not available in Debian</li>
      <li>Here we have a patch to package it for Debian <a href="http://gerrit.ovirt.org/#/c/37926/">http://gerrit.ovirt.org/#/c/37926/</a></li>
      <li>Here the corresponding ITP <a href="https://www.mail-archive.com/debian-bugs-dist@lists.debian.org/msg1302660.html">https://www.mail-archive.com/debian-bugs-dist@lists.debian.org/msg1302660.html</a></li>
    </ul>
  </li>
  <li>python-pthreading - Reimplement threading.Lock, RLock and Condition with libpthr
    <ul>
      <li>Currently not available in Debian</li>
      <li>Here we have a patch to package it for Debian <a href="http://gerrit.ovirt.org/#/c/37916/">http://gerrit.ovirt.org/#/c/37916/</a></li>
      <li>Here the corresponding ITP <a href="https://www.mail-archive.com/debian-bugs-dist@lists.debian.org/msg1302710.html">https://www.mail-archive.com/debian-bugs-dist@lists.debian.org/msg1302710.html</a></li>
    </ul>
  </li>
  <li>python-ioprocess - Slave process for safe IO on linux
    <ul>
      <li>Currently not available in Debian</li>
      <li>Here we have a patch to package it for Debian <a href="http://gerrit.ovirt.org/#/c/38074/">http://gerrit.ovirt.org/#/c/38074/</a></li>
      <li>previously packed by evilissimo</li>
    </ul>
  </li>
</ul>

<h2 id="open-issue">Open Issue</h2>

<p>VDSM is relaying on a custom release of M2Crypto python libraries. M2Crypto is an OpenSSL wrapper. Upstream release of M2Crypto is available here: <a href="https://github.com/M2Crypto/M2Crypto/">https://github.com/M2Crypto/M2Crypto/</a></p>

<p>Fedora release (and derivate including RHEL and Centos) includes some additional patches, in particular one to properly work with SSL timeouts: <a href="http://www.zhangsheng.org/magic/3.0/sources/SOURCES.m/m2crypto/m2crypto-0.21.1-timeouts.patch">m2crypto-0.21.1-timeouts.patch</a>
The patch was submitted for upstream but never merged cause not compatible with Windows.</p>

<p>VDSM needs that for SSL communication; an attempt to have a patch to avoid it was done here <a href="http://gerrit.ovirt.org/#/c/37746/">http://gerrit.ovirt.org/#/c/37746/</a> but it was not enough to pass SSL unit tests.</p>

<p>The bug is tracked here: <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1192496">https://bugzilla.redhat.com/show_bug.cgi?id=1192496</a>
I asked to the M2Crypto upstream maintainer about the process to have the patch merged but it’s quite a long process
and we need to ensure it works on every platform. One possible alternative is repackaging M2Crypto for Debian in a custom
version with the timeout patch requiring it instead of the vanilla one for VDSM. Apply:</p>

<ol>
  <li><a href="http://www.zhangsheng.org/magic/3.0/sources/SOURCES.m/m2crypto/m2crypto-0.21.1-timeouts.patch">m2crypto-0.21.1-timeouts.patch</a></li>
  <li><a href="http://www.zhangsheng.org/magic/3.0/sources/SOURCES.m/m2crypto/m2crypto-0.21.1-memoryview.patch">m2crypto-0.21.1-memoryview.patch</a></li>
</ol>

<p>and rebuilding it starting from &lt;git://anonscm.debian.org/collab-maint/m2crypto&gt;</p>

<p>Applying the two patches seams to be enough to pass most of SSL unit tests. Still an open issue on sslTests.VerifyingTransportTests</p>

<p>To complete some unit tests, VDSM is looking for /etc/pki/vdsm/keys/libvirt_password which of course doesn’t exists prior of VDSM installation. Creating that file with the right content seams to be enough to pass that tests.</p>

<h2 id="current-results">Current results</h2>

<p>VDSM building process is running 915 unit tests skipping 20 of them and getting errors on 1.</p>

<h2 id="todo">TODO</h2>

<ul>
  <li>Successfully pass each unit test on Debian</li>
  <li>Add CI jobs to keep it nigtly-builded</li>
  <li>start testing activities of hosts</li>
</ul>

<h1 id="existing-efforts">Existing Efforts</h1>

<ul>
  <li><a href="/ovirt-site/previews/2988/develop/developer-guide/ubuntu.html">oVirt build on debian/ubuntu</a></li>
  <li><a href="/ovirt-site/previews/2988/develop/developer-guide/porting-ovirt.html">Porting oVirt</a></li>
  <li><a href="/ovirt-site/previews/2988/develop/developer-guide/vdsm/on-ubuntu.html">VDSM_on_Ubuntu</a></li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2988/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2988/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2988/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2988/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/vdsm/on-debian.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/developer-guide/vdsm/on-debian.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
