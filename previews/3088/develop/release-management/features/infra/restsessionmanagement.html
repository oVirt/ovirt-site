<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>RESTSessionManagement | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="RESTSessionManagement" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3088/develop/release-management/features/infra/restsessionmanagement.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3088/develop/release-management/features/infra/restsessionmanagement.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="RESTSessionManagement" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"RESTSessionManagement","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3088/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3088/develop/release-management/features/infra/restsessionmanagement.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3088/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3088/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3088/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3088/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3088/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3088/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3088/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3088/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3088/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3088/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3088/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3088/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3088/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3088/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3088/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3088/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3088/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3088/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3088/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3088/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3088/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3088/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3088//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3088//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3088/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3088/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3088/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3088/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3088/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Oved Ourfali">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Oved Ourfali</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3088/documentation/'>Documentation is available here.</a></div>

<h1 id="rest-api-session-management">REST API session management</h1>

<h2 id="summary">Summary</h2>

<p>The purpose of the feature is to add session management to the oVirt REST API.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Oved Ourfali (Ovedo)</li>
  <li>Email: <a href="mailto:ovedo@redhat.com">ovedo@redhat.com</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Finished implementation in oVirt 3.1</li>
</ul>

<h2 id="background">Background</h2>

<p>This feature is essential for certain types of ISV integration. Many ISVs need to mirror the oVirt inventory (i.e. all VMs, clusters, basically any object managed by oVirt) in real-time to their own database. The way they do this currently is by polling /api/events and look for changes. In order to be able to react to changes fast, they typically poll every 5 seconds. The query itself is very efficient, so it doesn’t cause a whole lot of load on oVirt. But it floods the log with login/logout events. This persistent session feature is a solution for that.</p>

<h2 id="requirements">Requirements</h2>

<ol>
  <li>Provide a session management mechanism that would allow clients to use the oVirt API without requiring them to pass credentials on each call</li>
  <li>Reduce the overhead and also without the extra overhead of logging in and out in each request.</li>
  <li>Continue supporting the old mechanism, in which credentials are passed in every request (no login/logout optimization, just the same as today).</li>
</ol>

<h2 id="detailed-description">Detailed Description</h2>

<p>Today, when working with the API (via the CLI, SDK, curl, browser or any other web client), the credentials must be passed in each and every request made to the API. Also, in each such request the REST API initiates a login and logout to the engine core. The purpose of this feature is to allow clients to perform some initial login phase, work with the same session for multiple requests, and then close it (or leave it open until it is closed for inactivity).</p>

<h2 id="implementation">Implementation</h2>

<p>The proposed implementation for that is to rely on cookies in the following way:</p>

<ol>
  <li>First, the client does a request providing credentials, with a special Header field: “Prefer: persistent-auth”.</li>
  <li>The server logs in to the engine-core, with a new generated session-id that is saved on the HTTP Session, and performs the required action. The JSESSIONID cookie is returned automatically to the client.</li>
  <li>The client gets the cookie, and (if he wants to) in the second request he passes it to the server, with the “Prefer” header to enable keeping the session. No need to pass credentials.</li>
  <li>Passing the credentials will re-authenticate, returning a new cookie.</li>
  <li>The server gets the cookie, validates the session using (getting the session-ID from the HTTP session attributes), performs the request, and returns. The session remains valid as the “Prefer” header was passed.</li>
  <li>Once the client passes the cookie but doesn’t pass the “Prefer” header, the session is closed.</li>
</ol>

<p>Notes:</p>

<ul>
  <li>Existing clients can continue working as they are working today. They just ignore the JSESSIONID cookie, and pass credentials on each call. No need to provide the “Prefer” header. The API will then do login and logout to the engine on each call.</li>
  <li>If the session is expired, the client will be required to pass credentials again, resulting in a new session being created.
    <ol>
      <li>The client passes the “Prefer” header field on every request, besides the last one. When the server gets a request with a JSESSIONID, and without the “Prefer” header, it logs out the session.</li>
    </ol>
  </li>
  <li>Other options are:</li>
  <li>Rely on session timeout for invalidation of sessions.
    <ol>
      <li>The client passes the “Prefer” header field only once (on start), and passes another header field when he finishes the work with the session.</li>
    </ol>
  </li>
  <li>The engine session ID is not the JSESSIONID. The</li>
</ul>

<p>We decided to go with the first approach, passing the header on every request, and releasing the session once the header isn’t passed.</p>

<p>Flow of using the Prefer header on each call:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Client                                           Server
    |                                                |
    | ---------initial request with Prefer header--&gt; |
    |                                          [login]
    | &lt;----Set-Cookie:JSESSIONID=.....---------------|
    |                                                |
    | -----Cookie:JSESSIONID=.....+ Prefer header---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    | -----Cookie:JSESSIONID=.....+ Prefer header---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    |              ... time pases...                 |
    |                                                |
    | -----Cookie:JSESSIONID=.....------------------&gt;|
    | [validate session. no Prefer header --&gt; logout ]
    | &lt;----------------------------------------------|
    |                                                |
</code></pre></div></div>

<p>Flow when relying on session timeout:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Client                                           Server
    |                                                |
    | ---------initial request with Prefer header--&gt; |
    |                                          [login]
    | &lt;----Set-Cookie:JSESSIONID=.....---------------|
    |                                                |
    | -----Cookie:JSESSIONID=....................---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    | -----Cookie:JSESSIONID=....................---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    |              ... time pases...                 |
    |                                                |
    | -----Cookie:JSESSIONID=.....------------------&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    |              ... time pases...                 |
    |                                                |
    |             [session timeout --&gt; remove session]
    |                                                |
</code></pre></div></div>

<p>Flow when passing another header for ending sessions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Client                                           Server
    |                                                |
    | ---------initial request with Prefer header--&gt; |
    |                                          [login]
    | &lt;----Set-Cookie:JSESSIONID=.....---------------|
    |                                                |
    | -----Cookie:JSESSIONID=....................---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    | -----Cookie:JSESSIONID=....................---&gt;|
    |                               [validate session]
    | &lt;----------------------------------------------|
    |                                                |
    |              ... time pases...                 |
    |                                                |
    | -----Cookie:JSESSIONID=....., "Logout" header-&gt;|
    |                      [validate session. logout ]
    | &lt;----------------------------------------------|
    |                                                |
</code></pre></div></div>

<h2 id="scope">Scope</h2>

<p>The scope of the feature is as follows:</p>

<ul>
  <li>Adding the mechanism to the REST API</li>
  <li>Using this mechanism in the CLI/SDK</li>
</ul>

<h2 id="documentation--external-references">Documentation / External references</h2>

<ol>
  <li>On the HTTP Prefer header field: <a href="http://tools.ietf.org/html/draft-snell-http-prefer-12">http://tools.ietf.org/html/draft-snell-http-prefer-12</a></li>
</ol>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3088/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3088/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3088/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3088/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/restsessionmanagement.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/infra/restsessionmanagement.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
