<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ResolveActiveInterface | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="ResolveActiveInterface" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/resolveactiveinterface.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/resolveactiveinterface.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ResolveActiveInterface" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"ResolveActiveInterface","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3192/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/resolveactiveinterface.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3192/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3192/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3192/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3192/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3192/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3192/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3192/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3192/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3192/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/22df8d1dd0d80c59d8b060ead307966f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/22df8d1dd0d80c59d8b060ead307966f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Eliraz Levi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Eliraz Levi</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3192/documentation/'>Documentation is available here.</a></div>

<p>Features/ResolveActiveInterface</p>

<h1 id="resolve-active-interface">Resolve Active Interface</h1>

<h2 id="summary">Summary</h2>

<p>The feature will extend the engine ability to resolve the active interface in which vdsm uses to communicates over it with engine.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Eliraz Levi</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>When adding host to the Data Center, engine will instruct vdsm (if required) to deploy management network.
However, engine must first know, the correct interface to deploy the management network on top of it.
Until now, engine acquired the correct interface by looking at the lastClientIface element of VdsGetCapabilities verb.
As approaching the removal of the direct Engine-Vdsm TCP connection requirement, vdsm will no longer be able to compute the lastClientIface element.
Instead, engine will resolve the correct interface as followed next:
engine will resolve the host ip address by using the java’s INetAddress.getByName function. The limitation of this approach will be discussed later.
Next, engine will compare between the resolved host’s ip address and the one that owned (if exists) by each of host’s interfaces. In case of a match, the interface will be resolved as the hostActiveNic.
note that the host’s interface’s ip address, is reported by vdsm’s VdsGetCapabilities verb.
 The main concept of the feature, is that in case of a “nested” network topology configuration , only the top Link-Layer component will own an ip address.
for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  == network layout ==
bond0        slaves=ens1, ens2
</code></pre></div></div>

<p>in this case, only bond0 will own an ip address (if configured) as it the top Link-Layer component.</p>

<p>Note that in case vdsm is communicating with engine over a bridge, the bridge will be resolved as “hostActiveNic”.
important to mention that oVirt doesn’t support deployment of management network over a bridge, resulting with a setup network failure in this scenario.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Engine will be able to resolve the host active interface, without being depended on vdsm to report it. By doing so, freeing vdsm from reporting it and helps to break the Engine-Vdsm TCP connection dependency which is required to be eliminated.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<p>vdsm:</p>

<ul>
  <li>eliminating the need of “get route” vdsm’s verb.</li>
  <li>lastClientIface element of getVdsCapabilites verb will be no longer needed.</li>
</ul>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p>Is there upstream documentation on this feature, or notes you have written yourself? Link to that material here so other interested developers can get involved. Links to RFEs.</p>

<h2 id="testing">Testing</h2>

<ul>
  <li>Verification of management network setup in different network topology configurations:
    <ul>
      <li>one nic owns the same ip address as host-ip.</li>
      <li>multiple nics own an ip address , only one has the resolved host-ip address.</li>
      <li>multiple nics own an ip address , more than one has the resolved host-ip address.
        <ul>
          <li>note that this scenario is possible in case that DNS host name resolution has more than one ip address.</li>
        </ul>
      </li>
      <li>bond with nics, bond owns the same ip address as host-ip.</li>
      <li>all the scenario above, with VLAN configured on top.</li>
      <li>all the scenario above, with Bridge configured on top (should fail).</li>
    </ul>
  </li>
  <li>UTest in which will mock host interfaces and confirm that the correct interface is being resolved as hostActiveNic</li>
</ul>

<h2 id="feature-limitations">Feature Limitations</h2>

<ul>
  <li>In case host name resolution has more than one ip address, the following scenario is possible:
    <ul>
      <li>Let be a host with two interfaces “A” with ip “a.a.a.a”, “B” with ip address “b.b.b.b”.</li>
      <li>The DNS is configured to has two ip address resolutions of the host under the key “host name”.</li>
      <li>Say that host with name “host name” was added to the Data Center before.</li>
      <li>The DNS name resolution of “host name” was “a.a.a.a” and management network was deployed over interface “A” with ip “a.a.a.a” as interface “A” was resolved to be the hostActiveNic.</li>
      <li>Later the host was removed from the Data Center.
        <ul>
          <li>Note, in this case the host’s network configuration is not being reverted as before the host was initially added to the Data Center, resulting the management network to still be configured at the host.</li>
        </ul>
      </li>
      <li>Later, the host was added again, but this time the DNS name resolution was “b.b.b.b”, resulting interface “B” to be resolved as hostActiveNic.</li>
      <li>In this case, the management network deployment will failed as it fail to pass the validation of NETWORKS_ALREADY_ATTACHED_TO_IFACES.</li>
    </ul>
  </li>
</ul>

<h2 id="contingency-plan">Contingency Plan</h2>

<p>Explain what will be done in case the feature won’t be ready on time</p>

<h2 id="release-notes">Release Notes</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  == Your feature heading ==
  A descriptive text of your feature to be included in release notes
</code></pre></div></div>

<h2 id="comments-and-discussion">Comments and Discussion</h2>

<ul>
  <li>important to mention, the original “GetRoute” feature in which a new vdsm verb defining an API of engine telling the host its ip address. Vdsm will then response with the hostActiveNic.
    <ul>
      <li>The feature was abandoned as engine is not able to tell vdsm it’s own ip address as same as vdsm is seeing it as the engine can be hiding behind NAT for example.</li>
    </ul>
  </li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3192/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3192/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3192/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3192/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/resolveactiveinterface.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/resolveactiveinterface.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
