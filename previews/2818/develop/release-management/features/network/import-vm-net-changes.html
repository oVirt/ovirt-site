<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Change network information in VM import | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Change network information in VM import" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2818/develop/release-management/features/network/import-vm-net-changes.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2818/develop/release-management/features/network/import-vm-net-changes.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Change network information in VM import" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Change network information in VM import","url":"https://ovirt.github.io/ovirt-site/previews/2818/develop/release-management/features/network/import-vm-net-changes.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2818/images/logo.svg"}},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2818/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2818/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2818/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2818/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2818/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2818/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2818/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2818/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2818/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2818/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2818/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2818/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2818/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2818/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2818/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2818/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2818/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2818/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2818/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2818/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2818/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2818/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2818/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2818/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2818/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2818/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2818/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2818/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2818/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2818/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2818/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2818/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2818/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2818/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2818/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2818//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2818//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2818/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2818/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2818/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2818/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2818/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/52ced33e55ce6b7309d2c399121ecc35?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/52ced33e55ce6b7309d2c399121ecc35?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yevgeny Zaspitsky</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2818/documentation/'>Documentation is available here.</a></div>

<h1 id="change-network-information-in-vm-import">Change network information in VM import</h1>

<h2 id="summary">Summary</h2>

<p>Currently importing a VM from an external source might result in a 
non-functional VM from the network perspective:</p>

<ul>
  <li>Mapping the vNic profile by name might lead to one of the following:
    <ul>
      <li>vNics that are not connected to any network that is defined in the 
oVirt the VM was imported to</li>
      <li>vNic is connected to an undesired vNic profile that matches by 
  name but not by the meaning.</li>
    </ul>
  </li>
  <li>The MAC address that was assigned to the vNic in the external 
system could be problematic in the local oVirt setup.</li>
</ul>

<p>The feature intends to solve the mentioned problems in the flow of 
importing VMs from a data domain storage.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Yevgeny Zaspitsky (YevgenyZ)</li>
  <li>Email: <a href="mailto:yzaspits@redhat.com">yzaspits@redhat.com</a></li>
</ul>

<h2 id="proposed-solution">Proposed solution</h2>

<h3 id="mapping-vnic-profiles-to-the-target-ones">Mapping vNic profiles to the target ones.</h3>
<p>The mapping of the source vNic profiles to the ones that are defined 
under destination DC/custer would be possible as part of the import 
operation.</p>

<h4 id="rest-api">REST API</h4>
<p>The user would supply the desired mappings as part of the import VMs 
request. The mapping would look like a collection of entries, 
where each of the entries would consist of the following:</p>

<ul>
  <li>Source network name</li>
  <li>Source network profile name</li>
  <li>Target network profile</li>
</ul>

<p>The mappings data would be passed as additional optional data of the 
existing VM import request:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /storagedomains/{storagedomain:id}/vms/{vm:id}/register
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;cluster</span> <span class="na">id=</span><span class="s">”XXX”/</span><span class="nt">&gt;</span>
    ....
    <span class="c">&lt;!-- The new addition start --&gt;</span>
    <span class="nt">&lt;vnic_profile_mappings&gt;</span>
        <span class="nt">&lt;vnic_profile_mapping&gt;</span>
            <span class="nt">&lt;source_network_name&gt;</span>red<span class="nt">&lt;/source_network_name&gt;</span>
            <span class="nt">&lt;source_network_profile_name&gt;</span>gold<span class="nt">&lt;/source_network_profile_name&gt;</span>
            <span class="nt">&lt;target_vnic_profile</span> <span class="na">id=</span><span class="s">"738dd914-8ec8-4a8b-8628-34672a5d449b"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/vnic_profile_mapping&gt;</span>
        <span class="nt">&lt;vnic_profile_mapping&gt;</span>
            <span class="nt">&lt;source_network_name&gt;</span>blue<span class="nt">&lt;/source_network_name&gt;</span>
            <span class="nt">&lt;source_network_profile_name&gt;</span>silver<span class="nt">&lt;/source_network_profile_name&gt;</span>
        <span class="nt">&lt;/vnic_profile_mapping&gt;</span>
    <span class="nt">&lt;/vnic_profile_mappings&gt;</span>
    <span class="c">&lt;!-- The new addition end --&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div></div>

<p>Since the mappings are optional, any vNic profile that the mapping isn’t
 supplied for, would be mapped to a profile with the same name, if 
that exists, or an “empty” profile otherwise, like that’s done 
currently.
A missing “target_network_profile” element would mean the target profile
 is an “empty” profile. That is useful for the case in which source 
profile is known to be used in a target system for something else and an 
alternative profile isn’t exist yet.</p>

<h4 id="gui">GUI</h4>
<p>The engine would scan all VMs that are intended to be imported and will 
provide a list of network+profile that are defined on the vNics of those
 VMs. Then mappings could be defined (by the user) in an expandable span
 that would be added to the import VM dialog. 
Each line would represent a single mapping with the following fields:</p>

<ul>
  <li>Source network name</li>
  <li>Target network name</li>
  <li>Source vNic profile name</li>
  <li>Target vNic profile name</li>
</ul>

<p><img src="/ovirt-site/previews/2818/images/wiki/import_vm-vnic_mapping.jpg" alt="Network mapping modal" /></p>

<p>Initially all vNic profiles would be mapped to a matching (by name) 
network+profile on the target or would be an “Empty” profile if no match
 exists. Then the user would be able to change that to any desired 
profile. The list of the available networks would be filtered according 
to the chosen cluster and the list of the profiles would be filtered by 
the chosen network.</p>

<h3 id="re-assign-mac-addresses-for-the-vnics-of-an-imported-vm">Re-assign MAC addresses for the vNics of an imported VM</h3>
<p>The user will be able to request to re-assign a new MAC instead of the 
one that is problematic in the context of the target cluster.
The reasons for a MAC to be problematic are:</p>

<ul>
  <li>Collision - the MAC is owned by an existing vNic.</li>
  <li>The MAC is out of range of the destination cluster.</li>
</ul>

<p>Note that a re-assign request modifies only problematic MACs. If a VM 
has “good” MACs as well, they would remain.</p>

<h4 id="rest-api-1">REST API</h4>
<p>The import VM request will have additional boolean 
parameter “reassign_bad_macs”. In order to keep backward compatibility 
the default value of the new parameter will be False.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /storagedomains/{storagedomain:id}/vms/{vm:id}/register
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;cluster</span> <span class="na">id=</span><span class="s">”XXX”/</span><span class="nt">&gt;</span>
    ....
    <span class="c">&lt;!-- The new addition start --&gt;</span>
    <span class="nt">&lt;reassign_bad_macs&gt;</span>true<span class="nt">&lt;/reassign_bad_macs&gt;</span>
    <span class="c">&lt;!-- The new addition end --&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div></div>

<h4 id="gui-1">GUI</h4>
<p>VM with a problematic MAC would be marked by a warning triangle with an 
explanatory tooltip. Checking re-assign for that VM may eliminate the 
warning (if the warning is only due to MAC problem).
<img src="/ovirt-site/previews/2818/images/wiki/register_vm-mac_in_use.jpg" alt="" /></p>

<h2 id="related-rfes">Related RFEs</h2>
<ul>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1277675">BZ#1277675</a></li>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1317447">BZ#1317447</a></li>
</ul>

<h2 id="testing">Testing</h2>

<ul>
  <li>Import a VM with a network profile that does not exist on the 
destination cluster
    <ul>
      <li>no mapping supplied -&gt; Empty vNic profile</li>
      <li>mapping is supplied -&gt; vNic is wired to the profile according to
  the supplied mapping</li>
    </ul>
  </li>
  <li>Import a VM with the existing vNic profile
(e.g. network=”red”, profile=”gold”)
    <ul>
      <li>no mapping supplied -&gt; VM connected to the vNic profile “red-gold”</li>
      <li>mapping maps the src profile to “green-silver” -&gt; vNic is 
  connected to “green-silver” profile</li>
    </ul>
  </li>
  <li>On REST API - mapping is supplied but contains a non-existent 
destination profile -&gt; user should get an error message with HTTP 400 
series error code.</li>
  <li>Verify that re-assigning MACs actually works, and that good MACs are 
given.</li>
  <li>Verify that warning sign appears in the following cases:
    <ul>
      <li>VM with a colliding MAC</li>
      <li>VM with a MAC, which is out if the range to the destination
   cluster’s MAC-pool.</li>
    </ul>
  </li>
</ul>

<h2 id="future-plans">Future plans</h2>
<p>Apply the similar changes to flows importing VM from the other sources
 (e.g. export domain, V2V).</p>

<h2 id="open-issues">Open Issues</h2>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2818/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2818/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2818/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2818/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/import-vm-net-changes.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/import-vm-net-changes.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
