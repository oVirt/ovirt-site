<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Ruby SDK Guide | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Ruby SDK Guide" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3119/documentation/doc-Ruby_SDK_Guide/" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3119/documentation/doc-Ruby_SDK_Guide/" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Ruby SDK Guide" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Ruby SDK Guide","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3119/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3119/documentation/doc-Ruby_SDK_Guide/"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3119/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3119/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3119/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3119/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3119/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3119/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3119/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3119/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3119/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3119/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3119/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3119/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3119/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3119/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3119/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3119/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3119/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3119/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3119/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3119/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3119/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3119/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3119//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3119//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3119/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3119/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#chap-Overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#Prerequisites">1.1. Prerequisites</a></li>
<li><a href="#Installing_the_Ruby_SDK">1.2. Installing the Ruby Software Development Kit</a></li>
<li><a href="#Dependencies">1.3. Dependencies</a></li>
</ul>
</li>
<li><a href="#chap-Using_the_Software_Development_Kit">2. Using the Software Development Kit</a>
<ul class="sectlevel2">
<li><a href="#Classes">2.1. Classes</a></li>
<li><a href="#Using_Types">2.2. Types</a>
<ul class="sectlevel3">
<li><a href="#creating-and-modifying-instances-of-types">2.2.1. Creating and Modifying Instances of Types</a></li>
<li><a href="#retrieving-instance-attributes">2.2.2. Retrieving Instance Attributes</a></li>
</ul>
</li>
<li><a href="#Services">2.3. Services</a>
<ul class="sectlevel3">
<li><a href="#Retrieving_services">2.3.1. Retrieving Services</a></li>
<li><a href="#Service_methods">2.3.2. Service Methods</a>
<ul class="sectlevel4">
<li><a href="#get"><code>Get</code></a></li>
<li><a href="#list"><code>List</code></a></li>
<li><a href="#add"><code>Add</code></a></li>
<li><a href="#update"><code>Update</code></a></li>
<li><a href="#remove"><code>Remove</code></a></li>
<li><a href="#additional-actions">Additional Actions</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Ruby_Examples">3. Ruby Examples</a>
<ul class="sectlevel2">
<li><a href="#Connecting_to_the_server">3.1. Connecting to the {virt-product-fullname} {engine-name}</a></li>
<li><a href="#Listing_data_centers">3.2. Listing Data Centers</a></li>
<li><a href="#Listing_clusters">3.3. Listing Clusters</a></li>
<li><a href="#Listing_logical_networks">3.4. Listing Logical Networks</a></li>
<li><a href="#Listing_hosts">3.5. Listing Hosts</a></li>
<li><a href="#Listing_ISO_files_in_ISO_storage_domain">3.6. Listing ISO Files in the ISO Storage Domain</a></li>
<li><a href="#Creating_NFS_storage_domain">3.7. Creating an NFS Storage Domain</a></li>
<li><a href="#attaching-a-storage-domain-to-a-data-center">3.8. Attaching a Storage Domain to a Data Center</a></li>
<li><a href="#Creating_a_virtual_machine">3.9. Creating a Virtual Machine</a></li>
<li><a href="#Creating_a_vNIC_profile">3.10. Creating a vNIC Profile</a></li>
<li><a href="#Creating_a_vNIC">3.11. Creating a vNIC</a></li>
<li><a href="#Creating_a_virtual_disk">3.12. Creating a Virtual Disk</a></li>
<li><a href="#Attaching_ISO_image_to_a_virtual_machine">3.13. Attaching an ISO Image to a Virtual Machine</a></li>
<li><a href="#Detaching_a_virtual_disk">3.14. Detaching a Virtual Disk</a></li>
<li><a href="#Starting_a_virtual_machine">3.15. Starting a Virtual Machine</a></li>
<li><a href="#Starting_a_virtual_machine_with_specific_boot_devices">3.16. Starting a Virtual Machine with Specific Boot Devices and Boot Order</a></li>
<li><a href="#Starting_a_virtual_machine_with_cloud-init">3.17. Starting a Virtual Machine with Cloud-Init</a></li>
<li><a href="#Checking_system_events">3.18. Checking System Events</a></li>
</ul>
</li>
<li><a href="#ovirt-legal-notice">Appendix A: Legal notice</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="chap-Overview">1. Overview</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ruby software development kit (SDK) is deprecated. Support for Ruby SDK will be removed in a later release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Ruby software development kit is a Ruby gem that allows you to interact with the {virt-product-fullname} {engine-name} in Ruby projects. By downloading these classes and adding them to your project, you can access a range of functionality for high-level automation of administrative tasks.</p>
</div>
<div class="sect2">
<h3 id="Prerequisites">1.1. Prerequisites</h3>
<div class="paragraph">
<p>To install the Ruby software development kit, you must have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A system with {enterprise-linux} 8 installed. Both the Server and Workstation variants are supported.</p>
</li>
<li>
<p>A subscription to {virt-product-fullname} entitlements.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Installing_the_Ruby_SDK">1.2. Installing the Ruby Software Development Kit</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the required repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos \
    --enable=rhel-8-for-x86_64-baseos-rpms \
    --enable=rhel-8-for-x86_64-appstream-rpms \
    --enable=rhv-4.4-manager-for-rhel-8-x86_64-rpms</pre>
</div>
</div>
</li>
<li>
<p>Install the Ruby Software Development Kit:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install rubygem-ovirt-engine-sdk4</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can install with <code>gem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># gem install ovirt-engine-sdk</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Dependencies">1.3. Dependencies</h3>
<div class="paragraph">
<p>The Ruby Software Development Kit has the following dependencies, which you must install manually if you are using <code>gem</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>libxml2</code> for parsing and rendering XML</p>
</li>
<li>
<p><code>libcurl</code> for HTTP transfers</p>
</li>
<li>
<p>C compiler</p>
</li>
<li>
<p>Required header and library files</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You do not need to install the dependency files if you installed the RPM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Install the dependency files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf install gcc libcurl-devel libxml2-devel ruby-devel</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Debian or Ubuntu, use <code>apt-get</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># apt-get install gcc libxml2-dev libcurl-dev ruby-dev</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Using_the_Software_Development_Kit">2. Using the Software Development Kit</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the modules and classes of the Ruby Software Development Kit and describes their usage.</p>
</div>
<div class="sect2">
<h3 id="Classes">2.1. Classes</h3>
<div class="paragraph">
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">OvirtSDK4</a> module contains the following software development kit classes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Connection</dt>
<dd>
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection">Connection</a> class is the mechanism for connecting to the server and obtaining the reference to the root of the services tree. See <a href="#Connecting_to_the_server">Connecting to the server</a> for details.</p>
</dd>
<dt class="hdlist1">Types</dt>
<dd>
<p>The Type classes implement the types supported by the API. For example, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class is the implementation of the virtual machine type. The classes are data containers and do not contain any logic. You will be working with instances of types.</p>
<div class="paragraph">
<p>Instances of these classes are used as parameters and return values of service methods. The conversion to or from the underlying representation is handled transparently by the software development kit.</p>
</div>
</dd>
<dt class="hdlist1">Services</dt>
<dd>
<p>The Service classes implement the services supported by the API. For example, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmsService">VmsService</a> class is the implementation of the service that manages the collection of virtual machines in the system.</p>
<div class="paragraph">
<p>Instances of these classes are automatically created by the SDK when a service is referenced. For example, a new instance of the <code>VmsService</code> class is created automatically by the SDK when you call the <code>vms_service</code> method of the <code>SystemService</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vms_service = connection.system_service.vms_service</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create instances of these classes manually. The constructor parameters and methods may change in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Error</dt>
<dd>
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> class is the base exception class that the software development kit raises when it reports an error.</p>
<div class="paragraph">
<p>Certain specific error classes extend the base error class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AuthError - Authentication or authorization failure</p>
</li>
<li>
<p>ConnectionError - Server name cannot be resolved or server is unreachable</p>
</li>
<li>
<p>NotFoundError - Requested object does not exist</p>
</li>
<li>
<p>TimeoutError - Operation time-out</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Other Classes</dt>
<dd>
<p>Other classes (for example, HTTP client classes, readers, and writers) are used for HTTP communication and for XML parsing and rendering. Using these classes is not recommended, because they comprise internal implementation details that may change in the future. Their backwards-compatibility cannot be relied upon.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="Using_Types">2.2. Types</h3>
<div class="sect3">
<h4 id="creating-and-modifying-instances-of-types">2.2.1. Creating and Modifying Instances of Types</h4>
<div class="paragraph">
<p>Creating or modifying an instance of a type does not have any effect on the server side, unless the changes are explicitly sent to the server calling a service method, as described below. Changes on the server side are not automatically reflected in instances that already exist in memory.</p>
</div>
<div class="paragraph">
<p>The constructors of these classes have multiple optional arguments, one for each attribute of the type. This simplifies the creation of objects, by using nested calls to multiple constructors.</p>
</div>
<div class="paragraph">
<p>In the following example, an instance of a virtual machine is created and its attributes (cluster, template, and memory) are set:</p>
</div>
<div id="Creating_a_Virtual_Machine_Instance_with_Attributes" class="listingblock">
<div class="title">Creating a Virtual Machine Instance with Attributes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">cluster</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Cluster</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
  ),
  <span style="color:#606">template</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Template</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
  ),
  <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hashes (for example, <code>cluster: OvirtSDK4::Cluster.new</code>) passed to these constructors are processed recursively.</p>
</div>
<div class="paragraph">
<p>In the following example, plain hashes are used instead of explicitly calling the constructors for the Cluster and Template classes. The SDK internally converts the hashes to the required classes.</p>
</div>
<div class="listingblock">
<div class="title">Creating a Virtual Machine Instance with Attributes Expressed as Plain Hashes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">cluster</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
  },
  <span style="color:#606">template</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
  },
  <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using constructors in this way is recommended, but not mandatory.</p>
</div>
<div class="paragraph">
<p>In the following example, a virtual machine instance is created with no arguments in the call to the constructor. You can add the virtual machine instance&#8217;s attributes one by one, using setters, or by using a combination of setters and constructors.</p>
</div>
<div class="listingblock">
<div class="title">Creating a Virtual Machine Instance and Adding Attributes Individually</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new
vm.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>
vm.cluster = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Cluster</span>.new(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>)
vm.template = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Template</span>.new(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>)
vm.memory = <span style="color:#00D">1073741824</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes that are defined as lists of objects in the API specification are implemented as Ruby arrays. For example, the <code>custom_properties</code> attributes of the <code>Vm</code> type are defined as a list of objects of type <code>CustomProperty</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adding a List of Attributes as an Array</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">custom_properties</span>: [
    <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">CustomProperty</span>.new(...),
    <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">CustomProperty</span>.new(...),
    ...
  ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes that are defined as enumerated values in the API are implemented as constants in a module with the same name as the enumerated type.</p>
</div>
<div class="paragraph">
<p>The following example shows how the status attribute of the <code>Vm</code> type is defined using the <code>VmStatus</code> enumerated value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#080;font-weight:bold">case</span> vm.status
<span style="color:#080;font-weight:bold">when</span> <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">DOWN</span>
  ...
<span style="color:#080;font-weight:bold">when</span> <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">IMAGE_LOCKED</span>
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the API specification, the values of <code>enum</code> types are lower case, because that is the convention for XML and JSON. In Ruby, however, the convention is to use <strong>upper case</strong> for these constants.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="retrieving-instance-attributes">2.2.2. Retrieving Instance Attributes</h4>
<div class="paragraph">
<p>You can retrieve instance attributes using the corresponding attribute readers.</p>
</div>
<div class="paragraph">
<p>The following example retrieves the name and memory of the virtual machine instance:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Instance Attributes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vm.name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>vm.name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vm.memory: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>vm.memory<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
vm.custom_properties.each <span style="color:#080;font-weight:bold">do</span> |custom_property|
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Retrieving Instance Attributes as Links</strong></p>
</div>
<div class="paragraph">
<p>Some instance attributes are returned as links and require the <code>follow_link</code> method to retrieve the data. In the following example, the response to a request for a virtual machine&#8217;s attributes is formatted as XML with a link:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Attributes as a Link</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">&lt;vm id=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">123</span><span style="color:#710">&quot;</span></span> href=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/ovirt-engine/api/vms/123</span><span style="color:#710">&quot;</span></span>&gt;
  &lt;name&gt;myvm&lt;<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">name&gt;
  &lt;link rel=&quot;diskattachments&quot; href=&quot;</span><span style="color:#404">/</span><span style="color:#C2C">o</span></span>virt-engine/api/vms/<span style="color:#00D">123</span>/diskattachments/<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&gt;
  ...
&lt;/vm&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The link, <code>vm.disk_attachments</code>, does not contain the actual disk attachments. To retrieve the data, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection">Connection</a> class provides a <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection#follow_link-instance_method">follow_link</a> method that uses the value of the <code>href</code> XML attribute to retrieve the actual data.</p>
</div>
<div class="paragraph">
<p>In the following example, <code>follow_link</code> enables you to go to the disk attachments, and then to each disk, to retrieve the <code>alias</code>:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Service</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = vm_service.get</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using <code>follow_link</code> to Retrieve Disk Attachment and Disk Alias</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">attachments = connection.follow_link(vm.disk_attachments)
attachments.each <span style="color:#080;font-weight:bold">do</span> |attachment|
  disk = connection.follow_link(attachment.disk)
  puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">disk.alias: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>disk.alias<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Services">2.3. Services</h3>
<div class="sect3">
<h4 id="Retrieving_services">2.3.1. Retrieving Services</h4>
<div class="paragraph">
<p>The API provides a set of services, each associated with a server path. For example, the service that manages the collection of virtual machines in the system is located in <code>/vms</code>, and the service that manages the virtual machine with identifier <code>123</code> is located in <code>/vms/123</code>.</p>
</div>
<div class="paragraph">
<p>In the Ruby software development kit, the root of that tree of services is implemented by the <code>system service</code>. It is retrieved by calling the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection#system_service-instance_method">system_service</a> method of the connection:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving System Service</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">system_service = connection.system_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the reference to the <code>system service</code>, you can use it to retrieve references to other services, using the <code>*_service</code> methods (called <code>service locators</code>).</p>
</div>
<div class="paragraph">
<p>For example, to retrieve a reference to the service that manages the collection of virtual machines in the system, you can use the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/SystemService#vms_service-instance_method">vms_service</a> service locator:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Other Services</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vms_service = system_service.vms_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve a reference to the service that manages the virtual machine with identifier <code>123</code>, use the service locator of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/SystemService#vms_service-instance_method">vm_service</a> service. The service locator uses the virtual machine identifier as a parameter:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Service Using Identifier</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm_service = vms_service.vms_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The objects returned by the service locator calls are pure services, and do not contain data. For example, the <code>vm_service</code> Ruby object retrieved in the previous example is not the representation of a virtual machine. It is the service that is used to retrieve, update, delete, start, and stop a virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Service_methods">2.3.2. Service Methods</h4>
<div class="paragraph">
<p>After you have located the service you want, you can call its service methods. These methods send requests to the server and do the real work.</p>
</div>
<div class="paragraph">
<p>Services that manage collections of objects usually have the <code>list</code> and <code>add</code> methods.</p>
</div>
<div class="paragraph">
<p>Services that manage a single object usually have the <code>get</code>, <code>update</code>, and <code>remove</code> methods.</p>
</div>
<div class="paragraph">
<p>Services may have additional action methods, which perform actions other than retrieving, creating, updating, or removing. These methods are most commonly found in services that manage a single object.</p>
</div>
<div class="sect4">
<h5 id="get"><code>Get</code></h5>
<div class="paragraph">
<p>The <code>get</code> method retrieves the representation of a single object.</p>
</div>
<div class="paragraph">
<p>The following example locates and retrieves the representation of the virtual machine with identifier <code>123</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages the virtual machine:</span>
vms_service = system_service.vms_service
vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)

<span style="color:#777"># Retrieve the representation of the virtual machine:</span>
vm = vm_service.get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result will be an instance of the corresponding type. In this case, the result is an instance of the Ruby class <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a>.</p>
</div>
<div class="paragraph">
<p>The <code>get</code> method of some services supports additional parameters that control how to retrieve the representation of the object, or which representation to retrieve, if there is more than one.</p>
</div>
<div class="paragraph">
<p>For example, you may want to retrieve a virtual machine&#8217;s future state, after boot-up. The <code>get</code> method of the service that manages a virtual machine supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/get/parameters/next_run">next_run</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving a Virtual Machine&#8217;s <code>next_run</code> State</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the representation of the virtual machine; not the</span>
<span style="color:#777"># current one, but the one that will be used after the next</span>
<span style="color:#777"># boot:</span>
vm = vm_service.get(<span style="color:#606">next_run</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference</a> documentation of the software development kit for details.</p>
</div>
<div class="paragraph">
<p>If the object cannot be retrieved, the software development kit will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception, containing details of the failure. This will occur if you try to retrieve a non-existent object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The call to the <code>service locator</code> method never fails, even if the object does not exist, because the <code>service locator</code> method does not send a request to the server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following examples, the <code>service locator</code> method will succeed, while the <code>get</code> method will raise an exception:</p>
</div>
<div class="listingblock">
<div class="title">Locating the Service of Non-existent Virtual Machine: No Error</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages a virtual machine that does</span>
<span style="color:#777"># not exist. This will succeed.</span>
vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">non_existent_VM</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Retrieving a Non-existent Virtual Machine Service: Error</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the virtual machine. This will raise an exception.</span>
vm = vm_service.get</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="list"><code>List</code></h5>
<div class="paragraph">
<p>The <code>list</code> method retrieves the representations of multiple objects in a collection.</p>
</div>
<div class="listingblock">
<div class="title">Listing a Collection of Virtual Machines</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages the collection of virtual</span>
<span style="color:#777"># machines:</span>
vms_service = system_service.vms_service
vms = vms_service.list</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is a Ruby array containing the instances of the corresponding types. In the above example, the response is a list of instances of the Ruby class <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a>.</p>
</div>
<div class="paragraph">
<p>The <code>list</code> method of some services supports additional parameters.</p>
</div>
<div class="paragraph">
<p>For example, almost all of the top-level collections support a <code>search</code> parameter to filter the results, and a <code>max</code> parameter to limit the number of results returned by the server.</p>
</div>
<div class="listingblock">
<div class="title">Listing Ten Virtual Machines Called "my*"</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vms = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=my*</span><span style="color:#710">'</span></span>, <span style="color:#606">max</span>: <span style="color:#00D">10</span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all the list methods support the <code>search</code> or <code>max</code> parameters. Some list methods may support other parameters. See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference</a> documentation for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the list of results is empty, the returned value will be an empty Ruby array. It will never be <code>nil</code>.</p>
</div>
<div class="paragraph">
<p>If the list of results cannot be retrieved, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure.</p>
</div>
</div>
<div class="sect4">
<h5 id="add"><code>Add</code></h5>
<div class="paragraph">
<p><code>Add</code> methods add new elements to collections. They receive an instance of the relevant type describing the object to add, send the request to add it, and return an instance of the type describing the added object.</p>
</div>
<div class="listingblock">
<div class="title">Adding a New Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
    <span style="color:#606">cluster</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
    },
    <span style="color:#606">template</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
    }
  )
)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ruby object returned by the <code>add</code> method is an instance of the relevant type. It is not a service, just a container of data. In the above example, the returned object is an instance of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to perform an action on the virtual machine you just added, you must locate the service that manages it and call the service locator:</p>
</div>
<div class="listingblock">
<div class="title">Starting a New Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  ...
)

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Start the virtual machine:</span>
vm_service.start</code></pre>
</div>
</div>
<div class="paragraph">
<p>The creation of most objects is an asynchronous task. For example, if you create a new virtual machine, the <code>add</code> method will return the virtual machine before the virtual machine is completely created and ready to be used. You should poll the status of the object until it is completely created. For a virtual machine that means checking until the status is <code>DOWN</code>.</p>
</div>
<div class="paragraph">
<p>The recommended approach is to create a virtual machine, locate the service that manages the new virtual machine, and retrieve the status repeatedly until the virtual machine status is <code>DOWN</code>, indicating that all the disks have been created.</p>
</div>
<div id="Adding_Virtual_Machine_Locating_Its_Service_and_Retrieving_Status" class="listingblock">
<div class="title">Adding a Virtual Machine, Locating Its Service, and Retrieving Its Status</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  ...
)

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Wait until the virtual machine is DOWN, indicating that all the</span>
<span style="color:#777"># disks have been created:</span>
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  vm = vm_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> vm.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">DOWN</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the object cannot be created, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure. It will never return <code>nil</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="update"><code>Update</code></h5>
<div class="paragraph">
<p><code>Update</code> methods update existing objects. They receive an instance of the relevant type describing the update to perform, send the request to update it, and return an instance of the type describing the updated object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ruby object returned by this update method is an instance of the relevant type. It is not a service, just a container of data. In this particular example the returned object will be an instance of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, the <code>service locator</code> method locates the service managing the virtual machine and the <code>update</code> method updates its name:</p>
</div>
<div class="listingblock">
<div class="title">Updating a Virtual Machine Name</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the virtual machine and the service that</span>
<span style="color:#777"># manages it:</span>
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>).first
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Update the name:</span>
updated_vm = vms_service.update(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">newvm</span><span style="color:#710">'</span></span>
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you update an object, update only the attributes you want to update:</p>
</div>
<div class="listingblock">
<div class="title">Updating a Selected Attribute of a Virtual Machine (Recommended)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm = vm_service.get
vm.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">newvm</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not update the entire object:</p>
</div>
<div class="listingblock">
<div class="title">Updating All Attributes of a Virtual Machine (Not Recommended)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the current representation:</span>
vms_service.update(vm)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updating all attributes of the virtual machine is a waste of resources and can introduce unexpected bugs on the server side.</p>
</div>
<div class="paragraph">
<p><code>Update</code> methods of some services support additional parameters that can be used to control how or what to update. For example, you may want to update the memory of a virtual machine, not in its current state, but the next time it is started. The <code>update</code> method of the service that manages a virtual machine supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/update/parameters/next_run">next_run</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Updating the Memory of a Virtual Machine at Next Run</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm = vm_service.update(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
  ),
  <span style="color:#606">next_run</span>: <span style="color:#069">true</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the update cannot be performed, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure. It will never return <code>nil</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="remove"><code>Remove</code></h5>
<div class="paragraph">
<p><code>Remove</code> methods remove existing objects. They normally do not support parameters because they are methods of services that manage single objects, and the service already knows what object to remove.</p>
</div>
<div class="listingblock">
<div class="title">Removing a Virtual Machine with Identifier <code>123</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)
vms_service.remove</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some <code>remove</code> methods support parameters that control how or what to remove. For example, it is possible to remove a virtual machine while preserving its disks, using the <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/remove">detach_only</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Removing a Virtual Machine while Preserving Disks</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.remove(<span style="color:#606">detach_only</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>remove</code> method returns <code>nil</code> if the object is removed successfully. It does not return the removed object.</p>
</div>
<div class="paragraph">
<p>If the object cannot be removed, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure.</p>
</div>
</div>
<div class="sect4">
<h5 id="additional-actions">Additional Actions</h5>
<div class="paragraph">
<p>There are additional action methods, apart from the methods described above. The service that manages a virtual machine has methods to start and stop it.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.start</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some action methods include parameters that modify the operation. For example, the <code>start</code> method supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/start/parameters/use_cloud_init">use_cloud_init</a> parameter.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Virtual Machine with Cloud-Init</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.start(<span style="color:#606">use_cloud_init</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most action methods return <code>nil</code> when they succeed, and raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> when they fail. Some action methods, however, return values. For example, the service that manages storage domains has an <strong>is_attached</strong> action method that checks whether the storage domain is already attached to a data center. The <strong>is_attached</strong> action method returns a Boolean value:</p>
</div>
<div class="listingblock">
<div class="title">Checking for Attached Storage Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">sds_service = system_service.storage_domains_service
sd_service = sds_service.storage_domain_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">if</span> sd_service.is_attached
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference documentation</a> of the software development kit to see the action methods supported by each service, their parameters, and return values.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Ruby_Examples">3. Ruby Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Connecting_to_the_server">3.1. Connecting to the {virt-product-fullname} {engine-name}</h3>
<div class="paragraph">
<p>The <code>Connection</code> class is the entry point of the software development kit. It provides access to the services of the {virt-product-fullname} {engine-name}'s REST API.</p>
</div>
<div class="paragraph">
<p>The parameters of the <code>Connection</code> class are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>url</code> - Base URL of the {virt-product-fullname} {engine-name} API</p>
</li>
<li>
<p><code>username</code></p>
</li>
<li>
<p><code>password</code></p>
</li>
<li>
<p><code>ca_file</code> - PEM file containing the trusted CA certificates. The <code>ca.pem</code> file is required when connecting to a server protected by TLS. If you do not specify the <code>ca_file</code>, the system-wide CA certificate store is used.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Connecting to the {virt-product-fullname} {engine-name}</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby">connection = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Connection</span>.new(
  <span style="color:#606">url</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https://engine.example.com/ovirt-engine/api</span><span style="color:#710">'</span></span>,
  <span style="color:#606">username</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">admin@internal</span><span style="color:#710">'</span></span>,
  <span style="color:#606">password</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">...</span><span style="color:#710">'</span></span>,
  <span style="color:#606">ca_file</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ca.pem</span><span style="color:#710">'</span></span>,
)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The connection holds critical resources, including a pool of HTTP connections to the server and an authentication token. You must free these resources when they are no longer in use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>connection.close</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The connection, and all the services obtained from it, cannot be used after the connection has been closed.</p>
</div>
<div class="paragraph">
<p>If the connection fails, the software development kit will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception, containing details of the failure.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection:initialize">Connection:initialize</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Listing_data_centers">3.2. Listing Data Centers</h3>
<div class="paragraph">
<p>This Ruby example lists the data centers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Get the reference to the service that manages the</span>
<span style="color:#777"># collection of data centers:</span>
dcs_service = system_service.data_centers_service

<span style="color:#777"># Retrieve the list of data centers and for each one</span>
<span style="color:#777"># print its name:</span>
dcs = dcs_service.list
dcs.each <span style="color:#080;font-weight:bold">do</span> |dc|
  puts dc.name
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In an environment with only the Default data center, the example outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Default</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/DataCentersService:list" class="bare">http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/DataCentersService:list</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Listing_clusters">3.3. Listing Clusters</h3>
<div class="paragraph">
<p>This Ruby example lists the clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Get the reference to the service that manages the</span>
<span style="color:#777"># collection of clusters:</span>
cls_service = system_service.clusters_service

<span style="color:#777"># Retrieve the list of clusters and for each one</span>
<span style="color:#777"># print its name:</span>
cls = cls_service.list
cls.each <span style="color:#080;font-weight:bold">do</span> |cl|
  puts cl.name
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In an environment with only the Default cluster, the example outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Default</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/ClustersService:list">ClustersService:list</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Listing_logical_networks">3.4. Listing Logical Networks</h3>
<div class="paragraph">
<p>This Ruby example lists the logical networks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Get the reference to the service that manages the</span>
<span style="color:#777"># collection of networks:</span>
nws_service = system_service.networks_service

<span style="color:#777"># Retrieve the list of clusters and for each one</span>
<span style="color:#777"># print its name:</span>
nws = nws_service.list
nws.each <span style="color:#080;font-weight:bold">do</span> |nw|
  puts nw.name
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In an environment with only the default management network, the example outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ovirtmgmt</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/NetworksService:list">NetworksService:list</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Listing_hosts">3.5. Listing Hosts</h3>
<div class="paragraph">
<p>This Ruby example lists the hosts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Get the reference to the service that manages the</span>
<span style="color:#777"># collection of hosts:</span>
host_service = system_service.hosts_service

<span style="color:#777"># Retrieve the list of hosts and for each one</span>
<span style="color:#777"># print its name:</span>
host = host_service.list
host.each <span style="color:#080;font-weight:bold">do</span> |host|
  puts host.name
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In an environment with only one attached host (<code>Atlantic</code>) the example outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Atlantic</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/HostsService#list-instance_method">HostsService:list-instance_method</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Listing_ISO_files_in_ISO_storage_domain">3.6. Listing ISO Files in the ISO Storage Domain</h3>
<div class="paragraph">
<p>This Ruby example lists the ISO files in the ISO storage domain, <code>myiso</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Find the service that manages the collection of storage domains:</span>
sds_service = system_service.storage_domains_service

<span style="color:#777"># Find the ISO storage domain:</span>
sd = sds_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myiso</span><span style="color:#710">'</span></span>).first

<span style="color:#777"># Find the service that manages the ISO storage domain:</span>
sd_service = sds_service.storage_domain_service(sd.id)

<span style="color:#777"># Find the service that manages the collection of files available in the storage domain:</span>
files_service = sd_service.files_service

<span style="color:#777"># List the names of the files. Note that the name of the .iso file is contained</span>
<span style="color:#777"># in the `id` attribute.</span>
files = files_service.list
files.each <span style="color:#080;font-weight:bold">do</span> |file|
  puts file.id
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4%2FFilesService:list">FilesService:list</a>.</p>
</div>
<div class="paragraph">
<p>If you do not know the name of the ISO storage domain, this Ruby example retrieves all the ISO storage domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the ISO storage domain:</span>
iso_sds = sds_service.list.select { |sd| sd.type == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomainType</span>::<span style="color:#036;font-weight:bold">ISO</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/StorageDomainsService:list">StorageDomainsService:list</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_NFS_storage_domain">3.7. Creating an NFS Storage Domain</h3>
<div class="paragraph">
<p>This Ruby example adds an NFS storage domain.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Get the reference to the storage domains service:</span>
sds_service = connection.system_service.storage_domains_service

<span style="color:#777"># Create a new NFS data storage domain:</span>
sd = sds_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomain</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mydata</span><span style="color:#710">'</span></span>,
    <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My data</span><span style="color:#710">'</span></span>,
    <span style="color:#606">type</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomainType</span>::<span style="color:#036;font-weight:bold">DATA</span>,
    <span style="color:#606">host</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myhost</span><span style="color:#710">'</span></span>
    },
    <span style="color:#606">storage</span>: {
      <span style="color:#606">type</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageType</span>::<span style="color:#036;font-weight:bold">NFS</span>,
      <span style="color:#606">address</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">server0.example.com</span><span style="color:#710">'</span></span>,
      <span style="color:#606">path</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/nfs/ovirt/40/mydata</span><span style="color:#710">'</span></span>
    }
  )
)

<span style="color:#777"># Wait until the storage domain is unattached:</span>
sd_service = sds_service.storage_domain_service(sd.id)
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  sd = sd_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> sd.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomainStatus</span>::<span style="color:#036;font-weight:bold">UNATTACHED</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/StorageDomainsService:add" class="bare">http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/StorageDomainsService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="attaching-a-storage-domain-to-a-data-center">3.8. Attaching a Storage Domain to a Data Center</h3>
<div class="paragraph">
<p>This Ruby example attaches an existing NFS storage domain, <code>mydata</code>, to an existing data center, <code>mydc</code>. This example is used to attach both data and ISO storage domains.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the root of the services tree:</span>
system_service = connection.system_service

<span style="color:#777"># Locate the service that manages the storage domains and use it to</span>
<span style="color:#777"># search for the storage domain:</span>
sds_service = system_service.storage_domains_service
sd = sds_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=mydata</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the data centers and use it to</span>
<span style="color:#777"># search for the data center:</span>
dcs_service = system_service.data_centers_service
dc = dcs_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=mydc</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the data center where you want to</span>
<span style="color:#777"># attach the storage domain:</span>
dc_service = dcs_service.data_center_service(dc.id)

<span style="color:#777"># Locate the service that manages the storage domains that are attached</span>
<span style="color:#777"># to the data centers:</span>
attached_sds_service = dc_service.storage_domains_service

<span style="color:#777"># Use the &quot;add&quot; method of service that manages the attached storage</span>
<span style="color:#777"># domains to attach it:</span>
attached_sds_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomain</span>.new(
    <span style="color:#606">id</span>: sd.id
  )
)

<span style="color:#777"># Wait until the storage domain is active:</span>
attached_sd_service = attached_sds_service.storage_domain_service(sd.id)
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  sd = attached_sd_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> sd.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">StorageDomainStatus</span>::<span style="color:#036;font-weight:bold">ACTIVE</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/StorageDomainsService:add" class="bare">http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/StorageDomainsService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_virtual_machine">3.9. Creating a Virtual Machine</h3>
<div class="paragraph">
<p>This Ruby example creates a virtual machine. This example uses a hash with symbols and nested hashes as their values. Another method, more verbose, is to use the constructors of the corresponding objects directly. See <a href="#Creating_a_Virtual_Machine_Instance_with_Attributes">Creating a Virtual Machine Instance with Attributes</a> for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the &quot;vms&quot; service:</span>
vms_service = connection.system_service.vms_service

<span style="color:#777"># Use the &quot;add&quot; method to create a new virtual machine:</span>
vms_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
    <span style="color:#606">cluster</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
    },
    <span style="color:#606">template</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Blank</span><span style="color:#710">'</span></span>
    }
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>After creating a virtual machine, it is recommended to <a href="#Adding_Virtual_Machine_Locating_Its_Service_and_Retrieving_Status">poll the virtual machine&#8217;s status</a>, to ensure that all the disks have been created.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmsService:add">VmsService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_vNIC_profile">3.10. Creating a vNIC Profile</h3>
<div class="paragraph">
<p>This Ruby example creates a vNIC profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the root of the tree of services:</span>
system_service = connection.system_service

<span style="color:#777"># Find the network where you want to add the profile. There may be multiple</span>
<span style="color:#777"># networks with the same name (in different data centers, for example).</span>
<span style="color:#777"># Therefore, you must look up a specific network by name, in a specific data center.</span>
dcs_service = system_service.data_centers_service
dc = dcs_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=mydc</span><span style="color:#710">'</span></span>).first
networks = connection.follow_link(dc.networks)
network = networks.detect { |n| n.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mynetwork</span><span style="color:#710">'</span></span> }

<span style="color:#777"># Create the vNIC profile, with passthrough and port mirroring disabled:</span>
profiles_service = system_service.vnic_profiles_service
profiles_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VnicProfile</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myprofile</span><span style="color:#710">'</span></span>,
    <span style="color:#606">pass_through</span>: {
      <span style="color:#606">mode</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VnicPassThroughMode</span>::<span style="color:#036;font-weight:bold">DISABLED</span>,
    },
    <span style="color:#606">port_mirroring</span>: <span style="color:#069">false</span>,
    <span style="color:#606">network</span>: {
      <span style="color:#606">id</span>: network.id
    }
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VnicProfilesService:add">VnicProfilesService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_vNIC">3.11. Creating a vNIC</h3>
<div class="paragraph">
<p>To ensure that a newly created virtual machine has network access you must create and attach a vNIC.</p>
</div>
<div class="paragraph">
<p>This Ruby example creates a vNIC and attaches it to an existing virtual machine, <code>myvm</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the root of the tree of services:</span>
system_service = connection.system_service

<span style="color:#777"># Find the virtual machine:</span>
vms_service = system_service.vms_service
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>).first

<span style="color:#777"># In order to specify the network that the new NIC will be connected to, you must</span>
<span style="color:#777"># specify the identifier of the vNIC profile. However, there may be multiple</span>
<span style="color:#777"># profiles with the same name (for different data centers, for example), so first</span>
<span style="color:#777"># you must find the networks that are available in the cluster that the</span>
<span style="color:#777"># virtual machine belongs to.</span>
cluster = connection.follow_link(vm.cluster)
networks = connection.follow_link(cluster.networks)
network_ids = networks.map(&amp;<span style="color:#A60">:id</span>)

<span style="color:#777"># Now that you know what networks are available in the cluster, you can select a</span>
<span style="color:#777"># vNIC profile that corresponds to one of those networks, and has the</span>
<span style="color:#777"># name that you want to use. The system automatically creates a vNIC</span>
<span style="color:#777"># profile for each network, with the same name as the network.</span>
profiles_service = system_service.vnic_profiles_service
profiles = profiles_service.list
profile = profiles.detect { |p| network_ids.include?(p.network.id) &amp;&amp; p.name == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myprofile</span><span style="color:#710">'</span></span> }

<span style="color:#777"># Locate the service that manages the network interface cards collection of the</span>
<span style="color:#777"># virtual machine:</span>
nics_service = vms_service.vm_service(vm.id).nics_service

<span style="color:#777"># Add the new network interface card:</span>
nics_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Nic</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mynic</span><span style="color:#710">'</span></span>,
    <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My network interface card</span><span style="color:#710">'</span></span>,
    <span style="color:#606">vnic_profile</span>: {
      <span style="color:#606">id</span>: profile.id
    }
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmsService:add">VmsService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_virtual_disk">3.12. Creating a Virtual Disk</h3>
<div class="paragraph">
<p>To ensure that a newly created virtual machine has access to persistent storage you must create and attach a disk.</p>
</div>
<div class="paragraph">
<p>This Ruby example creates and attaches a virtual storage disk to a virtual machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Locate the virtual machines service and use it to find the virtual</span>
<span style="color:#777"># machine:</span>
vms_service = connection.system_service.vms_service
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the disk attachments of the virtual</span>
<span style="color:#777"># machine:</span>
disk_attachments_service = vms_service.vm_service(vm.id).disk_attachments_service

<span style="color:#777"># Use the &quot;add&quot; method of the disk attachments service to add the disk.</span>
<span style="color:#777"># Note that the size of the disk, the `provisioned_size` attribute, is</span>
<span style="color:#777"># specified in bytes, so to create a disk of 10 GiB the value should</span>
<span style="color:#777"># be 10 * 2^30.</span>
disk_attachment = disk_attachments_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">DiskAttachment</span>.new(
    <span style="color:#606">disk</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mydisk</span><span style="color:#710">'</span></span>,
      <span style="color:#606">description</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">My disk</span><span style="color:#710">'</span></span>,
      <span style="color:#606">format</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">DiskFormat</span>::<span style="color:#036;font-weight:bold">COW</span>,
      <span style="color:#606">provisioned_size</span>: <span style="color:#00D">10</span> * <span style="color:#00D">2</span>**<span style="color:#00D">30</span>,
      <span style="color:#606">storage_domains</span>: [{
        <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mydata</span><span style="color:#710">'</span></span>
      }]
    },
    <span style="color:#606">interface</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">DiskInterface</span>::<span style="color:#036;font-weight:bold">VIRTIO</span>,
    <span style="color:#606">bootable</span>: <span style="color:#069">false</span>,
    <span style="color:#606">active</span>: <span style="color:#069">true</span>
  )
)

<span style="color:#777"># Wait until the disk status is OK:</span>
disks_service = connection.system_service.disks_service
disk_service = disks_service.disk_service(disk_attachment.disk.id)
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  disk = disk_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> disk.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">DiskStatus</span>::<span style="color:#036;font-weight:bold">OK</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/DiskAttachmentsService:add">DiskAttachmentsService:add</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Attaching_ISO_image_to_a_virtual_machine">3.13. Attaching an ISO Image to a Virtual Machine</h3>
<div class="paragraph">
<p>This Ruby example attaches a CD-ROM to a virtual machine and changes it to an ISO image in order to install the guest operating system.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="ruby"><span style="color:#777"># Get the reference to the &quot;vms&quot; service:</span>
vms_service = connection.system_service.vms_service

<span style="color:#777"># Find the virtual machine:</span>
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Locate the service that manages the CDROM devices of the VM:</span>
cdroms_service = vm_service.cdroms_service

<span style="color:#777"># List the first CDROM device:</span>
cdrom = cdroms_service.list[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the CDROM device you just found:</span>
cdrom_service = cdroms_service.cdrom_service(cdrom.id)

<span style="color:#777"># Change the CD of the VM to 'my_iso_file.iso'. By default this</span>
<span style="color:#777"># operation permanently changes the disk that is visible to the</span>
<span style="color:#777"># virtual machine after the next boot, but it does not have any effect</span>
<span style="color:#777"># on the currently running virtual machine. If you want to change the</span>
<span style="color:#777"># disk that is visible to the current running virtual machine, change</span>
<span style="color:#777"># the `current` parameter's value to `true`.</span>
cdrom_service.update(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Cdrom</span>.new(
    <span style="color:#606">file</span>: {
      <span style="color:#606">id</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CentOS-7-x86_64-DVD-1511.iso</span><span style="color:#710">'</span></span>
    }
  ),
  <span style="color:#606">current</span>: <span style="color:#069">false</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4%2FVmService:cdroms_service">VmService:cdroms_service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Detaching_a_virtual_disk">3.14. Detaching a Virtual Disk</h3>
<div class="paragraph">
<p>This Ruby example detaches a disk from a virtual machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the virtual machine:</span>
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>).first

<span style="color:#777"># Detach the first disk from the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)
attachments_service = vm_service.disk_attachments_service
attachment = attachments_service.list.first

<span style="color:#777"># Remove the attachment. The default behavior is that the disk is detached</span>
<span style="color:#777"># from the virtual machine, but not deleted from the system. If you wish to</span>
<span style="color:#777"># delete the disk, change the `detach_only` parameter to `false`.</span>
attachment.remove(<span style="color:#606">detach_only</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmService:disk_attachments_service">VmService:disk_attachments_service</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Starting_a_virtual_machine">3.15. Starting a Virtual Machine</h3>
<div class="paragraph">
<p>This Ruby example starts a virtual machine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Get the reference to the &quot;vms&quot; service:</span>
vms_service = connection.system_service.vms_service

<span style="color:#777"># Find the virtual machine:</span>
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Locate the service that manages the virtual machine, as that is where</span>
<span style="color:#777"># the action methods are defined:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Call the &quot;start&quot; method of the service to start it:</span>
vm_service.start

<span style="color:#777"># Wait until the virtual machine status is UP:</span>
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  vm = vm_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> vm.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">UP</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmService:start">VmService:start</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Starting_a_virtual_machine_with_specific_boot_devices">3.16. Starting a Virtual Machine with Specific Boot Devices and Boot Order</h3>
<div class="paragraph">
<p>This Ruby example starts a virtual machine specifying the boot devices and boot order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the root of the tree of services:</span>
system_service = connection.system_service

<span style="color:#777"># Find the virtual machine:</span>
vms_service = system_service.vms_service
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>).first

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Start the virtual machine explicitly indicating the boot devices and order:</span>
vm_service.start(
  <span style="color:#606">vm</span>: {
    <span style="color:#606">os</span>: {
      <span style="color:#606">boot</span>: {
        <span style="color:#606">devices</span>: [
          <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">BootDevice</span>::<span style="color:#036;font-weight:bold">NETWORK</span>,
          <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">BootDevice</span>::<span style="color:#036;font-weight:bold">CDROM</span>
        ]
      }
    }
  }
)

<span style="color:#777"># Wait until the virtual machine is up:</span>
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  vm = vm_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> vm.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">UP</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/BootDevice">BootDevice</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Starting_a_virtual_machine_with_cloud-init">3.17. Starting a Virtual Machine with Cloud-Init</h3>
<div class="paragraph">
<p>This Ruby example starts a virtual machine using the Cloud-Init tool to set the <code>root</code> password and network configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># Find the virtual machine:</span>
vms_service = connection.system_service.vms_service
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>)[<span style="color:#00D">0</span>]

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Create a cloud-init script to execute in the</span>
<span style="color:#777"># deployed virtual machine. The script must be correctly</span>
<span style="color:#777"># formatted and indented because it uses YAML.</span>
my_script = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">
write_files:
  - content: |
      Hello, world!
    path: /tmp/greeting.txt
    permissions: '0644'
</span><span style="color:#710">&quot;</span></span>

<span style="color:#777"># Start the virtual machine, enabling cloud-init and providing the</span>
<span style="color:#777"># password for the `root` user and the network configuration:</span>
vm_service.start(
  <span style="color:#606">use_cloud_init</span>: <span style="color:#069">true</span>,
  <span style="color:#606">vm</span>: {
    <span style="color:#606">initialization</span>: {
      <span style="color:#606">user_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">root</span><span style="color:#710">'</span></span>,
      <span style="color:#606">root_password</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">redhat123</span><span style="color:#710">'</span></span>,
      <span style="color:#606">host_name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm.example.com</span><span style="color:#710">'</span></span>,
      <span style="color:#606">nic_configurations</span>: [
        {
          <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">eth0</span><span style="color:#710">'</span></span>,
          <span style="color:#606">on_boot</span>: <span style="color:#069">true</span>,
          <span style="color:#606">boot_protocol</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">BootProtocol</span>::<span style="color:#036;font-weight:bold">STATIC</span>,
          <span style="color:#606">ip</span>: {
            <span style="color:#606">version</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">IpVersion</span>::<span style="color:#036;font-weight:bold">V4</span>,
            <span style="color:#606">address</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">192.168.0.100</span><span style="color:#710">'</span></span>,
            <span style="color:#606">netmask</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">255.255.255.0</span><span style="color:#710">'</span></span>,
            <span style="color:#606">gateway</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">192.168.0.1</span><span style="color:#710">'</span></span>
          }
        }
      ],
      <span style="color:#606">dns_servers</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">192.168.0.1 192.168.0.2 192.168.0.3</span><span style="color:#710">'</span></span>,
      <span style="color:#606">dns_search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">example.com</span><span style="color:#710">'</span></span>,
      <span style="color:#606">custom_script</span>: my_script
    }
  }
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmService:start">VmService:start</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Checking_system_events">3.18. Checking System Events</h3>
<div class="paragraph">
<p>This Ruby example retrieves logged system events.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#777"># In order to ensure that no events are lost, it is recommended to write</span>
<span style="color:#777"># the index of the last processed event, in persistent storage.</span>
<span style="color:#777"># Here, it is stored in a file called `index.txt`. In a production environment,</span>
<span style="color:#777"># it will likely be stored in a database.</span>
<span style="color:#036;font-weight:bold">INDEX_TXT</span> = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">index.txt</span><span style="color:#710">'</span></span>.freeze

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">write_index</span>(index)
  <span style="color:#036;font-weight:bold">File</span>.open(<span style="color:#036;font-weight:bold">INDEX_TXT</span>, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">w</span><span style="color:#710">'</span></span>) { |f| f.write(index.to_s) }
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">read_index</span>
  <span style="color:#080;font-weight:bold">return</span> <span style="color:#036;font-weight:bold">File</span>.read(<span style="color:#036;font-weight:bold">INDEX_TXT</span>).to_i <span style="color:#080;font-weight:bold">if</span> <span style="color:#036;font-weight:bold">File</span>.exist?(<span style="color:#036;font-weight:bold">INDEX_TXT</span>)
  <span style="color:#069">nil</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># This is the function that is called to process the events. It prints</span>
<span style="color:#777"># the identifier and description of each event.</span>
<span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">process_event</span>(event)
  puts(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>event.id<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> - </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>event.description<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># Find the root of the tree of services:</span>
system_service = connection.system_service

<span style="color:#777"># Find the service that manages the collection of events:</span>
events_service = system_service.events_service

<span style="color:#777"># If no index is stored yet, retrieve the last event and start with it.</span>
<span style="color:#777"># Events are ordered by index, in ascending order. `max=1` retrieves only one event,</span>
<span style="color:#777"># the last event.</span>
<span style="color:#080;font-weight:bold">unless</span> read_index
  events = events_service.list(<span style="color:#606">max</span>: <span style="color:#00D">1</span>)
  <span style="color:#080;font-weight:bold">unless</span> events.empty?
    first = events.first
    process_event(first)
    write_index(first.id.to_i)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777"># This loop retrieves the events, always starting from the last index. It waits</span>
<span style="color:#777"># before repeating. The `from` parameter specifies that you want to retrieve</span>
<span style="color:#777"># events that are newer than the last index that was processed. Note: the `max`</span>
<span style="color:#777"># parameter is not used, so that all pending events will be retrieved.</span>
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  events = events_service.list(<span style="color:#606">from</span>: read_index)
  events.each <span style="color:#080;font-weight:bold">do</span> |event|
    process_event(event)
    write_index(event.id.to_i)
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4%2FEventsService:list">EventsService:list</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ovirt-legal-notice">Appendix A: Legal notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certain portions of this text first appeared in <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/ruby_sdk_guide/index">Red Hat Virtualization 4.4 Ruby SDK Guide</a>. Copyright  2022 Red Hat, Inc. Licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 Unported License</a>.</p>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3119/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3119/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3119/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3119/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/doc-Ruby_SDK_Guide/&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/documentation/doc-Ruby_SDK_Guide/index.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
