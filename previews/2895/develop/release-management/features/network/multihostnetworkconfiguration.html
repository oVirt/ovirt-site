<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MultiHostNetworkConfiguration | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="MultiHostNetworkConfiguration" />
<meta name="author" content="Dan Kenigsberg" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2895/develop/release-management/features/network/multihostnetworkconfiguration.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2895/develop/release-management/features/network/multihostnetworkconfiguration.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MultiHostNetworkConfiguration" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Dan Kenigsberg" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Dan Kenigsberg"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"MultiHostNetworkConfiguration","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2895/images/logo.svg"},"name":"Dan Kenigsberg"},"url":"https://ovirt.github.io/ovirt-site/previews/2895/develop/release-management/features/network/multihostnetworkconfiguration.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2895/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2895/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2895/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2895/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2895/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2895/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2895/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2895/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2895/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2895/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2895/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2895/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2895/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2895/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2895/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2895/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2895/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2895/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2895/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2895/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2895/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2895/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2895//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2895//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2895/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2895/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2895/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2895/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2895/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yedidyah Bar David</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/03383bfa9bb468b9f0264d74539b19d0?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/03383bfa9bb468b9f0264d74539b19d0?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Michael Kolesnic</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Moti Asayag</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d2a1475a4145a459ac3565cc97fa39f5?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d2a1475a4145a459ac3565cc97fa39f5?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Pavlik</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2895/documentation/'>Documentation is available here.</a></div>

<h2 id="multi-host-network-configuration">Multi-Host Network Configuration</h2>

<h3 id="summary">Summary</h3>

<p>The feature allows the administrator to modify a network (i.e. vlan-id, mtu) which is already provisioned by the hosts and to apply the network changes to all of the hosts within the data-center to which the network is assigned.
The feature will be enabled for 3.1 data-centers and above, regardless cluster level in order to avoid inconsistency between hosts network configuration in various clusters.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Moti Asayag</li>
  <li>Email: <a href="mailto:masayag@redhat.com">masayag@redhat.com</a></li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>Ready</li>
  <li>Planned for ovirt-engine-3.4</li>
  <li>Last updated on – by</li>
</ul>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>Having this feature simplifies significantly the maintenance of hosts within the system:
It reduces the amount of actions required to reflect a logical network definition change by the administrator (a single ‘Setup Network’ action per host).
In addition, the feature reduces the risk of having hosts network configuration not synchronized with the logical network definition.</p>

<h3 id="detailed-description">Detailed Description</h3>

<h4 id="phase-1">Phase 1</h4>

<p>Updating a network will trigger sync the change to all of the hosts: The ‘UpdateNetworkCommand’ will be changed to a non-transactive. Its execution will be consisted of 2 steps:</p>
<h1 id="updating-the-network-logical-definition-on-the-db-and-handles-vnic-profile-accordingly-remove-all-if-network-changed-to-non-vm-network-will-run-in-a-new-transaction-scope">Updating the network logical definition on the DB and handles vnic profile accordingly (remove all if network changed to non-vm network) will run in a new transaction scope.</h1>

<ol>
  <li>Applying the network changes by executing a ‘setup networks’ command for each host which the network is assigned to.</li>
  <li>Save the network changes to the host upon a successful ‘setup networks’</li>
</ol>

<p>The Setup Networks command will use the ‘sync network’ for the modified network.
A dedicated multiple action runner will be added to run the ‘Setup Networks’ commands in parallel.
Currently, Updating the network is blocked for network which is used by VMs. As part of the feature we should permit the change in these cases:</p>

<ul>
  <li>Networks that aren’t used by VMs</li>
  <li>No running VMs using the network and the change doesn’t include modifying a VM network to a non-VM network.</li>
</ul>

<p>The feature will be enabled only for 3.1 data-center and above since it relies on the ‘Setup Networks’ which was introduced in 3.1. Renaming of network which is used by the hosts, vms or templates will be blocked, since it will make the network on hosts as “unmanaged” and leave the vm/templates without a required network.</p>

<ol>
  <li>This will revert the fix for bug <a href="https://bugzilla.redhat.com/show_bug.cgi?id=909820">Don’t block removing/updating network “used” by host</a></li>
  <li>The user should create a new network instead of renaming a used network.</li>
</ol>

<h4 id="phase-2">Phase 2</h4>

<ol>
  <li>The same behaviour will be added to ‘Remove Network’ action as well in a similar manner:
    <ul>
      <li>Removing a network from the system will attempt to remove it from all of the hosts it is defined on.</li>
    </ul>
  </li>
</ol>

<h4 id="user-experience">User Experience</h4>

<p>The ‘Edit Network’ action will attempt to configure the network on all of the eligible hosts. No changes are required to the UI.</p>

<h4 id="rest">REST</h4>

<p>No changes are required to the api.</p>

<h4 id="events">Events</h4>

<p>The following events will be logged for the command when applied to all hosts:</p>

<ol>
  <li>For partial hosts update: “${TotalUpdatedHosts} are planned to be updated, however only ${ActualUpdatedHosts} could be updated.”</li>
  <li>If a ‘setup networks’ action is not supported by data center version: “${Network} network changes will not be applied to data center: ${UnsupportedDCName} due to unsupported data center version.”</li>
  <li>For each host being updated:
    <ol>
      <li>“1/3 applying network ${Network} on host ${Host}”</li>
      <li>“2/3 applying network ${Network} on host ${Host}”</li>
      <li>“3/3 applying network ${Network} on host ${Host}”</li>
    </ol>
  </li>
</ol>

<p>And for their completion:</p>

<ol>
  <li>“1/3 network ${Network} were updated on host ${Host}”</li>
  <li>“2/3 failed to update ${Network} changes on host ${Host} due to: ${Failure}”</li>
  <li>“3/3 network ${Network} were updated on host ${Host}”</li>
</ol>

<ul>
  <li>All the actions should contain the same correlation-id.</li>
</ul>

<!-- -->

<ul>
  <li>UpdateNetworkCommand can-do-action messages should be modify to reflect the proper message:
    <ul>
      <li>Changing A vm network to a non-vm network is not permitted while VMs or templates are using the VM.</li>
      <li>Changing A vm network properties while running VMs are using it is not permitted.</li>
      <li>Renaming a network which is configured on hosts is not supported.</li>
    </ul>
  </li>
</ul>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>The feature is purely engine-side related. It doesn’t depended on any other package.
A reuse of a mass-operations on host should be consider for network labels.</p>

<h3 id="testing">Testing</h3>

<p>To test the feature, a setup should include at least one host within the data-center having a network ‘red’ attached to on of its interfaces.</p>

<ol>
  <li>Edit the logical network definition of network ‘red’ (i.e. change vlan-id or any property but its name)</li>
  <li>Approve the command.</li>
  <li>Verify network ‘red’ was modified correctly on the relevant data-center’s hosts.</li>
</ol>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2895/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2895/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2895/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2895/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/multihostnetworkconfiguration.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/multihostnetworkconfiguration.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
