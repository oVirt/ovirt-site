<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Snapshots Overview | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Snapshots Overview" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2968/develop/release-management/features/storage/snapshots-overview.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2968/develop/release-management/features/storage/snapshots-overview.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Snapshots Overview" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Snapshots Overview","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2968/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2968/develop/release-management/features/storage/snapshots-overview.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2968/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2968/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2968/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2968/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2968/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2968/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2968/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2968/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2968/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2968/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2968/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2968/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2968/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2968/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2968/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2968/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2968/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2968/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2968/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2968/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2968/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2968/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2968//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2968//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2968/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2968/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2968/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2968/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2968/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Daniel Erez">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Daniel Erez</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2968/documentation/'>Documentation is available here.</a></div>

<h1 id="snapshots-overview">Snapshots Overview</h1>

<h2 id="summary">Summary</h2>

<p>Snapshots overview and management in context of a storage domain.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Daniel Erez (Derez)</li>
  <li>Email: <a href="mailto:derez@redhat.com">derez@redhat.com</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Target Release: 3.5</li>
  <li>Status: work in progress</li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<ul>
  <li>Improving the display of storage consumption details in order to identify which entities (disks/snapshots) could be removed in order to free up space.</li>
  <li>Ability to remove a specific disk from a snapshot (instead of to current support which forces deletion of the entire VM snapshot).</li>
  <li>Ability to remove disks snapshots in storage domain context; i.e. merging a specified set of snapshots in order the allow regaining space on a storage domain.</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>Currently, only a VM snapshot removal is supported - i.e. removing snapshots of disks requires the removal of the entire set of disks of the VM snapshot. Hence, in order to further decouple disks snapshots from VM snapshots, this proposed feature adds a new functionality of removing disks from snapshots. The UI will expose a flattened list of disks snapshots that reside on a specific storage domain in a new sub-tab in which, the new action of removal would be available.</p>

<h2 id="ui">UI</h2>

<h3 id="sub-tabs-concept">Sub-Tabs concept</h3>

<h4 id="storage---snapshots-sub-tab">Storage -&gt; Snapshots Sub-Tab</h4>

<p><img src="/ovirt-site/previews/2968/images/wiki/Storage_snapshots_subtab.png" alt="" title="storage snapshots subtab sketch" /></p>

<h4 id="future-work-storage-resources-usage-sub-tab-disks-active-volumes--snapshots--free-space">[Future Work?] Storage Resources Usage Sub-Tab [Disks (active volumes) / Snapshots / Free space]</h4>

<p><img src="/ovirt-site/previews/2968/images/wiki/Storage_resources_usage_subtab.png" alt="" title="storage resources usage subtab sketch" /></p>

<h3 id="deprecated-manage-snapshots-concept">[DEPRECATED] Manage Snapshots concept</h3>

<p>The solution is being neglected in favor of the sub-tabs concept as removing snapshot disks (merging) is a long operation; i.e. sub-tabs is the way to go when status indication is needed. Furthermore, since the interesting operation on snapshots in context of storage is merging, having a dedicate dialog seems redundant.</p>

<h4 id="deprecated-manage-snapshots-dialog">[DEPRECATED] Manage Snapshots Dialog</h4>

<p><img src="/ovirt-site/previews/2968/images/wiki/manage_snapshots_dialog_sketch.png" alt="" title="manage snapshots dialog sketch" /></p>

<h2 id="rest-api">REST-API</h2>

<p>Introducing new functionality of deleting a disk from a snapshot.</p>

<h3 id="get-disk-snapshots-by-storage-domain">Get disk snapshots by storage domain</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /api/storagedomains/{storage_id}/disksnapshots
</code></pre></div></div>

<h3 id="delete-a-disk-snapshot-from-storage-domain">Delete a disk snapshot from storage domain</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE /api/storagedomains/{storage_id}/disksnapshots/{image_id}
</code></pre></div></div>

<h3 id="delete-a-snapshot-disk">Delete a snapshot disk:</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>DELETE /api/vms/{vm_id}/snapshots/{snapshot_id}/disks/{disk_id}
</code></pre></div></div>

<h2 id="backend">Backend</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">RemoveDiskSnapshotsCommand</code> -&gt; <code class="language-plaintext highlighter-rouge">RemoveDiskSnapshotTaskHandler</code>:
    <ul>
      <li>A new command (and task handler) for removing specific images from snapshots.</li>
      <li>The command accepts as an argument a list of multiple images (of the same disk) to remove.</li>
      <li>The command utilizes <a href="/ovirt-site/previews/2968/develop/release-management/features/infra/serial-execution-of-asynchronous-tasks.html">SEAT</a> infrastructure for removing multiple images from a disk consecutively (as merging multiple snapshots of a specific disk must be done separably - to avoid volume chain breakage).</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">GetAllDiskSnapshotsByStorageDomainIdQuery</code>:
    <ul>
      <li>A new query for retrieving all snapshot disks that resides on a specified storage domain.</li>
      <li>Needed for fetching data of Storage -&gt; Snapshots sub-tab.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">DiskImage</code> -&gt; <code class="language-plaintext highlighter-rouge">vmSnapshotDescription</code> member:
    <ul>
      <li>Needed for displaying snapshot description in the UI (for easier image identification).</li>
    </ul>
  </li>
</ul>

<h2 id="vdsm">VDSM</h2>

<p>Already supported.</p>

<h2 id="open-issues">Open Issues</h2>

<ul>
  <li>Sorting in sub-tabs - wait for the generic client/server side sorting UI infrastructure?</li>
  <li>Display additional information about the snapshot/VM on item selection?</li>
  <li>Integrating a filter widget in sub-tab (as illustrated in manage snapshots dialog) or wait for a generic infrastructure?</li>
</ul>

<h2 id="testing">Testing</h2>

<ul>
  <li>Verify that the sub-tab displays all disk snapshots that reside on the selected storage domain.</li>
  <li>Verify removal of a single snapshots.</li>
  <li>Verify removal of multiple snapshots (of the same disk).</li>
  <li>Verify that removal of a snapshot that is attached to a running VM is blocked (until live snapshot merge is supportedâ€¦).</li>
  <li>Verify snapshot removal from REST-API.</li>
</ul>

<h2 id="future-work">Future Work</h2>

<ul>
  <li>Mentioned inline above.</li>
</ul>

<h2 id="related-bugzilla-items">Related Bugzilla Items:</h2>

<ul>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1086181">Bug 1086181 - OVIRT35 - [RFE] Snapshot Overview screen to manage storage</a></li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2968/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2968/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2968/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2968/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/snapshots-overview.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/storage/snapshots-overview.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
