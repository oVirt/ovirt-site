<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Proposal VDSM - Engine Data Statistics Retrieval | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Proposal VDSM - Engine Data Statistics Retrieval" />
<meta name="author" content="Dan Kenigsberg" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3109/develop/developer-guide/vdsm/proposal-vdsm-engine-data-statistics-retrieval.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3109/develop/developer-guide/vdsm/proposal-vdsm-engine-data-statistics-retrieval.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Proposal VDSM - Engine Data Statistics Retrieval" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Dan Kenigsberg" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Dan Kenigsberg"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Proposal VDSM - Engine Data Statistics Retrieval","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3109/images/logo.svg"},"name":"Dan Kenigsberg"},"url":"https://ovirt.github.io/ovirt-site/previews/3109/develop/developer-guide/vdsm/proposal-vdsm-engine-data-statistics-retrieval.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3109/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3109/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3109/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3109/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3109/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3109/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3109/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3109/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3109/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3109/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3109/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3109/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3109/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3109/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3109/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3109/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3109/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3109/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3109/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3109/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3109/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3109/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3109//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3109//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3109/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3109/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3109/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3109/develop/developer-guide/vdsm/">
              <span property="name">Vdsm</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dan Kenigsberg">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/469b83a72384b6c5feffe3f7ebc1e853?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/469b83a72384b6c5feffe3f7ebc1e853?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Vinzenz Feenstra">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Vinzenz Feenstra</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="proposal-vdsm---engine-data-statistics-retrieval">Proposal VDSM - Engine Data Statistics Retrieval</h1>

<p>== VDSM &lt;=&gt; Engine data retrieval optimization ==</p>

<h2 id="motivation">Motivation:</h2>

<p>Currently the oVirt Engine is polling a lot of data from VDSM every 15 seconds. This should be optimized and the amount of data requested should be more specific.</p>

<p>For each VM the data currently contains much more information than actually needed which blows up the size of the XML content quite big. We could optimize this by splitting the reply on the getVmStats based on the needs of the engine into different requests. For this reason Omer Frenkel and me have split up the data into parts based on their usage.</p>

<h2 id="changes">Changes</h2>

<h4 id="new-verbs">New Verbs</h4>

<h5 id="getallvmruntimestats">getAllVmRuntimeStats</h5>

<p>Get runtime information of all VMs
Returns for each VM a map with UUID and a value of:</p>

<ul>
  <li><strong>@cpuSys</strong> Ratio of CPU time spent by qemu on other than guest time</li>
  <li><strong>@cpuUser</strong> Ratio of CPU time spent by the guest VM</li>
  <li><strong>@memUsage</strong> The percent of memory in use by the guest</li>
  <li><strong>@elapsedTime</strong> The number of seconds that the VM has been running</li>
  <li><strong>@status</strong> The current status of the given VM</li>
  <li><strong>@statsAge</strong> The age of these statistics in seconds</li>
  <li><strong>@hashes</strong> Hashes of several statistics and information around VMs</li>
</ul>

<p>Hashes consists of:</p>

<ul>
  <li><strong>@info</strong> Hash for VmConfInfo data</li>
  <li><strong>@config</strong> Hash of the VM configuration XML</li>
  <li><strong>@status</strong> Hash of the VmStatusInfo data</li>
  <li><strong>@guestDetails</strong> Hash of the VmGuestDetails data</li>
</ul>

<h5 id="getvmstatus">getVmStatus</h5>

<p>Get status information about a list of VMs
Parameters:</p>

<ul>
  <li><strong>@vmIDs</strong> a list of UUIDs for VMs to query</li>
</ul>

<p>Returns for each VM in vmIDs a map with UUID and a value of:</p>

<ul>
  <li><strong>timeOffset</strong> The time difference from host to the VM in seconds</li>
  <li><strong>monitorResponse</strong> Indicates if the qemu monitor is responsive</li>
  <li><strong>clientIp</strong> The IP address of the client connected to the display</li>
  <li><strong>username</strong> the username associated with the current session</li>
  <li><strong>session</strong> The current state of user interaction with the VM</li>
  <li><strong>guestIPs</strong> A space separated string of assigned IPv4 addresses</li>
  <li><strong>pauseCode</strong> Indicates the reason a VM has been paused</li>
</ul>

<h5 id="getvmconfinfo">getVmConfInfo</h5>

<p>Get configuration information about a list of VMs
Parameters:</p>

<ul>
  <li><strong>@vmIDs</strong> a list of UUIDs for VMs to query</li>
</ul>

<p>Returns for each VM in vmIDs a map with UUID and a value of:</p>

<ul>
  <li><strong>acpiEnable</strong> Indicates if ACPI is enabled inside the VM</li>
  <li><strong>displayPort</strong> The port in use for unencrypted display data</li>
  <li><strong>displaySecurePort</strong> The port in use for encrypted display data</li>
  <li><strong>displayType</strong> The type of display in use</li>
  <li><strong>displayIp</strong> The IP address to use for accessing the VM display</li>
  <li><strong>pid</strong> The process ID of the underlying qemu process</li>
  <li><strong>vmType</strong> The type of VM</li>
  <li><strong>kvmEnable</strong> Indicates if KVM hardware acceleration is enabled</li>
  <li><strong>cdrom</strong> <strong><em>optional</em></strong> The path to an ISO image used in the VMâ€™s CD-ROM device</li>
  <li><strong>boot</strong> <strong><em>optional</em></strong> An alias for the type of device used to boot the VM</li>
</ul>

<h5 id="getallvmdevicestats">getAllVmDeviceStats</h5>

<p>VM device statistics containing information for getting statistics and SLA information
Returns for each VM a map with UUID and a value of:</p>

<ul>
  <li><strong>memoryStats</strong> Memory statistics as reported by the guest agent</li>
  <li><strong>balloonInfo</strong> Guest memory balloon information</li>
  <li><strong>disksUsage</strong> Info about mounted filesystems as reported by the agent</li>
  <li><strong>network</strong> Network bandwidth/utilization statistics</li>
  <li><strong>disks</strong> Disk bandwidth/utilization statistics</li>
</ul>

<h5 id="getvmguestdetails">getVmGuestDetails</h5>

<p>Get details from the guest OS from a list of VMs
Parameters:</p>

<ul>
  <li><strong>@vmIDs</strong> a list of UUIDs for VMs to query</li>
</ul>

<p>Returns for each VM in vmIDs a map with UUID and a value of:</p>

<ul>
  <li><strong>appsList</strong> A list of installed applications with their versions</li>
  <li><strong>netIfaces</strong> Network device address info as reported by the agent</li>
</ul>

<h4 id="usage">Usage</h4>

<p>Currently the engine is requesting currently every 3 seconds the vm list from each vdsm host and every 15 seconds all the data mentioned above for all VMs.</p>

<p>The change would be as follows:</p>

<p>The engine requests every 3 seconds getAllVmRuntimeStats from vdsm which will give the engine the most used data. If the engine has a mismatch of the hashes returned by getAllVmRuntimeStats it should request the data changed.</p>

<p>if hashes.info changed =&gt; request getVmConfInfo with all vmIDs on that host where the hash changed if hashes.status changed =&gt; request getVmStatus with all vmIDs on that host where the hash changed if hashes.guestDetails changed =&gt; request getVmGuestDetails with all vmIDs on that host where the hash changed</p>

<p>Request getAllVmDeviceStats periodically e.g. every 5 minutes, which should be sufficient for the DWH, in case it is not it could be even configurable.</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3109/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3109/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3109/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3109/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/vdsm/proposal-vdsm-engine-data-statistics-retrieval.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/developer-guide/vdsm/proposal-vdsm-engine-data-statistics-retrieval.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
