<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Vdsm Functional Tests | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Vdsm Functional Tests" />
<meta name="author" content="Mei Liu" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3185/develop/developer-guide/vdsm/functional-tests.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3185/develop/developer-guide/vdsm/functional-tests.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Vdsm Functional Tests" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Mei Liu" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Mei Liu"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Vdsm Functional Tests","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3185/images/logo.svg"},"name":"Mei Liu"},"url":"https://ovirt.github.io/ovirt-site/previews/3185/develop/developer-guide/vdsm/functional-tests.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3185/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3185/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3185/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3185/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3185/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3185/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3185/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3185/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3185/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/developer-guide/vdsm/">
              <span property="name">Vdsm</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/725f81624ed6cb5b423111ae98f64c62?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/725f81624ed6cb5b423111ae98f64c62?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Mei Liu">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Mei Liu</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9518fafe8a918bea7471374d2f2580dc?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9518fafe8a918bea7471374d2f2580dc?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Zheng Sheng Zhou">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Zheng Sheng Zhou</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<p>VDSM functional tests are to test the basic features on an actual running VDSM instance. It should covers the most frequently used APIs and common tasks, for example create storage domain, pool, image, volume and generate VM. The functional tests code is place under tests/functional sub-directory, and is installed to /usr/share/vdsm/tests/functional .</p>

<h1 id="running-functional-tests">Running Functional Tests</h1>

<ul>
  <li>Build and install VDSM RPMs including vdsm-tests</li>
  <li>Start vdsmd service</li>
  <li>Setup prerequisites</li>
</ul>

<p>Some of tests assume the prerequisites are already setup, other tests setup and tear down those prerequisites themselves. See the detailed information for each test bellow to setup the prerequisites.</p>

<ul>
  <li>Execute the following commands</li>
</ul>

<!-- -->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /usr/share/vdsm/tests
./run_tests.sh [options] functional/*.py
</code></pre></div></div>

<p>The <strong>options</strong> are passed to nose. If you want to skip some tests, use NOSE_EXCLUDE environment variable or –ignore-files option. You can man nosetests to see what variables and options are available. The functional tests invoke XML-RPC APIs via TLS, so the user running the tests must have the authority to access VDSM certificates. Some tests also setup iSCSI LUNs and NFS exports for VDSM, so in most cases, the user running the tests should be root.</p>

<h1 id="mom-tests">MOM Tests</h1>

<p>MOM is started by VDSM automaticly. Its tests are implemented in momTests.py, it’s for testing interaction MOM with VDSM.</p>

<h2 id="setting-up-prerequisites">Setting up prerequisites</h2>

<p>To run MOM tests, we have to install MOM RPMs first.</p>

<h2 id="ksm-tests">KSM tests</h2>

<p>mom.conf must include KSM and HostKSM in controllers and host collectors respectively. KSM test can be run directly with sudo command.</p>

<h2 id="balloon-tests">Balloon tests</h2>

<p>mom.conf must include Balloon in controllers, and HostMemory and GuestBalloon in guest collectors. For this test, you can reference <a href="http://gerrit.ovirt.org/#/c/13156/">http://gerrit.ovirt.org/#/c/13156/</a>. This test requires at least one running vm. Note that the vm should be equipped with active ovirt-guest-agent service before the tests since GuestMemory is by default in the config file.</p>

<h1 id="sos-plugin-tests">SOS Plugin Tests</h1>

<p>The tests are implemented in sosPluginTests.py .</p>

<h2 id="setting-up-prerequisites-1">Setting Up Prerequisites</h2>

<p>Not needed</p>

<h1 id="xml-rpc-tests">XML-RPC Tests</h1>

<p>The tests are implemented in xmlrpcTests.py . It invokes VDSM APIs through the XML-RPC binding. It covers creation and destruction of iSCSI/LocalFS/GlusterFS/NFS(<a href="http://gerrit.ovirt.org/#/c/13105/">Under Review</a>) storage domain, pool, image and volume. It also creates and shutdown VMs with and without storage.</p>

<h2 id="setting-up-prerequisites-2">Setting Up Prerequisites</h2>

<h3 id="iscsi-storage-tests">iSCSI storage tests</h3>

<p>Install the latest python-rtslib and Linux kernel. The python-rtslib is for the tests to configure iSCSI LUNs. A latest Linux kernel providing LIO iSCSI target feature is needed as well.</p>

<h3 id="localfs-storage-tests">LocalFS storage tests</h3>

<p>Not needed.</p>

<h3 id="glusterfs-storage-tests">GlusterFS storage tests</h3>

<ul>
  <li>Install the latest GlusterFS RPMs.</li>
</ul>

<p>You can download the .repo file to /etc/yum.repos.d from the <a href="https://download.gluster.org/pub/gluster/glusterfs/">GlusterFS official site</a>.</p>

<ul>
  <li>Start glusterd system service</li>
  <li>Setup testing volume</li>
</ul>

<p>Prepare the backend</p>

<!-- -->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /testGlusterBrick &amp;&amp; chmod 777 /testGlusterBrick
</code></pre></div></div>

<p>Start gluster shell by running the command <strong>gluster</strong></p>

<!-- -->

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gluster&gt; volume create testvol YOUR_HOST_NAME:/testGlusterBrick
gluster&gt; volume start testvol
gluster&gt; volume set testvol server.allow-insecure on
</code></pre></div></div>

<ul>
  <li>Edit /etc/glusterfs/glusterd.vol</li>
</ul>

<p>Add “option rpc-auth-allow-insecure on” and save.</p>

<h3 id="nfs-storage-tests">NFS storage tests</h3>

<p>Start nfs-server system service.</p>

<h3 id="vm-related-tests">VM related tests</h3>

<p>VM functional tests boot virtual machine using host kernel and initramfs, so we should authorize the QEMU process to read our kernel image and initramfs. This can be done by the following command.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod a+r /boot/vmlinuz-* /boot/initramfs-*
</code></pre></div></div>





        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3185/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3185/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3185/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3185/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/vdsm/functional-tests.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/developer-guide/vdsm/functional-tests.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
