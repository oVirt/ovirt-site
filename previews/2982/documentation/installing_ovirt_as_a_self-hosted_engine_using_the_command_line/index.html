<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Installing oVirt as a self-hosted engine using the command line | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Installing oVirt as a self-hosted engine using the command line" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2982/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2982/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Installing oVirt as a self-hosted engine using the command line" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Installing oVirt as a self-hosted engine using the command line","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2982/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2982/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2982/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2982/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2982/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2982/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2982/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2982/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2982/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2982/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2982/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2982/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2982/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2982/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2982/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2982/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2982/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2982/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2982/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2982/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2982/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2982/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2982/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2982/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2982//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2982//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2982/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2982/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#Install_overview_SHE_cli_deploy">1. Installation Overview</a></li>
<li><a href="#RHV_requirements">2. Requirements</a>
<ul class="sectlevel2">
<li><a href="#RHV-manager-requirements">2.1. oVirt Engine Requirements</a>
<ul class="sectlevel3">
<li><a href="#hardware-requirements_SHE_cli_deploy">2.1.1. Hardware Requirements</a></li>
<li><a href="#browser-requirements_SHE_cli_deploy">2.1.2. Browser Requirements</a></li>
<li><a href="#client-requirements_SHE_cli_deploy">2.1.3. Client Requirements</a></li>
<li><a href="#operating-system-requirements_SHE_cli_deploy">2.1.4. Operating System Requirements</a></li>
</ul>
</li>
<li><a href="#host-requirements">2.2. Host Requirements</a>
<ul class="sectlevel3">
<li><a href="#CPU_Requirements_SHE_cli_deploy">2.2.1. CPU Requirements</a></li>
<li><a href="#Memory_Requirements_SHE_cli_deploy">2.2.2. Memory Requirements</a></li>
<li><a href="#Storage_Requirements_SHE_cli_deploy">2.2.3. Storage Requirements</a></li>
<li><a href="#PCI_Device_Requirements_SHE_cli_deploy">2.2.4. PCI Device Requirements</a></li>
<li><a href="#Device_Assignment_Requirements_SHE_cli_deploy">2.2.5. Device Assignment Requirements</a></li>
<li><a href="#vGPU_Requirements_SHE_cli_deploy">2.2.6. vGPU Requirements</a></li>
</ul>
</li>
<li><a href="#networking-requirements">2.3. Networking requirements</a>
<ul class="sectlevel3">
<li><a href="#general-requirements">2.3.1. General requirements</a></li>
<li><a href="#Network-range-for-SHE-deployment_SHE_cli_deploy">2.3.2. Network range for self-hosted engine deployment</a></li>
<li><a href="#dns-requirements_SHE_cli_deploy">2.3.3. Firewall Requirements for DNS, NTP, and IPMI Fencing</a></li>
<li><a href="#RHV-manager-firewall-requirements_SHE_cli_deploy">2.3.4. oVirt Engine Firewall Requirements</a></li>
<li><a href="#host-firewall-requirements_SHE_cli_deploy">2.3.5. Host Firewall Requirements</a></li>
<li><a href="#database-server-firewall-requirements_SHE_cli_deploy">2.3.6. Database Server Firewall Requirements</a></li>
<li><a href="#MTU_Requirements_SHE_cli_deploy">2.3.7. Maximum Transmission Unit Requirements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Preparing_Storage_for_RHV_SHE_cli_deploy">3. Preparing Storage for oVirt</a>
<ul class="sectlevel2">
<li><a href="#Preparing_NFS_Storage_SHE_cli_deploy">3.1. Preparing NFS Storage</a></li>
<li><a href="#Preparing_iSCSI_Storage_SHE_cli_deploy">3.2. Preparing iSCSI Storage</a></li>
<li><a href="#Preparing_FCP_Storage_SHE_cli_deploy">3.3. Preparing FCP Storage</a></li>
<li><a href="#Preparing_Red_Hat_Gluster_Storage_SHE_cli_deploy">3.4. Preparing Gluster Storage</a></li>
<li><a href="#proc-Customizing_Multipath_Configurations_for_SAN_Vendors_SHE_cli_deploy">3.5. Customizing Multipath Configurations for SAN Vendors</a></li>
<li><a href="#ref-Recommended_Settings_for_Multipath_conf_SHE_cli_deploy">3.6. Recommended Settings for Multipath.conf</a></li>
</ul>
</li>
<li><a href="#Installing_the_self-hosted_engine_deployment_host_SHE_cli_deploy">4. Installing the Self-hosted Engine Deployment Host</a>
<ul class="sectlevel2">
<li><a href="#Installing_Red_Hat_Virtualization_Hosts_SHE_deployment_host">4.1. Installing oVirt Nodes</a></li>
<li><a href="#Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_deployment_host">4.2. Installing Enterprise Linux hosts</a></li>
</ul>
</li>
<li><a href="#Installing_the_Red_Hat_Virtualization_Manager_SHE_cli_deploy">5. Installing the oVirt Engine</a>
<ul class="sectlevel2">
<li><a href="#proc_Manually_installing_the_appliance_install_RHVM">5.1. Manually installing the Engine Appliance</a></li>
<li><a href="#Enabling-and-configuring-firewall_install_RHVM">5.2. Enabling and configuring the firewall</a></li>
<li><a href="#Deploying_the_Self-Hosted_Engine_Using_the_CLI_install_RHVM">5.3. Deploying the self-hosted engine using the command line</a></li>
<li><a href="#Enabling_the_Red_Hat_Virtualization_Manager_Repositories_install_RHVM">5.4. Enabling the oVirt Engine Repositories</a></li>
<li><a href="#Connecting_to_the_Administration_Portal_install_RHVM">5.5. Connecting to the Administration Portal</a></li>
</ul>
</li>
<li><a href="#Installing_Hosts_for_RHV_SHE_cli_deploy">6. Installing Hosts for oVirt</a>
<ul class="sectlevel2">
<li><a href="#Red_Hat_Virtualization_Hosts_SHE_cli_deploy">6.1. oVirt Nodes</a>
<ul class="sectlevel3">
<li><a href="#Installing_Red_Hat_Virtualization_Hosts_SHE_cli_deploy">6.1.1. Installing oVirt Nodes</a></li>
<li><a href="#proc_installing-a-third-party-package-on-ovirt-node_SHE_cli_deploy">6.1.2. Installing a third-party package on oVirt-node</a></li>
<li><a href="#Advanced_RHVH_Install_SHE_cli_deploy">6.1.3. Advanced Installation</a></li>
</ul>
</li>
<li><a href="#Red_Hat_Enterprise_Linux_hosts_SHE_cli_deploy">6.2. Enterprise Linux hosts</a>
<ul class="sectlevel3">
<li><a href="#Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_cli_deploy">6.2.1. Installing Enterprise Linux hosts</a></li>
<li><a href="#Installing_Cockpit_on_Linux_Hosts_SHE_cli_deploy">6.2.2. Installing Cockpit on Enterprise Linux hosts</a></li>
</ul>
</li>
<li><a href="#Recommended_practices_for_configuring_host_networks_SHE_cli_deploy">6.3. Recommended Practices for Configuring Host Networks</a></li>
<li><a href="#Adding_self-hosted_engine_nodes_to_the_Manager_SHE_cli_deploy">6.4. Adding Self-Hosted Engine Nodes to the oVirt Engine</a></li>
<li><a href="#Adding_standard_hosts_to_the_Manager_SHE_cli_deploy">6.5. Adding Standard Hosts to the oVirt Engine</a></li>
</ul>
</li>
<li><a href="#Adding_Storage_Domains_to_RHV_SHE_cli_deploy">7. Adding Storage for oVirt</a>
<ul class="sectlevel2">
<li><a href="#Adding_NFS_Storage_SHE_cli_deploy">7.1. Adding NFS Storage</a></li>
<li><a href="#Adding_iSCSI_Storage_SHE_cli_deploy">7.2. Adding iSCSI Storage</a></li>
<li><a href="#Adding_FCP_Storage_SHE_cli_deploy">7.3. Adding FCP Storage</a></li>
<li><a href="#Adding_Red_Hat_Gluster_Storage_SHE_cli_deploy">7.4. Adding Gluster Storage</a></li>
</ul>
</li>
<li><a href="#Troubleshooting_SHE_SHE_cli_deploy">Appendix A: Troubleshooting a Self-hosted Engine Deployment</a>
<ul class="sectlevel2">
<li><a href="#Troubleshooting_the_Manager_Virtual_Machine_SHE_cli_deploy">Troubleshooting the Engine Virtual Machine</a></li>
<li><a href="#Cleaning_Up_a_Failed_Self-hosted_Engine_Deployment_SHE_cli_deploy">Cleaning Up a Failed Self-hosted Engine Deployment</a></li>
</ul>
</li>
<li><a href="#customizing_engine_vm_during_deployment_auto_SHE_cli_deploy">Appendix B: Customizing the Engine virtual machine using automation during deployment</a></li>
<li><a href="#Migrating_to_remote_servers_SHE_cli_deploy">Appendix C: Migrating Databases and Services to a Remote Server</a>
<ul class="sectlevel2">
<li><a href="#Migrating_Data_Warehouse_to_a_Separate_Machine_SHE_cli_deploy">Migrating Data Warehouse to a Separate Machine</a>
<ul class="sectlevel3">
<li><a href="#proc-Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine">Migrating the Data Warehouse Database to a Separate Machine</a></li>
<li><a href="#Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Service to a Separate Machine</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Configuring_a_Host_for_PCI_Passthrough_SHE_cli_deploy">Appendix D: Configuring a Host for PCI Passthrough</a></li>
<li><a href="#proc-Preventing_Kernel_Modules_from_Loading_Automatically_Install_nodes_RHVH">Appendix E: Preventing kernel modules from loading automatically</a>
<ul class="sectlevel2">
<li><a href="#removing-a-module-temporarily">Removing a module temporarily</a></li>
</ul>
</li>
<li><a href="#ovirt-legal-notice">Appendix F: Legal notice</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<h1 id="installing-ovirt-as-a-self-hosted-engine-using-the-command-line" class="discrete">Installing oVirt as a self-hosted engine using the command line</h1>
<div class="paragraph">
<p>Self-hosted engine installation is automated using Ansible. The installation script (<code>hosted-engine --deploy</code>) runs on an initial deployment host, and the oVirt Engine (or "engine") is installed and configured on a virtual machine that is created on the deployment host. The Engine and Data Warehouse databases are installed on the Engine virtual machine, but can be migrated to a separate server post-installation if required.</p>
</div>
<div class="paragraph">
<p>Hosts that can run the Engine virtual machine are referred to as self-hosted engine nodes. At least two self-hosted engine nodes are required to support the high availability feature.</p>
</div>
<div class="paragraph">
<p>A storage domain dedicated to the Engine virtual machine is referred to as the self-hosted engine storage domain. This storage domain is created by the installation script, so the underlying storage must be prepared before beginning the installation.</p>
</div>
<div class="paragraph">
<p>See the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index"><em>Planning and Prerequisites Guide</em></a> for information on environment options and recommended configuration. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#self-hosted-engine-recommendations">Self-Hosted Engine Recommendations</a> for configuration specific to a self-hosted engine environment.</p>
</div>
<h2 id="RHV_key_components_SHE_cli_deploy" class="discrete">oVirt Key Components</h2>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A service that provides a graphical user interface and a REST API to manage the resources in the environment. The Engine is installed on a physical or virtual machine running Enterprise Linux.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Linux hosts (Enterprise Linux hosts) and oVirt Nodes (image-based hypervisors) are the two supported types of host. Hosts use Kernel-based Virtual Machine (KVM) technology and provide resources used to run virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared Storage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A storage service is used to store the data associated with virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Warehouse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A service that collects configuration information and statistical data from the Engine.</p></td>
</tr>
</tbody>
</table>
<h2 id="Self-hosted_Engine_Architecture_SHE_cli_deploy" class="discrete">Self-Hosted Engine Architecture</h2>
<div class="paragraph">
<p>The oVirt Engine runs as a virtual machine on self-hosted engine nodes (specialized hosts) in the same environment it manages. A self-hosted engine environment requires one less physical server, but requires more administrative overhead to deploy and manage. The Engine is highly available without external HA management.</p>
</div>
<div class="paragraph">
<p>The minimum setup of a self-hosted engine environment includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One oVirt Engine virtual machine that is hosted on the self-hosted engine nodes. The Engine Appliance is used to automate the installation of a Enterprise Linux 8 virtual machine, and the Engine on that virtual machine.</p>
</li>
<li>
<p>A minimum of two self-hosted engine nodes for virtual machine high availability. You can use Enterprise Linux hosts or oVirt Nodes (oVirt Node). VDSM (the host agent) runs on all hosts to facilitate communication with the oVirt Engine. The HA services run on all self-hosted engine nodes to manage the high availability of the Engine virtual machine.</p>
</li>
<li>
<p>One storage service, which can be hosted locally or on a remote server, depending on the storage type used. The storage service must be accessible to all hosts.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="common/images/RHV_SHE_ARCHITECTURE1.png" alt="Self-Hosted Engine Architecture">
</div>
<div class="title">Figure 1. Self-Hosted Engine oVirt Architecture</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Install_overview_SHE_cli_deploy">1. Installation Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The self-hosted engine installation uses Ansible and the Engine Appliance (a pre-configured Engine virtual machine image) to automate the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuring the first self-hosted engine node</p>
</li>
<li>
<p>Installing a Enterprise Linux virtual machine on that node</p>
</li>
<li>
<p>Installing and configuring the oVirt Engine on that virtual machine</p>
</li>
<li>
<p>Configuring the self-hosted engine storage domain</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Engine Appliance is only used during installation. It is not used to upgrade the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Installing a self-hosted engine environment involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Preparing_Storage_for_RHV_SHE_cli_deploy">Prepare storage to use for the self-hosted engine storage domain and for standard storage domains.</a> You can use one of the following storage types:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Preparing_NFS_Storage_SHE_cli_deploy">NFS</a></p>
</li>
<li>
<p><a href="#Preparing_iSCSI_Storage_SHE_cli_deploy">iSCSI</a></p>
</li>
<li>
<p><a href="#Preparing_FCP_Storage_SHE_cli_deploy">Fibre Channel (FCP)</a></p>
</li>
<li>
<p><a href="#Preparing_Red_Hat_Gluster_Storage_SHE_cli_deploy">Gluster Storage</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#Installing_the_self-hosted_engine_deployment_host_SHE_cli_deploy">Install a deployment host to run the installation on.</a> This host will become the first self-hosted engine node. You can use either host type:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Installing_Red_Hat_Virtualization_Hosts_SHE_deployment_host">oVirt Node</a></p>
</li>
<li>
<p><a href="#Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_deployment_host">Enterprise Linux</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#Installing_the_Red_Hat_Virtualization_Manager_SHE_cli_deploy">Install and configure the oVirt Engine:</a></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><a href="#Enabling-and-configuring-firewall_install_RHVM">Enabling and configuring the firewall</a></p>
</li>
<li>
<p><a href="#Deploying_the_Self-Hosted_Engine_Using_the_CLI_install_RHVM">Install the self-hosted engine using the <code>hosted-engine --deploy</code> command on the deployment host.</a></p>
</li>
<li>
<p><a href="#Enabling_the_Red_Hat_Virtualization_Manager_Repositories_install_RHVM">Enable the oVirt Engine repositories.</a></p>
</li>
<li>
<p><a href="#Connecting_to_the_Administration_Portal_install_RHVM">Connect to the Administration Portal to add hosts and storage domains.</a></p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#Installing_Hosts_for_RHV_SHE_cli_deploy">Add more self-hosted engine nodes and standard hosts to the Engine.</a> Self-hosted engine nodes can run the Engine virtual machine and other virtual machines. Standard hosts can run all other virtual machines, but not the Engine virtual machine.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Use either host type, or both:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#Red_Hat_Virtualization_Hosts_SHE_cli_deploy">oVirt Node</a></p>
</li>
<li>
<p><a href="#Red_Hat_Enterprise_Linux_hosts_SHE_cli_deploy">Enterprise Linux</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#Adding_self-hosted_engine_nodes_to_the_Manager_SHE_cli_deploy">Add hosts to the Engine as self-hosted engine nodes.</a></p>
</li>
<li>
<p><a href="#Adding_standard_hosts_to_the_Manager_SHE_cli_deploy">Add hosts to the Engine as standard hosts.</a></p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#Adding_Storage_Domains_to_RHV_SHE_cli_deploy">Add more storage domains to the Engine.</a> The self-hosted engine storage domain is not recommended for use by anything other than the Engine virtual machine.</p>
</li>
<li>
<p>If you want to host any databases or services on a server separate from the Engine, <a href="#Migrating_to_remote_servers_SHE_cli_deploy">you can migrate them after the installation is complete.</a></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Keep the environment up to date. Since bug fixes for known issues are frequently released, use scheduled tasks to update the hosts and the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="RHV_requirements">2. Requirements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="RHV-manager-requirements">2.1. oVirt Engine Requirements</h3>
<div class="sect3">
<h4 id="hardware-requirements_SHE_cli_deploy">2.1.1. Hardware Requirements</h4>
<div class="paragraph">
<p>The minimum and recommended hardware requirements outlined here are based on a typical small to medium-sized installation. The exact requirements vary between deployments based on sizing and load.</p>
</div>
<div class="paragraph">
<p>The oVirt Engine runs on Enterprise Linux operating systems like <a href="https://www.centos.org/">CentOS Linux</a> or <a href="https://www.redhat.com/en/technologies/linux-platforms/enterprise-linux">Red Hat Enterprise Linux</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. oVirt Engine Hardware Requirements</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource</th>
<th class="tableblock halign-left valign-top">Minimum</th>
<th class="tableblock halign-left valign-top">Recommended</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A dual core x86_64 CPU.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A quad core x86_64 CPU or multiple dual core x86_64 CPUs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 GB of available system RAM if Data Warehouse is not installed and if memory is not being consumed by existing processes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 GB of system RAM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hard Disk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 GB of locally accessible, writable disk space.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">50 GB of locally accessible, writable disk space.</p>
<p class="tableblock">You can use the <a href="https://access.redhat.com/labs/rhevmhdsc/">RHV Engine History Database Size Calculator</a> to calculate the appropriate disk space for the Engine history database size.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Network Interface Card (NIC) with bandwidth of at least 1 Gbps.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Network Interface Card (NIC) with bandwidth of at least 1 Gbps.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="browser-requirements_SHE_cli_deploy">2.1.2. Browser Requirements</h4>
<div class="paragraph">
<p>The following browser versions and operating systems can be used to access the Administration Portal and the VM Portal.</p>
</div>
<div class="paragraph">
<p>Browser testing is divided into tiers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tier 1: Browser and operating system combinations that are fully tested.</p>
</li>
<li>
<p>Tier 2: Browser and operating system combinations that are partially tested, and are likely to work.</p>
</li>
<li>
<p>Tier 3: Browser and operating system combinations that are not tested, but may work.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Browser Requirements</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Support Tier</th>
<th class="tableblock halign-left valign-top">Operating System Family</th>
<th class="tableblock halign-left valign-top">Browser</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tier 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mozilla Firefox Extended Support Release (ESR) version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most recent version of Google Chrome, Mozilla Firefox, or Microsoft Edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tier 2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tier 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Earlier versions of Google Chrome or Mozilla Firefox</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other browsers</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="client-requirements_SHE_cli_deploy">2.1.3. Client Requirements</h4>
<div class="paragraph">
<p>Virtual machine consoles can only be accessed using supported Remote Viewer (<code>virt-viewer</code>) clients on Enterprise Linux and Windows. To install <code>virt-viewer</code>, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-installing_supporting_components">Installing Supporting Components on Client Machines</a> in the <em>Virtual Machine Management Guide</em>. Installing <code>virt-viewer</code> requires Administrator privileges.</p>
</div>
<div class="paragraph">
<p>You can access virtual machine consoles using the SPICE, VNC, or RDP (Windows only) protocols. You can install the QXLDOD graphical driver in the guest operating system to improve the functionality of SPICE. SPICE currently supports a maximum resolution of 2560x1600 pixels.</p>
</div>
<div class="paragraph">
<div class="title">Client Operating System SPICE Support</div>
<p>Supported QXLDOD drivers are available on Enterprise Linux 7.2 and later, and Windows 10.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SPICE may work with Windows 8 or 8.1 using QXLDOD drivers, but it is neither certified nor tested.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="operating-system-requirements_SHE_cli_deploy">2.1.4. Operating System Requirements</h4>
<div class="paragraph">
<p>The oVirt Engine must be installed on a base installation of Enterprise Linux 8 that has been updated to the latest minor release.</p>
</div>
<div class="paragraph">
<p>Do not install any additional packages after the base installation, as they may cause dependency issues when attempting to install the packages required by the Engine.</p>
</div>
<div class="paragraph">
<p>Do not enable additional repositories other than those required for the Engine installation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="host-requirements">2.2. Host Requirements</h3>
<div class="paragraph">
<p>To use Enterprise Linux 9 on virtualization hosts, the UEFI Secure Boot option must be disabled due
to <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2081648">Bug 2081648 - dmidecode module fails to decode DMI data</a>.</p>
</div>
<div class="sect3">
<h4 id="CPU_Requirements_SHE_cli_deploy">2.2.1. CPU Requirements</h4>
<div class="paragraph">
<p>All CPUs must have support for the Intel® 64 or AMD64 CPU extensions, and the AMD-V™ or Intel VT® hardware virtualization extensions enabled. Support for the No eXecute flag (NX) is also required.</p>
</div>
<div class="paragraph">
<p>The following CPU models are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AMD</p>
<div class="ulist">
<ul>
<li>
<p>Opteron G4</p>
</li>
<li>
<p>Opteron G5</p>
</li>
<li>
<p>EPYC</p>
</li>
</ul>
</div>
</li>
<li>
<p>Intel</p>
<div class="ulist">
<ul>
<li>
<p>Nehalem</p>
</li>
<li>
<p>Westmere</p>
</li>
<li>
<p>SandyBridge</p>
</li>
<li>
<p>IvyBridge</p>
</li>
<li>
<p>Haswell</p>
</li>
<li>
<p>Broadwell</p>
</li>
<li>
<p>Skylake Client</p>
</li>
<li>
<p>Skylake Server</p>
</li>
<li>
<p>Cascadelake Server</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Enterprise Linux 9 doesn&#8217;t support virtualization for ppc64le: <a href="https://wiki.centos.org/SpecialInterestGroup/Virtualization">CentOS Virtualization SIG</a> is working
on re-introducing virtualization support but it&#8217;s not ready yet.</p>
</div>
<div class="paragraph">
<p>The oVirt project also provides packages for the 64-bit ARM architecture (ARM 64) but only as a Technology Preview.</p>
</div>
<div class="paragraph">
<p>For each CPU model with security updates, the <strong>CPU Type</strong> lists a basic type and a secure type. For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Intel Cascadelake Server Family</strong></p>
</li>
<li>
<p><strong>Secure Intel Cascadelake Server Family</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Secure CPU type contains the latest updates. For details, see BZ#<a href="https://bugzilla.redhat.com/1731395">1731395</a></p>
</div>
<div class="sect4">
<h5 id="Checking_Processor_Flag_Support_SHE_cli_deploy">Checking if a Processor Supports the Required Flags</h5>
<div class="paragraph">
<p>You must enable virtualization in the BIOS. Power off and reboot the host after this change to ensure that the change is applied.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>At the Enterprise Linux or oVirt Node boot screen, press any key and select the <strong>Boot</strong> or <strong>Boot with serial console</strong> entry from the list.</p>
</li>
<li>
<p>Press <code>Tab</code> to edit the kernel parameters for the selected option.</p>
</li>
<li>
<p>Ensure there is a space after the last kernel parameter listed, and append the parameter <code>rescue</code>.</p>
</li>
<li>
<p>Press <code>Enter</code> to boot into rescue mode.</p>
</li>
<li>
<p>At the prompt, determine that your processor has the required extensions and that they are enabled by running this command:</p>
<div class="listingblock">
<div class="content">
<pre># grep -E 'svm|vmx' /proc/cpuinfo | grep nx</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If any output is shown, the processor is hardware virtualization capable. If no output is shown, your processor may still support hardware virtualization; in some circumstances manufacturers disable the virtualization extensions in the BIOS. If you believe this to be the case, consult the system&#8217;s BIOS and the motherboard manual provided by the manufacturer.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Memory_Requirements_SHE_cli_deploy">2.2.2. Memory Requirements</h4>
<div class="paragraph">
<p>The minimum required RAM is 2 GB. For cluster levels 4.2 to 4.5, the maximum supported RAM per VM in oVirt Node is 6 TB. For cluster levels 4.6 to 4.7, the maximum supported RAM per VM in oVirt Node is 16 TB.</p>
</div>
<div class="paragraph">
<p>However, the amount of RAM required varies depending on guest operating system requirements, guest application requirements, and guest memory activity and usage. KVM can also overcommit physical RAM for virtualized guests, allowing you to provision guests with RAM requirements greater than what is physically present, on the assumption that the guests are not all working concurrently at peak load. KVM does this by only allocating RAM for guests as required and shifting underutilized guests into swap.</p>
</div>
</div>
<div class="sect3">
<h4 id="Storage_Requirements_SHE_cli_deploy">2.2.3. Storage Requirements</h4>
<div class="paragraph">
<p>Hosts require storage to store configuration, logs, kernel dumps, and for use as swap space. Storage can be local or network-based. oVirt Node (oVirt Node) can boot with one, some, or all of its default allocations  in network storage. Booting from network storage can result in a freeze if there is a network disconnect. Adding a drop-in multipath configuration file can help address losses in network connectivity. If oVirt Node boots from SAN storage and loses connectivity, the files become read-only until network connectivity restores. Using network storage might result in a performance downgrade.</p>
</div>
<div class="paragraph">
<p>The minimum storage requirements of oVirt Node are documented in this section. The storage requirements for Enterprise Linux hosts vary based on the amount of disk space used by their existing configuration but are expected to be greater than those of oVirt Node.</p>
</div>
<div class="paragraph">
<p>The minimum storage requirements for host installation are listed below. However, use the default allocations, which use more storage space.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/ (root) - 6 GB</p>
</li>
<li>
<p>/home - 1 GB</p>
</li>
<li>
<p>/tmp - 1 GB</p>
</li>
<li>
<p>/boot - 1 GB</p>
</li>
<li>
<p>/var - 5 GB</p>
</li>
<li>
<p>/var/crash - 10 GB</p>
</li>
<li>
<p>/var/log - 8 GB</p>
</li>
<li>
<p>/var/log/audit - 2 GB</p>
</li>
<li>
<p>/var/tmp - 10 GB</p>
</li>
<li>
<p>swap - 1 GB (for the recommended swap size, see <a href="https://access.redhat.com/solutions/15244" class="bare">https://access.redhat.com/solutions/15244</a>)</p>
</li>
<li>
<p>Anaconda reserves 20% of the thin pool size within the volume group for future metadata expansion. This is to prevent an out-of-the-box configuration from running out of space under normal usage conditions. Overprovisioning of thin pools during installation is also not supported.</p>
</li>
<li>
<p><strong>Minimum Total - 64 GiB</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are also installing the Engine Appliance for self-hosted engine installation, <code>/var/tmp</code> must be at least 10 GB.</p>
</div>
<div class="paragraph">
<p>If you plan to use memory overcommitment, add enough swap space to provide virtual memory for all of virtual machines. See <a href="https://ovirt.org/documentation/administration_guide/index#Memory_Optimization">Memory Optimization</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="PCI_Device_Requirements_SHE_cli_deploy">2.2.4. PCI Device Requirements</h4>
<div class="paragraph">
<p>Hosts must have at least one network interface with a minimum bandwidth of 1 Gbps. Each host should have two network interfaces, with one dedicated to supporting network-intensive activities, such as virtual machine migration. The performance of such operations is limited by the bandwidth available.</p>
</div>
<div class="paragraph">
<p>For information about how to use PCI Express and conventional PCI devices with Intel Q35-based virtual machines, see <a href="https://access.redhat.com/articles/3201152"><em>Using PCI Express and Conventional PCI Devices with the Q35 Virtual Machine</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Device_Assignment_Requirements_SHE_cli_deploy">2.2.5. Device Assignment Requirements</h4>
<div class="paragraph">
<p>If you plan to implement device assignment and PCI passthrough so that a virtual machine can use a specific PCIe device from a host, ensure the following requirements are met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU must support IOMMU (for example, VT-d or AMD-Vi). IBM POWER8 supports IOMMU by default.</p>
</li>
<li>
<p>Firmware must support IOMMU.</p>
</li>
<li>
<p>CPU root ports used must support ACS or ACS-equivalent capability.</p>
</li>
<li>
<p>PCIe devices must support ACS or ACS-equivalent capability.</p>
</li>
<li>
<p>All PCIe switches and bridges between the PCIe device and the root port should support ACS. For example, if a switch does not support ACS, all devices behind that switch share the same IOMMU group, and can only be assigned to the same virtual machine.</p>
</li>
<li>
<p>For GPU support, Enterprise Linux 8 supports PCI device assignment of PCIe-based NVIDIA K-Series Quadro (model 2000 series or higher), GRID, and Tesla as non-VGA graphics devices. Currently up to two GPUs may be attached to a virtual machine in addition to one of the standard, emulated VGA interfaces. The emulated VGA is used for pre-boot and installation and the NVIDIA GPU takes over when the NVIDIA graphics drivers are loaded. Note that the NVIDIA Quadro 2000 is not supported, nor is the Quadro K420 card.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Check vendor specification and datasheets to confirm that your hardware meets these requirements. The <code>lspci -v</code> command can be used to print information for PCI devices already installed on a system.</p>
</div>
</div>
<div class="sect3">
<h4 id="vGPU_Requirements_SHE_cli_deploy">2.2.6. vGPU Requirements</h4>
<div class="paragraph">
<p>A host must meet the following requirements in order for virtual machines on that host to use a vGPU:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vGPU-compatible GPU</p>
</li>
<li>
<p>GPU-enabled host kernel</p>
</li>
<li>
<p>Installed GPU with correct drivers</p>
</li>
<li>
<p>Select a vGPU type and the number of instances that you would like to use with this virtual machine using the <strong>Manage vGPU</strong> dialog in the <strong>Administration Portal</strong> <strong>Host Devices</strong> tab of the virtual machine.</p>
</li>
<li>
<p>vGPU-capable drivers installed on each host in the cluster</p>
</li>
<li>
<p>vGPU-supported virtual machine operating system with vGPU drivers installed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="networking-requirements">2.3. Networking requirements</h3>
<div class="sect3">
<h4 id="general-requirements">2.3.1. General requirements</h4>
<div class="paragraph">
<p>oVirt requires IPv6 to remain enabled on the physical or virtual machine running the Engine. <a href="https://access.redhat.com/solutions/8709">Do not disable IPv6</a> on the Engine machine, even if your systems do not use it.</p>
</div>
</div>
<div class="sect3">
<h4 id="Network-range-for-SHE-deployment_SHE_cli_deploy">2.3.2. Network range for self-hosted engine deployment</h4>
<div class="paragraph">
<p>The self-hosted engine deployment process temporarily uses a <code>/24</code> network address under <code>192.168</code>. It defaults to <code>192.168.222.0/24</code>, and if this address is in use, it tries other <code>/24</code> addresses under <code>192.168</code> until it finds one that is not in use. If it does not find an unused network address in this range, deployment fails.</p>
</div>
<div class="paragraph">
<p>When installing the self-hosted engine using the command line, you can set the deployment script to use an alternate <code>/24</code> network range with the option <code>--ansible-extra-vars=he_ipv4_subnet_prefix=<em>PREFIX</em></code>, where <code><em>PREFIX</em></code> is the prefix for the default range. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># hosted-engine --deploy --ansible-extra-vars=he_ipv4_subnet_prefix=192.168.222</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only set another range by installing oVirt as a self-hosted engine using the command line.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="dns-requirements_SHE_cli_deploy">2.3.3. Firewall Requirements for DNS, NTP, and IPMI Fencing</h4>
<div class="paragraph">
<p>The firewall requirements for all of the following topics are special cases that require individual consideration.</p>
</div>
<div class="paragraph">
<div class="title">DNS and NTP</div>
<p>oVirt does not create a DNS or NTP server, so the firewall does not need to have open ports for incoming traffic.</p>
</div>
<div class="paragraph">
<p>By default, Enterprise Linux allows outbound traffic to DNS and NTP on any destination address. If you disable outgoing traffic, define exceptions for requests that are sent to DNS and NTP servers.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The oVirt Engine and all hosts (oVirt Node and Enterprise Linux host) must have a fully qualified domain name and full, perfectly-aligned forward and reverse name resolution.</p>
</li>
<li>
<p>Running a DNS service as a virtual machine in the oVirt environment is not supported. All DNS services the oVirt environment uses must be hosted outside of the environment.</p>
</li>
<li>
<p>Use DNS instead of the <code>/etc/hosts</code> file for name resolution. Using a hosts file typically requires more work and has a greater chance for errors.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">IPMI and Other Fencing Mechanisms (optional)</div>
<p>For IPMI (Intelligent Platform Management Interface) and other fencing mechanisms, the firewall does not need to have open ports for incoming traffic.</p>
</div>
<div class="paragraph">
<p>By default, Enterprise Linux allows outbound IPMI traffic to ports on any destination address. If you disable outgoing traffic, make exceptions for requests being sent to your IPMI or fencing servers.</p>
</div>
<div class="paragraph">
<p>Each oVirt Node and Enterprise Linux host in the cluster must be able to connect to the fencing devices of all other hosts in the cluster. If the cluster hosts are experiencing an error (network error, storage error&#8230;&#8203;) and cannot function as hosts, they must be able to connect to other hosts in the data center.</p>
</div>
<div class="paragraph">
<p>The specific port number depends on the type of the fence agent you are using and how it is configured.</p>
</div>
<div class="paragraph">
<p>The firewall requirement tables in the following sections do not represent this option.</p>
</div>
</div>
<div class="sect3">
<h4 id="RHV-manager-firewall-requirements_SHE_cli_deploy">2.3.4. oVirt Engine Firewall Requirements</h4>
<div class="paragraph">
<p>The oVirt Engine requires that a number of ports be opened to allow network traffic through the system&#8217;s firewall.</p>
</div>
<div class="paragraph">
<p>The <code>engine-setup</code> script can configure the firewall automatically.</p>
</div>
<div class="paragraph">
<p>The firewall configuration documented here assumes a default configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. oVirt Engine Firewall Requirements</caption>
<colgroup>
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 12%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Port(s)</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Encrypted by default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional.</p>
<p class="tableblock">May help in diagnosis.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System(s) used for maintenance of the Engine including backend configuration, and software upgrades.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell (SSH) access.</p>
<p class="tableblock">Optional.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2222</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients accessing virtual machine serial consoles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell (SSH) access to enable connection to virtual machine serial consoles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80, 443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Portal clients</p>
<p class="tableblock">VM Portal clients</p>
<p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p>
<p class="tableblock">REST API clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides HTTP (port 80, not encrypted) and HTTPS (port 443, encrypted) access to the Engine. HTTP redirects connections to HTTPS.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Portal clients</p>
<p class="tableblock">VM Portal clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides websocket proxy access for a web-based console client, <code>noVNC</code>, when the websocket proxy is running on the Engine.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7410</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If Kdump is enabled on the hosts, open this port for the fence_kdump listener on the Engine. See <a href="https://ovirt.org/documentation/administration_guide/index#sect-fence_kdump_Advanced_Configuration">fence_kdump Advanced Configuration</a>. <code>fence_kdump</code> doesn&#8217;t provide a way to encrypt the connection. However, you can manually configure this port to block access from hosts that are not eligible.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54323</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Portal clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine (<code>ovirt-imageio</code> service)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for communication with the <code>ovirt-imageo</code> service.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6442</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Virtual Network (OVN) southbound database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connect to Open Virtual Network (OVN) database</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9696</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients of external network provider for OVN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External network provider for OVN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenStack Networking API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, with configuration generated by engine-setup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">35357</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients of external network provider for OVN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External network provider for OVN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenStack Identity API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, with configuration generated by engine-setup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS lookup requests from ports above 1023 to port 53, and responses. Open by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP requests from ports above 1023 to port 123, and responses.  Open by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>A port for the OVN northbound database (6641) is not listed because, in the default configuration, the only client for the OVN northbound database (6641) is <code>ovirt-provider-ovn</code>. Because they both run on the same host, their communication is not visible to the network.</p>
</li>
<li>
<p>By default, Enterprise Linux allows outbound traffic to DNS and NTP on any destination address. If you disable outgoing traffic, make exceptions for the Engine to send requests to DNS and NTP servers. Other nodes may also require DNS and NTP. In that case, consult the requirements for those nodes and configure the firewall accordingly.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="host-firewall-requirements_SHE_cli_deploy">2.3.5. Host Firewall Requirements</h4>
<div class="paragraph">
<p>Enterprise Linux hosts and oVirt Nodes (oVirt Node) require a number of ports to be opened to allow network traffic through the system&#8217;s firewall. The firewall rules are automatically configured by default when adding a new host to the Engine, overwriting any pre-existing firewall configuration.</p>
</div>
<div class="paragraph">
<p>To disable automatic firewall configuration when adding a new host, clear the <strong>Automatically configure host firewall</strong> check box under <strong>Advanced Parameters</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Virtualization Host Firewall Requirements</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Port(s)</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Encrypted by default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell (SSH) access.</p>
<p class="tableblock">Optional.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2223</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell (SSH) access to enable connection to virtual machine serial consoles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">161</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Simple network management protocol (SNMP). Only required if you want Simple Network Management Protocol traps sent from the host to one or more external SNMP managers.</p>
<p class="tableblock">Optional.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">111</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS storage server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS connections.</p>
<p class="tableblock">Optional.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5900 - 6923</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Portal clients</p>
<p class="tableblock">VM Portal clients</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remote guest console access via VNC and SPICE. These ports must be open to facilitate client access to virtual machines.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5989</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Information Model Object Manager (CIMOM)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used by Common Information Model Object Managers (CIMOM) to monitor virtual machines running on the host. Only required if you want to use a CIMOM to monitor the virtual machines in your virtualization environment.</p>
<p class="tableblock">Optional.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p>
<p class="tableblock">Client machines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to access the Cockpit web interface, if installed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16514</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine migration using <strong>libvirt</strong>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">49152 - 49215</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual machine migration and fencing using VDSM. These ports must be open to facilitate both automated and manual migration of virtual machines.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes. Depending on agent for fencing, migration is done through libvirt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54321</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p>
<p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VDSM communications with the Engine and other virtualization hosts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine <code>ovirt-imageio</code> service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required for communication with the <code>ovirt-imageo</code> service.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6081</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required, when Open Virtual Network (OVN) is used as a network provider, to allow OVN to create tunnels between hosts.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS lookup requests from ports above 1023 to port 53, and responses. This port is required and open by default.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">123</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p>
<p class="tableblock">Enterprise Linux hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NTP requests from ports above 1023 to port 123, and responses. This port is required and open by default.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Security Protocol (IPSec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Security Protocol (IPSec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AH, ESP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internet Security Protocol (IPSec)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Enterprise Linux allows outbound traffic to DNS and NTP on any destination address. If you disable outgoing traffic, make exceptions for the oVirt Nodes</p>
</div>
<div class="paragraph">
<p>Enterprise Linux hosts to send requests to DNS and NTP servers. Other nodes may also require DNS and NTP. In that case, consult the requirements for those nodes and configure the firewall accordingly.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="database-server-firewall-requirements_SHE_cli_deploy">2.3.6. Database Server Firewall Requirements</h4>
<div class="paragraph">
<p>oVirt supports the use of a remote database server for the Engine database (<code>engine</code>) and the Data Warehouse database (<code>ovirt-engine-history</code>). If you plan to use a remote database server, it must allow connections from the Engine and the Data Warehouse service (which can be separate from the Engine).</p>
</div>
<div class="paragraph">
<p>Similarly, if you plan to access a local or remote Data Warehouse database from an external system, the database must allow connections from that system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Accessing the Engine database from external systems is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Database Server Firewall Requirements</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 20.8333%;">
<col style="width: 20.8333%;">
<col style="width: 20.8333%;">
<col style="width: 12.5002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Port(s)</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Destination</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Encrypted by default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5432</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Engine</p>
<p class="tableblock">Data Warehouse service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Engine (<code>engine</code>) database server</p>
<p class="tableblock">Data Warehouse (<code>ovirt-engine-history</code>) database server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default port for PostgreSQL database connections.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">No, but can be enabled</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5432</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP, UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External systems</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Warehouse (<code>ovirt-engine-history</code>) database server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default port for PostgreSQL database connections.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled by default. <a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">No, but can be enabled</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="MTU_Requirements_SHE_cli_deploy">2.3.7. Maximum Transmission Unit Requirements</h4>
<div class="paragraph">
<p>The recommended Maximum Transmission Units (MTU) setting for Hosts during deployment is 1500. It is possible to update this setting after the environment is set up to a different MTU. For more information on changing the MTU setting, see <a href="https://access.redhat.com/solutions/4129641">How to change the Hosted Engine VM network MTU</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Preparing_Storage_for_RHV_SHE_cli_deploy">3. Preparing Storage for oVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need to prepare storage to be used for storage domains in the new environment. A oVirt environment must have at least one data storage domain, but adding more is recommended.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A data domain holds the virtual hard disks and OVF files of all the virtual machines and templates in a data center, and cannot be shared across data centers while active (but can be migrated between data centers). Data domains of multiple storage types can be added to the same data center, provided they are all shared, rather than local, domains.</p>
</div>
<div class="paragraph">
<p>You can use one of the following storage types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Preparing_NFS_Storage_SHE_cli_deploy">NFS</a></p>
</li>
<li>
<p><a href="#Preparing_iSCSI_Storage_SHE_cli_deploy">iSCSI</a></p>
</li>
<li>
<p><a href="#Preparing_FCP_Storage_SHE_cli_deploy">Fibre Channel (FCP)</a></p>
</li>
<li>
<p><a href="#Preparing_Red_Hat_Gluster_Storage_SHE_cli_deploy">Gluster Storage</a></p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Self-hosted engines must have an additional data domain with at least 74&nbsp;GiB dedicated to the Engine virtual machine. The self-hosted engine installer creates this domain. Prepare the storage for this domain before installation.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Extending or otherwise changing the self-hosted engine storage domain after deployment of the self-hosted engine is not supported. Any such change might prevent the self-hosted engine from booting.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When using a block storage domain, either FCP or iSCSI, a single target LUN is the only supported setup for a self-hosted engine.</p>
</li>
<li>
<p>If you use iSCSI storage, the self-hosted engine storage domain must use a dedicated iSCSI target. Any additional storage domains must use a different iSCSI target.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>It is strongly recommended to create additional data storage domains in the same data center as the self-hosted engine storage domain. If you deploy the self-hosted engine in a data center with only one active data storage domain, and that storage domain is corrupted, you cannot add new storage domains or remove the corrupted storage domain. You must redeploy the self-hosted engine.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="Preparing_NFS_Storage_SHE_cli_deploy">3.1. Preparing NFS Storage</h3>
<div class="paragraph">
<p>Set up NFS shares on your file storage or remote server to serve as storage domains on Red Hat Enterprise Virtualization Host systems. After exporting the shares on the remote storage and configuring them in the Red Hat Virtualization Manager, the shares will be automatically imported on the Red Hat Virtualization hosts.</p>
</div>
<div class="paragraph">
<p>For information on setting up, configuring, mounting and exporting NFS, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_file_systems/index"><em>Managing file systems</em></a> for Red Hat Enterprise Linux 8.</p>
</div>
<div class="paragraph">
<p>Specific system user accounts and system user groups are required by oVirt so the Engine can store data in the storage domains represented by the exported directories. The following procedure sets the permissions for one directory. You must repeat the <code>chown</code> and <code>chmod</code> steps for all of the directories you intend to use as storage domains in oVirt.</p>
</div>
<div class="olist arabic">
<div class="title">Prerequisites</div>
<ol class="arabic">
<li>
<p>Install the NFS <code>utils</code> package.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install nfs-utils -y</code></pre>
</div>
</div>
</li>
<li>
<p>To check the enabled versions:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cat /proc/fs/nfsd/versions</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the following services:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl enable nfs-server
# systemctl enable rpcbind</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the group <code>kvm</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># groupadd kvm -g 36</code></pre>
</div>
</div>
</li>
<li>
<p>Create the user <code>vdsm</code> in the group <code>kvm</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># useradd vdsm -u 36 -g kvm</code></pre>
</div>
</div>
</li>
<li>
<p>Create the <code>storage</code> directory and modify the access rights.</p>
<div class="listingblock">
<div class="content">
<pre># mkdir /storage
# chmod 0755 /storage
# chown 36:36 /storage/</pre>
</div>
</div>
</li>
<li>
<p>Add the <code>storage</code> directory to <code>/etc/exports</code> with the relevant permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># vi /etc/exports
# cat /etc/exports
 /storage *(rw)</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl restart rpcbind
# systemctl restart nfs-server</code></pre>
</div>
</div>
</li>
<li>
<p>To see which export are available for a specific IP address:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># exportfs
 /nfs_server/srv
               10.46.11.3/24
 /nfs_server       &lt;world&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If changes in <code>/etc/exports</code> have been made after starting the services, the <code class="command">exportfs -ra</code> command can be used to reload the changes.
After performing all the above stages, the exports directory should be ready and can be tested on a different host to check that it is usable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Preparing_iSCSI_Storage_SHE_cli_deploy">3.2. Preparing iSCSI Storage</h3>
<div class="paragraph">
<p>oVirt supports iSCSI storage, which is a storage domain created from a volume group made up of LUNs. Volume groups and LUNs cannot be attached to more than one storage domain at a time.</p>
</div>
<div class="paragraph">
<p>For information on setting up and configuring iSCSI storage, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_storage_devices/index#getting-started-with-iscsi_managing-storage-devices">Getting started with iSCSI</a> in <em>Managing storage devices</em> for Red Hat Enterprise Linux 8.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <code>vdsm-tool config-lvm-filter</code> command to create filters for the LVM.
See <a href="https://ovirt.org/documentation/administration_guide/index#Creating_LVM_filter_storage_admin">Creating an LVM filter</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</p>
</div>
<div class="paragraph">
<p>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <em>boot_LUN_wwid</em>
        no_path_retry queue
    }</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Preparing_FCP_Storage_SHE_cli_deploy">3.3. Preparing FCP Storage</h3>
<div class="paragraph">
<p>oVirt supports SAN storage by creating a storage domain from a volume group made of pre-existing LUNs. Neither volume groups nor LUNs can be attached to more than one storage domain at a time.</p>
</div>
<div class="paragraph">
<p>oVirt system administrators need a working knowledge of Storage Area Networks (SAN) concepts. SAN usually uses Fibre Channel Protocol (FCP) for traffic between hosts and shared external storage. For this reason, SAN may occasionally be referred to as FCP storage.</p>
</div>
<div class="paragraph">
<p>For information on setting up and configuring FCP or multipathing on Enterprise Linux, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/index.html"><em>Storage Administration Guide</em></a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/DM_Multipath/index.html"><em>DM Multipath Guide</em></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <code>vdsm-tool config-lvm-filter</code> command to create filters for the LVM.
See <a href="https://ovirt.org/documentation/administration_guide/index#Creating_LVM_filter_storage_admin">Creating an LVM filter</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</p>
</div>
<div class="paragraph">
<p>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <em>boot_LUN_wwid</em>
        no_path_retry queue
    }</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Preparing_Red_Hat_Gluster_Storage_SHE_cli_deploy">3.4. Preparing Gluster Storage</h3>
<div class="paragraph">
<p>For information on setting up and configuring Gluster Storage, see the <a href="https://docs.gluster.org/en/latest/Install-Guide/Overview/"><em>Gluster Storage Installation Guide</em></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-Customizing_Multipath_Configurations_for_SAN_Vendors_SHE_cli_deploy">3.5. Customizing Multipath Configurations for SAN Vendors</h3>
<div class="paragraph">
<p>If your RHV environment is configured to use multipath connections with SANs, you can customize the multipath configuration settings to meet requirements specified by your storage vendor. These customizations can override both the default settings and settings that are specified in <code>/etc/multipath.conf</code>.</p>
</div>
<div class="paragraph">
<p>To override the multipath settings, do not customize <code>/etc/multipath.conf</code>. Because VDSM owns <code>/etc/multipath.conf</code>, installing or upgrading VDSM or oVirt can overwrite this file including any customizations it contains. This overwriting can cause severe storage failures.</p>
</div>
<div class="paragraph">
<p>Instead, you create a file in the <code>/etc/multipath/conf.d</code> directory that contains the settings you want to customize or override.</p>
</div>
<div class="paragraph">
<p>VDSM executes the files in <code>/etc/multipath/conf.d</code> in alphabetical order. So, to control the order of execution, you begin the filename with a number that makes it come last. For example, <code>/etc/multipath/conf.d/90-myfile.conf</code>.</p>
</div>
<div class="paragraph">
<p>To avoid causing severe storage failures, follow these guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Do not modify <code>/etc/multipath.conf</code>. If the file contains user modifications, and the file is overwritten, it can cause unexpected storage problems.</p>
</li>
<li>
<p>Do not override the <code>user_friendly_names</code> and <code>find_multipaths</code> settings. For details, see <a href="#ref-Recommended_Settings_for_Multipath_conf_SHE_cli_deploy">Recommended Settings for Multipath.conf</a>.</p>
</li>
<li>
<p>Avoid overriding the <code>no_path_retry</code> and <code>polling_interval</code> settings unless a storage vendor specifically requires you to do so. For details, see <a href="#ref-Recommended_Settings_for_Multipath_conf_SHE_cli_deploy">Recommended Settings for Multipath.conf</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not following these guidelines can cause catastrophic storage errors.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>VDSM is configured to use the multipath module. To verify this, enter:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># vdsm-tool is-configured --module multipath</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a new configuration file in the <code>/etc/multipath/conf.d</code> directory.</p>
</li>
<li>
<p>Copy the individual setting you want to override from <code>/etc/multipath.conf</code> to the new configuration file in <code>/etc/multipath/conf.d/&lt;my_device&gt;.conf</code>. Remove any comment marks, edit the setting values, and save your changes.</p>
</li>
<li>
<p>Apply the new configuration settings by entering:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># systemctl reload multipathd</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not restart the multipathd service. Doing so generates errors in the VDSM logs.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification steps</div>
<ol class="arabic">
<li>
<p>Test that the new configuration performs as expected on a non-production cluster in a variety of failure scenarios. For example, disable all of the storage connections.</p>
</li>
<li>
<p>Enable one connection at a time and verify that doing so makes the storage domain reachable.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index#ref-Recommended_Settings_for_Multipath_conf_SHE_cli_deploy">Recommended Settings for Multipath.conf</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><em>Enterprise Linux DM Multipath</em></a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Configuring_iSCSI_Multipathing">Configuring iSCSI Multipathing</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/solutions/3234761">How do I customize /etc/multipath.conf on my RHVH hypervisors? What values must not change and why?</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ref-Recommended_Settings_for_Multipath_conf_SHE_cli_deploy">3.6. Recommended Settings for Multipath.conf</h3>
<div class="paragraph">
<p>Do not override the following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">user_friendly_names  no</dt>
<dd>
<p>Device names must be consistent across all hypervisors. For example, <code>/dev/mapper/{WWID}</code>. The default value of this setting, <code>no</code>, prevents the assignment of arbitrary and inconsistent device names such as <code>/dev/mapper/mpath{N}</code> on various hypervisors, which can lead to unpredictable system behavior.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not change this setting to <code>user_friendly_names  yes</code>. User-friendly names are likely to cause unpredictable system behavior or failures, and are not supported.
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>find_multipaths	no</code></dt>
<dd>
<p>This setting controls whether oVirt Node tries to access devices through multipath only if more than one path is available. The current value, <code>no</code>, allows oVirt to access devices through multipath even if only one path is available.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not override this setting.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Avoid overriding the following settings unless required by the storage system vendor:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>no_path_retry	4</code></dt>
<dd>
<p>This setting controls the number of polling attempts to retry when no paths are available. Before oVirt version 4.2, the value of <code>no_path_retry</code> was <code>fail</code> because QEMU had trouble with the I/O queuing when no paths were available. The <code>fail</code> value made it fail quickly and paused the virtual machine. oVirt version 4.2 changed this value to <code>4</code> so when multipathd detects the last path has failed, it checks all of the paths four more times. Assuming the default 5-second polling interval, checking the paths takes 20 seconds. If no path is up, multipathd tells the kernel to stop queuing and fails all outstanding and future I/O until a path is restored. When a path is restored, the 20-second delay is reset for the next time all paths fail. For more details, see <a href="https://gerrit.ovirt.org/#/c/88082/">the commit that changed this setting</a>.</p>
</dd>
<dt class="hdlist1"><code>polling_interval	5</code></dt>
<dd>
<p>This setting determines the number of seconds between polling attempts to detect whether a path is open or has failed. Unless the vendor provides a clear reason for increasing the value, keep the VDSM-generated default so the system responds to path failures sooner.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_the_self-hosted_engine_deployment_host_SHE_cli_deploy">4. Installing the Self-hosted Engine Deployment Host</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A self-hosted engine can be deployed from a <a href="#Installing_Red_Hat_Virtualization_Hosts_SHE_deployment_host">oVirt Node</a> or a <a href="#Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_deployment_host">Enterprise Linux host</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to use bonded interfaces for high availability or VLANs to separate different types of traffic (for example, for storage or management connections), you should configure them on the host before beginning the self-hosted engine deployment. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#networking-recommendations">Networking Recommendations</a> in the <em>Planning and Prerequisites Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Installing_Red_Hat_Virtualization_Hosts_SHE_deployment_host">4.1. Installing oVirt Nodes</h3>
<div class="paragraph">
<p>oVirt Node (oVirt Node) is a minimal operating system based on Enterprise Linux that is designed to provide a simple method for setting up a physical machine to act as a hypervisor in a oVirt environment. The minimal operating system contains only the packages required for the machine to act as a hypervisor, and features a Cockpit web interface for monitoring the host and performing administrative tasks. See <a href="http://cockpit-project.org/running.html" class="bare">http://cockpit-project.org/running.html</a> for the minimum browser requirements.</p>
</div>
<div class="paragraph">
<p>oVirt Node supports NIST 800-53 partitioning requirements to improve security. oVirt Node uses a NIST 800-53 partition layout by default.</p>
</div>
<div class="paragraph">
<p>The host must meet the minimum  <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index.html#host-requirements">host requirements</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Visit the <a href="https://ovirt.org/download/node.html">oVirt Node Download</a> page.</p>
</li>
<li>
<p>Choose the version of <strong>oVirt Node</strong> to download and click its <strong>Installation ISO</strong> link.</p>
</li>
<li>
<p>Write the oVirt Node Installation ISO disk image to a USB, CD, or DVD.</p>
</li>
<li>
<p>Start the machine on which you are installing oVirt Node, booting from the prepared installation media.</p>
</li>
<li>
<p>From the boot menu, select <strong>Install oVirt Node 4.5</strong> and press <code>Enter</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also press the <code>Tab</code> key to edit the kernel parameters. Kernel parameters must be separated by a space, and you can boot the system using the specified kernel parameters by pressing the <code>Enter</code> key. Press the <code>Esc</code> key to clear any changes to the kernel parameters and return to the boot menu.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select a language, and click <b class="button">Continue</b>.</p>
</li>
<li>
<p>Select a keyboard layout from the <strong>Keyboard Layout</strong> screen and click <b class="button">Done</b>.</p>
</li>
<li>
<p>Select the device on which to install oVirt Node from the <strong>Installation Destination</strong> screen. Optionally, enable encryption. Click <b class="button">Done</b>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <strong>Automatically configure partitioning</strong> option.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select a time zone from the <strong>Time &amp; Date</strong> screen and click <b class="button">Done</b>.</p>
</li>
<li>
<p>Select a network from the <strong>Network &amp; Host Name</strong> screen and click <strong>Configure&#8230;&#8203;</strong> to configure the connection details.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the connection every time the system boots, select the <strong>Connect automatically with priority</strong> check box. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/graphical-installation_graphical-installation#network-hostname_configuring-system-settings">Configuring network and host name options</a> in the <em>Enterprise Linux 8 Installation Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter a host name in the <strong>Host Name</strong> field, and click <strong>Done</strong>.</p>
</div>
</li>
<li>
<p>Optional: Configure <strong>Security Policy</strong> and <strong>Kdump</strong>. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/graphical-installation_graphical-installation">Customizing your RHEL installation using the GUI</a> in <em>Performing a standard RHEL installation</em> for Enterprise Linux 8 for more information on each of the sections in the <strong>Installation Summary</strong> screen.</p>
</li>
<li>
<p>Click <strong>Begin Installation</strong>.</p>
</li>
<li>
<p>Set a root password and, optionally, create an additional user while oVirt Node installs.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create untrusted users on oVirt Node, as this can lead to exploitation of local security vulnerabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Reboot</strong> to complete the installation.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When oVirt Node restarts, <code>nodectl check</code> performs a health check on the host and displays the result when you log in on the command line. The message <code>node status: OK</code> or <code>node status: DEGRADED</code> indicates the health status. Run <code>nodectl check</code> to get more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If necessary, you can <a href="#proc-Preventing_Kernel_Modules_from_Loading_Automatically_Install_nodes_RHVH"> prevent kernel modules from loading automatically</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_deployment_host">4.2. Installing Enterprise Linux hosts</h3>
<div class="paragraph">
<p>A Enterprise Linux host is based on a standard basic installation of Enterprise Linux 8 on a physical server, with the <code>Enterprise Linux Server</code> and <code>oVirt</code> repositories enabled.</p>
</div>
<div class="paragraph">
<p>The oVirt project also provides packages for Enterprise Linux 9 but only as a Technology Preview.</p>
</div>
<div class="paragraph">
<p>For detailed installation instructions, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/index.html"><em>Performing a standard EL installation</em></a>.</p>
</div>
<div class="paragraph">
<p>The host must meet the minimum <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#host-requirements">host requirements</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtualization must be enabled in your host&#8217;s BIOS settings. For information on changing your host&#8217;s BIOS settings, refer to your host&#8217;s hardware documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not install third-party watchdogs on Enterprise Linux hosts. They can interfere with the watchdog daemon provided by VDSM.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_the_Red_Hat_Virtualization_Manager_SHE_cli_deploy">5. Installing the oVirt Engine</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="proc_Manually_installing_the_appliance_install_RHVM">5.1. Manually installing the Engine Appliance</h3>
<div class="paragraph">
<p>When you deploy the self-hosted engine, the following sequence of events takes place:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The installer installs the Engine Appliance to the deployment host.</p>
</li>
<li>
<p>The appliance installs the Engine virtual machine.</p>
</li>
<li>
<p>The appliance installs the Engine on the Engine virtual machine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>However, you can install the appliance manually on the deployment host beforehand if you need to. The appliance is large and network connectivity issues might cause the appliance installation to take a long time, or possibly fail.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On Enterprise Linux hosts:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Reset the <code>virt</code> module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module reset virt</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If this module is already enabled in the Advanced Virtualization stream, this step is not necessary, but it has no negative impact.</p>
</div>
<div class="paragraph">
<p>You can see the value of the stream by entering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf module list virt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enable the <code>virt</code> module in the Advanced Virtualization stream with the following command:</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<ul>
<li>
<p>For oVirt 4.4.2:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module enable virt:8.2</code></pre>
</div>
</div>
</li>
<li>
<p>For oVirt 4.4.3 to 4.4.5:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module enable virt:8.3</code></pre>
</div>
</div>
</li>
<li>
<p>For oVirt 4.4.6 to 4.4.10:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module enable virt:av</code></pre>
</div>
</div>
</li>
<li>
<p>For oVirt 4.5 and later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable virt:rhel</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with EL 8.6 the Advanced virtualization packages will use the standard <code>virt:rhel</code> module. For EL 8.4 and 8.5, only one Advanced Virtualization stream is used, <code>rhel:av</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Synchronize installed packages to update them to the latest available versions:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf distro-sync --nobest</code></pre>
</div>
</div>
</li>
<li>
<p>Install the Engine Appliance to the host manually:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install ovirt-engine-appliance</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, when you deploy the self-hosted engine, the installer detects that the appliance is already installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="Enabling-and-configuring-firewall_install_RHVM">5.2. Enabling and configuring the firewall</h3>
<div class="paragraph _abstract">
<p><code>firewalld</code> must be installed and running before you run the self-hosted deployment script. You must also have an active zone with an interface configured.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><code>firewalld</code> is installed. <code>hosted-engine-setup</code> requires the <code>firewalld</code> package, so you do not need to do any additional steps.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Start <code>firewalld</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl unmask firewalld
# systemctl start firewalld</code></pre>
</div>
</div>
<div class="paragraph">
<p>To ensure firewalld starts automatically at system start, enter the following command as root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl enable firewalld</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that firewalld is running:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl status firewalld</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that your management interface is in a firewall zone via</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># firewall-cmd --get-active-zones</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now you are ready to deploy the self-hosted engine.</p>
</div>
</div>
<div class="sect2">
<h3 id="Deploying_the_Self-Hosted_Engine_Using_the_CLI_install_RHVM">5.3. Deploying the self-hosted engine using the command line</h3>
<div class="paragraph">
<p>You can deploy a self-hosted engine from the command line. After installing the setup package, you run the command <code>hosted-engine --deploy</code>, and a script collects the details of your environment and uses them to configure the host and the Engine.</p>
</div>
<div class="paragraph">
<p>You can customize the Engine virtual machine during deployment, either manually, by pausing the deployment, or using automation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Setting the variable <code>he_pause_host</code> to <code>true</code> pauses deployment after installing the Engine and adding the deployment host to the Engine.</p>
</li>
<li>
<p>Setting the variable <code>he_pause_before_engine_setup</code> to <code>true</code> pauses the deployment before installing the Engine and before restoring the Engine when using <code>he_restore_from_file</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the <code>he_pause_host</code> or <code>he_pause_before_engine_setup</code> variables are set to true a lock file is created at <code>/tmp</code> with the suffix <code>_he_setup_lock</code> on the deployment host. You can then manually customize the virtual machine as needed. The deployment continues after you delete the lock file, or after 24 hours, whichever comes first.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Adding an Ansible playbook to any of the following directories on the deployment host automatically runs the playbook. Add the playbook under one of the following directories under <code>/usr/share/ansible/collections/ansible_collections/redhat/rhv/roles/hosted_engine_setup/hooks/</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>enginevm_before_engine_setup</code></p>
</li>
<li>
<p><code>enginevm_after_engine_setup</code></p>
</li>
<li>
<p><code>after_add_host</code></p>
</li>
<li>
<p><code>after_setup</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>FQDNs prepared for your Engine and the host. Forward and reverse lookup records must both be set in the DNS.</p>
</li>
<li>
<p>When using a block storage domain, either FCP or iSCSI, a single target LUN is the only supported setup for a self-hosted engine.</p>
</li>
<li>
<p>Optional: If you want to customize the Engine virtual machine during deployment using automation, an Ansible playbook must be added. See <a href="#customizing_engine_vm_during_deployment_auto_SHE_cli_deploy">Customizing the Engine virtual machine using automation during deployment</a>.</p>
</li>
<li>
<p>The self-hosted engine setup script requires ssh public key access using 2048-bit RSA keys from the engine virtual machine to the root account of its bare metal host. In <code>/etc/ssh/sshd_config</code>, these values must be set as follows:</p>
<div class="ulist">
<ul>
<li>
<p><code>PubkeyAcceptedKeyTypes</code> must allow 2048-bit RSA keys or stronger.</p>
<div class="paragraph">
<p>By default, this setting uses system-wide crypto policies. For more information, see the manual page <code>crypto-policies(7)</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt Node hosts that are registered with the Engine in versions earlier than 4.4.5.5 require RSA 2048 for backward compatibility until all the keys are migrated.</p>
</div>
<div class="paragraph">
<p>oVirt Node hosts registered for 4.4.5.5 and later use the strongest algorithm that is supported by both the Engine and oVirt Node. The <code>PubkeyAcceptedKeyTypes</code> setting helps determine which algorithm is used.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>PermitRoolLogin</code> is set to <code>without-password</code> or <code>yes</code></p>
</li>
<li>
<p><code>PubkeyAuthentication</code> is set to <code>yes</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the deployment tool:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install ovirt-hosted-engine-setup</code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>tmux</code> window manager to run the script to avoid losing the session in case of network or terminal disruption.</p>
<div class="paragraph">
<p>Install and run <code>tmux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf -y install tmux
# tmux</pre>
</div>
</div>
</li>
<li>
<p>Start the deployment script:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, to pause the deployment after adding the deployment host to the Engine, use the command line option <code class="command">--ansible-extra-vars=he_pause_host=true</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy --ansible-extra-vars=he_pause_host=true</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To escape the script at any time, use the <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>D</kbd></span> keyboard combination to abort deployment. In the event of session timeout or connection disruption, run <code>tmux attach</code> to recover the deployment session.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When prompted, enter <strong>Yes</strong> to begin the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Continuing will configure this host for serving as hypervisor and will create a local VM with a running engine.
The locally running engine will be used to configure a new storage domain and create a VM there.
At the end the disk of the local VM will be moved to the shared storage.
Are you sure you want to continue? (Yes, No)[Yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the network. Check that the gateway shown is correct and press <kbd>Enter</kbd>. Enter a pingable address on the same subnet so the script can check the host&#8217;s connectivity.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please indicate a pingable gateway IP address [X.X.X.X]:</code></pre>
</div>
</div>
</li>
<li>
<p>The script detects possible NICs to use as a management bridge for the environment. Enter one of them or press <kbd>Enter</kbd> to accept the default.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please indicate a nic to set ovirtmgmt bridge on: (ens1, ens0) [ens1]:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify how to check network connectivity. The default is <code>dns</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify which way the network connectivity should be checked (ping, dns, tcp, none) [dns]:</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code><strong>ping</strong></code></dt>
<dd>
<p>Attempts to ping the gateway.</p>
</dd>
<dt class="hdlist1"><code><strong>dns</strong></code></dt>
<dd>
<p>Checks the connection to the DNS server.</p>
</dd>
<dt class="hdlist1"><code><strong>tcp</strong></code></dt>
<dd>
<p>Creates a TCP connection to a host and port combination. You need to specify a destination IP address and port. Once the connection is successfully created, the network is considered to be alive. Ensure that the given host is able to accept incoming TCP connections on the given port.</p>
</dd>
<dt class="hdlist1"><code><strong>none</strong></code></dt>
<dd>
<p>The network is always considered connected.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Enter a name for the data center in which to deploy the host for the self-hosted engine. The default name is <strong>Default</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the name of the data center where you want to deploy this hosted-engine host.
Data center [Default]:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter a name for the cluster in which to deploy the host for the self-hosted engine. The default name is <strong>Default</strong>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the name of the cluster where you want to deploy this hosted-engine host.
Cluster [Default]:</code></pre>
</div>
</div>
</li>
<li>
<p>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</p>
</li>
<li>
<p>To deploy with a custom Engine Appliance appliance image, specify the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">If you want to deploy with a custom engine appliance image, please specify the path to the OVA archive you would like to use.
 Entering no value will use the image from the rhvm-appliance rpm, installing it if needed.
 Appliance image path []:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the CPU and memory configuration for the Engine virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the number of virtual CPUs for the VM. The default is the appliance OVF value [4]:
Please specify the memory size of the VM in MB. The default is the maximum available [6824]:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the FQDN for the Engine virtual machine, such as <code>manager.example.com</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the FQDN you would like to use for the engine.
Note: This will be the FQDN of the engine VM you are now going to launch,
it should not point to the base host or to any other existing machine.
Engine VM FQDN []:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the domain of the Engine virtual machine. For example, if the FQDN is <code>manager.example.com</code>, then enter <code>example.com</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the domain name you would like to use for the engine appliance.
Engine VM domain: [example.com]</code></pre>
</div>
</div>
</li>
<li>
<p>Create the root password for the Engine, and reenter it to confirm:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Enter root password that will be used for the engine appliance:
Confirm appliance root password:</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: Enter an SSH public key to enable you to log in to the Engine virtual machine as the root user without entering a password, and specify whether to enable SSH access for the root user:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">You may provide an SSH public key, that will be added by the deployment script to the authorized_keys file of the root user in the engine appliance.
This should allow you passwordless login to the engine machine after deployment.
If you provide no key, authorized_keys will not be touched.
SSH public key []:

Do you want to enable ssh access for the root user (yes, no, without-password) [yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: You can apply the DISA STIG security profile on the Engine virtual machine. The DISA STIG profile is the default OpenSCAP profile.</p>
<div class="listingblock">
<div class="content">
<pre>Do you want to apply a default OpenSCAP security profile? (Yes, No) [No]:</pre>
</div>
</div>
</li>
<li>
<p>Enter a MAC address for the Engine virtual machine, or accept a randomly generated one. If you want to provide the Engine virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">You may specify a unicast MAC address for the VM or accept a randomly generated default [00:16:3e:3d:34:47]:</code></pre>
</div>
</div>
</li>
<li>
<p>Enter the Engine virtual machine&#8217;s networking details:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">How should the engine VM network be configured (DHCP, Static)[DHCP]?</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you specified <strong>Static</strong>, enter the IP address of the Engine virtual machine:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the Engine virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</p>
</li>
<li>
<p>For IPv6, oVirt supports only static addressing.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please enter the IP address to be used for the engine VM [x.x.x.x]:
Please provide a comma-separated list (max 3) of IP addresses of domain name servers for the engine VM
Engine VM DNS (leave it empty to skip):</code></pre>
</div>
</div>
</li>
<li>
<p>Specify whether to add entries for the Engine virtual machine and the base host to the virtual machine&#8217;s <code>/etc/hosts</code> file. You must ensure that the host names are resolvable.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Add lines for the appliance itself and for this host to /etc/hosts on the engine VM?
Note: ensuring that this host could resolve the engine VM hostname is still up to you.
Add lines to /etc/hosts? (Yes, No)[Yes]:</code></pre>
</div>
</div>
</li>
<li>
<p>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications. Alternatively, press <kbd>Enter</kbd> to accept the defaults:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the name of the SMTP server through which we will send notifications [localhost]:
Please provide the TCP port number of the SMTP server [25]:
Please provide the email address from which notifications will be sent [root@localhost]:
Please provide a comma-separated list of email addresses which will get notifications [root@localhost]:</code></pre>
</div>
</div>
</li>
<li>
<p>Create a password for the <code>admin@internal</code> user to access the Administration Portal and reenter it to confirm:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Enter engine admin password:
Confirm engine admin password:</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the hostname of the deployment host:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please provide the hostname of this host on the management network [hostname.example.com]:</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script creates the virtual machine. By default, the script first downloads and installs the Engine Appliance, which increases the installation time.</p>
</div>
</li>
<li>
<p>Optional: If you set the variable <code>he_pause_host: true</code>, the deployment pauses after adding the deployment host to the Engine. You can now log in from the deployment host to the Engine virtual machine to customize it. You can log in with either the FQDN or the IP address of the Engine. For example, if the FQDN of the Engine is <code>manager.example.com</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">$ ssh root@manager.example.com</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the installation log, the IP address is in <code>local_vm_ip</code>. The installation log is the most recent instance of <code>/var/log/ovirt-hosted-engine-setup/ovirt-hosted-engine-setup-ansible-bootstrap_local_vm*</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Customize the Engine virtual machine as needed.</p>
</li>
<li>
<p>When you are done, log in to the Administration Portal using a browser with the Engine FQDN and make sure that the host&#8217;s state is <strong>Up</strong>.</p>
</li>
<li>
<p>Delete the lock file and the deployment script automatically continues, configuring the Engine virtual machine.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Select the type of storage to use:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the storage you would like to use (glusterfs, iscsi, fc, nfs)[nfs]:</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>For NFS, enter the version, full address and path to the storage, and any mount options:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the nfs version you would like to use (auto, v3, v4, v4_1)[auto]:
Please specify the full shared storage connection path to use (example: host:/path): <em>storage.example.com:/hosted_engine/nfs</em>
If needed, specify additional mount options for the connection to the hosted-engine storage domain []:</code></pre>
</div>
</div>
</li>
<li>
<p>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><em>Enterprise Linux DM Multipath</em></a> for details. There is also a <a href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</a> tool that generates a script to install and configure multipath with different options.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>Please specify the iSCSI portal IP address:
Please specify the iSCSI portal port [3260]:
Please specify the iSCSI discover user:
Please specify the iSCSI discover password:
Please specify the iSCSI portal login user:
Please specify the iSCSI portal login password:

The following targets have been found:
	[1]	iqn.2017-10.com.redhat.example:he
		TPGT: 1, portals:
			192.168.1.xxx:3260
			192.168.2.xxx:3260
			192.168.3.xxx:3260

Please select a target (1) [1]: 1

The following luns have been found on the requested target:
  [1] 360003ff44dc75adcb5046390a16b4beb   199GiB  MSFT   Virtual HD
      status: free, paths: 1 active

Please select the destination LUN (1) [1]:</pre>
</div>
</div>
</li>
<li>
<p>For Gluster storage, enter the full address and path to the storage, and any mount options:</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">gluster volume set <em>VOLUME_NAME</em> group virt
gluster volume set <em>VOLUME_NAME</em> performance.strict-o-direct on
gluster volume set <em>VOLUME_NAME</em> network.remote-dio off
gluster volume set <em>VOLUME_NAME</em> storage.owner-uid 36
gluster volume set <em>VOLUME_NAME</em> storage.owner-gid 36
gluster volume set <em>VOLUME_NAME</em> network.ping-timeout 30</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please specify the full shared storage connection path to use (example: host:/path): <em>storage.example.com:/hosted_engine/gluster_volume</em>
If needed, specify additional mount options for the connection to the hosted-engine storage domain []:</code></pre>
</div>
</div>
</li>
<li>
<p>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <a href="https://ovirt.org/documentation/administration_guide/index#Reusing_LUNs">Reusing LUNs</a> in the <em>Administration Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre>The following luns have been found on the requested target:
[1] 3514f0c5447600351   30GiB   XtremIO XtremApp
		status: used, paths: 2 active

[2] 3514f0c5447600352   30GiB   XtremIO XtremApp
		status: used, paths: 2 active

Please select the destination LUN (1, 2) [1]:</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the disk size of the Engine virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre>Please specify the size of the VM disk in GB: [50]:</pre>
</div>
</div>
<div class="paragraph">
<p>When the deployment completes successfully, one data center, cluster, host, storage domain, and the Engine virtual machine are already running. You can log in to the Administration Portal to add any other resources.</p>
</div>
</li>
<li>
<p>Optional: Add a directory server using the <code>ovirt-engine-extension-aaa-ldap-setup</code> interactive setup script so you can add additional users to the environment. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#sect-Configuring_an_External_LDAP_Provider">Configuring an External LDAP Provider</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Optional: Deploy Grafana so you can monitor and display reports from your oVirt environment.
For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#configuring_grafana">Configuring Grafana</a> in the <em>Administration Guide</em>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine virtual machine, the host running it, and the self-hosted engine storage domain are flagged with a gold crown in the Administration Portal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Both the Engine&#8217;s I/O scheduler and the hypervisor that hosts the Engine reorder I/O requests. This double reordering might delay I/O requests to the storage layer, impacting performance.</p>
</div>
<div class="paragraph">
<p>Depending on your data center, you might improve performance by changing the I/O scheduler to <code>none</code>. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance">Available disk schedulers</a> in <em>Monitoring and managing system status and performance</em> for RHEL.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next step is to enable the oVirt Engine repositories.</p>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_install_RHVM">5.4. Enabling the oVirt Engine Repositories</h3>
<div class="paragraph">
<p>Ensure the correct repositories are enabled.</p>
</div>
<div class="paragraph">
<p>For oVirt 4.5:
If you are going to install on RHEL or derivatives please follow <a href="/ovirt-site/previews/2982/download/install_on_rhel.html">Installing on RHEL or derivatives</a> first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install -y centos-release-ovirt45</code></pre>
</div>
</div>
<div class="paragraph">
<p>For oVirt 4.4:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></code></pre>
</div>
</div>
<div class="paragraph">
<p>Common procedure valid for both 4.4 and 4.5:</p>
</div>
<div class="paragraph">
<p>You can check which repositories are currently enabled by running <code>dnf repolist</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>javapackages-tools</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable javapackages-tools</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the <code>pki-deps</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable pki-deps</code></pre>
</div>
</div>
</li>
<li>
<p>Enable version 12 of the <code>postgresql</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable postgresql:12</code></pre>
</div>
</div>
</li>
<li>
<p>Enable version 2.3 of the <code>mod_auth_openidc</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable mod_auth_openidc:2.3</code></pre>
</div>
</div>
</li>
<li>
<p>Enable version 14 of the <code>nodejs</code> module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable nodejs:14</code></pre>
</div>
</div>
</li>
<li>
<p>Synchronize installed packages to update them to the latest available versions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf distro-sync --nobest</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For information on modules and module streams, see the following sections in <em>Installing, managing, and removing user-space components</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Log in to the Administration Portal, where you can add hosts and storage to the environment:</p>
</div>
</div>
<div class="sect2">
<h3 id="Connecting_to_the_Administration_Portal_install_RHVM">5.5. Connecting to the Administration Portal</h3>
<div class="paragraph">
<p>Access the Administration Portal using a web browser.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In a web browser, navigate to <code>https://<em>manager-fqdn</em>/ovirt-engine</code>, replacing <em>manager-fqdn</em> with the FQDN that you provided during installation.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can access the Administration Portal using alternate host names or IP addresses. To do so, you need to add a configuration file under <strong>/etc/ovirt-engine/engine.conf.d/</strong>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># vi /etc/ovirt-engine/engine.conf.d/99-custom-sso-setup.conf
SSO_ALTERNATE_ENGINE_FQDNS=&quot;_alias1.example.com alias2.example.com_&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The list of alternate host names needs to be separated by spaces. You can also add the IP address of the Engine to the list, but using IP addresses instead of DNS-resolvable host names is not recommended.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Administration Portal</strong>. An SSO login page displays. SSO login enables you to log in to the Administration and VM Portal at the same time.</p>
</li>
<li>
<p>Enter your <strong>User Name</strong> and <strong>Password</strong>. If you are logging in for the first time, use the user name <strong>admin</strong> along with the password that you specified during installation.</p>
</li>
<li>
<p>Select the <strong>Domain</strong> to authenticate against. If you are logging in using the internal <strong>admin</strong> user name, select the <strong>internal</strong> domain.</p>
</li>
<li>
<p>Click <strong>Log In</strong>.</p>
</li>
<li>
<p>You can view the Administration Portal in multiple languages. The default selection is chosen based on the locale settings of your web browser. If you want to view the Administration Portal in a language other than the default, select your preferred language from the drop-down list on the welcome page.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To log out of the oVirt Administration Portal, click your user name in the header bar and click <strong>Sign Out</strong>. You are logged out of all portals and the Engine welcome screen displays.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing_Hosts_for_RHV_SHE_cli_deploy">6. Installing Hosts for oVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>oVirt supports two types of hosts: <a href="#Red_Hat_Virtualization_Hosts_SHE_cli_deploy">oVirt Nodes (oVirt Node)</a> and <a href="#Red_Hat_Enterprise_Linux_hosts_SHE_cli_deploy">Enterprise Linux hosts</a>. Depending on your environment, you may want to use one type only, or both. At least two hosts are required for features such as migration and high availability.</p>
</div>
<div class="paragraph">
<p>See <a href="#Recommended_practices_for_configuring_host_networks_SHE_cli_deploy">Recommended practices for configuring host networks</a> for networking information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SELinux is in enforcing mode upon installation. To verify, run <code>getenforce</code>. SELinux must be in enforcing mode on all hosts and Managers for your oVirt environment to be supported.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Host Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Host Type</th>
<th class="tableblock halign-left valign-top">Other Names</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>oVirt Node</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oVirt Node, thin host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a minimal operating system based on Enterprise Linux. It is distributed as an ISO file from the Customer Portal and contains only the packages required for the machine to act as a host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enterprise Linux host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Linux host, thick host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Linux systems with the appropriate repositories enabled can be used as hosts.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Host Compatibility</div>
<p>When you create a new data center, you can set the compatibility version. Select the compatibility version that suits all the hosts in the data center. Once set, version regression is not allowed. For a fresh oVirt installation, the latest compatibility version is set in the default data center and default cluster; to use an earlier compatibility version, you must create additional data centers and clusters.</p>
</div>
<div class="sect2">
<h3 id="Red_Hat_Virtualization_Hosts_SHE_cli_deploy">6.1. oVirt Nodes</h3>
<div class="sect3">
<h4 id="Installing_Red_Hat_Virtualization_Hosts_SHE_cli_deploy">6.1.1. Installing oVirt Nodes</h4>
<div class="paragraph">
<p>oVirt Node (oVirt Node) is a minimal operating system based on Enterprise Linux that is designed to provide a simple method for setting up a physical machine to act as a hypervisor in a oVirt environment. The minimal operating system contains only the packages required for the machine to act as a hypervisor, and features a Cockpit web interface for monitoring the host and performing administrative tasks. See <a href="http://cockpit-project.org/running.html" class="bare">http://cockpit-project.org/running.html</a> for the minimum browser requirements.</p>
</div>
<div class="paragraph">
<p>oVirt Node supports NIST 800-53 partitioning requirements to improve security. oVirt Node uses a NIST 800-53 partition layout by default.</p>
</div>
<div class="paragraph">
<p>The host must meet the minimum  <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index.html#host-requirements">host requirements</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Visit the <a href="https://ovirt.org/download/node.html">oVirt Node Download</a> page.</p>
</li>
<li>
<p>Choose the version of <strong>oVirt Node</strong> to download and click its <strong>Installation ISO</strong> link.</p>
</li>
<li>
<p>Write the oVirt Node Installation ISO disk image to a USB, CD, or DVD.</p>
</li>
<li>
<p>Start the machine on which you are installing oVirt Node, booting from the prepared installation media.</p>
</li>
<li>
<p>From the boot menu, select <strong>Install oVirt Node 4.5</strong> and press <code>Enter</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also press the <code>Tab</code> key to edit the kernel parameters. Kernel parameters must be separated by a space, and you can boot the system using the specified kernel parameters by pressing the <code>Enter</code> key. Press the <code>Esc</code> key to clear any changes to the kernel parameters and return to the boot menu.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select a language, and click <b class="button">Continue</b>.</p>
</li>
<li>
<p>Select a keyboard layout from the <strong>Keyboard Layout</strong> screen and click <b class="button">Done</b>.</p>
</li>
<li>
<p>Select the device on which to install oVirt Node from the <strong>Installation Destination</strong> screen. Optionally, enable encryption. Click <b class="button">Done</b>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use the <strong>Automatically configure partitioning</strong> option.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select a time zone from the <strong>Time &amp; Date</strong> screen and click <b class="button">Done</b>.</p>
</li>
<li>
<p>Select a network from the <strong>Network &amp; Host Name</strong> screen and click <strong>Configure&#8230;&#8203;</strong> to configure the connection details.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To use the connection every time the system boots, select the <strong>Connect automatically with priority</strong> check box. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/graphical-installation_graphical-installation#network-hostname_configuring-system-settings">Configuring network and host name options</a> in the <em>Enterprise Linux 8 Installation Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enter a host name in the <strong>Host Name</strong> field, and click <strong>Done</strong>.</p>
</div>
</li>
<li>
<p>Optional: Configure <strong>Security Policy</strong> and <strong>Kdump</strong>. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/graphical-installation_graphical-installation">Customizing your RHEL installation using the GUI</a> in <em>Performing a standard RHEL installation</em> for Enterprise Linux 8 for more information on each of the sections in the <strong>Installation Summary</strong> screen.</p>
</li>
<li>
<p>Click <strong>Begin Installation</strong>.</p>
</li>
<li>
<p>Set a root password and, optionally, create an additional user while oVirt Node installs.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create untrusted users on oVirt Node, as this can lead to exploitation of local security vulnerabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Reboot</strong> to complete the installation.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When oVirt Node restarts, <code>nodectl check</code> performs a health check on the host and displays the result when you log in on the command line. The message <code>node status: OK</code> or <code>node status: DEGRADED</code> indicates the health status. Run <code>nodectl check</code> to get more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If necessary, you can <a href="#proc-Preventing_Kernel_Modules_from_Loading_Automatically_Install_nodes_RHVH"> prevent kernel modules from loading automatically</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc_installing-a-third-party-package-on-ovirt-node_SHE_cli_deploy">6.1.2. Installing a third-party package on oVirt-node</h4>
<div class="paragraph _abstract">
<p>If you need a package that is not included in the oVirt provided repository, you need to provide the repository before you can install the package.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The path to the repository that includes the package you want to install.</p>
</li>
<li>
<p>You are logged in to the host with root permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Open an existing <code>.repo</code> file or create a new one in <code>/etc/yum.repos.d/</code>.</p>
</li>
<li>
<p>Add an entry to the <code>.repo</code> file. For example, to install <code>sssd-ldap</code>, add the following entry to a new <code>.repo</code> file name <code>third-party.repo</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># imgbased: set-enabled
[custom-sssd-ldap]
name = Provides sssd-ldap
mirrorlist=http://mirrorlist.centos.org/?release=$stream&amp;arch=$basearch&amp;repo=BaseOS&amp;infra=$infra
#baseurl=http://mirror.centos.org/$contentdir/$stream/BaseOS/$basearch/os/
gpgcheck=1
enabled=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial
includepkgs = sssd-ldap</code></pre>
</div>
</div>
</li>
<li>
<p>Install ` sssd-ldap`:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install sssd-ldap</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Advanced_RHVH_Install_SHE_cli_deploy">6.1.3. Advanced Installation</h4>
<div class="sect4">
<h5 id="Custom_Partitioning_SHE_cli_deploy">Custom Partitioning</h5>
<div class="paragraph">
<p>Custom partitioning on oVirt Node (oVirt Node) is not recommended. Use the <strong>Automatically configure partitioning</strong> option in the <strong>Installation Destination</strong> window.</p>
</div>
<div class="paragraph">
<p>If your installation requires custom partitioning, select the <code>I will configure partitioning</code> option during the installation, and note that the following restrictions apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure the default <strong>LVM Thin Provisioning</strong> option is selected in the <strong>Manual Partitioning</strong> window.</p>
</li>
<li>
<p>The following directories are required and must be on thin provisioned logical volumes:</p>
<div class="ulist">
<ul>
<li>
<p>root (<code>/</code>)</p>
</li>
<li>
<p><code>/home</code></p>
</li>
<li>
<p><code>/tmp</code></p>
</li>
<li>
<p><code>/var</code></p>
</li>
<li>
<p><code>/var/crash</code></p>
</li>
<li>
<p><code>/var/log</code></p>
</li>
<li>
<p><code>/var/log/audit</code></p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create a separate partition for <code>/usr</code>. Doing so will cause the installation to fail.</p>
</div>
<div class="paragraph">
<p><code>/usr</code> must be on a logical volume that is able to change versions along with oVirt Node, and therefore should be left on root (<code>/</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For information about the required storage sizes for each partition, see <a href="#Storage_Requirements_SHE_cli_deploy">Storage Requirements</a>.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The <code>/boot</code> directory should be defined as a standard partition.</p>
</li>
<li>
<p>The <code>/var</code> directory must be on a separate volume or disk.</p>
</li>
<li>
<p>Only XFS or Ext4 file systems are supported.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Manual Partitioning in a Kickstart File</strong></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The following example demonstrates how to configure manual partitioning in a Kickstart file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">clearpart --all
part /boot --fstype xfs --size=1000 --ondisk=sda
part pv.01 --size=42000 --grow
volgroup HostVG pv.01 --reserved-percent=20
logvol swap --vgname=HostVG --name=swap --fstype=swap --recommended
logvol none --vgname=HostVG --name=HostPool --thinpool --size=40000 --grow
logvol / --vgname=HostVG --name=root --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=6000 --grow
logvol /var --vgname=HostVG --name=var --thin --fstype=ext4 --poolname=HostPool
--fsoptions=&quot;defaults,discard&quot; --size=15000
logvol /var/crash --vgname=HostVG --name=var_crash --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=10000
logvol /var/log --vgname=HostVG --name=var_log --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=8000
logvol /var/log/audit --vgname=HostVG --name=var_audit --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=2000
logvol /home --vgname=HostVG --name=home --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=1000
logvol /tmp --vgname=HostVG --name=tmp --thin --fstype=ext4 --poolname=HostPool --fsoptions=&quot;defaults,discard&quot; --size=1000</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use <code>logvol --thinpool --grow</code>, you must also include <code>volgroup --reserved-space</code> or <code>volgroup --reserved-percent</code> to reserve space in the volume group for the thin pool to grow.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="proc_installing-a-dud-driver-on-a-host-without-installer-support_SHE_cli_deploy">Installing a DUD driver on a host without installer support</h5>
<div class="paragraph _abstract">
<p>There are times when installing oVirt Node (oVirt Node) requires a Driver Update Disk (DUD), such as when using a hardware RAID device that is not supported by the default configuration of oVirt Node. In contrast with Enterprise Linux hosts, oVirt Node does not fully support using a DUD. Subsequently the host fails to boot normally after installation because it does not see RAID. Instead it boots into emergency mode.</p>
</div>
<div class="paragraph">
<p>Example output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Warning: /dev/test/rhvh-4.4-20210202.0+1 does not exist
Warning: /dev/test/swap does not exist
Entering emergency mode. Exit the shell to continue.</pre>
</div>
</div>
<div class="paragraph">
<p>In such a case you can manually add the drivers before finishing the installation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A machine onto which you are installing oVirt Node.</p>
</li>
<li>
<p>A DUD.</p>
</li>
<li>
<p>If you are using a USB drive for the DUD and oVirt Node, you must have at least two available USB ports.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Load the DUD on the host machine.</p>
<div class="paragraph">
<p>You can search for DUDs or modules for CentOS Stream at the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://elrepo.org/linux/dud/el8/x86_64/">DUDs at the ELRepo Project</a></p>
</li>
<li>
<p><a href="https://wiki.centos.org/SpecialInterestGroup/Kmods">Kmods Special Interest Group</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>Install oVirt Node. See <a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index#Installing_Red_Hat_Virtualization_Hosts_SHE_cli_deploy">Installing oVirt Nodes</a> in <em>Installing oVirt as a self-hosted engine using the command line</em>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installation completes, do not reboot the system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to access the DUD using SSH, do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the string <strong><code> inst.sshd</code></strong> to the kernel command line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;<em>kernel_command_line</em>&gt; inst.sshd</pre>
</div>
</div>
</li>
<li>
<p>Enable networking during the installation.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the console mode, by pressing <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>F3</kbd>. Alternatively you can connect to it using SSH.</p>
</li>
<li>
<p>Mount the DUD:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /mnt/dud
# mount -r /dev/<em>&lt;dud_device&gt;</em> /mnt/dud</pre>
</div>
</div>
</li>
<li>
<p>Copy the RPM file inside the DUD to the target machine&#8217;s disk:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /mnt/dud/rpms/<em>&lt;path&gt;</em>/<em>&lt;rpm_file&gt;</em>.rpm /mnt/sysroot/root/</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /mnt/dud/rpms/x86_64/kmod-3w-9xxx-2.26.02.014-5.el8_3.elrepo.x86_64.rpm /mnt/sysroot/root/</pre>
</div>
</div>
</li>
<li>
<p>Change the root directory to <code>/mnt/sysroot</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chroot /mnt/sysroot</pre>
</div>
</div>
</li>
<li>
<p>Back up the current initrd images. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img.bck1
# cp -p /boot/ovirt-node-ng-4.4.5.1-0.20210323.0+1/initramfs-4.18.0-240.15.1.el8_3.x86_64.img /boot/ovirt-node-ng-4.4.5.1-0.20210323.0+1/initramfs-4.18.0-240.15.1.el8_3.x86_64.img.bck1</pre>
</div>
</div>
</li>
<li>
<p>Install the RPM file for the driver from the copy you made earlier.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install /root/kmod-3w-9xxx-2.26.02.014-5.el8_3.elrepo.x86_64.rpm</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This package is not visible on the system after you reboot into the installed environment, so if you need it, for example, to rebuild the <code>initramfs</code>, you need to install that package once again, after which the package remains.</p>
</div>
<div class="paragraph">
<p>If you update the host using <code>dnf</code>, the driver update persists, so you do not need to repeat this process.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you do not have an internet connection, use the <code>rpm</code> command instead of <code>dnf</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rpm -ivh /root/kmod-3w-9xxx-2.26.02.014-5.el8_3.elrepo.x86_64.rpm</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a new image, forcefully adding the driver:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dracut --force --add-drivers <em>&lt;module_name&gt;</em> --kver <em>&lt;kernel_version&gt;</em></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dracut --force --add-drivers 3w-9xxx --kver 4.18.0-240.15.1.el8_3.x86_64</pre>
</div>
</div>
</li>
<li>
<p>Check the results. The new image should be larger, and include the driver. For example, compare the sizes of the original, backed-up image file and the new image file.</p>
<div class="paragraph">
<p>In this example, the new image file is 88739013 bytes, larger than the original 88717417 bytes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ls -ltr /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img*
-rw-------. 1 root root 88717417 Jun  2 14:29 /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img.bck1
-rw-------. 1 root root 88739013 Jun  2 17:47 /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img</pre>
</div>
</div>
<div class="paragraph">
<p>The new drivers should be part of the image file. For example, the 3w-9xxx module should be included:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># lsinitrd /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img | grep 3w-9xxx
drwxr-xr-x   2 root     root            0 Feb 22 15:57 usr/lib/modules/4.18.0-240.15.1.el8_3.x86_64/weak-updates/3w-9xxx
lrwxrwxrwx   1 root     root           55 Feb 22 15:57 usr/lib/modules/4.18.0-240.15.1.el8_3.x86_64/weak-updates/3w-9xxx/3w-9xxx.ko-../../../4.18.0-240.el8.x86_64/extra/3w-9xxx/3w-9xxx.ko
drwxr-xr-x   2 root     root            0 Feb 22 15:57 usr/lib/modules/4.18.0-240.el8.x86_64/extra/3w-9xxx
-rw-r--r--   1 root     root        80121 Nov 10  2020 usr/lib/modules/4.18.0-240.el8.x86_64/extra/3w-9xxx/3w-9xxx.ko</pre>
</div>
</div>
</li>
<li>
<p>Copy the image to the the directory under <code>/boot</code> that contains the kernel to be used in the layer being installed, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /boot/initramfs-4.18.0-240.15.1.el8_3.x86_64.img /boot/ovirt-node-ng-4.4.5.1-0.20210323.0+1/initramfs-4.18.0-240.15.1.el8_3.x86_64.img</pre>
</div>
</div>
</li>
<li>
<p>Exit chroot.</p>
</li>
<li>
<p>Exit the shell.</p>
</li>
<li>
<p>If you used <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>F3</kbd> to access a virtual terminal, then move back to the installer by pressing <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>F_&lt;n&gt;_</kbd>, usually <kbd>F1</kbd> or <kbd>F5</kbd></p>
</li>
<li>
<p>At the installer screen, reboot.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>The machine should reboot successfully.</p>
</div>
</div>
<div class="sect4">
<h5 id="Automating_RHVH_Deployment_SHE_cli_deploy">Automating oVirt Node deployment</h5>
<div class="paragraph">
<p>You can install oVirt Node (oVirt Node) without a physical media device by booting from a PXE server over the network with a Kickstart file that contains the answers to the installation questions.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>General instructions for installing from a PXE server with a Kickstart file are available in the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/installation_guide/chap-kickstart-installations"><em>Enterprise Linux Installation Guide</em></a>, as oVirt Node is installed in much the same way as Enterprise Linux. oVirt Node-specific instructions, with examples for deploying oVirt Node with Red Hat Satellite, are described below.</p>
</div>
<div class="paragraph">
<p>The automated oVirt Node deployment has 3 stages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Preparing_the_Installation_Environment">Preparing the Installation Environment</a></p>
</li>
<li>
<p><a href="#Configuring_the_PXE_Server_and_the_Boot_Loader">Configuring the PXE Server and the Boot Loader</a></p>
</li>
<li>
<p><a href="#Creating_and_Running_a_Kickstart_File">Creating and Running a Kickstart File</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="Preparing_the_Installation_Environment">Preparing the installation environment</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Visit the <a href="https://ovirt.org/download/node.html">oVirt Node Download</a> page.</p>
</li>
<li>
<p>Choose the version of <strong>oVirt Node</strong> to download and click its <strong>Installation ISO</strong> link.</p>
</li>
<li>
<p>Make the oVirt Node ISO image available over the network. See <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Installation_Guide/sect-making-media-additional-sources.html#sect-making-media-sources-network">Installation Source on a Network</a> in the <em>Enterprise Linux Installation Guide</em>.</p>
</li>
<li>
<p>Extract the <strong>squashfs.img</strong> hypervisor image file from the oVirt Node ISO:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># mount -o loop <em>/path/to/oVirt Node-ISO</em> /mnt/rhvh
# cp /mnt/rhvh/Packages/redhat-virtualization-host-image-update* /tmp
# cd /tmp
# rpm2cpio redhat-virtualization-host-image-update* | cpio -idmv</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <strong>squashfs.img</strong> file, located in the <code>/tmp/usr/share/redhat-virtualization-host/image/</code> directory, is called <strong>redhat-virtualization-host-<em>version_number</em>_version.squashfs.img</strong>. It contains the hypervisor image for installation on the physical machine. It should not be confused with the <strong>/LiveOS/squashfs.img</strong> file, which is used by the Anaconda <code>inst.stage2</code> option.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="Configuring_the_PXE_Server_and_the_Boot_Loader">Configuring the PXE server and the boot loader</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the PXE server. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Installation_Guide/chap-installation-server-setup.html">Preparing for a Network Installation</a> in the <em>Enterprise Linux Installation Guide</em>.</p>
</li>
<li>
<p>Copy the oVirt Node boot images to the <code>/tftpboot</code> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp mnt/rhvh/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/pxelinux/</code></pre>
</div>
</div>
</li>
<li>
<p>Create a <code>rhvh</code> label specifying the oVirt Node boot images in the boot loader configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">LABEL rhvh
MENU LABEL Install oVirt Node
KERNEL /var/lib/tftpboot/pxelinux/vmlinuz
APPEND initrd=/var/lib/tftpboot/pxelinux/initrd.img inst.stage2=<em>URL/to/oVirt Node-ISO</em></code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">oVirt Node Boot loader configuration example for Red Hat Satellite</div>
<p>If you are using information from Red Hat Satellite to provision the host, you must create a global or host group level parameter called <code>rhvh_image</code> and populate it with the directory URL where the ISO is mounted or extracted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">&lt;%#
kind: PXELinux
name: oVirt Node PXELinux
%&gt;
# Created for booting new hosts
#

DEFAULT rhvh

LABEL rhvh
KERNEL &lt;%= @kernel %&gt;
APPEND initrd=&lt;%= @initrd %&gt; inst.ks=&lt;%= foreman_url(&quot;provision&quot;) %&gt; inst.stage2=&lt;%= @host.params[&quot;rhvh_image&quot;] %&gt; intel_iommu=on console=tty0 console=ttyS1,115200n8 ssh_pwauth=1 local_boot_trigger=&lt;%= foreman_url(&quot;built&quot;) %&gt;
IPAPPEND 2</code></pre>
</div>
</div>
</li>
<li>
<p>Make the content of the oVirt Node ISO locally available and export it to the network, for example, using an HTTPD server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp -a /mnt/rhvh/ /var/www/html/rhvh-install
# curl <em>URL/to/oVirt Node-ISO</em>/rhvh-install</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="Creating_and_Running_a_Kickstart_File">Creating and running a Kickstart file</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Kickstart file and make it available over the network. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Installation_Guide/chap-kickstart-installations.html">Kickstart Installations</a> in the <em>Enterprise Linux Installation Guide</em>.</p>
</li>
<li>
<p>Ensure that the Kickstart file meets the following oVirt-specific requirements:</p>
<div class="ulist">
<ul>
<li>
<p>The <code>%packages</code> section is not required for oVirt Node. Instead, use the <code>liveimg</code> option and specify the <strong>redhat-virtualization-host-<em>version_number</em>_version.squashfs.img</strong> file from the oVirt Node ISO image:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">liveimg --url=<em>example.com</em>/tmp/usr/share/redhat-virtualization-host/image/redhat-virtualization-host-<em>version_number</em>_version.squashfs.img</code></pre>
</div>
</div>
</li>
<li>
<p>Autopartitioning is highly recommended, but use caution: ensure that the local disk is detected first, include the <code>ignoredisk</code> command, and specify the local disk to ignore, such as <code>sda</code>.  To ensure that a particular drive is used, oVirt recommends using <code>ignoredisk --only-use=/dev/disk/&lt;<em>path</em>&gt;</code> or <code>ignoredisk --only-use=/dev/disk/&lt;<em>ID</em>&gt;</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">autopart --type=thinp
ignoredisk --only-use=sda
ignoredisk --only-use=/dev/disk/&lt;<em>path</em>&gt;
ignoredisk --only-use=/dev/disk/&lt;<em>ID</em>&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Autopartitioning requires thin provisioning.</p>
</div>
<div class="paragraph">
<p>The <code>--no-home</code> option does not work in oVirt Node because <code>/home</code> is a required directory.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your installation requires manual partitioning, see <a href="#Custom_Partitioning_SHE_cli_deploy">Custom Partitioning</a> for a list of limitations that apply to partitions and an example of manual partitioning in a Kickstart file.</p>
</div>
</li>
<li>
<p>A <code>%post</code> section that calls the <code>nodectl init</code> command is required:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">%post
nodectl init
%end</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ensure that the <code>nodectl init</code> command is at the very end of the <code>%post</code> section but before the reboot code, if any.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Kickstart example for deploying oVirt Node on its own</div>
<p>This Kickstart example shows you how to deploy oVirt Node. You can include additional commands and options as required.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This example assumes that all disks are empty and can be initialized. If you have attached disks with data, either remove them or add them to the <code>ignoredisks</code> property.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">liveimg --url=http://<em>FQDN</em>/tmp/usr/share/redhat-virtualization-host/image/redhat-virtualization-host-<em>version_number</em>_version.squashfs.img
clearpart --all
autopart --type=thinp
rootpw --plaintext ovirt
timezone --utc America/Phoenix
zerombr
text

reboot

%post --erroronfail
nodectl init
%end</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Add the Kickstart file location to the boot loader configuration file on the PXE server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">APPEND initrd=/var/tftpboot/pxelinux/initrd.img inst.stage2=<em>URL/to/oVirt Node-ISO</em> inst.ks=<em>URL/to/oVirt Node-ks</em>.cfg</code></pre>
</div>
</div>
</li>
<li>
<p>Install oVirt Node following the instructions in <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Installation_Guide/chap-booting-installer-x86.html#sect-booting-from-pxe-x86">Booting from the Network Using PXE</a> in the <em>Enterprise Linux Installation Guide</em>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Red_Hat_Enterprise_Linux_hosts_SHE_cli_deploy">6.2. Enterprise Linux hosts</h3>
<div class="sect3">
<h4 id="Installing_Red_Hat_Enterprise_Linux_Hosts_SHE_cli_deploy">6.2.1. Installing Enterprise Linux hosts</h4>
<div class="paragraph">
<p>A Enterprise Linux host is based on a standard basic installation of Enterprise Linux 8 on a physical server, with the <code>Enterprise Linux Server</code> and <code>oVirt</code> repositories enabled.</p>
</div>
<div class="paragraph">
<p>The oVirt project also provides packages for Enterprise Linux 9 but only as a Technology Preview.</p>
</div>
<div class="paragraph">
<p>For detailed installation instructions, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_installation/index.html"><em>Performing a standard EL installation</em></a>.</p>
</div>
<div class="paragraph">
<p>The host must meet the minimum <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#host-requirements">host requirements</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtualization must be enabled in your host&#8217;s BIOS settings. For information on changing your host&#8217;s BIOS settings, refer to your host&#8217;s hardware documentation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not install third-party watchdogs on Enterprise Linux hosts. They can interfere with the watchdog daemon provided by VDSM.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Installing_Cockpit_on_Linux_Hosts_SHE_cli_deploy">6.2.2. Installing Cockpit on Enterprise Linux hosts</h4>
<div class="paragraph">
<p>You can install Cockpit for monitoring the host&#8217;s resources and performing administrative tasks.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the dashboard packages:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install cockpit-ovirt-dashboard</code></pre>
</div>
</div>
</li>
<li>
<p>Enable and start the <code>cockpit.socket</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl enable cockpit.socket
# systemctl start cockpit.socket</code></pre>
</div>
</div>
</li>
<li>
<p>Check if Cockpit is an active service in the firewall:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># firewall-cmd --list-services</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see <code>cockpit</code> listed. If it is not, enter the following with root permissions to add <code>cockpit</code> as a service to your firewall:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># firewall-cmd --permanent --add-service=cockpit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--permanent</code> option keeps the <code>cockpit</code> service active after rebooting.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can log in to the Cockpit web interface at <code>https://<em>HostFQDNorIP</em>:9090</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Recommended_practices_for_configuring_host_networks_SHE_cli_deploy">6.3. Recommended Practices for Configuring Host Networks</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always use the oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your network environment is complex, you may need to configure a host network manually before adding the host to the oVirt Engine.</p>
</div>
<div class="paragraph">
<p>Consider the following practices for configuring a host network:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the network with Cockpit. Alternatively, you can use <code>nmtui</code> or <code>nmcli</code>.</p>
</li>
<li>
<p>If a network is not required for a self-hosted engine deployment or for adding a host to the Engine, configure the network in the Administration Portal after adding the host to the Engine. See <a href="https://ovirt.org/documentation/administration_guide/index#Creating_a_new_logical_network_in_a_data_center_or_cluster">Creating a New Logical Network in a Data Center or Cluster</a>.</p>
</li>
<li>
<p>Use the following naming conventions:</p>
<div class="ulist">
<ul>
<li>
<p>VLAN devices: <code><em>VLAN_NAME_TYPE_RAW_PLUS_VID_NO_PAD</em></code></p>
</li>
<li>
<p>VLAN interfaces: <code><em>physical_device</em>.<em>VLAN_ID</em></code> (for example, <code>eth0.23</code>, <code>eth1.128</code>, <code>enp3s0.50</code>)</p>
</li>
<li>
<p>Bond interfaces: <code>bond<em>number</em></code> (for example, <code>bond0</code>, <code>bond1</code>)</p>
</li>
<li>
<p>VLANs on bond interfaces: <code>bond<em>number</em>.<em>VLAN_ID</em></code> (for example, <code>bond0.50</code>, <code>bond1.128</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use <a href="https://ovirt.org/documentation/administration_guide/index#sect-Network_Bonding">network bonding</a>. Network teaming is not supported in oVirt and will cause errors if the host is used to deploy a self-hosted engine or added to the Engine.</p>
</li>
<li>
<p>Use recommended bonding modes:</p>
<div class="ulist">
<ul>
<li>
<p>If the <code>ovirtmgmt</code> network is not used by virtual machines, the network may use any supported bonding mode.</p>
</li>
<li>
<p>If the <code>ovirtmgmt</code> network is used by virtual machines, see <a href="https://access.redhat.com/solutions/67546"><em>Which bonding modes work when used with a bridge that virtual machine guests or containers connect to?</em></a>.</p>
</li>
<li>
<p>oVirt&#8217;s default bonding mode is <code>(Mode 4) Dynamic Link Aggregation</code>. If your switch does not support Link Aggregation Control Protocol (LACP), use <code>(Mode 1) Active-Backup</code>. See <a href="https://ovirt.org/documentation/administration_guide/index#Bonding_Modes">Bonding Modes</a> for details.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure a VLAN on a physical NIC as in the following example (although <code>nmcli</code> is used, you can use any tool):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># nmcli connection add type vlan con-name <em>vlan50</em> ifname <em>eth0.50</em> dev <em>eth0</em> id <em>50</em>
# nmcli con mod <em>vlan50</em> +ipv4.dns 8.8.8.8 +ipv4.addresses <em>123.123</em>.0.1/24 +ipv4.gateway <em>123.123</em>.0.254</code></pre>
</div>
</div>
</li>
<li>
<p>Configure a VLAN on a bond as in the following example (although <code>nmcli</code> is used, you can use any tool):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># nmcli connection add type bond con-name <em>bond0</em> ifname <em>bond0</em> bond.options &quot;mode=active-backup,miimon=100&quot; ipv4.method disabled ipv6.method ignore
# nmcli connection add type ethernet con-name <em>eth0</em> ifname <em>eth0</em> master <em>bond0</em> slave-type bond
# nmcli connection add type ethernet con-name <em>eth1</em> ifname <em>eth1</em> master <em>bond0</em> slave-type bond
# nmcli connection add type vlan con-name <em>vlan50</em> ifname <em>bond0.50</em> dev <em>bond0</em> id <em>50</em>
# nmcli con mod vlan50 +ipv4.dns 8.8.8.8 +ipv4.addresses <em>123.123</em>.0.1/24 +ipv4.gateway <em>123.123</em>.0.254</code></pre>
</div>
</div>
</li>
<li>
<p>Do not disable <code>firewalld</code>.</p>
</li>
<li>
<p>Customize the firewall rules in the Administration Portal after adding the host to the Engine. See <a href="https://ovirt.org/documentation/administration_guide/index#Configuring_Host_Firewall_Rules">Configuring Host Firewall Rules</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Adding_self-hosted_engine_nodes_to_the_Manager_SHE_cli_deploy">6.4. Adding Self-Hosted Engine Nodes to the oVirt Engine</h3>
<div class="paragraph">
<p>Add self-hosted engine nodes in the same way as a standard host, with an additional step to deploy the host as a self-hosted engine node. The shared storage domain is automatically detected and the node can be used as a failover host to host the Engine virtual machine when required. You can also attach standard hosts to a self-hosted engine environment, but they cannot host the Engine virtual machine. Have at least two self-hosted engine nodes to ensure the Engine virtual machine is highly available. You can also add additional hosts using the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-hosts">Hosts</a> in the <em>REST API Guide</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All self-hosted engine nodes must be in the same cluster.</p>
</li>
<li>
<p>If you are reusing a self-hosted engine node, remove its existing self-hosted engine configuration. See <a href="https://ovirt.org/documentation/administration_guide/index#removing_a_host_from_a_self-hosted_engine_environment">Removing a Host from a Self-Hosted Engine Environment</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>.</p>
<div class="paragraph">
<p>For information on additional host settings, see <a href="https://ovirt.org/documentation/administration_guide#sect-Explanation_of_Settings_and_Controls_in_the_New_Host_and_Edit_Host_Windows">Explanation of Settings and Controls in the New Host and Edit Host Windows</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>Use the drop-down list to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and the <strong>Address</strong> of the new host. The standard SSH port, port 22, is auto-filled in the <strong>SSH Port</strong> field.</p>
</li>
<li>
<p>Select an authentication method to use for the Engine to access the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Alternatively, copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_keys</strong> on the host to use public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, configure power management, where the host has a supported power management card. For information on power management configuration, see <a href="https://ovirt.org/documentation/administration_guide#Host_Power_Management_settings_explained">Host Power Management Settings Explained</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab.</p>
</li>
<li>
<p>Select <strong>Deploy</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_standard_hosts_to_the_Manager_SHE_cli_deploy">6.5. Adding Standard Hosts to the oVirt Engine</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always use the oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Adding a host to your oVirt environment can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, and creation of a bridge.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>.</p>
</li>
<li>
<p>Use the drop-down list to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and the <strong>Address</strong> of the new host. The standard SSH port, port 22, is auto-filled in the <strong>SSH Port</strong> field.</p>
</li>
<li>
<p>Select an authentication method to use for the Engine to access the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Alternatively, copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_keys</strong> on the host to use public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, click the <strong>Advanced Parameters</strong> button to change the following advanced host settings:</p>
<div class="ulist">
<ul>
<li>
<p>Disable automatic firewall configuration.</p>
</li>
<li>
<p>Add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally configure power management, where the host has a supported power management card. For information on power management configuration, see <a href="https://ovirt.org/documentation/administration_guide/index#Host_Power_Management_settings_explained">Host Power Management Settings Explained</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new host displays in the list of hosts with a status of <code>Installing</code>, and you can view the progress of the installation in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon" title="Events"></span>). After a brief delay the host status changes to <code>Up</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Adding_Storage_Domains_to_RHV_SHE_cli_deploy">7. Adding Storage for oVirt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add storage as data domains in the new environment. A oVirt environment must have at least one data domain, but adding more is recommended.</p>
</div>
<div class="paragraph">
<p>Add the storage you prepared earlier:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#Adding_NFS_Storage_SHE_cli_deploy">NFS</a></p>
</li>
<li>
<p><a href="#Adding_iSCSI_Storage_SHE_cli_deploy">iSCSI</a></p>
</li>
<li>
<p><a href="#Adding_FCP_Storage_SHE_cli_deploy">Fibre Channel (FCP)</a></p>
</li>
<li>
<p><a href="#Adding_Red_Hat_Gluster_Storage_SHE_cli_deploy">Gluster Storage</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using iSCSI storage, new data domains must not use the same iSCSI target as the self-hosted engine storage domain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Creating additional data domains in the same data center as the self-hosted engine storage domain is highly recommended. If you deploy the self-hosted engine in a data center with only one active data storage domain, and that storage domain is corrupted, you will not be able to add new storage domains or remove the corrupted storage domain; you will have to redeploy the self-hosted engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Adding_NFS_Storage_SHE_cli_deploy">7.1. Adding NFS Storage</h3>
<div class="paragraph">
<p>This procedure shows you how to attach existing NFS storage to your oVirt environment as a data domain.</p>
</div>
<div class="paragraph">
<p>If you require an ISO or export domain, use this procedure, but select <strong>ISO</strong> or <strong>Export</strong> from the <strong>Domain Function</strong> list.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the storage domain.</p>
</li>
<li>
<p>Accept the default values for the <strong>Data Center</strong>, <strong>Domain Function</strong>, <strong>Storage Type</strong>, <strong>Format</strong>, and <strong>Host</strong> lists.</p>
</li>
<li>
<p>Enter the <strong>Export Path</strong> to be used for the storage domain. The export path should be in the format of <em>123.123.0.10:/data</em> (for IPv4), <em>[2001:0:0:0:0:0:0:5db1]:/data</em> (for IPv6), or <em>domain.example.com:/data</em>.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new NFS data domain has a status of <code>Locked</code> until the disk is prepared. The data domain is then automatically attached to the data center.</p>
</div>
</div>
<div class="sect2">
<h3 id="Adding_iSCSI_Storage_SHE_cli_deploy">7.2. Adding iSCSI Storage</h3>
<div class="paragraph">
<p>This procedure shows you how to attach existing iSCSI storage to your oVirt environment as a data domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> of the new storage domain.</p>
</li>
<li>
<p>Select a <strong>Data Center</strong> from the drop-down list.</p>
</li>
<li>
<p>Select <strong>Data</strong> as the <strong>Domain Function</strong> and <strong>iSCSI</strong> as the <strong>Storage Type</strong>.</p>
</li>
<li>
<p>Select an active host as the <strong>Host</strong>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Communication to the storage domain is from the selected host and not directly from the Engine. Therefore, all hosts must have access to the storage device before the storage domain can be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The Engine can map iSCSI targets to LUNs or LUNs to iSCSI targets. The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when the iSCSI storage type is selected. If the target that you are using to add storage does not appear, you can use target discovery to find it; otherwise proceed to the next step.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Discover Targets</strong> to enable target discovery options. When targets have been discovered and logged in to, the <strong>New Domain</strong> window automatically displays targets with LUNs unused by the environment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LUNs used externally for the environment are also displayed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the <strong>Discover Targets</strong> options to add LUNs on many targets or multiple paths to the same LUNs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the REST API method <code>discoveriscsi</code> to discover the iscsi targets, you can use an FQDN or an IP address, but you must use the iscsi details from the discovered targets results to log in using the REST API method <code>iscsilogin</code>. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-discover_iscsi">discoveriscsi</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the FQDN or IP address of the iSCSI host in the <strong>Address</strong> field.</p>
</li>
<li>
<p>Enter the port with which to connect to the host when browsing for targets in the <strong>Port</strong> field. The default is <code>3260</code>.</p>
</li>
<li>
<p>If CHAP is used to secure the storage, select the <strong>User Authentication</strong> check box. Enter the <strong>CHAP user name</strong> and <strong>CHAP password</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can define credentials for an iSCSI target for a specific host with the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-storage_server_connection_extensions-methods-add">StorageServerConnectionExtensions: add</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Discover</strong>.</p>
</li>
<li>
<p>Select one or more targets from the discovery results and click <strong>Login</strong> for one target or <strong>Login All</strong> for multiple targets.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If more than one path access is required, you must discover and log in to the target through all the required paths. Modifying a storage domain to add additional paths is currently not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the REST API <code>iscsilogin</code> method to log in, you must use the iscsi details from the discovered targets results in the <code>discoveriscsi</code> method. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-iscsi_login">iscsilogin</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click the <strong>+</strong> button next to the desired target. This expands the entry and displays all unused LUNs attached to the target.</p>
</li>
<li>
<p>Select the check box for each LUN that you are using to create the storage domain.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
<li>
<p>Select the <strong>Discard After Delete</strong> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have configured multiple storage connection paths to the same target, follow the procedure in <a href="https://ovirt.org/documentation/administration_guide/index#Configuring_iSCSI_Multipathing">Configuring iSCSI Multipathing</a> to complete iSCSI bonding.</p>
</div>
<div class="paragraph">
<p>If you want to migrate your current storage network to an iSCSI bond, see <a href="https://ovirt.org/documentation/administration_guide/index#Migrating_a_logical_network_to_an_iscsi_bond">Migrating a Logical Network to an iSCSI Bond</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Adding_FCP_Storage_SHE_cli_deploy">7.3. Adding FCP Storage</h3>
<div class="paragraph">
<p>This procedure shows you how to attach existing FCP storage to your oVirt environment as a data domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> of the storage domain.</p>
</li>
<li>
<p>Select an FCP <strong>Data Center</strong> from the drop-down list.</p>
<div class="paragraph">
<p>If you do not yet have an appropriate FCP data center, select <code>(none)</code>.</p>
</div>
</li>
<li>
<p>Select the <strong>Domain Function</strong> and the <strong>Storage Type</strong> from the drop-down lists. The storage domain types that are not compatible with the chosen data center are not available.</p>
</li>
<li>
<p>Select an active host in the <strong>Host</strong> field. If this is not the first data domain in a data center, you must select the data center&#8217;s SPM host.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All communication to the storage domain is through the selected host and not directly from the oVirt Engine. At least one active host must exist in the system and be attached to the chosen data center. All hosts must have access to the storage device before the storage domain can be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when <strong>Fibre Channel</strong> is selected as the storage type. Select the <strong>LUN ID</strong> check box to select all of the available LUNs.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
<li>
<p>Select the <strong>Discard After Delete</strong> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new FCP data domain remains in a <code>Locked</code> status while it is being prepared for use. When ready, it is automatically attached to the data center.</p>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Red_Hat_Gluster_Storage_SHE_cli_deploy">7.4. Adding Gluster Storage</h3>
<div class="paragraph">
<p>To use Gluster Storage with oVirt, see <a href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.4/html/configuring_red_hat_virtualization_with_red_hat_gluster_storage/"><em>Configuring oVirt with Gluster Storage</em></a>.</p>
</div>
<div class="paragraph">
<p>For the Gluster Storage versions that are supported with oVirt, see <a href="https://access.redhat.com/articles/2356261" class="bare">https://access.redhat.com/articles/2356261</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Troubleshooting_SHE_SHE_cli_deploy">Appendix A: Troubleshooting a Self-hosted Engine Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To confirm whether the self-hosted engine has already been deployed, run <code>hosted-engine --check-deployed</code>. An error will only be displayed if the self-hosted engine has not been deployed.</p>
</div>
<div class="sect2">
<h3 id="Troubleshooting_the_Manager_Virtual_Machine_SHE_cli_deploy">Troubleshooting the Engine Virtual Machine</h3>
<div class="paragraph">
<p>Check the status of the Engine virtual machine by running <code>hosted-engine --vm-status</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Any changes made to the Engine virtual machine will take about 20 seconds before they are reflected in the status command output.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on the <code>Engine status</code> in the output, see the following suggestions to find or fix the issue.</p>
</div>
<h4 id="engine-status-health-good-vm-up-detail-up" class="discrete">Engine status: "health": "good", "vm": "up"  "detail": "up"</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the Engine virtual machine is up and running as normal, you will see the following output:</p>
<div class="listingblock">
<div class="content">
<pre>--== Host 1 status ==--

Status up-to-date              : True
Hostname                       : hypervisor.example.com
Host ID                        : 1
Engine status                  : {"health": "good", "vm": "up", "detail": "up"}
Score                          : 3400
stopped                        : False
Local maintenance              : False
crc32                          : 99e57eba
Host timestamp                 : 248542</pre>
</div>
</div>
</li>
<li>
<p>If the output is normal but you cannot connect to the Engine, check the network connection.</p>
</li>
</ol>
</div>
<h4 id="engine-status-reason-failed-liveliness-check-health-bad-vm-up-detail-up" class="discrete">Engine status: "reason": "failed liveliness check", "health": "bad", "vm": "up", "detail": "up"</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the <code>health</code> is <code>bad</code> and the <code>vm</code> is <code>up</code>, the HA services will try to restart the Engine virtual machine to get the Engine back. If it does not succeed within a few minutes, enable the global maintenance mode from the command line so that the hosts are no longer managed by the HA services.</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Connect to the console. When prompted, enter the operating system&#8217;s root password. For more console options, see <a href="https://access.redhat.com/solutions/2221461" class="bare">https://access.redhat.com/solutions/2221461</a>.</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --console</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the Engine virtual machine&#8217;s operating system is running by logging in.</p>
</li>
<li>
<p>Check the status of the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl status -l ovirt-engine
# journalctl -u ovirt-engine</pre>
</div>
</div>
</li>
<li>
<p>Check the following logs: <strong>/var/log/messages</strong>, <strong>/var/log/ovirt-engine/engine.log,</strong> and <strong>/var/log/ovirt-engine/server.log</strong>.</p>
</li>
<li>
<p>After fixing the issue, reboot the Engine virtual machine manually from one of the self-hosted engine nodes:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-shutdown
# hosted-engine --vm-start</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the self-hosted engine nodes are in global maintenance mode, the Engine virtual machine must be rebooted manually. If you try to reboot the Engine virtual machine by sending a <code>reboot</code> command from the command line, the Engine virtual machine will remain powered off. This is by design.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On the Engine virtual machine, verify that the <code>ovirt-engine</code> service is up and running:</p>
<div class="listingblock">
<div class="content">
<pre> # systemctl status ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>After ensuring the Engine virtual machine is up and running, close the console session and disable the maintenance mode to enable the HA services again:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="engine-status-vm-down-health-bad-detail-unknown-reason-vm-not-running-on-this-host" class="discrete">Engine status: "vm": "down", "health": "bad", "detail": "unknown", "reason": "vm not running on this host"</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This message is expected on a host that is not currently running the Engine virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have more than one host in your environment, ensure that another host is not currently trying to restart the Engine virtual machine.</p>
</li>
<li>
<p>Ensure that you are not in global maintenance mode.</p>
</li>
<li>
<p>Check the <strong>ovirt-ha-agent</strong> logs in <strong>/var/log/ovirt-hosted-engine-ha/agent.log</strong>.</p>
</li>
<li>
<p>Try to reboot the Engine virtual machine manually from one of the self-hosted engine nodes:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-shutdown
# hosted-engine --vm-start</pre>
</div>
</div>
</li>
</ol>
</div>
<h4 id="engine-status-vm-unknown-health-unknown-detail-unknown-reason-failed-to-getvmstats" class="discrete">Engine status: "vm": "unknown", "health": "unknown", "detail": "unknown", "reason": "failed to getVmStats"</h4>
<div class="paragraph">
<p>This status means that <code>ovirt-ha-agent</code> failed to get the virtual machine&#8217;s details from VDSM.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the VDSM logs in <strong>/var/log/vdsm/vdsm.log</strong>.</p>
</li>
<li>
<p>Check the <strong>ovirt-ha-agent</strong> logs in <strong>/var/log/ovirt-hosted-engine-ha/agent.log</strong>.</p>
</li>
</ol>
</div>
<h4 id="engine-status-the-self-hosted-engines-configuration-has-not-been-retrieved-from-shared-storage" class="discrete">Engine status: The self-hosted engine&#8217;s configuration has not been retrieved from shared storage</h4>
<div class="paragraph">
<p>If you receive the status <code>The hosted engine configuration has not been retrieved from shared storage. Please ensure that ovirt-ha-agent is running and the storage server is reachable</code> there is an issue with the <code>ovirt-ha-agent</code> service, or with the storage, or both.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the status of <code>ovirt-ha-agent</code> on the host:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl status -l ovirt-ha-agent
# journalctl -u ovirt-ha-agent</pre>
</div>
</div>
</li>
<li>
<p>If the <code>ovirt-ha-agent</code> is down, restart it:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl start ovirt-ha-agent</pre>
</div>
</div>
</li>
<li>
<p>Check the <code>ovirt-ha-agent</code> logs in <strong>/var/log/ovirt-hosted-engine-ha/agent.log</strong>.</p>
</li>
<li>
<p>Check that you can ping the shared storage.</p>
</li>
<li>
<p>Check whether the shared storage is mounted.</p>
</li>
</ol>
</div>
<h4 id="additional-troubleshooting-commands" class="discrete">Additional Troubleshooting Commands</h4>
<div class="ulist">
<ul>
<li>
<p><code>hosted-engine --reinitialize-lockspace</code>: This command is used when the sanlock lockspace is broken. Ensure that the global maintenance mode is enabled and that the Engine virtual machine is stopped before reinitializing the sanlock lockspaces.</p>
</li>
<li>
<p><code>hosted-engine --clean-metadata</code>: Remove the metadata for a host&#8217;s agent from the global status database. This makes all other hosts forget about this host. Ensure that the target host is down and that the global maintenance mode is enabled.</p>
</li>
<li>
<p><code>hosted-engine --check-liveliness</code>: This command checks the liveliness page of the ovirt-engine service. You can also check by connecting to <code>https://<em>engine-fqdn</em>/ovirt-engine/services/health/</code> in a web browser.</p>
</li>
<li>
<p><code>hosted-engine --connect-storage</code>: This command instructs VDSM to prepare all storage connections needed for the host and the Engine virtual machine. This is normally run in the back-end during the self-hosted engine deployment. Ensure that the global maintenance mode is enabled if you need to run this command to troubleshoot storage issues.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Cleaning_Up_a_Failed_Self-hosted_Engine_Deployment_SHE_cli_deploy">Cleaning Up a Failed Self-hosted Engine Deployment</h3>
<div class="paragraph">
<p>If a self-hosted engine deployment was interrupted, subsequent deployments will fail with an error message. The error will differ depending on the stage in which the deployment failed.</p>
</div>
<div class="paragraph">
<p>If you receive an error message, you can run the cleanup script on the deployment host to clean up the failed deployment. However, it&#8217;s best to reinstall your base operating system and start the deployment from the beginning.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The cleanup script has the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A disruption in the network connection while the script is running might cause the script to fail to remove the management bridge or to recreate a working network configuration.</p>
</li>
<li>
<p>The script is not designed to clean up any shared storage device used during a failed deployment. You need to clean the shared storage device before you can reuse it in a subsequent deployment.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run <code>/usr/sbin/ovirt-hosted-engine-cleanup</code> and select <code>y</code> to remove anything left over from the failed self-hosted engine deployment.</p>
<div class="listingblock">
<div class="content">
<pre># /usr/sbin/ovirt-hosted-engine-cleanup
This will de-configure the host to run ovirt-hosted-engine-setup from scratch.
Caution, this operation should be used with care.
Are you sure you want to proceed? [y/n]</pre>
</div>
</div>
</li>
<li>
<p>Define whether to reinstall on the same shared storage device or select a different shared storage device.</p>
<div class="ulist">
<ul>
<li>
<p>To deploy the installation on the same storage domain, clean up the storage domain by running the following command in the appropriate directory on the server for NFS, Gluster, PosixFS or local storage domains:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># rm -rf <em>storage_location</em>/*</code></pre>
</div>
</div>
</li>
<li>
<p>For iSCSI or Fibre Channel Protocol (FCP) storage, see <a href="https://access.redhat.com/solutions/2121581" class="bare">https://access.redhat.com/solutions/2121581</a> for information on how to clean up the storage.</p>
</li>
<li>
<p>Reboot the self-hosted engine host or select a different shared storage device.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The reboot is needed to make sure all the connections to the storage are cleaned before the next attempt.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Redeploy the self-hosted engine.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizing_engine_vm_during_deployment_auto_SHE_cli_deploy">Appendix B: Customizing the Engine virtual machine using automation during deployment</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You can use automation to adjust or otherwise customize the Engine virtual machine during deployment by using one or more Ansible playbooks. You can run playbooks at the following points during deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>before the self-hosted engine setup</p>
</li>
<li>
<p>after the self-hosted engine setup, but before storage is configured</p>
</li>
<li>
<p>after adding the deployment host to the Engine</p>
</li>
<li>
<p>after the deployment completes entirely</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Write one or more Ansible playbooks to run on the Engine virtual machine at specific points in the deployment process.</p>
</li>
<li>
<p>Add the playbooks to the appropriate directory under <code>/usr/share/ansible/collections/ansible_collections/redhat/rhv/roles/hosted_engine_setup/hooks/</code>:</p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>enginevm_before_engine_setup</code></dt>
<dd>
<p>Run the playbook before the self-hosted engine setup.</p>
</dd>
<dt class="hdlist1"><code>enginevm_after_engine_setup</code></dt>
<dd>
<p>Run the playbook after the self-hosted engine setup, but before storage is configured.</p>
</dd>
<dt class="hdlist1"><code>after_add_host</code></dt>
<dd>
<p>Run the playbook after adding the deployment host to the Engine.</p>
</dd>
<dt class="hdlist1"><code>after_setup</code></dt>
<dd>
<p>Run the playbook after deployment is completed.</p>
</dd>
</dl>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When you run the self-hosted-engine installer, the deployment script runs the <code>ovirt-engine-setup</code> role, which automatically runs any playbooks in either of these directories.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/installing_red_hat_virtualization_as_a_self-hosted_engine_using_the_command_line/index#Deploying_the_Self-Hosted_Engine_Using_the_CLI_install_RHVM">Deploying the self-hosted engine using the command line</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#chap-Automating_RHV_Configuration_using_Ansible">Automating Configuration Tasks using Ansible</a></p>
</li>
<li>
<p><a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">Intro to playbooks</a> in the Ansible documentation</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Migrating_to_remote_servers_SHE_cli_deploy">Appendix C: Migrating Databases and Services to a Remote Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although you cannot configure remote databases and services during the automated installation, you can migrate them to a separate server post-installation.</p>
</div>
<div class="sect2">
<h3 id="Migrating_Data_Warehouse_to_a_Separate_Machine_SHE_cli_deploy">Migrating Data Warehouse to a Separate Machine</h3>
<div class="paragraph">
<p>This section describes how to migrate the Data Warehouse database and service from the oVirt Engine machine to a separate machine. Hosting the Data Warehouse service on a separate machine reduces the load on each individual machine, and avoids potential conflicts caused by sharing CPU and memory resources with other processes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have the following migration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can migrate the Data Warehouse service away from the Engine machine and connect it with the existing Data Warehouse database (<code>ovirt_engine_history</code>).</p>
</li>
<li>
<p>You can migrate the Data Warehouse database away from the Engine machine and then migrate the Data Warehouse service.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="proc-Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine">Migrating the Data Warehouse Database to a Separate Machine</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a backup of the Data Warehouse database and configuration files on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># engine-backup --mode=backup --scope=dwhdb --scope=files --file=<em>file_name</em> --log=<em>log_file_name</em></code></pre>
</div>
</div>
</li>
<li>
<p>Copy the backup file from the Engine to the new machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># scp <em>/tmp/file_name</em> <em>root@new.dwh.server.com:/tmp</em></code></pre>
</div>
</div>
</li>
<li>
<p>Install <code>engine-backup</code> on the new machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install ovirt-engine-tools-backup</code></pre>
</div>
</div>
</li>
<li>
<p>Install the PostgreSQL server package:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install postgresql-server postgresql-contrib</code></pre>
</div>
</div>
</li>
<li>
<p>Initialize the PostgreSQL database, start the <code>postgresql</code> service, and ensure that this service starts on boot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c 'initdb'
# systemctl enable postgresql
# systemctl start postgresql</pre>
</div>
</div>
</li>
<li>
<p>Restore the Data Warehouse database on the new machine. <em>file_name</em> is the backup file copied from the Engine.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-dwh-db --restore-permissions</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse database is now hosted on a separate machine from that on which the Engine is hosted. After successfully restoring the Data Warehouse database, a prompt instructs you to run the <code>engine-setup</code> command. Before running this command, migrate the Data Warehouse service.</p>
</div>
</div>
<div class="sect3">
<h4 id="Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Service to a Separate Machine</h4>
<div class="paragraph">
<p>You can migrate the Data Warehouse service installed and configured on the oVirt Engine to a separate machine. Hosting the Data Warehouse service on a separate machine helps to reduce the load on the Engine machine.</p>
</div>
<div class="paragraph">
<p>Notice that this procedure migrates the Data Warehouse service only.</p>
</div>
<div class="paragraph">
<p>To migrate the Data Warehouse database (<code>ovirt_engine_history</code>) prior to migrating the Data Warehouse service, see <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have installed and configured the Engine and Data Warehouse on the same machine.</p>
</li>
<li>
<p>To set up the new Data Warehouse machine, you must have the following:</p>
<div class="ulist">
<ul>
<li>
<p>The password from the Engine&#8217;s <strong>/etc/ovirt-engine/engine.conf.d/10-setup-database.conf</strong> file.</p>
</li>
<li>
<p>Allowed access from the Data Warehouse machine to the Engine database machine&#8217;s TCP port 5432.</p>
</li>
<li>
<p>The username and password for the Data Warehouse database from the Engine&#8217;s <strong>/etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf</strong> file. If you migrated the <code>ovirt_engine_history</code> database using <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a>, the backup includes these credentials, which you defined during the database setup on that machine.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Installing this scenario requires four steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#setting_up_machine">Setting up the New Data Warehouse Machine</a></p>
</li>
<li>
<p><a href="#stopping_dwh_service">Stopping the Data Warehouse service on the Engine machine</a></p>
</li>
<li>
<p><a href="#configuring_new_machine">Configuring the new Data Warehouse machine</a></p>
</li>
<li>
<p><a href="#disabling_dwh_package">Disabling the Data Warehouse package on the Engine machine</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="setting_up_machine">Setting up the New Data Warehouse Machine</h5>
<div class="paragraph">
<p>Enable the oVirt repositories and install the Data Warehouse setup package on a Enterprise Linux 8 machine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>pki-deps</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf module -y enable pki-deps</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure that all packages currently installed are up to date:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf upgrade --nobest</code></pre>
</div>
</div>
</li>
<li>
<p>Install the <code>ovirt-engine-dwh-setup</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dnf install ovirt-engine-dwh-setup</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="stopping_dwh_service">Stopping the Data Warehouse Service on the Engine Machine</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the Data Warehouse service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl stop ovirt-engine-dwhd.service</code></pre>
</div>
</div>
</li>
<li>
<p>If the database is hosted on a remote machine, you must manually grant access by editing the postgres.conf file. Edit the <code class="filename">/var/lib/pgsql/data/postgresql.conf</code> file and modify the listen_addresses line so that it matches the following:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">listen_addresses = '*'</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the line does not exist or has been commented out, add it manually.</p>
</div>
<div class="paragraph">
<p>If the database is hosted on the Engine machine and was configured during a clean setup of the oVirt Engine, access is granted by default.</p>
</div>
<div class="paragraph">
<p>See <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a> for more information on how to configure and migrate the Data Warehouse database.</p>
</div>
</li>
<li>
<p>Restart the postgresql service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl restart postgresql</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="configuring_new_machine">Configuring the New Data Warehouse Machine</h5>
<div class="paragraph">
<p>The order of the options or settings shown in this section may differ depending on your environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are migrating both the <code>ovirt_engine_history</code> database and the Data Warehouse service to the <strong>same</strong> machine, run the following, otherwise proceed to the next step.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># sed -i '/^ENGINE_DB_/d' \
        /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf

# sed -i \
     -e 's;^\(OVESETUP_ENGINE_CORE/enable=bool\):True;\1:False;' \
     -e '/^OVESETUP_CONFIG\/fqdn/d' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>engine-setup</code> command to begin configuration of Data Warehouse on the machine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># engine-setup</code></pre>
</div>
</div>
</li>
<li>
<p>Press <strong>Enter</strong> to accept the automatically detected host name, or enter an alternative host name and press <strong>Enter</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Host fully qualified DNS name of this server [<em>autodetected host name</em>]:</code></pre>
</div>
</div>
</li>
<li>
<p>Press <code>Enter</code> to automatically configure the firewall, or type <code>No</code> and press <code>Enter</code> to maintain existing settings:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Setup can automatically configure the firewall on this system.
Note: automatic configuration of the firewall may overwrite current settings.
Do you want Setup to configure the firewall? (Yes, No) [Yes]:</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you choose to automatically configure the firewall, and no firewall managers are active, you are prompted to select your chosen firewall manager from a list of supported options. Type the name of the firewall manager and press <code>Enter</code>. This applies even in cases where only one option is listed.</p>
</div>
</li>
<li>
<p>Enter the fully qualified domain name and password for the Engine. Press <strong>Enter</strong> to accept the default values in each other field:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Host fully qualified DNS name of the engine server []: <em>engine-fqdn</em>
Setup needs to do some actions on the remote engine server. Either automatically, using ssh as root to access it, or you will be prompted to manually perform each such action.
Please choose one of the following:
1 - Access remote engine server using ssh as root
2 - Perform each action manually, use files to copy content around
(1, 2) [1]:
ssh port on remote engine server [22]:
root password on remote engine server <em>engine-fqdn</em>: <em>password</em></code></pre>
</div>
</div>
</li>
<li>
<p>Enter the FQDN and password for the Engine database machine. Press <code>Enter</code> to accept the default values in each other field:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Engine database host []: <em>manager-db-fqdn</em>
Engine database port [5432]:
Engine database secured connection (Yes, No) [No]:
Engine database name [engine]:
Engine database user [engine]:
Engine database password: <em>password</em></code></pre>
</div>
</div>
</li>
<li>
<p>Confirm your installation settings:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">Please confirm installation settings (OK, Cancel) [OK]:</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse service is now configured on the remote machine. Proceed to disable the Data Warehouse service on the Engine machine.</p>
</div>
</div>
<div class="sect4">
<h5 id="disabling_dwh_package">Disabling the Data Warehouse Service on the Engine Machine</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, restart the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># service ovirt-engine restart</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to modify the file <strong>/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</strong> and set the options to <code>False</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># sed -i \
     -e 's;^\(OVESETUP_DWH_CORE/enable=bool\):True;\1:False;' \
     -e 's;^\(OVESETUP_DWH_CONFIG/remoteEngineConfigured=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf

# sed -i \
     -e 's;^\(OVESETUP_GRAFANA_CORE/enable=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</code></pre>
</div>
</div>
</li>
<li>
<p>Disable the Data Warehouse service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl disable ovirt-engine-dwhd.service</code></pre>
</div>
</div>
</li>
<li>
<p>Remove the Data Warehouse files:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># rm -f /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/* .conf /var/lib/ovirt-engine-dwh/backups/*</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse service is now hosted on a separate machine from the Engine.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Configuring_a_Host_for_PCI_Passthrough_SHE_cli_deploy">Appendix D: Configuring a Host for PCI Passthrough</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enabling PCI passthrough allows a virtual machine to use a host device as if the device were directly attached to the virtual machine. To enable the PCI passthrough function, you must enable virtualization extensions and the IOMMU function. The following procedure requires you to reboot the host. If the host is attached to the Engine already, ensure you place the host into maintenance mode first.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host hardware meets the requirements for PCI device passthrough and assignment. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#PCI_Device_Requirements_RHV_planning">PCI Device Requirements</a> for more information.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Configuring a Host for PCI Passthrough</div>
<ol class="arabic">
<li>
<p>Enable the virtualization extension and IOMMU extension in the BIOS. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Troubleshooting-Enabling_Intel_VT_x_and_AMD_V_virtualization_hardware_extensions_in_BIOS.html">Enabling Intel VT-x and AMD-V virtualization hardware extensions in BIOS</a> in the <em>Enterprise Linux Virtualization Deployment and Administration Guide</em> for more information.</p>
</li>
<li>
<p>Enable the IOMMU flag in the kernel by selecting the <strong>Hostdev Passthrough &amp; SR-IOV</strong> check box when adding the host to the Engine or by editing the <strong>grub</strong> configuration file manually.</p>
<div class="ulist">
<ul>
<li>
<p>To enable the IOMMU flag from the Administration Portal, see <a href="https://ovirt.org/documentation/administration_guide#Adding_standard_hosts_to_the_Manager">Adding Standard Hosts to the oVirt Engine</a> and <a href="https://ovirt.org/documentation/administration_guide#Kernel_Settings_Explained">Kernel Settings Explained</a>.</p>
</li>
<li>
<p>To edit the <strong>grub</strong> configuration file manually, see  <a href="#Enabling_IOMMU_Manually">Enabling IOMMU Manually</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For GPU passthrough, you need to run additional configuration steps on both the host and the guest system. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/setting_up_an_nvidia_gpu_for_a_virtual_machine_in_red_hat_virtualization/index#proc_nvidia_gpu_passthrough_nvidia_gpu_passthrough">GPU device passthrough: Assigning a host GPU to a single virtual machine</a> in <em>Setting up an NVIDIA GPU for a virtual machine in Red Hat Virtualization</em> for more information.</p>
</li>
</ol>
</div>
<div id="Enabling_IOMMU_Manually" class="olist arabic">
<div class="title">Enabling IOMMU Manually</div>
<ol class="arabic">
<li>
<p>Enable IOMMU by editing the grub configuration file.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using IBM POWER8 hardware, skip this step as IOMMU is enabled by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For Intel, boot the machine, and append <code>intel_iommu=on</code> to the end of the <code>GRUB_CMDLINE_LINUX</code> line in the <strong>grub</strong> configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/default/grub
...
GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 ... intel_iommu=on
...</pre>
</div>
</div>
</li>
<li>
<p>For AMD, boot the machine, and append <code>amd_iommu=on</code> to the end of the <code>GRUB_CMDLINE_LINUX</code> line in the <strong>grub</strong> configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># vi /etc/default/grub
&#8230;&#8203;
GRUB_CMDLINE_LINUX=&quot;nofb splash=quiet console=tty0 &#8230;&#8203; amd_iommu=on
&#8230;&#8203;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>intel_iommu=on</code> or an AMD IOMMU is detected, you can try adding <code>iommu=pt</code>. The <code>pt</code> option only enables IOMMU for devices used in passthrough and provides better host performance. However, the option might not be supported on all hardware. Revert to the previous option if the <code>pt</code> option doesn&#8217;t work for your host.</p>
</div>
<div class="paragraph">
<p>If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the <code>allow_unsafe_interrupts</code> option if the virtual machines are trusted. The <code>allow_unsafe_interrupts</code> is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># vi /etc/modprobe.d
options vfio_iommu_type1 allow_unsafe_interrupts=1</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Refresh the <strong>grub.cfg</strong> file and reboot the host for these changes to take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># grub2-mkconfig -o /boot/grub2/grub.cfg</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># reboot</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable SR-IOV and assign dedicated virtual NICs to virtual machines, see <a href="https://access.redhat.com/articles/2335291" class="bare">https://access.redhat.com/articles/2335291</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="proc-Preventing_Kernel_Modules_from_Loading_Automatically_Install_nodes_RHVH">Appendix E: Preventing kernel modules from loading automatically</h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>You can prevent a kernel module from being loaded automatically, whether the module is loaded directly, loaded as a dependency from another module, or during the boot process.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>The module name must be added to a configuration file for the <code>modprobe</code> utility.  This file must reside in the configuration directory <code>/etc/modprobe.d</code>.</p>
<div class="paragraph">
<p>For more information on this configuration directory, see the man page <code>modprobe.d</code>.</p>
</div>
</li>
<li>
<p>Ensure the module is not configured to get loaded in any of the following:</p>
<div class="ulist">
<ul>
<li>
<p><code>/etc/modprobe.conf</code></p>
</li>
<li>
<p><code>/etc/modprobe.d/*</code></p>
</li>
<li>
<p><code>/etc/rc.modules</code></p>
</li>
<li>
<p><code>/etc/sysconfig/modules/*</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># modprobe --showconfig &lt;_configuration_file_name_&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>If the module appears in the output, ensure it is ignored and not loaded:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># modprobe --ignore-install &lt;_module_name_&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Unload the module from the running system, if it is loaded:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># modprobe -r &lt;_module_name_&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Prevent the module from being loaded directly by adding the <code>blacklist</code> line to a configuration file specific to the system - for example <code>/etc/modprobe.d/local-dontload.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># echo &quot;blacklist &lt;_module_name_&gt; &gt;&gt; /etc/modprobe.d/local-dontload.conf</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This step does not prevent a module from loading if it is a required or an optional dependency of another module.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Prevent optional modules from being loading on demand:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># echo &quot;install &lt;_module_name_&gt;/bin/false&quot; &gt;&gt; /etc/modprobe.d/local-dontload.conf</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the excluded module is required for other hardware, excluding it might cause unexpected side effects.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Make a backup copy of your <code>initramfs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp /boot/initramfs-$(uname -r).img /boot/initramfs-$(uname -r).img.$(date +%m-%d-%H%M%S).bak</code></pre>
</div>
</div>
</li>
<li>
<p>If the kernel module is part of the <code>initramfs</code>, rebuild your initial <code>ramdisk</code> image, omitting the module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># dracut --omit-drivers &lt;_module_name_&gt; -f</code></pre>
</div>
</div>
</li>
<li>
<p>Get the current kernel command line parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># grub2-editenv - list | grep kernelopts</code></pre>
</div>
</div>
</li>
<li>
<p>Append <code>&lt;_module_name_&gt;.blacklist=1 rd.driver.blacklist=&lt;_module_name_&gt;</code> to the generated output:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># grub2-editenv - set kernelopts=&quot;&lt;&gt; &lt;_module_name_&gt;.blacklist=1 rd.driver.blacklist=&lt;_module_name_&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># grub2-editenv - set kernelopts=&quot;root=/dev/mapper/rhel_example-root ro crashkernel=auto resume=/dev/mapper/rhel_example-swap rd.lvm.lv=rhel_example/root rd.lvm.lv=rhel_example/swap &lt;_module_name_&gt;.blacklist=1 rd.driver.blacklist=&lt;_module_name_&gt;&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Make a backup copy of the <code>kdump initramfs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># cp /boot/initramfs-$(uname -r)kdump.img /boot/initramfs-$(uname -r)kdump.img.$(date +%m-%d-%H%M%S).bak</code></pre>
</div>
</div>
</li>
<li>
<p>Append <code>rd.driver.blacklist=&lt;_module_name_&gt;</code> to the <code>KDUMP_COMMANDLINE_APPEND</code> setting in <code>/etc/sysconfig/kdump</code> to omit it from the <code>kdump initramfs</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># sed -i '/^KDUMP_COMMANDLINE_APPEND=/s/&quot;$/ rd.driver.blacklist=module_name&quot;/' /etc/sysconfig/kdump</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>kdump</code> service to pick up the changes to the <code>kdump initrd</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">  # kdumpctl restart</code></pre>
</div>
</div>
</li>
<li>
<p>Rebuild the <code>kdump</code> initial <code>ramdisk</code> image:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">  # mkdumprd -f /boot/initramfs-$(uname -r)kdump.img</code></pre>
</div>
</div>
</li>
<li>
<p>Reboot the system.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="removing-a-module-temporarily">Removing a module temporarily</h3>
<div class="paragraph">
<p>You can remove a module temporarily.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run <code>modprobe</code> to remove any currently-loaded module:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># modprobe -r &lt;module name&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>If the module cannot be unloaded, a process or another module might still be using the module. If so, terminate the process and run the <code>modpole</code> command written above another time to unload the module.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ovirt-legal-notice">Appendix F: Legal notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certain portions of this text first appeared in <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/installing_red_hat_virtualization_as_a_self-hosted_engine_using_the_command_line/index">Red Hat Virtualization 4.4 Installing Red Hat Virtualization as a self-hosted engine using the command line</a>. Copyright © 2022 Red Hat, Inc. Licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 Unported License</a>.</p>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2982/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2982/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2982/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2982/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
