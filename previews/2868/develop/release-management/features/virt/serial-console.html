<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Serial Console | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Serial Console" />
<meta name="author" content="Alon Bar-Lev" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2868/develop/release-management/features/virt/serial-console.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2868/develop/release-management/features/virt/serial-console.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Serial Console" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Alon Bar-Lev" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Alon Bar-Lev"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Serial Console","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2868/images/logo.svg"},"name":"Alon Bar-Lev"},"url":"https://ovirt.github.io/ovirt-site/previews/2868/develop/release-management/features/virt/serial-console.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2868/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2868/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2868/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2868/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2868/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2868/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2868/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2868/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2868/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2868/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2868/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2868/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2868/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2868/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2868/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2868/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2868/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2868/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2868/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2868/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2868/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2868/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2868//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2868//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2868/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2868/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2868/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2868/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2868/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/73dbd7b0a4e813ae529563511ec671b4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/73dbd7b0a4e813ae529563511ec671b4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Alon Bar-Lev</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7054bd65a0f097bbc1e54f4652d59f8b?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7054bd65a0f097bbc1e54f4652d59f8b?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Francesco Romani</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f84744a8673f28debaa570cc085d2c89?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f84744a8673f28debaa570cc085d2c89?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Vitor de Lima</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2868/documentation/'>Documentation is available here.</a></div>

<h1 id="ovirt-serial-console">oVirt Serial Console</h1>

<h2 id="summary">Summary</h2>

<p>Allow direct ssh access to the virtual serial consoles of the VMs managed by an oVirt engine instance, using a SSH proxy server.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Francesco Romani (fromani)</li>
  <li>Email: <a href="mailto:fromani@redhat.com">fromani@redhat.com</a></li>
  <li>Name: Vitor de Lima (Vitordelima)</li>
  <li>Email: vdelima@redhat.com</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>Up until oVirt 3.6.0, VMs can be accessed by logging into Engine, using a browser. This feature will allow users to directly connect to the VM’s serial consoles, emulated through virtio channels, using ssh, without directly accessing Engine. Engine will still be used by in background to learn about VM placement, and to store authentication keys.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>The benefit for oVirt is greater flexibility and easier access to VMs for admistrative purposes.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<p>Depends on the new ovirt-vmconsole package.</p>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p>ovirt 3.6 deep dive: guest serial console <a href="http://resources.ovirt.org/old-site-files/wiki/Ovirt36_deep_dive-guest_serial_console.pdf">slides</a> and <a href="https://www.youtube.com/watch?v=2FltqwrDDtA">video</a></p>

<h2 id="testing">Testing</h2>

<p>TODO</p>

<h2 id="contingency-plan">Contingency Plan</h2>

<p>Instructions about how to manually setup the serial console connectivity will be provided below (see section: Manual Configuration) This feature add an independent functionalty, so in the case this is won’t be ready in time, admins can fallback to manual configuration with no other drawbacks.</p>

<h2 id="release-notes">Release Notes</h2>

<p>For information about setup and troubleshooting, see the <a href="/ovirt-site/previews/2868/documentation/administration_guide/index.html">Administration Guide</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  == VirtIO serial console ==
  Allow the users to connect directly to the emulated serial console of the VMs, using SSH.
</code></pre></div></div>

<h2 id="implementation-details">Implementation details</h2>

<p><img src="/ovirt-site/previews/2868/images/wiki/Serial_console.png" alt="" /></p>

<ul>
  <li>A secondary instance of the SSH server is used, it allows only one method of authentication (using public keys) and can only login into one user (the vmproxy user)</li>
  <li>The vmproxy_authkeys script lists which public keys are allowed to login and forces a command to be executed after the vmproxy user logs in (the vmproxy command)</li>
  <li>The vmproxy command calls “virsh console” with the appropriate parameters to open a session in the virtual serial console of the chosen VM</li>
  <li>There is a servlet (Public Keys Servlet) inside the engine used by vmproxy_authkeys which lists the public keys and GUIDs of each user</li>
  <li>Another servlet (Available Consoles Servlet) lists the VMs a user is allowed to login and in which host they are located, it is used by the vmproxy script to call virsh console with the appropriate parameters</li>
  <li>The SSH key management creates a public/private SSH key pair, stores the public key in the database with the user record and gives the private key to the user</li>
</ul>

<h3 id="detailed-outline">Detailed Outline</h3>

<ul>
  <li>Access to console will be performed using SSH protocol.</li>
  <li>Proxy based solution, authentication between user and proxy and authentication between proxy and host.</li>
  <li>Separate access to console subsystem using separate unprivileged ssh daemon.</li>
  <li>
    <p>Communication between the SSH proxy and the VM console using “virsh console”</p>

    <p>User—-&gt;[ssh pk(user)]—-&gt;SSH Proxy (manager side) —&gt;[TLS socket]—&gt; libvirtd (host side)
                              |
                             V
                           Engine</p>
  </li>
</ul>

<h3 id="user-interaction-example">User Interaction Example</h3>

<ul>
  <li>
    <p>Implicit connection, single vm available</p>

    <p>$ ssh -i console.key -p 2222 -t vmproxy@engine
  Fedora release 19 (Schrödinger’s Cat)
  Kernel 3.13.5-101.fc19.x86_64 on an x86_64 (ttyS0)
  localhost login:</p>
  </li>
  <li>
    <p>Implicit connection, multiple vm available</p>

    <p>$ ssh  -i console.key -p 2222 -t ovirt-vmconsole@console-proxy</p>
    <ol>
      <li>vm1 [vmid1]</li>
      <li>vm2 [vmid2]</li>
      <li>vm3 [vmid3]
        <blockquote>
          <p>2
  Fedora release 19 (Schrödinger’s Cat)
  Kernel 3.13.5-101.fc19.x86_64 on an x86_64 (ttyS0)
  localhost login:</p>
        </blockquote>
      </li>
    </ol>
  </li>
  <li>
    <p>Explicit connection:</p>

    <p>$ ssh  -i console.key -p 2222 -t ovirt-vmconsole@console-proxy vmid3
  Fedora release 19 (Schrödinger’s Cat)
  Kernel 3.13.5-101.fc19.x86_64 on an x86_64 (ttyS0)
  localhost login:</p>
  </li>
</ul>

<h2 id="known-issues">Known issues</h2>

<p>Up until oVirt 3.6.0-rc1, the oVirt Engine configures the console type to “VirtIO”. Unfortunately, this can cause issues with some Guest Operating Systems, and can require additional configuration as well. <a href="https://gerrit.ovirt.org/#/c/46700/">A Patch is available</a> to switch the default console type “Serial” (Emulated serial console), which should work out of the box in the majority of the Guest OS. The aforementioned patch will be included in oVirt 3.6.0-final.</p>

<p>Note for existing hosts (upgraded from 3.5) the host needs to be re-deployed to correctly install vmconsole packages and set up necessary ssh keys properly. Just rerun the deployment over an existing host.</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2868/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2868/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2868/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2868/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/serial-console.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/virt/serial-console.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
