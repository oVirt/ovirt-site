<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Troubleshooting NFS Storage Issues | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Troubleshooting NFS Storage Issues" />
<meta name="author" content="Andrew Dahms" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3231/develop/troubleshooting-nfs-storage-issues.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3231/develop/troubleshooting-nfs-storage-issues.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Troubleshooting NFS Storage Issues" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Dahms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew Dahms"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Troubleshooting NFS Storage Issues","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3231/images/logo.svg"},"name":"Andrew Dahms"},"url":"https://ovirt.github.io/ovirt-site/previews/3231/develop/troubleshooting-nfs-storage-issues.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3231/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3231/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3231/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3231/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3231/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3231/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3231/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3231/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3231/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3231/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3231/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link rel="icon" type="image/x-icon" href=" /ovirt-site/previews/3231/images/favicon/favicon.ico "/>
  <link rel="icon" type="image/png" href="/ovirt-site/previews/3231/images/favicon/favicon-32x32.png" sizes="32x32"/>
  <link rel="icon" type="image/png" href="/ovirt-site/previews/3231/images/favicon/favicon-16x16.png" sizes="16x16"/>
  <link rel="apple-touch-icon" href="/ovirt-site/previews/3231/images/favicon/apple-touch-icon.png"/>
  <link rel="icon" type="image/png" href="/ovirt-site/previews/3231/images/favicon/android-chrome-192x192.png" sizes="192x192"/>
  <link rel="icon" type="image/png" href="/ovirt-site/previews/3231/images/favicon/android-chrome-512x512.png" sizes="512x512"/>
  <link rel="manifest" href="/ovirt-site/previews/3231/images/favicon/site.webmanifest"/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3231/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3231/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3231/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3231/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3231/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3231/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3231//lists.ovirt.org/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3231//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3231/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3231/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Andrew Dahms">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Dahms</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Yedidyah Bar David">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yedidyah Bar David</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d82d85b7a1f1dca30d833f777fc0c7df?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d82d85b7a1f1dca30d833f777fc0c7df?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Douglas Landgraf">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Douglas Landgraf</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/df31c3a16c31d8322c6ecc1334a56698?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/df31c3a16c31d8322c6ecc1334a56698?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Deepak C Shetty">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Deepak C Shetty</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7f1cc17ac58177d19921783d200a0604?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7f1cc17ac58177d19921783d200a0604?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Jason Brooks">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Jason Brooks</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/cbccb13b9d42aebbf895417aabf7e7da?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/cbccb13b9d42aebbf895417aabf7e7da?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Nicholas Kesick">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Nicholas Kesick</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/de4309ef8cfa874c394239e9bb24be58?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/de4309ef8cfa874c394239e9bb24be58?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ryan Harper">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ryan Harper</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c489669ce6f88f4b35f0d0b4464250f2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c489669ce6f88f4b35f0d0b4464250f2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Steve Gordon">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Steve Gordon</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/b64af159420782a0d7dc29c95d3e80c6?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/b64af159420782a0d7dc29c95d3e80c6?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Markus Stockhausen">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Markus Stockhausen</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8872455242aae9492e0581a0e074c9c5?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8872455242aae9492e0581a0e074c9c5?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Will Dennis">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Will Dennis</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/5c7bb690a7f4520b632e70fac7bb9396?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/5c7bb690a7f4520b632e70fac7bb9396?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Geoff O'Callaghan">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Geoff O'Callaghan</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="troubleshooting-nfs-storage-issues">Troubleshooting NFS Storage Issues</h1>

<h3 id="introduction">Introduction</h3>

<p>To attach NFS storage domains to an oVirt environment, the NFS exports must be configured in a specific way. This page is designed to outline the core requirements for configuring NFS exports, and assist in troubleshooting issues encountered when attempting to attach NFS storage domains to an oVirt environment for the first time.</p>

<h2 id="rhel-derivative-based-nfs-servers">RHEL derivative based NFS Servers</h2>

<h3 id="nfs-server---permissions">NFS Server - Permissions</h3>

<p>In principle, the user <strong>vdsm</strong>, with uid <strong>36</strong> and gid <strong>36</strong>, must have read and write permissions on all NFS exports. However, some daemons on the hypervisor hosts (for example, sanlock) use a different uid but need access to the directory too. Therefore, all incoming NFS requests must be mapped to the aforementioned uid and gid. Two steps are required to ensure this mapping:</p>

<ol>
  <li>Change the ownership of the export directory, replacing <em>directory_name</em> with the name of the directory:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nb">chown </span>36:36 directory_name
</code></pre></div>    </div>
  </li>
  <li>Add the <strong>rw</strong> options on the export in <code class="language-plaintext highlighter-rouge">/etc/exports</code>.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/exports/directory_name       *(rw)
</code></pre></div>    </div>
  </li>
  <li>Set the permissions of the export directory, replacing <em>directory_name</em> with the name of the directory:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nb">chmod </span>0755 directory_name
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="nfs-server---services">NFS Server - Services</h3>

<ol>
  <li>The NFS server must actually be running.
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>systemctl <span class="nb">enable</span> <span class="nt">--now</span> nfs-server
</code></pre></div>    </div>
  </li>
</ol>

<p>a. Ensure that the <strong>nfs</strong> and <strong>rpcbind</strong> services are running on the NFS server,
b. Ensure that <code class="language-plaintext highlighter-rouge">showmount -e &lt;nfs_server_ip&gt;</code> shows the expected export(s).</p>

<ol>
  <li>
    <p>Allow traffic through the NFS server firewall</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-service</span><span class="o">=</span>nfs
<span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-source</span><span class="o">=</span>&lt;your manager ip&gt;
<span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--reload</span>        <span class="c"># NFS vers=4 works at this point</span>
<span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-service</span><span class="o">=</span>rpc-bind <span class="nt">--add-service</span><span class="o">=</span>mountd
<span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--permanent</span> <span class="nt">--add-port</span><span class="o">=</span>32767/tcp <span class="nt">--add-port</span><span class="o">=</span>32767/udp <span class="nt">--add-port</span><span class="o">=</span>32765/tcp <span class="nt">--add-port</span><span class="o">=</span>32765/udp
<span class="gp">#</span><span class="w"> </span>firewall-cmd <span class="nt">--reload</span>        <span class="c"># NFS vers=3 and 4 works at this point</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="nfs-server---selinux">NFS Server - SELinux</h4>

<ul>
  <li>Ensure that selinux is not interfering with NFS access.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">getsebool -a | grep virt_use_nfs</code> should show <code class="language-plaintext highlighter-rouge">virt_use_nfs --&gt; on</code>, if not then do <code class="language-plaintext highlighter-rouge">setsebool virt_use_nfs 1</code> to allow NFS access for VMs</li>
      <li>One can also use <code class="language-plaintext highlighter-rouge">setsebool -P virt_use_nfs 1</code> to make this setting persistent across reboots.</li>
    </ul>
  </li>
</ul>

<h2 id="engine-server---testing-that-the-nfs-server-works">Engine Server - Testing that the NFS server works</h2>

<p>The easiest way to definitively test that an NFS export is ready for use by oVirt is to:</p>

<ul>
  <li>On the engine host (as the root user):
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-p</span> /tmpmnt
<span class="gp">#</span><span class="w"> </span>/bin/mount <span class="nt">-t</span> nfs <span class="nt">-o</span> soft,nosharecache,timeo<span class="o">=</span>600,retrans<span class="o">=</span>6,nfsvers<span class="o">=</span>3 <span class="k">*</span>your-nfs-servername:/path/of/export<span class="k">*</span> /tmpmnt
</code></pre></div>    </div>
  </li>
  <li>Create the <strong>vdsm</strong> user with uid <strong>36</strong> on the ovirt-engine host if it does not already exist.</li>
  <li>Change to the <strong>vdsm</strong> user using <code class="language-plaintext highlighter-rouge">su - vdsm -s /bin/bash</code></li>
  <li>Try to create a file in it via the <code class="language-plaintext highlighter-rouge">touch</code> command, i.e. <code class="language-plaintext highlighter-rouge">touch /tmpmnt/tempfile</code></li>
  <li>Cleanup the file <code class="language-plaintext highlighter-rouge">rm -f /tmpmnt/tempfile</code></li>
  <li>Exit from the vdsm user and cleanup the temporary mountpoint:
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nb">exit</span>  
<span class="gp">#</span><span class="w"> </span>umount /tmpmnt
<span class="gp">#</span><span class="w"> </span>rf <span class="nt">-rf</span> /tmpmnt
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="nfs-check-program">nfs-check program</h3>

<p>A <strong>nfs-check</strong> script is now available to test whether an NFS export is ready for use by oVirt :</p>

<ul>
  <li><strong>nfs-check.py</strong> is a python script to validate nfs targets to use with oVirt project. Some operations include: mount the nfs target, create a file as vdsm:kvm and then remove it.</li>
  <li><strong>nfs-check.py</strong> is available in the <strong>vdsm/contrib/</strong> directory of the vdsm source</li>
  <li>Run it on a node via <code class="language-plaintext highlighter-rouge">python nfs-check.py 'server:/target'</code>
    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>curl <span class="nt">-o</span> nfs-check.py https://raw.githubusercontent.com/oVirt/vdsm/refs/heads/master/contrib/nfs-check.py
<span class="gp">$</span><span class="w"> </span>python3 nfs-check.py myNFSServer:/nfsTarget
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="commercial-nas">Commercial NAS</h2>

<p>It is not possible to provide details for all commercial NAS devices. The above RHEL derivative information should give you clues as to how to configure your commercial NAS to work with oVirt.</p>
<ul>
  <li>In general you will want to at least enable nfsvers=3 in your NAS and enable any appropriate firewall rules.</li>
  <li>You may need to squash all NFS requests to a specific NAS user on your device and give r/w to that specific NAS user.</li>
  <li>The <code class="language-plaintext highlighter-rouge">nfs-check.py</code> will assist you in connection testing to your NAS from oVirt.</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3231/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3231/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3231/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3231/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2026 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/troubleshooting-nfs-storage-issues.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/troubleshooting-nfs-storage-issues.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
