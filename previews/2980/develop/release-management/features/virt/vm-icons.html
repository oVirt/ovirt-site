<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>VM Icons | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="VM Icons" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2980/develop/release-management/features/virt/vm-icons.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2980/develop/release-management/features/virt/vm-icons.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VM Icons" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"VM Icons","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2980/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2980/develop/release-management/features/virt/vm-icons.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2980/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2980/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2980/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2980/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2980/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2980/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2980/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2980/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2980/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2980/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2980/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2980/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2980/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2980/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2980/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2980/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2980/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2980/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2980/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2980/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2980/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2980/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2980//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2980//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2980/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2980/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2980/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2980/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2980/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c468e8a042b6d6be9a7bd0f6cbc51157?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c468e8a042b6d6be9a7bd0f6cbc51157?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Jakub Niedermertl">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Jakub Niedermertl</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2980/documentation/'>Documentation is available here.</a></div>

<h1 id="vm-icons">VM Icons</h1>

<h2 id="summary">Summary</h2>

<p>It allows users to add icon to VMs and Templates in order to customize the appearance of these entities in userportal.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Jakub Niedermertl (jniederm)</li>
</ul>

<h2 id="description">Description</h2>

<p>User can optionally add arbitrary image (limited in dimensions, size, and format) - icon - to VM and Template entities. Icons are stored in new separate DB table ‘vm_icons’. Rows of this table are referenced from ‘vm_static’ table.</p>

<p>Currently used default icons (assigned according to OS) will also be stored in ‘vm_icons’ table. Thus this system fully replace current approach of storing and providing icons - GWT ClientBundles and ImageResources.</p>

<p>Each icon is stored in two sizes:</p>

<ul>
  <li>Large, 150x120 px, used in basic userportal</li>
  <li>Small, 43x43 px, used in mostly in extended userportal</li>
</ul>

<p>User can only upload the large version of custom icon, the small one is computed during store procedure.</p>

<h3 id="icon-inheritance">Icon inheritance</h3>

<ul>
  <li>When new Template is created, it inherits icon from VM it is based on.</li>
  <li>When new VM is created, it inherits icon from Template it is based on.</li>
  <li>When new Pool is created, it inherits icon from Template it is based on.</li>
  <li>When new VM in Pool is created, it inherits icon from Pool it belongs to.</li>
</ul>

<h3 id="pools">Pools</h3>

<ul>
  <li>Similarly to other VM parameters user can’t directly edit icon of pool or icons of VMs attached to a Pool. To update icon of a Pool one can create a Template with desired icon and then create new Pool based on that Template, or provided that the Pool is based on latest template version, create new version of base Template with desired icon.</li>
  <li>When icon of a pool is updated, icons of all attached VMs are also updated to the same icon.</li>
</ul>

<h3 id="default-icons">Default Icons</h3>

<ul>
  <li>Default icons are assigned based on operating system.</li>
  <li>‘vm_icon_defaults’ database table maps operating system IDs to icon IDs</li>
  <li>‘vm_icon_defaults’ table and default icons are updated during each engine startup according to ‘/usr/share/ovirt-engine/conf/osinfo-defaults.properties’ file and ‘/user/share/ovirt-engine/icons/small,large’ directories.</li>
</ul>

<h2 id="design">Design</h2>

<ul>
  <li>Supported image formats are: jpg, png, gif</li>
  <li>Maximum dimensions are 150px <small>x</small> 120px (w <small>x</small> h) (based on Userportal &gt; Basic icons)</li>
  <li>Maximum size is 24kB</li>
  <li>Icons are transferred and stored in dataUrl format.</li>
  <li>Icons are cached in browser based on their UUIDs in order to save network resources during listing updates.</li>
  <li>Icons are stored in separate database table. Each image is stored at most once.</li>
</ul>

<h3 id="ui">UI</h3>

<ul>
  <li>Show icons in Userportal &gt; Basic, Userpotal &gt; Extended &gt; Virtual Machines, Templates.</li>
  <li>Add icon editing and validating tab to ‘New VM’, ‘Edit VM’ and ‘Edit Template’, ‘New Pool’ dialogs.</li>
  <li>Create per-session cache of Icons: <code class="language-plaintext highlighter-rouge">Map&lt;Guid, String&gt; iconUuid -&gt; icon</code></li>
</ul>

<h3 id="backend">Backend</h3>

<ul>
  <li>Extend commands saving VMs and templates to be able to validate and store icon reference. It should validate that old icon, if custom (user defined), is still reference by other row or delete unused custom icon.</li>
  <li>Create new command to validate and store a new icon.</li>
  <li>Create new query to fetch map [guid-&gt;icon] by list of icon guids.</li>
  <li>Extend model VmBase by <code class="language-plaintext highlighter-rouge">Guid smallIconId</code> and <code class="language-plaintext highlighter-rouge">Guid LargeIconId</code>.</li>
  <li>Create new business entities corresponding to ‘vm_icons’ and ‘vm_icon_defaults’ database tables.</li>
</ul>

<h3 id="database">Database</h3>

<p><img src="/ovirt-site/previews/2980/images/wiki/Vm_icons_db.png" alt="Database schema" title="Database schema" /></p>

<h3 id="rest-api">REST API</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/api/icons</code> read-only top level collection of all icons</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      GET /icons
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;icons&gt;</span>
    <span class="nt">&lt;icon</span> <span class="na">href=</span><span class="s">"/ovirt-engine/api/icons/4905bfca-59a5-4022-ae66-ab7763f33c8f"</span> <span class="na">id=</span><span class="s">"4905bfca-59a5-4022-ae66-ab7763f33c8f"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;media_type&gt;</span>image/jpeg<span class="nt">&lt;/media_type&gt;</span>
        <span class="nt">&lt;data&gt;</span>/9j/4AAQSkZJRgABAQEAYABgAAD...<span class="nt">&lt;/data&gt;</span>
    <span class="nt">&lt;/icon&gt;</span>
    <span class="nt">&lt;icon</span> <span class="na">href=</span><span class="s">"/ovirt-engine/api/icons/91386415-dc7f-41db-90c6-e0b8f4f941b2"</span> <span class="na">id=</span><span class="s">"91386415-dc7f-41db-90c6-e0b8f4f941b2"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;media_type&gt;</span>image/png<span class="nt">&lt;/media_type&gt;</span>
        <span class="nt">&lt;data&gt;</span>iVBORw...<span class="nt">&lt;/data&gt;</span>
    <span class="nt">&lt;/icon&gt;</span>
<span class="nt">&lt;/icons&gt;</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/api/icons/{id}</code> provides an object corresponding to VmIcon business entity</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      GET /icons/4905bfca-59a5-4022-ae66-ab7763f33c8f
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;icon</span> <span class="na">href=</span><span class="s">"/ovirt-engine/api/icons/4905bfca-59a5-4022-ae66-ab7763f33c8f"</span> <span class="na">id=</span><span class="s">"4905bfca-59a5-4022-ae66-ab7763f33c8f"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;media_type&gt;</span>image/jpeg<span class="nt">&lt;/media_type&gt;</span>
    <span class="nt">&lt;data&gt;</span>/9j/4AAQSkZJ...<span class="nt">&lt;/data&gt;</span>
<span class="nt">&lt;/icon&gt;</span>
</code></pre></div></div>

<ul>
  <li>entities at <code class="language-plaintext highlighter-rouge">/api/vms/{id}</code> and <code class="language-plaintext highlighter-rouge">/api/templates/{id}</code> contains properties <code class="language-plaintext highlighter-rouge">small_icon</code> and <code class="language-plaintext highlighter-rouge">large_icon</code> that provides icon IDs that and can be resolved using top level <code class="language-plaintext highlighter-rouge">/api/icons</code> collection</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      GET /api/vms/789
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;vm</span> <span class="na">id=</span><span class="s">"789"</span> <span class="na">href=</span><span class="s">...</span><span class="nt">&gt;</span>
      ...
    <span class="nt">&lt;small_icon</span> <span class="na">id=</span><span class="s">"123"</span> <span class="na">href=</span><span class="s">"/icons/123"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;large_icon</span> <span class="na">id=</span><span class="s">"456"</span> <span class="na">href=</span><span class="s">"/icons/456"</span> <span class="nt">/&gt;</span>
      ...
<span class="nt">&lt;/vm&gt;</span>
</code></pre></div></div>

<ul>
  <li>Icons of vm or template can be updated either by uploading new large icon (small icon is automatically computed by shrinking large one) or by setting new id of small, large or both icons. Similar approach can be applied to creation of vms and templates.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      PUG /vms/789
      Content-Type: application/xml
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;vm&gt;</span>
    <span class="nt">&lt;large_icon&gt;</span>
        <span class="nt">&lt;media_type&gt;</span>image/png<span class="nt">&lt;/media_type&gt;</span>
        <span class="nt">&lt;data&gt;</span>iVBORw0KGgoAAAANSUhEUgAAAJ...<span class="nt">&lt;/data&gt;</span>
    <span class="nt">&lt;/large_icon&gt;</span>
          ...
<span class="nt">&lt;/vm&gt;</span>

<span class="nt">&lt;vm</span> <span class="na">id=</span><span class="s">"789"</span> <span class="na">href=</span><span class="s">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;small_icon</span> <span class="na">id=</span><span class="s">"111"</span> <span class="na">href=</span><span class="s">"/icons/111"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;large_icon</span> <span class="na">id=</span><span class="s">"222"</span> <span class="na">href=</span><span class="s">"/icons/222"</span> <span class="nt">/&gt;</span>
          ...
<span class="nt">&lt;/vm&gt;</span>
</code></pre></div></div>

<hr />

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      PUT /vms/789
      Content-Type: application/xml
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;vm&gt;</span>
    <span class="nt">&lt;small_icon</span> <span class="na">id=</span><span class="s">"123"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;large_icon</span> <span class="na">id=</span><span class="s">"456"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/vm&gt;</span>

<span class="nt">&lt;vm</span> <span class="na">id=</span><span class="s">"147"</span> <span class="na">href=</span><span class="s">...</span><span class="nt">&gt;</span>
    <span class="nt">&lt;small_icon</span> <span class="na">id=</span><span class="s">"123"</span> <span class="na">href=</span><span class="s">"/icons/123"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;large_icon</span> <span class="na">id=</span><span class="s">"456"</span> <span class="na">href=</span><span class="s">"/icons/456"</span> <span class="nt">/&gt;</span>
          ...
<span class="nt">&lt;/vm&gt;</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/api/operationgsystems</code> and <code class="language-plaintext highlighter-rouge">/api/operationgsystems/{id}</code> provides information about default icons of operating systems</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      GET /operatingsystems
      Accept: application/xml
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;operating_systems&gt;</span>
    <span class="nt">&lt;operating_system</span> <span class="na">href=</span><span class="s">"/operatingsystems/1"</span> <span class="na">id=</span><span class="s">"1"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;name&gt;</span>windows_xp<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;description&gt;</span>Windows XP<span class="nt">&lt;/description&gt;</span>
        <span class="nt">&lt;large_icon</span> <span class="na">href=</span><span class="s">"/icons/14f38bb8-4754-4837-b158-e00fd9ec7297"</span> <span class="na">id=</span><span class="s">"14f38bb8-4754-4837-b158-e00fd9ec7297"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;small_icon</span> <span class="na">href=</span><span class="s">"/icons/d300a94e-f00b-477f-b040-6763dc7bce0c"</span> <span class="na">id=</span><span class="s">"d300a94e-f00b-477f-b040-6763dc7bce0c"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/operating_system&gt;</span>
<span class="nt">&lt;/operating_systems&gt;</span>
</code></pre></div></div>

<h3 id="compatibility-issues">Compatibility issues</h3>

<p>Proposed design requires following browser ‘HTML5’ features:</p>

<ul>
  <li>dataURL, IE8 limits content size to 24kB, IE9 full support</li>
  <li>File API (File and FileReader objects), since IE10</li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2980/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2980/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2980/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2980/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/vm-icons.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/virt/vm-icons.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
