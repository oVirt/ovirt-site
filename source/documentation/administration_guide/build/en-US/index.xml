<?xml version="1.0" encoding="UTF-8"?>
<?asciidoc-toc maxdepth="3"?>
<?asciidoc-numbered?>
<book xmlns="http://docbook.org/ns/docbook" xmlns:xl="http://www.w3.org/1999/xlink" version="5.0">
<info>
<title>Administration Guide</title>
<date>2021-07-12</date>
<title>Administration Guide</title>
<productname>Red Hat Virtualization</productname>
<productnumber>4.4</productnumber>
<subtitle>Administration tasks in Red Hat Virtualization</subtitle>
<abstract><para>This document provides information and procedures relevant to Red Hat Virtualization administrators.</para>
<!--<para>This document is only provided as a preview. It is under development and is subject to substantial change. Consider the included information incomplete and use it with caution.</para>-->
</abstract>
<authorgroup id="Author_Group">
	<author>
		<firstname>Red Hat Virtualization</firstname><surname>Documentation Team</surname>
		<affiliation>
			<orgname>
				Red Hat
			</orgname>
			<orgdiv>
				Customer Content Services
			</orgdiv>
		</affiliation><email>rhev-docs@redhat.com</email>
	</author>
</authorgroup>
</info>
<preface>
<title>Preface</title>
<bridgehead xml:id="_administration_guide" renderas="sect0">Administration Guide</bridgehead>
</preface>
<part xml:id="part-Administering_and_Maintaining_the_Red_Hat_Virtualization_Environment">
<title>Administering and Maintaining the oVirt Environment</title>
<partintro>
<simpara>The oVirt environment requires an administrator to keep it running. As an administrator, your tasks include:</simpara>
<itemizedlist>
<listitem>
<simpara>Managing physical and virtual resources such as hosts and virtual machines. This includes upgrading and adding hosts, importing domains, converting virtual machines created on foreign hypervisors, and managing virtual machine pools.</simpara>
</listitem>
<listitem>
<simpara>Monitoring the overall system resources for potential problems such as extreme load on one of the hosts, insufficient memory or disk space, and taking any necessary actions (such as migrating virtual machines to other hosts to lessen the load or freeing resources by shutting down machines).</simpara>
</listitem>
<listitem>
<simpara>Responding to the new requirements of virtual machines (for example, upgrading the operating system or allocating more memory).</simpara>
</listitem>
<listitem>
<simpara>Managing customized object properties using tags.</simpara>
</listitem>
<listitem>
<simpara>Managing searches saved as <link linkend="chap-Bookmarks">public bookmarks</link>.</simpara>
</listitem>
<listitem>
<simpara>Managing user setup and setting permission levels.</simpara>
</listitem>
<listitem>
<simpara>Troubleshooting for specific users or virtual machines for overall system functionality.</simpara>
</listitem>
<listitem>
<simpara>Generating general and specific reports.</simpara>
</listitem>
</itemizedlist>
</partintro>
<chapter xml:id="chap-Global_Configuration">
<title>Global Configuration</title>
<simpara>Accessed by clicking <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>, the <emphasis role="strong">Configure</emphasis> window allows you to configure a number of global resources for your oVirt environment, such as users, roles, system permissions, scheduling policies, instance types, and MAC address pools. This window allows you to customize the way in which users interact with resources in the environment, and provides a central location for configuring options that can be applied to multiple clusters.</simpara>
<section xml:id="sect-Roles">
<title>Roles</title>
<simpara>Roles are predefined sets of privileges that can be configured from oVirt Engine. Roles provide access and management permissions to different levels of resources in the data center, and to specific physical and virtual resources.</simpara>
<simpara>With multilevel administration, any permissions which apply to a container object also apply to all individual objects within that container. For example, when a host administrator role is assigned to a user on a specific host, the user gains permissions to perform any of the available host operations, but only on the assigned host. However, if the host administrator role is assigned to a user on a data center, the user gains permissions to perform host operations on all hosts within the cluster of the data center.</simpara>
<section xml:id="Creating_a_new_role">
<title>Creating a New Role</title>
<simpara>If the role you require is not on oVirt&#8217;s default list of roles, you can create a new role and customize it to suit your purposes.</simpara>
<simpara><emphasis role="strong">Creating a New Role</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Configure</emphasis> window. The <emphasis role="strong">Roles</emphasis> tab is selected by default, showing a list of default User and Administrator roles, and any custom roles.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the new role.</simpara>
</listitem>
<listitem>
<simpara>Select either <emphasis role="strong">Admin</emphasis> or <emphasis role="strong">User</emphasis> as the <emphasis role="strong">Account Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Expand All</emphasis> or <emphasis role="strong">Collapse All</emphasis> buttons to view more or fewer of the permissions for the listed objects in the <emphasis role="strong">Check Boxes to Allow Action</emphasis> list. You can also expand or collapse the options for each object.</simpara>
</listitem>
<listitem>
<simpara>For each of the objects, select or clear the actions you want to permit or deny for the role you are setting up.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to apply the changes. The new role displays on the list of roles.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Editing_a_role">
<title>Editing or Copying a Role</title>
<simpara>You can change the settings for roles you have created, but you cannot change default roles. To change default roles, clone and modify them to suit your requirements.</simpara>
<simpara><emphasis role="strong">Editing or Copying a Role</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Configure</emphasis> window, which shows a list of default User and Administrator roles, as well as any custom roles.</simpara>
</listitem>
<listitem>
<simpara>Select the role you wish to change.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Edit</guibutton> or <guibutton>Copy</guibutton>. This opens the <emphasis role="strong">Edit Role</emphasis> or <emphasis role="strong">Copy Role</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>If necessary, edit the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the role.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Expand All</emphasis> or <emphasis role="strong">Collapse All</emphasis> buttons to view more or fewer of the permissions for the listed objects. You can also expand or collapse the options for each object.</simpara>
</listitem>
<listitem>
<simpara>For each of the objects, select or clear the actions you wish to permit or deny for the role you are editing.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to apply the changes you have made.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Authorization_examples">
<title>User Role and Authorization Examples</title>
<simpara>The following examples illustrate how to apply authorization controls for various scenarios, using the different features of the authorization system described in this chapter.</simpara>
<example xml:id="VM_Cluster_Permissions-1">
<title>Cluster Permissions</title>
<simpara>Sarah is the system administrator for the accounts department of a company. All the virtual resources for her department are organized under a oVirt <emphasis role="strong">cluster</emphasis> called <literal>Accounts</literal>. She is assigned the <emphasis role="strong">ClusterAdmin</emphasis> role on the accounts cluster. This enables her to manage all virtual machines in the cluster, since the virtual machines are child objects of the cluster. Managing the virtual machines includes editing, adding, or removing virtual resources such as disks, and taking snapshots. It does not allow her to manage any resources outside this cluster. Because <emphasis role="strong">ClusterAdmin</emphasis> is an administrator role, it allows her to use the Administration Portal or the VM Portal to manage these resources.</simpara>
</example>
<example xml:id="VM_UserVmManager_Permissions-1">
<title>VM PowerUser Permissions</title>
<simpara>John is a software developer in the accounts department. He uses virtual machines to build and test his software. Sarah has created a virtual desktop called <literal>johndesktop</literal> for him. John is assigned the <emphasis role="strong">UserVmManager</emphasis> role on the <literal>johndesktop</literal> virtual machine. This allows him to access this single virtual machine using the VM Portal. Because he has <emphasis role="strong">UserVmManager</emphasis> permissions, he can modify the virtual machine. Because <emphasis role="strong">UserVmManager</emphasis> is a user role, it does not allow him to use the Administration Portal.</simpara>
</example>
<example xml:id="DataCenter_Power_User_Role_Permissions-1">
<title>Data Center Power User Role Permissions</title>
<simpara>Penelope is an office manager. In addition to her own responsibilities, she occasionally helps the HR manager with recruitment tasks, such as scheduling interviews and following up on reference checks. As per corporate policy, Penelope needs to use a particular application for recruitment tasks.</simpara>
<simpara>While Penelope has her own machine for office management tasks, she wants to create a separate virtual machine to run the recruitment application. She is assigned <emphasis role="strong">PowerUserRole</emphasis> permissions for the data center in which her new virtual machine will reside. This is because to create a new virtual machine, she needs to make changes to several components within the data center, including creating the virtual disk in the storage domain.</simpara>
<simpara>Note that this is not the same as assigning <emphasis role="strong">DataCenterAdmin</emphasis> privileges to Penelope. As a PowerUser for a data center, Penelope can log in to the VM Portal and perform virtual machine-specific actions on virtual machines within the data center. She cannot perform data center-level operations such as attaching hosts or storage to a data center.</simpara>
</example>
<example xml:id="Network_Role_Permissions">
<title>Network Administrator Permissions</title>
<simpara>Chris works as the network administrator in the IT department. Her day-to-day responsibilities include creating, manipulating, and removing networks in the department&#8217;s oVirt environment. For her role, she requires administrative privileges on the resources and on the networks of each resource. For example, if Chris has <emphasis role="strong">NetworkAdmin</emphasis> privileges on the IT department&#8217;s data center, she can add and remove networks in the data center, and attach and detach networks for all virtual machines belonging to the data center.</simpara>
</example>
<example xml:id="Custom_Role_Permissions-1">
<title>Custom Role Permissions</title>
<simpara>Rachel works in the IT department, and is responsible for managing user accounts in oVirt. She needs permission to add user accounts and assign them the appropriate roles and permissions. She does not use any virtual machines herself, and should not have access to administration of hosts, virtual machines, clusters or data centers. There is no built-in role which provides her with this specific set of permissions. A custom role must be created to define the set of permissions appropriate to Rachel&#8217;s position.</simpara>
<figure xml:id="rhv-object-hierarchy">
<title>UserManager Custom Role</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/UserManagerRole.png"/>
</imageobject>
<textobject><phrase>UserManagerRole</phrase></textobject>
</mediaobject>
</figure>
<simpara>The <emphasis role="strong">UserManager</emphasis> custom role shown above allows manipulation of users, permissions and roles. These actions are organized under <emphasis role="strong">System</emphasis> - the top level object of the hierarchy shown in <xref linkend="rhev-object-hierarchy-2"/>. This means they apply to all other objects in the system. The role is set to have an <emphasis role="strong">Account Type</emphasis> of <emphasis role="strong">Admin</emphasis>. This means that when she is assigned this role, Rachel can use both the Administration Portal and the VM Portal.</simpara>
</example>
</section>
</section>
<section xml:id="sect-System_Permissions">
<title>System Permissions</title>
<simpara>Permissions enable users to perform actions on objects, where objects are either individual objects or container objects. Any permissions that apply to a container object also apply to all members of that container.</simpara>
<figure xml:id="rhev-roles-permissions">
<title>Permissions &amp; Roles</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/496.png"/>
</imageobject>
<textobject><phrase>496</phrase></textobject>
</mediaobject>
</figure>
<figure xml:id="rhev-object-hierarchy-2">
<title>oVirt Object Hierarchy</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/492.png"/>
</imageobject>
<textobject><phrase>492</phrase></textobject>
</mediaobject>
</figure>
<section xml:id="User_properties">
<title>User Properties</title>
<simpara>Roles and permissions are the properties of the user. Roles are predefined sets of privileges that permit access to different levels of physical and virtual resources. Multilevel administration provides a finely grained hierarchy of permissions. For example, a data center administrator has permissions to manage all objects in the data center, while a host administrator has system administrator permissions to a single physical host. A user can have permissions to use a single virtual machine but not make any changes to the virtual machine configurations, while another user can be assigned system permissions to a virtual machine.</simpara>
</section>
<section xml:id="User_properties_roles">
<title>User and Administrator Roles</title>
<simpara>oVirt provides a range of pre-configured roles, from an administrator with system-wide permissions to an end user with access to a single virtual machine. While you cannot change or remove the default roles, you can clone and customize them, or create new roles according to your requirements. There are two types of roles:</simpara>
<itemizedlist>
<listitem>
<simpara>Administrator Role: Allows access to the <emphasis role="strong">Administration Portal</emphasis> for managing physical and virtual resources. An administrator role confers permissions for actions to be performed in the VM Portal; however, it has no bearing on what a user can see in the VM Portal.</simpara>
</listitem>
<listitem>
<simpara>User Role: Allows access to the <emphasis role="strong">VM Portal</emphasis> for managing and accessing virtual machines and templates. A user role determines what a user can see in the VM Portal. Permissions granted to a user with an administrator role are reflected in the actions available to that user in the VM Portal.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="User_Roles_Explained">
<title>User Roles Explained</title>
<simpara>The table below describes basic user roles which confer permissions to access and configure virtual machines in the VM Portal.</simpara>
<table xml:id="User_Roles_Basic" frame="all" rowsep="1" colsep="1">
<title>oVirt User Roles - Basic</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>UserRole</simpara></entry>
<entry align="left" valign="top"><simpara>Can access and use virtual machines and pools.</simpara></entry>
<entry align="left" valign="top"><simpara>Can log in to the VM Portal, use assigned virtual machines and pools, view virtual machine state and details.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>PowerUserRole</simpara></entry>
<entry align="left" valign="top"><simpara>Can create and manage virtual machines and templates.</simpara></entry>
<entry align="left" valign="top"><simpara>Apply this role to a user for the whole environment with the <emphasis role="strong">Configure</emphasis> window, or for specific data centers or clusters. For example, if a PowerUserRole is applied on a data center level, the PowerUser can create virtual machines and templates in the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>UserVmManager</simpara></entry>
<entry align="left" valign="top"><simpara>System administrator of a virtual machine.</simpara></entry>
<entry align="left" valign="top"><simpara>Can manage virtual machines and create and use snapshots. A user who creates a virtual machine in the VM Portal is automatically assigned the UserVmManager role on the machine.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The table below describes advanced user roles which allow you to do more fine tuning of permissions for resources in the VM Portal.</simpara>
<table xml:id="User_Roles_Advanced" frame="all" rowsep="1" colsep="1">
<title>oVirt User Roles - Advanced</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>UserTemplateBasedVm</simpara></entry>
<entry align="left" valign="top"><simpara>Limited privileges to only use Templates.</simpara></entry>
<entry align="left" valign="top"><simpara>Can use templates to create virtual machines.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DiskOperator</simpara></entry>
<entry align="left" valign="top"><simpara>Virtual disk user.</simpara></entry>
<entry align="left" valign="top"><simpara>Can use, view and edit virtual disks. Inherits permissions to use the virtual machine to which the virtual disk is attached.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>VmCreator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create virtual machines in the VM Portal.</simpara></entry>
<entry align="left" valign="top"><simpara>This role is not applied to a specific virtual machine; apply this role to a user for the whole environment with the <emphasis role="strong">Configure</emphasis> window. Alternatively apply this role for specific data centers or clusters. When applying this role to a cluster, you must also apply the DiskCreator role on an entire data center, or on specific storage domains.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>TemplateCreator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, edit, manage and remove virtual machine templates within assigned resources.</simpara></entry>
<entry align="left" valign="top"><simpara>This role is not applied to a specific template; apply this role to a user for the whole environment with the <emphasis role="strong">Configure</emphasis> window. Alternatively apply this role for specific data centers, clusters, or storage domains.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DiskCreator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, edit, manage and remove virtual disks within assigned clusters or data centers.</simpara></entry>
<entry align="left" valign="top"><simpara>This role is not applied to a specific virtual disk; apply this role to a user for the whole environment with the <emphasis role="strong">Configure</emphasis> window. Alternatively apply this role for specific data centers or storage domains.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>TemplateOwner</simpara></entry>
<entry align="left" valign="top"><simpara>Can edit and delete the template, assign and manage user permissions for the template.</simpara></entry>
<entry align="left" valign="top"><simpara>This role is automatically assigned to the user who creates a template. Other users who do not have <emphasis role="strong">TemplateOwner</emphasis> permissions on a template cannot view or use the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>VnicProfileUser</simpara></entry>
<entry align="left" valign="top"><simpara>Logical network and network interface user for virtual machine and template.</simpara></entry>
<entry align="left" valign="top"><simpara>Can attach or detach network interfaces from specific logical networks.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Administrator_Roles_Explained">
<title>Administrator Roles Explained</title>
<simpara>The table below describes basic administrator roles which confer permissions to access and configure resources in the Administration Portal.</simpara>
<table xml:id="Admin_Roles_Basic" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles - Basic</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>SuperUser</simpara></entry>
<entry align="left" valign="top"><simpara>System Administrator of the oVirt environment.</simpara></entry>
<entry align="left" valign="top"><simpara>Has full permissions across all objects and levels, can manage all objects across all data centers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ClusterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Cluster Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Possesses administrative permissions for all objects underneath a specific cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DataCenterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Data Center Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Possesses administrative permissions for all objects underneath a specific data center except for storage.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<important>
<simpara>Do not use the administrative user for the directory server as the oVirt administrative user. Create a user in the directory server specifically for use as the oVirt administrative user.</simpara>
</important>
<simpara>The table below describes advanced administrator roles which allow you to do more fine tuning of permissions for resources in the Administration Portal.</simpara>
<table xml:id="Admin_Roles_Advanced" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles - Advanced</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>TemplateAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Administrator of a virtual machine template.</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, and configure the storage domains and network details of templates, and move templates between domains.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>StorageAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Storage Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, configure, and manage an assigned storage domain.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>HostAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Host Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Can attach, remove, configure, and manage a specific host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NetworkAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Network Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Can configure and manage the network of a particular data center or cluster. A network administrator of a data center or cluster inherits network permissions for virtual pools within the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>VmPoolAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>System Administrator of a virtual pool.</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, and configure a virtual pool; assign and remove virtual pool users; and perform basic operations on a virtual machine in the pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>GlusterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Gluster Storage Administrator.</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, configure, and manage Gluster storage volumes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>VmImporterExporter</simpara></entry>
<entry align="left" valign="top"><simpara>Import and export Administrator of a virtual machine.</simpara></entry>
<entry align="left" valign="top"><simpara>Can import and export virtual machines. Able to view all virtual machines and templates exported by other users.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Assigning_an_Administrator_or_User_Role_to_a_Resource">
<title>Assigning an Administrator or User Role to a Resource</title>
<simpara>Assign administrator or user roles to resources to allow users to access or manage that resource.</simpara>
<simpara><emphasis role="strong">Assigning a Role to a Resource</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Find and click the resource&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Permissions</emphasis> tab to list the assigned users, the user&#8217;s role, and the inherited permissions for the selected resource.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the name or user name of an existing user into the <emphasis role="strong">Search</emphasis> text box and click <emphasis role="strong">Go</emphasis>. Select a user from the resulting list of possible matches.</simpara>
</listitem>
<listitem>
<simpara>Select a role from the <emphasis role="strong">Role to Assign</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The user now has the inherited permissions of that role enabled for that resource.</simpara>
</section>
<section xml:id="Removing_an_Administrator_or_User_Role_from_a_Resource">
<title>Removing an Administrator or User Role from a Resource</title>
<simpara>Remove an administrator or user role from a resource; the user loses the inherited permissions associated with the role for that resource.</simpara>
<simpara><emphasis role="strong">Removing a Role from a Resource</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Find and click the resource&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Permissions</emphasis> tab to list the assigned users, the user&#8217;s role, and the inherited permissions for the selected resource.</simpara>
</listitem>
<listitem>
<simpara>Select the user to remove from the resource.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Data_center_system_permissions">
<title>Managing System Permissions for a Data Center</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A data center administrator is a system administration role for a specific data center only. This is useful in virtualization environments with multiple data centers where each data center requires an administrator. The <emphasis role="strong">DataCenterAdmin</emphasis> role is a hierarchical model; a user assigned the data center administrator role for a data center can manage all objects in the data center with the exception of storage for that data center. Use the <emphasis role="strong">Configure</emphasis> button in the header bar to assign a data center administrator for all data centers in the environment.</simpara>
<simpara>The data center administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Create and remove clusters associated with the data center.</simpara>
</listitem>
<listitem>
<simpara>Add and remove hosts, virtual machines, and pools associated with the data center.</simpara>
</listitem>
<listitem>
<simpara>Edit user permissions for virtual machines associated with the data center.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can only assign roles and permissions to existing users.</simpara>
</note>
<simpara>You can change the system administrator of a data center by removing the existing system administrator and adding the new system administrator.</simpara>
</section>
<section xml:id="Data_center_permissions_entities">
<title>Data Center Administrator Roles Explained</title>
<simpara><emphasis role="strong">Data Center Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator roles and privileges applicable to data center administration.</simpara>
<table xml:id="Data_Center_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>DataCenterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Data Center Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can use, create, delete, manage all physical and virtual resources within a specific data center except for storage, including clusters, hosts, templates and virtual machines.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NetworkAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Network Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can configure and manage the network of a particular data center. A network administrator of a data center inherits network permissions for virtual machines within the data center as well.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Managing_system_permissions_for_a_cluster">
<title>Managing System Permissions for a Cluster</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A cluster administrator is a system administration role for a specific cluster only. This is useful in data centers with multiple clusters, where each cluster requires a system administrator. The <emphasis role="strong">ClusterAdmin</emphasis> role is a hierarchical model: a user assigned the cluster administrator role for a cluster can manage all objects in the cluster. Use the <emphasis role="strong">Configure</emphasis> button in the header bar to assign a cluster administrator for all clusters in the environment.</simpara>
<simpara>The cluster administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Create and remove associated clusters.</simpara>
</listitem>
<listitem>
<simpara>Add and remove hosts, virtual machines, and pools associated with the cluster.</simpara>
</listitem>
<listitem>
<simpara>Edit user permissions for virtual machines associated with the cluster.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can only assign roles and permissions to existing users.</simpara>
</note>
<simpara>You can also change the system administrator of a cluster by removing the existing system administrator and adding the new system administrator.</simpara>
</section>
<section xml:id="Cluster_permissions_entities">
<title>Cluster Administrator Roles Explained</title>
<simpara><emphasis role="strong">Cluster Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator roles and privileges applicable to cluster administration.</simpara>
<table xml:id="Cluster_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>ClusterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Cluster Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can use, create, delete, manage all physical and virtual resources in a specific cluster, including hosts, templates and virtual machines. Can configure network properties within the cluster such as designating display networks, or marking a network as required or non-required.</simpara><simpara>However, a <emphasis role="strong">ClusterAdmin</emphasis> does not have permissions to attach or detach networks from a cluster, to do so <emphasis role="strong">NetworkAdmin</emphasis> permissions are required.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NetworkAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Network Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can configure and manage the network of a particular cluster. A network administrator of a cluster inherits network permissions for virtual machines within the cluster as well.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Managing_System_Permissions_for_a_Network">
<title>Managing System Permissions for a Network</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A network administrator is a system administration role that can be applied for a specific network, or for all networks on a data center, cluster, host, virtual machine, or template. A network user can perform limited administration roles, such as viewing and attaching networks on a specific virtual machine or template. You can use the <emphasis role="strong">Configure</emphasis> button in the header bar to assign a network administrator for all networks in the environment.</simpara>
<simpara>The network administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Create, edit and remove networks.</simpara>
</listitem>
<listitem>
<simpara>Edit the configuration of the network, including configuring port mirroring.</simpara>
</listitem>
<listitem>
<simpara>Attach and detach networks from resources including clusters and virtual machines.</simpara>
</listitem>
</itemizedlist>
<simpara>The user who creates a network is automatically assigned <emphasis role="strong">NetworkAdmin</emphasis> permissions on the created network. You can also change the administrator of a network by removing the existing administrator and adding the new administrator.</simpara>
</section>
<section xml:id="Network_Administrator_and_User_Roles_Explained">
<title>Network Administrator and User Roles Explained</title>
<simpara><emphasis role="strong">Network Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator and user roles and privileges applicable to network administration.</simpara>
<table xml:id="Network_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt Network Administrator and User Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>NetworkAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Network Administrator for data center, cluster, host, virtual machine, or template. The user who creates a network is automatically assigned <emphasis role="strong">NetworkAdmin</emphasis> permissions on the created network.</simpara></entry>
<entry align="left" valign="top"><simpara>Can configure and manage the network of a particular data center, cluster, host, virtual machine, or template. A network administrator of a data center or cluster inherits network permissions for virtual pools within the cluster. To configure port mirroring on a virtual machine network, apply the <emphasis role="strong">NetworkAdmin</emphasis> role on the network and the <emphasis role="strong">UserVmManager</emphasis> role on the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>VnicProfileUser</simpara></entry>
<entry align="left" valign="top"><simpara>Logical network and network interface user for virtual machine and template.</simpara></entry>
<entry align="left" valign="top"><simpara>Can attach or detach network interfaces from specific logical networks.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="To_view_hosts_in_a_cluster">
<title>Managing System Permissions for a Host</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A host administrator is a system administration role for a specific host only. This is useful in clusters with multiple hosts, where each host requires a system administrator. You can use the <emphasis role="strong">Configure</emphasis> button in the header bar to assign a host administrator for all hosts in the environment.</simpara>
<simpara>The host administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Edit the configuration of the host.</simpara>
</listitem>
<listitem>
<simpara>Set up the logical networks.</simpara>
</listitem>
<listitem>
<simpara>Remove the host.</simpara>
</listitem>
</itemizedlist>
<simpara>You can also change the system administrator of a host by removing the existing system administrator and adding the new system administrator.</simpara>
</section>
<section xml:id="To_view_virtual_machines_in_a_cluster">
<title>Host Administrator Roles Explained</title>
<simpara><emphasis role="strong">Host Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator roles and privileges applicable to host administration.</simpara>
<table xml:id="Host_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>HostAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Host Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can configure, manage, and remove a specific host. Can also perform network-related operations on a specific host.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Cluster_hosts_entities">
<title>Managing System Permissions for a Storage Domain</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A storage administrator is a system administration role for a specific storage domain only. This is useful in data centers with multiple storage domains, where each storage domain requires a system administrator. Use the <emphasis role="strong">Configure</emphasis> button in the header bar to assign a storage administrator for all storage domains in the environment.</simpara>
<simpara>The storage domain administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Edit the configuration of the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Move the storage domain into maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Remove the storage domain.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can only assign roles and permissions to existing users.</simpara>
</note>
<simpara>You can also change the system administrator of a storage domain by removing the existing system administrator and adding the new system administrator.</simpara>
</section>
<section xml:id="Cluster_virtual_machine_entities">
<title>Storage Administrator Roles Explained</title>
<simpara><emphasis role="strong">Storage Domain Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator roles and privileges applicable to storage domain administration.</simpara>
<table xml:id="Storage_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>StorageAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Storage Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, configure and manage a specific storage domain.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>GlusterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Gluster Storage Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, configure and manage Gluster storage volumes.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Data_center_logical_network_entities">
<title>Managing System Permissions for a Virtual Machine Pool</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>A virtual machine pool administrator is a system administration role for virtual machine pools in a data center. This role can be applied to specific virtual machine pools, to a data center, or to the whole virtualized environment; this is useful to allow different users to manage certain virtual machine pool resources.</simpara>
<simpara>The virtual machine pool administrator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Create, edit, and remove pools.</simpara>
</listitem>
<listitem>
<simpara>Add and detach virtual machines from the pool.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can only assign roles and permissions to existing users.</simpara>
</note>
</section>
<section xml:id="Cluster_logical_network_entities">
<title>Virtual Machine Pool Administrator Roles Explained</title>
<simpara><emphasis role="strong">Pool Permission Roles</emphasis></simpara>
<simpara>The table below describes the administrator roles and privileges applicable to pool administration.</simpara>
<table xml:id="Pool_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>VmPoolAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>System Administrator role of a virtual pool.</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, delete, and configure a virtual pool, assign and remove virtual pool users, and perform basic operations on a virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ClusterAdmin</simpara></entry>
<entry align="left" valign="top"><simpara>Cluster Administrator</simpara></entry>
<entry align="left" valign="top"><simpara>Can use, create, delete, manage all virtual machine pools in a specific cluster.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Managing_System_Permissions_for_a_Virtual_Disk">
<title>Managing System Permissions for a Virtual Disk</title>
<simpara>As the <emphasis role="strong">SuperUser</emphasis>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <emphasis role="strong">DataCenterAdmin</emphasis> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <emphasis role="strong">ClusterAdmin</emphasis> has administrator privileges only for the assigned cluster.</simpara>
<simpara>oVirt Engine provides two default virtual disk user roles, but no default virtual disk administrator roles. One of these user roles, the <emphasis role="strong">DiskCreator</emphasis> role, enables the administration of virtual disks from the VM Portal. This role can be applied to specific virtual machines, to a data center, to a specific storage domain, or to the whole virtualized environment; this is useful to allow different users to manage different virtual resources.</simpara>
<simpara>The virtual disk creator role permits the following actions:</simpara>
<itemizedlist>
<listitem>
<simpara>Create, edit, and remove virtual disks associated with a virtual machine or other resources.</simpara>
</listitem>
<listitem>
<simpara>Edit user permissions for virtual disks.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can only assign roles and permissions to existing users.</simpara>
</note>
</section>
<section xml:id="Virtual_Disk_User_Roles_Explained">
<title>Virtual Disk User Roles Explained</title>
<simpara><emphasis role="strong">Virtual Disk User Permission Roles</emphasis></simpara>
<simpara>The table below describes the user roles and privileges applicable to using and administrating virtual disks in the VM Portal.</simpara>
<table xml:id="Virtual_Disk_Administrator_Roles" frame="all" rowsep="1" colsep="1">
<title>oVirt System Administrator Roles</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Role</entry>
<entry align="left" valign="top">Privileges</entry>
<entry align="left" valign="top">Notes</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>DiskOperator</simpara></entry>
<entry align="left" valign="top"><simpara>Virtual disk user.</simpara></entry>
<entry align="left" valign="top"><simpara>Can use, view and edit virtual disks. Inherits permissions to use the virtual machine to which the virtual disk is attached.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DiskCreator</simpara></entry>
<entry align="left" valign="top"><simpara>Can create, edit, manage and remove virtual disks within assigned clusters or data centers.</simpara></entry>
<entry align="left" valign="top"><simpara>This role is not applied to a specific virtual disk; apply this role to a user for the whole environment with the <emphasis role="strong">Configure</emphasis> window. Alternatively apply this role for specific data centers, clusters, or storage domains.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Setting_Legacy_SPICE_Cipher_system_permissions">
<title>Setting a Legacy SPICE Cipher</title>
<simpara>SPICE consoles use FIPS-compliant encryption by default, with a cipher string. The default SPICE cipher string is:
<literal>kECDHE+FIPS:kDHE+FIPS:kRSA+FIPS:!eNULL:!aNULL</literal></simpara>
<simpara>This string is generally sufficient. However, if you have a virtual machine with an older operating system or SPICE client, where either one or the other does not support FIPS-compliant encryption, you must use a weaker cipher string. Otherwise, a connection security error may occur if you install a new cluster or a new host in an existing cluster and try to connect to that virtual machine.</simpara>
<simpara>You can change the cipher string by using an Ansible playbook.</simpara>
<simpara><emphasis role="strong">Changing the cipher string</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine machine, create a file in the directory <literal role="filename">/usr/share/ovirt-engine/playbooks</literal>. For example:</simpara>
<screen># vim /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</screen>
</listitem>
<listitem>
<simpara>Enter the following in the file and save it:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">name: oVirt - setup weaker SPICE encryption for old clients
hosts: <emphasis>hostname</emphasis>
vars:
  host_deploy_spice_cipher_string: 'DEFAULT:-RC4:-3DES:-DES'
roles:
  - ovirt-host-deploy-spice-encryption</programlisting>
</listitem>
<listitem>
<simpara>Run the file you just created:</simpara>
<screen># ansible-playbook -l <emphasis>hostname</emphasis> /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</screen>
</listitem>
</orderedlist>
<simpara>Alternatively, you can reconfigure the host with the Ansible playbook <literal>ovirt-host-deploy</literal>  using the  <literal>--extra-vars</literal> option  with the variable <literal>host_deploy_spice_cipher_string</literal>:</simpara>
<screen># ansible-playbook -l <emphasis>hostname</emphasis> \
  --extra-vars host_deploy_spice_cipher_string=”DEFAULT:-RC4:-3DES:-DES” \
  /usr/share/ovirt-engine/playbooks/ovirt-host-deploy.yml</screen>
</section>
</section>
<section xml:id="sect-Scheduling_Policies">
<title>Scheduling Policies</title>
<simpara>A scheduling policy is a set of rules that defines the logic by which virtual machines are distributed amongst hosts in the cluster that scheduling policy is applied to. Scheduling policies determine this logic via a combination of filters, weightings, and a load balancing policy. The filter modules apply hard enforcement and filter out hosts that do not meet the conditions specified by that filter. The weights modules apply soft enforcement, and are used to control the relative priority of factors considered when determining the hosts in a cluster on which a virtual machine can run.</simpara>
<simpara>The oVirt Engine provides five default scheduling policies: <emphasis role="strong">Evenly_Distributed</emphasis>, <emphasis role="strong">Cluster_Maintenance</emphasis>, <emphasis role="strong">None</emphasis>, <emphasis role="strong">Power_Saving</emphasis>, and <emphasis role="strong">VM_Evenly_Distributed</emphasis>. You can also define new scheduling policies that provide fine-grained control over the distribution of virtual machines. Regardless of the scheduling policy, a virtual machine will not start on a host with an overloaded CPU. By default, a host&#8217;s CPU is considered overloaded if it has a load of more than 80% for 5 minutes, but these values can be changed using scheduling policies. See <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</link> in the <emphasis>Administration Guide</emphasis> for more information about the properties of each scheduling policy.</simpara>
<figure>
<title>Evenly Distributed Scheduling Policy</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/RHV_SchedulingPolicies_444396_0417_ECE_EvenlyDistributed.png"/>
</imageobject>
<textobject><phrase>RHV SchedulingPolicies 444396 0417 ECE EvenlyDistributed</phrase></textobject>
</mediaobject>
</figure>
<simpara>The <emphasis role="strong">Evenly_Distributed</emphasis> scheduling policy distributes the memory and CPU processing load evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis>, <emphasis role="strong">HighUtilization</emphasis>, or <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis>.</simpara>
<simpara>The <emphasis role="strong">VM_Evenly_Distributed</emphasis> scheduling policy distributes virtual machines evenly between hosts based on a count of the virtual machines. The cluster is considered unbalanced if any host is running more virtual machines than the <emphasis role="strong">HighVmCount</emphasis> and there is at least one host with a virtual machine count that falls outside of the <emphasis role="strong">MigrationThreshold</emphasis>.</simpara>
<figure>
<title>Power Saving Scheduling Policy</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/RHV_SchedulingPolicies_444396_0417_ECE_PowerSaving.png"/>
</imageobject>
<textobject><phrase>RHV SchedulingPolicies 444396 0417 ECE PowerSaving</phrase></textobject>
</mediaobject>
</figure>
<simpara>The <emphasis role="strong">Power_Saving</emphasis> scheduling policy distributes the memory and CPU processing load across a subset of available hosts to reduce power consumption on underutilized hosts. Hosts with a CPU load below the low utilization value for longer than the defined time interval will migrate all virtual machines to other hosts so that it can be powered down. Additional virtual machines attached to a host will not start if that host has reached the defined high utilization value.</simpara>
<simpara>Set the <emphasis role="strong">None</emphasis> policy to have no load or power sharing between hosts for running virtual machines. This is the default mode. When a virtual machine is started, the memory and CPU processing load is spread evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis>, <emphasis role="strong">HighUtilization</emphasis>, or <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis>.</simpara>
<simpara>The <emphasis role="strong">Cluster_Maintenance</emphasis> scheduling policy limits activity in a cluster during maintenance tasks. When the <emphasis role="strong">Cluster_Maintenance</emphasis> policy is set, no new virtual machines may be started, except highly available virtual machines. If host failure occurs, highly available virtual machines will restart properly and any virtual machine can migrate.</simpara>
<section xml:id="Creating_a_Scheduling_Policy">
<title>Creating a Scheduling Policy</title>
<simpara>You can create new scheduling policies to control the logic by which virtual machines are distributed amongst a given cluster in your oVirt environment.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Scheduling Policies</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> for the scheduling policy.</simpara>
</listitem>
<listitem>
<simpara>Configure filter modules:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Filter Modules</emphasis> section, drag and drop the preferred filter modules to apply to the scheduling policy from the <emphasis role="strong">Disabled Filters</emphasis> section into the <emphasis role="strong">Enabled Filters</emphasis> section.</simpara>
</listitem>
<listitem>
<simpara>Specific filter modules can also be set as the <emphasis role="strong">First</emphasis>, to be given highest priority, or <emphasis role="strong">Last</emphasis>, to be given lowest priority, for basic optimization. To set the priority, right-click any filter module, hover the cursor over <emphasis role="strong">Position</emphasis> and select <emphasis role="strong">First</emphasis> or <emphasis role="strong">Last</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Configure weight modules:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Weights Modules</emphasis> section, drag and drop the preferred weights modules to apply to the scheduling policy from the <emphasis role="strong">Disabled Weights</emphasis> section into the <emphasis role="strong">Enabled Weights &amp; Factors</emphasis> section.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to the left of the enabled weight modules to increase or decrease the weight of those modules.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Specify a load balancing policy:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>From the drop-down menu in the <emphasis role="strong">Load Balancer</emphasis> section, select the load balancing policy to apply to the scheduling policy.</simpara>
</listitem>
<listitem>
<simpara>From the drop-down menu in the <emphasis role="strong">Properties</emphasis> section, select a load balancing property to apply to the scheduling policy and use the text field to the right of that property to specify a value.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to add or remove additional properties.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Explanation_of_Settings_in_the_New_Scheduling_Policy_and_Edit_Scheduling_Policy_Window">
<title>Explanation of Settings in the New Scheduling Policy and Edit Scheduling Policy Window</title>
<simpara>The following table details the options available in the <emphasis role="strong">New Scheduling Policy</emphasis> and <emphasis role="strong">Edit Scheduling Policy</emphasis> windows.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>New Scheduling Policy and Edit Scheduling Policy Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the scheduling policy. This is the name used to refer to the scheduling policy in the oVirt Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A description of the scheduling policy. This field is recommended but not mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Filter Modules</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A set of filters for controlling the hosts on which a virtual machine in a cluster can run. Enabling a filter will filter out hosts that do not meet the conditions specified by that filter, as outlined below:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>CpuPinning</literal>: Hosts which do not satisfy the CPU pinning definition.</simpara>
</listitem>
<listitem>
<simpara><literal>Migration</literal>: Prevent migration to the same host.</simpara>
</listitem>
<listitem>
<simpara><literal>PinToHost</literal>: Hosts other than the host to which the virtual machine is pinned.</simpara>
</listitem>
<listitem>
<simpara><literal>CPU-Level</literal>: Hosts that do not meet the CPU topology of the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><literal>CPU</literal>: Hosts with fewer CPUs than the number assigned to the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><literal>Memory</literal>: Hosts that do not have sufficient memory to run the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><literal>VmAffinityGroups</literal>: Hosts that do not meet the conditions specified for a virtual machine that is a member of an affinity group. For example, that virtual machines in an affinity group must run on the same host or on separate hosts.</simpara>
</listitem>
<listitem>
<simpara><literal>VmToHostsAffinityGroups</literal>: Group of hosts that do not meet the conditions specified for a virtual machine that is a member of an affinity group. For example, that virtual machines in an affinity group must run on one of the hosts in a group or on a separate host that is excluded from the group.</simpara>
</listitem>
<listitem>
<simpara><literal>InClusterUpgrade</literal>: Hosts that are running an earlier operating system than the host that the virtual machine currently runs on.</simpara>
</listitem>
<listitem>
<simpara><literal>HostDevice</literal>: Hosts that do not support host devices required by the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><literal>HA</literal>: Forces the Engine virtual machine in a self-hosted engine environment to run only on hosts with a positive high availability score.</simpara>
</listitem>
<listitem>
<simpara><literal>Emulated-Machine</literal>: Hosts which do not have proper emulated machine support.</simpara>
</listitem>
<listitem>
<simpara><literal>Network</literal>: Hosts on which networks required by the network interface controller of a virtual machine are not installed, or on which the cluster&#8217;s display network is not installed.</simpara>
</listitem>
<listitem>
<simpara><literal>HostedEnginesSpares</literal>: Reserves space for the Engine virtual machine on a specified number of self-hosted engine nodes.</simpara>
</listitem>
<listitem>
<simpara><literal>Label</literal>: Hosts that do not have the required affinity labels.</simpara>
</listitem>
<listitem>
<simpara><literal>Compatibility-Version</literal>: Runs virtual machines only on hosts with the correct compatibility version support.</simpara>
</listitem>
<listitem>
<simpara><literal>CPUOverloaded</literal>: Hosts that are CPU overloaded.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Weights Modules</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A set of weightings for controlling the relative priority of factors considered when determining the hosts in a cluster on which a virtual machine can run.</simpara>
<itemizedlist>
<listitem>
<simpara><literal>InClusterUpgrade</literal>: Weight hosts in accordance with their operating system version. The weight penalizes hosts with earlier operating systems more than hosts with the same operating system as the host that the virtual machine is currently running on. This ensures that priority is always given to hosts with later operating systems.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForHaReservation</literal>: Weights hosts in accordance with their high availability score.</simpara>
</listitem>
<listitem>
<simpara><literal>None</literal>: Weights hosts in accordance with the even distribution module.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForEvenGuestDistribution</literal>: Weights hosts in accordance with the number of virtual machines running on those hosts.</simpara>
</listitem>
<listitem>
<simpara><literal>VmAffinityGroups</literal>: Weights hosts in accordance with the affinity groups defined for virtual machines. This weight module determines how likely virtual machines in an affinity group are to run on the same host or on separate hosts in accordance with the parameters of that affinity group.</simpara>
</listitem>
<listitem>
<simpara><literal>VmToHostsAffinityGroups</literal>: Weights hosts in accordance with the affinity groups defined for virtual machines. This weight module determines how likely virtual machines in an affinity group are to run on one of the hosts in a group or on a separate host that is excluded from the group.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForCPUPowerSaving</literal>: Weights hosts in accordance with their CPU usage, giving priority to hosts with higher CPU usage.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForEvenCpuDistribution</literal>: Weights hosts in accordance with their CPU usage, giving priority to hosts with lower CPU usage.</simpara>
</listitem>
<listitem>
<simpara><literal>HA</literal>: Weights hosts in accordance with their high availability score.</simpara>
</listitem>
<listitem>
<simpara><literal>PreferredHosts</literal>: Preferred hosts have priority during virtual machine setup.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForMemoryPowerSaving</literal>: Weights hosts in accordance with their memory usage, giving priority to hosts with lower available memory.</simpara>
</listitem>
<listitem>
<simpara><literal>OptimalForMemoryEvenDistribution</literal>: Weights hosts in accordance with their memory usage, giving priority to hosts with higher available memory.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Load Balancer</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This drop-down menu allows you to select a load balancing module to apply. Load balancing modules determine the logic used to migrate virtual machines from hosts experiencing high usage to hosts experiencing lower usage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Properties</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This drop-down menu allows you to add or remove properties for load balancing modules, and is only available when you have selected a load balancing module for the scheduling policy. No properties are defined by default, and the properties that are available are specific to the load balancing module that is selected. Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to add or remove additional properties to or from the load balancing module.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="sect-Instance_Types">
<title>Instance Types</title>
<simpara>Instance types can be used to define the hardware configuration of a virtual machine. Selecting an instance type when creating or editing a virtual machine will automatically fill in the hardware configuration fields. This allows users to create multiple virtual machines with the same hardware configuration without having to manually fill in every field.</simpara>
<note>
<simpara>Support for instance types is now deprecated, and will be removed in a future release.</simpara>
</note>
<simpara>A set of predefined instance types are available by default, as outlined in the following table:</simpara>
<table xml:id="Predef_Instance_Types" frame="all" rowsep="1" colsep="1">
<title>Predefined Instance Types</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Name</entry>
<entry align="left" valign="top">Memory</entry>
<entry align="left" valign="top">vCPUs</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Tiny</simpara></entry>
<entry align="left" valign="top"><simpara>512 MB</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Small</simpara></entry>
<entry align="left" valign="top"><simpara>2 GB</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Medium</simpara></entry>
<entry align="left" valign="top"><simpara>4 GB</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Large</simpara></entry>
<entry align="left" valign="top"><simpara>8 GB</simpara></entry>
<entry align="left" valign="top"><simpara>2</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>XLarge</simpara></entry>
<entry align="left" valign="top"><simpara>16 GB</simpara></entry>
<entry align="left" valign="top"><simpara>4</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Administrators can also create, edit, and remove instance types from the <emphasis role="strong">Instance Types</emphasis> tab of the <emphasis role="strong">Configure</emphasis> window.</simpara>
<simpara>Fields in the <emphasis role="strong">New Virtual Machine</emphasis> and <emphasis role="strong">Edit Virtual Machine</emphasis> windows that are bound to an instance type have a chain link image next to them (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/6121.png"/>
</imageobject>
<textobject><phrase>6121</phrase></textobject>
</inlinemediaobject>). If the value of one of these fields is changed, the virtual machine will be detached from the instance type, changing to <emphasis role="strong">Custom</emphasis>, and the chain will appear broken (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/6122.png"/>
</imageobject>
<textobject><phrase>6122</phrase></textobject>
</inlinemediaobject>). However, if the value is changed back, the chain will relink and the instance type will move back to the selected one.</simpara>
<section xml:id="Creating_Instance_Types">
<title>Creating Instance Types</title>
<simpara>Administrators can create new instance types, which can then be selected by users when creating or editing virtual machines.</simpara>
<simpara><emphasis role="strong">Creating an Instance Type</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Instance Types</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> for the instance type.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Show Advanced Options</emphasis> and configure the instance type&#8217;s settings as required. The settings that appear in the <emphasis role="strong">New Instance Type</emphasis> window are identical to those in the <emphasis role="strong">New Virtual Machine</emphasis> window, but with the relevant fields only. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows">Explanation of Settings in the New Virtual Machine and Edit Virtual Machine Windows</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The new instance type will appear in the <emphasis role="strong">Instance Types</emphasis> tab in the <emphasis role="strong">Configure</emphasis> window, and can be selected from the <emphasis role="strong">Instance Type</emphasis> drop-down list when creating or editing a virtual machine.</simpara>
</section>
<section xml:id="Editing_Instance_Types">
<title>Editing Instance Types</title>
<simpara>Administrators can edit existing instance types from the <emphasis role="strong">Configure</emphasis> window.</simpara>
<simpara><emphasis role="strong">Editing Instance Type Properties</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Instance Types</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the instance type to be edited.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the settings as required.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The configuration of the instance type is updated. When a new virtual machine based on this instance type is created, or when an existing virtual machine based on this instance type is updated, the new configuration is applied.</simpara>
<simpara>Existing virtual machines based on this instance type will display fields, marked with a chain icon, that will be updated. If the existing virtual machines were running when the instance type was changed, the orange Pending Changes icon will appear beside them and the fields with the chain icon will be updated at the next restart.</simpara>
</section>
<section xml:id="Removing_Instance_Types">
<title>Removing Instance Types</title>
<simpara><emphasis role="strong">Removing an Instance Type</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Instance Types</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the instance type to be removed.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If any virtual machines are based on the instance type to be removed, a warning window listing the attached virtual machines will appear. To continue removing the instance type, select the <emphasis role="strong">Approve Operation</emphasis> check box. Otherwise click <emphasis role="strong">Cancel</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The instance type is removed from the <emphasis role="strong">Instance Types</emphasis> list and can no longer be used when creating a new virtual machine. Any virtual machines that were attached to the removed instance type will now be attached to <emphasis role="strong">Custom</emphasis> (no instance type).</simpara>
</section>
</section>
<section xml:id="sect-MAC_Address_Pools">
<title>MAC Address Pools</title>
<simpara>MAC address pools define the range(s) of MAC addresses allocated for each cluster. A MAC address pool is specified for each cluster. By using MAC address pools, oVirt can automatically generate and assign MAC addresses to new virtual network devices, which helps to prevent MAC address duplication. MAC address pools are more memory efficient when all MAC addresses related to a cluster are within the range for the assigned MAC address pool.</simpara>
<simpara>The same MAC address pool can be shared by multiple clusters, but each cluster has a single MAC address pool assigned. A default MAC address pool is created by oVirt and is used if another MAC address pool is not assigned. For more information about assigning MAC address pools to clusters see <xref linkend="Creating_a_New_Cluster"/>.</simpara>
<note>
<simpara>If more than one oVirt cluster shares a network, do not rely solely on the default MAC address pool because the virtual machines of each cluster will try to use the same range of MAC addresses, leading to conflicts. To avoid MAC address conflicts, check the MAC address pool ranges to ensure that each cluster is assigned a unique MAC address range.</simpara>
</note>
<simpara>The MAC address pool assigns the next available MAC address following the last address that was returned to the pool. If there are no further addresses left in the range, the search starts again from the beginning of the range. If there are multiple MAC address ranges with available MAC addresses defined in a single MAC address pool, the ranges take turns in serving incoming requests in the same way available MAC addresses are selected.</simpara>
<section xml:id="Creating_MAC_Address_Pools">
<title>Creating MAC Address Pools</title>
<simpara>You can create new MAC address pools.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">MAC Address Pools</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the new MAC address pool.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Allow Duplicates</emphasis> check box to allow a MAC address to be used multiple times in a pool. The MAC address pool will not automatically use a duplicate MAC address, but enabling the duplicates option means a user can manually use a duplicate MAC address.</simpara>
<note>
<simpara>If one MAC address pool has duplicates disabled, and another has duplicates enabled, each MAC address can be used once in the pool with duplicates disabled but can be used multiple times in the pool with duplicates enabled.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter the required <emphasis role="strong">MAC Address Ranges</emphasis>. To enter multiple ranges click the plus button next to the <emphasis role="strong">From</emphasis> and <emphasis role="strong">To</emphasis> fields.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Editing_MAC_Address_Pools">
<title>Editing MAC Address Pools</title>
<simpara>You can edit MAC address pools to change the details, including the range of MAC addresses available in the pool and whether duplicates are allowed.</simpara>
<simpara><emphasis role="strong">Editing MAC Address Pool Properties</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">MAC Address Pools</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the MAC address pool to be edited.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the <emphasis role="strong">Name</emphasis>, <emphasis role="strong">Description</emphasis>, <emphasis role="strong">Allow Duplicates</emphasis>, and <emphasis role="strong">MAC Address Ranges</emphasis> fields as required.</simpara>
<note>
<simpara>When a MAC address range is updated, the MAC addresses of existing NICs are not reassigned. MAC addresses that were already assigned, but are outside of the new MAC address range, are added as user-specified MAC addresses and are still tracked by that MAC address pool.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Editing_MAC_Address_Pool_Permissions">
<title>Editing MAC Address Pool Permissions</title>
<simpara>After a MAC address pool has been created, you can edit its user permissions. The user permissions control which data centers can use the MAC address pool. See <xref linkend="sect-Roles"/> for more information on adding new user permissions.</simpara>
<simpara><emphasis role="strong">Editing MAC Address Pool Permissions</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">MAC Address Pools</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the required MAC address pool.</simpara>
</listitem>
<listitem>
<simpara>Edit the user permissions for the MAC address pool:</simpara>
<itemizedlist>
<listitem>
<simpara>To add user permissions to a MAC address pool:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> in the user permissions pane at the bottom of the <emphasis role="strong">Configure</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Search for and select the required users.</simpara>
</listitem>
<listitem>
<simpara>Select the required role from the <emphasis role="strong">Role to Assign</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to add the user permissions.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>To remove user permissions from a MAC address pool:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select the user permission to be removed in the user permissions pane at the bottom of the <emphasis role="strong">Configure</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis> to remove the user permissions.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_MAC_Address_Pools">
<title>Removing MAC Address Pools</title>
<simpara>You can remove a created MAC address pool if the pool is not associated with a cluster, but the default MAC address pool cannot be removed.</simpara>
<simpara><emphasis role="strong">Removing a MAC Address Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">MAC Address Pools</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the MAC address pool to be removed.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="chap-System_Dashboard">
<title>Dashboard</title>
<simpara>The Dashboard provides an overview of the oVirt system status by displaying a summary of oVirt&#8217;s resources and utilization. This summary can alert you to a problem and allows you to analyze the problem area.</simpara>
<simpara>The information in the dashboard is updated every 15 minutes by default from Data Warehouse, and every 15 seconds by default by the Engine API, or whenever the Dashboard is refreshed. The Dashboard is refreshed when the user changes back from another page or when manually refreshed. The Dashboard does not automatically refresh. The inventory card information is supplied by the Engine API and the utilization information is supplied by Data Warehouse. The Dashboard is implemented as a UI plugin component, which is automatically installed and upgraded alongside the Engine.</simpara>
<figure>
<title>The Dashboard</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/RHVdashboard.png"/>
</imageobject>
<textobject><phrase>RHVdashboard</phrase></textobject>
</mediaobject>
</figure>
<section xml:id="sect-Prerequisites">
<title>Prerequisites</title>
<simpara>The Dashboard requires that Data Warehouse is installed and configured. See <link xl:href="https://ovirt.org/documentation/data_warehouse_guide/index#chap-Installing_and_Configuring_Data_Warehouse">Installing and Configuring Data Warehouse</link> in the <emphasis>Data Warehouse Guide</emphasis>.</simpara>
</section>
<section xml:id="sect-Global_Inventory">
<title>Global Inventory</title>
<simpara>The top section of the Dashboard provides a global inventory of the oVirt resources and includes items for data centers, clusters, hosts, storage domains, virtual machines, and events. Icons show the status of each resource and numbers show the quantity of the each resource with that status.</simpara>
<figure>
<title>Global Inventory</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Inventory.png"/>
</imageobject>
<textobject><phrase>Dashboard Inventory</phrase></textobject>
</mediaobject>
</figure>
<simpara>The title shows the number of a type of resource and their status is displayed below the title. Clicking on the resource title navigates to the related page in the oVirt Engine. The status for <emphasis role="strong">Clusters</emphasis> is always displayed as N/A.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Resource Status</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Icon</entry>
<entry align="left" valign="top">Status</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_No_Items.png"/>
</imageobject>
<textobject><phrase>Dashboard No Items</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>None of that resource added to oVirt.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Warning.png"/>
</imageobject>
<textobject><phrase>Dashboard Warning</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Shows the number of a resource with a warning status. Clicking on the icon navigates to the appropriate page with the search limited to that resource with a warning status. The search is limited differently for each resource:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Centers</emphasis>: The search is limited to data centers that are not operational or non-responsive.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Gluster Volumes</emphasis>: The search is limited to gluster volumes that are powering up, paused, migrating, waiting, suspended, or powering down.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hosts</emphasis>: The search is limited to hosts that are unassigned, in maintenance mode, installing, rebooting, preparing for maintenance, pending approval, or connecting.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Storage Domains</emphasis>: The search is limited to storage domains that are uninitialized, unattached, inactive, in maintenance mode, preparing for maintenance, detaching, or activating.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Virtual Machines</emphasis>: The search is limited to virtual machines that are powering up, paused, migrating, waiting, suspended, or powering down.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Events</emphasis>: The search is limited to events with the severity of warning.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Up.png"/>
</imageobject>
<textobject><phrase>Dashboard Up</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Shows the number of a resource with an up status. Clicking on the icon navigates to the appropriate page with the search limited to resources that are up.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Down.png"/>
</imageobject>
<textobject><phrase>Dashboard Down</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Shows the number of a resource with a down status. Clicking on the icon navigates to the appropriate page with the search limited to resources with a down status. The search is limited differently for each resource:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Centers</emphasis>: The search is limited to data centers that are uninitialized, in maintenance mode, or with a down status.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Gluster Volumes</emphasis>: The search is limited to gluster volumes that are detached or inactive.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hosts</emphasis>: The search is limited to hosts that are non-responsive, have an error, have an installation error, non-operational, initializing, or down.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Storage Domains</emphasis>: The search is limited to storage domains that are detached or inactive.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Virtual Machines</emphasis>: The search is limited to virtual machines that are down, not responding, or rebooting.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Alert.png"/>
</imageobject>
<textobject><phrase>Dashboard Alert</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Shows the number of events with an alert status. Clicking on the icon navigates to <emphasis role="strong">Events</emphasis> with the search limited to events with the severity of alert.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><inlinemediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Error.png"/>
</imageobject>
<textobject><phrase>Dashboard Error</phrase></textobject>
</inlinemediaobject></simpara></entry>
<entry align="left" valign="top"><simpara>Shows the number of events with an error status. Clicking on the icon navigates to <emphasis role="strong">Events</emphasis> with the search limited to events with the severity of error.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="sect-Global_Utilization">
<title>Global Utilization</title>
<simpara>The <emphasis role="strong">Global Utilization</emphasis> section shows the system utilization of the CPU, Memory and Storage.</simpara>
<figure>
<title>Global Utilization</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Global_Utilization.png"/>
</imageobject>
<textobject><phrase>Dashboard Global Utilization</phrase></textobject>
</mediaobject>
</figure>
<itemizedlist>
<listitem>
<simpara>The top section shows the percentage of the available CPU, memory or storage and the over commit ratio. For example, the over commit ratio for the CPU is calculated by dividing the number of virtual cores by the number of physical cores that are available for the running virtual machines based on the latest data in Data Warehouse.</simpara>
</listitem>
<listitem>
<simpara>The donut displays the usage in percentage for the CPU, memory or storage and shows the average usage for all hosts based on the average usage in the last 5 minutes. Hovering over a section of the donut will display the value of the selected section.</simpara>
</listitem>
<listitem>
<simpara>The line graph at the bottom displays the trend in the last 24 hours. Each data point shows the average usage for a specific hour. Hovering over a point on the graph displays the time and the percentage used for the CPU graph and the amount of usage for the memory and storage graphs.</simpara>
</listitem>
</itemizedlist>
<section xml:id="sect-Top_Utilized_Resources">
<title>Top Utilized Resources</title>
<figure>
<title>Top Utilized Resources (Memory)</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Pop_Up.png"/>
</imageobject>
<textobject><phrase>Dashboard Pop Up</phrase></textobject>
</mediaobject>
</figure>
<simpara>Clicking the donut in the global utilization section of the Dashboard will display a list of the top utilized resources for the CPU, memory or storage. For CPU and memory the pop-up shows a list of the ten hosts and virtual machines with the highest usage. For storage the pop-up shows a list of the top ten utilized storage domains and virtual machines. The arrow to the right of the usage bar shows the trend of usage for that resource in the last minute.</simpara>
</section>
</section>
<section xml:id="sect-Cluster_Utilization">
<title>Cluster Utilization</title>
<simpara>The <emphasis role="strong">Cluster Utilization</emphasis> section shows the cluster utilization for the CPU and memory in a heatmap.</simpara>
<figure>
<title>Cluster Utilization</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Cluster_Utilization.png"/>
</imageobject>
<textobject><phrase>Dashboard Cluster Utilization</phrase></textobject>
</mediaobject>
</figure>
<section xml:id="sect-Cluster_CPU_Utilization">
<title>CPU</title>
<simpara>The heatmap of the CPU utilization for a specific cluster that shows the average utilization of the CPU for the last 24 hours. Hovering over the heatmap displays the cluster name. Clicking on the heatmap navigates to <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and displays the results of a search on a specific cluster sorted by CPU utilization. The formula used to calculate the usage of the CPU by the cluster is the average host CPU utilization in the cluster. This is calculated by using the average host CPU utilization for each host over the last 24 hours to find the total average usage of the CPU by the cluster.</simpara>
</section>
<section xml:id="sect-Cluster_Memory_Utilization">
<title>Memory</title>
<simpara>The heatmap of the memory utilization for a specific cluster that shows the average utilization of the memory for the last 24 hours. Hovering over the heatmap displays the cluster name. Clicking on the heatmap navigates to <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and displays the results of a search on a specific cluster sorted by memory usage. The formula used to calculate the memory usage by the cluster is the total utilization of the memory in the cluster in GB. This is calculated by using the average host memory utilization for each host over the last 24 hours to find the total average usage of memory by the cluster.</simpara>
</section>
</section>
<section xml:id="sect-Storage_Utilization">
<title>Storage Utilization</title>
<simpara>The <emphasis role="strong">Storage Utilization</emphasis> section shows the storage utilization in a heatmap.</simpara>
<figure>
<title>Storage Utilization</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/Dashboard_Storage_Utilization.png"/>
</imageobject>
<textobject><phrase>Dashboard Storage Utilization</phrase></textobject>
</mediaobject>
</figure>
<simpara>The heatmap shows the average utilization of the storage for the last 24 hours. The formula used to calculate the storage usage by the cluster is the total utilization of the storage in the cluster. This is calculated by using the average storage utilization for each host over the last 24 hours to find the total average usage of the storage by the cluster. Hovering over the heatmap displays the storage domain name. Clicking on the heatmap navigates to <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice> with the storage domains sorted by utilization.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Searches">
<title>Searches</title>
<section xml:id="Performing_searches">
<title>Performing Searches in oVirt</title>
<simpara>The Administration Portal allows you to manage thousands of resources, such as virtual machines, hosts, users, and more.  To perform a search, enter the search query (free-text or syntax-based) into the search bar, available on the main page for each resource. Search queries can be saved as bookmarks for future reuse, so you do not have to reenter a search query each time the specific search results are required. Searches are not case sensitive.</simpara>
</section>
<section xml:id="Search_syntax_and_examples">
<title>Search Syntax and Examples</title>
<simpara>The syntax of the search queries for oVirt resources is as follows:</simpara>
<simpara><literal>result type: {criteria} [sortby sort_spec]</literal></simpara>
<simpara><emphasis role="strong">Syntax Examples</emphasis></simpara>
<simpara>The following examples describe how the search query is used and help you to understand how oVirt assists with building search queries.</simpara>
<table xml:id="search_query_eg" frame="all" rowsep="1" colsep="1">
<title>Example Search Queries</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Example</entry>
<entry align="left" valign="top">Result</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Hosts: Vms.status = up page 2</simpara></entry>
<entry align="left" valign="top"><simpara>Displays page 2 of a list of all hosts running virtual machines that are up.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Vms: domain = qa.company.com</simpara></entry>
<entry align="left" valign="top"><simpara>Displays a list of all virtual machines running on the specified domain.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Vms: users.name = Mary</simpara></entry>
<entry align="left" valign="top"><simpara>Displays a list of all virtual machines belonging to users with the user name Mary.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Events: severity &gt; normal sortby time</simpara></entry>
<entry align="left" valign="top"><simpara>Displays the list of all Events whose severity is higher than Normal, sorted by time.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Search_auto_completion">
<title>Search Auto-Completion</title>
<simpara>The Administration Portal provides auto-completion to help you create valid and powerful search queries. As you type each part of a search query, a drop-down list of choices for the next part of the search opens below the Search Bar. You can either select from the list and then continue typing/selecting the next part of the search, or ignore the options and continue entering your query manually.</simpara>
<simpara>The following table specifies by example how the Administration Portal auto-completion assists in constructing a query:</simpara>
<simpara><literal>Hosts: Vms.status = down</literal></simpara>
<table xml:id="query_contruction" frame="all" rowsep="1" colsep="1">
<title>Example Search Queries Using Auto-Completion</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Input</entry>
<entry align="left" valign="top">List Items Displayed</entry>
<entry align="left" valign="top">Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">h</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><literal>Hosts</literal> (1 option only)</simpara></entry>
<entry align="left" valign="top"><simpara>Select <literal>Hosts</literal> or type <emphasis role="strong">Hosts</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts:</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>All host properties</simpara></entry>
<entry align="left" valign="top"><simpara>Type <emphasis role="strong">v</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts: v</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>host properties starting with a <literal>v</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Select <literal>Vms</literal> or type <emphasis role="strong">Vms</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts: Vms</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>All virtual machine properties</simpara></entry>
<entry align="left" valign="top"><simpara>Type <emphasis role="strong">s</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts: Vms.s</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>All virtual machine properties beginning with <literal>s</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Select <literal>status</literal> or type <emphasis role="strong">status</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts: Vms.status</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><literal>=</literal></simpara><simpara><literal>!=</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Select or type <emphasis role="strong">=</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hosts: Vms.status =</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>All status values</simpara></entry>
<entry align="left" valign="top"><simpara>Select or type <emphasis role="strong">down</emphasis></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Search_result_type_options">
<title>Search Result Type Options</title>
<simpara>The result type allows you to search for resources of any of the following types:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Vms</emphasis> for a list of virtual machines</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host</emphasis> for a list of hosts</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Pools</emphasis> for a list of pools</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Template</emphasis> for a list of templates</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Events</emphasis> for a list of events</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Users</emphasis> for a list of users</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Cluster</emphasis> for a list of clusters</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">DataCenter</emphasis> for a list of data centers</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Storage</emphasis> for a list of storage domains</simpara>
</listitem>
</itemizedlist>
<simpara>As each type of resource has a unique set of properties and a set of other resource types that it is associated with, each search type has a set of valid syntax combinations. You can also use the auto-complete feature to create valid queries easily.</simpara>
</section>
<section xml:id="Search_criteria">
<title>Search Criteria</title>
<simpara>You can specify the search criteria after the colon in the query. The syntax of <literal>{criteria}</literal> is as follows:</simpara>
<simpara><literal>&lt;prop&gt;&lt;operator&gt;&lt;value&gt;</literal></simpara>
<simpara>or</simpara>
<simpara><literal>&lt;obj-type&gt;&lt;prop&gt;&lt;operator&gt;&lt;value&gt;</literal></simpara>
<simpara><emphasis role="strong">Examples</emphasis></simpara>
<simpara>The following table describes the parts of the syntax:</simpara>
<table xml:id="search_criteria" frame="all" rowsep="1" colsep="1">
<title>Example Search Criteria</title>
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Part</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Values</entry>
<entry align="left" valign="top">Example</entry>
<entry align="left" valign="top">Note</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>prop</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the searched-for resource. Can also be the property of a resource type (see <literal>obj-type</literal>), or <emphasis role="strong">tag</emphasis> (custom tag).</simpara></entry>
<entry align="left" valign="top"><simpara>Limit your search to objects with a certain property. For example, search for objects with a <emphasis role="strong">status</emphasis> property.</simpara></entry>
<entry align="left" valign="top"><simpara>Status</simpara></entry>
<entry align="left" valign="top"><simpara>N/A</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>obj-type</simpara></entry>
<entry align="left" valign="top"><simpara>A resource type that can be associated with the searched-for resource.</simpara></entry>
<entry align="left" valign="top"><simpara>These are system objects, like data centers and virtual machines.</simpara></entry>
<entry align="left" valign="top"><simpara>Users</simpara></entry>
<entry align="left" valign="top"><simpara>N/A</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>operator</simpara></entry>
<entry align="left" valign="top"><simpara>Comparison operators.</simpara></entry>
<entry align="left" valign="top"><simpara>=</simpara><simpara>!= (not equal)</simpara><simpara>&gt;</simpara><simpara>&lt;</simpara><simpara>&gt;=</simpara><simpara>&lt;=</simpara></entry>
<entry align="left" valign="top"><simpara>N/A</simpara></entry>
<entry align="left" valign="top"><simpara>Value options depend on property.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Value</simpara></entry>
<entry align="left" valign="top"><simpara>What the expression is being compared to.</simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara><simpara>Integer</simpara><simpara>Ranking</simpara><simpara>Date (formatted according to Regional Settings)</simpara></entry>
<entry align="left" valign="top"><simpara>Jones</simpara><simpara>256</simpara><simpara>normal</simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Wildcards can be used within strings.</simpara>
</listitem>
<listitem>
<simpara>"" (two sets of quotation marks with no space between them) can be used to represent an un-initialized (empty) string.</simpara>
</listitem>
<listitem>
<simpara>Double quotes should be used around a string or date containing spaces</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Search_criteria_multiple_criteria_and_wildcards">
<title>Search: Multiple Criteria and Wildcards</title>
<simpara>Wildcards can be used in the <literal>&lt;value&gt;</literal> part of the syntax for strings. For example, to find all users beginning with <emphasis role="strong">m</emphasis>, enter <literal>m*</literal>.</simpara>
<simpara>You can perform a search having two criteria by using the Boolean operators <literal>AND</literal> and <literal>OR</literal>. For example:</simpara>
<simpara><literal>Vms: users.name = m* AND status = Up</literal></simpara>
<simpara>This query returns all running virtual machines for users whose names begin with "m".</simpara>
<simpara><literal>Vms: users.name = m* AND tag = "paris-loc"</literal></simpara>
<simpara>This query returns all virtual machines tagged with "paris-loc" for users whose names begin with "m".</simpara>
<simpara>When two criteria are specified without <literal>AND</literal> or <literal>OR</literal>, <literal>AND</literal> is implied. <literal>AND</literal> precedes <literal>OR</literal>, and <literal>OR</literal> precedes implied <literal>AND</literal>.</simpara>
</section>
<section xml:id="Search_determining_search_order">
<title>Search: Determining Search Order</title>
<simpara>You can determine the sort order of the returned information by using <literal>sortby</literal>. Sort direction (<literal>asc</literal> for ascending, <literal>desc</literal> for descending) can be included.</simpara>
<simpara>For example:</simpara>
<simpara><literal>events: severity &gt; normal sortby time desc</literal></simpara>
<simpara>This query returns all Events whose severity is higher than Normal, sorted by time (descending order).</simpara>
</section>
<section xml:id="Searching_for_data_centers">
<title>Searching for Data Centers</title>
<simpara>The following table describes all search options for Data Centers.</simpara>
<table xml:id="searching_datacenters" frame="all" rowsep="1" colsep="1">
<title>Searching for Data Centers</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Clusters.<emphasis>clusters-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the clusters associated with the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>A description of the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The availability of the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Datacenter: type = nfs and status != up</literal></simpara>
<simpara>This example returns a list of data centers with a storage type of NFS and status other than up.</simpara>
</section>
<section xml:id="Searching_for_clusters">
<title>Searching for Clusters</title>
<simpara>The following table describes all search options for clusters.</simpara>
<table xml:id="searching_clusters" frame="all" rowsep="1" colsep="1">
<title>Searching Clusters</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Datacenter.<emphasis>datacenter-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the data center associated with the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the cluster belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The unique name that identifies the clusters on the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The description of the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>initialized</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>True or False indicating the status of the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Clusters: initialized = true or name = Default</literal></simpara>
<simpara>This example returns a list of clusters which are initialized or named Default.</simpara>
</section>
<section xml:id="Searching_for_hosts">
<title>Searching for Hosts</title>
<simpara>The following table describes all search options for hosts.</simpara>
<table xml:id="searching_hosts" frame="all" rowsep="1" colsep="1">
<title>Searching for Hosts</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Vms.<emphasis>Vms-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the virtual machines associated with the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Templates.<emphasis>templates-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the templates associated with the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Events.<emphasis>events-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the events associated with the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Users.<emphasis>users-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the users associated with the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The availability of the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>external_status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The health status of the host as reported by external systems and plug-ins.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cluster</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The cluster to which the host belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>address</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The unique name that identifies the host on the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cpu_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percent of processing power used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>mem_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percentage of memory used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>network_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percentage of network usage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>load</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>Jobs waiting to be executed in the <emphasis role="strong">run-queue</emphasis> per processor, in a given time slice.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>version</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The version number of the operating system.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cpus</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of CPUs on the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The amount of memory available.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cpu_speed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The processing speed of the CPU.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cpu_model</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of CPU.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>active_vms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of virtual machines currently running.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>migrating_vms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of virtual machines currently being migrated.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>committed_mem</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percentage of committed memory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tag</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The tag assigned to the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the host belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Hosts: cluster = Default and Vms.os = rhel6</literal></simpara>
<simpara>This example returns a list of hosts which are part of the Default cluster and host virtual machines running the Enterprise Linux 6 operating system.</simpara>
</section>
<section xml:id="Searching_for_Networks">
<title>Searching for Networks</title>
<simpara>The following table describes all search options for networks.</simpara>
<table xml:id="searching_networks" frame="all" rowsep="1" colsep="1">
<title>Searching for Networks</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Cluster_network.<emphasis>clusternetwork-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the cluster associated with the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Host_Network.<emphasis>hostnetwork-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the host associated with the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The human readable name that identifies the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Keywords or text describing the network, optionally used when creating the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>vlanid</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The VLAN ID of the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>stp</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Whether Spanning Tree Protocol (STP) is enabled or disabled for the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>mtu</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The maximum transmission unit for the logical network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>vmnetwork</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Whether the network is only used for virtual machine traffic.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the network is attached.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Network: mtu &gt; 1500 and vmnetwork = true</literal></simpara>
<simpara>This example returns a list of networks with a maximum transmission unit greater than 1500 bytes, and which are set up for use by only virtual machines.</simpara>
</section>
<section xml:id="Searching_for_storage">
<title>Searching for Storage</title>
<simpara>The following table describes all search options for storage.</simpara>
<table xml:id="searching_storage" frame="all" rowsep="1" colsep="1">
<title>Searching for Storage</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Hosts.<emphasis>hosts-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the hosts associated with the storage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Clusters.<emphasis>clusters-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the clusters associated with the storage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The unique name that identifies the storage on the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The status of the storage domain.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>external_status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The health status of the storage domain as reported by external systems and plug-ins.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the storage belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of the storage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>free-size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The size (GB) of the free storage.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>used-size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The amount (GB) of the storage that is used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>total_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The total amount (GB) of the storage that is available.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>committed</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The amount (GB) of the storage that is committed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Storage: free_size &gt; 6 GB and total_size &lt; 20 GB</literal></simpara>
<simpara>This example returns a list of storage with free storage space greater than 6 GB, or total storage space less than 20 GB.</simpara>
</section>
<section xml:id="Searching_for_Disks">
<title>Searching for Disks</title>
<simpara>The following table describes all search options for disks.</simpara>
<note>
<simpara>You can use the <literal>Disk Type</literal> and <literal>Content Type</literal> filtering options to reduce the number of displayed virtual disks.</simpara>
</note>
<table xml:id="searching_disks" frame="all" rowsep="1" colsep="1">
<title>Searching for Disks</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Datacenters.<emphasis>datacenters-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the data centers associated with the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Storages.<emphasis>storages-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the storage associated with the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>alias</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The human readable name that identifies the storage on the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Keywords or text describing the disk, optionally used when creating the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>provisioned_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The virtual size of the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The size of the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>actual_size</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The actual size allocated to the disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>creation_date</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The date the disk was created.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>bootable</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Whether the disk can or cannot be booted. Valid values are one of <literal>0</literal>, <literal>1</literal>, <literal>yes</literal>, or <literal>no</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>shareable</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Whether the disk can or cannot be attached to more than one virtual machine at a time. Valid values are one of <literal>0</literal>, <literal>1</literal>, <literal>yes</literal>, or <literal>no</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>format</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The format of the disk. Can be one of <literal>unused</literal>, <literal>unassigned</literal>, <literal>cow</literal>, or <literal>raw</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The status of the disk. Can be one of <literal>unassigned</literal>, <literal>ok</literal>, <literal>locked</literal>, <literal>invalid</literal>, or <literal>illegal</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>disk_type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of the disk. Can be one of <literal>image</literal> or <literal>lun</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>number_of_vms</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of virtual machine(s) to which the disk is attached.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>vm_names</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name(s) of the virtual machine(s) to which the disk is attached.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>quota</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the quota enforced on the virtual disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Disks: format = cow and provisioned_size &gt; 8</literal></simpara>
<simpara>This example returns a list of virtual disks with QCOW format and an allocated disk size greater than 8 GB.</simpara>
</section>
<section xml:id="Searching_for_Volumes">
<title>Searching for Volumes</title>
<simpara>The following table describes all search options for volumes.</simpara>
<table xml:id="searching_volumes" frame="all" rowsep="1" colsep="1">
<title>Searching for Volumes</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Cluster</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the cluster associated with the volume.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Cluster.<emphasis>cluster-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type (examples: name, description, comment, architecture)</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the clusters associated with the volume.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The human readable name that identifies the volume.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Can be one of distribute, replicate, distributed_replicate, stripe, or distributed_stripe.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>transport_type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>Can be one of TCP or RDMA.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>replica_count</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>Number of replica.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>stripe_count</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>Number of stripes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The status of the volume. Can be one of Up or Down.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Volume: transport_type = rdma and stripe_count &gt;= 2</literal></simpara>
<simpara>This example returns a list of volumes with transport type set to RDMA, and with 2 or more stripes.</simpara>
</section>
<section xml:id="Searching_for_virtual_machines">
<title>Searching for Virtual Machines</title>
<simpara>The following table describes all search options for virtual machines.</simpara>
<note>
<simpara>Currently, the <emphasis role="strong">Network Label</emphasis>, <emphasis role="strong">Custom Emulated Machine</emphasis>, and <emphasis role="strong">Custom CPU Type</emphasis> properties are not supported search parameters.</simpara>
</note>
<table xml:id="searching_Vms_syntax" frame="all" rowsep="1" colsep="1">
<title>Searching for Virtual Machines</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Hosts.<emphasis>hosts-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the hosts associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Templates.<emphasis>templates-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the templates associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Events.<emphasis>events-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the events associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Users.<emphasis>users-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the users associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Storage.<emphasis>storage-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on the property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of storage devices associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Vnic.<emphasis>vnic-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on the property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the vNIC associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The availability of the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ip</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The IP address of the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>uptime</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of minutes that the virtual machine has been running.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>domain</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The domain (usually Active Directory domain) that groups these machines.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>os</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The operating system selected when the virtual machine was created.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>creationdate</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Date</simpara></entry>
<entry align="left" valign="top"><simpara>The date on which the virtual machine was created.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>address</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The unique name that identifies the virtual machine on the network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cpu_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percent of processing power used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>mem_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percentage of memory used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>network_usage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The percentage of network used.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>memory</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The maximum memory defined.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>apps</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The applications currently installed on the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cluster</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The cluster to which the virtual machine belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pool</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The virtual machine pool to which the virtual machine belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>loggedinuser</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the user currently logged in to the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tag</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The tags to which the virtual machine belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the virtual machine belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The virtual machine type (server or desktop).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>quota</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the quota associated with the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Keywords or text describing the virtual machine, optionally used when creating the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>next_run_configuration_exists</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Boolean</simpara></entry>
<entry align="left" valign="top"><simpara>The virtual machine has pending configuration changes.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Vms: template.name = Win* and user.name = ""</literal></simpara>
<simpara>This example returns a list of virtual machines whose base template name begins with <emphasis role="strong">Win</emphasis> and are assigned to any user.</simpara>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Vms: cluster = Default and os = windows7</literal></simpara>
<simpara>This example returns a list of virtual machines that belong to the <emphasis role="strong">Default</emphasis> cluster and are running Windows 7.</simpara>
</section>
<section xml:id="Searching_for_pools">
<title>Searching for Pools</title>
<simpara>The following table describes all search options for Pools.</simpara>
<table xml:id="searching_pools" frame="all" rowsep="1" colsep="1">
<title>Searching for Pools</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The description of the pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The type of pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Pools: type = automatic</literal></simpara>
<simpara>This example returns a list of pools with a type of <literal>automatic</literal>.</simpara>
</section>
<section xml:id="Searching_for_templates">
<title>Searching for Templates</title>
<simpara>The following table describes all search options for templates.</simpara>
<table xml:id="searching_templates_syntax" frame="all" rowsep="1" colsep="1">
<title>Searching for Templates</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Vms.<emphasis>Vms-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the virtual machines associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Hosts.<emphasis>hosts-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the hosts associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Events.<emphasis>events-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the events associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Users.<emphasis>users-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the users associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>domain</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The domain of the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>os</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The type of operating system.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>creationdate</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The date on which the template was created.</simpara><simpara>Date format is <emphasis role="strong">mm/dd/yy</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>childcount</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The number of virtual machines created from the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>mem</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>Defined memory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>description</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The description of the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The status of the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>cluster</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The cluster associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>quota</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The quota associated with the template.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Template: Events.severity &gt;= normal and Vms.uptime &gt; 0</literal></simpara>
<simpara>This example returns a list of templates where events of normal or greater severity have occurred on virtual machines derived from the template, and the virtual machines are still running.</simpara>
</section>
<section xml:id="Searching_for_users">
<title>Searching for Users</title>
<simpara>The following table describes all search options for users.</simpara>
<table xml:id="searching_users" frame="all" rowsep="1" colsep="1">
<title>Searching for Users</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Vms.<emphasis>Vms-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the virtual machines associated with the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Hosts.<emphasis>hosts-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the hosts associated with the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Templates.<emphasis>templates-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the templates associated with the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Events.<emphasis>events-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the events associated with the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>name</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The name of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>lastname</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The last name of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>usrname</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The unique name of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>department</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The department to which the user belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>group</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The group to which the user belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>title</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The title of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>status</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The status of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>role</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The role of the user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>tag</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The tag to which the user belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>pool</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The pool to which the user belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Users: Events.severity &gt; normal and Vms.status = up or Vms.status = pause</literal></simpara>
<simpara>This example returns a list of users where events of greater than normal severity have occurred on their virtual machines AND the virtual machines are still running; or the users' virtual machines are paused.</simpara>
</section>
<section xml:id="Searching_for_events">
<title>Searching for Events</title>
<simpara>The following table describes all search options you can use to search for events. Auto-completion is offered for many options as appropriate.</simpara>
<table xml:id="searching_events_syntax" frame="all" rowsep="1" colsep="1">
<title>Searching for Events</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Property (of resource or resource-type)</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Description (Reference)</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>Vms.<emphasis>Vms-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the virtual machines associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Hosts.<emphasis>hosts-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the hosts associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Templates.<emphasis>templates-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the templates associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Users.<emphasis>users-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the users associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Clusters.<emphasis>clusters-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the clusters associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>Volumes.<emphasis>Volumes-prop</emphasis></literal></simpara></entry>
<entry align="left" valign="top"><simpara>Depends on property type</simpara></entry>
<entry align="left" valign="top"><simpara>The property of the volumes associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>type</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Type of the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>severity</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>The severity of the event: Warning/Error/Normal.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>message</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>Description of the event type.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>time</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Day the event occurred.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>usrname</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The user name associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_host</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The host associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_vm</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The virtual machine associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_template</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The template associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_storage</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The storage associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_datacenter</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The data center associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>event_volume</literal></simpara></entry>
<entry align="left" valign="top"><simpara>String</simpara></entry>
<entry align="left" valign="top"><simpara>The volume associated with the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>correlation_id</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The identification number of the event.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>sortby</literal></simpara></entry>
<entry align="left" valign="top"><simpara>List</simpara></entry>
<entry align="left" valign="top"><simpara>Sorts the returned results by one of the resource properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>page</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Integer</simpara></entry>
<entry align="left" valign="top"><simpara>The page number of results to display.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara><emphasis role="strong">Example</emphasis></simpara>
<simpara><literal>Events: Vms.name = testdesktop and Hosts.name = gonzo.example.com</literal></simpara>
<simpara>This example returns a list of events, where the event occurred on the virtual machine named <literal>testdesktop</literal> while it was running on the host <literal>gonzo.example.com</literal>.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Bookmarks">
<title>Bookmarks</title>
<section xml:id="Saving_a_query_string_as_a_bookmark">
<title>Saving a Query String as a Bookmark</title>
<simpara>A bookmark can be used to remember a search query, and shared with other users.</simpara>
<simpara><emphasis role="strong">Saving a Query String as a Bookmark</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enter the desired search query in the search bar and perform the search.</simpara>
</listitem>
<listitem>
<simpara>Click the star-shaped <emphasis role="strong">Bookmark</emphasis> button to the right of the search bar. This opens the <emphasis role="strong">New Bookmark</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> of the bookmark.</simpara>
</listitem>
<listitem>
<simpara>Edit the <emphasis role="strong">Search string</emphasis> field, if required.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Click the <emphasis role="strong">Bookmarks</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Bookmark.png"/>
</imageobject>
<textobject><phrase>Bookmark</phrase></textobject>
</inlinemediaobject>) in the header bar to find and select the bookmark.</simpara>
</section>
<section xml:id="Editing_a_bookmark">
<title>Editing a Bookmark</title>
<simpara>You can modify the name and search string of a bookmark.</simpara>
<simpara><emphasis role="strong">Editing a Bookmark</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Bookmarks</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Bookmark.png"/>
</imageobject>
<textobject><phrase>Bookmark</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</listitem>
<listitem>
<simpara>Select a bookmark and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Search string</emphasis> fields as necessary.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Deleting_a_bookmark">
<title>Deleting a Bookmark</title>
<simpara>When a bookmark is no longer needed, remove it.</simpara>
<simpara><emphasis role="strong">Deleting a Bookmark</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Bookmarks</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Bookmark.png"/>
</imageobject>
<textobject><phrase>Bookmark</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</listitem>
<listitem>
<simpara>Select a bookmark and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="chap-Tags">
<title>Tags</title>
<section xml:id="Using_tags_to_customize_interactions">
<title>Using Tags to Customize Interactions with oVirt</title>
<simpara>After your oVirt platform is set up and configured to your requirements, you can customize the way you work with it using tags. Tags allow system resources to be arranged into groups or categories. This is useful when many objects exist in the virtualization environment and the administrator wants to concentrate on a specific set of them.</simpara>
<simpara>This section describes how to create and edit tags, assign them to hosts or virtual machines and search using the tags as criteria. Tags can be arranged in a hierarchy that matches a structure, to fit the needs of the enterprise.</simpara>
<simpara>To create, modify, and remove Administration Portal tags, click the <emphasis role="strong">Tags</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Tag.png"/>
</imageobject>
<textobject><phrase>Tag</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</section>
<section xml:id="Creating_a_tag">
<title>Creating a Tag</title>
<simpara>Create tags so you can filter search results using tags.</simpara>
<simpara><emphasis role="strong">Creating a Tag</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Tags</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Tag.png"/>
</imageobject>
<textobject><phrase>Tag</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> to create a new tag, or select a tag and click <emphasis role="strong">New</emphasis> to create a descendant tag.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the new tag.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Modifying_a_tag">
<title>Modifying a Tag</title>
<simpara>You can edit the name and description of a tag.</simpara>
<simpara><emphasis role="strong">Modifying a Tag</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Tags</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Tag.png"/>
</imageobject>
<textobject><phrase>Tag</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</listitem>
<listitem>
<simpara>Select the tag you want to modify and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> fields as necessary.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Deleting_a_tag">
<title>Deleting a Tag</title>
<simpara>When a tag is no longer needed, remove it.</simpara>
<simpara><emphasis role="strong">Deleting a Tag</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click the <emphasis role="strong">Tags</emphasis> icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="images/Tag.png"/>
</imageobject>
<textobject><phrase>Tag</phrase></textobject>
</inlinemediaobject>) in the header bar.</simpara>
</listitem>
<listitem>
<simpara>Select the tag you want to delete and click <emphasis role="strong">Remove</emphasis>. A message warns you that removing the tag will also remove all descendants of the tag.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have removed the tag and all its descendants. The tag is also removed from all the objects that it was attached to.</simpara>
</section>
<section xml:id="Adding_and_removing_tags">
<title>Adding and Removing Tags to and from Objects</title>
<simpara>You can assign tags to and remove tags from hosts, virtual machines, and users.</simpara>
<simpara><emphasis role="strong">Adding and Removing Tags to and from Objects</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Select the object(s) you want to tag or untag.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Assign Tags</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the check box to assign a tag to the object, or clear the check box to detach the tag from the object.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The specified tag is now added or removed as a custom property of the selected object(s).</simpara>
</section>
<section xml:id="Searching_for_objects_using_tags">
<title>Searching for Objects Using Tags</title>
<simpara>Enter a search query using <literal>tag</literal> as the property and the desired value or set of values as criteria for the search.</simpara>
<simpara>The objects tagged with the specified criteria are listed in the results list.</simpara>
<note>
<simpara>If you search for objects using <literal>tag</literal> as the property and the inequality operator (<literal>!=</literal>), for example, <literal>Host: Vms.tag!=server1</literal>, the results list does not include untagged objects.</simpara>
</note>
</section>
<section xml:id="Customizing_hosts_with_tags">
<title>Customizing Hosts with Tags</title>
<simpara>You can use tags to store information about your hosts. You can then search for hosts based on tags. For more information on searches, see <xref linkend="chap-Searches"/>.</simpara>
<simpara><emphasis role="strong">Customizing hosts with tags</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Assign Tags</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the check boxes of applicable tags.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have added extra, searchable information about your host as tags.</simpara>
</section>
</chapter>
</part>
<part xml:id="part-Administering_the_Resources">
<title>Administering the Resources</title>
<chapter xml:id="chap-Quality_of_Service">
<title>Quality of Service</title>
<simpara>oVirt allows you to define quality of service entries that provide fine-grained control over the level of input and output, processing, and networking capabilities that resources in your environment can access. Quality of service entries are defined at the data center level and are assigned to profiles created under clusters and storage domains. These profiles are then assigned to individual resources in the clusters and storage domains where the profiles were created.</simpara>
<section xml:id="sect-Storage_Quality_of_Service">
<title>Storage Quality of Service</title>
<simpara>Storage quality of service defines the maximum level of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Assigning storage quality of service to a virtual disk allows you to fine tune the performance of storage domains and prevent the storage operations associated with one virtual disk from affecting the storage capabilities available to other virtual disks hosted in the same storage domain.</simpara>
<section xml:id="Creating_a_Storage_Quality_of_Service_Entry">
<title>Creating a Storage Quality of Service Entry</title>
<simpara><emphasis role="strong">Creating a Storage Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Storage</emphasis>, click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">QoS Name</emphasis> and a <emphasis role="strong">Description</emphasis> for the quality of service entry.</simpara>
</listitem>
<listitem>
<simpara>Specify the <emphasis role="strong">Throughput</emphasis> quality of service by clicking one of the radio buttons:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">None</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Total</emphasis> - Enter the maximum permitted total throughput in the <emphasis role="strong">MB/s</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Read/Write</emphasis> - Enter the maximum permitted throughput for read operations in the left <emphasis role="strong">MB/s</emphasis> field, and the maximum permitted throughput for write operations in the right <emphasis role="strong">MB/s</emphasis> field.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Specify the input and output (<emphasis role="strong">IOps</emphasis>) quality of service by clicking one of the radio buttons:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">None</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Total</emphasis> - Enter the maximum permitted number of input and output operations per second in the <emphasis role="strong">IOps</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Read/Write</emphasis> - Enter the maximum permitted number of input operations per second in the left <emphasis role="strong">IOps</emphasis> field, and the maximum permitted number of output operations per second in the right <emphasis role="strong">IOps</emphasis> field.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have created a storage quality of service entry, and can create disk profiles based on that entry in data storage domains that belong to the data center.</simpara>
</section>
<section xml:id="Removing_a_Storage_Quality_of_Service_Entry">
<title>Removing a Storage Quality of Service Entry</title>
<simpara>Remove an existing storage quality of service entry.</simpara>
<simpara><emphasis role="strong">Removing a Storage Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Storage</emphasis>, select a storage quality of service entry and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If any disk profiles were based on that entry, the storage quality of service entry for those profiles is automatically set to <literal>[unlimited]</literal>.</simpara>
</section>
</section>
<section xml:id="sect-VM_Network_Quality_of_Service">
<title>Virtual Machine Network Quality of Service</title>
<simpara>Virtual machine network quality of service is a feature that allows you to create profiles for limiting both the inbound and outbound traffic of individual virtual network interface controllers. With this feature, you can limit bandwidth in a number of layers, controlling the consumption of network resources.</simpara>
<section xml:id="Creating_a_Virtual_Machine_Network_QoS_Entry">
<title>Creating a Virtual Machine Network Quality of Service Entry</title>
<simpara>Create a virtual machine network quality of service entry to regulate network traffic when applied to a virtual network interface controller (vNIC) profile, also known as a virtual machine network interface profile.</simpara>
<simpara><emphasis role="strong">Creating a Virtual Machine Network Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">VM Network</emphasis>, click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> for the virtual machine network quality of service entry.</simpara>
</listitem>
<listitem>
<simpara>Enter the limits for the <emphasis role="strong">Inbound</emphasis> and <emphasis role="strong">Outbound</emphasis> network traffic.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have created a virtual machine network quality of service entry that can be used in a virtual network interface controller.</simpara>
</section>
<section xml:id="Settings_in_the_New_VM_Network_QoS_and_Edit_VM_Network_QoS_Windows_Explained">
<title>Settings in the New Virtual Machine Network QoS and Edit Virtual Machine Network QoS Windows Explained</title>
<simpara>Virtual machine network quality of service settings allow you to configure bandwidth limits for both inbound and outbound traffic on three distinct levels.</simpara>
<table xml:id="Network_QoS_Settings" frame="all" rowsep="1" colsep="1">
<title>Virtual Machine Network QoS Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Data Center</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the virtual machine network QoS policy is to be added. This field is configured automatically according to the selected data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A name to represent the virtual machine network QoS policy within the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Inbound</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The settings to be applied to inbound traffic. Select or clear the <emphasis role="strong">Inbound</emphasis> check box to enable or disable these settings.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Average</emphasis>: The average speed of inbound traffic.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Peak</emphasis>: The speed of inbound traffic during peak times.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Burst</emphasis>: The speed of inbound traffic during bursts.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Outbound</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The settings to be applied to outbound traffic. Select or clear the <emphasis role="strong">Outbound</emphasis> check box to enable or disable these settings.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Average</emphasis>: The average speed of outbound traffic.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Peak</emphasis>: The speed of outbound traffic during peak times.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Burst</emphasis>: The speed of outbound traffic during bursts.</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>To change the maximum value allowed by the <emphasis role="strong">Average</emphasis>, <emphasis role="strong">Peak</emphasis>, or <emphasis role="strong">Burst</emphasis> fields, use the <literal>engine-config</literal> command to change the value of the <literal>MaxAverageNetworkQoSValue</literal>, <literal>MaxPeakNetworkQoSValue</literal>, or <literal>MaxBurstNetworkQoSValue</literal> configuration keys. You must restart the <emphasis role="strong">ovirt-engine</emphasis> service for any changes to take effect. For example:</simpara>
<screen># engine-config -s MaxAverageNetworkQoSValue=2048
# systemctl restart ovirt-engine</screen>
</section>
<section xml:id="Removing_a_Virtual_Machine_Network_QoS_Entry">
<title>Removing a Virtual Machine Network Quality of Service Entry</title>
<simpara>Remove an existing virtual machine network quality of service entry.</simpara>
<simpara><emphasis role="strong">Removing a Virtual Machine Network Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">VM Network</emphasis>, select a virtual machine network quality of service entry and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Host_Network_Quality_of_Service">
<title>Host Network Quality of Service</title>
<simpara>Host network quality of service configures the networks on a host to enable the control of network traffic through the physical interfaces. Host network quality of service allows for the fine tuning of network performance by controlling the consumption of network resources on the same physical network interface controller. This helps to prevent situations where one network causes other networks attached to the same physical network interface controller to no longer function due to heavy traffic. By configuring host network quality of service, these networks can now function on the same physical network interface controller without congestion issues.</simpara>
<section xml:id="Creating_a_Host_Network_Quality_of_Service_Entry">
<title>Creating a Host Network Quality of Service Entry</title>
<simpara>Create a host network quality of service entry.</simpara>
<simpara><emphasis role="strong">Creating a Host Network Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Host Network</emphasis>, click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Qos Name</emphasis> and a description for the quality of service entry.</simpara>
</listitem>
<listitem>
<simpara>Enter the desired values for <emphasis role="strong">Weighted Share</emphasis>, <emphasis role="strong">Rate Limit [Mbps]</emphasis>, and <emphasis role="strong">Committed Rate [Mbps]</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Settings_in_the_New_Host_Network_QoS_and_Edit_Host_Network_QoS_Windows_Explained">
<title>Settings in the New Host Network Quality of Service and Edit Host Network Quality of Service Windows Explained</title>
<simpara>Host network quality of service settings allow you to configure bandwidth limits for outbound traffic.</simpara>
<table xml:id="Host_Network_QoS_Settings" frame="all" rowsep="1" colsep="1">
<title>Host Network QoS Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Data Center</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The data center to which the host network QoS policy is to be added. This field is configured automatically according to the selected data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">QoS Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A name to represent the host network QoS policy within the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A description of the host network QoS policy.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Outbound</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The settings to be applied to outbound traffic.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Weighted Share</emphasis>: Signifies how much of the logical link&#8217;s capacity a specific network should be allocated, relative to the other networks attached to the same logical link. The exact share depends on the sum of shares of all networks on that link. By default this is a number in the range 1-100.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Rate Limit [Mbps]</emphasis>: The maximum bandwidth to be used by a network.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Committed Rate [Mbps]</emphasis>: The minimum bandwidth required by a network. The Committed Rate requested is not guaranteed and will vary depending on the network infrastructure and the Committed Rate requested by other networks on the same logical link.</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>To change the maximum value allowed by the <emphasis role="strong">Rate Limit [Mbps]</emphasis> or <emphasis role="strong">Committed Rate [Mbps]</emphasis> fields, use the <literal>engine-config</literal> command to change the value of the <literal>MaxAverageNetworkQoSValue</literal> configuration key. You must restart the <emphasis role="strong">ovirt-engine</emphasis> service for the change to take effect. For example:</simpara>
<screen># engine-config -s MaxAverageNetworkQoSValue=2048
# systemctl restart ovirt-engine</screen>
</section>
<section xml:id="Removing_a_Host_Network_Quality_of_Service_Entry">
<title>Removing a Host Network Quality of Service Entry</title>
<simpara>Remove an existing network quality of service entry.</simpara>
<simpara><emphasis role="strong">Removing a Host Network Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Host Network</emphasis>, select a host network quality of service entry and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> when prompted.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-CPU_Quality_of_Service">
<title>CPU Quality of Service</title>
<simpara>CPU quality of service defines the maximum amount of processing capability a virtual machine can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. Assigning CPU quality of service to a virtual machine allows you to prevent the workload on one virtual machine in a cluster from affecting the processing resources available to other virtual machines in that cluster.</simpara>
<section xml:id="Creating_a_CPU_Quality_of_Service_Entry">
<title>Creating a CPU Quality of Service Entry</title>
<simpara>Create a CPU quality of service entry.</simpara>
<simpara><emphasis role="strong">Creating a CPU Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">CPU</emphasis>, click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">QoS Name</emphasis> and a <emphasis role="strong">Description</emphasis> for the quality of service entry.</simpara>
</listitem>
<listitem>
<simpara>Enter the maximum processing capability the quality of service entry permits in the <emphasis role="strong">Limit (%)</emphasis> field. Do not include the <literal>%</literal> symbol.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have created a CPU quality of service entry, and can create CPU profiles based on that entry in clusters that belong to the data center.</simpara>
</section>
<section xml:id="Removing_a_CPU_Quality_of_Service_Entry">
<title>Removing a CPU Quality of Service Entry</title>
<simpara>Remove an existing CPU quality of service entry.</simpara>
<simpara><emphasis role="strong">Removing a CPU Quality of Service Entry</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">QoS</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">CPU</emphasis>, select a CPU quality of service entry and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If any CPU profiles were based on that entry, the CPU quality of service entry for those profiles is automatically set to <literal>[unlimited]</literal>.</simpara>
</section>
</section>
</chapter>
<chapter xml:id="chap-Data_Centers">
<title>Data Centers</title>
<section xml:id="Data_Centers">
<title>Introduction to Data Centers</title>
<simpara>A data center is a logical entity that defines the set of resources used in a specific environment. A data center is considered a container resource, in that it is comprised of logical resources, in the form of clusters and hosts; network resources, in the form of logical networks and physical NICs; and storage resources, in the form of storage domains.</simpara>
<simpara>A data center can contain multiple clusters, which can contain multiple hosts; it can have multiple storage domains associated to it; and it can support multiple virtual machines on each of its hosts. A oVirt environment can contain multiple data centers; the data center infrastructure allows you to keep these centers separate.</simpara>
<simpara>All data centers are managed from the single Administration Portal.</simpara>
<figure xml:id="data_center_fig">
<title>Data Centers</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/523.png"/>
</imageobject>
<textobject><phrase>523</phrase></textobject>
</mediaobject>
</figure>
<simpara>oVirt creates a default data center during installation. You can configure the default data center, or set up new appropriately named data centers.</simpara>
<section xml:id="The_Storage_Pool_ManagerSPM">
<title>The Storage Pool Manager</title>
<simpara>The Storage Pool Manager (SPM) is a role given to one of the hosts in the data center enabling it to manage the storage domains of the data center. The SPM entity can be run on any host in the data center; the oVirt Engine grants the role to one of the hosts. The SPM does not preclude the host from its standard operation; a host running as SPM can still host virtual resources.</simpara>
<simpara>The SPM entity controls access to storage by coordinating the metadata across the storage domains. This includes creating, deleting, and manipulating virtual disks (images), snapshots, and templates, and allocating storage for sparse block devices (on SAN). This is an exclusive responsibility: only one host can be the SPM in the data center at one time to ensure metadata integrity.</simpara>
<simpara>The oVirt Engine ensures that the SPM is always available. The Engine moves the SPM role to a different host if the SPM host encounters problems accessing the storage. When the SPM starts, it ensures that it is the only host granted the role; therefore it will acquire a storage-centric lease. This process can take some time.</simpara>
</section>
<section xml:id="SPM_Priority">
<title>SPM Priority</title>
<simpara>The SPM role uses some of a host&#8217;s available resources. The SPM priority setting of a host alters the likelihood of the host being assigned the SPM role: a host with high SPM priority will be assigned the SPM role before a host with low SPM priority. Critical virtual machines on hosts with low SPM priority will not have to contend with SPM operations for host resources.</simpara>
<simpara>You can change a host&#8217;s SPM priority in the <emphasis role="strong">SPM</emphasis> tab in the <emphasis role="strong">Edit Host</emphasis> window.</simpara>
</section>
</section>
<section xml:id="sect-Data_Center_Tasks">
<title>Data Center Tasks</title>
<section xml:id="Creating_a_New_Data_Center">
<title>Creating a New Data Center</title>
<simpara>This procedure creates a data center in your virtualization environment. The data center requires a functioning cluster, host, and storage domain to operate.</simpara>
<note>
<simpara>After you set the <emphasis role="strong">Compatibility Version</emphasis>, you cannot lower the version number. Version regression is not supported.</simpara>
<simpara>You can specify a MAC pool range for a cluster. Setting a MAC pool range is no longer supported.</simpara>
</note>
<simpara><emphasis role="strong">Creating a New Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the data center.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Storage Type</emphasis>, <emphasis role="strong">Compatibility Version</emphasis>, and <emphasis role="strong">Quota Mode</emphasis> of the data center from the drop-down menus.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to create the data center and open the <emphasis role="strong">Data Center - Guide Me</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Guide Me</emphasis> window lists the entities that need to be configured for the data center. Configure these entities or postpone configuration by clicking the <emphasis role="strong">Configure Later</emphasis> button. Configuration can be resumed by selecting the data center and clicking <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then clicking <emphasis role="strong">Guide Me</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>The new data center will remain <emphasis role="strong">Uninitialized</emphasis> until a cluster, host, and storage domain are configured for it; use <emphasis role="strong">Guide Me</emphasis> to configure these entities.</simpara>
</section>
<section xml:id="Data_center_properties">
<title>Explanation of Settings in the New Data Center and Edit Data Center Windows</title>
<simpara>The table below describes the settings of a data center as displayed in the <emphasis role="strong">New Data Center</emphasis> and <emphasis role="strong">Edit Data Center</emphasis> windows. Invalid entries are outlined in orange when you click <guibutton>OK</guibutton>, prohibiting the changes being accepted. In addition, field prompts indicate the expected values or range of values.</simpara>
<table xml:id="datacenters-Properties" frame="all" rowsep="1" colsep="1">
<title>Data Center Properties</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the data center. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The description of the data center. This field is recommended but not mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Storage Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Choose <emphasis role="strong">Shared</emphasis> or <emphasis role="strong">Local</emphasis> storage type.</simpara><simpara>Different types of storage domains (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center. Local and shared domains, however, cannot be mixed.</simpara><simpara>You can change the storage type after the data center is initialized. See <xref linkend="Changing_the_Data_Center_Storage_Type"/>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Compatibility Version</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The version of oVirt.</simpara><simpara>After upgrading the oVirt Engine, the hosts, clusters and data centers may still be in the earlier version. Ensure that you have upgraded all the hosts, then the clusters, before you upgrade the Compatibility Level of the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Quota Mode</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Quota is a resource limitation tool provided with oVirt. Choose one of:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Disabled</emphasis>: Select if you do not want to implement Quota</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Audit</emphasis>: Select if you want to edit the Quota settings</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Enforced</emphasis>: Select to implement Quota</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Comment</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Optionally add a plain text comment about the data center.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Re-initializing_a_Data_Center">
<title>Re-Initializing a Data Center: Recovery Procedure</title>
<simpara>This recovery procedure replaces the master data domain of your data center with a new master data domain. You must re-initialize your master data domain if its data is corrupted. Re-initializing a data center allows you to restore all other resources associated with the data center, including clusters, hosts, and non-problematic storage domains.</simpara>
<simpara>You can import any backup or exported virtual machines or templates into your new master data domain.</simpara>
<simpara><emphasis role="strong">Re-Initializing a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> and select the data center.</simpara>
</listitem>
<listitem>
<simpara>Ensure that any storage domains attached to the data center are in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Re-Initialize Data Center</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Data Center Re-Initialize</emphasis> window lists all available (detached; in maintenance mode) storage domains. Click the radio button for the storage domain you are adding to the data center.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Approve operation</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is attached to the data center as the master data domain and activated. You can now import any backup or exported virtual machines or templates into your new master data domain.</simpara>
</section>
<section xml:id="Removing_a_Data_Center">
<title>Removing a Data Center</title>
<simpara>An active host is required to remove a data center. Removing a data center will not remove the associated resources.</simpara>
<simpara><emphasis role="strong">Removing a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Ensure the storage domains attached to the data center are in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> and select the data center to remove.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Force_Removing_a_Data_Center">
<title>Force Removing a Data Center</title>
<simpara>A data center becomes <literal>Non Responsive</literal> if the attached storage domain is corrupt or if the host becomes <literal>Non Responsive</literal>. You cannot <emphasis role="strong">Remove</emphasis> the data center under either circumstance.</simpara>
<simpara><emphasis role="strong">Force Remove</emphasis> does not require an active host. It also permanently removes the attached storage domain.</simpara>
<simpara>It may be necessary to <emphasis role="strong">Destroy</emphasis> a corrupted storage domain before you can <emphasis role="strong">Force Remove</emphasis> the data center.</simpara>
<simpara><emphasis role="strong">Force Removing a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> and select the data center to remove.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Force Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Approve operation</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton></simpara>
</listitem>
</orderedlist>
<simpara>The data center and attached storage domain are permanently removed from the oVirt environment.</simpara>
</section>
<section xml:id="Changing_the_Data_Center_Storage_Type">
<title>Changing the Data Center Storage Type</title>
<simpara>You can change the storage type of the data center after it has been initialized. This is useful for data domains that are used to move virtual machines or templates around.</simpara>
<simpara><emphasis role="strong">Limitations</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>Shared to Local - For a data center that does not contain more than one host and more than one cluster, since a local data center does not support it.</simpara>
</listitem>
<listitem>
<simpara>Local to Shared - For a data center that does not contain a local storage domain.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Changing the Data Center Storage Type</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> and select the data center to change.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the <emphasis role="strong">Storage Type</emphasis> to the desired value.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Changing_the_Data_Center_Compatibility_Version_admin">
<title>Changing the Data Center Compatibility Version</title>
<simpara>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt with which the data center is intended to be compatible. All clusters in the data center must support the desired compatibility level.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>To change the data center compatibility level, you must first update the compatibility version of all clusters and virtual machines in the data center.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the data center to change and click <guibutton>Edit</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Change the <emphasis role="strong">Compatibility Version</emphasis> to the desired value.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>. The <emphasis role="strong">Change Data Center Compatibility Version</emphasis> confirmation dialog opens.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to confirm.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Data_Centers_and_Storage_Domains">
<title>Data Centers and Storage Domains</title>
<section xml:id="Attaching_a_data_domain">
<title>Attaching an Existing Data Domain to a Data Center</title>
<simpara>Data domains that are <emphasis role="strong">Unattached</emphasis> can be attached to a data center. Shared storage domains of multiple types (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center.</simpara>
<simpara><emphasis role="strong">Attaching an Existing Data Domain to a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Storage</emphasis> tab to list the storage domains already attached to the data center.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Attach Data</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the check box for the data domain to attach to the data center. You can select multiple check boxes to attach multiple data domains.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The data domain is attached to the data center and is automatically activated.</simpara>
</section>
<section xml:id="Attaching_an_iso_domain">
<title>Attaching an Existing ISO domain to a Data Center</title>
<simpara>An ISO domain that is <emphasis role="strong">Unattached</emphasis> can be attached to a data center. The ISO domain must be of the same <emphasis role="strong">Storage Type</emphasis> as the data center.</simpara>
<simpara>Only one ISO domain can be attached to a data center.</simpara>
<simpara><emphasis role="strong">Attaching an Existing ISO Domain to a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Storage</emphasis> tab to list the storage domains already attached to the data center.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Attach ISO</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the radio button for the appropriate ISO domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The ISO domain is attached to the data center and is automatically activated.</simpara>
</section>
<section xml:id="Attaching_an_export_domain">
<title>Attaching an Existing Export Domain to a Data Center</title>
<note>
<simpara>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See <xref linkend="sect-Importing_Existing_Storage_Domains"/> for information on importing storage domains.</simpara>
</note>
<simpara>An export domain that is <emphasis role="strong">Unattached</emphasis> can be attached to a data center. Only one export domain can be attached to a data center.</simpara>
<simpara><emphasis role="strong">Attaching an Existing Export Domain to a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Storage</emphasis> tab to list the storage domains already attached to the data center.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Attach Export</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the radio button for the appropriate export domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The export domain is attached to the data center and is automatically activated.</simpara>
</section>
<section xml:id="Detaching_storage_domains_from_a_data_center">
<title>Detaching a Storage Domain from a Data Center</title>
<simpara>Detaching a storage domain from a data center stops the data center from associating with that storage domain. The storage domain is not removed from the oVirt environment; it can be attached to another data center.</simpara>
<simpara>Data, such as virtual machines and templates, remains attached to the storage domain.</simpara>
<note>
<simpara>The master storage, if it is the last available storage domain, cannot be removed.</simpara>
</note>
<simpara><emphasis role="strong">Detaching a Storage Domain from a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Storage</emphasis> tab to list the storage domains attached to the data center.</simpara>
</listitem>
<listitem>
<simpara>Select the storage domain to detach. If the storage domain is <literal>Active</literal>, click <emphasis role="strong">Maintenance</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to initiate maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>It can take up to several minutes for the storage domain to disappear from the details view.</simpara>
</section>
</section>
</chapter>
<chapter xml:id="chap-Clusters">
<title>Clusters</title>
<section xml:id="Clusters">
<title>Introduction to Clusters</title>
<simpara>A cluster is a logical grouping of hosts that share the same storage domains and have the same type of CPU (either Intel or AMD). If the hosts have different generations of CPU models, they use only the features present in all models.</simpara>
<simpara>Each cluster in the system must belong to a data center, and each host in the system must belong to a cluster. Virtual machines are dynamically allocated to any host in a cluster and can be migrated between them, according to policies defined on the cluster and settings on the virtual machines. The cluster is the highest level at which power and load-sharing policies can be defined.</simpara>
<simpara>The number of hosts and number of virtual machines that belong to a cluster are displayed in the results list under <emphasis role="strong">Host Count</emphasis> and <emphasis role="strong">VM Count</emphasis>, respectively.</simpara>
<simpara>Clusters run virtual machines or Gluster Storage Servers. These two purposes are mutually exclusive: A single cluster cannot support virtualization and storage hosts together.</simpara>
<simpara>oVirt creates a default cluster in the default data center during installation.</simpara>
<figure xml:id="cluster_tab">
<title>Cluster</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/223.png"/>
</imageobject>
<textobject><phrase>223</phrase></textobject>
</mediaobject>
</figure>
</section>
<section xml:id="sect-Cluster_Tasks">
<title>Cluster Tasks</title>
<note>
<simpara>Some cluster options do not apply to Gluster clusters. For more information about using Gluster Storage with oVirt, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/configuring_red_hat_virtualization_with_red_hat_gluster_storage/"><emphasis>Configuring oVirt with Gluster Storage</emphasis></link>.</simpara>
</note>
<section xml:id="Creating_a_New_Cluster">
<title>Creating a New Cluster</title>
<simpara>A data center can contain multiple clusters, and a cluster can contain multiple hosts. All hosts in a cluster must have the same CPU architecture. To optimize your CPU types, create your hosts before you create your cluster. After creating the cluster, you can configure the hosts using the <emphasis role="strong">Guide Me</emphasis> button.</simpara>
<simpara><emphasis role="strong">Creating a New Cluster</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> the cluster will belong to from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the cluster.</simpara>
</listitem>
<listitem>
<simpara>Select a network from the <emphasis role="strong">Management Network</emphasis> drop-down list to assign the management network role.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">CPU Architecture</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">CPU Type</emphasis>, select <emphasis>the oldest CPU processor family</emphasis> among the hosts that will be part of this cluster. The CPU types are listed in order from the oldest to newest.</simpara>
<important>
<simpara>A hosts whose CPU processor family is older than the one you specify with <emphasis role="strong">CPU Type</emphasis> cannot be part of this cluster.
For details, see <link xl:href="https://access.redhat.com/solutions/634853">https://access.redhat.com/solutions/634853</link>.</simpara>
</important>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Compatibility Version</emphasis> of the cluster from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Switch Type</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Firewall Type</emphasis> for hosts in the cluster, either <emphasis role="strong">Firewalld</emphasis> (default) or <emphasis role="strong">iptables</emphasis>.</simpara>
<note>
<simpara><emphasis role="strong">iptables</emphasis> is only supported on Enterprise Linux 7 hosts, in clusters with compatibility version 4.2 or 4.3. You can only add Enterprise Linux 8 hosts to clusters with firewall type <emphasis role="strong">firewalld</emphasis></simpara>
</note>
</listitem>
<listitem>
<simpara>Select either the <emphasis role="strong">Enable Virt Service</emphasis> or <emphasis role="strong">Enable Gluster Service</emphasis> check box to define whether the cluster will be populated with virtual machine hosts or with Gluster-enabled nodes.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">Enable to set VM maintenance reason</emphasis> check box to enable an optional reason field when a virtual machine is shut down from the Engine, allowing the administrator to provide an explanation for the maintenance.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">Enable to set Host maintenance reason</emphasis> check box to enable an optional reason field when a host is placed into maintenance mode from the Engine, allowing the administrator to provide an explanation for the maintenance.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">/dev/hwrng source</emphasis> (external hardware device) check box to specify the random number generator device that all hosts in the cluster will use. The <emphasis role="strong">/dev/urandom source</emphasis> (Linux-provided device) is enabled by default.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Optimization</emphasis> tab to select the memory page sharing threshold for the cluster, and optionally enable CPU thread handling and memory ballooning on the hosts in the cluster.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Migration Policy</emphasis> tab to define the virtual machine migration policy for the cluster.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Scheduling Policy</emphasis> tab to optionally configure a scheduling policy, configure scheduler optimization settings, enable trusted service for hosts in the cluster, enable HA Reservation, and select a serial number policy.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Console</emphasis> tab to optionally override the global SPICE proxy, if any, and specify the address of a SPICE proxy for hosts in the cluster.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Fencing policy</emphasis> tab to enable or disable fencing in the cluster, and select fencing options.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">MAC Address Pool</emphasis> tab to specify a MAC address pool other than the default pool for the cluster. For more options on creating, editing, or removing MAC address pools, see <xref linkend="sect-MAC_Address_Pools"/>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to create the cluster and open the <emphasis role="strong">Cluster - Guide Me</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Guide Me</emphasis> window lists the entities that need to be configured for the cluster. Configure these entities or postpone configuration by clicking the <emphasis role="strong">Configure Later</emphasis> button. Configuration can be resumed by selecting the cluster and clicking <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then clicking <emphasis role="strong">Guide Me</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Cluster_General_Settings_Explained">
<title>General Cluster Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">General</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> and <emphasis role="strong">Edit Cluster</emphasis> windows. Invalid entries are outlined in orange when you click <guibutton>OK</guibutton>, prohibiting the changes being accepted. In addition, field prompts indicate the expected values or range of values.</simpara>
<table xml:id="Cluster-Properties" frame="all" rowsep="1" colsep="1">
<title>General Cluster Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Data Center</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The data center that will contain the cluster. The data center must be created before adding a cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the cluster. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description / Comment</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The description of the cluster or additional notes. These fields are recommended but not mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Management Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The logical network that will be assigned the management network role. The default is <emphasis role="strong">ovirtmgmt</emphasis>. This network will also be used for migrating virtual machines if the migration network is not properly attached to the source or the destination hosts.</simpara><simpara>On existing clusters, the management network can only be changed using the <emphasis role="strong">Manage Networks</emphasis> button in the <emphasis role="strong">Logical Networks</emphasis> tab in the details view.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">CPU Architecture</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The CPU architecture of the cluster. All hosts in a cluster must run the architecture you specify. Different CPU types are available depending on which CPU architecture is selected.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">undefined</emphasis>: All other CPU types.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">x86_64</emphasis>: For Intel and AMD CPU types.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ppc64</emphasis>: For IBM POWER CPU types.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">CPU Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The oldest CPU family in the cluster. For a list of CPU types, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#CPU_Requirements_RHV_planning">CPU Requirements</link> in the <emphasis>Planning and Prerequisites Guide</emphasis>. You cannot change this cannot after creating the cluster without significant disruption. Set CPU type to the oldest CPU model in the cluster. Only features present in all models can be used. For both Intel and AMD CPU types, the listed CPU models are in logical order from the oldest to the newest.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Compatibility Version</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The version of oVirt. You will not be able to select a version earlier than the version specified for the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Switch Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The type of switch used by the cluster. <emphasis role="strong">Linux Bridge</emphasis> is the standard oVirt switch. <emphasis role="strong">OVS</emphasis> provides support for Open vSwitch networking features.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Firewall Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies the firewall type for hosts in the cluster, either <emphasis role="strong">firewalld</emphasis> (default) or <emphasis role="strong">iptables</emphasis>.
<emphasis role="strong">iptables</emphasis> is only supported on Enterprise Linux 7 hosts, in clusters with compatibility version 4.2 or 4.3. You can only add Enterprise Linux 8 hosts to clusters with firewall type <emphasis role="strong">firewalld</emphasis>.
If you change an existing cluster&#8217;s firewall type, you must <link linkend="Reinstalling_Hosts_admin">reinstall all hosts</link> in the cluster to apply the change.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Default Network Provider</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies the default external network provider that the cluster will use. If you select Open Virtual Network (OVN), the hosts added to the cluster are automatically  configured to communicate with the OVN provider.</simpara><simpara>If you change the default network provider, you must <link linkend="Reinstalling_Hosts_admin">reinstall all hosts</link> in the cluster to apply the change.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Maximum Log Memory Threshold</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specifies the logging threshold for maximum memory consumption as a percentage or as an absolute value in MB. A message is logged if a host&#8217;s memory usage exceeds the percentage value or if a host&#8217;s available memory falls below the absolute value in MB. The default is <literal>95%</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Virt Service</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this radio button is selected, hosts in this cluster will be used to run virtual machines.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Gluster Service</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this radio button is selected, hosts in this cluster will be used as Gluster Storage Server nodes, and not for running virtual machines.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Import existing gluster configuration</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This check box is only available if the <emphasis role="strong">Enable Gluster Service</emphasis> radio button is selected. This option allows you to import an existing Gluster-enabled cluster and all its attached hosts to oVirt Engine.</simpara>
<simpara>The following options are required for each host in the cluster that is being imported:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Address</emphasis>: Enter the IP or fully qualified domain name of the Gluster host server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Fingerprint</emphasis>: oVirt Engine fetches the host&#8217;s fingerprint, to ensure you are connecting with the correct host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Root Password</emphasis>: Enter the root password required for communicating with the host.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable to set VM maintenance reason</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this check box is selected, an optional reason field will appear when a virtual machine in the cluster is shut down from the Engine. This allows you to provide an explanation for the maintenance, which will appear in the logs and when the virtual machine is powered on again.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable to set Host maintenance reason</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this check box is selected, an optional reason field will appear when a host in the cluster is moved into maintenance mode from the Engine. This allows you to provide an explanation for the maintenance, which will appear in the logs and when the host is activated again.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Additional Random Number Generator source</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If the check box is selected, all hosts in the cluster have the additional random number generator device available. This enables passthrough of entropy from the random number generator device to virtual machines.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Cluster_Optimization_Settings_Explained">
<title>Optimization Settings Explained</title>
<simpara><emphasis role="strong">Memory Considerations</emphasis></simpara>
<simpara>Memory page sharing allows virtual machines to use up to 200% of their allocated memory by utilizing unused memory in other virtual machines. This process is based on the assumption that the virtual machines in your oVirt environment will not all be running at full capacity at the same time, allowing unused memory to be temporarily allocated to a particular virtual machine.</simpara>
<simpara xml:id="CPU_Considerations_cluster_opt_settings"><emphasis role="strong">CPU Considerations</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">For non-CPU-intensive workloads</emphasis>, you can run virtual machines with a total number of processor cores greater than the number of cores in the host. Doing so enables the following:</simpara>
<itemizedlist>
<listitem>
<simpara>You can run a greater number of virtual machines, which reduces hardware requirements.</simpara>
</listitem>
<listitem>
<simpara>You can configure virtual machines with CPU topologies that are otherwise not possible, such as when the number of virtual cores is between the number of host cores and the number of host threads.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">For best performance, and especially for CPU-intensive workloads</emphasis>, you should use the same topology in the virtual machine as in the host, so the host and the virtual machine expect the same cache usage. When the host has hyperthreading enabled, QEMU treats the host&#8217;s hyperthreads as cores, so the virtual machine is not aware that it is running on a single core with multiple threads. This behavior might impact the performance of a virtual machine, because a virtual core that actually corresponds to a hyperthread in the host core might share a single cache with another hyperthread in the same host core, while the virtual machine treats it as a separate core.</simpara>
</listitem>
</itemizedlist>
<simpara>The table below describes the settings for the <emphasis role="strong">Optimization</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> and <emphasis role="strong">Edit Cluster</emphasis> windows.</simpara>
<table xml:id="Memory_Optimization_settings" frame="all" rowsep="1" colsep="1">
<title>Optimization Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Memory Optimization</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara><emphasis role="strong">None - Disable memory overcommit</emphasis>: Disables memory page sharing.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">For Server Load - Allow scheduling of 150% of physical memory</emphasis>: Sets the memory page sharing threshold to 150% of the system memory on each host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">For Desktop Load - Allow scheduling of 200% of physical memory</emphasis>: Sets the memory page sharing threshold to 200% of the system memory on each host.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">CPU Threads</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Selecting the <emphasis role="strong">Count Threads As Cores</emphasis> check box enables hosts to run virtual machines with a total number of processor cores greater than the number of cores in the host.</simpara><simpara>When this check box is selected, the exposed host threads are treated as cores that virtual machines can use. For example, a 24-core system with 2 threads per core (48 threads total) can run virtual machines with up to 48 cores each, and the algorithms to calculate host CPU load would compare load against twice as many potential utilized cores.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Memory Balloon</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Selecting the <emphasis role="strong">Enable Memory Balloon Optimization</emphasis> check box enables memory overcommitment on virtual machines running on the hosts in this cluster. When this check box is selected, the Memory Overcommit Manager (MoM) starts ballooning where and when possible, with a limitation of the guaranteed memory size of every virtual machine.</simpara><simpara>To have a balloon running, the virtual machine needs to have a balloon device with relevant drivers. Each virtual machine includes a balloon device unless specifically removed. Each host in this cluster receives a balloon policy update when its status changes to <literal>Up</literal>. If necessary, you can manually update the balloon policy on a host without having to change the status. See <xref linkend="Updating_the_MoM_Policy_on_Hosts_in_a_Cluster"/>.</simpara><simpara>It is important to understand that in some scenarios ballooning may collide with KSM. In such cases MoM will try to adjust the balloon size to minimize collisions. Additionally, in some scenarios ballooning may cause sub-optimal performance for a virtual machine. Administrators are advised to use ballooning optimization with caution.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">KSM control</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Selecting the <emphasis role="strong">Enable KSM</emphasis> check box enables MoM to run Kernel Same-page Merging (KSM) when necessary and when it can yield a memory saving benefit that outweighs its CPU cost.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Cluster_Migration_Policy_Settings_Explained">
<title>Migration Policy Settings Explained</title>
<simpara>A migration policy defines the conditions for live migrating virtual machines in the event of host failure. These conditions include the downtime of the virtual machine during migration, network bandwidth, and how the virtual machines are prioritized.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Migration Policies Explained</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Policy</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Legacy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Legacy behavior of 3.6 version. Overrides in <literal>vdsm.conf</literal> are still applied. The guest agent hook mechanism is disabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Minimal downtime</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A policy that lets virtual machines migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if the virtual machine migration does not converge after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Post-copy migration</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Virtual machines should not experience any significant downtime similar to the minimal downtime policy. The post-copy policy first tries pre-copy to verify whether convergence may occur. The migration switches to post-copy if the virtual machine migration does not converge after a long time. The disadvantage of this policy is that in the post-copy phase, the virtual machine may slow down significantly as the missing parts of memory are transferred between the hosts.</simpara>
<simpara>If anything goes wrong during the post-copy phase, such as a network failure of the migration network between the hosts, then the migration process leads to an inconsistent and paused VM and the result is a lost VM. Therefore, it is not possible to abort a migration during the post-copy phase.</simpara>
<warning>
<title>Warning</title>
<simpara>If the network connection breaks prior to the completion of the post-copy process, the Engine pauses and then kills the running VM. Do not use post-copy migration if the VM availability is critical or if the migration network is unstable.</simpara>
</warning></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Suspend workload if needed</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A policy that lets virtual machines migrate in most situations, including virtual machines running heavy workloads. Because of this, virtual machines may experience a more significant downtime than with some of the other settings. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The bandwidth settings define the maximum bandwidth of both outgoing and incoming migrations per host.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Bandwidth Explained</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Policy</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Auto</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Bandwidth is copied from the <emphasis role="strong">Rate Limit [Mbps]</emphasis> setting in the data center <emphasis role="strong">Host Network QoS</emphasis>. If the rate limit has not been defined, it is computed as a minimum of link speeds of sending and receiving network interfaces. If rate limit has not been set, and link speeds are not available,  it is determined by local VDSM setting on sending host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hypervisor default</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Bandwidth is controlled by local VDSM setting on sending Host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Custom</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Defined by user (in Mbps). This value is divided by the number of concurrent migrations (default is 2, to account for ingoing and outgoing migration). Therefore, the user-defined bandwidth must be large enough to accommodate all concurrent migrations.</simpara><simpara>For example, if the <literal>Custom</literal> bandwidth is defined as 600 Mbps, a virtual machine migration&#8217;s maximum bandwidth is actually 300 Mbps.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The resilience policy defines how the virtual machines are prioritized in the migration.</simpara>
<table xml:id="Resilience_Policy_settings" frame="all" rowsep="1" colsep="1">
<title>Resilience Policy Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migrate Virtual Machines</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Migrates all virtual machines in order of their defined priority.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migrate only Highly Available Virtual Machines</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Migrates only highly available virtual machines to prevent overloading other hosts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Do Not Migrate Virtual Machines</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Prevents virtual machines from being migrated.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The <emphasis role="strong">Additional Properties</emphasis> are only applicable to the <emphasis role="strong">Legacy</emphasis> migration policy.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Additional Properties Explained</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Property</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Auto Converge migrations</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to set whether auto-convergence is used during live migration of virtual machines. Large virtual machines with high workloads can dirty memory more quickly than the transfer rate achieved during live migration, and prevent the migration from converging. Auto-convergence capabilities in QEMU allow you to force convergence of virtual machine migrations. QEMU automatically detects a lack of convergence and triggers a throttle-down of the vCPUs on the virtual machine. Auto-convergence is disabled globally by default.</simpara>
<itemizedlist>
<listitem>
<simpara>Select <emphasis role="strong">Inherit from global setting</emphasis> to use the auto-convergence setting that is set at the global level. This option is selected by default.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Auto Converge</emphasis> to override the global setting and allow auto-convergence for the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Don&#8217;t Auto Converge</emphasis> to override the global setting and prevent auto-convergence for the virtual machine.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable migration compression</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to set whether migration compression is used during live migration of the virtual machine. This feature uses Xor Binary Zero Run-Length-Encoding to reduce virtual machine downtime and total live migration time for virtual machines running memory write-intensive workloads or for any application with a sparse memory update pattern. Migration compression is disabled globally by default.</simpara>
<itemizedlist>
<listitem>
<simpara>Select <emphasis role="strong">Inherit from global setting</emphasis> to use the compression setting that is set at the global level. This option is selected by default.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Compress</emphasis> to override the global setting and allow compression for the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Don&#8217;t compress</emphasis> to override the global setting and prevent compression for the virtual machine.</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Cluster_Scheduling_Policy_Settings">
<title>Scheduling Policy Settings Explained</title>
<simpara>Scheduling policies allow you to specify the usage and distribution of virtual machines between available hosts. Define the scheduling policy to enable automatic load balancing across the hosts in a cluster. Regardless of the scheduling policy, a virtual machine will not start on a host with an overloaded CPU. By default, a host&#8217;s CPU is considered overloaded if it has a load of more than 80% for 5 minutes, but these values can be changed using scheduling policies. See <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</link> in the <emphasis>Administration Guide</emphasis> for more information.</simpara>
<table xml:id="Cluster-General" frame="all" rowsep="1" colsep="1">
<title>Scheduling Policy Tab Properties</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="75*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Select Policy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select a policy from the drop-down list.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">none</emphasis>: Disables load-balancing or power-sharing between hosts for already-running virtual machines. This is the default mode. When a virtual machine is started, the memory and CPU processing load is spread evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis>, <emphasis role="strong">HighUtilization</emphasis>, or <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">evenly_distributed</emphasis>: Distributes the memory and CPU processing load evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis>, <emphasis role="strong">HighUtilization</emphasis>, or <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">cluster_maintenance</emphasis>: Limits activity in a cluster during maintenance tasks. No new virtual machines may be started, except highly available virtual machines. If host failure occurs, highly available virtual machines will restart properly and any virtual machine can migrate.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">power_saving</emphasis>: Distributes the memory and CPU processing load across a subset of available hosts to reduce power consumption on underutilized hosts. Hosts with a CPU load below the low utilization value for longer than the defined time interval will migrate all virtual machines to other hosts so that it can be powered down. Additional virtual machines attached to a host will not start if that host has reached the defined high utilization value.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">vm_evenly_distributed</emphasis>: Distributes virtual machines evenly between hosts based on a count of the virtual machines. The cluster is considered unbalanced if any host is running more virtual machines than the <emphasis role="strong">HighVmCount</emphasis> and there is at least one host with a virtual machine count that falls outside of the <emphasis role="strong">MigrationThreshold</emphasis>.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Properties</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The following properties appear depending on the selected policy. Edit them if necessary:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">HighVmCount</emphasis>: Sets the minimum number of virtual machines that must be running per host to enable load balancing. The default value is 10 running virtual machines on one host. Load balancing is only enabled when there is at least one host in the cluster that has at least <literal>HighVmCount</literal> running virtual machines.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">MigrationThreshold</emphasis>: Defines a buffer before virtual machines are migrated from the host. It is the maximum inclusive difference in virtual machine count between the most highly-utilized host and the least-utilized host. The cluster is balanced when every host in the cluster has a virtual machine count that falls inside the migration threshold. The default value is <emphasis role="strong">5</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">SpmVmGrace</emphasis>: Defines the number of slots for virtual machines to be reserved on SPM hosts. The SPM host will have a lower load than other hosts, so this variable defines how many fewer virtual machines the SPM host can run in comparison to other hosts. The default value is <emphasis role="strong">5</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">CpuOverCommitDurationMinutes</emphasis>: Sets the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action. The defined time interval protects against temporary spikes in CPU load activating scheduling policies and instigating unnecessary virtual machine migration. Maximum two characters. The default value is <emphasis role="strong">2</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">HighUtilization</emphasis>: Expressed as a percentage. If the host runs with CPU usage at or above the high utilization value for the defined time interval, the oVirt Engine migrates virtual machines to other hosts in the cluster until the host&#8217;s CPU load is below the maximum service threshold. The default value is <emphasis role="strong">80</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">LowUtilization</emphasis>: Expressed as a percentage. If the host runs with CPU usage below the low utilization value for the defined time interval, the oVirt Engine will migrate virtual machines to other hosts in the cluster. The Engine will power down the original host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. The default value is <emphasis role="strong">20</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ScaleDown</emphasis>: Reduces the impact of the <emphasis role="strong">HA Reservation</emphasis> weight function, by dividing a host&#8217;s score by the specified amount. This is an optional property that can be added to any policy, including <emphasis role="strong">none</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">HostsInReserve</emphasis>: Specifies a number of hosts to keep running even though there are no running virtual machines on them. This is an optional property that can be added to the <emphasis role="strong">power_saving</emphasis> policy.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">EnableAutomaticHostPowerManagement</emphasis>: Enables automatic power management for all hosts in the cluster. This is an optional property that can be added to the <emphasis role="strong">power_saving</emphasis> policy. The default value is <emphasis role="strong">true</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis>: Specifies the minimum amount of free memory a host should have, in MB. If a host has less free memory than this amount, the oVirt Engine considers the host overutilized. For example, if you set this property to <literal>1000</literal>, a host that has less than 1 GB of free memory is overutilized.</simpara>
<simpara>For details on how this property interacts with the <emphasis role="strong">power_saving</emphasis> and <emphasis role="strong">evenly_distributed</emphasis> policies, see <xref linkend="conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties"/>.</simpara>
<simpara>You can add this property to the <emphasis role="strong">power_saving</emphasis> and <emphasis role="strong">evenly_distributed</emphasis> policies. Although it appears among the list of properties for the <emphasis role="strong">vm_evenly_distributed</emphasis> policy, it does not apply to that policy.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis>: Specifies the maximum amount of free memory a host should have, in MB. If a host has more free memory than this amount, the oVirt Engine scheduler considers the host underutilized. For example, if you set this parameter to <literal>10000</literal>, a host that has more than 10 GB of free memory is underutilized.</simpara>
<simpara>For details on how this property interacts with the <emphasis role="strong">power_saving</emphasis> and <emphasis role="strong">evenly_distributed</emphasis> policies, see <xref linkend="conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties"/>.</simpara>
<simpara>You can add this property to the <emphasis role="strong">power_saving</emphasis> and <emphasis role="strong">evenly_distributed</emphasis> policies. Although it appears among the list of properties for the <emphasis role="strong">vm_evenly_distributed</emphasis> policy, it does not apply to that policy.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">HeSparesCount</emphasis>: Sets the number of additional self-hosted engine nodes that must reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. Other virtual machines are prevented from starting on a self-hosted engine node if doing so would not leave enough free memory for the Engine virtual machine. This is an optional property that can be added to the <emphasis role="strong">power_saving</emphasis>, <emphasis role="strong">vm_evenly_distributed</emphasis>, and <emphasis role="strong">evenly_distributed</emphasis> policies. The default value is <emphasis role="strong">0</emphasis>.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Scheduler Optimization</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Optimize scheduling for host weighing/ordering.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Optimize for Utilization</emphasis>: Includes weight modules in scheduling to allow best selection.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Optimize for Speed</emphasis>: Skips host weighting in cases where there are more than ten pending requests.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Trusted Service</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enable integration with an OpenAttestation server. Before this can be enabled, use the <literal>engine-config</literal> tool to enter the OpenAttestation server&#8217;s details. <emphasis role="strong">IMPORTANT</emphasis>: OpenAttestation and Intel Trusted Execution Technology (Intel TXT) are no longer available.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable HA Reservation</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enable the Engine to monitor cluster capacity for highly available virtual machines. The Engine ensures that appropriate capacity exists within a cluster for virtual machines designated as highly available to migrate in the event that their existing host fails unexpectedly.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Serial Number Policy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Configure the policy for assigning serial numbers to each new virtual machine in the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">System Default</emphasis>: Use the system-wide defaults in the Engine database. To configure these defaults, <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-the_engine_configuration_tool">use the engine configuration tool</link> to set the values of the <literal>DefaultSerialNumberPolicy</literal> and <literal>DefaultCustomSerialNumber</literal>. These key-value pairs are saved in the <literal>vdc_options</literal> table of the Engine database.</simpara>
<simpara>For <literal>DefaultSerialNumberPolicy</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>Default value: <literal>HOST_ID</literal></simpara>
</listitem>
<listitem>
<simpara>Possible values: <literal>HOST_ID</literal>, <literal>VM_ID</literal>, <literal>CUSTOM</literal></simpara>
</listitem>
<listitem>
<simpara>Command line example: <literal>engine-config --set DefaultSerialNumberPolicy=VM_ID</literal></simpara>
</listitem>
<listitem>
<simpara>Important: Restart the Engine to apply the configuration.</simpara>
</listitem>
</itemizedlist>
<simpara>For <literal>DefaultCustomSerialNumber</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara>Default value: Dummy serial number</simpara>
</listitem>
<listitem>
<simpara>Possible values: Any string (max length 255 characters)</simpara>
</listitem>
<listitem>
<simpara>Command line example: <literal>engine-config --set DefaultCustomSerialNumber="My very special string value"</literal></simpara>
</listitem>
<listitem>
<simpara>Important: Restart the Engine to apply the configuration.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host ID</emphasis>: Set each new virtual machine&#8217;s serial number to the UUID of the host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Vm ID</emphasis>: Set each new virtual machine&#8217;s serial number to the UUID of the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Custom serial number</emphasis>: Set each new virtual machine&#8217;s serial number to the value you specify in the following <emphasis role="strong">Custom Serial Number</emphasis> parameter.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Custom Serial Number</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specify the custom serial number to apply to new virtual machines in the cluster.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>When a host&#8217;s free memory drops below 20%, ballooning commands like <literal>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</literal> are logged to <emphasis role="strong">/var/log/vdsm/mom.log</emphasis>. <emphasis role="strong">/var/log/vdsm/mom.log</emphasis> is the Memory Overcommit Manager log file.</simpara>
</section>
<section xml:id="conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties">
<title>MaxFreeMemoryForOverUtilized and MinFreeMemoryForUnderUtilized cluster scheduling policy properties</title>
<simpara>The scheduler has a background process that migrates virtual machines according to the current cluster scheduling policy and its parameters. Based on the various criteria and their relative weights in a policy, the scheduler continuously categorizes hosts as <emphasis>source hosts</emphasis> or <emphasis>destination hosts</emphasis> and migrates individual virtual machines from the former to the latter.</simpara>
<simpara>The following description explains how the <emphasis role="strong">evenly_distributed</emphasis> and <emphasis role="strong">power_saving</emphasis> cluster scheduling policies interact with the <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> and <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> properties. Although both policies consider CPU and memory load, CPU load is not relevant for the <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> and <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> properties.</simpara>
<simpara>If you define the <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> and <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> properties as part of the <emphasis role="strong">evenly_distributed</emphasis> policy:</simpara>
<itemizedlist>
<listitem>
<simpara>Hosts that have less free memory than <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> are overutilized and become source hosts.</simpara>
</listitem>
<listitem>
<simpara>Hosts that have more free memory than <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> are underutilized and become destination hosts.</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> is not defined, the scheduler does not migrate virtual machines based on the memory load. (It continues migrating virtual machines based on the policy&#8217;s other criteria, such as CPU load.)</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> is not defined, the scheduler considers all hosts eligible to become destination hosts.</simpara>
</listitem>
</itemizedlist>
<simpara>If you define the <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> and <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> properties as part of the <emphasis role="strong">power_saving</emphasis> policy:</simpara>
<itemizedlist>
<listitem>
<simpara>Hosts that have less free memory than <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> are overutilized and become source hosts.</simpara>
</listitem>
<listitem>
<simpara>Hosts that have more free memory than <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> are underutilized and become source hosts.</simpara>
</listitem>
<listitem>
<simpara>Hosts that have more free memory than <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> are not overutilized and become destination hosts.</simpara>
</listitem>
<listitem>
<simpara>Hosts that have less free memory than <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> are not underutilized and become destination hosts.</simpara>
</listitem>
<listitem>
<simpara>The scheduler prefers migrating virtual machines to hosts that are neither overutilized nor underutilized. If there are not enough of these hosts, the scheduler can migrate virtual machines to underutilized hosts. If the underutilized hosts are not needed for this purpose, the scheduler can power them down.</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">MaxFreeMemoryForOverUtilized</emphasis> is not defined, no hosts are overutilized. Therefore, only underutilized hosts are source hosts, and destination hosts include all hosts in the cluster.</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">MinFreeMemoryForUnderUtilized</emphasis> is not defined, only overutilized hosts are source hosts, and hosts that are not overutilized are destination hosts.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="Cluster_Scheduling_Policy_Settings"/></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Cluster_Console_Settings_Explained">
<title>Cluster Console Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">Console</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> and <emphasis role="strong">Edit Cluster</emphasis> windows.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Console Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Define SPICE Proxy for Cluster</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this check box to enable overriding the SPICE proxy defined in global configuration. This feature is useful in a case where the user (who is, for example, connecting via the VM Portal) is outside of the network where the hypervisors reside.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Overridden SPICE proxy address</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The proxy by which the SPICE client connects to virtual machines. The address must be in the following format:</simpara>
<screen>protocol://[host]:[port]</screen></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Fencing_Policy_Settings_Explained">
<title>Fencing Policy Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">Fencing Policy</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> and <emphasis role="strong">Edit Cluster</emphasis> windows.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Fencing Policy Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable fencing</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables fencing on the cluster. Fencing is enabled by default, but can be disabled if required; for example, if temporary network issues are occurring or expected, administrators can disable fencing until diagnostics or maintenance activities are completed. Note that if fencing is disabled, highly available virtual machines running on non-responsive hosts will not be restarted elsewhere.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Skip fencing if host has live lease on storage</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this check box is selected, any hosts in the cluster that are Non Responsive and still connected to storage will not be fenced.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Skip fencing on cluster connectivity issues</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this check box is selected, fencing will be temporarily disabled if the percentage of hosts in the cluster that are experiencing connectivity issues is greater than or equal to the defined <emphasis role="strong">Threshold</emphasis>. The <emphasis role="strong">Threshold</emphasis> value is selected from the drop-down list; available values are <emphasis role="strong">25</emphasis>, <emphasis role="strong">50</emphasis>, <emphasis role="strong">75</emphasis>, and <emphasis role="strong">100</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Skip fencing if gluster bricks are up</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This option is only available when Gluster Storage functionality is enabled. If this check box is selected, fencing is skipped if bricks are running and can be reached from other peers. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#configure_high_availability_using_fencing_policies">Chapter 2. Configure High Availability using Fencing Policies</link> and <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#ref-rhgs-fencing-policies">Appendix A. Fencing Policies for Gluster Storage</link> in <emphasis>Maintaining Red Hat Hyperconverged Infrastructure</emphasis> for more information.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Skip fencing if gluster quorum not met</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This option is only available when Gluster Storage functionality is enabled. If this check box is selected, fencing is skipped if bricks are running and shutting down the host will cause loss of quorum. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#configure_high_availability_using_fencing_policies">Chapter 2. Configure High Availability using Fencing Policies</link> and <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#ref-rhgs-fencing-policies">Appendix A. Fencing Policies for Gluster Storage</link> in <emphasis>Maintaining Red Hat Hyperconverged Infrastructure</emphasis> for more information.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Configuring_scheduling_policy">
<title>Setting Load and Power Management Policies for Hosts in a Cluster</title>
<simpara>The <emphasis role="strong">evenly_distributed</emphasis> and <emphasis role="strong">power_saving</emphasis> scheduling policies allow you to specify acceptable memory and CPU usage values, and the point at which virtual machines must be migrated to or from a host. The <emphasis role="strong">vm_evenly_distributed</emphasis> scheduling policy distributes virtual machines evenly between hosts based on a count of the virtual machines. Define the scheduling policy to enable automatic load balancing across the hosts in a cluster. For a detailed explanation of each scheduling policy, see <xref linkend="Cluster_Scheduling_Policy_Settings"/>.</simpara>
<simpara><emphasis role="strong">Setting Load and Power Management Policies for Hosts</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice> and select a cluster.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Scheduling Policy</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select one of the following policies:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">none</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">vm_evenly_distributed</emphasis></simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Set the minimum number of virtual machines that must be running on at least one host to enable load balancing in the <emphasis role="strong">HighVmCount</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Define the maximum acceptable difference between the number of virtual machines on the most highly-utilized host and the number of virtual machines on the least-utilized host in the <emphasis role="strong">MigrationThreshold</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Define the number of slots for virtual machines to be reserved on SPM hosts in the <emphasis role="strong">SpmVmGrace</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Optionally, in the <emphasis role="strong">HeSparesCount</emphasis> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <xref linkend="Configuring_Memory_Slots_Reserved_for_the_SHE"/> for more information.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">evenly_distributed</emphasis></simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Set the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action in the <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the CPU utilization percentage at which virtual machines start migrating to other hosts in the <emphasis role="strong">HighUtilization</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Optionally, in the <emphasis role="strong">HeSparesCount</emphasis> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <xref linkend="Configuring_Memory_Slots_Reserved_for_the_SHE"/> for more information.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><emphasis role="strong">power_saving</emphasis></simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Set the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action in the <emphasis role="strong">CpuOverCommitDurationMinutes</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the CPU utilization percentage below which the host will be considered under-utilized in the <emphasis role="strong">LowUtilization</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the CPU utilization percentage at which virtual machines start migrating to other hosts in the <emphasis role="strong">HighUtilization</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Optionally, in the <emphasis role="strong">HeSparesCount</emphasis> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <xref linkend="Configuring_Memory_Slots_Reserved_for_the_SHE"/> for more information.</simpara>
</listitem>
</orderedlist>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Choose one of the following as the <emphasis role="strong">Scheduler Optimization</emphasis> for the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara>Select <emphasis role="strong">Optimize for Utilization</emphasis> to include weight modules in scheduling to allow best selection.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Optimize for Speed</emphasis> to skip host weighting in cases where there are more than ten pending requests.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>If you are using an OpenAttestation server to verify your hosts, and have set up the server&#8217;s details using the <literal>engine-config</literal> tool, select the <emphasis role="strong">Enable Trusted Service</emphasis> check box.</simpara>
</listitem>
</orderedlist>
<informalexample>
<simpara>OpenAttestation and Intel Trusted Execution Technology (Intel TXT) are no longer available.</simpara>
</informalexample>
<orderedlist numeration="arabic">
<listitem>
<simpara>Optionally select the <emphasis role="strong">Enable HA Reservation</emphasis> check box to enable the Engine to monitor cluster capacity for highly available virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Optionally select a <emphasis role="strong">Serial Number Policy</emphasis> for the virtual machines in the cluster:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">System Default</emphasis>: Use the system-wide defaults, which are configured in the Engine database <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-the_engine_configuration_tool">using the engine configuration tool</link> and the <literal>DefaultSerialNumberPolicy</literal> and <literal>DefaultCustomSerialNumber</literal> key names. The default value for <literal>DefaultSerialNumberPolicy</literal> is to use the Host ID. See <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</link> in the <emphasis>Administration Guide</emphasis> for more information.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host ID</emphasis>: Set each virtual machine&#8217;s serial number to the UUID of the host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Vm ID</emphasis>: Set each virtual machine&#8217;s serial number to the UUID of the virtual machine.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Custom serial number</emphasis>: Set each virtual machine&#8217;s serial number to the value you specify in the following <emphasis role="strong">Custom Serial Number</emphasis> parameter.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Updating_the_MoM_Policy_on_Hosts_in_a_Cluster">
<title>Updating the MoM Policy on Hosts in a Cluster</title>
<simpara>The Memory Overcommit Manager handles memory balloon and KSM functions on a host. Changes to these functions for a cluster pass to hosts the next time a host moves to a status of <emphasis role="strong">Up</emphasis> after being rebooted or in maintenance mode. However, if necessary you can apply important changes to a host immediately by synchronizing the MoM policy while the host is <emphasis role="strong">Up</emphasis>. The following procedure must be performed on each host individually.</simpara>
<simpara><emphasis role="strong">Synchronizing MoM Policy on a Host</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosts</emphasis> tab and select the host that requires an updated MoM policy.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Sync MoM Policy</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>The MoM policy on the host is updated without having to move the host to maintenance mode and back <emphasis role="strong">Up</emphasis>.</simpara>
</section>
<section xml:id="Creating_a_CPU_Profile">
<title>Creating a CPU Profile</title>
<simpara>CPU profiles define the maximum amount of processing capability a virtual machine in a cluster can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. CPU profiles are created based on CPU profiles defined under data centers, and are not automatically applied to all virtual machines in a cluster; they must be manually assigned to individual virtual machines for the profile to take effect.</simpara>
<simpara>This procedure assumes you have already defined one or more CPU quality of service entries under the data center to which the cluster belongs.</simpara>
<simpara><emphasis role="strong">Creating a CPU Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">CPU Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and a <emphasis role="strong">Description</emphasis> for the CPU profile.</simpara>
</listitem>
<listitem>
<simpara>Select the quality of service to apply to the CPU profile from the <emphasis role="strong">QoS</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_a_CPU_Profile">
<title>Removing a CPU Profile</title>
<simpara>Remove an existing CPU profile from your oVirt environment.</simpara>
<simpara><emphasis role="strong">Removing a CPU Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">CPU Profiles</emphasis> tab and select the CPU profile to remove.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If the CPU profile was assigned to any virtual machines, those virtual machines are automatically assigned the <literal>default</literal> CPU profile.</simpara>
</section>
<section xml:id="Importing_an_Existing_RHGS_Cluster">
<title>Importing an Existing Gluster Storage Cluster</title>
<simpara>You can import a Gluster Storage cluster and all hosts belonging to the cluster into oVirt Engine.</simpara>
<simpara>When you provide details such as the IP address or host name and password of any host in the cluster, the <literal>gluster peer status</literal> command is executed on that host through SSH, then displays a list of hosts that are a part of the cluster. You must manually verify the fingerprint of each host and provide passwords for them. You will not be able to import the cluster if one of the hosts in the cluster is down or unreachable. As the newly imported hosts do not have VDSM installed, the bootstrap script installs all the necessary VDSM packages on the hosts after they have been imported, and reboots them.</simpara>
<simpara><emphasis role="strong">Importing an Existing Gluster Storage Cluster to the oVirt Engine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> the cluster will belong to.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the cluster.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Enable Gluster Service</emphasis> check box and the <emphasis role="strong">Import existing gluster configuration</emphasis> check box.</simpara>
<simpara>The <emphasis role="strong">Import existing gluster configuration</emphasis> field is only displayed if the <emphasis role="strong">Enable Gluster Service</emphasis> is selected.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Hostname</emphasis> field, enter the host name or IP address of any server in the cluster.</simpara>
<simpara>The host <emphasis role="strong">SSH Fingerprint</emphasis> displays to ensure you are connecting with the correct host. If a host is unreachable or if there is a network error, an error <emphasis role="strong">Error in fetching fingerprint</emphasis> displays in the <emphasis role="strong">Fingerprint</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Password</emphasis> for the server, and click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">Add Hosts</emphasis> window opens, and a list of hosts that are a part of the cluster displays.</simpara>
</listitem>
<listitem>
<simpara>For each host, enter the <emphasis role="strong">Name</emphasis> and the <emphasis role="strong">Root Password</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If you wish to use the same password for all hosts, select the <emphasis role="strong">Use a Common Password</emphasis> check box to enter the password in the provided text field.</simpara>
<simpara>Click <emphasis role="strong">Apply</emphasis> to set the entered password all hosts.</simpara>
<simpara>Verify that the fingerprints are valid and submit your changes by clicking <emphasis role="strong">OK</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>The bootstrap script installs all the necessary VDSM packages on the hosts after they have been imported, and reboots them. You have now successfully imported an existing Gluster Storage cluster into oVirt Engine.</simpara>
</section>
<section xml:id="Explanation_of_Settings_in_the_Add_Hosts_Window">
<title>Explanation of Settings in the Add Hosts Window</title>
<simpara>The <emphasis role="strong">Add Hosts</emphasis> window allows you to specify the details of the hosts imported as part of a Gluster-enabled cluster. This window appears after you have selected the <emphasis role="strong">Enable Gluster Service</emphasis> check box in the <emphasis role="strong">New Cluster</emphasis> window and provided the necessary host details.</simpara>
<table xml:id="Add_Gluster_Hosts" frame="all" rowsep="1" colsep="1">
<title>Add Gluster Hosts Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Use a common password</simpara></entry>
<entry align="left" valign="top"><simpara>Tick this check box to use the same password for all hosts belonging to the cluster. Enter the password in the <emphasis role="strong">Password</emphasis> field, then click the <emphasis role="strong">Apply</emphasis> button to set the password on all hosts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Name</simpara></entry>
<entry align="left" valign="top"><simpara>Enter the name of the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Hostname/IP</simpara></entry>
<entry align="left" valign="top"><simpara>This field is automatically populated with the fully qualified domain name or IP of the host you provided in the <emphasis role="strong">New Cluster</emphasis> window.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Root Password</simpara></entry>
<entry align="left" valign="top"><simpara>Enter a password in this field to use a different root password for each host. This field overrides the common password provided for all hosts in the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Fingerprint</simpara></entry>
<entry align="left" valign="top"><simpara>The host fingerprint is displayed to ensure you are connecting with the correct host. This field is automatically populated with the fingerprint of the host you provided in the <emphasis role="strong">New Cluster</emphasis> window.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Removing_a_cluster">
<title>Removing a Cluster</title>
<simpara>Move all hosts out of a cluster before removing it.</simpara>
<note>
<simpara>You cannot remove the <emphasis role="strong">Default</emphasis> cluster, as it holds the <emphasis role="strong">Blank</emphasis> template. You can, however, rename the <emphasis role="strong">Default</emphasis> cluster and add it to a new data center.</simpara>
</note>
<simpara><emphasis role="strong">Removing a Cluster</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice> and select a cluster.</simpara>
</listitem>
<listitem>
<simpara>Ensure there are no hosts in the cluster.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton></simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="memory_optimization">
<title>Memory Optimization</title>
<simpara>To increase the number of virtual machines on a host, you can use <emphasis>memory overcommitment</emphasis>, in which the memory you assign to virtual machines exceeds RAM and relies on swap space.</simpara>
<simpara>However, there are potential problems with memory overcommitment:</simpara>
<itemizedlist>
<listitem>
<simpara>Swapping performance - Swap space is slower and consumes more CPU resources than RAM, impacting virtual machine performance. Excessive swapping can lead to CPU thrashing.</simpara>
</listitem>
<listitem>
<simpara>Out-of-memory (OOM) killer - If the host runs out of swap space, new processes cannot start, and the kernel&#8217;s OOM killer daemon begins shutting down active processes such as virtual machine guests.</simpara>
</listitem>
</itemizedlist>
<simpara>To help overcome these shortcomings, you can do the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Limit memory overcommitment using the <emphasis role="strong">Memory Optimization</emphasis> setting and the <emphasis>Memory Overcommit Manager (MoM)</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Make the swap space large enough to accommodate the maximum potential demand for virtual memory and have a safety margin remaining.</simpara>
</listitem>
<listitem>
<simpara>Reduce virtual memory size by enabling <emphasis>memory ballooning</emphasis> and <emphasis>Kernel Same-page Merging (KSM)</emphasis>.</simpara>
</listitem>
</itemizedlist>
<section xml:id="_memory_optimization_and_memory_overcommitment">
<title>Memory Optimization and Memory Overcommitment</title>
<simpara>You can limit the amount of memory overcommitment by selecting one of the <emphasis role="strong">Memory Optimization</emphasis> settings: <emphasis role="strong">None</emphasis> (0%), <emphasis role="strong">150%</emphasis>, or <emphasis role="strong">200%</emphasis>.</simpara>
<simpara>Each setting represents a percentage of RAM. For example, with a host that has 64 GB RAM, selecting <emphasis role="strong">150%</emphasis> means you can overcommit memory by an additional 32 GB, for a total of 96 GB in virtual memory. If the host uses 4 GB of that total, the remaining 92 GB are available. You can assign most of that to the virtual machines (<emphasis role="strong">Memory Size</emphasis> on the <emphasis role="strong">System</emphasis> tab), but consider leaving some of it unassigned as a safety margin.</simpara>
<simpara>Sudden spikes in demand for virtual memory can impact performance before the MoM, memory ballooning, and KSM have time to re-optimize virtual memory. To reduce that impact, select a limit that is appropriate for the kinds of applications and workloads you are running:</simpara>
<itemizedlist>
<listitem>
<simpara>For workloads that produce more incremental growth in demand for memory, select a higher percentage, such as <emphasis role="strong">200%</emphasis> or <emphasis role="strong">150%</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For more critical applications or workloads that produce more sudden increases in demand for memory, select a lower percentage, such as <emphasis role="strong">150%</emphasis> or <emphasis role="strong">None</emphasis> (0%). Selecting <emphasis role="strong">None</emphasis> helps prevent memory overcommitment but allows the MoM, memory balloon devices, and KSM to continue optimizing virtual memory.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>Always test your <emphasis role="strong">Memory Optimization</emphasis> settings by stress testing under a wide range of conditions before deploying the configuration to production.</simpara>
</important>
<simpara>To configure the <emphasis role="strong">Memory Optimization</emphasis> setting, click the <emphasis role="strong">Optimization</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> or <emphasis role="strong">Edit Cluster</emphasis> windows. See <xref linkend="Cluster_Optimization_Settings_Explained"/>.</simpara>
<simpara>Additional comments:</simpara>
<itemizedlist>
<listitem>
<simpara>The <link xl:href="https://ovirt.org/documentation/data_warehouse_guide/index#Host_hourly_and_daily_history_views">Host Statistics views</link> display useful historical information for sizing the overcommitment ratio.</simpara>
</listitem>
<listitem>
<simpara>The actual memory available cannot be determined in real time because the amount of memory optimization achieved by KSM and memory ballooning changes continuously.</simpara>
</listitem>
<listitem>
<simpara>When virtual machines reach the virtual memory limit, new apps cannot start.</simpara>
</listitem>
<listitem>
<simpara>When you plan the number of virtual machines to run on a host, use the maximum virtual memory (physical memory size and the <emphasis role="strong">Memory Optimization</emphasis> setting) as a starting point. Do not factor in the smaller virtual memory achieved by memory optimizations such as memory ballooning and KSM.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_swap_space_and_memory_overcommitment">
<title>Swap Space and Memory Overcommitment</title>
<simpara>Red Hat provides <link xl:href="https://access.redhat.com/solutions/15244">these recommendations for configuring swap space</link>.</simpara>
<simpara>When applying these recommendations, follow the guidance to size the swap space as "last effort memory" for a worst-case scenario. Use the physical memory size and <emphasis role="strong">Memory Optimization</emphasis> setting as a basis for estimating the total virtual memory size. Exclude any reduction of the virtual memory size from optimization by the MoM, memory ballooning, and KSM.</simpara>
<important>
<simpara>To help prevent an OOM condition, make the swap space large enough to handle a worst-case scenario and still have a safety margin available. Always stress-test your configuration under a wide range of conditions before deploying it to production.</simpara>
</important>
</section>
<section xml:id="_the_memory_overcommit_manager_mom">
<title>The Memory Overcommit Manager (MoM)</title>
<simpara>The <emphasis>Memory Overcommit Manager (MoM)</emphasis> does two things:</simpara>
<itemizedlist>
<listitem>
<simpara>It limits memory overcommitment by applying the <emphasis role="strong">Memory Optimization</emphasis> setting to the hosts in a cluster, as described in the preceding section.</simpara>
</listitem>
<listitem>
<simpara>It optimizes memory by managing the <emphasis>memory ballooning</emphasis> and <emphasis>KSM</emphasis>, as described in the following sections.</simpara>
</listitem>
</itemizedlist>
<simpara>You do not need to enable or disable MoM.</simpara>
<simpara>When a host&#8217;s free memory drops below 20%, ballooning commands like <literal>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</literal> are logged to <emphasis role="strong">/var/log/vdsm/mom.log</emphasis>, the Memory Overcommit Manager log file.</simpara>
</section>
<section xml:id="_memory_ballooning">
<title>Memory Ballooning</title>
<simpara>Virtual machines start with the full amount of virtual memory you have assigned to them. As virtual memory usage exceeds RAM, the host relies more on swap space. If enabled, <emphasis>memory ballooning</emphasis> lets virtual machines give up the unused portion of that memory. The freed memory can be reused by other processes and virtual machines on the host. The reduced memory footprint makes swapping less likely and improves performance.</simpara>
<simpara>The <emphasis>virtio-balloon</emphasis> package that provides the memory balloon device and drivers ships as a loadable kernel module (LKM). By default, it is configured to load automatically. Blacklisting the module or unloading it disables ballooning.</simpara>
<simpara>The memory balloon devices do not coordinate directly with each other; they rely on the host&#8217;s Memory Overcommit Manager (MoM) process to continuously monitor each virtual machine needs and instruct the balloon device to increase or decrease virtual memory.</simpara>
<simpara>Performance considerations:</simpara>
<itemizedlist>
<listitem>
<simpara>Red Hat does not recommend memory ballooning and overcommitment for workloads that require continuous high-performance and low latency. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</link>.</simpara>
</listitem>
<listitem>
<simpara>Use memory ballooning when increasing virtual machine density (economy) is more important than performance.</simpara>
</listitem>
<listitem>
<simpara>Memory ballooning does not have a significant impact on CPU utilization. (KSM consumes some CPU resources, but consumption remains consistent under pressure.)</simpara>
</listitem>
</itemizedlist>
<simpara>To enable memory ballooning, click the <emphasis role="strong">Optimization</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> or <emphasis role="strong">Edit Cluster</emphasis> windows. Then select the <emphasis role="strong">Enable Memory Balloon Optimization</emphasis> checkbox. This setting enables memory overcommitment on virtual machines running on the hosts in this cluster. When this check box is selected, the MoM starts ballooning where and when possible, with a limitation of the guaranteed memory size of every virtual machine. See <xref linkend="Cluster_Optimization_Settings_Explained"/>.</simpara>
<simpara>Each host in this cluster receives a balloon policy update when its status changes to Up. If necessary, you can manually update the balloon policy on a host without having to change the status. See <xref linkend="Updating_the_MoM_Policy_on_Hosts_in_a_Cluster"/>.</simpara>
</section>
<section xml:id="_kernel_same_page_merging_ksm">
<title>Kernel Same-page Merging (KSM)</title>
<simpara>When a virtual machine runs, it often creates duplicate memory pages for items such as common libraries and high-use data. Furthermore, virtual machines that run similar guest operating systems and applications produce duplicate memory pages in virtual memory.</simpara>
<simpara>When enabled, <emphasis>Kernel Same-page Merging</emphasis> (KSM) examines the virtual memory on a host, eliminates duplicate memory pages, and shares the remaining memory pages across multiple applications and virtual machines. These shared memory pages are marked copy-on-write; if a virtual machine needs to write changes to the page, it makes a copy first before writing its modifications to that copy.</simpara>
<simpara>While KSM is enabled, the MoM manages KSM. You do not need to configure or control KSM manually.</simpara>
<simpara>KSM increases virtual memory performance in two ways. Because a shared memory page is used more frequently, the host is more likely to the store it in cache or main memory, which improves the memory access speed. Additionally, with memory overcommitment, KSM reduces the virtual memory footprint, reducing the likelihood of swapping and improving performance.</simpara>
<simpara>KSM consumes more CPU resources than memory ballooning. The amount of CPU KSM consumes remains consistent under pressure. Running identical virtual machines and applications on a host provides KSM with more opportunities to merge memory pages than running dissimilar ones. If you run mostly dissimilar virtual machines and applications, the CPU cost of using KSM may offset its benefits.</simpara>
<simpara>Performance considerations:</simpara>
<itemizedlist>
<listitem>
<simpara>After the KSM daemon merges large amounts of memory, the kernel memory accounting statistics may eventually contradict each other. If your system has a large amount of free memory, you might improve performance by disabling KSM.</simpara>
</listitem>
<listitem>
<simpara>Red Hat does not recommend KSM and overcommitment for workloads that require continuous high-performance and low latency. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</link>.</simpara>
</listitem>
<listitem>
<simpara>Use KSM when increasing virtual machine density (economy) is more important than performance.</simpara>
</listitem>
</itemizedlist>
<simpara>To enable KSM, click the <emphasis role="strong">Optimization</emphasis> tab in the <emphasis role="strong">New Cluster</emphasis> or <emphasis role="strong">Edit Cluster</emphasis> windows. Then select the <emphasis role="strong">Enable KSM</emphasis> checkbox. This setting enables MoM to run KSM when necessary and when it can yield a memory saving benefit that outweighs its CPU cost. See <xref linkend="Cluster_Optimization_Settings_Explained"/>.</simpara>
</section>
</section>
<section xml:id="About_UEFI_Q35-cluster_opt_settings">
<title>UEFI and the Q35 chipset</title>
<simpara>The Intel Q35 chipset, the default chipset for new virtual machines, includes support for the Unified Extensible Firmware Interface (UEFI), which replaces legacy BIOS.</simpara>
<simpara>Alternatively you can configure a virtual machine or cluster to use the legacy Intel i440fx chipset, which does not support UEFI.</simpara>
<simpara>UEFI provides several advantages over legacy BIOS, including the following:</simpara>
<itemizedlist>
<listitem>
<simpara>A modern boot loader</simpara>
</listitem>
<listitem>
<simpara>SecureBoot, which authenticates the digital signatures of the boot loader</simpara>
</listitem>
<listitem>
<simpara>GUID Partition Table (GPT), which enables disks larger than 2 TB</simpara>
</listitem>
</itemizedlist>
<simpara>To use UEFI on a virtual machine, you must configure the virtual machine’s cluster for 4.4 compatibility or later. Then you can set UEFI for any existing virtual machine, or to be the default BIOS type for new virtual machines in the cluster. The following options are available:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Available BIOS Types</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">BIOS Type</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Q35 Chipset with Legacy BIOS</simpara></entry>
<entry align="left" valign="top"><simpara>Legacy BIOS without UEFI (Default for clusters with compatibility version 4.4)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Q35 Chipset with UEFI BIOS</simpara></entry>
<entry align="left" valign="top"><simpara>BIOS with UEFI</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Q35 Chipset with SecureBoot</simpara></entry>
<entry align="left" valign="top"><simpara>UEFI with SecureBoot, which authenticates the digital signatures of the boot loader</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Legacy</simpara></entry>
<entry align="left" valign="top"><simpara>i440fx chipset with legacy BIOS</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>Set the BIOS Type before installing the operating system</title>
<para>You can configure a virtual machine to use the Q35 chipset and UEFI before installing an operating system. Converting a virtual machine from legacy BIOS to UEFI is not supported after installing an operating system.</para>
</formalpara>
<section xml:id="Configuring_cluster_to_use_Q35_or_UEFI_cluster_opt_settings">
<title>Configuring a cluster to use the Q35 Chipset and UEFI</title>
<simpara>After upgrading a cluster to  oVirt 4.4, all virtual machines in the cluster run the 4.4 version of VDSM. You can configure a cluster’s default BIOS type, which determines the default BIOS type of any new virtual machines you create in that cluster. If necessary, you can override the cluster&#8217;s default BIOS type by specifying a different BIOS type when you create a virtual machine.</simpara>
<formalpara>
<title>Procedure</title>
<para>To configure the default BIOS type for new virtual machines in the cluster:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the VM Portal or the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a cluster and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">General</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Define the default BIOS type for new virtual machines in the cluster by clicking the <emphasis role="strong">BIOS Type</emphasis> dropdown menu, and selecting one of the following:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Legacy</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with Legacy BIOS</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with UEFI BIOS</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with SecureBoot</emphasis></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Compatibility Version</emphasis> dropdown menu select <emphasis role="strong">4.4</emphasis>. The Engine checks that all running hosts are compatible with 4.4, and if they are, the Engine uses 4.4 features.</simpara>
</listitem>
<listitem>
<simpara>If any existing virtual machines in the cluster should use the new BIOS type, configure them to do so.
Any new virtual machines in the cluster that are configured to use the BIOS type <emphasis role="strong">Cluster default</emphasis> now use the BIOS type you selected. For more information, see <link linkend="Configuring_vm_to_use_Q35_or_UEFI_cluster_opt_settings">Configuring a virtual machine to use the Q35 Chipset and UEFI</link>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Because you can change the BIOS type only before installing an operating system, for any existing virtual machines that are configured to use the BIOS type <emphasis role="strong">Cluster default</emphasis>, change the BIOS type to the previous default cluster BIOS type. Otherwise the virtual machine might not boot. Alternatively, you can reinstall the virtual machine&#8217;s operating system.</simpara>
</note>
</section>
<section xml:id="Configuring_vm_to_use_Q35_or_UEFI_cluster_opt_settings">
<title>Configuring a virtual machine to use the Q35 Chipset and UEFI</title>
<simpara>You can configure a virtual machine to use the Q35 chipset and UEFI before installing an operating system. Converting a virtual machine from legacy BIOS to UEFI, or from UEFI to legacy BIOS, might prevent the virtual machine from booting. If you change the BIOS type of an existing virtual machine, reinstall the operating system.</simpara>
<warning>
<simpara>If the virtual machine’s BIOS type is set to <emphasis role="strong">Cluster default</emphasis>, changing the BIOS type of the cluster changes the BIOS type of the virtual machine. If the virtual machine has an operating system installed, changing the cluster BIOS type can cause booting the virtual machine to fail.</simpara>
</warning>
<formalpara>
<title>Procedure</title>
<para>To configure a virtual machine to use the Q35 chipset and UEFI:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the VM Portal or the Administration Portal click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">General</emphasis> tab, click <emphasis role="strong">Show Advanced Options</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>System</guimenu> <guimenuitem>Advanced Parameters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select one of the following from the <emphasis role="strong">BIOS Type</emphasis> dropdown menu:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Cluster default</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with Legacy BIOS</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with UEFI BIOS</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Q35 Chipset with SecureBoot</emphasis></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>From the Virtual Machine portal or the Administration Portal, power off the virtual machine.
The next time you start the virtual machine, it will run with the new BIOS type you selected.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Changing_the_Cluster_Compatibility_Version_admin">
<title>Changing the Cluster Compatibility Version</title>
<simpara>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>To change the cluster compatibility level, you must first update all the hosts in your cluster to a level that supports your desired compatibility level. Check if there is an icon next to the host indicating an update is available.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Limitations</title>
<listitem>
<simpara>Virtio NICs are enumerated as a different device after upgrading the cluster compatibility level to 4.6. Therefore, the NICs might need to be reconfigured. oVirt recommends that you test the virtual machines before you upgrade the cluster by setting the cluster compatibility level to 4.6 on the virtual machine and verifying the network connection.</simpara>
<simpara>If the network connection for the virtual machine fails, configure the virtual machine with a custom emulated machine that matches the current emulated machine, for example pc-q35-rhel8.3.0 for 4.5 compatibility version, before upgrading the cluster.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the cluster to change and click <guibutton>Edit</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>On the <emphasis role="strong">General</emphasis> tab, change the <emphasis role="strong">Compatibility Version</emphasis> to the desired value.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>. The <emphasis role="strong">Change Cluster Compatibility Version</emphasis> confirmation dialog opens.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to confirm.</simpara>
</listitem>
</orderedlist>
<important>
<simpara>An error message might warn that some virtual machines and templates are incorrectly configured. To fix this error, edit each virtual machine manually. The <emphasis role="strong">Edit Virtual Machine</emphasis> window provides additional validations and warnings that show what to correct. Sometimes the issue is automatically corrected and the virtual machine&#8217;s configuration just needs to be saved again. After editing each virtual machine, you will be able to change the cluster compatibility version.</simpara>
</important>
<simpara>After updating a cluster&#8217;s compatibility version, you must update the cluster compatibility version of all running or suspended virtual machines by rebooting them from the Administration Portal, or using the REST API, instead of from within the guest operating system. Virtual machines that require a reboot are marked with the pending changes icon (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/pendingchanges.png"/>
</imageobject>
<textobject><phrase>pendingchanges</phrase></textobject>
</inlinemediaobject>). You cannot change the cluster compatibility version of a virtual machine snapshot that is in preview. You must first commit or undo the preview.</simpara>
<simpara>In a self-hosted engine environment, the Engine virtual machine does not need to be restarted.</simpara>
<simpara>Although you can wait to reboot the virtual machines at a convenient time, rebooting immediately is highly recommended so that the virtual machines use the latest configuration. Virtual machines that have not been updated run with the old configuration, and the new configuration could be overwritten if other changes are made to the virtual machine before the reboot.</simpara>
<simpara>Once you have updated the compatibility version of all clusters and virtual machines in a data center, you can then change the compatibility version of the data center itself.</simpara>
</section>
</section>
</chapter>
<chapter xml:id="chap-Logical_Networks">
<title>Logical Networks</title>
<section xml:id="sect-Logical_Network_Tasks">
<title>Logical Network Tasks</title>
<section xml:id="Performing_Networking_Tasks">
<title>Performing Networking Tasks</title>
<simpara><menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice> provides a central location for users to perform logical network-related operations and search for logical networks based on each network&#8217;s property or association with other resources. The <emphasis role="strong">New</emphasis>, <emphasis role="strong">Edit</emphasis> and <emphasis role="strong">Remove</emphasis> buttons allow you to create, change the properties of, and delete logical networks within data centers.</simpara>
<simpara>Click each network name and use the tabs in the details view to perform functions including:</simpara>
<itemizedlist>
<listitem>
<simpara>Attaching or detaching the networks to clusters and hosts</simpara>
</listitem>
<listitem>
<simpara>Removing network interfaces from virtual machines and templates</simpara>
</listitem>
<listitem>
<simpara>Adding and removing permissions for users to access and manage networks</simpara>
</listitem>
</itemizedlist>
<simpara>These functions are also accessible through each individual resource.</simpara>
<warning>
<simpara>Do not change networking in a data center or a cluster if any hosts are running as this risks making the host unreachable.</simpara>
</warning>
<important>
<simpara>If you plan to use oVirt nodes to provide any services, remember that the services will stop if the oVirt environment stops operating.</simpara>
<simpara>This applies to all services, but you should be especially aware of the hazards of running the following on oVirt:</simpara>
<itemizedlist>
<listitem>
<simpara>Directory Services</simpara>
</listitem>
<listitem>
<simpara>DNS</simpara>
</listitem>
<listitem>
<simpara>Storage</simpara>
</listitem>
</itemizedlist>
</important>
</section>
<section xml:id="Creating_a_new_logical_network_in_a_data_center_or_cluster">
<title>Creating a New Logical Network in a Data Center or Cluster</title>
<simpara>Create a logical network and define its use in a data center, or in clusters in a data center.</simpara>
<simpara><emphasis role="strong">Creating a New Logical Network in a Data Center or Cluster</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> or <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data center or cluster name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Open the <emphasis role="strong">New Logical Network</emphasis> window:</simpara>
<itemizedlist>
<listitem>
<simpara>From a data center details view, click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From a cluster details view, click <emphasis role="strong">Add Network</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis>, <emphasis role="strong">Description</emphasis>, and <emphasis role="strong">Comment</emphasis> for the logical network.</simpara>
</listitem>
<listitem>
<simpara>Optionally, enable <emphasis role="strong">Enable VLAN tagging</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, disable <emphasis role="strong">VM Network</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Create on external provider</emphasis> check box. This disables the <emphasis role="strong">Network Label</emphasis>, <emphasis role="strong">VM Network</emphasis>, and <emphasis role="strong">MTU</emphasis> options. See <xref linkend="chap-External_Providers"/> for details.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">External Provider</emphasis>. The <emphasis role="strong">External Provider</emphasis> list does not include external providers that are in <literal>read-only</literal> mode.</simpara>
<simpara>You can create an internal, isolated network, by selecting <emphasis role="strong">ovirt-provider-ovn</emphasis> on the <emphasis role="strong">External Provider</emphasis> list and leaving <emphasis role="strong">Connect to physical network</emphasis> unselected.</simpara>
</listitem>
<listitem>
<simpara>Enter a new label or select an existing label for the logical network in the <emphasis role="strong">Network Label</emphasis> text field.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">MTU</emphasis>, either select <emphasis role="strong">Default (1500)</emphasis> or select <emphasis role="strong">Custom</emphasis> and specify a custom value.</simpara>
<important>
<simpara>If you change the network’s <emphasis role="strong">MTU</emphasis> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machine’s vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <link xl:href="https://access.redhat.com/solutions/4540631">https://access.redhat.com/solutions/4540631</link> and <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</link>.</simpara>
</important>
</listitem>
<listitem>
<simpara>If you selected <emphasis role="strong">ovirt-provider-ovn</emphasis> from the <emphasis role="strong">External Provider</emphasis> drop-down list, define whether the network should implement <emphasis role="strong">Security Groups</emphasis>. See <xref linkend="Logical_Network_General_Settings_Explained"/> for details.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Cluster</emphasis> tab, select the clusters to which the network will be assigned. You can also specify whether the logical network will be a required network.</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">Create on external provider</emphasis> is selected, the <emphasis role="strong">Subnet</emphasis> tab will be visible. From the <emphasis role="strong">Subnet</emphasis> tab, select the <emphasis role="strong">Create subnet</emphasis> and enter a <emphasis role="strong">Name</emphasis>, <emphasis role="strong">CIDR</emphasis>, and <emphasis role="strong">Gateway</emphasis> address, and select an <emphasis role="strong">IP Version</emphasis> for the subnet that the logical network will provide. You can also add DNS servers as required.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">vNIC Profiles</emphasis> tab, add vNIC profiles to the logical network as required.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If you entered a label for the logical network, it is automatically added to all host network interfaces with that label.</simpara>
<note>
<simpara>When creating a new logical network or making changes to an existing logical network that is used as a display network, any running virtual machines that use that network must be rebooted before the network becomes available or the changes are applied.</simpara>
</note>
</section>
<section xml:id="Editing_a_Logical_Network">
<title>Editing a Logical Network</title>
<important>
<simpara>A logical network cannot be edited or moved to another interface if it is not synchronized with the network configuration on the host. See <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/> on how to synchronize your networks.</simpara>
</important>
<simpara><emphasis role="strong">Editing a Logical Network</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab and select a logical network.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the necessary settings.</simpara>
<note>
<simpara>You can edit the name of a new or existing network, with the exception of the default network, without having to stop the virtual machines.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Multi-host network configuration automatically applies updated network settings to all of the hosts within the data center to which the network is assigned. Changes can only be applied when virtual machines using the network are down. You cannot rename a logical network that is already configured on a host. You cannot disable the <emphasis role="strong">VM Network</emphasis> option while virtual machines or templates using that network are running.</simpara>
</note>
</section>
<section xml:id="Removing_a_Logical_Network">
<title>Removing a Logical Network</title>
<simpara>You can remove a logical network from <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice> or <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>. The following procedure shows you how to remove logical networks associated to a data center. For a working oVirt environment, you must have at least one logical network used as the <emphasis role="strong">ovirtmgmt</emphasis> management network.</simpara>
<simpara><emphasis role="strong">Removing Logical Networks</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a data center&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab to list the logical networks in the data center.</simpara>
</listitem>
<listitem>
<simpara>Select a logical network and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Remove external network(s) from the provider(s) as well</emphasis> check box to remove the logical network both from the Engine and from the external provider if the network is provided by an external provider. The check box is grayed out if the external provider is in read-only mode.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The logical network is removed from the Engine and is no longer available.</simpara>
</section>
<section xml:id="Configuring_a_Default_Route">
<title>Configuring a Non-Management Logical Network as the Default Route</title>
<simpara>The default route used by hosts in a cluster is through the management network (<literal>ovirtmgmt</literal>). The following procedure provides instructions to configure a non-management logical network as the default route.</simpara>
<simpara><emphasis role="strong">Prerequisite:</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>If you are using the <literal>default_route</literal> custom property, you need to clear the custom property from all attached hosts and then follow this procedure.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Configuring the Default Route Role</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the name of the non-management logical network to configure as the default route to access its details.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Clusters</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Network</emphasis>. This opens the <emphasis role="strong">Manage Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Default Route</emphasis> checkbox for the appropriate cluster(s).</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>When networks are attached to a host, the default route of the host will be set on the network of your choice. It is recommended to configure the default route role before any host is added to your cluster. If your cluster already contains hosts, they may become out-of-sync until you sync your change to them.</simpara>
<itemizedlist>
<title>Important Limitations with IPv6</title>
<listitem>
<simpara>For IPv6, oVirt supports only static addressing.</simpara>
</listitem>
<listitem>
<simpara>If both networks share a single gateway (are on the same subnet), you can move the default route role from the management network (ovirtmgmt) to another logical network.</simpara>
</listitem>
<listitem>
<simpara>If the host and Engine are not on the same subnet, the Engine loses connectivity with the host because the IPv6 gateway has been removed.</simpara>
</listitem>
<listitem>
<simpara>Moving the default route role to a non-management network removes the IPv6 gateway from the network interface and generates an alert: "On cluster <emphasis>clustername</emphasis> the 'Default Route Role' network is no longer network ovirtmgmt. The IPv6 gateway is being removed from this network."</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="proc-Adding-a-static-route-on-a-host">
<title>Adding a static route on a host</title>
<simpara>You can use nmstate to add static routes to hosts. This method requires you to configure the hosts directly, without using oVirt Engine.</simpara>
<simpara>Static-routes you add are preserved as long as the related routed bridge, interface, or bond exists and has an IP address. Otherwise, the system removes the static route.</simpara>
<important>
<simpara>Except for adding or removing a static route on a host, always use the oVirt Engine to configure host network settings in your cluster. For details, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</link>.</simpara>
</important>
<note>
<simpara>The custom static-route is preserved so long as its interface/bond exists and has an IP address. Otherwise, it will be removed.</simpara>
<simpara>As a result, VM networks behave differently from non-VM networks:</simpara>
<itemizedlist>
<listitem>
<simpara>VM networks are based on a bridge. Moving the network from one interfaces/bond to another does not affect the route on a VM Network.</simpara>
</listitem>
<listitem>
<simpara>Non-VM networks are based on an interface. Moving the network from one interfaces/bond to another deletes the route related to the Non-VM network.</simpara>
</listitem>
</itemizedlist>
</note>
<formalpara>
<title>Prerequisites</title>
<para>This procedure requires nmstate, which is only available if your environment uses:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>oVirt Engine version 4.4</simpara>
</listitem>
<listitem>
<simpara>Enterprise Linux hosts and oVirt Nodes that are based on Enterprise Linux 8</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Connect to the host you want to configure.</simpara>
</listitem>
<listitem>
<simpara>On the host, create a <literal>static_route.yml</literal> file, with the following example content:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">routes:
  config:
  - destination: 192.168.123.0/24
    next-hop-address: 192.168.178.1
    next-hop-interface: eth1</programlisting>
</listitem>
<listitem>
<simpara>Replace the example values shown with real values for your network.</simpara>
</listitem>
<listitem>
<simpara>To route your traffic to a secondary added network, use <literal>next-hop-interface</literal> to specify an interface or network name.</simpara>
<itemizedlist>
<listitem>
<simpara>To use a non-virtual machine network, specify an interface such as <literal>eth1</literal>.</simpara>
</listitem>
<listitem>
<simpara>To use a virtual machine network, specify a network name that is also the bridge name such as <literal>net1</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Run this command:</simpara>
<screen>$ nmstatectl set static_route.yml</screen>
</listitem>
</orderedlist>
<itemizedlist>
<title>Verification steps</title>
<listitem>
<simpara>Run the IP route command, <literal>ip route</literal>, with the destination parameter value you set in <literal>static_route.yml</literal>. This should show the desired route. For example, run the following command:</simpara>
<screen>$ ip route | grep 192.168.123.0`</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#proc-Removing-a-static-route-on-a-host">Removing a static route on a host</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="proc-Removing-a-static-route-on-a-host">
<title>Removing a static route on a host</title>
<simpara>You can use nmstate to remove static routes from hosts. This method requires you to configure the hosts directly, without using oVirt Engine.</simpara>
<important>
<simpara>Except for adding or removing a static route on a host, always use the oVirt Engine to configure host network settings in your cluster. For details, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</link>.</simpara>
</important>
<note>
<simpara>The custom static-route is preserved so long as its interface/bond exists and has an IP address. Otherwise, it will be removed.</simpara>
<simpara>As a result, VM networks behave differently from non-VM networks:</simpara>
<itemizedlist>
<listitem>
<simpara>VM networks are based on a bridge. Moving the network from one interfaces/bond to another does not affect the route on a VM Network.</simpara>
</listitem>
<listitem>
<simpara>Non-VM networks are based on an interface. Moving the network from one interfaces/bond to another deletes the route related to the Non-VM network.</simpara>
</listitem>
</itemizedlist>
</note>
<formalpara>
<title>Prerequisites</title>
<para>This procedure requires nmstate, which is only available if your environment uses:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>oVirt Engine version 4.4</simpara>
</listitem>
<listitem>
<simpara>Enterprise Linux hosts and oVirt Nodes that are based on Enterprise Linux 8</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Connect to the host you want to reconfigure.</simpara>
</listitem>
<listitem>
<simpara>On the host, edit the <literal>static_route.yml</literal> file.</simpara>
</listitem>
<listitem>
<simpara>Insert a line <literal>state: absent</literal> as shown in the following example.</simpara>
</listitem>
<listitem>
<simpara>Add the value of <literal>next-hop-interface</literal> between the brackets of <literal>interfaces: []</literal>. The result should look similar to the example shown here.</simpara>
<programlisting language="yaml" linenumbering="unnumbered">routes:
  config:
  - destination: 192.168.123.0/24
    next-hop-address: 192.168.178.
    next-hop-interface: eth1
    state: absent
interfaces: [{“name”: eth1}]</programlisting>
</listitem>
<listitem>
<simpara>Run this command:</simpara>
<screen>$ nmstatectl set static_route.yml</screen>
</listitem>
</orderedlist>
<itemizedlist>
<title>Verification steps</title>
<listitem>
<simpara>Run the IP route command, <literal>ip route</literal>, with the destination parameter value you set in <literal>static_route.yml</literal>. This should no longer show the desired route. For example, run the following command:</simpara>
<screen>$ ip route | grep 192.168.123.0`</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#proc-Adding-a-static-route-on-a-host">Adding a static route on a host</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Viewing_or_Editing_the_Gateway">
<title>Viewing or Editing the Gateway for a Logical Network</title>
<simpara>Users can define the gateway, along with the IP address and subnet mask, for a logical network. This is necessary when multiple networks exist on a host and traffic should be routed through the specified network, rather than the default gateway.</simpara>
<simpara>If multiple networks exist on a host and the gateways are not defined, return traffic will be routed through the default gateway, which may not reach the intended destination. This would result in users being unable to ping the host.</simpara>
<simpara>oVirt handles multiple gateways automatically whenever an interface goes up or down.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab to list the network interfaces attached to the host, and their configurations.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Hover your cursor over an assigned logical network and click the pencil icon. This opens the <emphasis role="strong">Edit Management Network</emphasis> window.</simpara>
</listitem>
</orderedlist>
<simpara>The <emphasis role="strong">Edit Management Network</emphasis> window displays the network name, the boot protocol, and the IP, subnet mask, and gateway addresses. The address information can be manually edited by selecting a <emphasis role="strong">Static</emphasis> boot protocol.</simpara>
</section>
<section xml:id="Logical_Network_General_Settings_Explained">
<title>Logical Network General Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">General</emphasis> tab of the <emphasis role="strong">New Logical Network</emphasis> and <emphasis role="strong">Edit Logical Network</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">New Logical Network</emphasis> and <emphasis role="strong">Edit Logical Network</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the logical network. This text field must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</simpara><simpara>Note that while the name of the logical network can be longer than 15 characters and can contain non-ASCII characters, the on-host identifier (<emphasis>vdsm_name</emphasis>) will differ from the name you defined. See <link linkend="Vdsm_To_Network_Mapping_Tool">Mapping VDSM Names to Logical Network Names</link> for instructions on displaying a mapping of these names.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The description of the logical network. This text field has a 40-character limit.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Comment</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A field for adding plain text, human-readable comments regarding the logical network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Create on external provider</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to create the logical network to an OpenStack Networking instance that has been added to the Engine as an external provider.</simpara><simpara><emphasis role="strong">External Provider</emphasis> - Allows you to select the external provider on which the logical network will be created.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable VLAN tagging</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>VLAN tagging is a security feature that gives all network traffic carried on the logical network a special characteristic. VLAN-tagged traffic cannot be read by interfaces that do not also have that characteristic. Use of VLANs on logical networks also allows a single network interface to be associated with multiple, differently VLAN-tagged logical networks. Enter a numeric value in the text entry field if VLAN tagging is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">VM Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this option if only virtual machines use this network. If the network is used for traffic that does not involve virtual machines, such as storage communications, do not select this check box.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Port Isolation</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If this is set, virtual machines on the same host are prevented from communicating and seeing each other on this logical network. For this option to work on different hypervisors, the switches need to be configured with PVLAN/Port Isolation on the respective port/VLAN connected to the hypervisors, and not reflect back the frames with any hairpin setting.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">MTU</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Choose either <emphasis role="strong">Default</emphasis>, which sets the maximum transmission unit (MTU) to the value given in the parenthesis (), or <emphasis role="strong">Custom</emphasis> to set a custom MTU for the logical network. You can use this to match the MTU supported by your new logical network to the MTU supported by the hardware it interfaces with. Enter a numeric value in the text entry field if <emphasis role="strong">Custom</emphasis> is selected.
<emphasis role="strong">IMPORTANT</emphasis>: If you change the network’s <emphasis role="strong">MTU</emphasis> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machine’s vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <link xl:href="https://access.redhat.com/solutions/4540631">https://access.redhat.com/solutions/4540631</link> and <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</link>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Network Label</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to specify a new label for the network or select from existing labels already attached to host network interfaces. If you select an existing label, the logical network will be automatically assigned to all host network interfaces with that label.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Security Groups</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to assign security groups to the ports on this logical network.
<literal>Disabled</literal> disables the security group feature.
<literal>Enabled</literal> enables the feature. When a port is created and attached to this network, it will be defined with port security enabled. This means that access to/from the virtual machines will be subject to the security groups currently being provisioned.
 <literal>Inherit from Configuration</literal> enables the ports to inherit the behavior from the configuration file that is defined for all networks. By default, the file disables security groups.
 See <xref linkend="Assigning_Security_Groups_to_Logical_Networks"/> for details.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Logical_Network_Cluster_Settings_Explained">
<title>Logical Network Cluster Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">Cluster</emphasis> tab of the <emphasis role="strong">New Logical Network</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">New Logical Network</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Attach/Detach Network to/from Cluster(s)</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to attach or detach the logical network from clusters in the data center and specify whether the logical network will be a required network for individual clusters.</simpara><simpara><emphasis role="strong">Name</emphasis> - the name of the cluster to which the settings will apply. This value cannot be edited.</simpara><simpara><emphasis role="strong">Attach All</emphasis> - Allows you to attach or detach the logical network to or from all clusters in the data center. Alternatively, select or clear the <emphasis role="strong">Attach</emphasis> check box next to the name of each cluster to attach or detach the logical network to or from a given cluster.</simpara><simpara><emphasis role="strong">Required All</emphasis> - Allows you to specify whether the logical network is a required network on all clusters. Alternatively, select or clear the <emphasis role="strong">Required</emphasis> check box next to the name of each cluster to specify whether the logical network is a required network for a given cluster.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Logical_Network_vNIC_Profiles_Settings_Explained">
<title>Logical Network vNIC Profiles Settings Explained</title>
<simpara>The table below describes the settings for the <emphasis role="strong">vNIC Profiles</emphasis> tab of the <emphasis role="strong">New Logical Network</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">New Logical Network</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">vNIC Profiles</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to specify one or more vNIC profiles for the logical network. You can add or remove a vNIC profile to or from the logical network by clicking the plus or minus button next to the vNIC profile. The first field is for entering a name for the vNIC profile.</simpara><simpara><emphasis role="strong">Public</emphasis> - Allows you to specify whether the profile is available to all users.</simpara><simpara><emphasis role="strong">QoS</emphasis> - Allows you to specify a network quality of service (QoS) profile to the vNIC profile.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Designate_a_Specific_Traffic_Type">
<title>Designate a Specific Traffic Type for a Logical Network with the Manage Networks Window</title>
<simpara>Specify the traffic type for the logical network to optimize the network traffic flow.</simpara>
<simpara><emphasis role="strong">Specifying Traffic Types for Logical Networks</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate check boxes and radio buttons.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Logical networks offered by external providers must be used as virtual machine networks; they cannot be assigned special cluster roles such as display or migration.</simpara>
</note>
</section>
<section xml:id="Explanation_of_Settings_in_the_Manage_Networks_Window">
<title>Explanation of Settings in the Manage Networks Window</title>
<simpara>The table below describes the settings for the <emphasis role="strong">Manage Networks</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Manage Networks Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field</entry>
<entry align="left" valign="top">Description/Action</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Assign</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Assigns the logical network to all hosts in the cluster.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Required</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A Network marked "required" must remain operational in order for the hosts associated with it to function properly. If a required network ceases to function, any hosts associated with it become non-operational.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">VM Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A logical network marked "VM Network" carries network traffic relevant to the virtual machine network.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Display Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A logical network marked "Display Network" carries network traffic relevant to SPICE and to the virtual network controller.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migration Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A logical network marked "Migration Network" carries virtual machine and storage migration traffic. If an outage occurs on this network, the management network (<emphasis role="strong">ovirtmgmt</emphasis> by default) will be used instead.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Editing_VFs_on_NIC">
<title>Configuring virtual functions on a NIC</title>
<note>
<simpara>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</link></simpara>
</note>
<simpara>Single Root I/O Virtualization (SR-IOV) enables you to use each PCIe endpoint as multiple separate devices by using physical functions (PFs) and virtual functions (VFs). A PCIe card can have between one and eight PFs. Each PF can have many VFs. The number of VFs it can have depends on the specific type of PCIe device.</simpara>
<simpara>To configure SR-IOV-capable Network Interface Controllers (NICs), you use the oVirt Engine.  There, you can configure the number of VFs on each NIC.</simpara>
<simpara>You can configure a VF like you would configure a standalone NIC, including:</simpara>
<itemizedlist>
<listitem>
<simpara>Assigning one or more logical networks to the VF.</simpara>
</listitem>
<listitem>
<simpara>Creating bonded interfaces with VFs.</simpara>
</listitem>
<listitem>
<simpara>Assigning vNICs to VFs for direct device passthrough.</simpara>
</listitem>
</itemizedlist>
<simpara>By default, all virtual networks have access to the virtual functions. You can disable this default and specify which networks have access to a virtual function.</simpara>
<itemizedlist>
<title>Prerequisite</title>
<listitem>
<simpara>For a vNIC to be attached to a VF must, its passthrough property must be enabled. For details, see <xref linkend="Enabling_Passthrough_on_a_vNIC_Profile"/>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the name of an SR-IOV-capable host. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select an SR-IOV-capable NIC, marked with a <inlinemediaobject>
<imageobject>
<imagedata fileref="images/SR-IOV-icon.png"/>
</imageobject>
<textobject><phrase>SR IOV icon</phrase></textobject>
</inlinemediaobject>
, and click the pencil icon.</simpara>
</listitem>
<listitem>
<simpara>Optional: To change the number of virtual functions, click the <emphasis role="strong">Number of VFs setting</emphasis> drop-down button and edit the <emphasis role="strong">Number of VFs</emphasis> text field.</simpara>
<important>
<simpara>Changing the number of VFs deletes all previous VFs on the network interface before creating the new VFs. This includes any VFs that have virtual machines directly attached.</simpara>
</important>
</listitem>
<listitem>
<simpara>Optional: To limit which virtual networks have access virtual functions, select <emphasis role="strong">Specific networks</emphasis>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Select the networks that should have access to the VF, or use <emphasis role="strong">Labels</emphasis> to select networks based on their network labels.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Setup Host Networks</emphasis> window, click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Virtual_Network_Interface_Cards">
<title>Virtual Network Interface Cards (vNICs)</title>
<section xml:id="VNIC_Profile_Overview">
<title>vNIC Profile Overview</title>
<simpara>A Virtual Network Interface Card (vNIC) profile is a collection of settings that can be applied to individual virtual network interface cards in the Engine. A vNIC profile allows you to apply Network QoS profiles to a vNIC, enable or disable port mirroring, and add or remove custom properties. A vNIC profile also offers an added layer of administrative flexibility in that permission to use (consume) these profiles can be granted to specific users. In this way, you can control the quality of service that different users receive from a given network.</simpara>
</section>
<section xml:id="Creating_a_VNIC_Profile">
<title>Creating or Editing a vNIC Profile</title>
<simpara>Create or edit a Virtual Network Interface Controller (vNIC) profile to regulate network bandwidth for users and groups.</simpara>
<note>
<simpara>If you are enabling or disabling port mirroring, all virtual machines using the associated profile must be in a down state before editing.</simpara>
</note>
<simpara><emphasis role="strong">Creating or Editing a vNIC Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">vNIC Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis> or <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the profile.</simpara>
</listitem>
<listitem>
<simpara>Select the relevant Quality of Service policy from the <emphasis role="strong">QoS</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Network Filter</emphasis> from the drop-down list to manage the traffic of network packets to and from virtual machines. For more information on network filters, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Virtualization_Deployment_and_Administration_Guide/index.html#sect-Virtual_Networking-Applying_network_filtering">Applying network filtering</link> in the <emphasis>Enterprise Linux Virtualization Deployment and Administration Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Passthrough</emphasis> check box to enable passthrough of the vNIC and allow direct device assignment of a virtual function. Enabling the passthrough property will disable QoS, network filtering, and port mirroring as these are not compatible. For more information on passthrough, see <xref linkend="Enabling_Passthrough_on_a_vNIC_Profile"/>.</simpara>
</listitem>
<listitem>
<simpara>If <emphasis role="strong">Passthrough</emphasis> is selected, optionally deselect the <emphasis role="strong">Migratable</emphasis> check box to disable migration for vNICs using this profile. If you keep this check box selected, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Live_migration_prerequisites">Additional Prerequisites for Virtual Machines with SR-IOV-Enabled vNICs</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Port Mirroring</emphasis> and <emphasis role="strong">Allow all users to use this Profile</emphasis> check boxes to toggle these options.</simpara>
</listitem>
<listitem>
<simpara>Select a custom property from the custom properties list, which displays <emphasis role="strong">Please select a key&#8230;&#8203;</emphasis> by default. Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to add or remove custom properties.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Apply this profile to users and groups to regulate their network bandwidth. If you edited a vNIC profile, you must either restart the virtual machine, or hot unplug and then hot plug the vNIC if the guest operating system supports vNIC hot plug and hot unplug.</simpara>
</section>
<section xml:id="Explanation_of_Settings_in_the_VM_Interface_Profile_Window">
<title>Explanation of Settings in the VM Interface Profile Window</title>
<table frame="all" rowsep="1" colsep="1">
<title>VM Interface Profile Window</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Network</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A drop-down list of the available networks to apply the vNIC profile to.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the vNIC profile. This must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores between 1 and 50 characters.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The description of the vNIC profile. This field is recommended but not mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">QoS</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A drop-down list of the available Network Quality of Service policies to apply to the vNIC profile. QoS policies regulate inbound and outbound network traffic of the vNIC.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Network Filter</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A drop-down list of the available network filters to apply to the vNIC profile. Network filters improve network security by filtering the type of packets that can be sent to and from virtual machines. The default filter is <literal>vdsm-no-mac-spoofing</literal>, which is a combination of <literal>no-mac-spoofing</literal> and <literal>no-arp-mac-spoofing</literal>. For more information on the network filters provided by libvirt, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Virtual_Networking-Applying_network_filtering.html#sect-Applying_network_filtering-Advanced_Filter_Configuration_Topics">Pre-existing network filters</link> section of the <emphasis>Enterprise Linux Virtualization Deployment and Administration Guide</emphasis>.</simpara>
<simpara>Use <literal>&lt;No Network Filter&gt;</literal> for virtual machine VLANs and bonds. On trusted virtual machines, choosing not to use a network filter can improve performance.</simpara>
<note>
<simpara>Red Hat no longer supports disabling filters by setting the <literal>EnableMACAntiSpoofingFilterRules</literal> parameter to <literal>false</literal> using the <literal>engine-config</literal> tool. Use the <literal>&lt;No Network Filter&gt;</literal> option instead.</simpara>
</note></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Passthrough</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A check box to toggle the passthrough property. Passthrough allows a vNIC to connect directly to a virtual function of a host NIC. The passthrough property cannot be edited if the vNIC profile is attached to a virtual machine.</simpara><simpara>QoS, network filters, and port mirroring are disabled in the vNIC profile if passthrough is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migratable</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A check box to toggle whether or not vNICs using this profile can be migrated. Migration is enabled by default on regular vNIC profiles; the check box is selected and cannot be changed. When the <emphasis role="strong">Passthrough</emphasis> check box is selected, <emphasis role="strong">Migratable</emphasis> becomes available and can be deselected, if required, to disable migration of passthrough vNICs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Failover</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A drop-down menu to select available vNIC profiles that act as a failover device. Available only when the <emphasis role="strong">Passthrough</emphasis> and <emphasis role="strong">Migratable</emphasis> check boxes are checked.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Port Mirroring</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A check box to toggle port mirroring. Port mirroring copies layer 3 network traffic on the logical network to a virtual interface on a virtual machine. It it not selected by default. For further details, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/#Port_Mirroring">Port Mirroring</link> in the <emphasis>Technical Reference</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Device Custom Properties</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A drop-down menu to select available custom properties to apply to the vNIC profile. Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to add and remove properties respectively.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Allow all users to use this Profile</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A check box to toggle the availability of the profile to all users in the environment. It is selected by default.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Enabling_Passthrough_on_a_vNIC_Profile">
<title>Enabling Passthrough on a vNIC Profile</title>
<note>
<simpara>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</link></simpara>
</note>
<simpara>The passthrough property of a vNIC profile enables a vNIC to be directly connected to a virtual function (VF) of an SR-IOV-enabled NIC. The vNIC will then bypass the software network virtualization and connect directly to the VF for direct device assignment.</simpara>
<simpara>The passthrough property cannot be enabled if the vNIC profile is already attached to a vNIC; this procedure creates a new profile to avoid this. If a vNIC profile has passthrough enabled, QoS, network filters, and port mirroring cannot be enabled on the same profile.</simpara>
<simpara>For more information on SR-IOV, direct device assignment, and the hardware considerations for implementing these in oVirt, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Hardware Considerations for Implementing SR-IOV</link>.</simpara>
<simpara><emphasis role="strong">Enabling Passthrough</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">vNIC Profiles</emphasis> tab to list all vNIC profiles for that logical network.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the profile.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Passthrough</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Optionally deselect the <emphasis role="strong">Migratable</emphasis> check box to disable migration for vNICs using this profile. If you keep this check box selected, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Live_migration_prerequisites">Additional Prerequisites for Virtual Machines with SR-IOV-Enabled vNICs</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>If necessary, select a custom property from the custom properties list, which displays <emphasis role="strong">Please select a key&#8230;&#8203;</emphasis> by default. Use the <emphasis role="strong">+</emphasis> and <emphasis role="strong">-</emphasis> buttons to add or remove custom properties.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The vNIC profile is now passthrough-capable. To use this profile to directly attach a virtual machine to a NIC or PCI VF, attach the logical network to the NIC and create a new <emphasis role="strong">PCI Passthrough</emphasis> vNIC on the desired virtual machine that uses the passthrough vNIC profile. For more information on these procedures respectively, see <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/>, and <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Adding_a_Network_Interface">Adding a New Network Interface</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</section>
<section xml:id="Creating_vNIC_profile_SR_IOV_failover">
<title>Enabling a vNIC profile for SR-IOV migration with failover</title>
<simpara>Failover allows the selection of a profile that acts as a failover device during virtual machine migration when the VF needs to be detached, preserving virtual machine communication with minimal interruption.</simpara>
<note>
<simpara>Failover is a Technology Preview feature only.
Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</link>.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The <emphasis role="strong">Passthrough</emphasis> and <emphasis role="strong">Migratable</emphasis> check boxes of the profile are selected.</simpara>
</listitem>
<listitem>
<simpara>The failover network is attached to the host.</simpara>
</listitem>
<listitem>
<simpara>In order to make a vNIC profile acting as failover editable, you must first remove any failover references.</simpara>
</listitem>
<listitem>
<simpara>vNIC profiles that can act as failover are profiles that are not selected as <emphasis role="strong">Passthrough</emphasis> or are not connected to an External Network.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, go to <menuchoice><guimenu>Network</guimenu> <guimenuitem>VNIC profiles</guimenuitem></menuchoice>, select the vNIC profile, click <guibutton>Edit</guibutton> and select a <literal>Failover vNIC profile</literal> from the drop down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to save the profile settings.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Attaching two vNIC profiles that reference the same failover vNIC profile to the same virtual machine will fail in libvirt.</simpara>
</note>
</section>
<section xml:id="Removing_a_VNIC_Profile">
<title>Removing a vNIC Profile</title>
<simpara>Remove a vNIC profile to delete it from your virtualized environment.</simpara>
<simpara><emphasis role="strong">Removing a vNIC Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">vNIC Profiles</emphasis> tab to display available vNIC profiles.</simpara>
</listitem>
<listitem>
<simpara>Select one or more profiles and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Assigning_Security_Groups_to_VNIC_Profiles">
<title>Assigning Security Groups to vNIC Profiles</title>
<note>
<simpara>This feature is only available when <literal>ovirt-provider-ovn</literal> is added as an external network provider. Security groups cannot be created through the oVirt Engine. You must create security groups through OpenStack Networking on the <literal>ovirt-provider-ovn</literal>. For more information, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/10/html-single/users_and_identity_management_guide/index#project-security">Project Security Management</link> in the <emphasis>Red Hat OpenStack Platform Users and Identity Management Guide</emphasis>.</simpara>
</note>
<simpara>You can assign security groups to the vNIC profile of networks that have been imported from an OpenStack Networking instance and that use the Open vSwitch plug-in. A security group is a collection of strictly enforced rules that allow you to filter inbound and outbound traffic over a network interface. The following procedure outlines how to attach a security group to a vNIC profile.</simpara>
<note>
<simpara>A security group is identified using the ID of that security group as registered in the Open Virtual Network (OVN) External Network Provider. You can find the IDs of security groups for a given tenant using the OpenStack Networking API, see <link xl:href="https://docs.openstack.org/api-ref/network/v2/index.html?expanded=#list-security-groups">List Security Groups</link> in the <emphasis>OpenStack API Reference</emphasis>.</simpara>
</note>
<simpara><emphasis role="strong">Assigning Security Groups to vNIC Profiles</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">vNIC Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>, or select an existing vNIC profile and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the custom properties drop-down list, select <emphasis role="strong">SecurityGroups</emphasis>. Leaving the custom property drop-down blank applies the default security settings, which permit all outbound traffic and intercommunication but deny all inbound traffic from outside of the default security group. Note that removing the <emphasis role="strong">SecurityGroups</emphasis> property later will not affect the applied security group.</simpara>
</listitem>
<listitem>
<simpara>In the text field, enter the ID of the security group to attach to the vNIC profile.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You have attached a security group to the vNIC profile. All traffic through the logical network to which that profile is attached will be filtered in accordance with the rules defined for that security group.</simpara>
</section>
<section xml:id="User_Permissions_for_VNIC_Profiles">
<title>User Permissions for vNIC Profiles</title>
<simpara>Configure user permissions to assign users to certain vNIC profiles. Assign the <emphasis role="strong">VnicProfileUser</emphasis> role to a user to enable them to use the profile. Restrict users from certain profiles by removing their permission for that profile.</simpara>
<simpara><emphasis role="strong">User Permissions for vNIC Profiles</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>vNIC Profile</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the vNIC profile&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Permissions</emphasis> tab to show the current user permissions for the profile.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> or <emphasis role="strong">Remove</emphasis> to change user permissions for the vNIC profile.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Add Permissions to User</emphasis> window, click <emphasis role="strong">My Groups</emphasis> to display your user groups. You can use this option to grant permissions to other users in your groups.</simpara>
</listitem>
</orderedlist>
<simpara>You have configured user permissions for a vNIC profile.</simpara>
</section>
<section xml:id="Configuring_VNIC_Profiles_for_UCS">
<title>Configuring vNIC Profiles for UCS Integration</title>
<simpara>Cisco&#8217;s Unified Computing System (UCS) is used to manage data center aspects such as computing, networking and storage resources.</simpara>
<simpara>The <literal>vdsm-hook-vmfex-dev</literal> hook allows virtual machines to connect to Cisco&#8217;s UCS-defined port profiles by configuring the vNIC profile. The UCS-defined port profiles contain the properties and settings used to configure virtual interfaces in UCS. The <literal>vdsm-hook-vmfex-dev</literal> hook is installed by default with VDSM. See <xref linkend="appe-VDSM_and_Hooks"/> for more information.</simpara>
<simpara>When a virtual machine that uses the vNIC profile is created, it will use the Cisco vNIC.</simpara>
<simpara>The procedure to configure the vNIC profile for UCS integration involves first configuring a custom device property. When configuring the custom device property, any existing value it contained is overwritten. When combining new and existing custom properties, include all of the custom properties in the command used to set the key&#8217;s value. Multiple custom properties are separated by a semi-colon.</simpara>
<note>
<simpara>A UCS port profile must be configured in Cisco UCS before configuring the vNIC profile.</simpara>
</note>
<simpara><emphasis role="strong">Configuring the Custom Device Property</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, configure the <literal>vmfex</literal> custom property and set the cluster compatibility level using <literal>--cver</literal>.</simpara>
<screen># engine-config -s CustomDeviceProperties='{type=interface;prop={vmfex=^[a-zA-Z0-9_.-]{2,32}$}}' --cver=4.4</screen>
</listitem>
<listitem>
<simpara>Verify that the <literal>vmfex</literal> custom device property was added.</simpara>
<screen># engine-config -g CustomDeviceProperties</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
<simpara>The vNIC profile to configure can belong to a new or existing logical network. See <xref linkend="Creating_a_new_logical_network_in_a_data_center_or_cluster"/> for instructions to configure a new logical network.</simpara>
<simpara><emphasis role="strong">Configuring a vNIC Profile for UCS Integration</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">vNIC Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>, or select a vNIC profile and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> of the profile.</simpara>
</listitem>
<listitem>
<simpara>Select the <literal>vmfex</literal> custom property from the custom properties list and enter the UCS port profile name.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-External_Provider_Networks">
<title>External Provider Networks</title>
<section xml:id="Importing_Networks">
<title>Importing Networks From External Providers</title>
<simpara>To use networks from an Open Virtual Network (OVN), register the provider with the Engine. See <link linkend="Adding_an_External_Network_Provider">Adding an External Network Provider</link> for more information. Then, use the following procedure to import the networks provided by that provider into the Engine so the networks can be used by virtual machines.</simpara>
<simpara><emphasis role="strong">Importing a Network From an External Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Network Provider</emphasis> drop-down list, select an external provider. The networks offered by that provider are automatically discovered and listed in the <emphasis role="strong">Provider Networks</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Using the check boxes, select the networks to import in the <emphasis role="strong">Provider Networks</emphasis> list and click the down arrow to move those networks into the <emphasis role="strong">Networks to Import</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>You can customize the name of the network that you are importing. To customize the name, click the network&#8217;s name in the <emphasis role="strong">Name</emphasis> column, and change the text.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Data Center</emphasis> drop-down list, select the data center into which the networks will be imported.</simpara>
</listitem>
<listitem>
<simpara>Optional: Clear the <emphasis role="strong">Allow All</emphasis> check box to prevent that network from being available to all users.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>The selected networks are imported into the target data center and can be attached to virtual machines. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Adding_a_Network_Interface">Adding a New Network Interface</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for more information.</simpara>
</section>
<section xml:id="Limitations_to_Importing_Networks_from_External_Providers">
<title>Limitations to Using External Provider Networks</title>
<simpara>The following limitations apply to using logical networks imported from an external provider in a oVirt environment.</simpara>
<itemizedlist>
<listitem>
<simpara>Logical networks offered by external providers must be used as virtual machine networks, and cannot be used as display networks.</simpara>
</listitem>
<listitem>
<simpara>The same logical network can be imported more than once, but only to different data centers.</simpara>
</listitem>
<listitem>
<simpara>You cannot edit logical networks offered by external providers in the Engine. To edit the details of a logical network offered by an external provider, you must edit the logical network directly from the external provider that provides that logical network.</simpara>
</listitem>
<listitem>
<simpara>Port mirroring is not available for virtual network interface cards connected to logical networks offered by external providers.</simpara>
</listitem>
<listitem>
<simpara>If a virtual machine uses a logical network offered by an external provider, that provider cannot be deleted from the Engine while the logical network is still in use by the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Networks offered by external providers are non-required. As such, scheduling for clusters in which such logical networks have been imported will not take those logical networks into account during host selection. Moreover, it is the responsibility of the user to ensure the availability of the logical network on hosts in clusters in which such logical networks have been imported.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Configuring_Subnets_on_External_Provider_Logical_Networks">
<title>Configuring Subnets on External Provider Logical Networks</title>
<simpara>A logical network provided by an external provider can only assign IP addresses to virtual machines if one or more subnets have been defined on that logical network. If no subnets are defined, virtual machines will not be assigned IP addresses. If there is one subnet, virtual machines will be assigned an IP address from that subnet, and if there are multiple subnets, virtual machines will be assigned an IP address from any of the available subnets. The DHCP service provided by the external network provider on which the logical network is hosted is responsible for assigning these IP addresses.</simpara>
<simpara>While the oVirt Engine automatically discovers predefined subnets on imported logical networks, you can also add or remove subnets to or from logical networks from within the Engine.</simpara>
<simpara>If you add Open Virtual Network (OVN) (ovirt-provider-ovn) as an external network provider, multiple subnets can be connected to each other by routers. To manage these routers, you can use the <link xl:href="https://developer.openstack.org/api-ref/network/v2/?expanded=list-routers-detail,create-router-detail#routers-routers">OpenStack Networking API v2.0</link>. Please note, however, that ovirt-provider-ovn has a limitation: Source NAT (enable_snat in the OpenStack API) is not implemented.</simpara>
</section>
<section xml:id="Adding_Subnets_to_External_Provider_Logical_Networks">
<title>Adding Subnets to External Provider Logical Networks</title>
<simpara>Create a subnet on a logical network provided by an external provider.</simpara>
<simpara><emphasis role="strong">Adding Subnets to External Provider Logical Networks</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Subnets</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">CIDR</emphasis> for the new subnet.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">IP Version</emphasis> drop-down list, select either <emphasis role="strong">IPv4</emphasis> or <emphasis role="strong">IPv6</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>For IPv6, oVirt supports only static addressing.</simpara>
</note>
</section>
<section xml:id="Removing_Subnets_from_External_Provider_Logical_Networks">
<title>Removing Subnets from External Provider Logical Networks</title>
<simpara>Remove a subnet from a logical network provided by an external provider.</simpara>
<simpara><emphasis role="strong">Removing Subnets from External Provider Logical Networks</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Network</guimenu> <guimenuitem>Networks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the logical network&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Subnets</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select a subnet and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Assigning_Security_Groups_to_Logical_Networks">
<title>Assigning Security Groups to Logical Networks and Ports</title>
<note>
<simpara>This feature is only available when Open Virtual Network (OVN) is added as an external network provider (as ovirt-provider-ovn). Security groups cannot be created through the oVirt Engine. You must create security groups through OpenStack Networking API v2.0 or Ansible.</simpara>
</note>
<simpara>A security group is a collection of strictly enforced rules that allow you to filter inbound and outbound traffic over a network. You can also use security groups to filter traffic at the port level.</simpara>
<simpara>In oVirt 4.2.7, security groups are disabled by default.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add Network</emphasis> and define the properties, ensuring that you select <literal>ovirt-provider-ovn</literal> from the <literal>External Providers</literal> drop-down list. For more information, see <xref linkend="Creating_a_new_logical_network_in_a_data_center_or_cluster"/>.</simpara>
</listitem>
<listitem>
<simpara>Select <literal>Enabled</literal> from the <literal>Security Group</literal> drop-down list. For more details see <xref linkend="Logical_Network_General_Settings_Explained"/>.</simpara>
</listitem>
<listitem>
<simpara>Click <literal>OK</literal>.</simpara>
</listitem>
<listitem>
<simpara>Create security groups using either
<link xl:href="https://developer.openstack.org/api-ref/network/v2/#security-groups-security-groups">OpenStack Networking API v2.0</link> or
<link xl:href="https://docs.ansible.com/ansible/2.7/modules/os_security_group_module.html">Ansible</link>.</simpara>
</listitem>
<listitem>
<simpara>Create security group rules using either
<link xl:href="https://developer.openstack.org/api-ref/network/v2/#security-group-rules-security-group-rules">OpenStack Networking API v2.0</link> or
 <link xl:href="https://docs.ansible.com/ansible/2.7/modules/os_security_group_rule_module.html">Ansible</link>.</simpara>
</listitem>
<listitem>
<simpara>Update the ports with the security groups that you defined using either <link xl:href="https://developer.openstack.org/api-ref/network/v2/?expanded=update-port-detail#ports">OpenStack Networking API v2.0</link> or <link xl:href="https://docs.ansible.com/ansible/2.7/modules/os_port_module.html">Ansible</link>.</simpara>
</listitem>
<listitem>
<simpara>Optional. Define whether the security feature is enabled at the port level. Currently, this is only possible using the <link xl:href="https://developer.openstack.org/api-ref/network/v2/?expanded=update-port-detail#ports">OpenStack Networking API</link>. If the <literal>port_security_enabled</literal> attribute is not set, it will default to the value specified in the network to which it belongs.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Hosts_and_Networking">
<title>Hosts and Networking</title>
<section xml:id="con-Network-Manager-Stateful-Configuration-nmstate">
<title>Network Manager Stateful Configuration (nmstate)</title>
<simpara>Version 4.4 of oVirt (oVirt) uses <emphasis>Network Manager Stateful Configuration (nmstate)</emphasis> to configure networking for oVirt hosts that are based on EL 8. oVirt version 4.3 and earlier use interface configuration (ifcfg) network scripts to manage host networking.</simpara>
<simpara>To use nmstate, upgrade the oVirt Engine and hosts as described in the <link xl:href="https://ovirt.org/documentation/upgrade_guide/index#">oVirt Upgrade Guide</link>.</simpara>
<simpara>As an administrator, you do not need to install or configure nmstate. It is enabled by default and runs in the background.</simpara>
<important>
<simpara>Always use oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration.</simpara>
</important>
<simpara>The change to nmstate is nearly transparent. It only changes how you configure host networking in the following ways:</simpara>
<itemizedlist>
<listitem>
<simpara>After you add a host to a cluster, always use the oVirt Engine to modify the host network.</simpara>
</listitem>
<listitem>
<simpara>Modifying the host network without using the Engine can create an unsupported configuration.</simpara>
</listitem>
<listitem>
<simpara>To fix an unsupported configuration, you replace it with a supported one by using the Engine to synchronize the host network. For details, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Synchronizing_host_networks">Synchronizing Host Networks</link>.</simpara>
</listitem>
<listitem>
<simpara>The only situation where you modify host networks outside the Engine is to configure a static route on a host. For more details, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#proc-Adding-a-static-route-on-a-host">Adding a static route on a host</link>.</simpara>
</listitem>
</itemizedlist>
<simpara>The change to nmstate improves how oVirt Engine applies configuration changes you make in Cockpit and Anaconda before adding the host to the Engine. This fixes some issues, such as <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1680970">BZ#1680970 Static IPv6 Address is lost on host deploy if NM manages the interface</link>.</simpara>
<important>
<simpara>If you use <literal>dnf</literal> or <literal>yum</literal> to manually update the <literal>nmstate</literal> package, restart <literal>vdsmd</literal> and <literal>supervdsmd</literal> on the host. For example:</simpara>
<simpara>+</simpara>
<screen># dnf update nmstate
# systemctl restart vdsmd supervdsmd</screen>
</important>
<important>
<simpara>If you use <literal>dnf</literal> or <literal>yum</literal> to manually update the Network Manager package, restart <literal>NetworkManager</literal> on the host. For example:</simpara>
<simpara>+</simpara>
<screen># dnf update NetworkManager
# systemctl restart NetworkManager</screen>
</important>
</section>
<section xml:id="Refreshing_Host_Capabilities">
<title>Refreshing Host Capabilities</title>
<simpara>When a network interface card is added to a host, the capabilities of the host must be refreshed to display that network interface card in the Engine.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Refresh Capabilities</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
<simpara>The list of network interface cards in the <emphasis role="strong">Network Interfaces</emphasis> tab for the selected host is updated. Any new network interface cards can now be used in the Engine.</simpara>
</section>
<section xml:id="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">
<title>Editing Host Network Interfaces and Assigning Logical Networks to Hosts</title>
<simpara>You can change the settings of physical host network interfaces, move the management network from one physical host network interface to another, and assign logical networks to physical host network interfaces. Bridge and ethtool custom properties are also supported.</simpara>
<warning>
<simpara>The only way to change the IP address of a host in oVirt is to remove the host and then to add it again.</simpara>
<simpara>To change the VLAN settings of a host, see <xref linkend="Editing-VLAN-Settings"/>.</simpara>
</warning>
<important>
<simpara>You cannot assign logical networks offered by external providers to physical host network interfaces; such networks are dynamically assigned to hosts as they are required by virtual machines.</simpara>
</important>
<note>
<simpara>If the switch has been configured to provide Link Layer Discovery Protocol (LLDP) information, you can hover your cursor over a physical network interface to view the switch port&#8217;s current configuration. This can help to prevent incorrect configuration. Check the following information prior to assigning logical networks:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Port Description (TLV type 4)</emphasis> and <emphasis role="strong">System Name (TLV type 5)</emphasis> help to detect to which ports and on which switch the host&#8217;s interfaces are
patched.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Port VLAN ID</emphasis> shows the native
VLAN ID configured on the switch port for untagged ethernet frames. All
VLANs configured on the switch port are shown as <emphasis role="strong">VLAN Name</emphasis> and <emphasis role="strong">VLAN ID</emphasis>
combinations.</simpara>
</listitem>
</itemizedlist>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, hover your cursor over host network interface to view configuration information provided by the switch.</simpara>
</listitem>
<listitem>
<simpara>Attach a logical network to a physical host network interface by selecting and dragging the logical network into the <emphasis role="strong">Assigned Logical Networks</emphasis> area next to the physical host network interface.</simpara>
<note>
<simpara>If a NIC is connected to more than one logical network, only one of the networks can be non-VLAN. All the other logical networks must be unique VLANs.</simpara>
</note>
</listitem>
<listitem>
<simpara>Configure the logical network:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Hover your cursor over an assigned logical network and click the pencil icon. This opens the <emphasis role="strong">Edit Management Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">IPv4</emphasis> tab, select a <emphasis role="strong">Boot Protocol</emphasis> from <emphasis role="strong">None</emphasis>, <emphasis role="strong">DHCP</emphasis>, or <emphasis role="strong">Static</emphasis>. If you selected <emphasis role="strong">Static</emphasis>, enter the <emphasis role="strong">IP</emphasis>, <emphasis role="strong">Netmask / Routing Prefix</emphasis>, and the <emphasis role="strong">Gateway</emphasis>.</simpara>
<note>
<simpara>For IPv6, only static IPv6 addressing is supported.
To configure the logical network, select the <emphasis role="strong">IPv6</emphasis> tab and make the following entries:</simpara>
<itemizedlist>
<listitem>
<simpara>Set <emphasis role="strong">Boot Protocol</emphasis> to <emphasis role="strong">Static</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">Routing Prefix</emphasis>, enter the <emphasis>length</emphasis> of the prefix using a forward slash and decimals. For example: <literal>/48</literal></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">IP</emphasis>: The complete IPv6 address of the host network interface. For example: <literal>2001:db8::1:0:0:6</literal></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Gateway</emphasis>: The source router&#8217;s IPv6 address. For example: <literal>2001:db8::1:0:0:1</literal></simpara>
</listitem>
</itemizedlist>
</note>
<note>
<simpara>If you change the host&#8217;s management network IP address, you must <link linkend="Reinstalling_Hosts_admin">reinstall the host</link> for the new IP address to be configured.</simpara>
<simpara>Each logical network can have a separate gateway defined from the management network gateway. This ensures traffic that arrives on the logical network will be forwarded using the logical network&#8217;s gateway instead of the default gateway used by the management network.</simpara>
</note>
<important>
<simpara>Set <emphasis role="strong">all</emphasis> hosts in a cluster to use the same IP stack for their management network; either IPv4 or IPv6 only. Dual stack is not supported.</simpara>
</important>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">QoS</emphasis> tab to override the default host network quality of service. Select <emphasis role="strong">Override QoS</emphasis> and enter the desired values in the following fields:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Weighted Share</emphasis>: Signifies how much of the logical link&#8217;s capacity a specific network should be allocated, relative to the other networks attached to the same logical link. The exact share depends on the sum of shares of all networks on that link. By default this is a number in the range 1-100.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Rate Limit [Mbps]</emphasis>: The maximum bandwidth to be used by a network.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Committed Rate [Mbps]</emphasis>: The minimum bandwidth required by a network. The Committed Rate requested is not guaranteed and will vary depending on the network infrastructure and the Committed Rate requested by other networks on the same logical link.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>To configure a network bridge, click the <emphasis role="strong">Custom Properties</emphasis> tab and select <emphasis role="strong">bridge_opts</emphasis> from the drop-down list. Enter a valid key and value with the following syntax: <emphasis>key</emphasis>=<emphasis>value</emphasis>. Separate multiple entries with a whitespace character. The following keys are valid, with the values provided as examples. For more information on these parameters, see <xref linkend="Explanation_of_bridge_opts_Parameters"/>.</simpara>
<screen>forward_delay=1500
group_addr=1:80:c2:0:0:0
group_fwd_mask=0x0
hash_max=512
hello_time=200
max_age=2000
multicast_last_member_count=2
multicast_last_member_interval=100
multicast_membership_interval=26000
multicast_querier=0
multicast_querier_interval=25500
multicast_query_interval=13000
multicast_query_response_interval=1000
multicast_query_use_ifaddr=0
multicast_router=1
multicast_snooping=1
multicast_startup_query_count=2
multicast_startup_query_interval=3125</screen>
</listitem>
<listitem>
<simpara>To configure ethernet properties, click the <emphasis role="strong">Custom Properties</emphasis> tab and select <emphasis role="strong">ethtool_opts</emphasis> from the drop-down list. Enter a valid value using the format of the command-line arguments of ethtool. For example:</simpara>
<screen>--coalesce em1 rx-usecs 14 sample-interval 3 --offload em2 rx on lro on tso off --change em1 speed 1000 duplex half</screen>
<simpara>This field can accept wildcards. For example, to apply the same option to all of this network&#8217;s interfaces, use:</simpara>
<screen>--coalesce * rx-usecs 14 sample-interval 3</screen>
<simpara>The <emphasis role="strong">ethtool_opts</emphasis> option is not available by default; you need to add it using the engine configuration tool. See <xref linkend="How_to_Set_Up_Red_Hat_Enterprise_Virtualization_Manager_to_Use_Ethtool"/> for more information. For more information on ethtool properties, see the manual page by typing <literal>man ethtool</literal> in the command line.</simpara>
</listitem>
<listitem>
<simpara>To configure Fibre Channel over Ethernet (FCoE), click the <emphasis role="strong">Custom Properties</emphasis> tab and select <emphasis role="strong">fcoe</emphasis> from the drop-down list. Enter a valid key and value with the following syntax: <emphasis>key</emphasis>=<emphasis>value</emphasis>. At least <literal>enable=yes</literal> is required. You can also add <literal>dcb=</literal><literal role="yes|no"> and <literal>auto_vlan=</literal>[yes|no]</literal>. Separate multiple entries with a whitespace character. The <emphasis role="strong">fcoe</emphasis> option is not available by default; you need to add it using the engine configuration tool. See <xref linkend="How_to_Set_Up_RHVM_to_Use_FCoE"/> for more information.</simpara>
<note>
<simpara>A separate, dedicated logical network is recommended for use with FCoE.</simpara>
</note>
</listitem>
<listitem>
<simpara>To change the default network used by the host from the management network (ovirtmgmt) to a non-management network, configure the non-management network&#8217;s default route. See <xref linkend="Configuring_a_Default_Route"/> for more information.</simpara>
</listitem>
<listitem>
<simpara>If your logical network definition is not synchronized with the network configuration on the host, select the <emphasis role="strong">Sync network</emphasis> check box. For more information about unsynchronized hosts and how to synchronize them, see <xref linkend="Synchronizing_host_networks"/>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Verify connectivity between Host and Engine</emphasis> check box to check network connectivity. This action only works if the host is in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>If not all network interface cards for the host are displayed, click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Refresh Capabilities</guimenuitem></menuchoice> to update the list of network interface cards available for that host.</simpara>
</note>
<formalpara>
<title>Troubleshooting</title>
<para>In some cases, making multiple concurrent changes to a host network configuration using the <emphasis role="strong">Setup Host Networks</emphasis> window or <literal>setupNetwork</literal> command fails with an <literal>Operation failed: [Cannot setup Networks]. Another Setup Networks or Host Refresh process in progress on the host. Please try later.]</literal> error in the event log. This error indicates that some of the changes were not configured on the host. This happens because, to preserve the integrity of the configuration state, only a single setup network command can be processed at a time. Other concurrent configuration commands are queued for up to a default timeout of 20 seconds. To help prevent the above failure from happening, use the <literal>engine-config</literal> command to increase the timeout period of <literal>SetupNetworksWaitTimeoutSeconds</literal> beyond 20 seconds. For example:</para>
</formalpara>
<screen># engine-config --set SetupNetworksWaitTimeoutSeconds=40</screen>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="Syntax_for_the_engine-config_Command"/></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-host-methods-setup_networks">setupnetworks POST</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Synchronizing_host_networks">
<title>Synchronizing Host Networks</title>
<simpara>The Engine defines a network interface as <literal>out-of-sync</literal> when the definition of the interface on the host differs from the definitions stored by the Engine.</simpara>
<simpara>Out-of-sync networks appear with an Out-of-sync icon <inlinemediaobject>
<imageobject>
<imagedata fileref="images/out-of-sync.png"/>
</imageobject>
<textobject><phrase>out of sync</phrase></textobject>
</inlinemediaobject> in the host&#8217;s <emphasis role="strong">Network Interfaces</emphasis> tab and with this icon <inlinemediaobject>
<imageobject>
<imagedata fileref="images/out-of-sync-setup.png"/>
</imageobject>
<textobject><phrase>out of sync setup</phrase></textobject>
</inlinemediaobject> in the <emphasis role="strong">Setup Host Networks</emphasis> window.</simpara>
<simpara>When a host&#8217;s network is out of sync, the only activities that you can perform on the unsynchronized network in the <emphasis role="strong">Setup Host Networks</emphasis> window are detaching the logical network from the network interface or synchronizing the network.</simpara>
<formalpara>
<title>Understanding How a Host Becomes out-of-sync</title>
<para>A host will become out of sync if:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>You make configuration changes on the host rather than using the the <emphasis role="strong">Edit Logical Networks</emphasis> window, for example:</simpara>
<itemizedlist>
<listitem>
<simpara>Changing the VLAN identifier on the physical host.</simpara>
</listitem>
<listitem>
<simpara>Changing the <emphasis role="strong">Custom MTU</emphasis> on the physical host.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>You move a host to a different data center with the same network name, but with different values/parameters.</simpara>
</listitem>
<listitem>
<simpara>You change a network&#8217;s <emphasis role="strong">VM Network</emphasis> property by manually removing the bridge from the host.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>If you change the network’s <emphasis role="strong">MTU</emphasis> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machine’s vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <link xl:href="https://access.redhat.com/solutions/4540631">https://access.redhat.com/solutions/4540631</link> and <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</link>.</simpara>
</important>
<formalpara>
<title>Preventing Hosts from Becoming Unsynchronized</title>
<para>Following these best practices will prevent your host from becoming unsynchronized:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Use the Administration Portal to make changes rather than making changes locally on the host.</simpara>
</listitem>
<listitem>
<simpara>Edit VLAN settings according to the instructions in <xref linkend="Editing-VLAN-Settings"/>.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>Synchronizing Hosts</title>
<para>Synchronizing a host&#8217;s network interface definitions involves using the definitions from the Engine and applying them to the host. If these are not the definitions that you require, after synchronizing your hosts update their definitions from the Administration Portal.
You can synchronize a host&#8217;s networks on three levels:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Per logical network</simpara>
</listitem>
<listitem>
<simpara>Per host</simpara>
</listitem>
<listitem>
<simpara>Per cluster</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Synchronizing Host Networks on the Logical Network Level</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Hover your cursor over the unsynchronized network and click the pencil icon. This opens the <emphasis role="strong">Edit Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Sync network</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to save the network change.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to close the <emphasis role="strong">Setup Host Networks</emphasis> window.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Synchronizing a Host&#8217;s Networks on the Host level</title>
<listitem>
<simpara>Click the <emphasis role="strong">Sync All Networks</emphasis> button in the host&#8217;s <emphasis role="strong">Network Interfaces</emphasis> tab to synchronize all of the host&#8217;s unsynchronized network interfaces.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Synchronizing a Host&#8217;s Networks on the Cluster level</title>
<listitem>
<simpara>Click the <emphasis role="strong">Sync All Networks</emphasis> button in the cluster&#8217;s <emphasis role="strong">Logical Networks</emphasis> tab to synchronize all unsynchronized logical network definitions for the entire cluster.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>You can also synchronize a host&#8217;s networks via the REST API. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-sync_all_networks">syncallnetworks</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</note>
</section>
<section xml:id="Editing-VLAN-Settings">
<title>Editing a Host&#8217;s VLAN Settings</title>
<simpara>To change the VLAN settings of a host, the host must be removed from the Engine, reconfigured, and re-added to the Engine.</simpara>
<simpara>To keep networking synchronized, do the following:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Put the host in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Manually remove the management network from the host. This will make the host reachable over the new VLAN.</simpara>
</listitem>
<listitem>
<simpara>Add the host to the cluster. Virtual machines that are not connected directly to the management network can be migrated between hosts safely.</simpara>
</listitem>
</orderedlist>
<simpara>The following warning message appears when the VLAN ID of the management network is changed:</simpara>
<screen>Changing certain properties (e.g. VLAN, MTU) of the management network could lead to loss of connectivity to hosts in the data center, if its underlying network infrastructure isn't configured to accommodate the changes. Are you sure you want to proceed?</screen>
<simpara>Proceeding causes all of the hosts in the data center to lose connectivity to the Engine and causes the migration of hosts to the new management network to fail. The management network will be reported as "out-of-sync".</simpara>
<important>
<simpara>If you change the management network&#8217;s VLAN ID, you must <link linkend="Reinstalling_Hosts_admin">reinstall the host</link> to apply the new VLAN ID.</simpara>
</important>
</section>
<section xml:id="Adding_multiple_VLANs_to_a_single_network_interface_using_logical_networks">
<title>Adding Multiple VLANs to a Single Network Interface Using Logical Networks</title>
<simpara>Multiple VLANs can be added to a single network interface to separate traffic on the one host.</simpara>
<important>
<simpara>You must have created more than one logical network, all with the <emphasis role="strong">Enable VLAN tagging</emphasis> check box selected in the <emphasis role="strong">New Logical Network</emphasis> or <emphasis role="strong">Edit Logical Network</emphasis> windows.</simpara>
</important>
<simpara><emphasis role="strong">Adding Multiple VLANs to a Network Interface using Logical Networks</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Drag your VLAN-tagged logical networks into the <emphasis role="strong">Assigned Logical Networks</emphasis> area next to the physical network interface. The physical network interface can have multiple logical networks assigned due to the VLAN tagging.</simpara>
</listitem>
<listitem>
<simpara>Edit the logical networks:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Hover your cursor over an assigned logical network and click the pencil icon.</simpara>
</listitem>
<listitem>
<simpara>If your logical network definition is not synchronized with the network configuration on the host, select the <emphasis role="strong">Sync network</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Boot Protocol</emphasis>:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">None</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">DHCP</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Static</emphasis></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Provide the <emphasis role="strong">IP</emphasis> and <emphasis role="strong">Subnet Mask</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Verify connectivity between Host and Engine</emphasis> check box to run a network check; this will only work if the host is in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Add the logical network to each host in the cluster by editing a NIC on each host in the cluster. After this is done, the network will become operational.</simpara>
<simpara>This process can be repeated multiple times, selecting and editing the same network interface each time on each host to add logical networks with different VLAN tags to a single network interface.</simpara>
</section>
<section xml:id="proc-Copying-host-networks_vlan">
<title>Copying host networks</title>
<simpara>To save time, you can copy a source host&#8217;s network configuration to a target host in the same cluster.</simpara>
<simpara>Copying the network configuration includes:</simpara>
<itemizedlist>
<listitem>
<simpara>Logical networks attached to the host, except the <literal>ovirtmgmt</literal> management network</simpara>
</listitem>
<listitem>
<simpara>Bonds attached to interfaces</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Limitations</title>
<listitem>
<simpara>Do not copy network configurations that contain static IP addresses. Doing this sets the boot protocol in the target host to <literal>none</literal>.</simpara>
</listitem>
<listitem>
<simpara>Copying a configuration to a target host with the same interface names as the source host but different physical network connections produces a wrong configuration.</simpara>
</listitem>
<listitem>
<simpara>The target host must have an equal or greater number of interfaces than the source host. Otherwise, the operation fails.</simpara>
</listitem>
<listitem>
<simpara>Copying <literal>QoS</literal>, <literal>DNS</literal>, and <literal>custom_properties</literal> is not supported.</simpara>
</listitem>
<listitem>
<simpara>Network interface labels are not copied.</simpara>
</listitem>
</itemizedlist>
<warning>
<simpara>Copying host networks replaces ALL network settings on the target host except its attachment to the <literal>ovirtmgmt</literal> management network.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The number of NICs on the target host must be equal or greater than those on the source host. Otherwise, the operation fails.</simpara>
</listitem>
<listitem>
<simpara>The hosts must be in the same cluster.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the source host whose configuration you want to copy.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Copy Host Networks</guibutton>. This opens the <emphasis role="strong">Copy Host Networks</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Use <emphasis role="strong">Target Host</emphasis> to select the host that should receive the configuration. The list only shows hosts that are in the same cluster.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Copy Host Networks</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Verify the network settings of the target host</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Tips</title>
<listitem>
<simpara>Selecting multiple hosts disables the <guibutton>Copy Host Networks</guibutton> button and context menu.</simpara>
</listitem>
<listitem>
<simpara>Instead of using the <guibutton>Copy Host Networks</guibutton> button, you can right-click a host and select <guimenu>Copy Host Networks</guimenu> from the context menu.</simpara>
</listitem>
<listitem>
<simpara>The <guibutton>Copy Host Networks</guibutton> button is also available in any host&#8217;s details view.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Assigning_Additional_IPv4_Addresses_to_a_Host_Network">
<title>Assigning Additional IPv4 Addresses to a Host Network</title>
<simpara>A host network, such as the <emphasis role="strong">ovirtmgmt</emphasis> management network, is created with only one IP address when initially set up. This means that if a NIC&#8217;s configuration file is configured with multiple IP addresses, only the first listed IP address will be assigned to the host network. Additional IP addresses may be required if connecting to storage, or to a server on a separate private subnet using the same NIC.</simpara>
<simpara>The <literal>vdsm-hook-extra-ipv4-addrs</literal> hook allows you to configure additional IPv4 addresses for host networks. For more information about hooks, see <xref linkend="appe-VDSM_and_Hooks"/>.</simpara>
<simpara>In the following procedure, the host-specific tasks must be performed on each host for which you want to configure additional IP addresses.</simpara>
<simpara><emphasis role="strong">Assigning Additional IPv4 Addresses to a Host Network</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the host that you want to configure additional IPv4 addresses for, install the VDSM hook package. The package is available by default on oVirt Nodes but needs to be installed on Enterprise Linux hosts.</simpara>
<screen># dnf install vdsm-hook-extra-ipv4-addrs</screen>
</listitem>
<listitem>
<simpara>On the Engine, run the following command to add the key:</simpara>
<screen># engine-config -s 'UserDefinedNetworkCustomProperties=ipv4_addrs=.*'</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab and click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the host network interface by hovering the cursor over the assigned logical network and clicking the pencil icon.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">ipv4_addr</emphasis> from the <emphasis role="strong">Custom Properties</emphasis> drop-down list and add the additional IP address and prefix (for example 5.5.5.5/24). Multiple IP addresses must be comma-separated.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to close the <emphasis role="strong">Edit Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to close the <emphasis role="strong">Setup Host Networks</emphasis> window.</simpara>
</listitem>
</orderedlist>
<simpara>The additional IP addresses will not be displayed in the Engine, but you can run the command <literal>ip addr show</literal> on the host to confirm that they have been added.</simpara>
</section>
<section xml:id="Adding_Network_Labels_to_Host_Network_Interfaces">
<title>Adding Network Labels to Host Network Interfaces</title>
<simpara>Using network labels allows you to greatly simplify the administrative workload associated with assigning logical networks to host network interfaces. Setting a label on a role network (for instance, a migration network or a display network) causes a mass deployment of that network on all hosts. Such mass additions of networks are achieved through the use of DHCP. This method of mass deployment was chosen over a method of typing in static addresses, because of the unscalable nature of the task of typing in many static IP addresses.</simpara>
<simpara>There are two methods of adding labels to a host network interface:</simpara>
<itemizedlist>
<listitem>
<simpara>Manually, in the Administration Portal</simpara>
</listitem>
<listitem>
<simpara>Automatically, with the LLDP Labeler service</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Adding Network Labels in the Administration Portal</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Labels</emphasis> and right-click <emphasis role="strong">[New Label]</emphasis>. Select a physical network interface to label.</simpara>
</listitem>
<listitem>
<simpara>Enter a name for the network label in the <emphasis role="strong">Label</emphasis> text field.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Adding Network Labels with the LLDP Labeler Service</emphasis></simpara>
<simpara>You can automate the process of assigning labels to host network interfaces in the configured list of clusters with the LLDP Labeler service.</simpara>
<simpara xml:id="Configuring_LLDP_Labeler_vlan">By default, LLDP Labeler runs as an hourly service. This option is useful if you make hardware changes (for example, NICs, switches, or cables) or change switch configurations.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The interfaces must be connected to a Juniper switch.</simpara>
</listitem>
<listitem>
<simpara>The Juniper switch must be configured to provide the <literal>Port VLAN</literal> using LLDP.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Configure the <literal>username</literal> and <literal>password</literal> in <literal>/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>username</literal> - the username of the Engine administrator. The default is <literal>admin@internal</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>password</literal> - the password of the Engine administrator. The default is <literal>123456</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Configure the LLDP Labeler service by updating the following values in <literal>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>clusters</literal> - a comma-separated list of clusters on which the service should run. Wildcards are supported. For example, <literal>Cluster*</literal> defines LLDP Labeler to run on all clusters starting with word <literal>Cluster</literal>. To run the service on all clusters in the data center, type <literal>*</literal>. The default is <literal>Def*</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>api_url</literal> - the full URL of the Engine&#8217;s API. The default is <literal>https://<emphasis>Manager_FQDN</emphasis>/ovirt-engine/api</literal></simpara>
</listitem>
<listitem>
<simpara><literal>ca_file</literal> - the path to the custom CA certificate file. Leave this value empty if you do not use custom certificates. The default is empty.</simpara>
</listitem>
<listitem>
<simpara><literal>auto_bonding</literal> - enables LLDP Labeler&#8217;s bonding capabilities. The default is <literal>true</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>auto_labeling</literal> - enables LLDP Labeler&#8217;s labeling capabilities. The default is <literal>true</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optionally, you can configure the service to run at a different time interval by changing the value of <literal>OnUnitActiveSec</literal> in <literal>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-labeler.timer</literal>. The default is <literal>1h</literal>.</simpara>
</listitem>
<listitem>
<simpara>Configure the service to start now and at boot by entering the following command:</simpara>
<screen># systemctl enable --now ovirt-lldp-labeler</screen>
<simpara>To invoke the service manually, enter the following command:</simpara>
<screen># /usr/bin/python /usr/share/ovirt-lldp-labeler/ovirt_lldp_labeler_cli.py</screen>
</listitem>
</orderedlist>
<simpara>You have added a network label to a host network interface. Newly created logical networks with the same label are automatically assigned to all host network interfaces with that label. Removing a label from a logical network automatically removes that logical network from all host network interfaces with that label.</simpara>
</section>
<section xml:id="Changing_the_FQDN_of_a_Host">
<title>Changing the FQDN of a Host</title>
<simpara>Use the following procedure to change the fully qualified domain name of hosts.</simpara>
<simpara><emphasis role="strong">Updating the FQDN of a Host</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Place the host into maintenance mode so the virtual machines are live migrated to another host. See <xref linkend="Moving_a_host_to_maintenance_mode"/> for more information. Alternatively, manually shut down or migrate all the virtual machines to another host. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Manually_migrating_virtual_machines">Manually Migrating Virtual Machines</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for more information.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>, and click <guibutton>OK</guibutton> to remove the host from the Administration Portal.</simpara>
</listitem>
<listitem>
<simpara>Use the <literal>hostnamectl</literal> tool to update the host name. For more options, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Networking_Guide/ch-Configure_Host_Names.html"> Configure Host Names</link> in the <emphasis>Enterprise Linux 7 Networking Guide</emphasis>.</simpara>
<screen># hostnamectl set-hostname <emphasis>NEW_FQDN</emphasis></screen>
</listitem>
<listitem>
<simpara>Reboot the host.</simpara>
</listitem>
<listitem>
<simpara>Re-register the host with the Engine. See <xref linkend="Adding_standard_hosts_to_the_Manager_host_tasks"/> for more information.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="IPv6-networking-support-labels">
<title>IPv6 Networking Support</title>
<simpara>oVirt supports static IPv6 networking in most contexts.</simpara>
<note>
<simpara>oVirt requires IPv6 to remain enabled on the computer or virtual machine where you are running the Engine (also called "the Engine machine"). <link xl:href="https://access.redhat.com/solutions/8709">Do not disable IPv6</link> on the Engine machine, even if your systems do not use it.</simpara>
</note>
<itemizedlist>
<title>Limitations for IPv6</title>
<listitem>
<simpara>Only static IPv6 addressing is supported. Dynamic IPv6 addressing with <emphasis role="strong">DHCP</emphasis> or <emphasis role="strong">Stateless Address Autoconfiguration</emphasis> are not supported.</simpara>
</listitem>
<listitem>
<simpara>Dual-stack addressing, IPv4 <emphasis>and</emphasis> IPv6, is not supported.</simpara>
</listitem>
<listitem>
<simpara>OVN networking can be used with only IPv4 <emphasis>or</emphasis> IPv6.</simpara>
</listitem>
<listitem>
<simpara>Switching clusters from IPv4 to IPv6 is not supported.</simpara>
</listitem>
<listitem>
<simpara>Only a single gateway per host can be set for IPv6.</simpara>
</listitem>
<listitem>
<simpara>If both networks share a single gateway (are on the same subnet), you can move the default route role from the management network (ovirtmgmt) to another logical network. The host and Engine should have the same IPv6 gateway. If the host and Engine are not on the same subnet, the Engine might lose connectivity with the host because the IPv6 gateway was removed.</simpara>
</listitem>
<listitem>
<simpara>Using a glusterfs storage domain with an IPv6-addressed gluster server is not supported.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="setting-up-and-configuring-sr-iov">
<title>Setting Up and Configuring SR-IOV</title>
<simpara>This topic summarizes the steps for setting up and configuring SR-IOV, with links out to topics that cover each step in detail.</simpara>
<section xml:id="_prerequisites">
<title>Prerequisites</title>
<simpara>Set up your hardware in accordance with the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Hardware Considerations for Implementing SR-IOV</link></simpara>
</section>
<section xml:id="_set_up_and_configure_sr_iov">
<title>Set Up and Configure SR-IOV</title>
<simpara>To set up and configure SR-IOV, complete the following tasks.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index#configuring_a_host_for_pci_passthrough_she_cockpit_deploy">Configuring the host for PCI passthrough</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#Editing_VFs_on_NIC">Editing the virtual function configuration on a NIC</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#Enabling_Passthrough_on_a_vNIC_Profile">Enabling passthrough on a vNIC Profile</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_virtual_machines_with_SR-IOV-Enabled_vNICs">Configuring Virtual Machines with SR-IOV-Enabled vNICs to Reduce Network Outage during Migration</link>.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Notes</title>
<listitem>
<simpara>The number of the 'passthrough' vNICs depends on the number of available virtual functions (VFs) on the host. For example, to run a virtual machine (VM) with three SR-IOV cards (vNICs), the host must have three or more VFs enabled.</simpara>
</listitem>
<listitem>
<simpara>Hotplug and unplug are supported.</simpara>
</listitem>
<listitem>
<simpara>Live migration is supported.</simpara>
</listitem>
<listitem>
<simpara>To migrate a VM, the destination host must also have enough available VFs to receive the VM. During the migration, the VM releases a number of VFs on the source host and occupies the same number of VFs on the destination host.</simpara>
</listitem>
<listitem>
<simpara>On the host, you will see a device, link, or ifcae like any other interface. That device disappears when it is attached to a VM, and reappears when it is released.</simpara>
</listitem>
<listitem>
<simpara>Avoid attaching a host device directly to a VM for SR-IOV feature.</simpara>
</listitem>
<listitem>
<simpara>To use a VF as a trunk port with several VLANs and configure the VLANs within the Guest, please see <link xl:href="https://access.redhat.com/solutions/3951231">Cannot configure VLAN on SR-IOV VF interfaces inside the Virtual Machine</link>.</simpara>
</listitem>
</itemizedlist>
<simpara>Here is an example of what the libvirt XML for the interface would look like:</simpara>
<programlisting language="xml" linenumbering="unnumbered">  ----
  &lt;interface type='hostdev'&gt;
     &lt;mac address='00:1a:yy:xx:vv:xx'/&gt;
     &lt;driver name='vfio'/&gt;
     &lt;source&gt;
       &lt;address type='pci' domain='0x0000' bus='0x05' slot='0x10' function='0x0'/&gt;
     &lt;/source&gt;
     &lt;alias name='ua-18400536-5688-4477-8471-be720e9efc68'/&gt;
     &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/&gt;
   &lt;/interface&gt;
   ----</programlisting>
<formalpara>
<title>Troubleshooting</title>
<para>The following example shows you how to get diagnostic information about the VFs attached to an interface.</para>
</formalpara>
<literallayout class="monospaced"># ip -s link show dev enp5s0f0

1: enp5s0f0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9000 qdisc mq state UP mode DEFAULT qlen 1000
    link/ether 86:e2:ba:c2:50:f0 brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast
    30931671   218401   0       0       0       19165434
    TX: bytes  packets  errors  dropped carrier collsns
    997136     13661    0       0       0       0
    vf 0 MAC 02:00:00:00:00:01, spoof checking on, link-state auto, trust off, query_rss off
    vf 1 MAC 00:1a:4b:16:01:5e, spoof checking on, link-state auto, trust off, query_rss off
    vf 2 MAC 02:00:00:00:00:01, spoof checking on, link-state auto, trust off, query_rss off</literallayout>
</section>
<section xml:id="_additional_resources">
<title>Additional Resources</title>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/solutions/3867761">How to configure SR-IOV passthrough for RHV VM?</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/articles/3215851">How to configure bonding with SR-IOV VF(Virtual Function) in RHV</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/articles/2335291">How to enable host device passthrough and SR-IOV to allow assigning dedicated virtual NICs to virtual machines in RHV</link></simpara>
</listitem>
</itemizedlist>
</section>
</section>
</section>
<section xml:id="sect-Network_Bonding">
<title>Network Bonding</title>
<simpara xml:id="Bonding_Methods">Network bonding combines multiple NICs into a bond device, with the following advantages:</simpara>
<itemizedlist>
<listitem>
<simpara>The transmission speed of bonded NICs is greater than that of a single NIC.</simpara>
</listitem>
<listitem>
<simpara>Network bonding provides fault tolerance, because the bond device will not fail unless all its NICs fail.</simpara>
</listitem>
</itemizedlist>
<simpara>Using NICs of the same make and model ensures that they support the same bonding options and modes.</simpara>
<important>
<simpara>oVirt&#8217;s default bonding mode, <literal>(Mode 4) Dynamic Link Aggregation</literal>, requires a switch that supports 802.3ad.</simpara>
<simpara xml:id="Bond_logical_networks_compatibility">The logical networks of a bond must be compatible. A bond can support only 1 non-VLAN logical network. The rest of the logical networks must have unique VLAN IDs.</simpara>
<simpara>Bonding must be enabled for the switch ports. Consult the manual provided by your switch vendor for specific instructions.</simpara>
</important>
<simpara>You can create a network bond device using one of the following methods:</simpara>
<itemizedlist>
<listitem>
<simpara>Manually, in the <link linkend="Creating_a_bond_device_in_the_administration_portal">Administration Portal</link>, for a specific host</simpara>
</listitem>
<listitem>
<simpara>Automatically, using <link linkend="Creating_a_bond_device_with_the_lldp_labeler_service">LLDP Labeler</link>, for unbonded NICs of all hosts in a cluster or data center</simpara>
</listitem>
</itemizedlist>
<simpara>If your environment uses iSCSI storage and you want to implement redundancy, follow the instructions for <link linkend="Configuring_iSCSI_Multipathing">configuring iSCSI multipathing</link>.</simpara>
<section xml:id="Creating_a_bond_device_in_the_administration_portal">
<title>Creating a Bond Device in the Administration Portal</title>
<simpara>You can create a bond device on a specific host in the Administration Portal. The bond device can carry both VLAN-tagged and untagged traffic.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Network Interfaces</emphasis> tab to list the physical network interfaces attached to the host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Check the switch configuration. If the switch has been configured to provide Link Layer Discovery Protocol (LLDP) information, hover your cursor over a physical NIC to view the switch port&#8217;s aggregation configuration.</simpara>
</listitem>
<listitem>
<simpara>Drag and drop a NIC onto another NIC or onto a bond.</simpara>
<note>
<simpara>Two NICs form a new bond. A NIC and a bond adds the NIC to the existing bond.</simpara>
<simpara>If the logical networks are <link linkend="Bond_logical_networks_compatibility">incompatible</link>, the bonding operation is blocked.</simpara>
</note>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Bond Name</emphasis> and <emphasis role="strong">Bonding Mode</emphasis> from the drop-down menus. See <xref linkend="Bonding_Modes"/> for details.</simpara>
<simpara>If you select the <emphasis role="strong">Custom</emphasis> bonding mode, you can enter bonding options in the text field, as in the following examples:</simpara>
<itemizedlist>
<listitem>
<simpara>If your environment does not report link states with <literal>ethtool</literal>, you can set ARP monitoring by entering <literal>mode=<emphasis>1</emphasis> arp_interval=<emphasis>1</emphasis> arp_ip_target=<emphasis>192.168.0.2</emphasis></literal>.</simpara>
</listitem>
<listitem>
<simpara>You can designate a NIC with higher throughput as the primary interface by entering <literal>mode=<emphasis>1</emphasis> primary=<emphasis>eth0</emphasis></literal>.</simpara>
<simpara>For a comprehensive list of bonding options and their descriptions, see the <link xl:href="https://www.kernel.org/doc/Documentation/networking/bonding.txt"><emphasis>Linux Ethernet Bonding Driver HOWTO</emphasis></link> on Kernel.org.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Attach a logical network to the new bond and configure it. See <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/> for instructions.</simpara>
<note>
<simpara>You cannot attach a logical network directly to an individual NIC in the bond.</simpara>
</note>
</listitem>
<listitem>
<simpara>Optionally, you can select <emphasis role="strong">Verify connectivity between Host and Engine</emphasis> if the host is in maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Creating_a_bond_device_with_the_lldp_labeler_service">
<title>Creating a Bond Device with the LLDP Labeler Service</title>
<simpara>The LLDP Labeler service enables you to create a bond device automatically with all unbonded NICs, for all the hosts in one or more clusters or in the entire data center. The bonding mode is <link linkend="Bonding_Modes"><literal>(Mode 4) Dynamic Link Aggregation(802.3ad)</literal></link>.</simpara>
<simpara>NICs with <link linkend="Bond_logical_networks_compatibility">incompatible logical networks</link> cannot be bonded.</simpara>
<simpara xml:id="Configuring_LLDP_Labeler_labels">By default, LLDP Labeler runs as an hourly service. This option is useful if you make hardware changes (for example, NICs, switches, or cables) or change switch configurations.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The interfaces must be connected to a Juniper switch.</simpara>
</listitem>
<listitem>
<simpara>The Juniper switch must be configured for Link Aggregation Control Protocol (LACP) using LLDP.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Configure the <literal>username</literal> and <literal>password</literal> in <literal>/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>username</literal> - the username of the Engine administrator. The default is <literal>admin@internal</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>password</literal> - the password of the Engine administrator. The default is <literal>123456</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Configure the LLDP Labeler service by updating the following values in <literal>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</literal>:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>clusters</literal> - a comma-separated list of clusters on which the service should run. Wildcards are supported. For example, <literal>Cluster*</literal> defines LLDP Labeler to run on all clusters starting with word <literal>Cluster</literal>. To run the service on all clusters in the data center, type <literal>*</literal>. The default is <literal>Def*</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>api_url</literal> - the full URL of the Engine&#8217;s API. The default is <literal>https://<emphasis>Manager_FQDN</emphasis>/ovirt-engine/api</literal></simpara>
</listitem>
<listitem>
<simpara><literal>ca_file</literal> - the path to the custom CA certificate file. Leave this value empty if you do not use custom certificates. The default is empty.</simpara>
</listitem>
<listitem>
<simpara><literal>auto_bonding</literal> - enables LLDP Labeler&#8217;s bonding capabilities. The default is <literal>true</literal>.</simpara>
</listitem>
<listitem>
<simpara><literal>auto_labeling</literal> - enables LLDP Labeler&#8217;s labeling capabilities. The default is <literal>true</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optionally, you can configure the service to run at a different time interval by changing the value of <literal>OnUnitActiveSec</literal> in <literal>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-labeler.timer</literal>. The default is <literal>1h</literal>.</simpara>
</listitem>
<listitem>
<simpara>Configure the service to start now and at boot by entering the following command:</simpara>
<screen># systemctl enable --now ovirt-lldp-labeler</screen>
<simpara>To invoke the service manually, enter the following command:</simpara>
<screen># /usr/bin/python /usr/share/ovirt-lldp-labeler/ovirt_lldp_labeler_cli.py</screen>
</listitem>
<listitem>
<simpara>Attach a logical network to the new bond and configure it. See <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/> for instructions.</simpara>
<note>
<simpara>You cannot attach a logical network directly to an individual NIC in the bond.</simpara>
</note>
</listitem>
</orderedlist>
</section>
<section xml:id="Bonding_Modes">
<title>Bonding Modes</title>
<simpara>The packet dispersal algorithm is determined by the bonding mode. (See the <link xl:href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</link> for details). oVirt&#8217;s default bonding mode is <literal>(Mode 4) Dynamic Link Aggregation(802.3ad)</literal>.</simpara>
<simpara>oVirt supports the following bonding modes, because they can be used in virtual machine (bridged) networks:</simpara>
<variablelist>
<varlistentry>
<term><literal>(Mode 1) Active-Backup</literal></term>
<listitem>
<simpara>One NIC is active. If the active NIC fails, one of the backup NICs replaces it as the only active NIC in the bond. The MAC address of this bond is visible only on the network adapter port. This prevents MAC address confusion that might occur if the MAC address of the bond were to change, reflecting the MAC address of the new active NIC.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>(Mode 2) Load Balance (balance-xor)</literal></term>
<listitem>
<simpara>The NIC that transmits packets is selected by performing an XOR operation on the source MAC address and the destination MAC address, multiplied by the <literal>modulo</literal> of the total number of NICs. This algorithm ensures that the same NIC is selected for each destination MAC address.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>(Mode 3) Broadcast</literal></term>
<listitem>
<simpara>Packets are transmitted to all NICs.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>(Mode 4) Dynamic Link Aggregation(802.3ad)</literal> (Default)</term>
<listitem>
<simpara>The NICs are aggregated into groups that share the same speed and duplex settings . All the NICs in the active aggregation group are used.</simpara>
<note>
<simpara><literal>(Mode 4) Dynamic Link Aggregation(802.3ad)</literal> requires a switch that supports 802.3ad.</simpara>
<simpara>The bonded NICs must have the same aggregator IDs. Otherwise, the Engine displays a warning exclamation mark icon on the bond in the <emphasis role="strong">Network Interfaces</emphasis> tab and the <literal>ad_partner_mac</literal> value of the bond is reported as <literal>00:00:00:00:00:00</literal>. You can check the aggregator IDs by entering the following command:</simpara>
<screen># cat /proc/net/bonding/<emphasis>bond0</emphasis></screen>
<simpara>See <link xl:href="https://access.redhat.com/solutions/67546">https://access.redhat.com/solutions/67546</link>.</simpara>
</note>
</listitem>
</varlistentry>
</variablelist>
<simpara>The following bonding modes are incompatible with virtual machine logical networks and therefore only non-VM logical networks can be attached to bonds using these modes:</simpara>
<variablelist>
<varlistentry>
<term><literal>(Mode 0) Round-Robin</literal></term>
<listitem>
<simpara>The NICs transmit packets in sequential order. Packets are transmitted in a loop that begins with the first available NIC in the bond and ends with the last available NIC in the bond. Subsequent loops start with the first available NIC.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>(Mode 5) Balance-TLB</literal>, also called Transmit Load-Balance</term>
<listitem>
<simpara>Outgoing traffic is distributed, based on the load, over all the NICs in the bond. Incoming traffic is received by the active NIC. If the NIC receiving incoming traffic fails, another NIC is assigned.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>(Mode 6) Balance-ALB</literal>, also called Adaptive Load-Balance</term>
<listitem>
<simpara><literal>(Mode 5) Balance-TLB</literal> is combined with receive load-balancing for IPv4 traffic. ARP negotiation is used for balancing the receive load.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
</chapter>
<chapter xml:id="chap-Hosts">
<title>Hosts</title>
<section xml:id="Introduction_to_Hosts">
<title>Introduction to Hosts</title>
<simpara>Hosts, also known as hypervisors, are the physical servers on which virtual machines run. Full virtualization is provided by using a loadable Linux kernel module called Kernel-based Virtual Machine (KVM).</simpara>
<simpara>KVM can concurrently host multiple virtual machines running either Windows or Linux operating systems. Virtual machines run as individual Linux processes and threads on the host machine and are managed remotely by the oVirt Engine. A oVirt environment has one or more hosts attached to it.</simpara>
<simpara>oVirt supports two methods of installing hosts. You can use the oVirt Node (oVirt Node) installation media, or install hypervisor packages on a standard Enterprise Linux installation.</simpara>
<note>
<simpara>You can identify the host type of an individual host in the oVirt Engine by selecting the host&#8217;s name. This opens the details view. Then look at the <emphasis role="strong">OS Description</emphasis> under <emphasis role="strong">Software</emphasis>.</simpara>
</note>
<simpara>Hosts use <literal>tuned</literal> profiles, which provide virtualization optimizations. For more information on <literal>tuned</literal>, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Performance_Tuning_Guide/sect-Red_Hat_Enterprise_Linux-Performance_Tuning_Guide-Performance_Monitoring_Tools-tuned_and_tuned_adm.html"><emphasis>Enterprise Linux 7 Performance Tuning Guide</emphasis></link>.</simpara>
<simpara>The oVirt Node has security features enabled. Security Enhanced Linux (SELinux) and the firewall are fully configured and on by default. The status of SELinux on a selected host is reported under <emphasis role="strong">SELinux mode</emphasis> in the <emphasis role="strong">General</emphasis> tab of the details view. The Engine can open required ports on Enterprise Linux hosts when it adds them to the environment.</simpara>
<simpara>A host is a physical 64-bit server with the Intel VT or AMD-V extensions running Enterprise Linux 7 AMD64/Intel 64 version.</simpara>
<simpara>A physical host on the oVirt platform:</simpara>
<itemizedlist>
<listitem>
<simpara>Must belong to only one cluster in the system.</simpara>
</listitem>
<listitem>
<simpara>Must have CPUs that support the AMD-V or Intel VT hardware virtualization extensions.</simpara>
</listitem>
<listitem>
<simpara>Must have CPUs that support all functionality exposed by the virtual CPU type selected upon cluster creation.</simpara>
</listitem>
<listitem>
<simpara>Has a minimum of 2 GB RAM.</simpara>
</listitem>
<listitem>
<simpara>Can have an assigned system administrator with system permissions.</simpara>
</listitem>
</itemizedlist>
<simpara>Administrators can receive the latest security advisories from the oVirt watch list. Subscribe to the oVirt watch list to receive new security advisories for oVirt products by email. Subscribe by completing this form:</simpara>
<simpara><link xl:href="https://www.redhat.com/mailman/listinfo/rhsa-announce">https://www.redhat.com/mailman/listinfo/rhsa-announce</link></simpara>
</section>
<section xml:id="Intro_to_RHVH">
<title>oVirt Node</title>
<simpara>oVirt Node (oVirt Node) is installed using a special build of Enterprise Linux with only the packages required to host virtual machines. It uses an <literal>Anaconda</literal> installation interface based on the one used by Enterprise Linux hosts, and can be updated through the oVirt Engine or via <literal>yum</literal>. Using the <literal>yum</literal> command is the only way to install additional packages and have them persist after an upgrade.</simpara>
<simpara>oVirt Node features a Cockpit web interface for monitoring the host&#8217;s resources and performing administrative tasks. Direct access to oVirt Node via SSH or console is not supported, so the Cockpit web interface provides a graphical user interface for tasks that are performed before the host is added to the oVirt Engine, such as configuring networking and deploying a self-hosted engine, and can also be used to run terminal commands via the <emphasis role="strong">Terminal</emphasis> sub-tab.</simpara>
<simpara>Access the Cockpit web interface at https://<emphasis>HostFQDNorIP</emphasis>:9090 in your web browser. Cockpit for oVirt Node includes a custom <emphasis role="strong">Virtualization</emphasis> dashboard that displays the host&#8217;s health status, SSH Host Key, self-hosted engine status, virtual machines, and virtual machine statistics.</simpara>
<simpara>oVirt Node uses the Automatic Bug Reporting Tool (ABRT) to collect meaningful debug information about application crashes. For more information, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/system_administrators_guide/index#ch-abrt"><emphasis>Enterprise Linux System Administrator&#8217;s Guide</emphasis></link>.</simpara>
<note>
<simpara>Custom boot kernel arguments can be added to oVirt Node using the <literal>grubby</literal> tool. The <literal>grubby</literal> tool makes persistent changes to the <emphasis role="strong">grub.cfg</emphasis> file. Navigate to the <emphasis role="strong">Terminal</emphasis> sub-tab in the host&#8217;s Cockpit web interface to use <literal>grubby</literal> commands. See the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-Working_with_the_GRUB_2_Boot_Loader#sec-Making_Persistent_Changes_to_a_GRUB_2_Menu_Using_the_grubby_Tool"><emphasis>Enterprise Linux System Administrator&#8217;s Guide</emphasis></link> for more information.</simpara>
</note>
<warning>
<simpara>Do not create untrusted users on oVirt Node, as this can lead to exploitation of local security vulnerabilities.</simpara>
</warning>
</section>
<section xml:id="Adding_Red_Hat_Enterprise_Linux_Hosts">
<title>Enterprise Linux hosts</title>
<simpara>You can use a Enterprise Linux 7 installation on capable hardware as a host. oVirt supports hosts running Enterprise Linux 7 Server AMD64/Intel 64 version with Intel VT or AMD-V extensions. To use your Enterprise Linux machine as a host, you must also attach the <literal>Enterprise Linux Server</literal> and <literal>oVirt</literal> subscriptions.</simpara>
<simpara>Adding a host can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, and the creation of a bridge. Use the details view to monitor the process as the host and management system establish a connection.</simpara>
<simpara>Optionally, you can install a Cockpit web interface for monitoring the host&#8217;s resources and performing administrative tasks. The Cockpit web interface provides a graphical user interface for tasks that are performed before the host is added to the oVirt Engine, such as configuring networking and deploying a self-hosted engine, and can also be used to run terminal commands via the <emphasis role="strong">Terminal</emphasis> sub-tab.</simpara>
<important>
<simpara>Third-party watchdogs should not be installed on Enterprise Linux hosts, as they can interfere with the watchdog daemon provided by VDSM.</simpara>
</important>
</section>
<section xml:id="Satellite_Host_Provider_Hosts">
<title>Satellite Host Provider Hosts</title>
<simpara>Hosts provided by a Satellite host provider can also be used as virtualization hosts by the oVirt Engine. After a Satellite host provider has been added to the Engine as an external provider, any hosts that it provides can be added to and used in oVirt in the same way as oVirt Nodes (oVirt Node) and Enterprise Linux hosts.</simpara>
</section>
<section xml:id="sect-Host_Tasks">
<title>Host Tasks</title>
<section xml:id="Adding_standard_hosts_to_the_Manager_host_tasks">
<title>Adding Standard Hosts to the oVirt Engine</title>
<important>
<simpara>Always use the oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration. For details, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</link>.</simpara>
</important>
<simpara>Adding a host to your oVirt environment can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, and creation of a bridge.</simpara>
<important>
<simpara>OVS clusters cannot contain RHEL 8 hosts. Due to a known issue,  RHEL 8 hosts do not work in clusters whose <emphasis role="strong">Switch Type</emphasis> is <emphasis role="strong">OVS</emphasis>. For details, see <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1809116">BZ#1809116</link> and <link xl:href="https://access.redhat.com/solutions/901213">Open vSwitch and OpenFlow support for RHV</link>.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>From the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>New</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Use the drop-down list to select the <emphasis role="strong">Data Center</emphasis> and <emphasis role="strong">Host Cluster</emphasis> for the new host.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and the <emphasis role="strong">Address</emphasis> of the new host. The standard SSH port, port 22, is auto-filled in the <emphasis role="strong">SSH Port</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Select an authentication method to use for the Engine to access the host.</simpara>
<itemizedlist>
<listitem>
<simpara>Enter the root user&#8217;s password to use password authentication.</simpara>
</listitem>
<listitem>
<simpara>Alternatively, copy the key displayed in the <emphasis role="strong">SSH PublicKey</emphasis> field to <emphasis role="strong">/root/.ssh/authorized_keys</emphasis> on the host to use public key authentication.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optionally, click the <emphasis role="strong">Advanced Parameters</emphasis> button to change the following advanced host settings:</simpara>
<itemizedlist>
<listitem>
<simpara>Disable automatic firewall configuration.</simpara>
</listitem>
<listitem>
<simpara>Add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optionally configure power management, where the host has a supported power management card. For information on power management configuration, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Host_Power_Management_settings_explained">Host Power Management Settings Explained</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The new host displays in the list of hosts with a status of <literal>Installing</literal>, and you can view the progress of the installation in the <emphasis role="strong">Events</emphasis> section of the <emphasis role="strong">Notification Drawer</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/EventsIcon.png"/>
</imageobject>
<textobject><phrase>EventsIcon</phrase></textobject>
</inlinemediaobject>). After a brief delay the host status changes to <literal>Up</literal>.</simpara>
</section>
<section xml:id="Adding_a_Satellite_Host_Provider_Host">
<title>Adding a Satellite Host Provider Host</title>
<simpara>The process for adding a Satellite host provider host is almost identical to that of adding a Enterprise Linux host except for the method by which the host is identified in the Engine. The following procedure outlines how to add a host provided by a Satellite host provider.</simpara>
<simpara><emphasis role="strong">Adding a Satellite Host Provider Host</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the drop-down menu to select the <emphasis role="strong">Host Cluster</emphasis> for the new host.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Foreman/Satellite</emphasis> check box to display the options for adding a Satellite host provider host and select the provider from which the host is to be added.</simpara>
</listitem>
<listitem>
<simpara>Select either <emphasis role="strong">Discovered Hosts</emphasis> or <emphasis role="strong">Provisioned Hosts</emphasis>.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Discovered Hosts</emphasis> (default option): Select the host, host group, and compute resources from the drop-down lists.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Provisioned Hosts</emphasis>: Select a host from the <emphasis role="strong">Providers Hosts</emphasis> drop-down list.</simpara>
<simpara>Any details regarding the host that can be retrieved from the external provider are automatically set, and can be edited as desired.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">SSH Port</emphasis> (Provisioned Hosts only) of the new host.</simpara>
</listitem>
<listitem>
<simpara>Select an authentication method to use with the host.</simpara>
<itemizedlist>
<listitem>
<simpara>Enter the root user&#8217;s password to use password authentication.</simpara>
</listitem>
<listitem>
<simpara>Copy the key displayed in the <emphasis role="strong">SSH PublicKey</emphasis> field to <emphasis role="strong">/root/.ssh/authorized_hosts</emphasis> on the host to use public key authentication (Provisioned Hosts only).</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>You have now completed the mandatory steps to add a Enterprise Linux host. Click the <emphasis role="strong">Advanced Parameters</emphasis> drop-down button to show the advanced host settings.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Optionally disable automatic firewall configuration.</simpara>
</listitem>
<listitem>
<simpara>Optionally add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>You can configure the <emphasis role="strong">Power Management</emphasis>, <emphasis role="strong">SPM</emphasis>, <emphasis role="strong">Console</emphasis>, and <emphasis role="strong">Network Provider</emphasis> using the applicable tabs now; however, as these are not fundamental to adding a Enterprise Linux host, they are not covered in this procedure.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to add the host and close the window.</simpara>
</listitem>
</orderedlist>
<simpara>The new host displays in the list of hosts with a status of <literal>Installing</literal>, and you can view the progress of the installation in the details view. After installation is complete, the status will update to <literal>Reboot</literal>. The host must be activated for the status to change to <literal>Up</literal>.</simpara>
</section>
<section xml:id="Configuring_Satellite_Errata_Management_for_a_Host">
<title>Setting up Satellite errata viewing for a host</title>
<simpara>In the Administration Portal, you can configure a host to view errata from Red Hat Satellite. After you associate a host with a Red Hat Satellite provider, you can receive updates in the host configuration dashboard about available errata and their importance, and decide when it is practical to apply the updates.</simpara>
<simpara>oVirt 4.4 supports viewing errata with Red Hat Satellite 6.6.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The Satellite server must be added as an external provider.</simpara>
</listitem>
<listitem>
<simpara>The Engine and any hosts on which you want to view errata must be registered in the Satellite server by their respective FQDNs. This ensures that external content host IDs do not need to be maintained in oVirt.</simpara>
<important>
<simpara>Hosts added using an IP address cannot report errata.</simpara>
</important>
</listitem>
<listitem>
<simpara>The Satellite account that manages the host must have Administrator permissions and a default organization set.</simpara>
</listitem>
<listitem>
<simpara>The host must be registered to the Satellite server.</simpara>
</listitem>
<listitem>
<simpara>Use Red Hat Satellite remote execution to manage packages on hosts.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely.</simpara>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Use Foreman/Satellite</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Select the required Satellite server from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The host is now configured to show the available errata, and their importance, in the same dashboard used to manage the host&#8217;s configuration.</simpara>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning"/></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/managing_hosts/host-management-without-goferd-and-katello-agent_managing-hosts">Host Management Without Goferd and Katello Agent</link> in the Red Hat Satellite document <emphasis>Managing Hosts</emphasis></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="sect-Explanation_of_Settings_and_Controls_in_the_New_Host_and_Edit_Host_Windows">
<title>Explanation of Settings and Controls in the New Host and Edit Host Windows</title>

</section>
<section xml:id="Host_General_Settings">
<title>Host General Settings Explained</title>
<simpara>These settings apply when editing the details of a host or adding new Enterprise Linux hosts and Satellite host provider hosts.</simpara>
<simpara>The <emphasis role="strong">General</emphasis> settings table contains the information required on the <emphasis role="strong">General</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">General</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Host Cluster</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The cluster and data center to which the host belongs.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Use Foreman/Satellite</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select or clear this check box to view or hide options for adding hosts provided by Satellite host providers. The following options are also available:</simpara>
<simpara><emphasis role="strong">Discovered Hosts</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Discovered Hosts</emphasis> - A drop-down list that is populated with the name of Satellite hosts discovered by the engine.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Host Groups</emphasis> -A drop-down list of host groups available.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Compute Resources</emphasis> - A drop-down list of hypervisors to provide compute resources.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Provisioned Hosts</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Providers Hosts</emphasis> - A drop-down list that is populated with the name of hosts provided by the selected external provider. The entries in this list are filtered in accordance with any search queries that have been input in the <emphasis role="strong">Provider search filter</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Provider search filter</emphasis> - A text field that allows you to search for hosts provided by the selected external provider. This option is provider-specific; see provider documentation for details on forming search queries for specific providers. Leave this field blank to view all available hosts.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the host. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Comment</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A field for adding plain text, human-readable comments regarding the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hostname</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The IP address or resolvable host name of the host. If a resolvable hostname is used, you must ensure that all addresses that the hostname is resolved to match the IP addresses, IPv4 and IPv6, used by the management network of the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Password</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The password of the host&#8217;s root user. Set the password when adding the host. The password cannot be edited afterwards.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Activate host after install</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this checkbox to activate the host after successful installation. This is enabled by default and required for the hypervisors to be activated successfully.</simpara>
<simpara>After successful installation, you can clear this checkbox to switch the host status to Maintenance. This allows the administrator to perform additional configuration tasks on the hypervisors.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Reboot host after install</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this checkbox to reboot the host after it is installed. This is enabled by default.</simpara>
<note>
<simpara>Changing the kernel command line parameters of the host, or changing the firewall type of the cluster also require you to reboot the host.</simpara>
</note></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">SSH Public Key</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Copy the contents in the text box to the <emphasis role="strong">/root/.ssh/authorized_hosts</emphasis> file on the host to use the Engine&#8217;s SSH key instead of a password to authenticate with a host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Automatically configure host firewall</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>When adding a new host, the Engine can open the required ports on the host&#8217;s firewall. This is enabled by default. This is an <emphasis role="strong">Advanced Parameter</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">SSH Fingerprint</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>You can <emphasis role="strong">fetch</emphasis> the host&#8217;s SSH fingerprint, and compare it with the fingerprint you expect the host to return, ensuring that they match. This is an <emphasis role="strong">Advanced Parameter</emphasis>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Host_Power_Management_settings_explained">
<title>Host Power Management Settings Explained</title>
<simpara>The <emphasis role="strong">Power Management</emphasis> settings table contains the information required on the <emphasis role="strong">Power Management</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> windows. You can configure power management if the host has a supported power management card.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Power Management</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Power Management</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables power management on the host. Select this check box to enable the rest of the fields in the <emphasis role="strong">Power Management</emphasis> tab.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Kdump integration</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Prevents the host from fencing while performing a kernel crash dump, so that the crash dump is not interrupted. In Enterprise Linux 7.1 and later, kdump is available by default. If kdump is available on the host, but its configuration is not valid (the kdump service cannot be started), enabling <emphasis role="strong">Kdump integration</emphasis> will cause the host (re)installation to fail. If this is the case, see <xref linkend="sect-fence_kdump_Advanced_Configuration"/>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Disable policy control of power management</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Power management is controlled by the <emphasis role="strong">Scheduling Policy</emphasis> of the host&#8217;s <emphasis role="strong">cluster</emphasis>. If power management is enabled and the defined low utilization value is reached, the Engine will power down the host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. Select this check box to disable policy control.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Agents by Sequential Order</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Lists the host&#8217;s fence agents. Fence agents can be sequential, concurrent, or a mix of both.</simpara>
<itemizedlist>
<listitem>
<simpara>If fence agents are used sequentially, the primary agent is used first to stop or start a host, and if it fails, the secondary agent is used.</simpara>
</listitem>
<listitem>
<simpara>If fence agents are used concurrently, both fence agents have to respond to the Stop command for the host to be stopped; if one agent responds to the Start command, the host will go up.</simpara>
</listitem>
</itemizedlist>
<simpara>Fence agents are sequential by default. Use the up and down buttons to change the sequence in which the fence agents are used.</simpara>
<simpara>To make two fence agents concurrent, select one fence agent from the <emphasis role="strong">Concurrent with</emphasis> drop-down list next to the other fence agent. Additional fence agents can be added to the group of concurrent fence agents by selecting the group from the <emphasis role="strong">Concurrent with</emphasis> drop-down list next to the additional fence agent.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Add Fence Agent</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Click the <emphasis role="strong">+</emphasis> button to add a new fence agent. The <emphasis role="strong">Edit fence agent</emphasis> window opens. See the table below for more information on the fields in this window.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Power Management Proxy Preference</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>By default, specifies that the Engine will search for a fencing proxy within the same <emphasis role="strong">cluster</emphasis> as the host, and if no fencing proxy is found, the Engine will search in the same <emphasis role="strong">dc</emphasis> (data center). Use the up and down buttons to change the sequence in which these resources are used. This field is available under <emphasis role="strong">Advanced Parameters</emphasis>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The following table contains the information required in the <emphasis role="strong">Edit fence agent</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Edit fence agent</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Address</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The address to access your host&#8217;s power management device. Either a resolvable hostname or an IP address.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">User Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>User account with which to access the power management device. You can set up a user on the device, or use the default user.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Password</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Password for the user accessing the power management device.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The type of power management device in your host. Choose one of the following:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">apc</emphasis> - APC MasterSwitch network power switch. Not for use with APC 5.x power switch devices.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">apc_snmp</emphasis> - Use with APC 5.x power switch devices.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">bladecenter</emphasis> - IBM Bladecenter Remote Supervisor Adapter.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">cisco_ucs</emphasis> - Cisco Unified Computing System.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">drac5</emphasis> - Dell Remote Access Controller for Dell computers.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">drac7</emphasis> - Dell Remote Access Controller for Dell computers.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">eps</emphasis> - ePowerSwitch 8M+ network power switch.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">hpblade</emphasis> - HP BladeSystem.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ilo</emphasis>, <emphasis role="strong">ilo2</emphasis>, <emphasis role="strong">ilo3</emphasis>, <emphasis role="strong">ilo4</emphasis> - HP Integrated Lights-Out.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ipmilan</emphasis> - Intelligent Platform Management Interface and Sun Integrated Lights Out Management devices.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">rsa</emphasis> - IBM Remote Supervisor Adapter.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">rsb</emphasis> - Fujitsu-Siemens RSB management interface.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">wti</emphasis> - WTI Network Power Switch.</simpara>
</listitem>
</itemizedlist>
<simpara>For more information about power management devices, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/index#power_management">Power Management</link> in the <emphasis>Technical Reference</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Port</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The port number used by the power management device to communicate with the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Slot</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The number used to identify the blade of the power management device.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Service Profile</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The service profile name used to identify the blade of the power management device. This field appears instead of <emphasis role="strong">Slot</emphasis> when the device type is <literal>cisco_ucs</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Options</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Power management device specific options. Enter these as 'key=value'. See the documentation of your host&#8217;s power management device for the options available.</simpara><simpara>For Enterprise Linux 7 hosts, if you are using cisco_ucs as the power management device, you also need to append <literal>ssl_insecure=1</literal> to the <emphasis role="strong">Options</emphasis> field.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Secure</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this check box to allow the power management device to connect securely to the host. This can be done via ssh, ssl, or other authentication protocols depending on the power management agent.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="SPM_priority_settings_explained">
<title>SPM Priority Settings Explained</title>
<simpara>The <emphasis role="strong">SPM</emphasis> settings table details the information required on the <emphasis role="strong">SPM</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">SPM</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">SPM Priority</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Defines the likelihood that the host will be given the role of Storage Pool Manager (SPM). The options are <emphasis role="strong">Low</emphasis>, <emphasis role="strong">Normal</emphasis>, and <emphasis role="strong">High</emphasis> priority. Low priority means that there is a reduced likelihood of the host being assigned the role of SPM, and High priority means there is an increased likelihood. The default setting is Normal.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Host_Console_Settings_Explained">
<title>Host Console Settings Explained</title>
<simpara>The <emphasis role="strong">Console</emphasis> settings table details the information required on the <emphasis role="strong">Console</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Console</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Override display address</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this check box to override the display addresses of the host. This feature is useful in a case where the hosts are defined by internal IP and are behind a NAT firewall. When a user connects to a virtual machine from outside of the internal network, instead of returning the private address of the host on which the virtual machine is running, the machine returns a public IP or FQDN (which is resolved in the external network to the public IP).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Display address</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The display address specified here will be used for all virtual machines running on this host. The address must be in the format of a fully qualified domain name or IP.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Network_Provider_Settings_Explained">
<title>Network Provider Settings Explained</title>
<simpara>The <emphasis role="strong">Network Provider</emphasis> settings table details the information required on the <emphasis role="strong">Network Provider</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Network Provider</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">External Network Provider</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If you have added an external network provider and want the host&#8217;s network to be provisioned by the external network provider, select one from the list.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Kernel_Settings_Explained">
<title>Kernel Settings Explained</title>
<simpara>The <emphasis role="strong">Kernel</emphasis> settings table details the information required on the <emphasis role="strong">Kernel</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window. Common kernel boot parameter options are listed as check boxes so you can easily select them.</simpara>
<simpara>For more complex changes, use the free text entry field next to <emphasis role="strong">Kernel command line</emphasis> to add in any additional parameters required. If you change any kernel command line parameters, you must  <link linkend="Reinstalling_Hosts_admin">reinstall the host</link>.</simpara>
<important>
<simpara>If the host is attached to the Engine, you must place the host into maintenance mode before making changes. After making the changes, <link linkend="Reinstalling_Hosts_admin">reinstall the host</link> to apply the changes.</simpara>
</important>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Kernel</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Hostdev Passthrough &amp; SR-IOV</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables the IOMMU flag in the kernel so a virtual machine can use a host device as if it is attached directly to the virtual machine. The host hardware and firmware must also support IOMMU. The virtualization extension and IOMMU extension must be enabled on the hardware. See <link linkend="Configuring_a_Host_for_PCI_Passthrough_host_tasks">Configuring a Host for PCI Passthrough</link>. IBM POWER8 has IOMMU enabled by default.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Nested Virtualization</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables the <literal>vmx</literal> or <literal>svm</literal> flag so virtual machines can run within virtual machines. This option is a Technology Preview feature: It is intended only for evaluation purposes. It is not supported for production purposes. To use this setting, you must install the <literal>vdsm-hook-nestedvt</literal> hook on the host. For details, see <link linkend="proc-enabling-nested-virtualization-for-all-virtual-machines">Enabling nested virtualization for all virtual machines</link> and <link linkend="proc-enabling-nested-virtualization-for-individual-virtual-machines">Enabling nested virtualization for individual virtual machines</link></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Unsafe Interrupts</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If IOMMU is enabled but the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling this option. Note that you should only enable this option if the virtual machines on the host are trusted; having the option enabled potentially exposes the host to MSI attacks from the virtual machines. This option is only intended to be used as a workaround when using uncertified hardware for evaluation purposes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">PCI Reallocation</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>If your SR-IOV NIC is unable to allocate virtual functions because of memory issues, consider enabling this option. The host hardware and firmware must also support PCI reallocation. This option is only intended to be used as a workaround when using uncertified hardware for evaluation purposes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Blacklist Nouveau</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Blocks the nouveau driver. Nouveau is a community driver for NVIDIA GPUs that conflicts with vendor-supplied drivers. The nouveau driver should be blocked when vendor drivers take precedence.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">SMT Disabled</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Disables Simultaneous Multi Threading (SMT). Disabling SMT can mitigate security vulnerabilities, such as L1TF or MDS.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">FIPS mode</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables FIPS mode. For details, see <xref linkend="enabling_fips_using_the_rhv_manager_appendix_fips"/>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Kernel command line</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field allows you to append more kernel parameters to the default parameters.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<note>
<simpara>If the kernel boot parameters are grayed out, click the <emphasis role="strong">reset</emphasis> button and the options will be available.</simpara>
</note>
</section>
<section xml:id="Hosted_Engine_Settings_Explained">
<title>Hosted Engine Settings Explained</title>
<simpara>The <emphasis role="strong">Hosted Engine</emphasis> settings table details the information required on the <emphasis role="strong">Hosted Engine</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Hosted Engine</emphasis> Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Choose hosted engine deployment action</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Three options are available:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">None</emphasis> - No actions required.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Deploy</emphasis> - Select this option to deploy the host as a self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Undeploy</emphasis> - For a self-hosted engine node, you can select this option to undeploy the host and remove self-hosted engine related configurations.</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Configuring_Host_Power_Management_Settings">
<title>Configuring Host Power Management Settings</title>
<simpara>Configure your host power management device settings to perform host life-cycle operations (stop, start, restart) from the Administration Portal.</simpara>
<simpara>You must configure host power management in order to utilize host high availability and virtual machine high availability. For more information about power management devices, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/index#power_management">Power Management</link> in the <emphasis>Technical Reference</emphasis>.</simpara>
<simpara><emphasis role="strong">Configuring Power Management Settings</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice>, and click <guibutton>OK</guibutton> to confirm.</simpara>
</listitem>
<listitem>
<simpara>When the host is in maintenance mode, click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Power Management</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Enable Power Management</emphasis> check box to enable the fields.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Kdump integration</emphasis> check box to prevent the host from fencing while performing a kernel crash dump.</simpara>
<important>
<simpara>If you enable or disable <emphasis role="strong">Kdump integration</emphasis> on an existing host, you must <link linkend="Reinstalling_Hosts_admin">reinstall the host</link> for kdump to be configured.</simpara>
</important>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Disable policy control of power management</emphasis> check box if you do not want your host&#8217;s power management to be controlled by the <emphasis role="strong">Scheduling Policy</emphasis> of the host&#8217;s <emphasis role="strong">cluster</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the plus (<emphasis role="strong">+</emphasis>) button to add a new power management device. The <emphasis role="strong">Edit fence agent</emphasis> window opens.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">User Name</emphasis> and <emphasis role="strong">Password</emphasis> of the power management device into the appropriate fields.</simpara>
</listitem>
<listitem>
<simpara>Select the power management device <emphasis role="strong">Type</emphasis> in the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the IP address in the <emphasis role="strong">Address</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">SSH Port</emphasis> number used by the power management device to communicate with the host.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Slot</emphasis> number used to identify the blade of the power management device.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Options</emphasis> for the power management device. Use a comma-separated list of <emphasis>'key=value'</emphasis> entries.</simpara>
<itemizedlist>
<listitem>
<simpara>If both IPv4 and IPv6 IP addresses can be used (default), leave the <emphasis role="strong">Options</emphasis> field blank.</simpara>
</listitem>
<listitem>
<simpara>If only IPv4 IP addresses can be used, enter <literal>inet4_only=1</literal>.</simpara>
</listitem>
<listitem>
<simpara>If only IPv6 IP addresses can be used, enter <literal>inet6_only=1</literal>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Secure</emphasis> check box to enable the power management device to connect securely to the host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to ensure the settings are correct. <emphasis role="strong">Test Succeeded, Host Status is: on</emphasis> will display upon successful verification.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to close the <emphasis role="strong">Edit fence agent</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Power Management</emphasis> tab, optionally expand the <emphasis role="strong">Advanced Parameters</emphasis> and use the up and down buttons to specify the order in which the Engine will search the host&#8217;s <emphasis role="strong">cluster</emphasis> and <emphasis role="strong">dc</emphasis> (datacenter) for a fencing proxy.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<itemizedlist>
<listitem>
<simpara>For IPv6, oVirt supports only static addressing.</simpara>
</listitem>
<listitem>
<simpara>Dual-stack <emphasis role="strong">IPv4 and IPv6</emphasis> addressing is not supported.</simpara>
</listitem>
</itemizedlist>
</note>
<simpara>The <menuchoice><guimenu>Management</guimenu> <guimenuitem>Power Management</guimenuitem></menuchoice> drop-down menu is now enabled in the Administration Portal.</simpara>
</section>
<section xml:id="Configuring_Host_SPM_Settings">
<title>Configuring Host Storage Pool Manager Settings</title>
<simpara>The Storage Pool Manager (SPM) is a management role given to one of the hosts in a data center to maintain access control over the storage domains. The SPM must always be available, and the SPM role will be assigned to another host if the SPM host becomes unavailable. As the SPM role uses some of the host&#8217;s available resources, it is important to prioritize hosts that can afford the resources.</simpara>
<simpara>The Storage Pool Manager (SPM) priority setting of a host alters the likelihood of the host being assigned the SPM role: a host with high SPM priority will be assigned the SPM role before a host with low SPM priority.</simpara>
<simpara><emphasis role="strong">Configuring SPM settings</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">SPM</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Use the radio buttons to select the appropriate SPM priority for the host.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Configuring_a_Host_for_PCI_Passthrough_host_tasks">
<title>Configuring a Host for PCI Passthrough</title>
<note>
<simpara>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</link></simpara>
</note>
<simpara>Enabling PCI passthrough allows a virtual machine to use a host device as if the device were directly attached to the virtual machine. To enable the PCI passthrough function, you must enable virtualization extensions and the IOMMU function. The following procedure requires you to reboot the host. If the host is attached to the Engine already, ensure you place the host into maintenance mode first.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that the host hardware meets the requirements for PCI device passthrough and assignment. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#PCI_Device_Requirements_RHV_planning">PCI Device Requirements</link> for more information.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Configuring a Host for PCI Passthrough</title>
<listitem>
<simpara>Enable the virtualization extension and IOMMU extension in the BIOS. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Troubleshooting-Enabling_Intel_VT_x_and_AMD_V_virtualization_hardware_extensions_in_BIOS.html">Enabling Intel VT-x and AMD-V virtualization hardware extensions in BIOS</link> in the <emphasis>Enterprise Linux Virtualization Deployment and Administration Guide</emphasis> for more information.</simpara>
</listitem>
<listitem>
<simpara>Enable the IOMMU flag in the kernel by selecting the <emphasis role="strong">Hostdev Passthrough &amp; SR-IOV</emphasis> check box when adding the host to the Engine or by editing the <emphasis role="strong">grub</emphasis> configuration file manually.</simpara>
<itemizedlist>
<listitem>
<simpara>To enable the IOMMU flag from the Administration Portal, see <link xl:href="https://ovirt.org/documentation/administration_guide#Adding_standard_hosts_to_the_Manager">Adding Standard Hosts to the oVirt Engine</link> and <link xl:href="https://ovirt.org/documentation/administration_guide#Kernel_Settings_Explained">Kernel Settings Explained</link>.</simpara>
</listitem>
<listitem>
<simpara>To edit the <emphasis role="strong">grub</emphasis> configuration file manually, see  <link linkend="Enabling_IOMMU_Manually">Enabling IOMMU Manually</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>For GPU passthrough, you need to run additional configuration steps on both the host and the guest system. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/setting_up_an_nvidia_gpu_for_a_virtual_machine_in_red_hat_virtualization/index#proc_nvidia_gpu_passthrough_nvidia_gpu_passthrough">GPU device passthrough: Assigning a host GPU to a single virtual machine</link> in <emphasis>Setting up an NVIDIA GPU for a virtual machine in Red Hat Virtualization</emphasis> for more information.</simpara>
</listitem>
</orderedlist>
<orderedlist xml:id="Enabling_IOMMU_Manually" numeration="arabic">
<title>Enabling IOMMU Manually</title>
<listitem>
<simpara>Enable IOMMU by editing the grub configuration file.</simpara>
<note>
<simpara>If you are using IBM POWER8 hardware, skip this step as IOMMU is enabled by default.</simpara>
</note>
<itemizedlist>
<listitem>
<simpara>For Intel, boot the machine, and append <literal>intel_iommu=on</literal> to the end of the <literal>GRUB_CMDLINE_LINUX</literal> line in the <emphasis role="strong">grub</emphasis> configuration file.</simpara>
<screen># vi /etc/default/grub
...
GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 ... intel_iommu=on
...</screen>
</listitem>
<listitem>
<simpara>For AMD, boot the machine, and append <literal>amd_iommu=on</literal> to the end of the <literal>GRUB_CMDLINE_LINUX</literal> line in the <emphasis role="strong">grub</emphasis> configuration file.</simpara>
<screen># vi /etc/default/grub
...
GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 ... amd_iommu=on
...</screen>
<note>
<simpara>If <literal>intel_iommu=on</literal> or <literal>amd_iommu=on</literal> works, you can try adding <literal>iommu=pt</literal> or <literal>amd_iommu=pt</literal>. The <literal>pt</literal> option only enables IOMMU for devices used in passthrough and provides better host performance. However, the option might not be supported on all hardware. Revert to previous option if the <literal>pt</literal> option doesn&#8217;t work for your host.</simpara>
<simpara>If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the <literal>allow_unsafe_interrupts</literal> option if the virtual machines are trusted. The <literal>allow_unsafe_interrupts</literal> is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:</simpara>
<screen># vi /etc/modprobe.d
options vfio_iommu_type1 allow_unsafe_interrupts=1</screen>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Refresh the <emphasis role="strong">grub.cfg</emphasis> file and reboot the host for these changes to take effect:</simpara>
<screen># grub2-mkconfig -o /boot/grub2/grub.cfg</screen>
<screen># reboot</screen>
</listitem>
</orderedlist>
<simpara>To enable SR-IOV and assign dedicated virtual NICs to virtual machines, see <link xl:href="https://access.redhat.com/articles/2335291">https://access.redhat.com/articles/2335291</link>.</simpara>
</section>
<section xml:id="proc-enabling-nested-virtualization-for-all-virtual-machines">
<title>Enabling nested virtualization for all virtual machines</title>
<important>
<simpara>Using hooks to enable nested virtualization is a Technology Preview feature. Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information, see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</link>.</simpara>
</important>
<simpara>Nested virtualization enables virtual machines to host other virtual machines. For clarity, we will call these the <emphasis>parent virtual machines</emphasis> and <emphasis>nested virtual machines</emphasis>.</simpara>
<simpara>Child virtual machines are only visible to and managed by users who have access to the parent virtual machine. They are not visible to oVirt (oVirt) administrators.</simpara>
<simpara>By default, nested virtualization is not enabled in oVirt. To enable nested virtualization, you install a VDSM hook, <literal>vdsm-hook-nestedvt</literal>, on all of the hosts in the cluster. Then, all of the virtual machines that run on these hosts can function as parent virtual machines.</simpara>
<simpara>You should only run parent virtual machines on hosts that support nested virtualization. If a parent virtual machine migrates to a host that does not support nested virtualization, its child virtual machines fail. To prevent this from happening, configure all of the hosts in the cluster to support nested virtualization. Otherwise, restrict parent virtual machines from migrating to hosts that do not support nested virtualization.</simpara>
<warning>
<simpara>Take precautions to prevent parent virtual machines from migrating to hosts that do not support nested virtualization.</simpara>
</warning>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a host in the cluster where you want to enable nested virtualization and click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Select the host again, click <guibutton>Host Console</guibutton>, and log into the host console.</simpara>
</listitem>
<listitem>
<simpara>Install the VDSM hook:</simpara>
<screen># dnf install vdsm-hook-nestedvt</screen>
</listitem>
<listitem>
<simpara>Reboot the host.</simpara>
</listitem>
<listitem>
<simpara>Log into the host console again and verify that nested virtualization is enabled:</simpara>
<screen>$ cat /sys/module/kvm*/parameters/nested</screen>
<simpara>If this command returns <literal>Y</literal> or <literal>1</literal>, the feature is enabled.</simpara>
</listitem>
<listitem>
<simpara>Repeat this procedure for all of the hosts in the cluster.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="VDSM_hooks"/></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="proc-enabling-nested-virtualization-for-individual-virtual-machines">
<title>Enabling nested virtualization for individual virtual machines</title>
<important>
<simpara>Nested virtualization is a Technology Preview feature. Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information see <link xl:href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</link>.</simpara>
</important>
<simpara>Nested virtualization enables virtual machines to host other virtual machines. For clarity, we will call these the <emphasis>parent virtual machines</emphasis> and <emphasis>nested virtual machines</emphasis>.</simpara>
<simpara>Child virtual machines are only visible to and managed by users who have access to the parent virtual machine. They are not visible to oVirt (oVirt) administrators.</simpara>
<simpara>To enable nested virtualization <emphasis>on specific virtual machines</emphasis>, not all virtual machines, you configure a host or hosts to support nested virtualization. Then you configure the virtual machine or virtual machines on run on those specific hosts and enable <emphasis role="strong">Pass-Through Host CPU</emphasis>. This option lets the virtual machines use the nested virtualization settings you just configured on the host. This option also restricts which hosts the virtual machines can run on and requires manual migration.</simpara>
<simpara>Otherwise, to enable nested virtualization for <emphasis>all of the virtual machines</emphasis> in a cluster, see <xref linkend="proc-enabling-nested-virtualization-for-all-virtual-machines"/></simpara>
<simpara>Only run parent virtual machines on hosts that support nested virtualization. If you migrate a parent virtual machine to a host that does not support nested virtualization, its child virtual machines will fail.</simpara>
<warning>
<simpara>Do not migrate parent virtual machines to hosts that do not support nested virtualization.</simpara>
</warning>
<simpara>Avoid live migration of parent virtual machines that are running child virtual machines. Even if the source and destination hosts are identical and support nested virtualization, the live migration can cause the child virtual machines to fail. Instead, shut down virtual machines before migration.</simpara>
<formalpara>
<title>Procedure</title>
<para>Configure the hosts to support nested virtualization:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a host in the cluster where you want to enable nested virtualization and click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Select the host again, click <guibutton>Host Console</guibutton>, and log into the host console.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Edit Host</emphasis> window, select the <emphasis role="strong">Kernel</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Kernel boot parameters</emphasis>, if the checkboxes are greyed-out, click <guibutton>RESET</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Nested Virtualization</emphasis> and click <guibutton>OK</guibutton>.</simpara>
<simpara>This action displays a <literal>kvm-&lt;architecture&gt;.nested=1</literal> parameter in <emphasis role="strong">Kernel command line</emphasis>. The following steps add this parameter to the <emphasis role="strong">Current kernel CMD line</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>When the host status returns to <literal>Up</literal>, click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Restart</guimenuitem></menuchoice> under <emphasis role="strong">Power Management</emphasis> or <emphasis role="strong">SSH Management</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Verify that nested virtualization is enabled. Log into the host console and enter:</simpara>
<screen>$ cat /sys/module/kvm*/parameters/nested</screen>
<simpara>If this command returns <literal>Y</literal> or <literal>1</literal>, the feature is enabled.</simpara>
</listitem>
<listitem>
<simpara>Repeat this procedure for all of the hosts you need to run parent virtual machines.</simpara>
</listitem>
</orderedlist>
<simpara>Enable nested virtualization in specific virtual machines:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine and click <guibutton>Edit</guibutton></simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Edit Vitual Machine</emphasis> window, click <guibutton>Show Advanced Options</guibutton> and select the <emphasis role="strong">Host</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Start Running On</emphasis>, click <emphasis role="strong">Specific Host</emphasis> and select the host or hosts you configured to support nested virtualization.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">CPU Options</emphasis>, select <emphasis role="strong">Pass-Through Host CPU</emphasis>. This action automatically sets the <emphasis role="strong">Migration mode</emphasis> to <emphasis role="strong">Allow manual migration only</emphasis>.</simpara>
<note>
<simpara>In RHV version 4.2, you can only enable <emphasis role="strong">Pass-Through Host CPU</emphasis> when <emphasis role="strong">Do not allow migration</emphasis> is selected.</simpara>
</note>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="VDSM_hooks"/></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/creating-nested-virtual-machines_configuring-and-managing-virtualization">Creating Child virtual Machines</link> in the EL documentation.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Moving_a_host_to_maintenance_mode">
<title>Moving a Host to Maintenance Mode</title>
<simpara>Many common maintenance tasks, including network configuration and deployment of software updates, require that hosts be placed into maintenance mode. Hosts should be placed into maintenance mode before any event that might cause VDSM to stop working properly, such as a reboot, or issues with networking or storage.</simpara>
<simpara>When a host is placed into maintenance mode the oVirt Engine attempts to migrate all running virtual machines to alternative hosts. The standard prerequisites for live migration apply, in particular there must be at least one active host in the cluster with capacity to run the migrated virtual machines.</simpara>
<note>
<simpara>Virtual machines that are pinned to the host and cannot be migrated are shut down. You can check which virtual machines are pinned to the host by clicking <guibutton>Pinned to Host</guibutton> in the <emphasis role="strong">Virtual Machines</emphasis> tab of the host&#8217;s details view.</simpara>
</note>
<simpara><emphasis role="strong">Placing a Host into Maintenance Mode</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the desired host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Maintenance Host(s)</emphasis> confirmation window.</simpara>
</listitem>
<listitem>
<simpara>Optionally, enter a <emphasis role="strong">Reason</emphasis> for moving the host into maintenance mode, which will appear in the logs and when the host is activated again. Then, click <guibutton>OK</guibutton></simpara>
<note>
<simpara>The host maintenance <emphasis role="strong">Reason</emphasis> field will only appear if it has been enabled in the cluster settings. See <xref linkend="Cluster_General_Settings_Explained"/> for more information.</simpara>
</note>
</listitem>
<listitem>
<simpara>Optionally, select the required options for hosts that support Gluster.</simpara>
<simpara>Select the <emphasis role="strong">Ignore Gluster Quorum and Self-Heal Validations</emphasis> option to avoid the default checks. By default, the Engine checks that the Gluster quorum is not lost when the host is moved to maintenance mode. The Engine also checks that there is no self-heal activity that will be affected by moving the host to maintenance mode. If the Gluster quorum will be lost or if there is self-heal activity that will be affected, the Engine prevents the host from being placed into maintenance mode. Only use this option if there is no other way to place the host in maintenance mode.</simpara>
<simpara>Select the <emphasis role="strong">Stop Gluster Service</emphasis> option to stop all Gluster services while moving the host to maintenance mode.</simpara>
<note>
<simpara>These fields will only appear in the host maintenance window when the selected host supports Gluster. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#maintenance_tasks">Replacing the Primary Gluster Storage Node</link> in <emphasis>Maintaining Red Hat Hyperconverged Infrastructure</emphasis> for more information.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to initiate maintenance mode.</simpara>
</listitem>
</orderedlist>
<simpara>All running virtual machines are migrated to alternative hosts. If the host is the Storage Pool Manager (SPM), the SPM role is migrated to another host. The <emphasis role="strong">Status</emphasis> field of the host changes to <literal>Preparing for Maintenance</literal>, and finally <literal>Maintenance</literal> when the operation completes successfully. VDSM does not stop while the host is in maintenance mode.</simpara>
<note>
<simpara>If migration fails on any virtual machine, click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice> on the host to stop the operation placing it into maintenance mode, then click <emphasis role="strong">Cancel Migration</emphasis> on the virtual machine to stop the migration.</simpara>
</note>
</section>
<section xml:id="Activating_a_host_from_maintenance_mode">
<title>Activating a Host from Maintenance Mode</title>
<simpara>A host that has been placed into maintenance mode, or recently added to the environment, must be activated before it can be used. Activation may fail if the host is not ready; ensure that all tasks are complete before attempting to activate the host.</simpara>
<simpara><emphasis role="strong">Activating a Host from Maintenance Mode</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
<simpara>The host status changes to <literal>Unassigned</literal>, and finally <literal>Up</literal> when the operation is complete. Virtual machines can now run on the host. Virtual machines that were migrated off the host when it was placed into maintenance mode are not automatically migrated back to the host when it is activated, but can be migrated manually. If the host was the Storage Pool Manager (SPM) before being placed into maintenance mode, the SPM role does not return automatically when the host is activated.</simpara>
</section>
<section xml:id="Configuring_Host_Firewall_Rules">
<title>Configuring Host Firewall Rules</title>
<simpara>You can configure the host firewall rules so that they are persistent, using Ansible. The cluster must be configured to use <literal>firewalld</literal>.</simpara>
<orderedlist numeration="arabic">
<title>Configuring Firewall Rules for Hosts</title>
<listitem>
<simpara>On the Engine machine, edit <emphasis role="strong">ovirt-host-deploy-post-tasks.yml.example</emphasis> to add a custom firewall port:</simpara>
<screen># vi /etc/ovirt-engine/ansible/ovirt-host-deploy-post-tasks.yml.example
---
#
# Any additional tasks required to be executing during host deploy process can
# be added below
#
- name: Enable additional port on firewalld
  firewalld:
    port: "<emphasis>12345/tcp</emphasis>"
    permanent: yes
    immediate: yes
    state: enabled</screen>
</listitem>
<listitem>
<simpara>Save the file to another location as <emphasis role="strong">ovirt-host-deploy-post-tasks.yml</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>New or reinstalled hosts are configured with the updated firewall rules.</simpara>
<simpara>Existing hosts must be reinstalled by clicking <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice> and selecting <emphasis role="strong">Automatically configure host firewall</emphasis>.</simpara>
</section>
<section xml:id="Removing_a_host">
<title>Removing a Host</title>
<simpara>Removing a host from your oVirt environment is sometimes necessary, such as when you need to reinstall a host.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Once the host is in maintenance mode, click <emphasis role="strong">Remove</emphasis>. The <emphasis role="strong">Remove Host(s)</emphasis> confirmation window opens.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Force Remove</emphasis> check box if the host is part of a Gluster Storage cluster and has volume bricks on it, or if the host is non-responsive.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Updating_a_host_between_minor_releases">
<title>Updating Hosts Between Minor Releases</title>
<simpara>You can update <link linkend="Updating_all_hosts_in_a_cluster_admin">all hosts in a cluster</link>, or update <link linkend="Updating_Individual_Hosts_admin">individual hosts</link>.</simpara>
<section xml:id="Updating_all_hosts_in_a_cluster_admin">
<title>Updating All Hosts in a Cluster</title>
<simpara>You can update all hosts in a cluster instead of updating hosts individually. This is particularly useful during upgrades to new versions of oVirt. See <link xl:href="https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md">https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md</link> for more information about the Ansible role used to automate the updates.</simpara>
<simpara>Update one cluster at a time.</simpara>
<itemizedlist>
<title>Limitations</title>
<listitem>
<simpara>On oVirt Node, the update only preserves modified content in the <literal>/etc</literal> and <literal>/var</literal> directories. Modified data in other paths is overwritten during an update.</simpara>
</listitem>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.</simpara>
</listitem>
<listitem>
<simpara>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</simpara>
</listitem>
<listitem>
<simpara>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</simpara>
</listitem>
<listitem>
<simpara>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines are shut down during the update, unless you choose to skip that host instead.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice> and select the cluster. The <emphasis role="strong">Upgrade status</emphasis> column shows if an upgrade is available for any hosts in the cluster.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Upgrade</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the hosts to update, then click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Configure the options:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Stop Pinned VMs</emphasis> shuts down any virtual machines that are pinned to hosts in the cluster, and is selected by default. You can clear this check box to skip updating those hosts so that the pinned virtual machines stay running, such as when a pinned virtual machine is running important services or processes and you do not want it to shut down at an unknown time during the update.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Upgrade Timeout (Minutes)</emphasis> sets the time to wait for an individual host to be updated before the cluster upgrade fails with a timeout. The default is <literal>60</literal>. You can increase it for large clusters where 60 minutes might not be enough, or reduce it for small clusters where the hosts update quickly.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Check Upgrade</emphasis> checks each host for available updates before running the upgrade process. It is not selected by default, but you can select it if you need to ensure that recent updates are included, such as when you have configured the Engine to check for host updates less frequently than the default.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Reboot After Upgrade</emphasis> reboots each host after it is updated, and is selected by default. You can clear this check box to speed up the process if you are sure that there are no pending updates that require a host reboot.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Use Maintenance Policy</emphasis> sets the cluster&#8217;s scheduling policy to <link xl:href="https://ovirt.org/documentation/administration_guide/index#Cluster_Scheduling_Policy_Settings"><literal>cluster_maintenance</literal></link> during the update. It is selected by default, so activity is limited and virtual machines cannot start unless they are highly available. You can clear this check box if you have a custom scheduling policy that you want to keep using during the update, but this could have unknown consequences. Ensure your custom policy is compatible with cluster upgrade activity before disabling this option.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Next</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Review the summary of the hosts and virtual machines that will be affected.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Upgrade</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>You can track the progress of host updates:</simpara>
<itemizedlist>
<listitem>
<simpara>in the <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice> view, the <emphasis role="strong">Upgrade Status</emphasis> column shows <emphasis role="strong">Upgrade in progress</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>in the <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> view</simpara>
</listitem>
<listitem>
<simpara>in the <emphasis role="strong">Events</emphasis> section of the <emphasis role="strong">Notification Drawer</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/EventsIcon.png"/>
</imageobject>
<textobject><phrase>EventsIcon</phrase></textobject>
</inlinemediaobject>).</simpara>
</listitem>
</itemizedlist>
<simpara>You can track the progress of individual virtual machine migrations in the <emphasis role="strong">Status</emphasis> column of the <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> view. In large environments, you may need to filter the results to show a particular group of virtual machines.</simpara>
</section>
<section xml:id="Updating_Individual_Hosts_admin">
<title>Updating Individual Hosts</title>
<simpara>Use the host upgrade manager to update individual hosts directly from the Administration Portal.</simpara>
<note>
<simpara>The upgrade manager only checks hosts with a status of <emphasis role="strong">Up</emphasis> or <emphasis role="strong">Non-operational</emphasis>, but not <emphasis role="strong">Maintenance</emphasis>.</simpara>
</note>
<itemizedlist>
<title>Limitations</title>
<listitem>
<simpara>On oVirt Node, the update only preserves modified content in the <literal>/etc</literal> and <literal>/var</literal> directories. Modified data in other paths is overwritten during an update.</simpara>
</listitem>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</simpara>
</listitem>
<listitem>
<simpara>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</simpara>
</listitem>
<listitem>
<simpara>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</simpara>
</listitem>
<listitem>
<simpara>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</simpara>
</listitem>
<listitem>
<simpara>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Ensure that the correct repositories are enabled. To view a list of currently enabled repositories, run <literal>dnf repolist</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>For oVirt Nodes, the <literal>ovirt-release44</literal> RPM package enabling the correct repositories is already installed.</simpara>
</listitem>
<listitem>
<simpara>For Enterprise Linux hosts:</simpara>
<screen># dnf install <link xl:href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</link></screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host to be updated.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Check for Upgrade</guimenuitem></menuchoice> and click <guibutton>OK</guibutton>.</simpara>
<simpara>Open the <emphasis role="strong">Notification Drawer</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/EventsIcon.png"/>
</imageobject>
<textobject><phrase>EventsIcon</phrase></textobject>
</inlinemediaobject>) and expand the <emphasis role="strong">Events</emphasis> section to see the result.</simpara>
</listitem>
<listitem>
<simpara>If an update is available, click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Upgrade</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to update the host. Running virtual machines are migrated according to their migration policy. If migration is disabled for any virtual machines, you are prompted to shut them down.</simpara>
<simpara>The details of the host are updated in <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and the status transitions through these stages:</simpara>
<simpara><emphasis role="strong">Maintenance &gt; Installing &gt; Reboot &gt; Up</emphasis></simpara>
<note>
<simpara>If the update fails, the host&#8217;s status changes to <emphasis role="strong">Install Failed</emphasis>. From <emphasis role="strong">Install Failed</emphasis> you can click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Upgrade</guimenuitem></menuchoice> again.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>Repeat this procedure for each host in the oVirt environment.</simpara>
<note>
<simpara>You should update the hosts from the Administration Portal. However, you can update the hosts using <literal>dnf upgrade</literal> instead.</simpara>
</note>
</section>
<section xml:id="Manually_Updating_Hosts_admin">
<title>Manually Updating Hosts</title>
<caution>
<simpara>This information is provided for advanced system administrators who need to update hosts manually, but oVirt does not support this method. The procedure described in this topic does not include important steps, including certificate renewal, assuming advanced knowledge of such information. oVirt supports updating hosts using the Administration Portal. For details, see  <link xl:href="https://ovirt.org/documentation/administration_guide/index#Updating_Individual_Hosts_admin">Updating individual hosts</link> or <link xl:href="https://ovirt.org/documentation/administration_guide/index#Updating_all_hosts_in_a_cluster_admin">Updating all hosts in a cluster</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</caution>
<simpara>You can use the <literal>dnf</literal> command to update your hosts. Update your systems regularly, to ensure timely application of security and bug fixes.</simpara>
<itemizedlist>
<title>Limitations</title>
<listitem>
<simpara>On oVirt Node, the update only preserves modified content in the <literal>/etc</literal> and <literal>/var</literal> directories. Modified data in other paths is overwritten during an update.</simpara>
</listitem>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</simpara>
</listitem>
<listitem>
<simpara>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</simpara>
</listitem>
<listitem>
<simpara>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</simpara>
</listitem>
<listitem>
<simpara>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</simpara>
</listitem>
<listitem>
<simpara>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Ensure the correct repositories are enabled. You can check which repositories are currently enabled by running <literal>dnf repolist</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>For oVirt Nodes, the <literal>ovirt-release44</literal> RPM package enabling the correct repositories is already installed.</simpara>
</listitem>
<listitem>
<simpara>For Enterprise Linux hosts:</simpara>
<screen># dnf install <link xl:href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</link></screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host to be updated.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>For Enterprise Linux hosts:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Identify the current version of Enterprise Linux:</simpara>
<screen># cat /etc/redhat-release</screen>
</listitem>
<listitem>
<simpara>Check which version of the redhat-release package is available:</simpara>
<screen># dnf --refresh info --available redhat-release</screen>
<simpara>This command shows any available updates. For example, when upgrading from Enterprise Linux 8.2.<emphasis>z</emphasis> to 8.3, compare the version of the package with the currently installed version:</simpara>
<screen>Available Packages
Name         : redhat-release
Version      : 8.3
Release      : 1.0.el8
&#8230;&#8203;</screen>
<caution>
<simpara>The Enterprise Linux Advanced Virtualization module is usually released later than the Enterprise Linux y-stream. If no new Advanced Virtualization module is available yet, or if there is an error enabling it, stop here and cancel the upgrade. Otherwise you risk corrupting the host.</simpara>
</caution>
</listitem>
<listitem>
<simpara>If the Advanced Virtualization stream is available for Enterprise Linux 8.3 or later, reset the <literal>virt</literal> module:</simpara>
<screen># dnf module reset virt</screen>
<note>
<simpara>If this module is already enabled in the Advanced Virtualization stream, this step is not necessary, but it has no negative impact.</simpara>
<simpara>You can see the value of the stream by entering:</simpara>
<screen># dnf module list virt</screen>
</note>
</listitem>
<listitem>
<simpara>Enable the <literal>virt</literal> module in the Advanced Virtualization stream with the following command:</simpara>
<itemizedlist>
<listitem>
<simpara>For oVirt 4.4.2:</simpara>
<screen># dnf module enable virt:8.2</screen>
</listitem>
<listitem>
<simpara>For oVirt 4.4.3 to 4.4.5:</simpara>
<screen># dnf module enable virt:8.3</screen>
</listitem>
<listitem>
<simpara>For oVirt 4.4.6 or later:</simpara>
<screen># dnf module enable virt:av</screen>
<note>
<simpara>Starting with EL 8.4, only one Advanced Virtualization stream is used, <literal>rhel:av</literal>.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Update the host:</simpara>
<screen># dnf upgrade --nobest</screen>
</listitem>
<listitem>
<simpara>Reboot the host to ensure all updates are correctly applied.</simpara>
<note>
<simpara>Check the imgbased logs to see if any additional package updates have failed for a oVirt Node. If some packages were not successfully reinstalled after the update, check that the packages are listed in <emphasis role="strong">/var/imgbased/persisted-rpms</emphasis>. Add any missing packages then run <literal>rpm -Uvh /var/imgbased/persisted-rpms/*</literal>.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>Repeat this process for each host in the oVirt environment.</simpara>
</section>
</section>
<section xml:id="Reinstalling_Hosts_admin">
<title>Reinstalling Hosts</title>
<simpara>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</simpara>
<warning>
<simpara>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Install Host</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to reinstall the host.</simpara>
</listitem>
</orderedlist>
<simpara>After a host has been reinstalled and its status returns to <emphasis role="strong">Up</emphasis>, you can migrate virtual machines back to the host.</simpara>
<important>
<simpara>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <emphasis role="strong">Install Failed</emphasis>. Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>, and the host will change to an <emphasis role="strong">Up</emphasis> status and be ready for use.</simpara>
</important>
</section>
<section xml:id="Viewing_Host_Errata">
<title>Viewing Host Errata</title>
<simpara>Errata for each host can be viewed after the host has been configured to receive errata information from the Red Hat Satellite server. For more information on configuring a host to receive errata information see <xref linkend="Configuring_Satellite_Errata_Management_for_a_Host"/></simpara>
<simpara><emphasis role="strong">Viewing Host Errata</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Errata</emphasis> tab.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Viewing_Host_Health_Status">
<title>Viewing the Health Status of a Host</title>
<simpara>Hosts have an external health status in addition to their regular <emphasis role="strong">Status</emphasis>. The external health status is reported by plug-ins or external systems, or set by an administrator, and appears to the left of the host&#8217;s <emphasis role="strong">Name</emphasis> as one of the following icons:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">OK</emphasis>: No icon</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Info</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Info.png"/>
</imageobject>
<textobject><phrase>Info</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Warning</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Warning.png"/>
</imageobject>
<textobject><phrase>Warning</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Error</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Error.png"/>
</imageobject>
<textobject><phrase>Error</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Failure</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Failure.png"/>
</imageobject>
<textobject><phrase>Failure</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
</itemizedlist>
<simpara>To view further details about the host&#8217;s health status, click the host&#8217;s name. This opens the details view, and click the <emphasis role="strong">Events</emphasis> tab.</simpara>
<simpara>The host&#8217;s health status can also be viewed using the REST API. A <literal>GET</literal> request on a host will include the <literal>external_status</literal> element, which contains the health status.</simpara>
<simpara>You can set a host&#8217;s health status in the REST API via the <literal>events</literal> collection. For more information, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-events-methods-add">Adding Events</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</section>
<section xml:id="Viewing_Host_Devices">
<title>Viewing Host Devices</title>
<simpara>You can view the host devices for each host in the <emphasis role="strong">Host Devices</emphasis> tab in the details view. If the host has been configured for direct device assignment, these devices can be directly attached to virtual machines for improved performance.</simpara>
<simpara>For more information on the hardware requirements for direct device assignment, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Additional Hardware Considerations for Using Device Assignment</link> in <emphasis>Hardware Considerations for Implementing SR-IOV</emphasis>.</simpara>
<simpara>For more information on configuring the host for direct device assignment, see <xref linkend="Configuring_a_Host_for_PCI_Passthrough_host_tasks"/>.</simpara>
<simpara>For more information on attaching host devices to virtual machines, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-host_devices">Host Devices</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
<simpara><emphasis role="strong">Viewing Host Devices</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Host Devices</emphasis> tab.</simpara>
</listitem>
</orderedlist>
<simpara>This tab lists the details of the host devices, including whether the device is attached to a virtual machine, and currently in use by that virtual machine.</simpara>
</section>
<section xml:id="Accessing_Cockpit_from_the_Admin_Portal">
<title>Accessing Cockpit from the Administration Portal</title>
<simpara>Cockpit is available by default on oVirt Nodes (oVirt Node) and Enterprise Linux hosts. You can access the Cockpit web interface by typing the address into a browser, or through the Administration Portal.</simpara>
<simpara><emphasis role="strong">Accessing Cockpit from the Administration Portal</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Host Console</emphasis>.</simpara>
</listitem>
</orderedlist>
<simpara>The Cockpit login page opens in a new browser window.</simpara>
</section>
<section xml:id="Setting_Legacy_SPICE_Cipher_host_tasks">
<title>Setting a Legacy SPICE Cipher</title>
<simpara>SPICE consoles use FIPS-compliant encryption by default, with a cipher string. The default SPICE cipher string is:
<literal>kECDHE+FIPS:kDHE+FIPS:kRSA+FIPS:!eNULL:!aNULL</literal></simpara>
<simpara>This string is generally sufficient. However, if you have a virtual machine with an older operating system or SPICE client, where either one or the other does not support FIPS-compliant encryption, you must use a weaker cipher string. Otherwise, a connection security error may occur if you install a new cluster or a new host in an existing cluster and try to connect to that virtual machine.</simpara>
<simpara>You can change the cipher string by using an Ansible playbook.</simpara>
<simpara><emphasis role="strong">Changing the cipher string</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine machine, create a file in the directory <literal role="filename">/usr/share/ovirt-engine/playbooks</literal>. For example:</simpara>
<screen># vim /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</screen>
</listitem>
<listitem>
<simpara>Enter the following in the file and save it:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">name: oVirt - setup weaker SPICE encryption for old clients
hosts: <emphasis>hostname</emphasis>
vars:
  host_deploy_spice_cipher_string: 'DEFAULT:-RC4:-3DES:-DES'
roles:
  - ovirt-host-deploy-spice-encryption</programlisting>
</listitem>
<listitem>
<simpara>Run the file you just created:</simpara>
<screen># ansible-playbook -l <emphasis>hostname</emphasis> /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</screen>
</listitem>
</orderedlist>
<simpara>Alternatively, you can reconfigure the host with the Ansible playbook <literal>ovirt-host-deploy</literal>  using the  <literal>--extra-vars</literal> option  with the variable <literal>host_deploy_spice_cipher_string</literal>:</simpara>
<screen># ansible-playbook -l <emphasis>hostname</emphasis> \
  --extra-vars host_deploy_spice_cipher_string=”DEFAULT:-RC4:-3DES:-DES” \
  /usr/share/ovirt-engine/playbooks/ovirt-host-deploy.yml</screen>
</section>
</section>
<section xml:id="sect-Host_Resilience">
<title>Host Resilience</title>
<section xml:id="Host_high_availability">
<title>Host High Availability</title>
<simpara>The oVirt Engine uses fencing to keep hosts in a cluster responsive. A <emphasis role="strong">Non Responsive</emphasis> host is different from a <emphasis role="strong">Non Operational</emphasis> host. <emphasis role="strong">Non Operational</emphasis> hosts can be communicated with by the Engine, but have an incorrect configuration, for example a missing logical network. <emphasis role="strong">Non Responsive</emphasis> hosts cannot be communicated with by the Engine.</simpara>
<simpara>Fencing allows a cluster to react to unexpected host failures and enforce power saving, load balancing, and virtual machine availability policies. You should configure the fencing parameters for your host&#8217;s power management device and test their correctness from time to time. In a fencing operation, a non-responsive host is rebooted, and if the host does not return to an active status within a prescribed time, it remains non-responsive pending manual intervention and troubleshooting.</simpara>
<note>
<simpara>To automatically check the fencing parameters, you can configure the <literal>PMHealthCheckEnabled</literal> (false by default) and <literal>PMHealthCheckIntervalInSec</literal> (3600 sec by default) engine-config options.</simpara>
<simpara>When set to true, <literal>PMHealthCheckEnabled</literal> will check all host agents at the interval specified by <literal>PMHealthCheckIntervalInSec</literal>, and raise warnings if it detects issues. See <xref linkend="Syntax_for_the_engine-config_Command"/> for more information about configuring engine-config options.</simpara>
</note>
<simpara>Power management operations can be performed by oVirt Engine after it reboots, by a proxy host, or manually in the Administration Portal. All the virtual machines running on the non-responsive host are stopped, and highly available virtual machines are started on a different host. At least two hosts are required for power management operations.</simpara>
<simpara>After the Engine starts up, it automatically attempts to fence non-responsive hosts that have power management enabled after the quiet time (5 minutes by default) has elapsed. The quiet time can be configured by updating the <literal>DisableFenceAtStartupInSec</literal> engine-config option.</simpara>
<note>
<simpara>The <literal>DisableFenceAtStartupInSec</literal> engine-config option helps prevent a scenario where the Engine attempts to fence hosts while they boot up. This can occur after a data center outage because a host&#8217;s boot process is normally longer than the Engine boot process.</simpara>
</note>
<simpara>Hosts can be fenced automatically by the proxy host using the power management parameters, or manually by right-clicking on a host and using the options on the menu.</simpara>
<important>
<simpara>If a host runs virtual machines that are highly available, power management must be enabled and configured.</simpara>
</important>
</section>
<section xml:id="Power_Management_by_Proxy_in_Red_Hat_Enterprise_Virtualization">
<title>Power Management by Proxy in oVirt</title>
<simpara>The oVirt Engine does not communicate directly with fence agents. Instead, the Engine uses a proxy to send power management commands to a host power management device. The Engine uses VDSM to execute power management device actions, so another host in the environment is used as a fencing proxy.</simpara>
<simpara>You can select between:</simpara>
<itemizedlist>
<listitem>
<simpara>Any host in the same cluster as the host requiring fencing.</simpara>
</listitem>
<listitem>
<simpara>Any host in the same data center as the host requiring fencing.</simpara>
</listitem>
</itemizedlist>
<simpara>A viable fencing proxy host has a status of either <emphasis role="strong">UP</emphasis> or <emphasis role="strong">Maintenance</emphasis>.</simpara>
</section>
<section xml:id="Setting_fencing_parameters_on_a_host">
<title>Setting Fencing Parameters on a Host</title>
<simpara>The parameters for host fencing are set using the <emphasis role="strong">Power Management</emphasis> fields on the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> windows. Power management enables the system to fence a troublesome host using an additional interface such as a Remote Access Card (RAC).</simpara>
<simpara>All power management operations are done using a proxy host, as opposed to directly by the oVirt Engine. At least two hosts are required for power management operations.</simpara>
<simpara><emphasis role="strong">Setting fencing parameters on a host</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Power Management</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Enable Power Management</emphasis> check box to enable the fields.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Kdump integration</emphasis> check box to prevent the host from fencing while performing a kernel crash dump.</simpara>
<important>
<simpara>If you enable or disable <emphasis role="strong">Kdump integration</emphasis> on an existing host, you must  <link linkend="Reinstalling_Hosts_admin">reinstall the host</link>.</simpara>
</important>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Disable policy control of power management</emphasis> check box if you do not want your host&#8217;s power management to be controlled by the <emphasis role="strong">Scheduling Policy</emphasis> of the host&#8217;s cluster.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">+</emphasis> button to add a new power management device. The <emphasis role="strong">Edit fence agent</emphasis> window opens.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Address</emphasis>, <emphasis role="strong">User Name</emphasis>, and <emphasis role="strong">Password</emphasis> of the power management device.</simpara>
</listitem>
<listitem>
<simpara>Select the power management device <emphasis role="strong">Type</emphasis> from the drop-down list.</simpara>
<note>
<simpara>For more information on how to set up a custom power management device, see <link xl:href="https://access.redhat.com/articles/1238743">https://access.redhat.com/articles/1238743</link>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">SSH Port</emphasis> number used by the power management device to communicate with the host.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Slot</emphasis> number used to identify the blade of the power management device.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Options</emphasis> for the power management device. Use a comma-separated list of <emphasis>'key=value'</emphasis> entries.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Secure</emphasis> check box to enable the power management device to connect securely to the host.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Test</emphasis> button to ensure the settings are correct. <emphasis role="strong">Test Succeeded, Host Status is: on</emphasis> will display upon successful verification.</simpara>
<warning>
<simpara>Power management parameters (userid, password, options, etc) are tested by oVirt Engine only during setup and manually after that. If you choose to ignore alerts about incorrect parameters, or if the parameters are changed on the power management hardware without the corresponding change in oVirt Engine, fencing is likely to fail when most needed.</simpara>
</warning>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to close the <emphasis role="strong">Edit fence agent</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Power Management</emphasis> tab, optionally expand the <emphasis role="strong">Advanced Parameters</emphasis> and use the up and down buttons to specify the order in which the Engine will search the host&#8217;s <emphasis role="strong">cluster</emphasis> and <emphasis role="strong">dc</emphasis> (datacenter) for a fencing proxy.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You are returned to the list of hosts. Note that the exclamation mark next to the host&#8217;s name has now disappeared, signifying that power management has been successfully configured.</simpara>
</section>
<section xml:id="sect-fence_kdump_Advanced_Configuration">
<title>fence_kdump Advanced Configuration</title>
<simpara><emphasis role="strong">kdump</emphasis></simpara>
<simpara>Click the name of a host to view the status of the kdump service in the <emphasis role="strong">General</emphasis> tab of the details view:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Enabled</emphasis>: kdump is configured properly and the kdump service is running.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Disabled</emphasis>: the kdump service is not running (in this case kdump integration will not work properly).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Unknown</emphasis>: happens only for hosts with an earlier VDSM version that does not report kdump status.</simpara>
</listitem>
</itemizedlist>
<simpara>For more information on installing and using kdump, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Kernel_Crash_Dump_Guide/index.html">Enterprise Linux 7 Kernel Crash Dump Guide</link>.</simpara>
<simpara><emphasis role="strong">fence_kdump</emphasis></simpara>
<simpara>Enabling <emphasis role="strong">Kdump integration</emphasis> in the <emphasis role="strong">Power Management</emphasis> tab of the <emphasis role="strong">New Host</emphasis> or <emphasis role="strong">Edit Host</emphasis> window configures a standard fence_kdump setup. If the environment&#8217;s network configuration is simple and the Engine&#8217;s FQDN is resolvable on all hosts, the default fence_kdump settings are sufficient for use.</simpara>
<simpara>However, there are some cases where advanced configuration of fence_kdump is necessary. Environments with more complex networking may require manual changes to the configuration of the Engine, fence_kdump listener, or both. For example, if the Engine&#8217;s FQDN is not resolvable on all hosts with <emphasis role="strong">Kdump integration</emphasis> enabled, you can set a proper host name or IP address using <literal>engine-config</literal>:</simpara>
<screen>engine-config -s FenceKdumpDestinationAddress=<emphasis>A.B.C.D</emphasis></screen>
<simpara>The following example cases may also require configuration changes:</simpara>
<itemizedlist>
<listitem>
<simpara>The Engine has two NICs, where one of these is public-facing, and the second is the preferred destination for fence_kdump messages.</simpara>
</listitem>
<listitem>
<simpara>You need to execute the fence_kdump listener on a different IP or port.</simpara>
</listitem>
<listitem>
<simpara>You need to set a custom interval for fence_kdump notification messages, to prevent possible packet loss.</simpara>
</listitem>
</itemizedlist>
<simpara>Customized fence_kdump detection settings are recommended for advanced users only, as changes to the default configuration are only necessary in more complex networking setups. For configuration options for the fence_kdump listener see <link linkend="fence_kdump_listener_Configuration">fence_kdump listener Configuration</link>.
For configuration of kdump on the Engine see <link linkend="Configuring_fence_kdump_on_the_Manager">Configuring fence_kdump on the Manager</link>.</simpara>
<section xml:id="fence_kdump_listener_Configuration">
<title>fence_kdump listener Configuration</title>
<simpara>Edit the configuration of the fence_kdump listener. This is only necessary in cases where the default configuration is not sufficient.</simpara>
<simpara><emphasis role="strong">Manually Configuring the fence_kdump Listener</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a new file (for example, <emphasis role="strong">my-fence-kdump.conf</emphasis>) in <emphasis role="strong">/etc/ovirt-engine/ovirt-fence-kdump-listener.conf.d/</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter your customization with the syntax <emphasis>OPTION</emphasis>=<emphasis>value</emphasis> and save the file.</simpara>
<important>
<simpara>The edited values must also be changed in <literal>engine-config</literal> as outlined in the fence_kdump Listener Configuration Options table in <xref linkend="Configuring_fence_kdump_on_the_Manager"/>.</simpara>
</important>
</listitem>
<listitem>
<simpara>Restart the fence_kdump listener:</simpara>
<screen># systemctl restart ovirt-fence-kdump-listener.service</screen>
</listitem>
</orderedlist>
<simpara>The following options can be customized if required:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>fence_kdump Listener Configuration Options</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Variable</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Default</entry>
<entry align="left" valign="top">Note</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>LISTENER_ADDRESS</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the IP address to receive fence_kdump messages on.</simpara></entry>
<entry align="left" valign="top"><simpara>0.0.0.0</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must match the value of <literal>FenceKdumpDestinationAddress</literal> in <literal>engine-config</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>LISTENER_PORT</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the port to receive fence_kdump messages on.</simpara></entry>
<entry align="left" valign="top"><simpara>7410</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must match the value of <literal>FenceKdumpDestinationPort</literal> in <literal>engine-config</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>HEARTBEAT_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the interval in seconds of the listener&#8217;s heartbeat updates.</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be half the size or smaller than the value of <literal>FenceKdumpListenerTimeout</literal> in <literal>engine-config</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SESSION_SYNC_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the interval in seconds to synchronize the listener&#8217;s host kdumping sessions in memory to the database.</simpara></entry>
<entry align="left" valign="top"><simpara>5</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be half the size or smaller than the value of <literal>KdumpStartedTimeout</literal> in <literal>engine-config</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>REOPEN_DB_CONNECTION_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the interval in seconds to reopen the database connection which was previously unavailable.</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>-</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>KDUMP_FINISHED_TIMEOUT</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the maximum timeout in seconds after the last received message from kdumping hosts after which the host kdump flow is marked as FINISHED.</simpara></entry>
<entry align="left" valign="top"><simpara>60</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be double the size or higher than the value of <literal>FenceKdumpMessageInterval</literal> in <literal>engine-config</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Configuring_fence_kdump_on_the_Manager">
<title>Configuring fence_kdump on the Engine</title>
<simpara>Edit the Engine&#8217;s kdump configuration. This is only necessary in cases where the default configuration is not sufficient. The current configuration values can be found using:</simpara>
<screen># engine-config -g <emphasis>OPTION</emphasis></screen>
<simpara><emphasis role="strong">Manually Configuring Kdump with engine-config</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Edit kdump&#8217;s configuration using the <literal>engine-config</literal> command:</simpara>
<screen># engine-config -s <emphasis>OPTION</emphasis>=<emphasis>value</emphasis></screen>
<important>
<simpara>The edited values must also be changed in the fence_kdump listener configuration file as outlined in the <literal>Kdump Configuration Options</literal> table. See <xref linkend="fence_kdump_listener_Configuration"/>.</simpara>
</important>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>Reinstall all hosts with <emphasis role="strong">Kdump integration</emphasis> enabled, if required (see the table below).</simpara>
</listitem>
</orderedlist>
<simpara>The following options can be configured using <literal>engine-config</literal>:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Kdump Configuration Options</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Variable</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">Default</entry>
<entry align="left" valign="top">Note</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>FenceKdumpDestinationAddress</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the hostname(s) or IP address(es) to send fence_kdump messages to. If empty, the Engine&#8217;s FQDN is used.</simpara></entry>
<entry align="left" valign="top"><simpara>Empty string (Engine FQDN is used)</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must match the value of <literal>LISTENER_ADDRESS</literal> in the fence_kdump listener configuration file, and all hosts with <emphasis role="strong">Kdump integration</emphasis> enabled must be reinstalled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FenceKdumpDestinationPort</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the port to send fence_kdump messages to.</simpara></entry>
<entry align="left" valign="top"><simpara>7410</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must match the value of <literal>LISTENER_PORT</literal> in the fence_kdump listener configuration file, and all hosts with <emphasis role="strong">Kdump integration</emphasis> enabled must be reinstalled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FenceKdumpMessageInterval</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the interval in seconds between messages sent by fence_kdump.</simpara></entry>
<entry align="left" valign="top"><simpara>5</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be half the size or smaller than the value of <literal>KDUMP_FINISHED_TIMEOUT</literal> in the fence_kdump listener configuration file, and all hosts with <emphasis role="strong">Kdump integration</emphasis> enabled must be reinstalled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FenceKdumpListenerTimeout</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the maximum timeout in seconds since the last heartbeat to consider the fence_kdump listener alive.</simpara></entry>
<entry align="left" valign="top"><simpara>90</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be double the size or higher than the value of <literal>HEARTBEAT_INTERVAL</literal> in the fence_kdump listener configuration file.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>KdumpStartedTimeout</simpara></entry>
<entry align="left" valign="top"><simpara>Defines the maximum timeout in seconds to wait until the first message from the kdumping host is received (to detect that host kdump flow has started).</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>If the value of this parameter is changed, it must be double the size or higher than the value of <literal>SESSION_SYNC_INTERVAL</literal> in the fence_kdump listener configuration file, and <literal>FenceKdumpMessageInterval</literal>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="Soft-Fencing_Hosts">
<title>Soft-Fencing Hosts</title>
<simpara>Hosts can sometimes become non-responsive due to an unexpected problem, and though VDSM is unable to respond to requests, the virtual machines that depend upon VDSM remain alive and accessible. In these situations, restarting VDSM returns VDSM to a responsive state and resolves this issue.</simpara>
<simpara>"SSH Soft Fencing" is a process where the Engine attempts to restart VDSM via SSH on non-responsive hosts. If the Engine fails to restart VDSM via SSH, the responsibility for fencing falls to the external fencing agent if an external fencing agent has been configured.</simpara>
<simpara>Soft-fencing over SSH works as follows. Fencing must be configured and enabled on the host, and a valid proxy host (a second host, in an UP state, in the data center) must exist. When the connection between the Engine and the host times out, the following happens:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the first network failure, the status of the host changes to "connecting".</simpara>
</listitem>
<listitem>
<simpara>The Engine then makes three attempts to ask VDSM for its status, or it waits for an interval determined by the load on the host. The formula for determining the length of the interval is configured by the configuration values TimeoutToResetVdsInSeconds (the default is 60 seconds) + [DelayResetPerVmInSeconds (the default is 0.5 seconds)]*(the count of running virtual machines on host) + [DelayResetForSpmInSeconds (the default is 20 seconds)] * 1 (if host runs as SPM) or 0 (if the host does not run as SPM). To give VDSM the maximum amount of time to respond, the Engine chooses the longer of the two options mentioned above (three attempts to retrieve the status of VDSM or the interval determined by the above formula).</simpara>
</listitem>
<listitem>
<simpara>If the host does not respond when that interval has elapsed, <literal>vdsm restart</literal> is executed via SSH.</simpara>
</listitem>
<listitem>
<simpara>If <literal>vdsm restart</literal> does not succeed in re-establishing the connection between the host and the Engine, the status of the host changes to <literal>Non Responsive</literal> and, if power management is configured, fencing is handed off to the external fencing agent.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>Soft-fencing over SSH can be executed on hosts that have no power management configured. This is distinct from "fencing": fencing can be executed only on hosts that have power management configured.</simpara>
</note>
</section>
<section xml:id="Using_power_host_power_management_functions">
<title>Using Host Power Management Functions</title>
<simpara>When power management has been configured for a host, you can access a number of options from the Administration Portal interface. While each power management device has its own customizable options, they all support the basic options to start, stop, and restart a host.</simpara>
<simpara><emphasis role="strong">Using Host Power Management Functions</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Management</emphasis> drop-down menu and select one of the following <emphasis role="strong">Power Management</emphasis> options:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Restart</emphasis>: This option stops the host and waits until the host&#8217;s status changes to <literal>Down</literal>. When the agent has verified that the host is down, the highly available virtual machines are restarted on another host in the cluster. The agent then restarts this host. When the host is ready for use its status displays as <literal>Up</literal>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Start</emphasis>: This option starts the host and lets it join a cluster. When it is ready for use its status displays as <literal>Up</literal>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Stop</emphasis>: This option powers off the host. Before using this option, ensure that the virtual machines running on the host have been migrated to other hosts in the cluster. Otherwise the virtual machines will crash and only the highly available virtual machines will be restarted on another host. When the host has been stopped its status displays as <literal>Non-Operational</literal>.</simpara>
<note>
<simpara>If Power Management is not enabled, you can restart or stop the host by selecting it, clicking the <emphasis role="strong">Management</emphasis> drop-down menu, and selecting an <emphasis role="strong">SSH Management</emphasis> option, <emphasis role="strong">Restart</emphasis> or <emphasis role="strong">Stop</emphasis>.</simpara>
</note>
<important>
<simpara>When two fencing agents are defined on a host, they can be used concurrently or sequentially. For concurrent agents, both agents have to respond to the Stop command for the host to be stopped; and when one agent responds to the Start command, the host will go up. For sequential agents, to start or stop a host, the primary agent is used first; if it fails, the secondary agent is used.</simpara>
</important>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Manually_fencing_or_isolating_a_nonresponsive_host">
<title>Manually Fencing or Isolating a Non-Responsive Host</title>
<simpara>If a host unpredictably goes into a non-responsive state, for example, due to a hardware failure, it can significantly affect the performance of the environment. If you do not have a power management device, or if it is incorrectly configured, you can reboot the host manually.</simpara>
<warning>
<simpara>Do not use the <emphasis role="strong">Confirm host has been rebooted</emphasis> option unless you have manually rebooted the host. Using this option while the host is still running can lead to a virtual machine image corruption.</simpara>
</warning>
<simpara><emphasis role="strong">Manually fencing or isolating a non-responsive host</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and confirm the host&#8217;s status is <literal>Non Responsive</literal>.</simpara>
</listitem>
<listitem>
<simpara>Manually reboot the host. This could mean physically entering the lab and rebooting the host.</simpara>
</listitem>
<listitem>
<simpara>In the Administration Portal, select the host and click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Confirm 'Host has been Rebooted'</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Approve Operation</emphasis> check box and click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>If your hosts take an unusually long time to boot, you can set <literal>ServerRebootTimeout</literal> to specify how many seconds to wait before determining that the host is <literal>Non Responsive</literal>:</simpara>
<screen># engine-config --set ServerRebootTimeout=<emphasis>integer</emphasis></screen>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="chap-Storage">
<title>Storage</title>
<simpara>oVirt uses a centralized storage system for virtual disks, ISO files and snapshots. Storage networking can be implemented using:</simpara>
<itemizedlist>
<listitem>
<simpara>Network File System (NFS)</simpara>
</listitem>
<listitem>
<simpara>GlusterFS exports</simpara>
</listitem>
<listitem>
<simpara>Other POSIX compliant file systems</simpara>
</listitem>
<listitem>
<simpara>Internet Small Computer System Interface (iSCSI)</simpara>
</listitem>
<listitem>
<simpara>Local storage attached directly to the virtualization hosts</simpara>
</listitem>
<listitem>
<simpara>Fibre Channel Protocol (FCP)</simpara>
</listitem>
<listitem>
<simpara>Parallel NFS (pNFS)</simpara>
</listitem>
</itemizedlist>
<simpara>Setting up storage is a prerequisite for a new data center because a data center cannot be initialized unless storage domains are attached and activated.</simpara>
<simpara>As a oVirt system administrator, you need to create, configure, attach and maintain storage for the virtualized enterprise. You should be familiar with the storage types and their use. Read your storage array vendor&#8217;s guides, and see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/">Enterprise Linux Storage Administration Guide</link> for more information on the concepts, protocols, requirements or general usage of storage.</simpara>
<simpara>To add storage domains you must be able to successfully access the Administration Portal, and there must be at least one host connected with a status of <emphasis role="strong">Up</emphasis>.</simpara>
<simpara>oVirt has three types of storage domains:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Domain:</emphasis> A data domain holds the virtual hard disks and OVF files of all the virtual machines and templates in a data center. In addition, snapshots of the virtual machines are also stored in the data domain.</simpara>
<simpara>The data domain cannot be shared across data centers. Data domains of multiple types (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center, provided they are all shared, rather than local, domains.</simpara>
<simpara>You must attach a data domain to a data center before you can attach domains of other types to it.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ISO Domain:</emphasis> ISO domains store ISO files (or logical CDs) used to install and boot operating systems and applications for the virtual machines. An ISO domain removes the data center&#8217;s need for physical media. An ISO domain can be shared across different data centers. ISO domains can only be NFS-based. Only one ISO domain can be added to a data center.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Export Domain:</emphasis> Export domains are temporary storage repositories that are used to copy and move images between data centers and oVirt environments. Export domains can be used to backup virtual machines. An export domain can be moved between data centers, however, it can only be active in one data center at a time. Export domains can only be NFS-based. Only one export domain can be added to a data center.</simpara>
<note>
<simpara>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See <xref linkend="sect-Importing_Existing_Storage_Domains"/> for information on importing storage domains.</simpara>
</note>
</listitem>
</itemizedlist>
<important>
<simpara>Only commence configuring and attaching storage for your oVirt environment once you have determined the storage needs of your data center(s).</simpara>
</important>
<section xml:id="Understanding_Storage">
<title>Understanding Storage Domains</title>
<simpara>A storage domain is a collection of images that have a common storage interface. A storage domain contains complete images of templates and virtual machines (including snapshots), or ISO files. A storage domain can be made of block devices (SAN - iSCSI or FCP) or a file system (NAS - NFS, GlusterFS, or other POSIX compliant file systems).</simpara>
<simpara>By default, GlusterFS domains and local storage domains support 4K block size. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</simpara>
<simpara>On NFS, all virtual disks, templates, and snapshots are files.</simpara>
<simpara>On SAN (iSCSI/FCP), each virtual disk, template or snapshot is a logical volume. Block devices are aggregated into a logical entity called a volume group, and then divided by LVM (Logical Volume Manager) into logical volumes for use as virtual hard disks. See <emphasis>Enterprise Linux Logical Volume Manager Administration Guide</emphasis> for more information on LVM.</simpara>
<simpara>Virtual disks can have one of two formats, either QCOW2 or raw. The type of storage can be sparse or preallocated. Snapshots are always sparse but can be taken for disks of either format.</simpara>
<simpara>Virtual machines that share the same storage domain can be migrated between hosts that belong to the same cluster.</simpara>
</section>
<section xml:id="sect-Preparing_and_Adding_NFS_Storage">
<title>Preparing and Adding NFS Storage</title>
<section xml:id="Preparing_NFS_Storage_storage_admin">
<title>Preparing NFS Storage</title>
<simpara>Set up NFS shares on your file storage or remote server to serve as storage domains on Red Hat Enterprise Virtualization Host systems. After exporting the shares on the remote storage and configuring them in the Red Hat Virtualization Manager, the shares will be automatically imported on the Red Hat Virtualization hosts.</simpara>
<simpara>For information on setting up, configuring, mounting and exporting NFS, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_file_systems/index"><emphasis>Managing file systems</emphasis></link> for Red Hat Enterprise Linux 8.</simpara>
<simpara>Specific system user accounts and system user groups are required by oVirt so the Engine can store data in the storage domains represented by the exported directories. The following procedure sets the permissions for one directory. You must repeat the <literal>chown</literal> and <literal>chmod</literal> steps for all of the directories you intend to use as storage domains in oVirt.</simpara>
<orderedlist numeration="arabic">
<title>Prerequisites</title>
<listitem>
<simpara>Install the NFS <literal>utils</literal> package.</simpara>
<screen># dnf install nfs-utils -y</screen>
</listitem>
<listitem>
<simpara>To check the enabled versions:</simpara>
<screen># cat /proc/fs/nfsd/versions</screen>
</listitem>
<listitem>
<simpara>Enable the following services:</simpara>
<screen># systemctl enable nfs-server
# systemctl enable rpcbind</screen>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Create the group <literal>kvm</literal>:</simpara>
<screen># groupadd kvm -g 36</screen>
</listitem>
<listitem>
<simpara>Create the user <literal>vdsm</literal> in the group <literal>kvm</literal>:</simpara>
<screen># useradd vdsm -u 36 -g kvm</screen>
</listitem>
<listitem>
<simpara>Create the <literal>storage</literal> directory and modify the access rights.</simpara>
<screen># mkdir /storage
# chmod 0755 /storage
# chown 36:36 /storage/</screen>
</listitem>
<listitem>
<simpara>Add the <literal>storage</literal> directory to <literal>/etc/exports</literal> with the relevant permissions.</simpara>
<screen># vi /etc/exports
# cat /etc/exports
 /storage *(rw)</screen>
</listitem>
<listitem>
<simpara>Restart the following services:</simpara>
<screen># systemctl restart rpcbind
# systemctl restart nfs-server</screen>
</listitem>
<listitem>
<simpara>To see which export are available for a specific IP address:</simpara>
<screen># exportfs
 /nfs_server/srv
               10.46.11.3/24
 /nfs_server       &lt;world&gt;</screen>
</listitem>
</orderedlist>
<note>
<simpara>If changes in <literal>/etc/exports</literal> have been made after starting the services, the <literal role="command">exportfs -ra</literal> command can be used to reload the changes.
After performing all the above stages, the exports directory should be ready and can be tested on a different host to check that it is usable.</simpara>
</note>
</section>
<section xml:id="Adding_NFS_Storage_storage_admin">
<title>Adding NFS Storage</title>
<simpara>This procedure shows you how to attach existing NFS storage to your oVirt environment as a data domain.</simpara>
<simpara>If you require an ISO or export domain, use this procedure, but select <emphasis role="strong">ISO</emphasis> or <emphasis role="strong">Export</emphasis> from the <emphasis role="strong">Domain Function</emphasis> list.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> for the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Accept the default values for the <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Domain Function</emphasis>, <emphasis role="strong">Storage Type</emphasis>, <emphasis role="strong">Format</emphasis>, and <emphasis role="strong">Host</emphasis> lists.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Export Path</emphasis> to be used for the storage domain. The export path should be in the format of <emphasis>123.123.0.10:/data</emphasis> (for IPv4), <emphasis>[2001:0:0:0:0:0:0:5db1]:/data</emphasis> (for IPv6), or <emphasis>domain.example.com:/data</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can configure the advanced parameters:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Advanced Parameters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a percentage value into the <emphasis role="strong">Warning Low Space Indicator</emphasis> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</simpara>
</listitem>
<listitem>
<simpara>Enter a GB value into the <emphasis role="strong">Critical Space Action Blocker</emphasis> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Wipe After Delete</emphasis> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The new NFS data domain has a status of <literal>Locked</literal> until the disk is prepared. The data domain is then automatically attached to the data center.</simpara>
</section>
<section xml:id="Increasing_NFS_Storage">
<title>Increasing NFS Storage</title>
<simpara>To increase the amount of NFS storage, you can either create a new storage domain and add it to an existing data center, or increase the available free space on the NFS server. For the former option, see <xref linkend="Adding_NFS_Storage_storage_admin"/>. The following procedure explains how to increase the available free space on the existing NFS server.</simpara>
<simpara><emphasis role="strong">Increasing an Existing NFS Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the NFS storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab and click <emphasis role="strong">Maintenance</emphasis> to place the storage domain into maintenance mode. This unmounts the existing share and makes it possible to resize the storage domain.</simpara>
</listitem>
<listitem>
<simpara>On the NFS server, resize the storage. For Enterprise Linux 6 systems, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html-single/Storage_Administration_Guide/index.html#s2-disk-storage-parted-resize-part">Enterprise Linux 6 Storage Administration Guide</link>. For Enterprise Linux 7 systems, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Storage_Administration_Guide/index.html#s2-disk-storage-parted-resize-part">Enterprise Linux 7 Storage Administration Guide</link>.</simpara>
</listitem>
<listitem>
<simpara>In the details view, click the <emphasis role="strong">Data Center</emphasis> tab and click <emphasis role="strong">Activate</emphasis> to mount the storage domain.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Preparing_and_Adding_Local_Storage">
<title>Preparing and Adding Local Storage</title>
<section xml:id="Preparing_Local_Storage_storage_admin">
<title>Preparing Local Storage</title>
<simpara>A local storage domain can be set up on a host. When you set up a host to use local storage, the host is automatically added to a new data center and cluster that no other hosts can be added to. Multiple-host clusters require that all hosts have access to all storage domains, which is not possible with local storage. Virtual machines created in a single-host cluster cannot be migrated, fenced, or scheduled.</simpara>
<important>
<simpara>On oVirt Node (oVirt Node), local storage should always be defined on a file system that is separate from <literal>/</literal> (root).
Use a separate logical volume or disk, to prevent possible loss of data during upgrades.</simpara>
</important>
<orderedlist numeration="arabic">
<title>Preparing Local Storage for Enterprise Linux hosts</title>
<listitem>
<simpara>On the host, create the directory to be used for the local storage:</simpara>
<screen># mkdir -p /data/images</screen>
</listitem>
<listitem>
<simpara>Ensure that the directory has permissions allowing read/write access to the <emphasis role="strong">vdsm</emphasis> user (UID 36) and <emphasis role="strong">kvm</emphasis> group (GID 36):</simpara>
<screen># chown 36:36 /data /data/images
# chmod 0755 /data /data/images</screen>
</listitem>
</orderedlist>
<formalpara>
<title>Preparing Local Storage for oVirt Nodes</title>
<para>Create the local storage on a logical volume:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a local storage directory:</simpara>
<screen># mkdir /data
# lvcreate -L $SIZE rhvh -n data
# mkfs.ext4 /dev/mapper/rhvh-data
# echo "/dev/mapper/rhvh-data /data ext4 defaults,discard 1 2" &gt;&gt; /etc/fstab
# mount /data</screen>
</listitem>
<listitem>
<simpara>Mount the new local storage, and then modify the permissions and ownership:</simpara>
<screen># mount -a
# chown 36:36 /data /rhvh-data
# chmod 0755 /data /rhvh-data</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Adding_Local_Storage_storage_admin">
<title>Adding Local Storage</title>
<simpara>Adding local storage to a host places the host in a new data center and cluster. The local storage configuration window combines the creation of a data center, a cluster, and storage into a single process.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Configure Local Storage</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Edit</emphasis> buttons next to the <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Cluster</emphasis>, and <emphasis role="strong">Storage</emphasis> fields to configure and name the local storage domain.</simpara>
</listitem>
<listitem>
<simpara>Set the path to your local storage in the text entry field.</simpara>
</listitem>
<listitem>
<simpara>If applicable, click the <emphasis role="strong">Optimization</emphasis> tab to configure the memory optimization policy for the new local storage cluster.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Your host comes online in a data center of its own.</simpara>
</section>
</section>
<section xml:id="sect-Preparing_and_Adding_POSIX_Compliant_File_System_Storage">
<title>Preparing and Adding POSIX-compliant File System Storage</title>
<section xml:id="Preparing_POSIX_Storage_storage_admin">
<title>Preparing POSIX-compliant File System Storage</title>
<simpara>POSIX file system support allows you to mount file systems using the same mount options that you would normally use when mounting them manually from the command line. This functionality is intended to allow access to storage not exposed using NFS, iSCSI, or FCP.</simpara>
<simpara>Any POSIX-compliant file system used as a storage domain in oVirt must be a clustered file system, such as Global File System 2 (GFS2), and must support sparse files and direct I/O. The Common Internet File System (CIFS), for example, does not support direct I/O, making it incompatible with oVirt.</simpara>
<simpara>For information on setting up and configuring POSIX-compliant file system storage, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Global_File_System_2/index.html"><emphasis>Enterprise Linux Global File System 2</emphasis></link>.</simpara>
<important>
<simpara>Do <emphasis role="strong">not</emphasis> mount NFS storage by creating a POSIX-compliant file system storage domain. Always create an NFS storage domain instead.</simpara>
</important>
</section>
<section xml:id="Adding_POSIX_Storage_storage_admin">
<title>Adding POSIX-compliant File System Storage</title>
<simpara>This procedure shows you how to attach existing POSIX-compliant file system storage to your oVirt environment as a data domain.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> for the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> to be associated with the storage domain. The data center selected must be of type <emphasis role="strong">POSIX (POSIX compliant FS)</emphasis>. Alternatively, select <literal>(none)</literal>.</simpara>
</listitem>
<listitem>
<simpara>Select <literal>Data</literal> from the <emphasis role="strong">Domain Function</emphasis> drop-down list, and <literal>POSIX compliant FS</literal> from the <emphasis role="strong">Storage Type</emphasis> drop-down list.</simpara>
<simpara>If applicable, select the <emphasis role="strong">Format</emphasis> from the drop-down menu.</simpara>
</listitem>
<listitem>
<simpara>Select a host from the <emphasis role="strong">Host</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Path</emphasis> to the POSIX file system, as you would normally provide it to the <literal>mount</literal> command.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">VFS Type</emphasis>, as you would normally provide it to the <literal>mount</literal> command using the <literal>-t</literal> argument. See <literal>man mount</literal> for a list of valid VFS types.</simpara>
</listitem>
<listitem>
<simpara>Enter additional <emphasis role="strong">Mount Options</emphasis>, as you would normally provide them to the <literal>mount</literal> command using the <literal>-o</literal> argument. The mount options should be provided in a comma-separated list. See <literal>man mount</literal> for a list of valid mount options.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can configure the advanced parameters.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Advanced Parameters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a percentage value in the <emphasis role="strong">Warning Low Space Indicator</emphasis> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</simpara>
</listitem>
<listitem>
<simpara>Enter a GB value in the <emphasis role="strong">Critical Space Action Blocker</emphasis> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Wipe After Delete</emphasis> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Preparing_and_Adding_Block_Storage">
<title>Preparing and Adding Block Storage</title>
<section xml:id="Preparing_iSCSI_Storage_storage_admin">
<title>Preparing iSCSI Storage</title>
<simpara>oVirt supports iSCSI storage, which is a storage domain created from a volume group made up of LUNs. Volume groups and LUNs cannot be attached to more than one storage domain at a time.</simpara>
<simpara>For information on setting up and configuring iSCSI storage, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_storage_devices/index#getting-started-with-iscsi_managing-storage-devices">Getting started with iSCSI</link> in <emphasis>Managing storage devices</emphasis> for Red Hat Enterprise Linux 8.</simpara>
<important>
<simpara>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <literal>vdsm-tool config-lvm-filter</literal> command to create filters for the LVM.</simpara>
</important>
<important>
<simpara>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</simpara>
</important>
<important>
<simpara>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</simpara>
<simpara>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</simpara>
<screen># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <emphasis>boot_LUN_wwid</emphasis>
        no_path_retry queue
    }</screen>
</important>
</section>
<section xml:id="Adding_iSCSI_Storage_storage_admin">
<title>Adding iSCSI Storage</title>
<simpara>This procedure shows you how to attach existing iSCSI storage to your oVirt environment as a data domain.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> of the new storage domain.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Data Center</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Data</emphasis> as the <emphasis role="strong">Domain Function</emphasis> and <emphasis role="strong">iSCSI</emphasis> as the <emphasis role="strong">Storage Type</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select an active host as the <emphasis role="strong">Host</emphasis>.</simpara>
<important>
<simpara>Communication to the storage domain is from the selected host and not directly from the Engine. Therefore, all hosts must have access to the storage device before the storage domain can be configured.</simpara>
</important>
</listitem>
<listitem>
<simpara>The Engine can map iSCSI targets to LUNs or LUNs to iSCSI targets. The <emphasis role="strong">New Domain</emphasis> window automatically displays known targets with unused LUNs when the iSCSI storage type is selected. If the target that you are using to add storage does not appear, you can use target discovery to find it; otherwise proceed to the next step.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Discover Targets</emphasis> to enable target discovery options. When targets have been discovered and logged in to, the <emphasis role="strong">New Domain</emphasis> window automatically displays targets with LUNs unused by the environment.</simpara>
<note>
<simpara>LUNs used externally for the environment are also displayed.</simpara>
</note>
<simpara>You can use the <emphasis role="strong">Discover Targets</emphasis> options to add LUNs on many targets or multiple paths to the same LUNs.</simpara>
<important>
<simpara>If you use the REST API method <literal>iscsidiscover</literal> to discover the iscsi targets, you can use an FQDN or an IP address, but you must use the iscsi details from the discovered targets results to log in using the REST API method <literal>iscsilogin</literal>. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-iscsi_discover">iscsidiscover</link> in the <emphasis>REST API Guide</emphasis> for more information.</simpara>
</important>
</listitem>
<listitem>
<simpara>Enter the FQDN or IP address of the iSCSI host in the <emphasis role="strong">Address</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the port with which to connect to the host when browsing for targets in the <emphasis role="strong">Port</emphasis> field. The default is <literal>3260</literal>.</simpara>
</listitem>
<listitem>
<simpara>If CHAP is used to secure the storage, select the <emphasis role="strong">User Authentication</emphasis> check box. Enter the <emphasis role="strong">CHAP user name</emphasis> and <emphasis role="strong">CHAP password</emphasis>.</simpara>
<note>
<simpara>You can define credentials for an iSCSI target for a specific host with the REST API. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-storage_server_connection_extensions-methods-add">StorageServerConnectionExtensions: add</link> in the <emphasis>REST API Guide</emphasis> for more information.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Discover</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select one or more targets from the discovery results and click <emphasis role="strong">Login</emphasis> for one target or <emphasis role="strong">Login All</emphasis> for multiple targets.</simpara>
<important>
<simpara>If more than one path access is required, you must discover and log in to the target through all the required paths. Modifying a storage domain to add additional paths is currently not supported.</simpara>
</important>
<important>
<simpara>When using the REST API <literal>iscsilogin</literal> method to log in, you must use the iscsi details from the discovered targets results in the <literal>iscsidiscover</literal> method. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-iscsi_login">iscsilogin</link> in the <emphasis>REST API Guide</emphasis> for more information.</simpara>
</important>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">+</emphasis> button next to the desired target. This expands the entry and displays all unused LUNs attached to the target.</simpara>
</listitem>
<listitem>
<simpara>Select the check box for each LUN that you are using to create the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can configure the advanced parameters:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Advanced Parameters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a percentage value into the <emphasis role="strong">Warning Low Space Indicator</emphasis> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</simpara>
</listitem>
<listitem>
<simpara>Enter a GB value into the <emphasis role="strong">Critical Space Action Blocker</emphasis> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Wipe After Delete</emphasis> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Discard After Delete</emphasis> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If you have configured multiple storage connection paths to the same target, follow the procedure in <link xl:href="https://ovirt.org/documentation/administration_guide/index#Configuring_iSCSI_Multipathing">Configuring iSCSI Multipathing</link> to complete iSCSI bonding.</simpara>
<simpara>If you want to migrate your current storage network to an iSCSI bond, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Migrating_a_logical_network_to_an_iscsi_bond">Migrating a Logical Network to an iSCSI Bond</link>.</simpara>
</section>
<section xml:id="Configuring_iSCSI_Multipathing">
<title>Configuring iSCSI Multipathing</title>
<simpara>iSCSI multipathing enables you to create and manage groups of logical networks and iSCSI storage connections. Multiple network paths between the hosts and iSCSI storage prevent host downtime caused by network path failure.</simpara>
<simpara>The Engine connects each host in the data center to each target, using the NICs or VLANs that are assigned to the logical networks in the iSCSI bond.</simpara>
<simpara>You can create an iSCSI bond with multiple targets and logical networks for redundancy.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>One or more <link linkend="Adding_iSCSI_Storage_storage_admin">iSCSI targets</link></simpara>
</listitem>
<listitem>
<simpara>One or more <link linkend="Creating_a_new_logical_network_in_a_data_center_or_cluster">logical networks</link> that meet the following requirements:</simpara>
<itemizedlist>
<listitem>
<simpara>Not defined as <link linkend="Migrating_a_logical_network_to_an_iscsi_bond"><emphasis role="strong">Required</emphasis> or <emphasis role="strong">VM Network</emphasis></link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Assigned to a host interface</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Assigned a static IP address</link> in the same VLAN and subnet as the other logical networks in the iSCSI bond</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data center name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">iSCSI Multipathing</emphasis> tab, click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Add iSCSI Bond</emphasis> window, enter a <emphasis role="strong">Name</emphasis> and a <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a logical network from <emphasis role="strong">Logical Networks</emphasis> and a storage domain from <emphasis role="strong">Storage Targets</emphasis>. You must select all the paths to the same target.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The hosts in the data center are connected to the iSCSI targets through the logical networks in the iSCSI bond.</simpara>
</section>
<section xml:id="Migrating_a_logical_network_to_an_iscsi_bond">
<title>Migrating a Logical Network to an iSCSI Bond</title>
<simpara>If you have a logical network that you created for iSCSI traffic and configured on top of an existing <link linkend="sect-Network_Bonding">network bond</link>, you can migrate it to an iSCSI bond on the same subnet without disruption or downtime.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Modify the current logical network so that it is not <emphasis role="strong">Required</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Logical Networks</emphasis> tab, select the current logical network (<literal>net-1</literal>) and click <emphasis role="strong">Manage Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Clear the <emphasis role="strong">Require</emphasis> check box and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Create a new logical network that is not <emphasis role="strong">Required</emphasis> and not <emphasis role="strong">VM network</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Add Network</emphasis>. This opens the <emphasis role="strong">New Logical Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">General</emphasis> tab, enter the <emphasis role="strong">Name</emphasis> (<literal>net-2</literal>) and clear the <emphasis role="strong">VM network</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Cluster</emphasis> tab, clear the <emphasis role="strong">Require</emphasis> check box and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Remove the current network bond and reassign the logical networks:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the host name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Network Interfaces</emphasis> tab, click <emphasis role="strong">Setup Host Networks</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Drag <literal>net-1</literal> to the right to unassign it.</simpara>
</listitem>
<listitem>
<simpara>Drag the current bond to the right to remove it.</simpara>
</listitem>
<listitem>
<simpara>Drag <literal>net-1</literal> and <literal>net-2</literal> to the left to assign them to physical interfaces.</simpara>
</listitem>
<listitem>
<simpara>Click the pencil icon of <literal>net-2</literal>. This opens the <emphasis role="strong">Edit Network</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">IPV4</emphasis> tab, select <emphasis role="strong">Static</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">IP</emphasis> and <emphasis role="strong">Netmask/Routing Prefix</emphasis> of the subnet and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Create the iSCSI bond:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data center name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">iSCSI Multipathing</emphasis> tab, click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Add iSCSI Bond</emphasis> window, enter a <emphasis role="strong">Name</emphasis>, select the networks, <literal>net-1</literal> and <literal>net-2</literal>, and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<simpara>Your data center has an iSCSI bond containing the old and new logical networks.</simpara>
</section>
<section xml:id="Preparing_FCP_Storage_storage_admin">
<title>Preparing FCP Storage</title>
<simpara>oVirt supports SAN storage by creating a storage domain from a volume group made of pre-existing LUNs. Neither volume groups nor LUNs can be attached to more than one storage domain at a time.</simpara>
<simpara>oVirt system administrators need a working knowledge of Storage Area Networks (SAN) concepts. SAN usually uses Fibre Channel Protocol (FCP) for traffic between hosts and shared external storage. For this reason, SAN may occasionally be referred to as FCP storage.</simpara>
<simpara>For information on setting up and configuring FCP or multipathing on Enterprise Linux, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/index.html"><emphasis>Storage Administration Guide</emphasis></link> and <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/DM_Multipath/index.html"><emphasis>DM Multipath Guide</emphasis></link>.</simpara>
<important>
<simpara>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <literal>vdsm-tool config-lvm-filter</literal> command to create filters for the LVM.</simpara>
</important>
<important>
<simpara>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</simpara>
</important>
<important>
<simpara>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</simpara>
<simpara>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</simpara>
<screen># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <emphasis>boot_LUN_wwid</emphasis>
        no_path_retry queue
    }</screen>
</important>
</section>
<section xml:id="Adding_FCP_Storage_storage_admin">
<title>Adding FCP Storage</title>
<simpara>This procedure shows you how to attach existing FCP storage to your oVirt environment as a data domain.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> of the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Select an FCP <emphasis role="strong">Data Center</emphasis> from the drop-down list.</simpara>
<simpara>If you do not yet have an appropriate FCP data center, select <literal>(none)</literal>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Domain Function</emphasis> and the <emphasis role="strong">Storage Type</emphasis> from the drop-down lists. The storage domain types that are not compatible with the chosen data center are not available.</simpara>
</listitem>
<listitem>
<simpara>Select an active host in the <emphasis role="strong">Host</emphasis> field. If this is not the first data domain in a data center, you must select the data center&#8217;s SPM host.</simpara>
<important>
<simpara>All communication to the storage domain is through the selected host and not directly from the oVirt Engine. At least one active host must exist in the system and be attached to the chosen data center. All hosts must have access to the storage device before the storage domain can be configured.</simpara>
</important>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">New Domain</emphasis> window automatically displays known targets with unused LUNs when <emphasis role="strong">Fibre Channel</emphasis> is selected as the storage type. Select the <emphasis role="strong">LUN ID</emphasis> check box to select all of the available LUNs.</simpara>
</listitem>
<listitem>
<simpara>Optionally, you can configure the advanced parameters.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Advanced Parameters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a percentage value into the <emphasis role="strong">Warning Low Space Indicator</emphasis> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</simpara>
</listitem>
<listitem>
<simpara>Enter a GB value into the <emphasis role="strong">Critical Space Action Blocker</emphasis> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Wipe After Delete</emphasis> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Discard After Delete</emphasis> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The new FCP data domain remains in a <literal>Locked</literal> status while it is being prepared for use. When ready, it is automatically attached to the data center.</simpara>
</section>
<section xml:id="Increasing_iSCSI_or_FCP_Storage">
<title>Increasing iSCSI or FCP Storage</title>
<simpara>There are several ways to increase iSCSI or FCP storage size:</simpara>
<itemizedlist>
<listitem>
<simpara>Add an existing LUN to the current storage domain.</simpara>
</listitem>
<listitem>
<simpara>Create a new storage domain with new LUNs and add it to an existing data center. See <xref linkend="Adding_iSCSI_Storage_storage_admin"/>.</simpara>
</listitem>
<listitem>
<simpara>Expand the storage domain by resizing the underlying LUNs.</simpara>
</listitem>
</itemizedlist>
<simpara>For information about creating, configuring, or resizing iSCSI storage on Enterprise Linux 7 systems, see the  <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Storage_Administration_Guide/index.html#osm-target-setup"><emphasis>Enterprise Linux 7 Storage Administration Guide</emphasis></link>.</simpara>
<simpara>The following procedure explains how to expand storage area network (SAN) storage by adding a new LUN to an existing storage domain.</simpara>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>The storage domain&#8217;s status must be <literal>UP</literal>.</simpara>
</listitem>
<listitem>
<simpara>The LUN must be accessible to all the hosts whose status is <literal>UP</literal>, or else the operation will fail and the LUN will not be added to the domain. The hosts themselves, however, will not be affected. If a newly added host, or a host that is coming out of maintenance or a <literal>Non Operational</literal> state, cannot access the LUN, the host&#8217;s state will be <literal>Non Operational</literal>.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Increasing an Existing iSCSI or FCP Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice> and select an iSCSI or FCP domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Manage Domain</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Targets</guimenu> <guimenuitem>LUNs</guimenuitem></menuchoice> and click the <emphasis role="strong">Discover Targets</emphasis> expansion button.</simpara>
</listitem>
<listitem>
<simpara>Enter the connection information for the storage server and click <guibutton>Discover</guibutton> to initiate the connection.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>LUNs</guimenu> <guimenuitem>Targets</guimenuitem></menuchoice> and select the check box of the newly available LUN.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to add the LUN to the selected storage domain.</simpara>
</listitem>
</orderedlist>
<simpara>This will increase the storage domain by the size of the added LUN.</simpara>
<simpara>When expanding the storage domain by resizing the underlying LUNs, the LUNs must also be refreshed in the Administration Portal.</simpara>
<simpara><emphasis role="strong">Refreshing the LUN Size</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice> and select an iSCSI or FCP domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guimenu>Manage Domain</guimenu>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>LUNs</guimenu> <guimenuitem>Targets</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Additional Size</emphasis> column, click <guibutton>Add <emphasis>Additional_Storage_Size</emphasis></guibutton> button of the LUN to refresh.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to refresh the LUN to indicate the new storage size.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Reusing_LUNs">
<title>Reusing LUNs</title>
<simpara>LUNs cannot be reused, as is, to create a storage domain or virtual disk. If you try to reuse the LUNs, the Administration Portal displays the following error message:</simpara>
<screen>Physical device initialization failed. Please check that the device is empty and accessible by the host.</screen>
<simpara>A self-hosted engine shows the following error during installation:</simpara>
<screen>[ ERROR ] Error creating Volume Group: Failed to initialize physical device: ("[u'/dev/mapper/000000000000000000000000000000000']",)
[ ERROR ] Failed to execute stage 'Misc configuration': Failed to initialize physical device: ("[u'/dev/mapper/000000000000000000000000000000000']",)</screen>
<simpara>Before the LUN can be reused, the old partitioning table must be cleared.</simpara>
<important>
<title>Procedure</title>
<simpara>You must run this procedure on the correct LUN so that you do not inadvertently destroy data.</simpara>
</important>
<orderedlist numeration="arabic">
<listitem>
<simpara>Delete the partition mappings in <emphasis>&lt;LUN_ID&gt;</emphasis>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">kpartx -dv /dev/mapper/&lt;LUN_ID&gt;</programlisting>
</listitem>
<listitem>
<simpara>Erase the fileystem or raid signatures in <emphasis>&lt;LUN_ID&gt;</emphasis>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">wipefs -a /dev/mapper/&lt;LUN_ID&gt;</programlisting>
</listitem>
<listitem>
<simpara>Inform the operating system about the partition table changes on <emphasis>&lt;LUN_ID&gt;</emphasis>:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"> partprobe</programlisting>
</listitem>
</orderedlist>
</section>
<section xml:id="Creating_LVM_filter_storage_admin">
<title>Creating an LVM filter</title>
<simpara>An LVM filter is a capability that can be set in <literal>/etc/lvm/lvm.conf</literal> to accept devices into or reject devices from the list of volumes based on a regex query.  For example, to ignore <literal>/dev/cdrom</literal> you can use <literal>filter=["r|^/dev/cdrom$|"]</literal>, or add the following parameter to the <literal>lvm</literal> command: <literal>lvs --config 'devices{filter=["r|cdrom|"]}'</literal>.</simpara>
<simpara>This provides a simple way to prevent a host from scanning and activating logical volumes that are not required directly by the host. In particular, the solution addresses logical volumes on shared storage managed by oVirt, and logical volumes created by a guest in oVirt raw volumes. This solution is needed because scanning and activating other logical volumes may cause data corruption, slow boot, or other issues.</simpara>
<simpara>The solution is to configure an LVM filter on each host, which allows the LVM on a host to scan only the logical volumes that are required by the host.</simpara>
<simpara>You can use the command <literal>vdsm-tool config-lvm-filter</literal> to analyze the current LVM configuration and decide if a filter needs to be configured.</simpara>
<simpara>If the LVM filter has not yet been configured, the command generates an LVM filter option for the host, and adds the option to the LVM configuration.</simpara>
<formalpara>
<title>Scenario 1: An Unconfigured Host</title>
<para>On a host yet to be configured, the command automatically configures the LVM once the user confirms the operation:</para>
</formalpara>
<informalexample>
<literallayout class="monospaced"># vdsm-tool config-lvm-filter</literallayout>
<literallayout class="monospaced">Analyzing host...
Found these mounted logical volumes on this host:</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_home
mountpoint:      /home
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_root
mountpoint:      /
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_swap
mountpoint:      [SWAP]
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">This is the recommended LVM filter for this host:</literallayout>
<literallayout class="monospaced">filter = [ "a|^/dev/vda2$|", "r|.*|" ]</literallayout>
<literallayout class="monospaced">This filter will allow LVM to access the local devices used by the
hypervisor, but not shared storage owned by VDSM. If you add a new
device to the volume group, you will need to edit the filter manually.</literallayout>
<literallayout class="monospaced">Configure LVM filter? [yes,NO] ? [NO/yes] yes
Configuration completed successfully!</literallayout>
<literallayout class="monospaced">Please reboot to verify the LVM configuration.</literallayout>
</informalexample>
<formalpara>
<title>Scenario 2: A Configured Host</title>
<para>If the host is already configured, the command simply informs the user that the LVM filter is already configured:</para>
</formalpara>
<informalexample>
<literallayout class="monospaced"># vdsm-tool config-lvm-filter</literallayout>
<literallayout class="monospaced">Analyzing host...
LVM filter is already configured for Vdsm</literallayout>
</informalexample>
<formalpara>
<title>Scenario 3: Manual Configuration Required</title>
<para>If the host configuration does not match the configuration required by VDSM, the LVM filter will need to be configured manually:</para>
</formalpara>
<informalexample>
<literallayout class="monospaced"># vdsm-tool config-lvm-filter</literallayout>
<literallayout class="monospaced">Analyzing host...
Found these mounted logical volumes on this host:</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_home
mountpoint:      /home
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_root
mountpoint:      /
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">logical volume:  /dev/mapper/vg0-lv_swap
mountpoint:      [SWAP]
devices:         /dev/vda2</literallayout>
<literallayout class="monospaced">This is the recommended LVM filter for this host:</literallayout>
<literallayout class="monospaced">filter = [ "a|^/dev/vda2$|", "r|.*|" ]</literallayout>
<literallayout class="monospaced">This filter will allow LVM to access the local devices used by the
hypervisor, but not shared storage owned by VDSM. If you add a new
device to the volume group, you will need to edit the filter manually.</literallayout>
<literallayout class="monospaced">This is the current LVM filter:</literallayout>
<literallayout class="monospaced">filter = [ "a|^/dev/vda2$|", "a|^/dev/vdb1$|", "r|.*|" ]</literallayout>
<literallayout class="monospaced">WARNING: The current LVM filter does not match the recommended filter,
Vdsm cannot configure the filter automatically.</literallayout>
<literallayout class="monospaced">Please edit /etc/lvm/lvm.conf and set the 'filter' option in the  'devices' section to the recommended value.</literallayout>
<literallayout class="monospaced">It is recommended to reboot after changing LVM filter.</literallayout>
</informalexample>
</section>
</section>
<section xml:id="Adding_Red_Hat_Gluster_Storage">
<title>Preparing and Adding Gluster Storage</title>
<section xml:id="Preparing_Red_Hat_Gluster_Storage_storage_admin">
<title>Preparing Gluster Storage</title>
<simpara>For information on setting up and configuring Gluster Storage, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.5/html/installation_guide/"><emphasis>Gluster Storage Installation Guide</emphasis></link>.</simpara>
</section>
<section xml:id="Adding_Red_Hat_Gluster_Storage_storage_admin">
<title>Adding Gluster Storage</title>
<simpara>To use Gluster Storage with oVirt, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.4/html/configuring_red_hat_virtualization_with_red_hat_gluster_storage/"><emphasis>Configuring oVirt with Gluster Storage</emphasis></link>.</simpara>
<simpara>For the Gluster Storage versions that are supported with oVirt, see <link xl:href="https://access.redhat.com/articles/2356261">https://access.redhat.com/articles/2356261</link>.</simpara>
</section>
</section>
<section xml:id="sect-Importing_Existing_Storage_Domains">
<title>Importing Existing Storage Domains</title>
<section xml:id="Overview_of_Importing_Existing_Storage_Domains">
<title>Overview of Importing Existing Storage Domains</title>
<simpara>Aside from adding new storage domains, which contain no data, you can import existing storage domains and access the data they contain. By importing storage domains, you can recover data in the event of a failure in the Manager database, and migrate data from one data center or environment to another.</simpara>
<simpara>The following is an overview of importing each storage domain type:</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong">Data</emphasis></term>
<listitem>
<simpara>Importing an existing data storage domain allows you to access all of the virtual machines and templates that the data storage domain contains. After you import the storage domain, you must manually import virtual machines, floating disk images, and templates into the destination data center. The process for importing the virtual machines and templates that a data storage domain contains is similar to that for an export storage domain. However, because data storage domains contain all the virtual machines and templates in a given data center, importing data storage domains is recommended for data recovery or large-scale migration of virtual machines between data centers or environments.</simpara>
<important>
<simpara>You can import existing data storage domains that were attached to data centers with the correct supported compatibility level. See <link xl:href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</link> for more information.</simpara>
</important>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">ISO</emphasis></term>
<listitem>
<simpara>Importing an existing ISO storage domain allows you to access all of the ISO files and virtual diskettes that the ISO storage domain contains. No additional action is required after importing the storage domain to access these resources; you can attach them to virtual machines as required.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">Export</emphasis></term>
<listitem>
<simpara>Importing an existing export storage domain allows you to access all of the virtual machine images and templates that the export storage domain contains. Because export domains are designed for exporting and importing virtual machine images and templates, importing export storage domains is recommended method of migrating small numbers of virtual machines and templates inside an environment or between environments. For information on exporting and importing virtual machines and templates to and from export storage domains, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Exporting_and_Importing_Virtual_Machines_and_Templates">Exporting and Importing Virtual Machines and Templates</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
<note>
<simpara>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center.</simpara>
</note>
<warning>
<simpara>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</simpara>
</warning>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Importing_storage_domains">
<title>Importing storage domains</title>
<simpara>Import a storage domain that was previously attached to a data center in the same environment or in a different environment. This procedure assumes the storage domain is no longer attached to any data center in any environment, to avoid data corruption. To import and attach an existing data storage domain to a data center, the target data center must be initialized.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> you want to import the storage domain to.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> for the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Domain Function</emphasis> and <emphasis role="strong">Storage Type</emphasis> from the drop-down lists.</simpara>
</listitem>
<listitem>
<simpara>Select a host from the <emphasis role="strong">Host</emphasis> drop-down list.</simpara>
<important>
<simpara>All communication to the storage domain is through the selected host and not directly from the oVirt Engine. At least one active host must exist in the system and be attached to the chosen data center. All hosts must have access to the storage device before the storage domain can be configured.</simpara>
</important>
</listitem>
<listitem>
<simpara>Enter the details of the storage domain.</simpara>
<note>
<simpara>The fields for specifying the details of the storage domain change depending on the values you select in the <emphasis role="strong">Domain Function</emphasis> and <emphasis role="strong">Storage Type</emphasis> lists. These fields are the same as those available for adding a new storage domain.</simpara>
</note>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Activate Domain in Data Center</emphasis> check box to activate the storage domain after attaching it to the selected data center.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You can now import virtual machines and templates from the storage domain to the data center.</simpara>
<warning>
<simpara>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</simpara>
</warning>
<itemizedlist>
<title>Related information</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_Data_Domain">Importing Virtual Machines from a Data Domain</link></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Importing_Templates_from_Imported_Data_Storage_Domains"/></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Migrating_SD_between_DC_Same_Env">
<title>Migrating Storage Domains between Data Centers in the Same Environment</title>
<simpara>Migrate a storage domain from one data center to another in the same oVirt environment to allow the destination data center to access the data contained in the storage domain. This procedure involves detaching the storage domain from one data center, and attaching it to a different data center.</simpara>
<warning>
<simpara>Migrating a data storage domain to a data center that has a higher compatibility level than the original data center upgrades the storage domain’s storage format version.</simpara>
</warning>
<simpara>If you want to move the storage domain back to the original data center for any reason, such as to migrate virtual machines to the new data center, be aware that the higher version prevents reattaching the data storage domain to the original data center.</simpara>
<simpara>The Administration Portal prompts you to confirm that you want to update the storage domain format, for example, from <emphasis role="strong">V3</emphasis> to <emphasis role="strong">V5</emphasis>. It also warns that you will not be able to attach it back to an older data center with a lower DC level.</simpara>
<simpara>To work around this issue, you can create a target data center that has the same compatibility version as the source data center. When you no longer need to maintain the lower compatibility version, you can increase the target data center’s compatibility version.</simpara>
<simpara>For details, see <link xl:href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</link>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Shut down all virtual machines running on the required storage domain.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Attach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the destination data center and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is attached to the destination data center and is automatically activated. You can now import virtual machines and templates from the storage domain to the destination data center.</simpara>
</section>
<section xml:id="Migrating_SD_between_DC_different_env">
<title>Migrating Storage Domains between Data Centers in Different Environments</title>
<simpara>Migrate a storage domain from one oVirt environment to another
to allow the destination environment to access the data contained in the storage domain.
This procedure involves removing the storage domain from one oVirt environment,
and importing it into a different environment.
To import and attach an existing data storage domain to a oVirt data center,
the storage domain&#8217;s source data center must have the correct supported compatibility level.</simpara>
<warning>
<simpara>Migrating a data storage domain to a data center that has a higher compatibility level than the original data center upgrades the storage domain’s storage format version.</simpara>
</warning>
<simpara>If you want to move the storage domain back to the original data center for any reason, such as to migrate virtual machines to the new data center, be aware that the higher version prevents reattaching the data storage domain to the original data center.</simpara>
<simpara>The Administration Portal prompts you to confirm that you want to update the storage domain format, for example, from <emphasis role="strong">V3</emphasis> to <emphasis role="strong">V5</emphasis>. It also warns that you will not be able to attach it back to an older data center with a lower DC level.</simpara>
<simpara>To work around this issue, you can create a target data center that has the same compatibility version as the source data center. When you no longer need to maintain the lower compatibility version, you can increase the target data center’s compatibility version.</simpara>
<simpara>For details, see <link xl:href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</link>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Administration Portal of the source environment.</simpara>
</listitem>
<listitem>
<simpara>Shut down all virtual machines running on the required storage domain.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Remove Storage(s)</emphasis> window, ensure the <emphasis role="strong">Format Domain, i.e. Storage Content will be lost!</emphasis> check box is not selected. This step preserves the data in the storage domain for later use.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to remove the storage domain from the source environment.</simpara>
</listitem>
<listitem>
<simpara>Log in to the Administration Portal of the destination environment.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the destination data center from the <emphasis role="strong">Data Center</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter a name for the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Domain Function</emphasis> and <emphasis role="strong">Storage Type</emphasis> from the appropriate drop-down lists.</simpara>
</listitem>
<listitem>
<simpara>Select a host from the <emphasis role="strong">Host</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the details of the storage domain.</simpara>
<note>
<simpara>The fields for specifying the details of the storage domain change depending on the value you select in the <emphasis role="strong">Storage Type</emphasis> drop-down list. These fields are the same as those available for adding a new storage domain.</simpara>
</note>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Activate Domain in Data Center</emphasis> check box to automatically activate the storage domain when it is attached.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is attached to the destination data center in the new oVirt environment and is automatically activated. You can now import virtual machines and templates from the imported storage domain to the destination data center.</simpara>
<warning>
<simpara>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</simpara>
</warning>
</section>
<section xml:id="Importing_Templates_from_Imported_Data_Storage_Domains">
<title>Importing Templates from Imported Data Storage Domains</title>
<simpara>Import a template from a data storage domain you have imported into your oVirt environment. This procedure assumes that the imported data storage domain has been attached to a data center and has been activated.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the imported storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Template Import</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select one or more templates to import.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For each template in the <emphasis role="strong">Import Templates(s)</emphasis> window, ensure the correct target cluster is selected in the <emphasis role="strong">Cluster</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Map external virtual machine vNIC profiles to profiles that are present on the target cluster(s):</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">vNic Profiles Mapping</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the vNIC profile to use from the <emphasis role="strong">Target vNic Profile</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>If multiple target clusters are selected in the <emphasis role="strong">Import Templates</emphasis> window, select each target cluster in the <emphasis role="strong">Target Cluster</emphasis> drop-down list and ensure the mappings are correct.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The imported templates no longer appear in the list under the <emphasis role="strong">Template Import</emphasis> tab.</simpara>
</section>
</section>
<section xml:id="sect-Storage_Tasks">
<title>Storage Tasks</title>
<section xml:id="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">
<title>Uploading Images to a Data Storage Domain</title>
<simpara>You can upload virtual disk images and ISO images to your data storage domain in the Administration Portal or with the REST API.</simpara>
<note>
<simpara>To upload images with the REST API, see <link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers">IMAGETRANSFERS</link> and <link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfer">IMAGETRANSFER</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</note>
<simpara>QEMU-compatible virtual disks can be attached to virtual machines. Virtual disk types must be either QCOW2 or raw. Disks created from a QCOW2 virtual disk cannot be shareable, and the QCOW2 virtual disk file must not have a backing file.</simpara>
<simpara>ISO images can be attached to virtual machines as CDROMs or used to boot virtual machines.</simpara>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<simpara>The upload function uses HTML 5 APIs, which requires your environment to have the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Image I/O Proxy (<literal>ovirt-imageio-proxy</literal>), configured with <literal>engine-setup</literal>. See <link xl:href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</link> for details.</simpara>
</listitem>
<listitem>
<simpara>Certificate authority, imported into the web browser used to access the Administration Portal.</simpara>
<simpara>To import the certificate authority, browse to <literal>https://<emphasis>engine_address</emphasis>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</literal> and enable all the trust settings. Refer to the instructions to install the certificate authority in <link xl:href="https://access.redhat.com/solutions/95103">Firefox</link>, <link xl:href="https://access.redhat.com/solutions/17864">Internet Explorer</link>, or <link xl:href="https://access.redhat.com/solutions/1168383">Google Chrome</link>.</simpara>
</listitem>
<listitem>
<simpara>Browser that supports HTML 5, such as Firefox 35, Internet Explorer 10, Chrome 13, or later.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Uploading an Image to a Data Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Start</emphasis> from the <emphasis role="strong">Upload</emphasis> menu.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Choose File</emphasis> and select the image to upload.</simpara>
</listitem>
<listitem>
<simpara>Fill in the <emphasis role="strong">Disk Options</emphasis> fields. See <xref linkend="Explanation_of_Settings_in_the_New_Virtual_Disk_Window"/> for descriptions of the relevant fields.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
<simpara>A progress bar indicates the status of the upload. You can pause, cancel, or resume uploads from the <emphasis role="strong">Upload</emphasis> menu.</simpara>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Increasing the Upload Timeout Value</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>If the upload times out and you see the message, <emphasis role="strong">Reason: timeout due to transfer inactivity</emphasis>, increase the timeout value:</simpara>
<screen># engine-config -s TransferImageClientInactivityTimeoutInSeconds=6000</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Copy_ISO_to_ISO_domain-storage_tasks">
<title>Uploading images to an ISO domain</title>
<note>
<simpara>The ISO domain is a deprecated storage domain type. The ISO Uploader tool, <literal>ovirt-iso-uploader</literal>, is removed in oVirt 4.4. You should upload ISO images to the data domain with the Administration Portal or with the REST API. See <xref linkend="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks"/> for details.</simpara>
<simpara>Although the ISO domain is deprecated, this information is provided in case you must use an ISO domain.</simpara>
</note>
<simpara>To upload an ISO image to an ISO storage domain in order to make it available from within the Engine, follow these steps.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Login as root to the host that belongs to the Data Center where your ISO storage domain resides.</simpara>
</listitem>
<listitem>
<simpara>Get a directory tree of <literal>/rhv/data-center</literal>:</simpara>
<screen># tree /rhev/data-center
.
|-- 80dfacc7-52dd-4d75-ab82-4f9b8423dc8b
|   |-- 76d1ecba-b61d-45a4-8eb5-89ab710a6275 &#8594; /rhev/data-center/mnt/10.10.10.10:_rhevnfssd/76d1ecba-b61d-45a4-8eb5-89ab710a6275
|   |-- b835cd1c-111c-468d-ba70-fec5346af227 &#8594; /rhev/data-center/mnt/10.10.10.10:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227
|   |-- mastersd &#8594; 76d1ecba-b61d-45a4-8eb5-89ab710a6275
|   |-- tasks &#8594; mastersd/master/tasks
|   `-- vms &#8594; mastersd/master/vms
|-- hsm-tasks
`-- mnt
    |-- 10.10.10.10:_rhevisosd
    |   |-- b835cd1c-111c-468d-ba70-fec5346af227
    |   |   |-- dom_md
    |   |   |   |-- ids
    |   |   |   |-- inbox
    |   |   |   |-- leases
    |   |   |   |-- metadata
    |   |   |   `-- outbox
    |   |   `-- images
    |   |       `-- 11111111-1111-1111-1111-111111111111
    |   `-- lost+found [error opening dir]

(output trimmed)</screen>
</listitem>
<listitem>
<simpara>Securely copy the image from the source location into the full path of <literal>11111111-1111-1111-1111-111111111111</literal>:</simpara>
<screen># scp root@isosource:/isos/example.iso /rhev/data-center/mnt/10.96.4.50:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227/images/11111111-1111-1111-1111-111111111111</screen>
</listitem>
<listitem>
<simpara>File permissions for the newly copied ISO image should be 36:36 (vdsm:kvm). If they are not, change user and group ownership of the ISO file to 36:36 (vdsm&#8217;s user and group):</simpara>
<screen># cd /rhev/data-center/mnt/10.96.4.50:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227/images/11111111-1111-1111-1111-111111111111
# chown 36.36 example.iso</screen>
</listitem>
</orderedlist>
<simpara>The ISO image should now be available in the ISO domain in the data center.</simpara>
</section>
<section xml:id="Moving_storage_domains_to_maintenance_mode">
<title>Moving Storage Domains to Maintenance Mode</title>
<simpara>A storage domain must be in maintenance mode before it can be detached and removed. This is required to redesignate another data domain as the master data domain.</simpara>
<important>
<simpara>You cannot move a storage domain into maintenance mode if a virtual machine has a lease on the storage domain. The virtual machine needs to be shut down, or the lease needs to be to removed or moved to a different storage domain first. See the <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#What_is_high_availability"><emphasis>Virtual Machine Management Guide</emphasis></link> for information about virtual machine leases.</simpara>
</important>
<simpara>Expanding iSCSI domains by adding more LUNs can only be done when the domain is active.</simpara>
<simpara><emphasis role="strong">Moving storage domains to maintenance mode</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Shut down all the virtual machines running on the storage domain.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>.</simpara>
<note>
<simpara>The <literal>Ignore OVF update failure</literal> check box allows the storage domain to go into maintenance mode even if the OVF update fails.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is deactivated and has an <literal>Inactive</literal> status in the results list. You can now edit, detach, remove, or reactivate the inactive storage domains from the data center.</simpara>
<note>
<simpara>You can also activate, detach, and place domains into maintenance mode using the Storage tab in the details view of the data center it is associated with.</simpara>
</note>
</section>
<section xml:id="Editing_Storage_Domains">
<title>Editing Storage Domains</title>
<simpara>You can edit storage domain parameters through the Administration Portal. Depending on the state of the storage domain, either active or inactive, different fields are available for editing. Fields such as <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Domain Function</emphasis>, <emphasis role="strong">Storage Type</emphasis>, and <emphasis role="strong">Format</emphasis> cannot be changed.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Active</emphasis>: When the storage domain is in an active state, the <emphasis role="strong">Name</emphasis>, <emphasis role="strong">Description</emphasis>, <emphasis role="strong">Comment</emphasis>, <emphasis role="strong">Warning Low Space Indicator (%)</emphasis>, <emphasis role="strong">Critical Space Action Blocker (GB)</emphasis>, <emphasis role="strong">Wipe After Delete</emphasis>, and <emphasis role="strong">Discard After Delete</emphasis> fields can be edited. The <emphasis role="strong">Name</emphasis> field can only be edited while the storage domain is active. All other fields can also be edited while the storage domain is inactive.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Inactive</emphasis>: When the storage domain is in maintenance mode or unattached, thus in an inactive state, you can edit all fields except <emphasis role="strong">Name</emphasis>, <emphasis role="strong">Data Center</emphasis>, <emphasis role="strong">Domain Function</emphasis>, <emphasis role="strong">Storage Type</emphasis>, and <emphasis role="strong">Format</emphasis>. The storage domain must be inactive to edit storage connections, mount options, and other advanced parameters. This is only supported for NFS, POSIX, and Local storage types.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>iSCSI storage connections cannot be edited via the Administration Portal, but can be edited via the REST API. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-storage_server_connection_extension-methods-update">Updating Storage Connections</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</note>
<simpara><emphasis role="strong">Editing an Active Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice> and select a storage domain.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the available fields as required.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Editing an Inactive Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>If the storage domain is active, move it to maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the storage path and other details as required. The new connection details must be of the same storage type as the original connection.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Activate the storage domain:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Activate</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="_updating_ovfs">
<title>Updating OVFs</title>
<simpara>By default, OVFs are updated every 60 minutes. However, if you have imported an important virtual machine or made a critical update, you can update OVFs manually.</simpara>
<simpara><emphasis role="strong">Updating OVFs</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the storage domain and click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Update OVFs</emphasis>.</simpara>
<simpara>The OVFs are updated and a message appears in <emphasis role="strong">Events</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Activating_storage_domains">
<title>Activating Storage Domains from Maintenance Mode</title>
<simpara>If you have been making changes to a data center&#8217;s storage, you have to put storage domains into maintenance mode. Activate a storage domain to resume using it.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click an inactive storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Centers</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Activate</emphasis>.</simpara>
</listitem>
</orderedlist>
<important>
<simpara>If you attempt to activate the ISO domain before activating the data domain, an error message displays and the domain is not activated.</simpara>
</important>
</section>
<section xml:id="Detaching_a_storage_domain">
<title>Detaching a Storage Domain from a Data Center</title>
<simpara>Detach a storage domain from one data center to migrate it to another data center.</simpara>
<simpara><emphasis role="strong">Detaching a Storage Domain from the Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to initiate maintenance mode.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to detach the storage domain.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain has been detached from the data center, ready to be attached to another data center.</simpara>
</section>
<section xml:id="Attaching_a_storage_domain">
<title>Attaching a Storage Domain to a Data Center</title>
<simpara>Attach a storage domain to a data center.</simpara>
<simpara><emphasis role="strong">Attaching a Storage Domain to a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Attach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate data center.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is attached to the data center and is automatically activated.</simpara>
</section>
<section xml:id="Removing_a_Storage_Domain_storage_tasks">
<title>Removing a Storage Domain</title>
<simpara>You have a storage domain in your data center that you want to remove from the virtualized environment.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Move the storage domain to maintenance mode and detach it:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">Format Domain, i.e. Storage Content will be lost!</emphasis> check box to erase the content of the domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is permanently removed from the environment.</simpara>
</section>
<section xml:id="Destroying_a_storage_domain">
<title>Destroying a Storage Domain</title>
<simpara>A storage domain encountering errors may not be able to be removed through the normal procedure. Destroying a storage domain forcibly removes the storage domain from the virtualized environment.</simpara>
<simpara><emphasis role="strong">Destroying a Storage Domain</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the storage domain and click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Destroy</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Approve operation</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Creating_a_Disk_Profile">
<title>Creating a Disk Profile</title>
<simpara>Disk profiles define the maximum level of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Disk profiles are created based on storage profiles defined under data centers, and must be manually assigned to individual virtual disks for the profile to take effect.</simpara>
<simpara>This procedure assumes you have already defined one or more storage quality of service entries under the data center to which the storage domain belongs.</simpara>
<simpara><emphasis role="strong">Creating a Disk Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disk Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and a <emphasis role="strong">Description</emphasis> for the disk profile.</simpara>
</listitem>
<listitem>
<simpara>Select the quality of service to apply to the disk profile from the <emphasis role="strong">QoS</emphasis> list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_a_Disk_Profile">
<title>Removing a Disk Profile</title>
<simpara>Remove an existing disk profile from your oVirt environment.</simpara>
<simpara><emphasis role="strong">Removing a Disk Profile</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the data storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disk Profiles</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the disk profile to remove.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If the disk profile was assigned to any virtual disks, the disk profile is removed from those virtual disks.</simpara>
</section>
<section xml:id="Viewing_Storage_Health_Status">
<title>Viewing the Health Status of a Storage Domain</title>
<simpara>Storage domains have an external health status in addition to their regular <emphasis role="strong">Status</emphasis>. The external health status is reported by plug-ins or external systems, or set by an administrator, and appears to the left of the storage domain&#8217;s <emphasis role="strong">Name</emphasis> as one of the following icons:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">OK</emphasis>: No icon</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Info</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Info.png"/>
</imageobject>
<textobject><phrase>Info</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Warning</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Warning.png"/>
</imageobject>
<textobject><phrase>Warning</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Error</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Error.png"/>
</imageobject>
<textobject><phrase>Error</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Failure</emphasis>: <inlinemediaobject>
<imageobject>
<imagedata fileref="images/Failure.png"/>
</imageobject>
<textobject><phrase>Failure</phrase></textobject>
</inlinemediaobject></simpara>
</listitem>
</itemizedlist>
<simpara>To view further details about the storage domain&#8217;s health status, click the storage domain&#8217;s name. This opens the details view, and click the <emphasis role="strong">Events</emphasis> tab.</simpara>
<simpara>The storage domain&#8217;s health status can also be viewed using the REST API. A <literal>GET</literal> request on a storage domain will include the <literal>external_status</literal> element, which contains the health status.</simpara>
<simpara>You can set a storage domain&#8217;s health status in the REST API via the <literal>events</literal> collection. For more information, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-events-methods-add">Adding Events</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</section>
<section xml:id="Setting_Discard_After_Delete_for_a_Storage_Domain">
<title>Setting Discard After Delete for a Storage Domain</title>
<simpara>When the <emphasis role="strong">Discard After Delete</emphasis> check box is selected, a <literal>blkdiscard</literal> command is called on a logical volume when it is removed and the underlying storage is notified that the blocks are free. The storage array can use the freed space and allocate it when requested. <emphasis role="strong">Discard After Delete</emphasis> only works on block storage. The flag is not available on the oVirt Engine for file storage, for example NFS.</simpara>
<simpara><emphasis role="strong">Restrictions:</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Discard After Delete</emphasis> is only available on block storage domains, such as iSCSI or Fibre Channel.</simpara>
</listitem>
<listitem>
<simpara>The underlying storage must support <literal>Discard</literal>.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Discard After Delete</emphasis> can be enabled both when creating a block storage domain or when editing a block storage domain. See <link linkend="sect-Preparing_and_Adding_Block_Storage">Preparing and Adding Block Storage</link> and <link linkend="Editing_Storage_Domains">Editing Storage Domains</link>.</simpara>
</section>
<section xml:id="Enabling-4K-support-more-than-250-nodes-storage_tasks">
<title>Enabling 4K support on environments with more than 250 hosts</title>
<simpara>By default, GlusterFS domains and local storage domains support 4K block size on oVirt environments with up to 250 hosts. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</simpara>
<simpara>The lockspace area that Sanlock allocates is 1 MB when the maximum number of hosts is the default 250. When you increase the maximum number of hosts when using 4K storage, the lockspace area is larger. For example, when using 2000 hosts, the lockspace area could be as large as 8 MB.</simpara>
<simpara>You can enable 4K block support on environments with more than 250 hosts by setting the engine configuration parameter <literal>MaxNumberOfHostsInStoragePool</literal>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the Engine machine enable the required maximum number of hosts:</simpara>
<screen># engine-config -s MaxNumberOfHostsInStoragePool=<emphasis>NUMBER_OF_HOSTS</emphasis></screen>
</listitem>
<listitem>
<simpara>Restart the JBoss Application Server:</simpara>
<screen># service jboss-as restart</screen>
</listitem>
</orderedlist>
<simpara>For example, if you have a cluster with 300 hosts, enter:</simpara>
<screen># engine-config -s MaxNumberOfHostsInStoragePool=300
# service jboss-as restart</screen>
<formalpara>
<title>Verification</title>
<para>View the value of the <literal>MaxNumberOfHostsInStoragePool</literal> parameter on the Engine:</para>
</formalpara>
<screen> # engine-config --get=MaxNumberOfHostsInStoragePool
 MaxNumberOfHostsInStoragePool: 250 version: general</screen>
</section>
<section xml:id="Disabling-4K-support-storage_tasks">
<title>Disabling 4K support</title>
<simpara>By default, GlusterFS domains and local storage domains support 4K block size. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</simpara>
<simpara>You can disable 4K block support.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Ensure that 4K block support is enabled.</simpara>
<screen>$ vdsm-client Host getCapabilities
&#8230;&#8203;
{
    "GLUSTERFS" : [
         0,
         512,
         4096,
    ]
    &#8230;&#8203;</screen>
</listitem>
<listitem>
<simpara>Edit <literal role="filename">/etc/vdsm/vdsm.conf.d/gluster.conf</literal> and set <literal>enable_4k_storage</literal> to <literal><emphasis role="strong">false</emphasis></literal>. For example:</simpara>
<screen>$ vi  /etc/vdsm/vdsm.conf.d/gluster.conf

[gluster]
# Use to disable 4k support
# if needed.
enable_4k_storage = false</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="monitoring-available-space-in-a-storage-domain_storage_tasks">
<title>Monitoring available space in a storage domain</title>
<simpara role="_abstract">You can monitor available space in a storage domain and create an alert to warn you when a storage domain is nearing capacity. You can also define a critical threshold at which point the domain shuts down.</simpara>
<simpara>With Virtual Data Optimizer (VDO) and thin pool support, you might see more available space than is physically available. For VDO this behavior is expected, but the Engine cannot predict how much data you can actually write. The <emphasis role="strong">Warning Low Confirmed Space Indicator</emphasis> parameter notifies you when the domain is nearing physical space capacity and shows how much confirmed space remains. Confirmed space refers to the actual space available to write data.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Storage Domain</guimenuitem></menuchoice> and click the name of a storage domain.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Domain</emphasis>. The <emphasis role="strong">Manage Domains</emphasis> dialog box opens.</simpara>
</listitem>
<listitem>
<simpara>Expand <emphasis role="strong">Advanced Parameters</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">Warning Low Space Indicator (%)</emphasis> enter a percentage value. When the available space in the storage domain reaches this value, the Engine alerts you that the domain is nearing capacity.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">Critical Space Action Blocker (GB)</emphasis>, enter a value in gigabytes. When the available space in the storage domain reaches this value, the Engine shuts down.</simpara>
</listitem>
<listitem>
<simpara>For <emphasis role="strong">Warning Low Confirmed Space Indicator (%)</emphasis> enter a percentage value. When the available space in the storage domain reaches this value, the Engine alerts you that the actual space available to write data is nearing capacity.</simpara>
</listitem>
</orderedlist>
</section>
</section>
</chapter>
<chapter xml:id="chap-Pools">
<title>Pools</title>
<section xml:id="Pools">
<title>Introduction to Virtual Machine Pools</title>
<simpara>A virtual machine pool is a group of virtual machines that are all clones of the same template and that can be used on demand by any user in a given group. Virtual machine pools allow administrators to rapidly configure a set of generalized virtual machines for users.</simpara>
<simpara>Users access a virtual machine pool by taking a virtual machine from the pool. When a user takes a virtual machine from a pool, they are provided with any one of the virtual machines in the pool if any are available. That virtual machine will have the same operating system and configuration as that of the template on which the pool was based, but users may not receive the same member of the pool each time they take a virtual machine. Users can also take multiple virtual machines from the same virtual machine pool depending on the configuration of that pool.</simpara>
<simpara>Virtual machine pools are stateless by default, meaning that virtual machine data and configuration changes are not persistent across reboots. However, the pool can be configured to be stateful, allowing changes made by a previous user to persist. However, if a user configures console options for a virtual machine taken from a virtual machine pool, those options will be set as the default for that user for that virtual machine pool.</simpara>
<note>
<simpara>Virtual machines taken from a pool are not stateless when accessed from the Administration Portal. This is because administrators need to be able to write changes to the disk if necessary.</simpara>
</note>
<simpara>In principle, virtual machines in a pool are started when taken by a user, and shut down when the user is finished. However, virtual machine pools can also contain pre-started virtual machines. Pre-started virtual machines are kept in an up state, and remain idle until they are taken by a user. This allows users to start using such virtual machines immediately, but these virtual machines will consume system resources even while not in use due to being idle.</simpara>
</section>
<section xml:id="Creating_a_VM_Pool">
<title>Creating a virtual machine pool</title>
<simpara>You can create a virtual machine pool containing multiple virtual machines based on a common template. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#chap-Templates">Templates</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for information about sealing a virtual machine and creating a template.</simpara>
<simpara><emphasis role="strong"><literal>Sysprep</literal> File Configuration Options for Windows Virtual Machines</emphasis></simpara>
<simpara>Several <literal>sysprep</literal> file configuration options are available, depending on your requirements.</simpara>
<simpara>If your pool does not need to join a domain, you can use the default <literal>sysprep</literal> file, located in <literal>/usr/share/ovirt-engine/conf/sysprep/</literal>.</simpara>
<simpara>If your pool needs to join a domain, you can create a custom <literal>sysprep</literal> for each Windows operating system:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Copy the relevant sections for each operating system from <literal>/usr/share/ovirt-engine/conf/osinfo-defaults.properties</literal> to a new file and save as <literal>99-defaults.properties</literal>.</simpara>
</listitem>
<listitem>
<simpara>In <literal>99-defaults.properties</literal>, specify the Windows product activation key and the path of your new custom <literal>sysprep</literal> file:</simpara>
<screen>os.<emphasis>operating_system</emphasis>.productKey.value=<emphasis>Windows_product_activation_key</emphasis>
...
os.<emphasis>operating_system</emphasis>.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.<emphasis>operating_system</emphasis></screen>
</listitem>
<listitem>
<simpara>Create a new <literal>sysprep</literal> file, specifying the domain, domain password, and domain administrator:</simpara>
<screen>    &lt;Credentials&gt;
        &lt;Domain&gt;<emphasis>AD_Domain</emphasis>&lt;/Domain&gt;
        &lt;Password&gt;<emphasis>Domain_Password</emphasis>&lt;/Password&gt;
        &lt;Username&gt;<emphasis>Domain_Administrator</emphasis>&lt;/Username&gt;
    &lt;/Credentials&gt;</screen>
</listitem>
</orderedlist>
<simpara>If you need to configure different <literal>sysprep</literal> settings for different pools of Windows virtual machines, you can create a custom <literal>sysprep</literal> file in the Administration Portal (see <link xl:href="#custom_sysprep">Creating a Virtual Machine Pool</link> below). See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Using_Sysprep_to_Automate_the_Configuration_of_Virtual_Machines">Using Sysprep to Automate the Configuration of Virtual Machines</link> in the <emphasis>Virtual Machine Guide</emphasis> for more information.</simpara>
<simpara><emphasis role="strong">Creating a Virtual Machine Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Cluster</emphasis>  from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Template</emphasis> and version from the drop-down menu. A template provides standard settings for all the virtual machines in the pool.</simpara>
</listitem>
<listitem>
<simpara>Select an <emphasis role="strong">Operating System</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Use <emphasis role="strong">Optimized for</emphasis> to optimize virtual machines for <emphasis role="strong">Desktop</emphasis> or <emphasis role="strong">Server</emphasis>.</simpara>
<note>
<simpara><emphasis role="strong">High Performance</emphasis> optimization is not recommended for pools because a high performance virtual machine is pinned to a single host and concrete resources. A pool containing multiple virtual machines with such a configuration would not run well.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and, optionally, a <emphasis role="strong">Description</emphasis> and <emphasis role="strong">Comment</emphasis>.</simpara>
<simpara>The <emphasis role="strong">Name</emphasis> of the pool is applied to each virtual machine in the pool, with a numeric suffix. You can customize the numbering of the virtual machines with <literal>?</literal> as a placeholder.</simpara>
<example>
<title>Pool Name and Virtual Machine Numbering Examples</title>
<itemizedlist>
<listitem>
<simpara>Pool: <literal>MyPool</literal></simpara>
<simpara>Virtual machines: <literal>MyPool-1</literal>, <literal>MyPool-2</literal>, &#8230;&#8203; <literal>MyPool-10</literal></simpara>
</listitem>
<listitem>
<simpara>Pool: <literal>MyPool-???</literal></simpara>
<simpara>Virtual machines: <literal>MyPool-001</literal>, <literal>MyPool-002</literal>, &#8230;&#8203; <literal>MyPool-010</literal></simpara>
</listitem>
</itemizedlist>
</example>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Number of VMs</emphasis> for the pool.</simpara>
</listitem>
<listitem>
<simpara>Enter the number of virtual machines to be prestarted in the <emphasis role="strong">Prestarted</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Maximum number of VMs per user</emphasis> that a single user is allowed to run in a session. The minimum is <emphasis role="strong">1</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Delete Protection</emphasis> check box to enable delete protection. <anchor xml:id="custom_sysprep" xreflabel="[custom_sysprep]"/></simpara>
</listitem>
<listitem>
<simpara>If you are creating a pool of non-Windows virtual machines or if you are using the default <literal>sysprep</literal>, skip this step. If you are creating a custom <literal>sysprep</literal> file for a pool of Windows virtual machines:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the <emphasis role="strong">Show Advanced Options</emphasis> button.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Initial Run</emphasis> tab and select the <emphasis role="strong">Use Cloud-Init/Sysprep</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Authentication</emphasis> arrow and enter the <emphasis role="strong">User Name</emphasis> and <emphasis role="strong">Password</emphasis> or select <emphasis role="strong">Use already configured password</emphasis>.</simpara>
<note>
<simpara>This <literal>User Name</literal> is the name of the local administrator. You can change its value from its default value (<literal>user</literal>) here in the <emphasis role="strong">Authentication</emphasis> section or in a custom <literal>sysprep</literal> file.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Custom Script</emphasis> arrow and paste the contents of the default <literal>sysprep</literal> file, located in <literal>/usr/share/ovirt-engine/conf/sysprep/</literal>, into the text box.</simpara>
</listitem>
<listitem>
<simpara>You can modify the following values of the <literal>sysprep</literal> file:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>Key</literal>. If you do not want to use the pre-defined Windows activation product key, replace <literal>&lt;![CDATA[$ProductKey$]]&gt;</literal> with a valid product key:</simpara>
<screen>    &lt;ProductKey&gt;
        &lt;Key&gt;&lt;![CDATA[$ProductKey$]]&gt;&lt;/Key&gt;
    &lt;/ProductKey&gt;</screen>
<example>
<title>Windows Product Key Example</title>
<literallayout class="monospaced">&lt;ProductKey&gt;
    &lt;Key&gt;0000-000-000-000&lt;/Key&gt;
&lt;/ProductKey&gt;</literallayout>
</example>
</listitem>
<listitem>
<simpara><literal>Domain</literal> that the Windows virtual machines will join, the domain&#8217;s <literal>Password</literal>, and the domain administrator&#8217;s <literal>Username</literal>:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">    &lt;Credentials&gt;
        &lt;Domain&gt;<emphasis>AD_Domain</emphasis>&lt;/Domain&gt;
        &lt;Password&gt;<emphasis>Domain_Password</emphasis>&lt;/Password&gt;
        &lt;Username&gt;<emphasis>Domain_Administrator</emphasis>&lt;/Username&gt;
    &lt;/Credentials&gt;</programlisting>
<example>
<title>Domain Credentials Example</title>
<literallayout class="monospaced">&lt;Credentials&gt;
    &lt;Domain&gt;addomain.local&lt;/Domain&gt;
    &lt;Password&gt;12345678&lt;/Password&gt;
    &lt;Username&gt;Sarah_Smith&lt;/Username&gt;
&lt;/Credentials&gt;</literallayout>
</example>
<note>
<simpara>The <literal>Domain</literal>, <literal>Password</literal>, and <literal>Username</literal> are required to join the domain. The <literal>Key</literal> is for activation. You do not necessarily need both.</simpara>
<simpara>The domain and credentials cannot be modified in the <emphasis role="strong">Initial Run</emphasis> tab.</simpara>
</note>
</listitem>
<listitem>
<simpara><literal>FullName</literal> of the local administrator:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">    &lt;UserData&gt;
    &#8230;&#8203;
        &lt;FullName&gt;<emphasis>Local_Administrator</emphasis>&lt;/FullName&gt;
    &#8230;&#8203;
    &lt;/UserData&gt;</programlisting>
</listitem>
<listitem>
<simpara><literal>DisplayName</literal> and <literal>Name</literal> of the local administrator:</simpara>
<programlisting language="yaml" linenumbering="unnumbered">    &lt;LocalAccounts&gt;
        &lt;LocalAccount wcm:action="add"&gt;
            &lt;Password&gt;
                &lt;Value&gt;&lt;![CDATA[$AdminPassword$]]&gt;&lt;/Value&gt;
                &lt;PlainText&gt;true&lt;/PlainText&gt;
            &lt;/Password&gt;
            &lt;DisplayName&gt;<emphasis>Local_Administrator</emphasis>&lt;/DisplayName&gt;
            &lt;Group&gt;administrators&lt;/Group&gt;
            &lt;Name&gt;<emphasis>Local_Administrator</emphasis>&lt;/Name&gt;
        &lt;/LocalAccount&gt;
    &lt;/LocalAccounts&gt;</programlisting>
<simpara>The remaining variables in the <literal>sysprep</literal> file can be filled in on the <emphasis role="strong">Initial Run</emphasis> tab.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Optional. Set a <emphasis role="strong">Pool Type</emphasis>:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the <emphasis role="strong">Type</emphasis> tab and select a <emphasis role="strong">Pool Type</emphasis>:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Manual</emphasis> - The administrator is responsible for explicitly returning the virtual machine to the pool.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Automatic</emphasis> - The virtual machine is automatically returned to the virtual machine pool.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Stateful Pool</emphasis> check box to ensure that virtual machines are started in a stateful mode. This ensures that changes made by a previous user will persist on a virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Optional. Override the SPICE proxy:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the <emphasis role="strong">Console</emphasis> tab, select the <emphasis role="strong">Override SPICE Proxy</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>In the  <emphasis role="strong">Overridden SPICE proxy address</emphasis> text field, specify the address of a SPICE proxy to override the global SPICE proxy.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>For a pool of Windows virtual machines, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>, select each virtual machine from the pool, and click <menuchoice><guimenu>Run</guimenu> <guimenuitem>Run Once</guimenuitem></menuchoice>.</simpara>
<note>
<simpara>If the virtual machine does not start and <literal>Info  [windeploy.exe] Found no unattend file</literal> appears in <literal>%WINDIR%\panther\UnattendGC\setupact.log</literal>, add the <emphasis role="strong">UnattendFile</emphasis> key to the registry of the Windows virtual machine that was used to create the template for the pool:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Select the virtual machine and click <menuchoice><guimenu>Run</guimenu> <guimenuitem>Run once</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Under Boot Options, check <emphasis role="strong">Attach Windows guest tools CD</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Start</emphasis>, click <emphasis role="strong">Run</emphasis>, type <literal>regedit</literal> in the <emphasis role="strong">Open</emphasis> text box, and click <emphasis role="strong">OK</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the left pane, go to <menuchoice><guimenu>HKEY_LOCAL_MACHINE</guimenu> <guisubmenu>SYSTEM</guisubmenu> <guimenuitem>Setup</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Right-click the right pane and select <menuchoice><guimenu>New</guimenu> <guimenuitem>String Value</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Enter <emphasis role="strong">UnattendFile</emphasis> as the key name.</simpara>
</listitem>
<listitem>
<simpara>Double-click the new key and enter the <literal>unattend</literal> file name and path, for example, <emphasis role="strong">A:\Unattend.xml</emphasis>, as the key&#8217;s value.</simpara>
</listitem>
<listitem>
<simpara>Save the registry, seal the Windows virtual machine, and create a new template. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#chap-Templates">Templates</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for details.</simpara>
</listitem>
</orderedlist>
</note>
</listitem>
</orderedlist>
<simpara>You have created and configured a virtual machine pool with the specified number of identical virtual machines. You can view these virtual machines in <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>, or by clicking the name of a pool to open its details view; a virtual machine in a pool is distinguished from independent virtual machines by its icon.</simpara>
</section>
<section xml:id="sect-Explanation_of_Settings_and_Controls_in_the_New_Pool_Window">
<title>Explanation of Settings and Controls in the New Pool and Edit Pool Windows</title>
<section xml:id="New_Pool_General_Settings_Explained">
<title>New Pool and Edit Pool General Settings Explained</title>
<simpara>The following table details the information required on the <emphasis role="strong">General</emphasis> tab of the <emphasis role="strong">New Pool</emphasis> and <emphasis role="strong">Edit Pool</emphasis> windows that are specific to virtual machine pools. All other settings are identical to those in the <emphasis role="strong">New Virtual Machine</emphasis> window.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">General</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Template</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The template and template sub-version on which the virtual machine pool is based. If you create a pool based on the <literal>latest</literal> sub-version of a template, all virtual machines in the pool, when rebooted, will automatically receive the latest template version. For more information on configuring templates for virtual machines see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_General_settings_explained">Virtual Machine General Settings Explained</link> and <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide#Explanation_of_Settings_in_the_New_Template_and_Edit_Template_Windows">Explanation of Settings in the New Template and Edit Template Windows</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A meaningful description of the virtual machine pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Comment</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A field for adding plain text human-readable comments regarding the virtual machine pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Prestarted VMs</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to specify the number of virtual machines in the virtual machine pool that will be started before they are taken and kept in that state to be taken by users. The value of this field must be between <literal>0</literal> and the total number of virtual machines in the virtual machine pool.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Number of VMs/Increase number of VMs in pool by</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to specify the number of virtual machines to be created and made available in the virtual machine pool. In the edit window it allows you to increase the number of virtual machines in the virtual machine pool by the specified number. By default, the maximum number of virtual machines you can create in a pool is 1000. This value can be configured using the <literal>MaxVmsInPool</literal> key of the <literal>engine-config</literal> command.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Maximum number of VMs per user</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to specify the maximum number of virtual machines a single user can take from the virtual machine pool at any one time. The value of this field must be between <literal>1</literal> and <literal>32,767</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Delete Protection</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to prevent the virtual machines in the pool from being deleted.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="New_Pool_Pool_Settings_Explained">
<title>New Pool and Edit Pool Type Settings Explained</title>
<simpara>The following table details the information required on the <emphasis role="strong">Type</emphasis> tab of the <emphasis role="strong">New Pool</emphasis> and <emphasis role="strong">Edit Pool</emphasis> windows.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Type</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Pool Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This drop-down menu allows you to specify the type of the virtual machine pool. The following options are available:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Automatic</emphasis>: After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is automatically returned to the virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Manual</emphasis>: After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is only returned to the virtual machine pool when an administrator manually returns the virtual machine.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Stateful Pool</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Specify whether the state of virtual machines in the pool is preserved when a virtual machine is passed to a different user. This means that changes made by a previous user will persist on the virtual machine.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="New_Pool_and_Edit_Pool_Console_Settings_Explained">
<title>New Pool and Edit Pool Console Settings Explained</title>
<simpara>The following table details the information required on the <emphasis role="strong">Console</emphasis> tab of the <emphasis role="strong">New Pool</emphasis> or <emphasis role="strong">Edit Pool</emphasis> window that is specific to virtual machine pools. All other settings are identical to those in the <emphasis role="strong">New Virtual Machine</emphasis> and <emphasis role="strong">Edit Virtual Machine</emphasis> windows.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Console</emphasis> settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Override SPICE proxy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this check box to enable overriding the SPICE proxy defined in global configuration. This feature is useful in a case where the user (who is, for example, connecting via the VM Portal) is outside of the network where the hosts reside.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Overridden SPICE proxy address</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The proxy by which the SPICE client connects to virtual machines. This proxy overrides both the global SPICE proxy defined for the oVirt environment and the SPICE proxy defined for the cluster to which the virtual machine pool belongs, if any. The address must be in the following format:</simpara>
<screen>protocol://<emphasis>host</emphasis>:<emphasis>port</emphasis></screen></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Virtual_Machine_Pool_Host_settings_explained">
<title>Virtual Machine Pool Host Settings Explained</title>
<simpara>The following table details the options available on the <emphasis role="strong">Host</emphasis> tab of the <emphasis role="strong">New Pool</emphasis> and <emphasis role="strong">Edit Pool</emphasis> windows.</simpara>
<table xml:id="New_VMs_Host" frame="all" rowsep="1" colsep="1">
<title>Virtual Machine Pool: Host Settings</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Sub-element</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Start Running On</emphasis></simpara></entry>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara>Defines the preferred host on which the virtual machine is to run. Select either:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Any Host in Cluster</emphasis> - The virtual machine can start and run on any available host in the cluster.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Specific Host(s)</emphasis> - The virtual machine will start running on a particular host in the cluster. However, the Engine or an administrator can migrate the virtual machine to a different host in the cluster depending on the migration and high-availability settings of the virtual machine. Select the specific host or group of hosts from the list of available hosts.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migration Options</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Migration mode</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Defines options to run and migrate the virtual machine. If the options here are not used, the virtual machine will run or migrate according to its cluster&#8217;s policy.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Allow manual and automatic migration</emphasis> - The virtual machine can be automatically migrated from one host to another in accordance with the status of the environment, or manually by an administrator.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Allow manual migration only</emphasis> - The virtual machine can only be migrated from one host to another manually by an administrator.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Do not allow migration</emphasis> - The virtual machine cannot be migrated, either automatically or manually.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Use custom migration policy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Defines the migration convergence policy. If the check box is left unselected, the host determines the policy.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Legacy</emphasis> - Legacy behavior of 3.6 version. Overrides in <literal>vdsm.conf</literal> are still applied. The guest agent hook mechanism is disabled.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Minimal downtime</emphasis> - Allows the virtual machine to migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if virtual machine migration does not converge after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Suspend workload if needed</emphasis> - Allows the virtual machine to migrate in most situations, including when the virtual machine is running a heavy workload. Because of this, virtual machines may experience a more significant downtime than with some other settings. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Use custom migration downtime</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This check box allows you to specify the maximum number of milliseconds the virtual machine can be down during live migration. Configure different maximum downtimes for each virtual machine according to its workload and SLA requirements. Enter <literal>0</literal> to use the VDSM default value.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Auto Converge migrations</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Only activated with <emphasis role="strong">Legacy</emphasis> migration policy. Allows you to set whether auto-convergence is used during live migration of the virtual machine. Large virtual machines with high workloads can dirty memory more quickly than the transfer rate achieved during live migration, and prevent the migration from converging. Auto-convergence capabilities in QEMU allow you to force convergence of virtual machine migrations. QEMU automatically detects a lack of convergence and triggers a throttle-down of the vCPUs on the virtual machine. Auto-convergence is disabled globally by default.</simpara>
<itemizedlist>
<listitem>
<simpara>Select <emphasis role="strong">Inherit from cluster setting</emphasis> to use the auto-convergence setting of the cluster. This option is selected by default.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Auto Converge</emphasis> to override the cluster setting or global setting and allow auto-convergence for the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Don&#8217;t Auto Converge</emphasis> to override the cluster setting or global setting and prevent auto-convergence for the virtual machine.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable migration compression</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Only activated with <emphasis role="strong">Legacy</emphasis> migration policy. The  option allows you to set whether migration compression is used during live migration of the virtual machine. This feature uses Xor Binary Zero Run-Length-Encoding to reduce virtual machine downtime and total live migration time for virtual machines running memory write-intensive workloads or for any application with a sparse memory update pattern. Migration compression is disabled globally by default.</simpara>
<itemizedlist>
<listitem>
<simpara>Select <emphasis role="strong">Inherit from cluster setting</emphasis> to use the compression setting of the cluster. This option is selected by default.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Compress</emphasis> to override the cluster setting or global setting and allow compression for the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Don&#8217;t compress</emphasis> to override the cluster setting or global setting and prevent compression for the virtual machine.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Pass-Through Host CPU</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This check box allows virtual machines to take advantage of the features of the physical CPU of the host on which they are situated.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Configure NUMA</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">NUMA Node Count</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The number of virtual NUMA nodes available in a host that can be assigned to the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">NUMA Pinning</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Opens the <emphasis role="strong">NUMA Topology</emphasis> window. This window shows the host&#8217;s total CPUs, memory, and NUMA nodes, and the virtual machine&#8217;s virtual NUMA nodes. You can manually pin virtual NUMA nodes to host NUMA nodes by clicking and dragging each vNUMA from the box on the right to a NUMA node on the left.</simpara><simpara>You can also set <emphasis role="strong">Tune Mode</emphasis> for memory allocation:</simpara><simpara><emphasis role="strong">Strict</emphasis> - Memory allocation will fail if the memory cannot be allocated on the target node.</simpara><simpara><emphasis role="strong">Preferred</emphasis> - Memory is allocated from a single preferred node. If sufficient memory is not available, memory can be allocated from other nodes.</simpara><simpara><emphasis role="strong">Interleave</emphasis> - Memory is allocated across nodes in a round-robin algorithm.</simpara><simpara>If you define NUMA pinning, <emphasis role="strong">Migration Options</emphasis> is set to <emphasis role="strong">Allow manual migration only</emphasis>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="New_Pool_Resource_Settings_Explained">
<title>New Pool and Edit Pool Resource Allocation Settings Explained</title>
<simpara>The following table details the information required on the <emphasis role="strong">Resource Allocation</emphasis> tab of the <emphasis role="strong">New Pool</emphasis> and <emphasis role="strong">Edit Pool</emphasis> windows that are specific to virtual machine pools. All other settings are identical to those in the <emphasis role="strong">New Virtual Machine</emphasis> window. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_Resource_Allocation_settings_explained">Virtual Machine Resource Allocation Settings Explained</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for more information.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title><emphasis role="strong">Resource Allocation</emphasis> settings</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Sub-element</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Disk Allocation</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Auto select target</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Select this check box to automatically select the storage domain that has the most free space. The <emphasis role="strong">Target</emphasis> and <emphasis role="strong">Disk Profile</emphasis> fields are disabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">Format</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field is read-only and always displays <emphasis role="strong">QCOW2</emphasis>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="Editing_a_Virtual_Machine_Pool">
<title>Editing a Virtual Machine Pool</title>
<simpara>After a virtual machine pool has been created, its properties can be edited. The properties available when editing a virtual machine pool are identical to those available when creating a new virtual machine pool except that the <emphasis role="strong">Number of VMs</emphasis> property is replaced by <emphasis role="strong">Increase number of VMs in pool by</emphasis>.</simpara>
<note>
<simpara>When editing a virtual machine pool, the changes introduced affect only new virtual machines. Virtual machines that existed already at the time of the introduced changes remain unaffected.</simpara>
</note>
<simpara><emphasis role="strong">Editing a Virtual Machine Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice> and select a virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the properties of the virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Ok</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Prestarting_Virtual_Machines_in_a_Pool">
<title>Prestarting Virtual Machines in a Pool</title>
<simpara>The virtual machines in a virtual machine pool are powered down by default. When a user requests a virtual machine from a pool, a machine is powered up and assigned to the user. In contrast, a prestarted virtual machine is already running and waiting to be assigned to a user, decreasing the amount of time a user has to wait before being able to access a machine. When a prestarted virtual machine is shut down it is returned to the pool and restored to its original state. The maximum number of prestarted virtual machines is the number of virtual machines in the pool.</simpara>
<simpara>Prestarted virtual machines are suitable for environments in which users require immediate access to virtual machines which are not specifically assigned to them. Only automatic pools can have prestarted virtual machines.</simpara>
<simpara><emphasis role="strong">Prestarting Virtual Machines in a Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice> and select the virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the number of virtual machines to be prestarted in the <emphasis role="strong">Prestarted VMs</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Type</emphasis> tab. Ensure <emphasis role="strong">Pool Type</emphasis> is set to <emphasis role="strong">Automatic</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Adding_Virtual_Machines_to_a_VM_Pool">
<title>Adding Virtual Machines to a Virtual Machine Pool</title>
<simpara>If you require more virtual machines than originally provisioned in a virtual machine pool, add more machines to the pool.</simpara>
<simpara><emphasis role="strong">Adding Virtual Machines to a Virtual Machine Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice> and select the virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the number of additional virtual machines in the <emphasis role="strong">Increase number of VMs in pool by</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Detaching_Virtual_Machines_from_a_VM_Pool">
<title>Detaching Virtual Machines from a Virtual Machine Pool</title>
<simpara>You can detach virtual machines from a virtual machine pool. Detaching a virtual machine removes it from the pool to become an independent virtual machine.</simpara>
<simpara><emphasis role="strong">Detaching Virtual Machines from a Virtual Machine Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the pool&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Virtual Machines</emphasis> tab to list the virtual machines in the pool.</simpara>
</listitem>
<listitem>
<simpara>Ensure the virtual machine has a status of <literal>Down</literal>; you cannot detach a running virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Select one or more virtual machines and click <emphasis role="strong">Detach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>The virtual machine still exists in the environment and can be viewed and accessed from <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>. Note that the icon changes to denote that the detached virtual machine is an independent virtual machine.</simpara>
</note>
</section>
<section xml:id="Removing_a_Virtual_Machine_Pool">
<title>Removing a Virtual Machine Pool</title>
<simpara>You can remove a virtual machine pool from a data center. You must first either delete or detach all of the virtual machines in the pool. Detaching virtual machines from the pool will preserve them as independent virtual machines.</simpara>
<simpara><emphasis role="strong">Removing a Virtual Machine Pool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Pools</guimenuitem></menuchoice> and select the virtual machine pool.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
<chapter xml:id="chap-Virtual_Machine_Disks">
<title>Virtual Disks</title>
<section xml:id="Understanding_virtual_machine_storage">
<title>Understanding Virtual Machine Storage</title>
<simpara>oVirt supports three storage types: NFS, iSCSI and FCP.</simpara>
<simpara>In each type, a host known as the Storage Pool Manager (SPM) manages access between hosts and storage. The SPM host is the only node that has full access within the storage pool; the SPM can modify the storage domain metadata, and the pool&#8217;s metadata. All other hosts can only access virtual machine hard disk image data.</simpara>
<simpara>By default in an NFS, local, or POSIX compliant data center, the SPM creates the virtual disk using a thin provisioned format as a file in a file system.</simpara>
<simpara>In iSCSI and other block-based data centers, the SPM creates a volume group on top of the Logical Unit Numbers (LUNs) provided, and makes logical volumes to use as virtual disks. Virtual disks on block-based storage are preallocated by default.</simpara>
<simpara>If the virtual disk is preallocated, a logical volume of the specified size in GB is created. The virtual machine can be mounted on a Enterprise Linux server using <literal>kpartx</literal>, <literal>vgscan</literal>, <literal>vgchange</literal> or <literal>mount</literal> to investigate the virtual machine&#8217;s processes or problems.</simpara>
<simpara>If the virtual disk is thinly provisioned, a 1 GB logical volume is created. The logical volume is continuously monitored by the host on which the virtual machine is running. As soon as the usage nears a threshold the host notifies the SPM, and the SPM extends the logical volume by 1 GB. The host is responsible for resuming the virtual machine after the logical volume has been extended. If the virtual machine goes into a paused state it means that the SPM could not extend the disk in time. This occurs if the SPM is too busy or if there is not enough storage space.</simpara>
<simpara>A virtual disk with a preallocated (raw) format has significantly faster write speeds than a virtual disk with a thin provisioning (QCOW2) format. Thin provisioning takes significantly less time to create a virtual disk. The thin provision format is suitable for non-I/O intensive virtual machines. The preallocated format is recommended for virtual machines with high I/O writes. If a virtual machine is able to write more than 1 GB every four seconds, use preallocated disks where possible.</simpara>
</section>
<section xml:id="Understanding_virtual_disks">
<title>Understanding Virtual Disks</title>
<simpara>oVirt features <emphasis role="strong">Preallocated</emphasis> (thick provisioned) and <emphasis role="strong">Sparse</emphasis> (thin provisioned) storage options.</simpara>
<itemizedlist>
<listitem>
<simpara>Preallocated</simpara>
<simpara>A preallocated virtual disk allocates all the storage required for a virtual machine up front. For example, a 20 GB preallocated logical volume created for the data partition of a virtual machine will take up 20 GB of storage space immediately upon creation.</simpara>
</listitem>
<listitem>
<simpara>Sparse</simpara>
<simpara>A sparse allocation allows an administrator to define the total storage to be assigned to the virtual machine, but the storage is only allocated when required.</simpara>
<simpara>For example, a 20 GB thin provisioned logical volume would take up 0 GB of storage space when first created. When the operating system is installed it may take up the size of the installed file, and would continue to grow as data is added up to a maximum of 20 GB size.</simpara>
</listitem>
</itemizedlist>
<simpara>You can view a virtual disk&#8217;s <emphasis role="strong">ID</emphasis> in <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice>. The <emphasis role="strong">ID</emphasis> is used to identify a virtual disk because its device name (for example, <emphasis role="strong">/dev/vda0</emphasis>) can change, causing disk corruption. You can also view a virtual disk&#8217;s ID in <emphasis role="strong">/dev/disk/by-id</emphasis>.</simpara>
<simpara>You can view the <emphasis role="strong">Virtual Size</emphasis> of a disk in <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice> and in the <emphasis role="strong">Disks</emphasis> tab of the details view for storage domains, virtual machines, and templates. The <emphasis role="strong">Virtual Size</emphasis> is the total amount of disk space that the virtual machine can use. It is the number that you enter in the <emphasis role="strong">Size(GB)</emphasis> field when you create or edit a virtual disk.</simpara>
<simpara>You can view the <emphasis role="strong">Actual Size</emphasis> of a disk in the <emphasis role="strong">Disks</emphasis> tab of the details view for storage domains and templates. This is the amount of disk space that has been allocated to the virtual machine so far. Preallocated disks show the same value for <emphasis role="strong">Virtual Size</emphasis> and <emphasis role="strong">Actual Size</emphasis>. Sparse disks may show different values, depending on how much disk space has been allocated.</simpara>
<simpara>The possible combinations of storage types and formats are described in the following table.</simpara>
<table xml:id="vdisk-combos" frame="all" rowsep="1" colsep="1">
<title>Permitted Storage Combinations</title>
<tgroup cols="4">
<colspec colname="col_1" colwidth="25*"/>
<colspec colname="col_2" colwidth="25*"/>
<colspec colname="col_3" colwidth="25*"/>
<colspec colname="col_4" colwidth="25*"/>
<thead>
<row>
<entry align="left" valign="top">Storage</entry>
<entry align="left" valign="top">Format</entry>
<entry align="left" valign="top">Type</entry>
<entry align="left" valign="top">Note</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>NFS</simpara></entry>
<entry align="left" valign="top"><simpara>Raw</simpara></entry>
<entry align="left" valign="top"><simpara>Preallocated</simpara></entry>
<entry align="left" valign="top"><simpara>A file with an initial size that equals the amount of storage defined for the virtual disk, and has no formatting.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NFS</simpara></entry>
<entry align="left" valign="top"><simpara>Raw</simpara></entry>
<entry align="left" valign="top"><simpara>Sparse</simpara></entry>
<entry align="left" valign="top"><simpara>A file with an initial size that is close to zero, and has no formatting.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NFS</simpara></entry>
<entry align="left" valign="top"><simpara>QCOW2</simpara></entry>
<entry align="left" valign="top"><simpara>Sparse</simpara></entry>
<entry align="left" valign="top"><simpara>A file with an initial size that is close to zero, and has QCOW2 formatting. Subsequent layers will be QCOW2 formatted.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SAN</simpara></entry>
<entry align="left" valign="top"><simpara>Raw</simpara></entry>
<entry align="left" valign="top"><simpara>Preallocated</simpara></entry>
<entry align="left" valign="top"><simpara>A block device with an initial size that equals the amount of storage defined for the virtual disk, and has no formatting.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SAN</simpara></entry>
<entry align="left" valign="top"><simpara>QCOW2</simpara></entry>
<entry align="left" valign="top"><simpara>Sparse</simpara></entry>
<entry align="left" valign="top"><simpara>A block device with an initial size that is much smaller than the size defined for the virtual disk (currently 1 GB), and has QCOW2 formatting for which space is allocated as needed (currently in 1 GB increments).</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Settings_to_Wipe_Virtual_Disks_After_Deletion">
<title>Settings to Wipe Virtual Disks After Deletion</title>
<simpara>The <literal>wipe_after_delete</literal> flag, viewed in the Administration Portal as the <emphasis role="strong">Wipe After Delete</emphasis> check box will replace used data with zeros when a virtual disk is deleted. If it is set to false, which is the default, deleting the disk will open up those blocks for reuse but will not wipe the data. It is, therefore, possible for this data to be recovered because the blocks have not been returned to zero.</simpara>
<simpara>The <literal>wipe_after_delete</literal> flag only works on block storage. On file storage, for example NFS, the option does nothing because the file system will ensure that no data exists.</simpara>
<simpara>Enabling <literal>wipe_after_delete</literal> for virtual disks is more secure, and is recommended if the virtual disk has contained any sensitive data. This is a more intensive operation and users may experience degradation in performance and prolonged delete times.</simpara>
<note>
<simpara>The wipe after delete functionality is not the same as secure delete, and cannot guarantee that the data is removed from the storage, just that new disks created on same storage will not expose data from old disks.</simpara>
</note>
<simpara>The <literal>wipe_after_delete</literal> flag default can be changed to <literal>true</literal> during the setup process (see <link xl:href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</link>), or by using the <literal>engine-config</literal> tool on the oVirt Engine. Restart the <literal>ovirt-engine</literal> service for the setting change to take effect.</simpara>
<note>
<simpara>Changing the <literal>wipe_after_delete</literal> flag&#8217;s default setting will not affect the <emphasis role="strong">Wipe After Delete</emphasis> property of disks that already exist.</simpara>
</note>
<simpara><emphasis role="strong">Setting SANWipeAfterDelete to Default to True Using the Engine Configuration Tool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run the <literal>engine-config</literal> tool with the <literal>--set</literal> action:</simpara>
<screen># engine-config --set SANWipeAfterDelete=true</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service for the change to take effect:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
<simpara>The <emphasis role="strong">/var/log/vdsm/vdsm.log</emphasis> file located on the host can be checked to confirm that a virtual disk was successfully wiped and deleted.</simpara>
<simpara>For a successful wipe, the log file will contain the entry, <literal><emphasis>storage_domain_id</emphasis>/<emphasis>volume_id</emphasis> was zeroed and will be deleted</literal>. For example:</simpara>
<screen>a9cb0625-d5dc-49ab-8ad1-72722e82b0bf/a49351a7-15d8-4932-8d67-512a369f9d61 was zeroed and will be deleted</screen>
<simpara>For a successful deletion, the log file will contain the entry, <literal>finished with VG:<emphasis>storage_domain_id</emphasis> LVs: <emphasis>list_of_volume_ids</emphasis>, img: <emphasis>image_id</emphasis></literal>. For example:</simpara>
<screen>finished with VG:a9cb0625-d5dc-49ab-8ad1-72722e82b0bf LVs: {'a49351a7-15d8-4932-8d67-512a369f9d61': ImgsPar(imgs=['11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d'], parent='00000000-0000-0000-0000-000000000000')}, img: 11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d</screen>
<simpara>An unsuccessful wipe will display a log message <literal>zeroing <emphasis>storage_domain_id</emphasis>/<emphasis>volume_id</emphasis> failed. Zero and remove this volume manually</literal>, and an unsuccessful delete will display <literal>Remove failed for some of VG: <emphasis>storage_domain_id</emphasis> zeroed volumes: <emphasis>list_of_volume_ids</emphasis></literal>.</simpara>
</section>
<section xml:id="Shareable_Disks">
<title>Shareable Disks in oVirt</title>
<simpara>Some applications require storage to be shared between servers. oVirt allows you to mark virtual machine hard disks as <emphasis role="strong">Shareable</emphasis> and attach those disks to virtual machines. That way a single virtual disk can be used by multiple cluster-aware guests.</simpara>
<simpara>Shared disks are not to be used in every situation. For applications like clustered database servers, and other highly available services, shared disks are appropriate. Attaching a shared disk to multiple guests that are not cluster-aware is likely to cause data corruption because their reads and writes to the disk are not coordinated.</simpara>
<simpara>You cannot take a snapshot of a shared disk. Virtual disks that have snapshots taken of them cannot later be marked shareable.</simpara>
<simpara>You can mark a disk shareable either when you create it, or by editing the disk later.</simpara>
</section>
<section xml:id="Read_Only_Disks_in_Red_Hat_Enterprise_Virtualization">
<title>Read Only Disks in oVirt</title>
<simpara>Some applications require administrators to share data with read-only rights. You can do this when creating or editing a disk attached to a virtual machine via the <emphasis role="strong">Disks</emphasis> tab in the details view of the virtual machine and selecting the <emphasis role="strong">Read Only</emphasis> check box. That way, a single disk can be read by multiple cluster-aware guests, while an administrator maintains writing privileges.</simpara>
<simpara>You cannot change the read-only status of a disk while the virtual machine is running.</simpara>
<important>
<simpara>Mounting a journaled file system requires read-write access. Using the <emphasis role="strong">Read Only</emphasis> option is not appropriate for virtual disks that contain such file systems (e.g. <emphasis role="strong">EXT3</emphasis>, <emphasis role="strong">EXT4</emphasis>, or <emphasis role="strong">XFS</emphasis>).</simpara>
</important>
</section>
<section xml:id="sect-Virtual_Disk_Tasks">
<title>Virtual Disk Tasks</title>
<section xml:id="Creating_a_Virtual_Disk">
<title>Creating a Virtual Disk</title>
<simpara><emphasis role="strong">Image</emphasis> disk creation is managed entirely by the Engine. <emphasis role="strong">Direct LUN</emphasis> disks require externally prepared targets that already exist.</simpara>
<simpara>You can create a virtual disk that is attached to a specific virtual machine. Additional options are available when creating an attached virtual disk, as specified in <xref linkend="Explanation_of_Settings_in_the_New_Virtual_Disk_Window"/>.</simpara>
<simpara><emphasis role="strong">Creating a Virtual Disk Attached to a Virtual Machine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the virtual machine&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the appropriate button to specify whether the virtual disk will be an <emphasis role="strong">Image</emphasis> or <emphasis role="strong">Direct LUN</emphasis> disk.</simpara>
</listitem>
<listitem>
<simpara>Select the options required for your virtual disk. The options change based on the disk type selected. See <xref linkend="Explanation_of_Settings_in_the_New_Virtual_Disk_Window"/> for more details on each option for each disk type.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You can also create a floating virtual disk that does not belong to any virtual machines. You can attach this disk to a single virtual machine, or to multiple virtual machines if the disk is shareable. Some options are not available when creating a virtual disk, as specified in <xref linkend="Explanation_of_Settings_in_the_New_Virtual_Disk_Window"/>.</simpara>
<simpara><emphasis role="strong">Creating a Floating Virtual Disk</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the appropriate button to specify whether the virtual disk will be an <emphasis role="strong">Image</emphasis> or <emphasis role="strong">Direct LUN</emphasis> disk.</simpara>
</listitem>
<listitem>
<simpara>Select the options required for your virtual disk. The options change based on the disk type selected. See <xref linkend="Explanation_of_Settings_in_the_New_Virtual_Disk_Window"/> for more details on each option for each disk type.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Explanation_of_Settings_in_the_New_Virtual_Disk_Window">
<title>Explanation of settings in the New Virtual Disk window</title>
<simpara>Because the New Virtual Disk windows for creating floating and attached virtual disks are very similar, their settings are described in a single section.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>New Virtual Disk and Edit Virtual Disk settings: <emphasis role="strong">Image</emphasis></title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Size(GB)</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The size of the new virtual disk in GB.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Alias</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the virtual disk, limited to 40 characters.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A description of the virtual disk. This field is recommended but not mandatory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Interface</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>The virtual interface the disk presents to virtual machines. <emphasis role="strong">VirtIO</emphasis> is faster, but requires drivers. Enterprise Linux 5 and later include these drivers. Windows does not include these drivers, but you can install them from the virtio-win ISO image. IDE and SATA devices do not require special drivers.</simpara><simpara>The interface type can be updated after stopping all virtual machines that the disk is attached to.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Data Center</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating a floating disk.</simpara><simpara>The data center in which the virtual disk will be available.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Storage Domain</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The storage domain in which the virtual disk will be stored. The drop-down list shows all storage domains available in the given data center, and also shows the total space and currently available space in the storage domain.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Allocation Policy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The provisioning policy for the new virtual disk.</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Preallocated</emphasis> allocates the entire size of the disk on the storage domain at the time the virtual disk is created. The virtual size and the actual size of a preallocated disk are the same. Preallocated virtual disks take more time to create than thin provisioned virtual disks, but have better read and write performance. Preallocated virtual disks are recommended for servers and other I/O intensive virtual machines. If a virtual machine is able to write more than 1 GB every four seconds, use preallocated disks where possible.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Thin Provision</emphasis> allocates 1 GB at the time the virtual disk is created and sets a maximum limit on the size to which the disk can grow. The virtual size of the disk is the maximum limit; the actual size of the disk is the space that has been allocated so far. Thin provisioned disks are faster to create than preallocated disks and allow for storage over-commitment. Thin provisioned virtual disks are recommended for desktops.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Disk Profile</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The disk profile assigned to the virtual disk. Disk profiles define the maximum amount of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Disk profiles are defined on the storage domain level based on storage quality of service entries created for data centers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Activate Disk(s)</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Activate the virtual disk immediately after creation.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Wipe After Delete</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to enable enhanced security for deletion of sensitive material when the virtual disk is deleted.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Bootable</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to enable the bootable flag on the virtual disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Shareable</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to attach the virtual disk to more than one virtual machine at a time.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Read-Only</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Incremental Backup</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Enables incremental backup on the virtual disk. Incremental backup requires disks to be formatted in QCOW2 format instead of RAW format. See <xref linkend="assembly_incremental-backup-and-restore_RHV_backup_restore"/>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Discard</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to shrink a thin provisioned disk while the virtual machine is up. For block storage, the underlying storage device must support discard calls, and the option cannot be used with <emphasis role="strong">Wipe After Delete</emphasis> unless the underlying storage supports the discard_zeroes_data property. For file storage, the underlying file system and the block device must support discard calls. If all requirements are met, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The <emphasis role="strong">Direct LUN</emphasis> settings can be displayed in either <emphasis role="strong">Targets &gt; LUNs</emphasis> or <emphasis role="strong">LUNs &gt; Targets</emphasis>. <emphasis role="strong">Targets &gt; LUNs</emphasis> sorts available LUNs according to the host on which they are discovered, whereas <emphasis role="strong">LUNs &gt; Targets</emphasis> displays a single list of LUNs.</simpara>
<simpara>Fill in the fields in the <emphasis role="strong">Discover Targets</emphasis> section and click <emphasis role="strong">Discover</emphasis> to discover the target server. You can then click the <emphasis role="strong">Login All</emphasis> button to list the available LUNs on the target server and, using the radio buttons next to each LUN, select the LUN to add.</simpara>
<simpara>Using LUNs directly as virtual machine hard disk images removes a layer of abstraction between your virtual machines and their data.</simpara>
<simpara>The following considerations must be made when using a direct LUN as a virtual machine hard disk image:</simpara>
<itemizedlist>
<listitem>
<simpara>Live storage migration of direct LUN hard disk images is not supported.</simpara>
</listitem>
<listitem>
<simpara>Direct LUN disks are not included in virtual machine exports.</simpara>
</listitem>
<listitem>
<simpara>Direct LUN disks are not included in virtual machine snapshots.</simpara>
</listitem>
</itemizedlist>
<table frame="all" rowsep="1" colsep="1">
<title>New Virtual Disk and Edit Virtual Disk settings: <emphasis role="strong">Direct LUN</emphasis></title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Field Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Alias</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The name of the virtual disk, limited to 40 characters.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A description of the virtual disk. This field is recommended but not mandatory. By default the last 4 characters of the LUN ID is inserted into the field.</simpara><simpara>The default behavior can be configured by setting the <literal>PopulateDirectLUNDiskDescriptionWithLUNId</literal> configuration key to the appropriate value using the <literal>engine-config</literal> command.  The configuration key can be set to <literal>-1</literal> for the full LUN ID to be used, or <literal>0</literal> for this feature to be ignored. A positive integer populates the description with the corresponding number of characters of the LUN ID.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Interface</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>The virtual interface the disk presents to virtual machines. <emphasis role="strong">VirtIO</emphasis> is faster, but requires drivers. Enterprise Linux 5 and later include these drivers. Windows does not include these drivers, but they can be installed from the virtio-win ISO . IDE and SATA devices do not require special drivers.</simpara><simpara>The interface type can be updated after stopping all virtual machines that the disk is attached to.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Data Center</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating a floating disk.</simpara><simpara>The data center in which the virtual disk will be available.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Host</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The host on which the LUN will be mounted. You can select any host in the data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Storage Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The type of external LUN to add. You can select from either <emphasis role="strong">iSCSI</emphasis> or <emphasis role="strong">Fibre Channel</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Discover Targets</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This section can be expanded when you are using iSCSI external LUNs and <emphasis role="strong">Targets &gt; LUNs</emphasis> is selected.</simpara>
<simpara><emphasis role="strong">Address</emphasis> - The host name or IP address of the target server.</simpara>
<simpara><emphasis role="strong">Port</emphasis> - The port by which to attempt a connection to the target server. The default port is 3260.</simpara>
<simpara><emphasis role="strong">User Authentication</emphasis> - The iSCSI server requires User Authentication. The <emphasis role="strong">User Authentication</emphasis> field is visible when you are using iSCSI external LUNs.</simpara>
<simpara><emphasis role="strong">CHAP user name</emphasis> - The user name of a user with permission to log in to LUNs. This field is accessible when the <emphasis role="strong">User Authentication</emphasis> check box is selected.</simpara>
<simpara><emphasis role="strong">CHAP password</emphasis> - The password of a user with permission to log in to LUNs. This field is accessible when the <emphasis role="strong">User Authentication</emphasis> check box is selected.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Activate Disk(s)</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Activate the virtual disk immediately after creation.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Bootable</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to enable the bootable flag on the virtual disk.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Shareable</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to attach the virtual disk to more than one virtual machine at a time.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Read-Only</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable Discard</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Allows you to shrink a thin provisioned disk while the virtual machine is up. With this option enabled, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Enable SCSI Pass-Through</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Available when the <emphasis role="strong">Interface</emphasis> is set to <emphasis role="strong">VirtIO-SCSI</emphasis>. Selecting this check box enables passthrough of a physical SCSI device to the virtual disk. A VirtIO-SCSI interface with SCSI passthrough enabled automatically includes SCSI discard support. <emphasis role="strong">Read-Only</emphasis> is not supported when this check box is selected.</simpara><simpara>When this check box is not selected, the virtual disk uses an emulated SCSI device. <emphasis role="strong">Read-Only</emphasis> is supported on emulated VirtIO-SCSI disks.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Allow Privileged SCSI I/O</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Available when the <emphasis role="strong">Enable SCSI Pass-Through</emphasis> check box is selected. Selecting this check box enables unfiltered SCSI Generic I/O (SG_IO) access, allowing privileged SG_IO commands on the disk. This is required for persistent reservations.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Using SCSI Reservation</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>This field only appears when creating an attached disk.</simpara><simpara>Available when the <emphasis role="strong">Enable SCSI Pass-Through</emphasis> and <emphasis role="strong">Allow Privileged SCSI I/O</emphasis> check boxes are selected. Selecting this check box disables migration for any virtual machine using this disk, to prevent virtual machines that are using SCSI reservation from losing access to the disk.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<important>
<simpara>Mounting a journaled file system requires read-write access. Using the <emphasis role="strong">Read-Only</emphasis> option is not appropriate for virtual disks that contain such file systems (e.g. <emphasis role="strong">EXT3</emphasis>, <emphasis role="strong">EXT4</emphasis>, or <emphasis role="strong">XFS</emphasis>).</simpara>
</important>
</section>
<section xml:id="Overview_of_Live_Storage_Migration">
<title>Overview of Live Storage Migration</title>
<simpara>Virtual disks can be migrated from one storage domain to another while the virtual machine to which they are attached is running. This is referred to as live storage migration. When a disk attached to a running virtual machine is migrated, a snapshot of that disk&#8217;s image chain is created in the source storage domain, and the entire image chain is replicated in the destination storage domain. As such, ensure that you have sufficient storage space in both the source storage domain and the destination storage domain to host both the disk image chain and the snapshot. A new snapshot is created on each live storage migration attempt, even when the migration fails.</simpara>
<simpara>Consider the following when using live storage migration:</simpara>
<itemizedlist>
<listitem>
<simpara>You can live migrate multiple disks at one time.</simpara>
</listitem>
<listitem>
<simpara>Multiple disks for the same virtual machine can reside across more than one storage domain, but the image chain for each disk must reside on a single storage domain.</simpara>
</listitem>
<listitem>
<simpara>You can live migrate disks between any two storage domains in the same data center.</simpara>
</listitem>
<listitem>
<simpara>You cannot live migrate direct LUN hard disk images or disks marked as shareable.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Moving_a_Virtual_Disk">
<title>Moving a Virtual Disk</title>
<simpara>Move a virtual disk that is attached to a virtual machine or acts as a floating virtual disk from one storage domain to another. You can move a virtual disk that is attached to a running virtual machine; this is referred to as live storage migration. Alternatively, shut down the virtual machine before continuing.</simpara>
<simpara>Consider the following when moving a disk:</simpara>
<itemizedlist>
<listitem>
<simpara>You can move multiple disks at the same time.</simpara>
</listitem>
<listitem>
<simpara>You can move disks between any two storage domains in the same data center.</simpara>
</listitem>
<listitem>
<simpara>If the virtual disk is attached to a virtual machine that was created based on a template and used the thin provisioning storage allocation option, you must copy the disks for the template on which the virtual machine was based to the same storage domain as the virtual disk.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Moving a Virtual Disk</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice> and select one or more virtual disks to move.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Move</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Target</emphasis> list, select the storage domain to which the virtual disk(s) will be moved.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Disk Profile</emphasis> list, select a profile for the disk(s), if applicable.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The virtual disks are moved to the target storage domain. During the move procedure, the <emphasis role="strong">Status</emphasis> column displays <literal>Locked</literal> and a progress bar indicating the progress of the move operation.</simpara>
</section>
<section xml:id="Changing_the_Disk_Interface_Type">
<title>Changing the Disk Interface Type</title>
<simpara>Users can change a disk&#8217;s interface type after the disk has been created. This enables you to attach an existing disk to a virtual machine that requires a different interface type. For example, a disk using the <literal>VirtIO</literal> interface can be attached to a virtual machine requiring the <literal>VirtIO-SCSI</literal> or <literal>IDE</literal> interface. This provides flexibility to migrate disks for the purpose of backup and restore, or disaster recovery. The disk interface for shareable disks can also be updated per virtual machine. This means that each virtual machine that uses the shared disk can use a different interface type.</simpara>
<simpara>To update a disk interface type, all virtual machines using the disk must first be stopped.</simpara>
<simpara><emphasis role="strong">Changing a Disk Interface Type</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> and stop the appropriate virtual machine(s).</simpara>
</listitem>
<listitem>
<simpara>Click the virtual machine&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab and select the disk.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Interface</emphasis> list, select the new interface type and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>You can attach a disk to a different virtual machine that requires a different interface type.</simpara>
<simpara><emphasis role="strong">Attaching a Disk to a Different Virtual Machine using a Different Interface Type</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> and stop the appropriate virtual machine(s).</simpara>
</listitem>
<listitem>
<simpara>Click the virtual machine&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab and select the disk.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Go back to <emphasis role="strong">Virtual Machines</emphasis> and click the name of the new virtual machine that the disk will be attached to.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab, then click <emphasis role="strong">Attach</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the disk in the <emphasis role="strong">Attach Virtual Disks</emphasis> window and select the appropriate interface from the <emphasis role="strong">Interface</emphasis> drop-down.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Copying_a_Virtual_Disk">
<title>Copying a Virtual Disk</title>
<simpara>You can copy a virtual disk from one storage domain to another. The copied disk can be attached to virtual machines.</simpara>
<simpara><emphasis role="strong">Copying a Virtual Disk</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice> and select the virtual disk(s).</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Copy</emphasis> .</simpara>
</listitem>
<listitem>
<simpara>Optionally, enter a new name in the <emphasis role="strong">Alias</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Target</emphasis> list, select the storage domain to which the virtual disk(s) will be copied.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Disk Profile</emphasis> list, select a profile for the disk(s), if applicable.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The virtual disks have a status of <literal>Locked</literal> while being copied.</simpara>
</section>
<section xml:id="proc_improving_disk_performance">
<title>Improving disk performance</title>
<simpara>In the Administration Portal, on the virtual machine&#8217;s <emphasis role="strong">Resource Allocation</emphasis> tab, the default <emphasis role="strong">I/O Threads Enabled</emphasis> setting is checked (enabled), and the number of threads is <literal>1</literal>.</simpara>
<simpara>Suppose a virtual machine has multiple disks that have VirtIO controllers, and its workloads make significant use of those controllers. In that case, you can improve performance by increasing the number of I/O threads.</simpara>
<simpara>However, also consider that increasing the number of I/O threads decreases the virtual machine&#8217;s pool of threads. If your workloads do not use the VirtIO controllers and the threads you allocate to them, increasing the number of I/O threads might decrease overall performance.</simpara>
<simpara>To find the optimal number of threads, benchmark the performance of your virtual machine running workloads before and after you adjust the number of threads.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>, <emphasis role="strong">Power Off</emphasis> the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Click the name of the virtual machine.</simpara>
</listitem>
<listitem>
<simpara>In the details pane, click the <emphasis role="strong">Vm Devices</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Count the number of controllers whose <emphasis role="strong">Type</emphasis> is <literal>virtio</literal> or <literal>virtio-scsi</literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Edit</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Edit Virtual Machine</emphasis> window, click the <emphasis role="strong">Resource Allocation</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Confirm that <emphasis role="strong">I/O Threads Enabled</emphasis> is checked (enabled).</simpara>
</listitem>
<listitem>
<simpara>To the right of <emphasis role="strong">I/O Threads Enabled</emphasis>, increase the number of threads, but do not exceed number of controllers whose type is <literal>virtio</literal> or <literal>virtio-scsi</literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>In the details pane, click the <emphasis role="strong">Disks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>For each disk, use <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>) to <emphasis role="strong">Deactivate</emphasis> and <emphasis role="strong">Activate</emphasis> the disk. This action remaps the disks to the controllers.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Run</guibutton> to start the virtual machine.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Verification steps</title>
<listitem>
<simpara>To see which controllers have an I/O thread, click <emphasis role="strong">Vm Devices</emphasis> in the details pane and look for <literal>ioThreadid=</literal> in the <emphasis role="strong">Spec Params</emphasis> column.</simpara>
</listitem>
<listitem>
<simpara>To see the mapping of disks to controllers, log into the host machine and enter the following command:</simpara>
<screen># virsh -r dumpxml virtual_machine_name</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_Resource_Allocation_settings_explained">Virtual Machine Resource Allocation Settings Explained</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_uploading_images_to_a_data_storage_domain">
<title>Uploading Images to a Data Storage Domain</title>
<simpara>You can upload virtual disk images and ISO images to your data storage domain in the Administration Portal or with the REST API. See <xref linkend="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks"/>.</simpara>
</section>
<section xml:id="Importing_a_Disk_Image_from_an_Imported_Storage_Domain">
<title>Importing a Disk Image from an Imported Storage Domain</title>
<simpara>Import floating virtual disks from an imported storage domain.</simpara>
<note>
<simpara>Only QEMU-compatible disks can be imported into the Engine.</simpara>
</note>
<simpara><emphasis role="strong">Importing a Disk Image</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the name of an imported storage domain. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disk Import</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select one or more disks and click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate <emphasis role="strong">Disk Profile</emphasis> for each disk.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Importing_an_Unregistered_Disk_Image_from_an_Imported_Storage_Domain">
<title>Importing an Unregistered Disk Image from an Imported Storage Domain</title>
<simpara>Import floating virtual disks from a storage domain. Floating disks created outside of a oVirt environment are not registered with the Engine. Scan the storage domain to identify unregistered floating disks to be imported.</simpara>
<note>
<simpara>Only QEMU-compatible disks can be imported into the Engine.</simpara>
</note>
<simpara><emphasis role="strong">Importing a Disk Image</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Scan Disks</emphasis> so that the Engine can identify unregistered disks.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disk Import</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select one or more disk images and click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate <emphasis role="strong">Disk Profile</emphasis> for each disk.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Importing_a_Disk_Image_from_an_OpenStack_Image_Service">
<title>Importing a Virtual Disk from an OpenStack Image Service</title>
<simpara>Virtual disks managed by an OpenStack Image Service can be imported into the oVirt Engine if that OpenStack Image Service has been added to the Engine as an external provider.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the OpenStack Image Service domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Images</emphasis> tab and select an image.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> into which the image will be imported.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Domain Name</emphasis> drop-down list, select the storage domain in which the image will be stored.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select a quota to apply to the image from the <emphasis role="strong">Quota</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The disk can now be attached to a virtual machine.</simpara>
</section>
<section xml:id="Exporting_a_Virtual_Disk_to_an_OpenStack_Image_Service">
<title>Exporting a Virtual Disk to an OpenStack Image Service</title>
<simpara>Virtual disks can be exported to an OpenStack Image Service that has been added to the Engine as an external provider.</simpara>
<important>
<simpara>Virtual disks can only be exported if they do not have multiple volumes, are not thin provisioned, and do not have any snapshots.</simpara>
</important>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Disks</guimenuitem></menuchoice> and select the disks to export.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Export</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Domain Name</emphasis> drop-down list, select the OpenStack Image Service to which the disks will be exported.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Quota</emphasis> drop-down list, select a quota for the disks if a quota is to be applied.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Reclaiming_virtual_disk_space">
<title>Reclaiming Virtual Disk Space</title>
<simpara>Virtual disks that use thin provisioning do not automatically shrink after deleting files from them. For example, if the actual disk size is 100GB and you delete 50GB of files, the allocated disk size remains at 100GB, and the remaining 50GB is not returned to the host, and therefore cannot be used by other virtual machines. This unused disk space can be reclaimed by the host by performing a sparsify operation on the virtual machine&#8217;s disks. This transfers the free space from the disk image to the host. You can sparsify multiple virtual disks in parallel.</simpara>
<simpara>Perform this operation before cloning a virtual machine, creating a template based on a virtual machine, or cleaning up a storage domain&#8217;s disk space.</simpara>
<simpara><emphasis role="strong">Limitations</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>NFS storage domains must use NFS version 4.2 or higher.</simpara>
</listitem>
<listitem>
<simpara>You cannot sparsify a disk that uses a direct LUN.</simpara>
</listitem>
<listitem>
<simpara>You cannot sparsify a disk that uses a preallocated allocation policy. If you are creating a virtual machine from a template, you must select <emphasis role="strong">Thin</emphasis> from the <emphasis role="strong">Storage Allocation</emphasis> field, or if selecting <emphasis role="strong">Clone</emphasis>, ensure that the template is based on a virtual machine that has thin provisioning.</simpara>
</listitem>
<listitem>
<simpara>You can only sparsify active snapshots.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Sparsifying a Disk</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> and shut down the required virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Click the virtual machine&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab. Ensure that the disk&#8217;s status is <literal>OK</literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Sparsify</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>A <literal>Started to sparsify</literal> event appears in the <emphasis role="strong">Events</emphasis> tab during the sparsify operation and the disk&#8217;s status displays as <literal>Locked</literal>. When the operation is complete, a <literal>Sparsified successfully</literal> event appears in the <emphasis role="strong">Events</emphasis> tab and the disk&#8217;s status displays as <literal>OK</literal>. The unused disk space has been returned to the host and is available for use by other virtual machines.</simpara>
</section>
</section>
</chapter>
<chapter xml:id="chap-External_Providers">
<title>External Providers</title>
<section xml:id="Introduction_to_Third_Party_Resource_Providers_in_Red_Hat_Enterprise_Virtualization">
<title>Introduction to External Providers in oVirt</title>
<simpara>In addition to resources managed by the oVirt Engine itself, oVirt can also take advantage of resources managed by external sources. The providers of these resources, known as external providers, can provide resources such as virtualization hosts, virtual machine images, and networks.</simpara>
<simpara>oVirt currently supports the following external providers:</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong">Red Hat Satellite for Host Provisioning</emphasis></term>
<listitem>
<simpara>Satellite is a tool for managing all aspects of the life cycle of both physical and virtual hosts. In oVirt, hosts managed by Satellite can be added to and used by the oVirt Engine as virtualization hosts. After you add a Satellite instance to the Engine, the hosts managed by the Satellite instance can be added by searching for available hosts on that Satellite instance when adding a new host. For more information on installing Red Hat Satellite and managing hosts using Red Hat Satellite, see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.2/html/installation_guide/"><emphasis>Red Hat Satellite Installation Guide</emphasis></link> and <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.2/html/host_configuration_guide/"><emphasis>Red Hat Satellite Host Configuration Guide</emphasis></link>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<variablelist xml:id="providers-kubevirt-openshift-virtualization">
<varlistentry>
<term><emphasis role="strong">KubeVirt/Openshift Virtualization</emphasis></term>
<listitem>
<simpara>Openshift Virtualization (formerly container-native virtualization or "CNV") enables you to bring virtual machines (VMs) into containerized workflows so you can develop, manage, and deploy virtual machines side-by-side with containers and serverless. In oVirt Engine, adding this provider is one of the requirements for using {container-platform-virt}. For details, see <xref linkend="proc-adding-kubevirt-openshift-as-an-external-provider_external_providers"/>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">OpenStack Image Service (Glance) for Image Management</emphasis></term>
<listitem>
<simpara>OpenStack Image Service provides a catalog of virtual machine images. In oVirt, these images can be imported into the oVirt Engine and used as floating disks or attached to virtual machines and converted into templates. After you add an OpenStack Image Service to the Engine, it appears as a storage domain that is not attached to any data center. Virtual disks in a oVirt environment can also be exported to an OpenStack Image Service as virtual disks.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">VMware for Virtual Machine Provisioning</emphasis></term>
<listitem>
<simpara>Virtual machines created in VMware can be converted using V2V (<literal>virt-v2v</literal>) and imported into a oVirt environment. After you add a VMware provider to the Engine, you can import the virtual machines it provides. V2V conversion is performed on a designated proxy host as part of the import operation.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">RHEL 5 Xen for Virtual Machine Provisioning</emphasis></term>
<listitem>
<simpara>Virtual machines created in RHEL 5 Xen can be converted using V2V (<literal>virt-v2v</literal>) and imported into a oVirt environment. After you add a RHEL 5 Xen host to the Engine, you can import the virtual machines it provides. V2V conversion is performed on a designated proxy host as part of the import operation.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">KVM for Virtual Machine Provisioning</emphasis></term>
<listitem>
<simpara>Virtual machines created in KVM can be imported into a oVirt environment. After you add a KVM host to the Engine, you can import the virtual machines it provides.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">Open Virtual Network (OVN) for Network Provisioning</emphasis></term>
<listitem>
<simpara>Open Virtual Network (OVN) is an Open vSwitch (OVS) extension that provides software-defined networks. After you add OVN to the Engine, you can import existing OVN networks, and create new OVN networks from the Engine. You can also automatically install OVN on the Engine using <literal>engine-setup</literal>.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="sect-Adding_External_Providers">
<title>Adding External Providers</title>
<section xml:id="Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">
<title>Adding a Red Hat Satellite Instance for Host Provisioning</title>
<simpara>Add a Satellite instance for host provisioning to the oVirt Engine. oVirt 4.2 is supported with Red Hat Satellite 6.1.</simpara>
<simpara><emphasis role="strong">Adding a Satellite Instance for Host Provisioning</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Foreman/Satellite</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the URL or fully qualified domain name of the machine on which the Satellite instance is installed in the <emphasis role="strong">Provider URL</emphasis> text field. You do not need to specify a port number.</simpara>
<important>
<simpara>IP addresses cannot be used to add a Satellite instance.</simpara>
</important>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Requires Authentication</emphasis> check box.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the Satellite instance. You must use the same user name and password as you would use to log in to the Satellite provisioning portal.</simpara>
</listitem>
<listitem>
<simpara>Test the credentials:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the Satellite instance using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>If the Satellite instance uses SSL, the <emphasis role="strong">Import provider certificates</emphasis> window opens; click <guibutton>OK</guibutton> to import the certificate that the Satellite instance provides to ensure the Engine can communicate with the instance.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Adding_an_OpenStack_Image_Service_Glance_for_Image_Management">
<title>Adding an OpenStack Image (Glance) Instance for Image Management</title>
<simpara>Add an OpenStack Image (Glance) instance for image management to the oVirt Engine.</simpara>
<simpara><emphasis role="strong">Adding an OpenStack Image (Glance) Instance for Image Management</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> and enter the details in the <emphasis role="strong">General Settings</emphasis> tab. For more information on these fields, see <xref linkend="Add_Provider_General_Settings_Explained"/>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">OpenStack Image</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Enter the URL or fully qualified domain name of the machine on which the OpenStack Image instance is installed in the <emphasis role="strong">Provider URL</emphasis> text field.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Requires Authentication</emphasis> check box and enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the OpenStack Image instance user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <emphasis role="strong">Protocol</emphasis> (must be <literal>HTTP</literal>), <emphasis role="strong">Hostname</emphasis>, and <emphasis role="strong">API Port.</emphasis></simpara>
<simpara>Enter the <emphasis role="strong">Tenant</emphasis> for the OpenStack Image instance.</simpara>
</listitem>
<listitem>
<simpara>Test the credentials:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the OpenStack Image instance using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>If the OpenStack Image instance uses SSL, the <emphasis role="strong">Import provider certificates</emphasis> window opens. Click <guibutton>OK</guibutton> to import the certificate that the OpenStack Image instance provides to ensure the Engine can communicate with the instance.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="proc-adding-kubevirt-openshift-as-an-external-provider_external_providers">
<title>Adding KubeVirt/Openshift Virtualization as an external provider</title>
<simpara>To run virtual machines in a container on the OKD, you add OpenShift as an external provider in Red Hat Virtualization.</simpara>
<note>
<simpara>This capability is known as <emphasis>OpenShift Virtualization</emphasis>.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara><link xl:href="https://docs.openshift.com/container-platform/latest/virt/install/preparing-cluster-for-virt.html">In OpenShift Container Platform, your cluster is configured for OpenShift Virtualization</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the oVirt Administration Portal, go to <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice> and click <guibutton>New</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>In <emphasis role="strong">Add Provider</emphasis>, set <emphasis role="strong">Type</emphasis> to <emphasis role="strong">KubeVirt/Openshift Virtualization</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Provider URL</emphasis> and <emphasis role="strong">Token</emphasis>, which are required.</simpara>
</listitem>
<listitem>
<simpara>Optional: Enter values for <emphasis role="strong">Advanced parameters</emphasis> such as <emphasis role="strong">Certificate Authority</emphasis>, <emphasis role="strong">Prometheus URL</emphasis>, and <emphasis role="strong">Prometheus Certificate Authority</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Test</guibutton> to verify the connection to the new provider.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to finish adding this new provider.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Verification steps</title>
<listitem>
<simpara>In the oVirt Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the name of new cluster you just created. This cluster name, <emphasis role="strong">kubevirt</emphasis> for example, is based on the name of the provider. This action opens the cluster details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosts</emphasis> tab to verify that the OKD status of the worker nodes is up.</simpara>
<note>
<simpara>Even if they are running, the status of the master nodes is down because they cannot host virtual machines.</simpara>
</note>
</listitem>
<listitem>
<simpara>Use <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> to deploy a virtual machine to the new cluster.</simpara>
</listitem>
<listitem>
<simpara>In the OKD web console, in the <emphasis role="strong">Administrator</emphasis> perspective, use <menuchoice><guimenu>Workloads</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> to view the virtual machine you deployed.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://docs.openshift.com/container-platform/latest/virt/about-virt.html">About OpenShift Virtualization</link></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Add_Provider_General_Settings_Explained"/></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Adding_a_VMware_Instance_as_a_Virtual_Machine_Provider">
<title>Adding a VMware Instance as a Virtual Machine Provider</title>
<simpara>Add a VMware vCenter instance to import virtual machines from VMware to the oVirt Engine.</simpara>
<simpara>oVirt uses V2V to convert VMware virtual machines to the correct format before they are imported. The <literal>virt-v2v</literal> package must be installed on at least one host. The <literal>virt-v2v</literal> package is available by default on oVirt Nodes (oVirt Node) and is installed on Enterprise Linux hosts as a dependency of VDSM when added to the oVirt environment. Enterprise Linux hosts must be Enterprise Linux 7.2 or later.</simpara>
<note>
<simpara>The <literal>virt-v2v</literal> package is not available on ppc64le architecture; these hosts cannot be used as proxy hosts.</simpara>
</note>
<simpara><emphasis role="strong">Adding a VMware vCenter Instance as a Virtual Machine Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">VMware</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> into which VMware virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to instead specify the destination data center during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Enter the IP address or fully qualified domain name of the VMware vCenter instance in the <emphasis role="strong">vCenter</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the IP address or fully qualified domain name of the host from which the virtual machines will be imported in the <emphasis role="strong">ESXi</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Enter the name of the data center in which the specified ESXi host resides in the <emphasis role="strong">Data Center</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>If you have exchanged the SSL certificate between the ESXi host and the Engine, leave the <emphasis role="strong">Verify server&#8217;s SSL certificate</emphasis> check box selected to verify the ESXi host&#8217;s certificate. If not, clear the check box.</simpara>
</listitem>
<listitem>
<simpara>Select a host in the chosen data center with <literal>virt-v2v</literal> installed to serve as the <emphasis role="strong">Proxy Host</emphasis> during virtual machine import operations. This host must also be able to connect to the network of the VMware vCenter external provider. If you selected <emphasis role="strong">Any Data Center</emphasis> above, you cannot choose the host here, but instead can specify a host during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the VMware vCenter instance. The user must have access to the VMware data center and ESXi host on which the virtual machines reside.</simpara>
</listitem>
<listitem>
<simpara>Test the credentials:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the VMware vCenter instance using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>If the VMware vCenter instance uses SSL, the <emphasis role="strong">Import provider certificates</emphasis> window opens; click <guibutton>OK</guibutton> to import the certificate that the VMware vCenter instance provides to ensure the Engine can communicate with the instance.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>To import virtual machines from the VMware external provider, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_VMware_Provider">Importing a Virtual Machine from a VMware Provider</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</section>
<section xml:id="Adding_Xen_as_an_External_Provider">
<title>Adding a RHEL 5 Xen Host as a Virtual Machine Provider</title>
<simpara>Add a RHEL 5 Xen host to import virtual machines from Xen to oVirt.</simpara>
<simpara>oVirt uses V2V to convert RHEL 5 Xen virtual machines to the correct format before they are imported. The <literal>virt-v2v</literal> package must be installed on at least one host. The <literal>virt-v2v</literal> package is available by default on oVirt Nodes (oVirt Node) and is installed on Enterprise Linux hosts as a dependency of VDSM when added to the oVirt environment. Enterprise Linux hosts must be Enterprise Linux 7.2 or later.</simpara>
<note>
<simpara>The <literal>virt-v2v</literal> package is not available on ppc64le architecture; these hosts cannot be used as proxy hosts.</simpara>
</note>
<simpara><emphasis role="strong">Adding a RHEL 5 Xen Instance as a Virtual Machine Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable public key authentication between the proxy host and the RHEL 5 Xen host:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Log in to the proxy host and generate SSH keys for the <emphasis role="strong">vdsm</emphasis> user.</simpara>
<screen># sudo -u vdsm ssh-keygen</screen>
</listitem>
<listitem>
<simpara>Copy the <emphasis role="strong">vdsm</emphasis> user&#8217;s public key to the RHEL 5 Xen host. The proxy host&#8217;s <emphasis role="strong">known_hosts</emphasis> file will also be updated to include the host key of the RHEL 5 Xen host.</simpara>
<screen># sudo -u vdsm ssh-copy-id root@<emphasis>xenhost.example.com</emphasis></screen>
</listitem>
<listitem>
<simpara>Log in to the RHEL 5 Xen host to verify that the login works correctly.</simpara>
<screen># sudo -u vdsm ssh root@<emphasis>xenhost.example.com</emphasis></screen>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">XEN</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> into which Xen virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to specify the destination data center during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Enter the URI of the RHEL 5 Xen host in the <emphasis role="strong">URI</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Select a host in the chosen data center with <literal>virt-v2v</literal> installed to serve as the <emphasis role="strong">Proxy Host</emphasis> during virtual machine import operations. This host must also be able to connect to the network of the RHEL 5 Xen external provider. If you selected <emphasis role="strong">Any Data Center</emphasis> above, you cannot choose the host here, but instead can specify a host during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the RHEL 5 Xen host.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>To import virtual machines from a RHEL 5 Xen external provider, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_Xen">Importing a Virtual Machine from a RHEL 5 Xen Host</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</section>
<section xml:id="Adding_KVM_as_an_External_Provider">
<title>Adding a KVM Host as a Virtual Machine Provider</title>
<simpara>Add a KVM host to import virtual machines from KVM to oVirt Engine.</simpara>
<simpara><emphasis role="strong">Adding a KVM Host as a Virtual Machine Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable public key authentication between the proxy host and the KVM host:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Log in to the proxy host and generate SSH keys for the <emphasis role="strong">vdsm</emphasis> user.</simpara>
<screen># sudo -u vdsm ssh-keygen</screen>
</listitem>
<listitem>
<simpara>Copy the <emphasis role="strong">vdsm</emphasis> user&#8217;s public key to the KVM host. The proxy host&#8217;s <emphasis role="strong">known_hosts</emphasis> file will also be updated to include the host key of the KVM host.</simpara>
<screen># sudo -u vdsm ssh-copy-id root@<emphasis>kvmhost.example.com</emphasis></screen>
</listitem>
<listitem>
<simpara>Log in to the KVM host to verify that the login works correctly.</simpara>
<screen># sudo -u vdsm ssh root@<emphasis>kvmhost.example.com</emphasis></screen>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">KVM</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Data Center</emphasis> into which KVM virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to specify the destination data center during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Enter the URI of the KVM host in the <emphasis role="strong">URI</emphasis> field.</simpara>
<screen>qemu+ssh://root@host.example.com/system</screen>
</listitem>
<listitem>
<simpara>Select a host in the chosen data center to serve as the <emphasis role="strong">Proxy Host</emphasis> during virtual machine import operations. This host must also be able to connect to the network of the KVM external provider. If you selected <emphasis role="strong">Any Data Center</emphasis> in the <emphasis role="strong">Data Center</emphasis> field above, you cannot choose the host here. The field is greyed out and shows <emphasis role="strong">Any Host in Data Center</emphasis>. Instead you can specify a host during individual import operations.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Requires Authentication</emphasis> check box and enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the KVM host. The user must have access to the KVM host on which the virtual machines reside.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the KVM host using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>To import virtual machines from a KVM external provider, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_KVM">Importing a Virtual Machine from a KVM Host</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</section>
<section xml:id="Adding_OVN_as_an_External_Network_Provider">
<title>Adding Open Virtual Network (OVN) as an External Network Provider</title>
<simpara>You can use Open Virtual Network (OVN) to create overlay virtual networks that enable communication among the virtual machines without adding VLANs or changing the infrastructure. OVN is an extension of Open vSwitch (OVS) that provides native support for virtual L2 and L3 overlays.</simpara>
<simpara>You can <link linkend="Installing_a_new_OVN_network_provider">install a new OVN network provider</link> or <link linkend="Adding_an_existing_OVN_network_provider">add an existing one</link>.</simpara>
<simpara>You can also connect an OVN network to a native oVirt network. See <xref linkend="Connecting_an_OVN_Network_to_a_Physical_Network"/> for more information.</simpara>
<simpara>The <literal>ovirt-provider-ovn</literal> exposes an OpenStack Networking REST API. You can use this API to create networks, subnets, ports, and routers. For details, see <link xl:href="https://developer.openstack.org/api-ref/network/v2/"><emphasis>OpenStack Networking API v2.0</emphasis></link>.</simpara>
<note>
<simpara>CloudForms supports OVN as an external provider using the OpenStack Networking API. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html/managing_providers/network_providers">Network Managers</link> in <emphasis>Red Hat CloudForms: Managing Providers</emphasis> for details.</simpara>
</note>
<simpara>For more details, see the <link xl:href="http://docs.openvswitch.org/en/latest/">Open vSwitch Documentation</link> and <link xl:href="http://openvswitch.org/support/dist-docs/">Open vSwitch Manpages</link>.</simpara>
<section xml:id="Installing_a_new_OVN_network_provider">
<title>Installing a New OVN Network Provider</title>
<warning>
<simpara>If the <literal>openvswitch</literal> package is already installed and if the version is 1:2.6.1 (version 2.6.1, epoch 1), the OVN installation will fail when it tries to install the latest <literal>openvswitch</literal> package. See the Doc Text in <link xl:href="https://bugzilla.redhat.com/show_bug.cgi?id=1505398">BZ#1505398</link> for the details and a workaround.</simpara>
</warning>
<simpara>Installing OVN using <literal>engine-setup</literal> performs the following steps:</simpara>
<itemizedlist>
<listitem>
<simpara>Sets up an OVN central server on the Engine machine.</simpara>
</listitem>
<listitem>
<simpara>Adds OVN to oVirt as an external network provider.</simpara>
</listitem>
<listitem>
<simpara>On the Default cluster only, sets the <emphasis role="strong">Default Network Provider</emphasis> to <literal>ovirt-provider-ovn</literal>.</simpara>
</listitem>
</itemizedlist>
<important>
<itemizedlist>
<listitem>
<simpara>Installing OVN changes the <emphasis role="strong">Default Network Provider</emphasis> setting on the Default cluster only, not on other clusters.</simpara>
</listitem>
<listitem>
<simpara>Changing the <emphasis role="strong">Default Network Provider</emphasis> setting does not update hosts in that cluster to use the <emphasis role="strong">Default Network Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>For hosts and virtual machines to use OVN, perform the addition tasks described in the "Next steps" at the end of this topic.</simpara>
</listitem>
</itemizedlist>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Optional: If you use a preconfigured answer file with <literal>engine-setup</literal>, add the following entry to install OVN:</simpara>
<screen>OVESETUP_OVN/ovirtProviderOvn=bool:True</screen>
</listitem>
<listitem>
<simpara>Run <literal>engine-setup</literal> on the Engine machine.</simpara>
</listitem>
<listitem>
<simpara>If you do not use a preconfigured answer file, answer <literal>Yes</literal> when the <literal>engine-setup</literal> asks:</simpara>
<screen>Configuring ovirt-provider-ovn also sets the Default cluster's default network provider to ovirt-provider-ovn.
Non-Default clusters may be configured with an OVN after installation.
Configure ovirt-provider-ovn (Yes, No) [Yes]:</screen>
</listitem>
<listitem>
<simpara>Answer the following question:</simpara>
<screen>Use default credentials (admin@internal) for ovirt-provider-ovn (Yes, No) [Yes]?:</screen>
<simpara>If <literal>Yes</literal>, <literal>engine-setup</literal> uses the default engine user and password specified earlier in the setup process. This option is only available during new installations.</simpara>
<screen>oVirt OVN provider user[admin]:
oVirt OVN provider password[empty]:</screen>
<simpara>You can use the default values or specify the oVirt OVN provider user and password.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>To change the authentication method later, you can edit the <literal>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</literal> file, or create a new <literal>/etc/ovirt-provider-ovn/conf.d/20_engine_setup.conf</literal> file. Restart the <literal>ovirt-provider-ovn</literal> service for the change to take effect. See <link xl:href="https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc">https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc</link> for more information about OVN authentication.</simpara>
</note>
<formalpara xml:id="Installing-OVN-next-steps">
<title>Next steps</title>
<para>Before you can create virtual machines that use a newly-installed OVN network, complete these additional steps:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Creating_a_new_logical_network_in_a_data_center_or_cluster">Add a network to the <emphasis role="strong">Default</emphasis> cluster</link>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>While doing so, select the <emphasis role="strong">Create on external provider</emphasis> check box. This creates a network based on <literal>ovirt-provider-ovn</literal>.</simpara>
</listitem>
<listitem>
<simpara>Optional: To <link linkend="Connecting_an_OVN_Network_to_a_Physical_Network">connect the OVN network to a physical network</link>, select the <emphasis role="strong">Connect to physical network</emphasis> check box and specify the oVirt network to use.</simpara>
</listitem>
<listitem>
<simpara>Optional: Determine whether the network should use a security group and select one from the <emphasis role="strong">Security Groups</emphasis> drop-down. For more information on the available options see <xref linkend="Logical_Network_General_Settings_Explained"/>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara><link linkend="Adding_standard_hosts_to_the_Manager_host_tasks">Add hosts to</link> or <link linkend="Reinstalling_Hosts_admin">reinstall the hosts on</link> the Default cluster so they use the cluster&#8217;s new <emphasis role="strong">Default Network Provider</emphasis>, <literal>ovirt-provider-ovn</literal>.</simpara>
</listitem>
<listitem>
<simpara>Optional: Edit non-Default clusters and set <emphasis role="strong">Default Network Provider</emphasis> to <literal>ovirt-provider-ovn</literal>.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Optional: Reinstall the hosts on each non-Default cluster so they use the cluster&#8217;s new <emphasis role="strong">Default Network Provider</emphasis>, <literal>ovirt-provider-ovn</literal>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara>To configure your hosts to use an existing, non-default network, see <xref linkend="Configuring_Hosts_for_an_OVN_tunnel_network"/>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Adding_an_existing_OVN_network_provider">
<title>Adding an Existing OVN Network Provider</title>
<simpara>Adding an existing OVN central server as an external network provider in oVirt involves the following key steps:</simpara>
<itemizedlist>
<listitem>
<simpara>Install the OVN provider, a proxy used by the Engine to interact with OVN. The OVN provider can be installed on any machine, but must be able to communicate with the OVN central server and the Engine.</simpara>
</listitem>
<listitem>
<simpara>Add the OVN provider to oVirt as an external network provider.</simpara>
</listitem>
<listitem>
<simpara>Create a new cluster that uses OVN as its default network provider. Hosts added to this cluster are automatically configured to communicate with OVN.</simpara>
</listitem>
</itemizedlist>
<formalpara>
<title>Prerequisites</title>
<para>The following packages are required by the OVN provider and must be available on the provider machine:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>openvswitch-ovn-central</simpara>
</listitem>
<listitem>
<simpara>openvswitch</simpara>
</listitem>
<listitem>
<simpara>openvswitch-ovn-common</simpara>
</listitem>
<listitem>
<simpara>python-openvswitch</simpara>
</listitem>
</itemizedlist>
<simpara>If these packages are not available from the repositories already enabled on the provider machine, they can be downloaded from the OVS website: <link xl:href="http://openvswitch.org/download/">http://openvswitch.org/download/</link>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install and configure the OVN provider.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Install the provider on the provider machine:</simpara>
<screen># dnf install ovirt-provider-ovn</screen>
</listitem>
<listitem>
<simpara>If you are not installing the provider on the same machine as the Engine, add the following entry to the <literal>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</literal> file (create this file if it does not already exist):</simpara>
<screen>[OVIRT]
ovirt-host=https://<emphasis>Manager_host_name</emphasis></screen>
<simpara>This is used for authentication, if authentication is enabled.</simpara>
</listitem>
<listitem>
<simpara>If you are not installing the provider on the same machine as the OVN central server, add the following entry to the <literal>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</literal> file (create this file if it does not already exist):</simpara>
<screen>[OVN REMOTE]
ovn-remote=tcp:<emphasis>OVN_central_server_IP</emphasis>:6641</screen>
</listitem>
<listitem>
<simpara>Open ports 9696, 6641, and 6642 in the firewall to allow communication between the OVN provider, the OVN central server, and the Engine. This can be done either manually or by adding the <literal>ovirt-provider-ovn</literal> and <literal>ovirt-provider-ovn-central</literal> services to the appropriate zone:</simpara>
<screen># firewall-cmd --zone=<emphasis>ZoneName</emphasis> --add-service=ovirt-provider-ovn --permanent
# firewall-cmd --zone=<emphasis>ZoneName</emphasis> --add-service=ovirt-provider-ovn-central --permanent
# firewall-cmd --reload</screen>
</listitem>
<listitem>
<simpara>Start and enable the service:</simpara>
<screen># systemctl start ovirt-provider-ovn
# systemctl enable ovirt-provider-ovn</screen>
</listitem>
<listitem>
<simpara>Configure the OVN central server to listen to requests from ports 6642 and 6641:</simpara>
<screen># ovn-sbctl set-connection ptcp:6642
# ovn-nbctl set-connection ptcp:6641</screen>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> and enter the details in the <emphasis role="strong">General Settings</emphasis> tab. For more information on these fields, see <xref linkend="Add_Provider_General_Settings_Explained"/>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>From the <emphasis role="strong">Type</emphasis> list, select <emphasis role="strong">External Network Provider</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Networking Plugin</emphasis> text box and select <emphasis role="strong">oVirt Network Provider for OVN</emphasis> from the drop-down menu.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Automatic Synchronization</emphasis> check box. This enables automatic synchronization of the external network provider with existing networks.</simpara>
<note>
<simpara>Automatic synchronization is enabled by default on the <emphasis role="strong">ovirt-provider-ovn</emphasis> network provider created by the <emphasis role="strong">engine-setup</emphasis> tool.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter the URL or fully qualified domain name of the OVN provider in the <emphasis role="strong">Provider URL</emphasis> text field, followed by the port number. If the OVN provider and the OVN central server are on separate machines, this is the URL of the provider machine, not the central server. If the OVN provider is on the same machine as the Engine, the URL can remain the default <literal>http://localhost:9696</literal>.</simpara>
</listitem>
<listitem>
<simpara>Clear the <emphasis role="strong">Read-Only</emphasis> check box to allow creating new OVN networks from the oVirt Engine.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Requires Authentication</emphasis> check box and enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the for the external network provider user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <emphasis role="strong">Protocol</emphasis>, <emphasis role="strong">Hostname</emphasis>, and <emphasis role="strong">API Port</emphasis>.</simpara>
<simpara>Optionally, enter the <emphasis role="strong">Tenant</emphasis> for the external network provider.</simpara>
<simpara>The authentication method must be configured in the <literal>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</literal> file (create this file if it does not already exist). Restart the <literal>ovirt-provider-ovn</literal> service for the change to take effect. See <link xl:href="https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc">https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc</link> for more information about OVN authentication.</simpara>
</listitem>
<listitem>
<simpara>Test the credentials:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with OVN using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>If the OVN instance uses SSL, the <emphasis role="strong">Import provider certificates</emphasis> window opens; click <guibutton>OK</guibutton> to import the certificate that the OVN instance provides to ensure the Engine can communicate with the instance.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Create a new cluster that uses OVN as its default network provider. See <xref linkend="Creating_a_New_Cluster"/> and select the OVN network provider from the <emphasis role="strong">Default Network Provider</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Add hosts to the cluster. Hosts added to this cluster are automatically configured to communicate with OVN. To add new hosts, see <xref linkend="Adding_standard_hosts_to_the_Manager_host_tasks"/>.</simpara>
</listitem>
<listitem>
<simpara>Import or add OVN networks to the new cluster. To import networks, see <link linkend="Importing_Networks">Importing Networks</link>. To create new networks using OVN, see <link linkend="Creating_a_new_logical_network_in_a_data_center_or_cluster">Creating a new logical network in a data center or cluster</link>, and select the <emphasis role="strong">Create on external provider</emphasis> check box. <literal>ovirt-provider-ovn</literal> is selected by default.</simpara>
<simpara>To configure your hosts to use an existing, non-default network, see <xref linkend="Configuring_Hosts_for_an_OVN_tunnel_network"/>.</simpara>
<simpara>To connect the OVN network to a native oVirt network, select the <emphasis role="strong">Connect to physical network</emphasis> check box and specify the oVirt network to use. See <xref linkend="Connecting_an_OVN_Network_to_a_Physical_Network"/> for more information and prerequisites.</simpara>
</listitem>
</orderedlist>
<simpara>You can now create virtual machines that use OVN networks.</simpara>
</section>
<section xml:id="Using_an_Ansible_playbook_to_modify_an_OVN_tunnel_network">
<title>Using an Ansible playbook to modify an OVN tunnel network</title>
<simpara>You can use the <literal>ovirt-provider-ovn-driver</literal> Ansible playbook to use long names to modify the tunnel network for OVN controllers.</simpara>
<simpara><emphasis role="strong">Ansible playbook to modify an OVN tunnel network</emphasis></simpara>
<screen># ansible-playbook --key-file &lt;path_to_key_file&gt; -i &lt;path_to_inventory&gt; --extra-vars " cluster_name=&lt;cluster_name&gt; ovn_central=&lt;ovn_central_ip_address&gt; ovirt_network=&lt;ovirt network name&gt; ovn_tunneling_interface=&lt;vdsm_network_name&gt;" ovirt-provider-ovn-driver.yml</screen>
<simpara><emphasis role="strong">Parameters</emphasis></simpara>
<variablelist>
<varlistentry>
<term>key-file</term>
<listitem>
<simpara>The key file to log into the host. The default key file is usually found in the <literal>/etc/pki/ovirt-engine/keys</literal> directory.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>inventory</term>
<listitem>
<simpara>The oVirt VM inventory. To locate the inventory value, use this script: <literal>/usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>cluster_name</term>
<listitem>
<simpara>The name of the cluster on which to update the name.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>ovn_central</term>
<listitem>
<simpara>The IP address to the OVN central server. This IP address must be accessible to all hosts.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>ovirt_network</term>
<listitem>
<simpara>The oVirt network name.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term>ovn_tunneling_interface</term>
<listitem>
<simpara>The VDSM network name.</simpara>
</listitem>
</varlistentry>
</variablelist>
<note>
<simpara>The <literal>ovirt-provider-ovn-driver</literal> Ansible playbook supports using either the <literal>ovirt_network</literal> parameter or the <literal>ovn_tunneling_interface</literal> parameter. This playbook fails if both parameters are present in the same playbook.</simpara>
</note>
<simpara><emphasis role="strong">Playbook with <literal>ovirt_network</literal> parameter</emphasis></simpara>
<screen># ansible-playbook --key-file /etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars " cluster_name=test-cluster ovn_central=192.168.200.2 ovirt_network=\"Long\ Network\ Name\ with\ \Ascii\ character\ \☺\"" ovirt-provider-ovn-driver.yml</screen>
<simpara><emphasis role="strong">Playbook with <literal>ovn_tunneling_interface</literal> parameter</emphasis></simpara>
<screen># ansible-playbook --key-file /etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars " cluster_name=test-cluster ovn_central=192.168.200.2 ovn_tunneling_interface=on703ea21ddbc34" ovirt-provider-ovn-driver.yml</screen>
<simpara>On the Engine machine, navigate to the <literal>/usr/share/ovirt-engine/playbooks</literal> directory to run the Ansible playbooks.</simpara>
</section>
<section xml:id="Configuring_Hosts_for_an_OVN_tunnel_network">
<title>Configuring Hosts for an OVN Tunnel Network</title>
<simpara>You can configure your hosts to use an existing network, other than the default <literal>ovirtmgmt</literal> network, with the <literal>ovirt-provider-ovn-driver</literal> Ansible playbook. The network must be accessible to all the hosts in the cluster.</simpara>
<note>
<simpara>The <literal>ovirt-provider-ovn-driver</literal> Ansible playbook updates existing hosts. If you add new hosts to the cluster, you must run the playbook again.</simpara>
</note>
<simpara><emphasis role="strong">Configuring Hosts for an OVN Tunnel Network</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine machine, go to the <emphasis role="strong">playbooks</emphasis> directory:</simpara>
<screen># cd /usr/share/ovirt-engine/playbooks</screen>
</listitem>
<listitem>
<simpara>Run the <literal>ansible-playbook</literal> command with the following parameters:</simpara>
<screen># ansible-playbook --private-key=/etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars "&#160;cluster_name=<emphasis>Cluster_Name</emphasis> ovn_central=<emphasis>OVN_Central_IP</emphasis> ovn_tunneling_interface=<emphasis>VDSM_Network_Name</emphasis>" ovirt-provider-ovn-driver.yml</screen>
<simpara>For example:</simpara>
<screen># ansible-playbook --private-key=/etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars "&#160;cluster_name=MyCluster ovn_central=192.168.0.1 ovn_tunneling_interface=MyNetwork" ovirt-provider-ovn-driver.yml</screen>
<note>
<simpara>The <emphasis>OVN_Central_IP</emphasis> can be on the new network, but this is not a requirement. The <emphasis>OVN_Central_IP</emphasis> must be accessible to all hosts.</simpara>
<simpara>The <emphasis>VDSM_Network_Name</emphasis> is limited to 15 characters. If you defined a logical network name that was longer than 15 characters or contained non-ASCII characters, a 15-character name is automatically generated. See <link linkend="Vdsm_To_Network_Mapping_Tool">Mapping VDSM Names to Logical Network Names</link> for instructions on displaying a mapping of these names.</simpara>
</note>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Updating the OVN Tunnel Network on a Single Host</emphasis></simpara>
<simpara>You can update the OVN tunnel network on a single host with <literal>vdsm-tool</literal>:</simpara>
<screen># vdsm-tool ovn-config <emphasis>OVN_Central_IP</emphasis> <emphasis>Tunneling_IP_or_Network_Name</emphasis></screen>
<example>
<title>Updating a Host with <literal>vdsm-tool</literal></title>
<screen># vdsm-tool ovn-config 192.168.0.1 MyNetwork</screen>
</example>
</section>
<section xml:id="Connecting_an_OVN_Network_to_a_Physical_Network">
<title>Connecting an OVN Network to a Physical Network</title>
<simpara>You can create an external provider network that overlays a native oVirt network so that the virtual machines on each appear to be sharing the same subnet.</simpara>
<important>
<simpara>If you created a subnet for the OVN network, a virtual machine using that network will receive an IP address from there. If you want the physical network to allocate the IP address, do not create a subnet for the OVN network.</simpara>
</important>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>The cluster must have <emphasis role="strong">OVS</emphasis> selected as the <emphasis role="strong">Switch Type</emphasis>. Hosts added to this cluster must not have any pre-existing oVirt networks configured, such as the <emphasis role="strong">ovirtmgmt</emphasis> bridge.</simpara>
</listitem>
<listitem>
<simpara>The physical network must be available on the hosts. You can enforce this by setting the physical network as required for the cluster (in the <emphasis role="strong">Manage Networks</emphasis> window, or the <emphasis role="strong">Cluster</emphasis> tab of the <emphasis role="strong">New Logical Network</emphasis> window).</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Creating a New External Network Connected to a Physical Network</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the cluster&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Logical Networks</emphasis> tab and click <emphasis role="strong">Add Network</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> for the network.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Create on external provider</emphasis> check box. <literal>ovirt-provider-ovn</literal> is selected by default.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Connect to physical network</emphasis> check box if it is not already selected by default.</simpara>
</listitem>
<listitem>
<simpara>Choose the physical network to connect the new network to:</simpara>
<itemizedlist>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center Network</emphasis> radio button and select the physical network from the drop-down list. This is the recommended option.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Custom</emphasis> radio button and enter the name of the physical network. If the physical network has VLAN tagging enabled, you must also select the <emphasis role="strong">Enable VLAN tagging</emphasis> check box and enter the physical network&#8217;s VLAN tag.</simpara>
<important>
<simpara>The physical network&#8217;s name must not be longer than 15 characters, or contain special characters.</simpara>
</important>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Adding_an_External_Network_Provider">
<title>Adding an External Network Provider</title>
<simpara>Any network provider that implements the OpenStack Networking REST API can be added to oVirt. The virtual interface driver needs to be provided by the implementer of the external network provider. A reference implementation of a network provider and a virtual interface driver are available at <link xl:href="https://github.com/mmirecki/ovirt-provider-mock">https://github.com/mmirecki/ovirt-provider-mock</link> and <link xl:href="https://github.com/mmirecki/ovirt-provider-mock/blob/master/docs/driver_instalation">https://github.com/mmirecki/ovirt-provider-mock/blob/master/docs/driver_instalation</link>.</simpara>
<simpara><emphasis role="strong">Adding an External Network Provider for Network Provisioning</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis> and enter the details in the <emphasis role="strong">General Settings</emphasis> tab. For more information on these fields, see <xref linkend="Add_Provider_General_Settings_Explained"/>.</simpara>
</listitem>
<listitem>
<simpara>Enter a <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">External Network Provider</emphasis> from the <emphasis role="strong">Type</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Optionally, click the <emphasis role="strong">Networking Plugin</emphasis> text box and select the appropriate driver from the drop-down menu.</simpara>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Automatic Synchronization</emphasis> check box. This enables automatic synchronization of the external network provider with existing networks. This feature is disabled by default when adding external network providers.</simpara>
<note>
<simpara>Automatic synchronization is enabled by default on the <emphasis role="strong">ovirt-provider-ovn</emphasis> network provider created by the <emphasis role="strong">engine-setup</emphasis> tool.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter the URL or fully qualified domain name of the machine on which the external network provider is installed in the <emphasis role="strong">Provider URL</emphasis> text field, followed by the port number. The <emphasis role="strong">Read-Only</emphasis> check box is selected by default. This prevents users from modifying the external network provider.</simpara>
<important>
<simpara>You must leave the <emphasis role="strong">Read-Only</emphasis> check box selected for your setup to be supported by Red Hat.</simpara>
</important>
</listitem>
<listitem>
<simpara>Optionally, select the <emphasis role="strong">Requires Authentication</emphasis> check box and enter the <emphasis role="strong">Username</emphasis> and <emphasis role="strong">Password</emphasis> for the external network provider user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <emphasis role="strong">Protocol</emphasis>, <emphasis role="strong">Hostname</emphasis>, and <emphasis role="strong">API Port</emphasis>.</simpara>
<simpara>Optionally, enter the <emphasis role="strong">Tenant</emphasis> for the external network provider.</simpara>
</listitem>
<listitem>
<simpara>Test the credentials:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click <emphasis role="strong">Test</emphasis> to test whether you can authenticate successfully with the external network provider using the provided credentials.</simpara>
</listitem>
<listitem>
<simpara>If the external network provider uses SSL, the <emphasis role="strong">Import provider certificates</emphasis> window opens; click <guibutton>OK</guibutton> to import the certificate that the external network provider provides to ensure the Engine can communicate with the instance.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Before you can use networks from this provider, you must install the virtual interface driver on the hosts and import the networks. To import networks, see <xref linkend="Importing_Networks"/>.</simpara>
</section>
<section xml:id="Add_Provider_General_Settings_Explained">
<title>Add Provider General Settings Explained</title>
<simpara>The <emphasis role="strong">General</emphasis> tab in the <emphasis role="strong">Add Provider</emphasis> window allows you to register the core details of the external provider.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Add Provider: General Settings</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting</entry>
<entry align="left" valign="top">Explanation</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Name</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A name to represent the provider in the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Description</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A plain text, human-readable description of the provider.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Type</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The type of external provider. Changing this setting alters the available fields for configuring the provider.</simpara>
<simpara><emphasis role="strong">External Network Provider</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Networking Plugin</emphasis>: Determines which implementation of the driver will be used on the host to handle NIC operations. If an external network provider with the <literal>oVirt Network Provider for OVN</literal> plugin is added as the default network provider for a cluster, this also determines which driver will be installed on hosts added to the cluster.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Automatic Synchronization</emphasis>: Allows you to specify whether the provider will be automatically synchronized with existing networks.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name of the machine on which the external network provider is hosted. You must add the port number for the external network provider to the end of the URL or fully qualified domain name. By default, this port number is 9696.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Read Only</emphasis>: Allows you to specify whether the external network provider can be modified from the Administration Portal.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required to access the external network provider.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the external network provider. If you are authenticating with Active Directory, the user name must be in the format of <emphasis>username</emphasis>@<emphasis>domain</emphasis>@<emphasis>auth_profile</emphasis> instead of the default <emphasis>username</emphasis>@<emphasis>domain</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Protocol</emphasis>: The protocol used to communicate with the Keystone server. The default is <emphasis role="strong">HTTPS</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hostname</emphasis>: The IP address or hostname of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API port</emphasis>: The API port number of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API Version</emphasis>: The version of the Keystone server.  The value is <literal>v2.0</literal> and the field is disabled.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Tenant Name</emphasis>: Optional. The name of the tenant of which the external network provider is a member.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Foreman/Satellite</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name of the machine that hosts the Satellite instance. You do not need to add the port number to the end of the URL or fully qualified domain name.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required for the provider. Authentication is mandatory when <emphasis role="strong">Foreman/Satellite</emphasis> is selected.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the Satellite instance. This user name must be the user name used to log in to the provisioning portal on the Satellite instance.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated. This password must be the password used to log in to the provisioning portal on the Satellite instance.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">KubeVirt/OpenShift Virtualization</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name and port number of the OKD API. By default, this port number is 6443.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Token</emphasis> The <link xl:href="https://docs.openshift.com/container-platform/4.4/security/container_security/security-platform.html#security-platform-auth-controlling-access_security-platform">OAuth access token</link> for authenticating this connection to the API.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Certificate Authority</emphasis> The CA certificate to be trusted when making https requests.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Prometheus URL</emphasis> The URL for the OpenShift cluster&#8217;s prometheus service. If you do not provide this URL, the software will try to automatically detect this URL.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Prometheus Certificate Authority</emphasis> The X509 certificate for prometheus. If you do not specify this CA, the provider uses the KubeVirt CA instead.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">OpenStack Image</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name of the machine on which the OpenStack Image service is hosted. You must add the port number for the OpenStack Image service to the end of the URL or fully qualified domain name. By default, this port number is 9292.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required to access the OpenStack Image service.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the Keystone server. This user name must be the user name for the OpenStack Image service registered in the Keystone instance of which the OpenStack Image service is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated. This password must be the password for the OpenStack Image service registered in the Keystone instance of which the OpenStack Image service is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Protocol</emphasis>: The protocol used to communicate with the Keystone server. This must be set to <literal>HTTP</literal>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hostname</emphasis>: The IP address or hostname of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API port</emphasis>: The API port number of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API Version</emphasis>: The version of the Keystone service. The value is <literal>v2.0</literal> and the field is disabled.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Tenant Name</emphasis>: The name of the OpenStack tenant of which the OpenStack Image service is a member.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">OpenStack Networking</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Networking Plugin</emphasis>: The networking plugin with which to connect to the OpenStack Networking server. For OpenStack Networking, <emphasis role="strong">Open vSwitch</emphasis> is the only option, and is selected by default.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Automatic Synchronization</emphasis>: Allows you to specify whether the provider will be automatically synchronized with existing networks.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name of the machine on which the OpenStack Networking instance is hosted. You must add the port number for the OpenStack Networking instance to the end of the URL or fully qualified domain name. By default, this port number is 9696.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Read Only</emphasis>: Allows you to specify whether the OpenStack Networking instance can be modified from the Administration Portal.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required to access the OpenStack Networking service.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the OpenStack Networking instance. This user name must be the user name for OpenStack Networking registered in the Keystone instance of which the OpenStack Networking instance is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated. This password must be the password for OpenStack Networking registered in the Keystone instance of which the OpenStack Networking instance is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Protocol</emphasis>: The protocol used to communicate with the Keystone server. The default is <emphasis role="strong">HTTPS</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hostname</emphasis>: The IP address or hostname of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API port</emphasis>: The API port number of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API Version</emphasis>: The version of the Keystone server. This appears in the URL. If v2.0 appears, select <emphasis role="strong">v2.0</emphasis>. If v3 appears select <literal>v3</literal>.</simpara>
</listitem>
</itemizedlist>
<simpara>The following fields appear when you select <literal>v3</literal> from the <emphasis role="strong">API Version</emphasis> field:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">User Domain Name</emphasis>: The name of the user defined in the domain.</simpara>
<simpara>With Keystone API v3, domains are used to determine administrative boundaries of service entities in OpenStack. Domains allow you to group users together for various purposes, such as setting domain-specific configuration or security options. For more information, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/11/html-single/architecture_guide/index#comp-identity">OpenStack Identity (keystone)</link> in the Red Hat OpenStack Platform <emphasis>Architecture Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Project Name</emphasis>: Defines the project name for OpenStack Identity API v3.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Project Domain Name</emphasis>: Defines the project’s domain name for OpenStack Identity API v3.</simpara>
</listitem>
</itemizedlist>
<simpara>The following field appears when you select <emphasis role="strong">v2.0</emphasis> from the <emphasis role="strong">API Version</emphasis> field:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Tenant Name</emphasis>: Appears only when v2 is selected from the <emphasis role="strong">API Version</emphasis> field. The name of the OpenStack tenant of which the OpenStack Networking instance is a member.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">OpenStack Volume</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Center</emphasis>: The data center to which OpenStack Volume storage volumes will be attached.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Provider URL</emphasis>: The URL or fully qualified domain name of the machine on which the OpenStack Volume instance is hosted. You must add the port number for the OpenStack Volume instance to the end of the URL or fully qualified domain name. By default, this port number is 8776.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required to access the OpenStack Volume service.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the Keystone server. This user name must be the user name for OpenStack Volume registered in the Keystone instance of which the OpenStack Volume instance is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated. This password must be the password for OpenStack Volume registered in the Keystone instance of which the OpenStack Volume instance is a member.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Protocol</emphasis>: The protocol used to communicate with the Keystone server. This must be set to <literal>HTTP</literal>.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Hostname</emphasis>: The IP address or hostname of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API port</emphasis>: The API port number of the Keystone server.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">API Version</emphasis>: The version of the Keystone server.  The value is <literal>v2.0</literal> and the field is disabled.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Tenant Name</emphasis>: The name of the OpenStack tenant of which the OpenStack Volume instance is a member.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">VMware</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Center</emphasis>: Specify the data center into which VMware virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to specify the destination data center during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">vCenter</emphasis>: The IP address or fully qualified domain name of the VMware vCenter instance.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">ESXi</emphasis>: The IP address or fully qualified domain name of the host from which the virtual machines will be imported.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Data Center</emphasis>: The name of the data center in which the specified ESXi host resides.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Cluster</emphasis>: The name of the cluster in which the specified ESXi host resides.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Verify server&#8217;s SSL certificate</emphasis>: Specify whether the ESXi host&#8217;s certificate will be verified on connection.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Proxy Host</emphasis>: Select a host in the chosen data center with <literal>virt-v2v</literal> installed to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the VMware vCenter external provider. If you selected <emphasis role="strong">Any Data Center</emphasis>, you cannot choose the host here, but can specify a host during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the VMware vCenter instance. The user must have access to the VMware data center and ESXi host on which the virtual machines reside.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">RHEL 5 Xen</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Center</emphasis>: Specify the data center into which Xen virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to instead specify the destination data center during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">URI</emphasis>: The URI of the RHEL 5 Xen host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Proxy Host</emphasis>: Select a host in the chosen data center with <literal>virt-v2v</literal> installed to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the RHEL 5 Xen external provider. If you selected <emphasis role="strong">Any Data Center</emphasis>, you cannot choose the host here, but instead can specify a host during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">KVM</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Data Center</emphasis>: Specify the data center into which KVM virtual machines will be imported, or select <emphasis role="strong">Any Data Center</emphasis> to instead specify the destination data center during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">URI</emphasis>: The URI of the KVM host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Proxy Host</emphasis>: Select a host in the chosen data center to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the KVM external provider. If you selected <emphasis role="strong">Any Data Center</emphasis>, you cannot choose the host here, but instead can specify a host during individual import operations (using the <emphasis role="strong">Import</emphasis> function in the <emphasis role="strong">Virtual Machines</emphasis> tab).</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Requires Authentication</emphasis>: Allows you to specify whether authentication is required to access the KVM host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Username</emphasis>: A user name for connecting to the KVM host.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Password</emphasis>: The password against which the above user name is to be authenticated.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Test</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allows users to test the specified credentials. This button is available to all provider types.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
</section>
<section xml:id="Editing_an_External_Provider">
<title>Editing an External Provider</title>
<simpara><emphasis role="strong">Editing an External Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice> and select the external provider to edit.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Change the current values for the provider to the preferred values.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_an_External_Provider">
<title>Removing an External Provider</title>
<simpara><emphasis role="strong">Removing an External Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice> and select the external provider to remove.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</chapter>
</part>
<part xml:id="part-Administering_the_Environment">
<title>Administering the Environment</title>
<chapter xml:id="chap-Administering_the_Self-Hosted_Engine">
<title>Administering the Self-Hosted Engine</title>
<section xml:id="Maintaining_the_Self-Hosted_Engine">
<title>Maintaining the Self-hosted engine</title>
<section xml:id="Self-hosted_engine_maintenance_modes_explained_SHE_admin">
<title>Self-hosted engine maintenance modes explained</title>
<simpara>The maintenance modes enable you to start, stop, and modify the Engine virtual machine without interference from the high-availability agents, and to restart and modify the self-hosted engine nodes in the environment without interfering with the Engine.</simpara>
<simpara>There are three maintenance modes:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>global</literal> - All high-availability agents in the cluster are disabled from monitoring the state of the Engine virtual machine. The global maintenance mode must be applied for any setup or upgrade operations that require the <literal>ovirt-engine</literal> service to be stopped, such as upgrading to a later version of oVirt.</simpara>
</listitem>
<listitem>
<simpara><literal>local</literal> - The high-availability agent on the node issuing the command is disabled from monitoring the state of the Engine virtual machine. The node is exempt from hosting the Engine virtual machine while in local maintenance mode; if hosting the Engine virtual machine when placed into this mode, the Engine will migrate to another node, provided there is one available. The local maintenance mode is recommended when applying system changes or updates to a self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara><literal>none</literal> - Disables maintenance mode, ensuring that the high-availability agents are operating.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="local-maintenance-mode_SHE_admin">
<title>Setting local maintenance mode</title>
<simpara>Enabling local maintenance mode stops the high-availability agent on a single self-hosted engine node.</simpara>
<orderedlist numeration="arabic">
<title>Setting the local maintenance mode from the Administration Portal</title>
<listitem>
<simpara>Put a self-hosted engine node into local maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select a self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>. Local maintenance mode is automatically triggered for that node.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>After you have completed any maintenance tasks, disable the maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Setting the local maintenance mode from the command line</title>
<listitem>
<simpara>Log in to a self-hosted engine node and put it into local maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=local</screen>
</listitem>
<listitem>
<simpara>After you have completed any maintenance tasks, disable the maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="global-maintenance-mode_SHE_admin">
<title>Setting global maintenance mode</title>
<simpara>Enabling global maintenance mode stops the high-availability agents on all self-hosted engine nodes in the cluster.</simpara>
<orderedlist numeration="arabic">
<title>Setting the global maintenance mode from the Administration Portal</title>
<listitem>
<simpara>Put all of the self-hosted engine nodes into global maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select any self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Enable Global HA Maintenance</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>After you have completed any maintenance tasks, disable the maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select any self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">More Actions</emphasis> (<inlinemediaobject>
<imageobject>
<imagedata fileref="common/images/moreactions.png"/>
</imageobject>
<textobject><phrase>moreactions</phrase></textobject>
</inlinemediaobject>), then click <emphasis role="strong">Disable Global HA Maintenance</emphasis>.</simpara>
</listitem>
</orderedlist>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Setting the global maintenance mode from the command line</title>
<listitem>
<simpara>Log in to any self-hosted engine node and put it into global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>After you have completed any maintenance tasks, disable the maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Administering_the_Manager_Virtual_Machine">
<title>Administering the Engine Virtual Machine</title>
<simpara>The <literal>hosted-engine</literal> utility provides many commands to help administer the Engine virtual machine. You can run <literal>hosted-engine</literal> on any self-hosted engine node. To see all available commands, run <literal>hosted-engine --help</literal>. For additional information on a specific command, run <literal>hosted-engine --<emphasis>command</emphasis> --help</literal>.</simpara>
<section xml:id="_updating_the_self_hosted_engine_configuration">
<title>Updating the Self-Hosted Engine Configuration</title>
<simpara>To update the self-hosted engine configuration, use the <literal>hosted-engine --set-shared-config</literal> command. This command updates the self-hosted engine configuration on the shared storage domain after the initial deployment.</simpara>
<simpara>To see the current configuration values, use the <literal>hosted-engine --get-shared-config</literal> command.</simpara>
<simpara>To see a list of all available configuration keys and their corresponding types, enter the following command:</simpara>
<screen># hosted-engine --set-shared-config <emphasis>key</emphasis> --type=<emphasis>type</emphasis> --help</screen>
<simpara>Where <literal><emphasis>type</emphasis></literal> is one of the following:</simpara>
<informaltable tabstyle="horizontal" frame="none" colsep="0" rowsep="0">
<tgroup cols="2">
<colspec colwidth="15*"/>
<colspec colwidth="85*"/>
<tbody valign="top">
<row>
<entry>
<simpara><literal>he_local</literal></simpara>
</entry>
<entry>
<simpara>Sets values in the local instance of <literal role="filename">etc/ovirt-hosted-engine/hosted-engine.conf</literal> on the local host, so only that host uses the new values. To enable the new value, restart the ovirt-ha-agent and ovirt-ha-broker services.</simpara>
</entry>
</row>
<row>
<entry>
<simpara><literal>he_shared</literal></simpara>
</entry>
<entry>
<simpara>Sets values in <literal role="filename">etc/ovirt-hosted-engine/hosted-engine.conf</literal> on shared storage, so all hosts that are deployed after a configuration change use these values. To enable the new value on a host, redeploy that host.</simpara>
</entry>
</row>
<row>
<entry>
<simpara><literal>ha</literal></simpara>
</entry>
<entry>
<simpara>Sets values in <literal role="filename">/var/lib/ovirt-hosted-engine-ha/ha.conf</literal> on local storage. New settings take effect immediately.</simpara>
</entry>
</row>
<row>
<entry>
<simpara><literal>broker</literal></simpara>
</entry>
<entry>
<simpara>Sets values in <literal role="filename">/var/lib/ovirt-hosted-engine-ha/broker.conf</literal> on local storage. Restart the ovirt-ha-broker service to enable new settings.</simpara>
</entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section xml:id="_configuring_email_notifications">
<title>Configuring Email Notifications</title>
<simpara>You can configure email notifications using SMTP for any HA state transitions on the self-hosted engine nodes. The keys that can be updated include: <literal>smtp-server</literal>, <literal>smtp-port</literal>, <literal>source-email</literal>, <literal>destination-emails</literal>, and <literal>state_transition</literal>.</simpara>
<simpara><emphasis role="strong">To configure email notifications:</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On a self-hosted engine node, set the <literal>smtp-server</literal> key to the desired SMTP server address:</simpara>
<screen># hosted-engine --set-shared-config smtp-server <emphasis>smtp.example.com</emphasis> --type=broker</screen>
<note>
<simpara>To verify that the self-hosted engine configuration file has been updated, run:</simpara>
<screen># hosted-engine --get-shared-config smtp-server --type=broker
broker : smtp.example.com, type : broker</screen>
</note>
</listitem>
<listitem>
<simpara>Check that the default SMTP port (port 25) has been configured:</simpara>
<screen># hosted-engine --get-shared-config smtp-port --type=broker
broker : 25, type : broker</screen>
</listitem>
<listitem>
<simpara>Specify an email address you want the SMTP server to use to send out email notifications. Only one address can be specified.</simpara>
<screen># hosted-engine --set-shared-config source-email <emphasis>source@example.com</emphasis> --type=broker</screen>
</listitem>
<listitem>
<simpara>Specify the destination email address to receive email notifications. To specify multiple email addresses, separate each address by a comma.</simpara>
<screen># hosted-engine --set-shared-config destination-emails <emphasis>destination1@example.com</emphasis>,<emphasis>destination2@example.com</emphasis> --type=broker</screen>
</listitem>
</orderedlist>
<simpara>To verify that SMTP has been properly configured for your self-hosted engine environment, change the HA state on a self-hosted engine node and check if email notifications were sent. For example, you can change the HA state by placing HA agents into maintenance mode. See <xref linkend="Maintaining_the_Self-Hosted_Engine"/> for more information.</simpara>
</section>
</section>
<section xml:id="Configuring_Memory_Slots_Reserved_for_the_SHE">
<title>Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</title>
<simpara>If the Engine virtual machine shuts down or needs to be migrated, there must be enough memory on a self-hosted engine node for the Engine virtual machine to restart on or migrate to it. This memory can be reserved on multiple self-hosted engine nodes by using a scheduling policy. The scheduling policy checks if enough memory to start the Engine virtual machine will remain on the specified number of additional self-hosted engine nodes before starting or migrating any virtual machines. See <link xl:href="https://ovirt.org/documentation/administration_guide/index#Creating_a_Scheduling_Policy">Creating a Scheduling Policy</link> in the <emphasis>Administration Guide</emphasis> for more information about scheduling policies.</simpara>
<simpara>To add more self-hosted engine nodes to the oVirt Engine, see <xref linkend="Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin"/>.</simpara>
<simpara><emphasis role="strong">Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice> and select the cluster containing the self-hosted engine nodes.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>Edit</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Scheduling Policy</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>+</guibutton> and select <emphasis role="strong">HeSparesCount</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Enter the number of additional self-hosted engine nodes that will reserve enough free memory to start the Engine virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">
<title>Adding Self-Hosted Engine Nodes to the oVirt Engine</title>
<simpara>Add self-hosted engine nodes in the same way as a standard host, with an additional step to deploy the host as a self-hosted engine node. The shared storage domain is automatically detected and the node can be used as a failover host to host the Engine virtual machine when required. You can also attach standard hosts to a self-hosted engine environment, but they cannot host the Engine virtual machine. Have at least two self-hosted engine nodes to ensure the Engine virtual machine is highly available. You can also add additional hosts using the REST API. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-hosts">Hosts</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>All self-hosted engine nodes must be in the same cluster.</simpara>
</listitem>
<listitem>
<simpara>If you are reusing a self-hosted engine node, remove its existing self-hosted engine configuration. See <link xl:href="https://ovirt.org/documentation/administration_guide/index#removing_a_host_from_a_self-hosted_engine_environment">Removing a Host from a Self-Hosted Engine Environment</link>.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>New</guibutton>.</simpara>
<simpara>For information on additional host settings, see <link xl:href="https://ovirt.org/documentation/administration_guide#sect-Explanation_of_Settings_and_Controls_in_the_New_Host_and_Edit_Host_Windows">Explanation of Settings and Controls in the New Host and Edit Host Windows</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the drop-down list to select the <emphasis role="strong">Data Center</emphasis> and <emphasis role="strong">Host Cluster</emphasis> for the new host.</simpara>
</listitem>
<listitem>
<simpara>Enter the <emphasis role="strong">Name</emphasis> and the <emphasis role="strong">Address</emphasis> of the new host. The standard SSH port, port 22, is auto-filled in the <emphasis role="strong">SSH Port</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Select an authentication method to use for the Engine to access the host.</simpara>
<itemizedlist>
<listitem>
<simpara>Enter the root user&#8217;s password to use password authentication.</simpara>
</listitem>
<listitem>
<simpara>Alternatively, copy the key displayed in the <emphasis role="strong">SSH PublicKey</emphasis> field to <emphasis role="strong">/root/.ssh/authorized_keys</emphasis> on the host to use public key authentication.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Optionally, configure power management, where the host has a supported power management card. For information on power management configuration, see <link xl:href="https://ovirt.org/documentation/administration_guide#Host_Power_Management_settings_explained">Host Power Management Settings Explained</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosted Engine</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Deploy</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Reinstalling_an_Existing_Host_as_a_Self-Hosted_Engine_Node_SHE_admin">
<title>Reinstalling an Existing Host as a Self-Hosted Engine Node</title>
<simpara>You can convert an existing, standard host in a self-hosted engine environment to a self-hosted engine node capable of hosting the Engine virtual machine.</simpara>
<warning>
<simpara>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</simpara>
</warning>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosted Engine</emphasis> tab and select <emphasis role="strong">DEPLOY</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The host is reinstalled with self-hosted engine configuration, and is flagged with a crown icon in the Administration Portal.</simpara>
</section>
<section xml:id="Booting_a_Self-Hosted_Engine_in_Rescue_Mode_SHE_admin">
<title>Booting the Engine Virtual Machine in Rescue Mode</title>
<simpara>This topic describes how to boot the Engine virtual machine into rescue mode when it does not start. For more information, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-working_with_the_grub_2_boot_loader#sec-Terminal_Menu_Editing_During_Boot">Booting to Rescue Mode</link> in the <emphasis>Enterprise Linux System Administrator&#8217;s Guide</emphasis>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Connect to one of the hosted-engine nodes:</simpara>
<screen>$ ssh root@<emphasis>host_address</emphasis></screen>
</listitem>
<listitem>
<simpara>Put the self-hosted engine in global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>Check if there is already a running instance of the Engine virtual machine:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>If a Engine virtual machine instance is running, connect to its host:</simpara>
<screen># ssh root@<emphasis>host_address</emphasis></screen>
</listitem>
<listitem>
<simpara>Shut down the virtual machine:</simpara>
<screen># hosted-engine --vm-shutdown</screen>
<note>
<simpara>If the virtual machine does not shut down, execute the following command:</simpara>
<screen># hosted-engine --vm-poweroff</screen>
</note>
</listitem>
<listitem>
<simpara>Start the Engine virtual machine in pause mode:</simpara>
<screen>hosted-engine --vm-start-paused</screen>
</listitem>
<listitem>
<simpara>Set a temporary VNC password:</simpara>
<screen>hosted-engine --add-console-password</screen>
<simpara>The command outputs the necessary information you need to log in to the Manger virtual machine with VNC.</simpara>
</listitem>
<listitem>
<simpara>Log in to the Engine virtual machine with VNC. The Engine virtual machine is still paused, so it appears to be frozen.</simpara>
</listitem>
<listitem>
<simpara>Resume the Engine virtual machine with the following command on its host:</simpara>
<warning>
<simpara>After running the following command, the boot loader menu appears. You need to enter into rescue mode before the boot loader proceeds with the normal boot process. Read the next step about entering into rescue mode before proceeding with this command.</simpara>
</warning>
<screen># /usr/bin/virsh -c qemu:///system?authfile=/etc/ovirt-hosted-engine/virsh_auth.conf resume HostedEngine</screen>
</listitem>
<listitem>
<simpara>Boot the Engine virtual machine in rescue mode.</simpara>
</listitem>
<listitem>
<simpara>Disable global maintenance mode</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
</listitem>
</orderedlist>
<simpara>You can now run rescue tasks on the Engine virtual machine.</simpara>
</section>
<section xml:id="Removing_a_Host_from_a_Self-Hosted_Engine_Environment">
<title>Removing a Host from a Self-Hosted Engine Environment</title>
<simpara>To remove a self-hosted engine node from your environment, place the node into maintenance mode, undeploy the node, and optionally remove it. The node can be managed as a regular host after the HA services have been stopped, and the self-hosted engine configuration files have been removed.</simpara>
<simpara><emphasis role="strong">Removing a Host from a Self-Hosted Engine Environment</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the self-hosted engine node.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosted Engine</emphasis> tab and select <emphasis role="strong">UNDEPLOY</emphasis> from the drop-down list. This action stops the <literal>ovirt-ha-agent</literal> and <literal>ovirt-ha-broker</literal> services and removes the self-hosted engine configuration file.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Optionally, click <guibutton>Remove</guibutton>. This opens the <emphasis role="strong">Remove Host(s)</emphasis> confirmation window.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Updating_a_self-hosted_engine_SHE_admin">
<title>Updating a Self-Hosted Engine</title>
<simpara>To update a self-hosted engine from your current version to the latest version, you must place the environment in global maintenance mode and then follow the standard procedure for updating between minor versions.</simpara>
<bridgehead xml:id="Enabling_Global_Maintenance_Mode_SHE_minor_updates" renderas="sect3">Enabling global maintenance mode</bridgehead>
<simpara>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the Engine virtual machine.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>Confirm that the environment is in global maintenance mode before proceeding:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>You should see a message indicating that the cluster is in global maintenance mode.</simpara>
</listitem>
</orderedlist>
<bridgehead xml:id="Updating_the_Red_Hat_Virtualization_Manager_SHE_minor_updates" renderas="sect3">Updating the oVirt Engine</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On the Engine machine, check if updated packages are available:</simpara>
<screen># engine-upgrade-check</screen>
</listitem>
<listitem>
<simpara>Update the setup packages:</simpara>
<screen># yum update ovirt\*setup\*</screen>
</listitem>
<listitem>
<simpara>Update the oVirt Engine with the <literal>engine-setup</literal> script. The <literal>engine-setup</literal> script prompts you with some configuration questions, then stops the <literal>ovirt-engine</literal> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <literal>ovirt-engine</literal> service.</simpara>
<screen># engine-setup</screen>
<simpara>When the script completes successfully, the following message appears:</simpara>
<screen>Execution of setup completed successfully</screen>
<note>
<simpara>The <literal>engine-setup</literal> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <literal>engine-config</literal> was used to update configuration after installation. For example, if <literal>engine-config</literal> was used to update <literal>SANWipeAfterDelete</literal> to <literal>true</literal> after installation, <literal>engine-setup</literal> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <literal>engine-setup</literal>.</simpara>
</note>
<important>
<simpara>The update process might take some time. Do not stop the process before it completes.</simpara>
</important>
</listitem>
<listitem>
<simpara>Update the base operating system and any optional packages installed on the Engine:</simpara>
<screen># yum update</screen>
<important>
<simpara>If you encounter a required Ansible package conflict during the update, see <link xl:href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</link>.</simpara>
</important>
<important>
<simpara>If any kernel packages were updated:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Disable global maintenance mode</simpara>
</listitem>
<listitem>
<simpara>Reboot the machine to complete the update.</simpara>
</listitem>
</orderedlist>
</important>
</listitem>
</orderedlist>
<formalpara>
<title>Related Information</title>
<para><link linkend="Disabling_Global_Maintenance_Mode_SHE_minor_updates">Disabling global maintenance mode</link></para>
</formalpara>
<bridgehead xml:id="Disabling_Global_Maintenance_Mode_SHE_minor_updates" renderas="sect3">Disabling global maintenance mode</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Engine virtual machine and shut it down.</simpara>
</listitem>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes
and disable global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
<simpara>When you exit global maintenance mode, ovirt-ha-agent starts the Engine virtual machine, and then the Engine automatically starts. It can take up to ten minutes for the Engine to start.</simpara>
</listitem>
<listitem>
<simpara>Confirm that the environment is running:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>The listed information includes <emphasis role="strong">Engine Status</emphasis>. The value for <emphasis role="strong">Engine status</emphasis> should be:</simpara>
<screen>{"health": "good", "vm": "up", "detail": "Up"}</screen>
<note>
<simpara>When the virtual machine is still booting and the Engine hasn&#8217;t started yet, the <emphasis role="strong">Engine status</emphasis> is:</simpara>
<screen>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</screen>
<simpara>If this happens, wait a few minutes and try again.</simpara>
</note>
</listitem>
</orderedlist>
</section>
<section xml:id="Changing_FQDN_of_RHVM_self-hosted_engine">
<title>Changing the FQDN of the Engine in a Self-Hosted Engine</title>
<simpara>You can use the <literal>ovirt-engine-rename</literal> command to update records of the fully qualified domain name (FQDN) of the Engine.</simpara>
<simpara>For details see <xref linkend="Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool"/>.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Backups_and_Migration">
<title>Backups and Migration</title>
<section xml:id="sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">
<title>Backing Up and Restoring the oVirt Engine</title>
<section xml:id="Backing_up_Red_Hat_Enterprise_Virtualization_Manager_using_the_engine-backup_Command">
<title>Backing up oVirt Engine - Overview</title>
<simpara>Use the <literal>engine-backup</literal> tool to take regular backups of the oVirt Engine. The tool backs up the engine database and configuration files into a single file and can be run without interrupting the <literal>ovirt-engine</literal> service.</simpara>
</section>
<section xml:id="Syntax_for_the_engine-backup_Command">
<title>Syntax for the engine-backup Command</title>
<simpara>The <literal>engine-backup</literal> command works in one of two basic modes:</simpara>
<screen># engine-backup --mode=backup</screen>
<screen># engine-backup --mode=restore</screen>
<simpara>These two modes are further extended by a set of parameters that allow you to specify the scope of the backup and different credentials for the engine database. Run <literal>engine-backup --help</literal> for a full list of parameters and their function.</simpara>
<simpara><emphasis role="strong">Basic Options</emphasis></simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>--mode</literal></emphasis></term>
<listitem>
<simpara>Specifies whether the command will perform a backup operation or a restore operation. Two options are available - <literal>backup</literal>, and <literal>restore</literal>. This is a required parameter.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--file</literal></emphasis></term>
<listitem>
<simpara>Specifies the path and name of a file into which backups are to be taken in backup mode, and the path and name of a file from which to read backup data in restore mode. This is a required parameter in both backup mode and restore mode.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--log</literal></emphasis></term>
<listitem>
<simpara>Specifies the path and name of a file into which logs of the backup or restore operation are to be written. This parameter is required in both backup mode and restore mode.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--scope</literal></emphasis></term>
<listitem>
<simpara>Specifies the scope of the backup or restore operation. There are four options: <literal>all</literal>, which backs up or restores all databases and configuration data; <literal>files</literal>, which backs up or restores only files on the system; <literal>db</literal>, which backs up or restores only the Engine database; and <literal>dwhdb</literal>, which backs up or restores only the Data Warehouse database. The default scope is <literal>all</literal>.</simpara>
<simpara>The <literal>--scope</literal> parameter can be specified multiple times in the same <literal>engine-backup</literal> command.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><emphasis role="strong">Engine Database Options</emphasis></simpara>
<simpara>The following options are only available when using the <literal>engine-backup</literal> command in <literal>restore</literal> mode. The option syntax below applies to restoring the Engine database. The same options exist for restoring the Data Warehouse database. See <literal>engine-backup --help</literal> for the Data Warehouse option syntax.</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>--provision-db</literal></emphasis></term>
<listitem>
<simpara>Creates a PostgreSQL database for the Engine database backup to be restored to. This is a required parameter when restoring a backup on a remote host or fresh installation that does not have a PostgreSQL database already configured.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--change-db-credentials</literal></emphasis></term>
<listitem>
<simpara>Allows you to specify alternate credentials for restoring the Engine database using credentials other than those stored in the backup itself. See <literal>engine-backup --help</literal> for the additional parameters required by this parameter.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--restore-permissions</literal> or <literal>--no-restore-permissions</literal></emphasis></term>
<listitem>
<simpara>Restores (or does not restore) the permissions of database users. One of these parameters is required when restoring a backup.</simpara>
<note>
<simpara>If a backup contains grants for extra database users, restoring the backup with the <literal>--restore-permissions</literal> and <literal>--provision-db</literal> (or <literal>--provision-dwh-db</literal>) options will create the extra users with random passwords. You must change these passwords manually if the extra users require access to the restored system. See <link xl:href="https://access.redhat.com/articles/2686731">https://access.redhat.com/articles/2686731</link>.</simpara>
</note>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Creating_a_Backup_with_the_engine-backup_Command">
<title>Creating a backup with the engine-backup command</title>
<simpara>You can back up the oVirt Engine with the <literal role="command">engine-backup</literal> command while the Engine is active. Append one of the following values to the <literal>--scope</literal> option to specify what you want to back up:</simpara>
<variablelist>
<varlistentry>
<term><literal>all</literal></term>
<listitem>
<simpara>A full backup of all databases and configuration files on the Engine</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>files</literal></term>
<listitem>
<simpara>A backup of only the files on the system</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>db</literal></term>
<listitem>
<simpara>A backup of only the Engine database</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>dwhdb</literal></term>
<listitem>
<simpara>A backup of only the Data Warehouse database</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>cinderlibdb</literal></term>
<listitem>
<simpara>A backup of only the Cinderlib database</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><literal>grafanadb</literal></term>
<listitem>
<simpara>A backup of only the Grafana database</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara>You can specify the <literal>--scope</literal> option more than once.</simpara>
<simpara>You can also configure the <literal role="command">engine-backup</literal> command to back up additional files. It restores everything that it backs up.</simpara>
<important>
<simpara>To restore a database to a fresh installation of oVirt Engine, a database backup alone is not sufficient. The Engine also requires access to the configuration files. If you specify a scope other than <literal>all</literal>, you must also include <literal>--scope=files</literal>, or back up the file system.</simpara>
</important>
<simpara>For a complete explanation of the <literal role="command">engine-backup</literal> command, enter <literal>engine-backup --help</literal> on the Engine machine.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log on to the Engine machine.</simpara>
</listitem>
<listitem>
<simpara>Create a backup:</simpara>
<screen># engine-backup --scope=all --mode=backup --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</listitem>
</orderedlist>
<simpara>The command generates the backup in <literal><emphasis>file_name</emphasis>.tar</literal>, and a log file in <literal><emphasis>log_file_name</emphasis></literal>.</simpara>
<simpara>Use <literal><emphasis>file_name</emphasis>.tar</literal> to restore the environment.</simpara>
<simpara>The following examples demonstrate several different backup scenarios.</simpara>
<example>
<title>Full backup</title>
<screen># engine-backup --scope=all --mode=backup --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</example>
<example>
<title>Engine database backup</title>
<screen># engine-backup --scope=files --scope=db --mode=backup --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</example>
<example>
<title>Data Warehouse database backup</title>
<screen># engine-backup --scope=files --scope=dwhdb --mode=backup --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</example>
<example>
<title>Adding specific files to the backup</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Make a directory to store configuration customizations for the <literal role="command">engine-backup</literal> command:</simpara>
<screen># mkdir -p /etc/ovirt-engine-backup/engine-backup-config.d</screen>
</listitem>
<listitem>
<simpara>Create a text file in the new directory named <literal>ntp-chrony.sh</literal> with the following contents:</simpara>
<screen>BACKUP_PATHS="${BACKUP_PATHS}
/etc/chrony.conf
/etc/ntp.conf
/etc/ovirt-engine-backup"</screen>
</listitem>
<listitem>
<simpara>When you run the <literal role="command">engine-backup</literal> command, use <literal>--scope=files</literal>. The backup and restore includes <literal>/etc/chrony.conf</literal>, <literal>/etc/ntp.conf</literal>, and <literal>/etc/ovirt-engine-backup</literal>.</simpara>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="Restoring_a_Backup_with_the_engine-backup_Command">
<title>Restoring a Backup with the engine-backup Command</title>
<simpara>Restoring a backup using the engine-backup command involves more steps than creating a backup does, depending on the restoration destination. For example, the <literal>engine-backup</literal> command can be used to restore backups to fresh installations of oVirt, on top of existing installations of oVirt, and using local or remote databases.</simpara>
<important>
<simpara>Backups can only be restored to environments of the same major release as that of the backup. For example, a backup of a oVirt version 4.2 environment can only be restored to another oVirt version 4.2 environment. To view the version of oVirt contained in a backup file, unpack the backup file and read the value in the <emphasis role="strong">version</emphasis> file located in the root directory of the unpacked files.</simpara>
</important>
</section>
<section xml:id="Restoring_a_Backup_to_a_Fresh_Installation">
<title>Restoring a Backup to a Fresh Installation</title>
<simpara>The <literal>engine-backup</literal> command can be used to restore a backup to a fresh installation of the oVirt Engine. The following procedure must be performed on a machine on which the base operating system has been installed and the required packages for the oVirt Engine have been installed, but the <literal>engine-setup</literal> command has not yet been run. This procedure assumes that the backup file or files can be accessed from the machine on which the backup is to be restored.</simpara>
<simpara><emphasis role="strong">Restoring a Backup to a Fresh Installation</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log on to the Engine machine. If you are restoring the engine database to a remote host, you will need to log on to and perform the relevant actions on that host. Likewise, if also restoring the Data Warehouse to a remote host, you will need to log on to and perform the relevant actions on that host.</simpara>
</listitem>
<listitem>
<simpara>Restore a complete backup or a database-only backup.</simpara>
<itemizedlist>
<listitem>
<simpara>Restore a complete backup:</simpara>
<screen># engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --provision-db --restore-permissions</screen>
<simpara>If Data Warehouse is also being restored as part of the complete backup, provision the additional database:</simpara>
<screen>engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --provision-db --provision-dwh-db --restore-permissions</screen>
</listitem>
<listitem>
<simpara>Restore a database-only backup by restoring the configuration files and database backup:</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=db --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --provision-db --restore-permissions</screen>
<simpara>The example above restores a backup of the Engine database.</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --provision-dwh-db --restore-permissions</screen>
<simpara>The example above restores a backup of the Data Warehouse database.</simpara>
<simpara>If successful, the following output displays:</simpara>
<screen>You should now run engine-setup.
Done.</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Run the following command and follow the prompts to configure the restored Engine:</simpara>
<screen># engine-setup</screen>
</listitem>
</orderedlist>
<simpara>The oVirt Engine has been restored to the version preserved in the backup. To change the fully qualified domain name of the new oVirt system, see <xref linkend="The_oVirt_Engine_Rename_Tool"/>.</simpara>
</section>
<section xml:id="Restoring_a_Backup_to_Overwrite_an_Existing_Installation_RHV_backup_restore">
<title>Restoring a Backup to Overwrite an Existing Installation</title>
<simpara>The <literal>engine-backup</literal> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up. This is useful when you have taken a backup of an environment, performed changes on that environment, and then want to undo the changes by restoring the environment from the backup.</simpara>
<simpara>Changes made to the environment since the backup was taken, such as adding or removing a host, will not appear in the restored environment. You must redo these changes.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Engine machine.</simpara>
</listitem>
<listitem>
<simpara>Remove the configuration files and clean the database associated with the Engine:</simpara>
<screen># engine-cleanup</screen>
<simpara>The <literal>engine-cleanup</literal> command only cleans the Engine database; it does not drop the database or delete the user that owns that database.</simpara>
</listitem>
<listitem>
<simpara>Restore a full backup or a database-only backup. You do not need to create a new database or specify the database credentials because the user and database already exist.</simpara>
<itemizedlist>
<listitem>
<simpara>Restore a full backup:</simpara>
<screen># engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --restore-permissions</screen>
</listitem>
<listitem>
<simpara>Restore a database-only backup by restoring the configuration files and the database backup:</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=db --scope=dwhdb --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --restore-permissions</screen>
<note>
<simpara>To restore only the Engine database (for example, if the Data Warehouse database is located on another machine), you can omit the <literal>--scope=dwhdb</literal> parameter.</simpara>
</note>
<simpara>If successful, the following output displays:</simpara>
<screen>You should now run engine-setup.
Done.</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Reconfigure the Engine:</simpara>
<screen># engine-setup</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Restoring_a_Backup_with_Different_Credentials">
<title>Restoring a Backup with Different Credentials</title>
<simpara>The <literal>engine-backup</literal> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up, but the credentials of the database in the backup are different to those of the database on the machine on which the backup is to be restored. This is useful when you have taken a backup of an installation and want to restore the installation from the backup to a different system.</simpara>
<important>
<simpara>When restoring a backup to overwrite an existing installation, you must run the <literal>engine-cleanup</literal> command to clean up the existing installation before using the <literal>engine-backup</literal> command. The <literal>engine-cleanup</literal> command only cleans the engine database, and does not drop the database or delete the user that owns that database. So you do not need to create a new database or specify the database credentials. However, if the credentials for the owner of the engine database are not known, you must change them before you can restore the backup.</simpara>
</important>
<simpara><emphasis role="strong">Restoring a Backup with Different Credentials</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the oVirt Engine machine.</simpara>
</listitem>
<listitem>
<simpara>Run the following command and follow the prompts to remove the Engine&#8217;s configuration files and to clean the Engine&#8217;s database:</simpara>
<screen># engine-cleanup</screen>
</listitem>
<listitem>
<simpara>Change the password for the owner of the <literal>engine</literal> database if the credentials of that user are not known:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Enter the postgresql command line:</simpara>
<screen># su - postgres -c 'psql'</screen>
</listitem>
<listitem>
<simpara>Change the password of the user that owns the <literal>engine</literal> database:</simpara>
<screen>postgres=# alter role <emphasis>user_name</emphasis> encrypted password '<emphasis>new_password</emphasis>';</screen>
<simpara>Repeat this for the user that owns the <literal>ovirt_engine_history</literal> database if necessary.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Restore a complete backup or a database-only backup with the <literal>--change-db-credentials</literal> parameter to pass the credentials of the new database. The <emphasis>database_location</emphasis> for a database local to the Engine is <literal>localhost</literal>.</simpara>
<note>
<simpara>The following examples use a <literal>--*password</literal> option for each database without specifying a password, which prompts for a password for each database. Alternatively, you can use <literal>--*passfile=<emphasis>password_file</emphasis></literal> options for each database to securely pass the passwords to the <literal>engine-backup</literal> tool without the need for interactive prompts.</simpara>
</note>
<itemizedlist>
<listitem>
<simpara>Restore a complete backup:</simpara>
<screen># engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --change-db-credentials --db-host=<emphasis>database_location</emphasis> --db-name=<emphasis>database_name</emphasis> --db-user=engine --db-password --no-restore-permissions</screen>
<simpara>If Data Warehouse is also being restored as part of the complete backup, include the revised credentials for the additional database:</simpara>
<screen>engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --change-db-credentials --db-host=<emphasis>database_location</emphasis> --db-name=<emphasis>database_name</emphasis> --db-user=engine --db-password --change-dwh-db-credentials --dwh-db-host=<emphasis>database_location</emphasis> --dwh-db-name=<emphasis>database_name</emphasis> --dwh-db-user=ovirt_engine_history --dwh-db-password --no-restore-permissions</screen>
</listitem>
<listitem>
<simpara>Restore a database-only backup by restoring the configuration files and the database backup:</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=db --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --change-db-credentials --db-host=<emphasis>database_location</emphasis> --db-name=<emphasis>database_name</emphasis> --db-user=engine --db-password --no-restore-permissions</screen>
<simpara>The example above restores a backup of the Engine database.</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --change-dwh-db-credentials --dwh-db-host=<emphasis>database_location</emphasis> --dwh-db-name=<emphasis>database_name</emphasis> --dwh-db-user=ovirt_engine_history --dwh-db-password --no-restore-permissions</screen>
<simpara>The example above restores a backup of the Data Warehouse database.</simpara>
<simpara>If successful, the following output displays:</simpara>
<screen>You should now run engine-setup.
Done.</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Run the following command and follow the prompts to reconfigure the firewall and ensure the <literal>ovirt-engine</literal> service is correctly configured:</simpara>
<screen># engine-setup</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Backing_up_and_Restoring_a_Self-hosted_Engine">
<title>Backing up and Restoring a Self-Hosted Engine</title>
<simpara>You can back up a self-hosted engine and restore it in a new self-hosted environment. Use this procedure for tasks such as migrating the environment to a new self-hosted engine storage domain with a different storage type.</simpara>
<simpara>When you specify a backup file during deployment, the backup is restored on a new Engine virtual machine, with a new self-hosted engine storage domain. The old Engine is removed, and the old self-hosted engine storage domain is renamed and can be manually removed after you confirm that the new environment is working correctly. Deploying on a fresh host is highly recommended; if the host used for deployment existed in the backed up environment, it will be removed from the restored database to avoid conflicts in the new environment. If you deploy on a new host, you must assign a unique name to the host. Reusing the name of an existing host included in the backup can cause conflicts in the new environment.</simpara>
<simpara>The backup and restore operation involves the following key actions:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Backing_up_the_Original_Manager_SHE_backup_restore">Back up the original Engine using the <literal>engine-backup</literal> tool.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_backup_restore">Deploy a new self-hosted engine and restore the backup.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_backup_restore">Enable the Engine repositories on the new Engine virtual machine.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Reinstalling_Hosts_SHE_backup_restore">Reinstall the self-hosted engine nodes to update their configuration.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Removing_a_Storage_Domain_SHE_backup_restore">Remove the old self-hosted engine storage domain.</link></simpara>
</listitem>
</orderedlist>
<simpara>This procedure assumes that you have access and can make changes to the original Engine.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>A fully qualified domain name prepared for your Engine and the host. Forward and reverse lookup records must both be set in the DNS. The new Engine must have the same fully qualified domain name as the original Engine.</simpara>
</listitem>
<listitem>
<simpara>The original Engine must be updated to the latest minor version. The Engine version in the backup file must match the version of the new Engine. See <link xl:href="https://ovirt.org/documentation/upgrade_guide/index#Updating_the_Red_Hat_Virtualization_Manager_minor_updates">Updating the oVirt Engine</link> in the <emphasis>Upgrade Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>The data center compatibility level must be set to the latest version to ensure compatibility with the updated storage version.</simpara>
</listitem>
<listitem>
<simpara>There must be at least one regular host in the environment. This host (and any other regular hosts) will remain active to host the SPM role and any running virtual machines. If a regular host is not already the SPM, move the SPM role before creating the backup by selecting a regular host and clicking <menuchoice><guimenu>Management</guimenu> <guimenuitem>Select as SPM</guimenuitem></menuchoice>.</simpara>
<simpara>If no regular hosts are available, there are two ways to  add one:</simpara>
<itemizedlist>
<listitem>
<simpara>Remove the self-hosted engine configuration from a node (but do not remove the node from the environment). See <xref linkend="Removing_a_Host_from_a_Self-Hosted_Engine_Environment"/>.</simpara>
</listitem>
<listitem>
<simpara>Add a new regular host. See <xref linkend="Adding_standard_hosts_to_the_Manager_host_tasks"/>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<section xml:id="Backing_up_the_Original_Manager_SHE_backup_restore">
<title>Backing up the Original Engine</title>
<simpara>Back up the original Engine using the <literal>engine-backup</literal> command, and copy the backup file to a separate location so that it can be accessed at any point during the process.</simpara>
<simpara>For more information about <literal>engine-backup --mode=backup</literal> options, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">Backing Up and Restoring the oVirt Engine</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes and move the environment to global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>Log in to the original Engine and stop the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl stop ovirt-engine
# systemctl disable ovirt-engine</screen>
<note>
<simpara>Though stopping the original Engine from running is not obligatory, it is recommended as it ensures no changes are made to the environment after the backup is created. Additionally, it prevents the original Engine and the new Engine from simultaneously managing existing resources.</simpara>
</note>
</listitem>
<listitem>
<simpara>Run the <literal>engine-backup</literal> command, specifying the name of the backup file to create, and the name of the log file to create to store the backup log:</simpara>
<screen># engine-backup --mode=backup --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</listitem>
<listitem>
<simpara>Copy the files to an external server. In the following example, <literal>storage.example.com</literal> is the fully qualified domain name of a network storage server that will store the backup until it is needed, and <literal>/backup/</literal> is any designated folder or path.</simpara>
<screen># scp -p <emphasis>file_name</emphasis> <emphasis>log_file_name</emphasis> storage.example.com:/backup/</screen>
</listitem>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes and shut down the original Engine virtual machine:</simpara>
<screen># hosted-engine --vm-shutdown</screen>
</listitem>
</orderedlist>
<simpara>After backing up the Engine, deploy a new self-hosted engine and restore the backup on the new virtual machine.</simpara>
</section>
<section xml:id="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_backup_restore">
<title>Restoring the Backup on a New Self-Hosted Engine</title>
<simpara>Run the <literal>hosted-engine</literal> script on a new host, and use the <literal>--restore-from-file=<emphasis>path/to/file_name</emphasis></literal> option to restore the Engine backup during the deployment.</simpara>
<important>
<simpara>If you are using iSCSI storage, and your iSCSI target filters connections according to the initiator&#8217;s ACL, the deployment may fail with a <literal>STORAGE_DOMAIN_UNREACHABLE</literal> error. To prevent this, you must update your iSCSI configuration before beginning the self-hosted engine deployment:</simpara>
<itemizedlist>
<listitem>
<simpara>If you are redeploying on an existing host, you must update the host&#8217;s iSCSI initiator settings in <literal>/etc/iscsi/initiatorname.iscsi</literal>. The initiator IQN must be the same as was previously mapped on the iSCSI target, or updated to a new IQN, if applicable.</simpara>
</listitem>
<listitem>
<simpara>If you are deploying on a fresh host, you must update the iSCSI target configuration to accept connections from that host.</simpara>
</listitem>
</itemizedlist>
<simpara>Note that the IQN can be updated on the host side (iSCSI initiator), or on the storage side (iSCSI target).</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Copy the backup file to the new host. In the following example, <literal>host.example.com</literal> is the FQDN for the host, and <literal>/backup/</literal> is any designated folder or path.</simpara>
<screen># scp -p <emphasis>file_name</emphasis> host.example.com:/backup/</screen>
</listitem>
<listitem>
<simpara>Log in to the new host.</simpara>
</listitem>
<listitem>
<simpara>If you are deploying on oVirt Node, <literal>ovirt-hosted-engine-setup</literal> is already installed, so skip this step. If you are deploying on Enterprise Linux, install the <literal>ovirt-hosted-engine-setup</literal> package:</simpara>
<screen># dnf install ovirt-hosted-engine-setup</screen>
</listitem>
<listitem>
<simpara>Use the <literal>tmux</literal> window manager to run the script to avoid losing the session in case of network or terminal disruption.</simpara>
<simpara>Install and run <literal>tmux</literal>:</simpara>
<screen># dnf -y install tmux
# tmux</screen>
</listitem>
<listitem>
<simpara>Run the <literal>hosted-engine</literal> script, specifying the path to the backup file:</simpara>
<screen># hosted-engine --deploy --restore-from-file=backup/<emphasis>file_name</emphasis></screen>
<simpara>To escape the script at any time, use <keycombo><keycap>CTRL</keycap><keycap>D</keycap></keycombo> to abort deployment.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Yes</emphasis> to begin the deployment.</simpara>
</listitem>
<listitem>
<simpara>Configure the network. The script detects possible NICs to use as a management bridge for the environment.</simpara>
</listitem>
<listitem>
<simpara>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</simpara>
</listitem>
<listitem>
<simpara>Enter the root password for the Engine.</simpara>
</listitem>
<listitem>
<simpara>Enter an SSH public key that will allow you to log in to the Engine as the root user, and specify whether to enable SSH access for the root user.</simpara>
</listitem>
<listitem>
<simpara>Enter the virtual machine&#8217;s CPU and memory configuration.</simpara>
</listitem>
<listitem>
<simpara>Enter a MAC address for the Engine virtual machine, or accept a randomly generated one. If you want to provide the Engine virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</simpara>
</listitem>
<listitem>
<simpara>Enter the virtual machine&#8217;s networking details. If you specify <emphasis role="strong">Static</emphasis>, enter the IP address of the Engine.</simpara>
<important>
<simpara>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the Engine virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</simpara>
</important>
</listitem>
<listitem>
<simpara>Specify whether to add entries for the Engine virtual machine and the base host to the virtual machine&#8217;s <literal>/etc/hosts</literal> file. You must ensure that the host names are resolvable.</simpara>
</listitem>
<listitem>
<simpara>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications:</simpara>
</listitem>
<listitem>
<simpara>Enter a password for the <literal>admin@internal</literal> user to access the Administration Portal.</simpara>
<simpara>The script creates the virtual machine. This can take some time if the Engine Appliance needs to be installed.</simpara>
</listitem>
<listitem>
<simpara>Select the type of storage to use:</simpara>
<itemizedlist>
<listitem>
<simpara>For NFS, enter the version, full address and path to the storage, and any mount options.</simpara>
<warning>
<simpara>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</simpara>
</warning>
</listitem>
<listitem>
<simpara>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</simpara>
<note>
<simpara>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><emphasis>Enterprise Linux DM Multipath</emphasis></link> for details. There is also a <link xl:href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</link> tool that generates a script to install and configure multipath with different options.</simpara>
</note>
</listitem>
<listitem>
<simpara>For Gluster storage, enter the full address and path to the storage, and any mount options.</simpara>
<warning>
<simpara>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</simpara>
</warning>
<important>
<simpara>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</simpara>
<screen>gluster volume set <emphasis>VOLUME_NAME</emphasis> group virt
gluster volume set <emphasis>VOLUME_NAME</emphasis> performance.strict-o-direct on
gluster volume set <emphasis>VOLUME_NAME</emphasis> network.remote-dio off
gluster volume set <emphasis>VOLUME_NAME</emphasis> storage.owner-uid 36
gluster volume set <emphasis>VOLUME_NAME</emphasis> storage.owner-gid 36
gluster volume set <emphasis>VOLUME_NAME</emphasis> network.ping-timeout 30</screen>
</important>
</listitem>
<listitem>
<simpara>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Reusing_LUNs">Reusing LUNs</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter the Engine disk size.</simpara>
<simpara>The script continues until the deployment is complete.</simpara>
</listitem>
<listitem>
<simpara>The deployment process changes the Engine&#8217;s SSH keys. To allow client machines to access the new Engine without SSH errors, remove the original Engine&#8217;s entry from the <literal>.ssh/known_hosts</literal> file on any client machines that accessed the original Engine.</simpara>
</listitem>
</orderedlist>
<simpara>When the deployment is complete, log in to the new Engine virtual machine and enable the required repositories.</simpara>
</section>
<section xml:id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_backup_restore">
<title>Enabling the oVirt Engine Repositories</title>
<simpara>Ensure the correct repositories are enabled:</simpara>
<screen># dnf install <link xl:href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</link></screen>
<simpara>You can check which repositories are currently enabled by running <literal>dnf repolist</literal>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable the <literal>javapackages-tools</literal> module.</simpara>
<screen># dnf module -y javapackages-tools</screen>
</listitem>
<listitem>
<simpara>Enable the <literal>pki-deps</literal> module.</simpara>
<screen># dnf module -y enable pki-deps</screen>
</listitem>
<listitem>
<simpara>Enable version 12 of the <literal>postgresql</literal> module.</simpara>
<screen># dnf module -y enable postgresql:12</screen>
</listitem>
<listitem>
<simpara>Synchronize installed packages to update them to the latest available versions.</simpara>
<screen># dnf distro-sync --nobest</screen>
<formalpara>
<title>Additional resources</title>
<para>For information on modules and module streams, see the following sections in <emphasis>Installing, managing, and removing user-space components</emphasis></para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>The Engine and its resources are now running in the new self-hosted environment. The self-hosted engine nodes must be reinstalled in the Engine to update their self-hosted engine configuration. Standard hosts are not affected. Perform the following procedure for each self-hosted engine node.</simpara>
</section>
<section xml:id="Reinstalling_Hosts_SHE_backup_restore">
<title>Reinstalling Hosts</title>
<simpara>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</simpara>
<warning>
<simpara>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Install Host</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosted Engine</emphasis> tab and select <emphasis role="strong">DEPLOY</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to reinstall the host.</simpara>
</listitem>
</orderedlist>
<simpara>After a host has been reinstalled and its status returns to <emphasis role="strong">Up</emphasis>, you can migrate virtual machines back to the host.</simpara>
<important>
<simpara>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <emphasis role="strong">Install Failed</emphasis>. Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>, and the host will change to an <emphasis role="strong">Up</emphasis> status and be ready for use.</simpara>
</important>
<simpara>After reinstalling the self-hosted engine nodes, you can check the status of the new environment by running the following command on one of the nodes:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>During the restoration, the old self-hosted engine storage domain was renamed, but was not removed from the new environment in case the restoration was faulty. After confirming that the environment is running normally, you can remove the old self-hosted engine storage domain.</simpara>
</section>
<section xml:id="Removing_a_Storage_Domain_SHE_backup_restore">
<title>Removing a Storage Domain</title>
<simpara>You have a storage domain in your data center that you want to remove from the virtualized environment.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Move the storage domain to maintenance mode and detach it:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">Format Domain, i.e. Storage Content will be lost!</emphasis> check box to erase the content of the domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is permanently removed from the environment.</simpara>
</section>
</section>
<section xml:id="Recovering_a_Self-hosted_Engine">
<title>Recovering a Self-Hosted Engine from an Existing Backup</title>
<simpara>If a self-hosted engine is unavailable due to problems that cannot be repaired, you can restore it in a new self-hosted environment using a backup taken before the problem began, if one is available.</simpara>
<simpara>When you specify a backup file during deployment, the backup is restored on a new Engine virtual machine, with a new self-hosted engine storage domain. The old Engine is removed, and the old self-hosted engine storage domain is renamed and can be manually removed after you confirm that the new environment is working correctly. Deploying on a fresh host is highly recommended; if the host used for deployment existed in the backed up environment, it will be removed from the restored database to avoid conflicts in the new environment. If you deploy on a new host, you must assign a unique name to the host. Reusing the name of an existing host included in the backup can cause conflicts in the new environment.</simpara>
<simpara>Restoring a self-hosted engine involves the following key actions:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_restore_only">Deploy a new self-hosted engine and restore the backup.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_restore_only">Enable the Engine repositories on the new Engine virtual machine.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Reinstalling_Hosts_SHE_restore_only">Reinstall the self-hosted engine nodes to update their configuration.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Removing_a_Storage_Domain_SHE_restore_only">Remove the old self-hosted engine storage domain.</link></simpara>
</listitem>
</orderedlist>
<simpara>This procedure assumes that you do not have access to the original Engine, and that the new host can access the backup file.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>A fully qualified domain name prepared for your Engine and the host. Forward and reverse lookup records must both be set in the DNS. The new Engine must have the same fully qualified domain name as the original Engine.</simpara>
</listitem>
</itemizedlist>
<section xml:id="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_restore_only">
<title>Restoring the Backup on a New Self-Hosted Engine</title>
<simpara>Run the <literal>hosted-engine</literal> script on a new host, and use the <literal>--restore-from-file=<emphasis>path/to/file_name</emphasis></literal> option to restore the Engine backup during the deployment.</simpara>
<important>
<simpara>If you are using iSCSI storage, and your iSCSI target filters connections according to the initiator&#8217;s ACL, the deployment may fail with a <literal>STORAGE_DOMAIN_UNREACHABLE</literal> error. To prevent this, you must update your iSCSI configuration before beginning the self-hosted engine deployment:</simpara>
<itemizedlist>
<listitem>
<simpara>If you are redeploying on an existing host, you must update the host&#8217;s iSCSI initiator settings in <literal>/etc/iscsi/initiatorname.iscsi</literal>. The initiator IQN must be the same as was previously mapped on the iSCSI target, or updated to a new IQN, if applicable.</simpara>
</listitem>
<listitem>
<simpara>If you are deploying on a fresh host, you must update the iSCSI target configuration to accept connections from that host.</simpara>
</listitem>
</itemizedlist>
<simpara>Note that the IQN can be updated on the host side (iSCSI initiator), or on the storage side (iSCSI target).</simpara>
</important>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Copy the backup file to the new host. In the following example, <literal>host.example.com</literal> is the FQDN for the host, and <literal>/backup/</literal> is any designated folder or path.</simpara>
<screen># scp -p <emphasis>file_name</emphasis> host.example.com:/backup/</screen>
</listitem>
<listitem>
<simpara>Log in to the new host.</simpara>
</listitem>
<listitem>
<simpara>If you are deploying on oVirt Node, <literal>ovirt-hosted-engine-setup</literal> is already installed, so skip this step. If you are deploying on Enterprise Linux, install the <literal>ovirt-hosted-engine-setup</literal> package:</simpara>
<screen># dnf install ovirt-hosted-engine-setup</screen>
</listitem>
<listitem>
<simpara>Use the <literal>tmux</literal> window manager to run the script to avoid losing the session in case of network or terminal disruption.</simpara>
<simpara>Install and run <literal>tmux</literal>:</simpara>
<screen># dnf -y install tmux
# tmux</screen>
</listitem>
<listitem>
<simpara>Run the <literal>hosted-engine</literal> script, specifying the path to the backup file:</simpara>
<screen># hosted-engine --deploy --restore-from-file=backup/<emphasis>file_name</emphasis></screen>
<simpara>To escape the script at any time, use <keycombo><keycap>CTRL</keycap><keycap>D</keycap></keycombo> to abort deployment.</simpara>
</listitem>
<listitem>
<simpara>Select <emphasis role="strong">Yes</emphasis> to begin the deployment.</simpara>
</listitem>
<listitem>
<simpara>Configure the network. The script detects possible NICs to use as a management bridge for the environment.</simpara>
</listitem>
<listitem>
<simpara>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</simpara>
</listitem>
<listitem>
<simpara>Enter the root password for the Engine.</simpara>
</listitem>
<listitem>
<simpara>Enter an SSH public key that will allow you to log in to the Engine as the root user, and specify whether to enable SSH access for the root user.</simpara>
</listitem>
<listitem>
<simpara>Enter the virtual machine&#8217;s CPU and memory configuration.</simpara>
</listitem>
<listitem>
<simpara>Enter a MAC address for the Engine virtual machine, or accept a randomly generated one. If you want to provide the Engine virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</simpara>
</listitem>
<listitem>
<simpara>Enter the virtual machine&#8217;s networking details. If you specify <emphasis role="strong">Static</emphasis>, enter the IP address of the Engine.</simpara>
<important>
<simpara>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the Engine virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</simpara>
</important>
</listitem>
<listitem>
<simpara>Specify whether to add entries for the Engine virtual machine and the base host to the virtual machine&#8217;s <literal>/etc/hosts</literal> file. You must ensure that the host names are resolvable.</simpara>
</listitem>
<listitem>
<simpara>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications:</simpara>
</listitem>
<listitem>
<simpara>Enter a password for the <literal>admin@internal</literal> user to access the Administration Portal.</simpara>
<simpara>The script creates the virtual machine. This can take some time if the Engine Appliance needs to be installed.</simpara>
</listitem>
<listitem>
<simpara>Select the type of storage to use:</simpara>
<itemizedlist>
<listitem>
<simpara>For NFS, enter the version, full address and path to the storage, and any mount options.</simpara>
<warning>
<simpara>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</simpara>
</warning>
</listitem>
<listitem>
<simpara>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</simpara>
<note>
<simpara>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><emphasis>Enterprise Linux DM Multipath</emphasis></link> for details. There is also a <link xl:href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</link> tool that generates a script to install and configure multipath with different options.</simpara>
</note>
</listitem>
<listitem>
<simpara>For Gluster storage, enter the full address and path to the storage, and any mount options.</simpara>
<warning>
<simpara>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</simpara>
</warning>
<important>
<simpara>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</simpara>
<screen>gluster volume set <emphasis>VOLUME_NAME</emphasis> group virt
gluster volume set <emphasis>VOLUME_NAME</emphasis> performance.strict-o-direct on
gluster volume set <emphasis>VOLUME_NAME</emphasis> network.remote-dio off
gluster volume set <emphasis>VOLUME_NAME</emphasis> storage.owner-uid 36
gluster volume set <emphasis>VOLUME_NAME</emphasis> storage.owner-gid 36
gluster volume set <emphasis>VOLUME_NAME</emphasis> network.ping-timeout 30</screen>
</important>
</listitem>
<listitem>
<simpara>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Reusing_LUNs">Reusing LUNs</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter the Engine disk size.</simpara>
<simpara>The script continues until the deployment is complete.</simpara>
</listitem>
<listitem>
<simpara>The deployment process changes the Engine&#8217;s SSH keys. To allow client machines to access the new Engine without SSH errors, remove the original Engine&#8217;s entry from the <literal>.ssh/known_hosts</literal> file on any client machines that accessed the original Engine.</simpara>
</listitem>
</orderedlist>
<simpara>When the deployment is complete, log in to the new Engine virtual machine and enable the required repositories.</simpara>
</section>
<section xml:id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_restore_only">
<title>Enabling the oVirt Engine Repositories</title>
<simpara>Ensure the correct repositories are enabled:</simpara>
<screen># dnf install <link xl:href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</link></screen>
<simpara>You can check which repositories are currently enabled by running <literal>dnf repolist</literal>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable the <literal>javapackages-tools</literal> module.</simpara>
<screen># dnf module -y javapackages-tools</screen>
</listitem>
<listitem>
<simpara>Enable the <literal>pki-deps</literal> module.</simpara>
<screen># dnf module -y enable pki-deps</screen>
</listitem>
<listitem>
<simpara>Enable version 12 of the <literal>postgresql</literal> module.</simpara>
<screen># dnf module -y enable postgresql:12</screen>
</listitem>
<listitem>
<simpara>Synchronize installed packages to update them to the latest available versions.</simpara>
<screen># dnf distro-sync --nobest</screen>
<formalpara>
<title>Additional resources</title>
<para>For information on modules and module streams, see the following sections in <emphasis>Installing, managing, and removing user-space components</emphasis></para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>The Engine and its resources are now running in the new self-hosted environment. The self-hosted engine nodes must be reinstalled in the Engine to update their self-hosted engine configuration. Standard hosts are not affected. Perform the following procedure for each self-hosted engine node.</simpara>
</section>
<section xml:id="Reinstalling_Hosts_SHE_restore_only">
<title>Reinstalling Hosts</title>
<simpara>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</simpara>
<warning>
<simpara>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</simpara>
</warning>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</simpara>
</listitem>
<listitem>
<simpara>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice> and select the host.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Install Host</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Hosted Engine</emphasis> tab and select <emphasis role="strong">DEPLOY</emphasis> from the drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> to reinstall the host.</simpara>
</listitem>
</orderedlist>
<simpara>After a host has been reinstalled and its status returns to <emphasis role="strong">Up</emphasis>, you can migrate virtual machines back to the host.</simpara>
<important>
<simpara>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <emphasis role="strong">Install Failed</emphasis>. Click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>, and the host will change to an <emphasis role="strong">Up</emphasis> status and be ready for use.</simpara>
</important>
<simpara>After reinstalling the self-hosted engine nodes, you can check the status of the new environment by running the following command on one of the nodes:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>During the restoration, the old self-hosted engine storage domain was renamed, but was not removed from the new environment in case the restoration was faulty. After confirming that the environment is running normally, you can remove the old self-hosted engine storage domain.</simpara>
</section>
<section xml:id="Removing_a_Storage_Domain_SHE_restore_only">
<title>Removing a Storage Domain</title>
<simpara>You have a storage domain in your data center that you want to remove from the virtualized environment.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Move the storage domain to maintenance mode and detach it:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Click the storage domain&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Data Center</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Maintenance</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Detach</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Optionally select the <emphasis role="strong">Format Domain, i.e. Storage Content will be lost!</emphasis> check box to erase the content of the domain.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The storage domain is permanently removed from the environment.</simpara>
</section>
</section>
<section xml:id="Overwriting_a_Self-Hosted_Engine">
<title>Overwriting a Self-Hosted Engine from an Existing Backup</title>
<simpara>If a self-hosted engine is accessible, but is experiencing an issue such as database corruption, or a configuration error that is difficult to roll back, you can restore the environment to a previous state using a backup taken before the problem began, if one is available.</simpara>
<simpara>Restoring a self-hosted engine&#8217;s previous state involves the following steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Enabling_Global_Maintenance_Mode_SHE_overwrite">Place the environment in global maintenance mode.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Restoring_a_Backup_to_Overwrite_an_Existing_Installation_SHE_overwrite">Restore the backup on the Engine virtual machine.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="Disabling_Global_Maintenance_Mode_SHE_overwrite">Disable global maintenance mode.</link></simpara>
</listitem>
</orderedlist>
<simpara>For more information about <literal>engine-backup --mode=restore</literal> options, see <xref linkend="sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager"/>.</simpara>
<section xml:id="Enabling_Global_Maintenance_Mode_SHE_overwrite">
<title>Enabling global maintenance mode</title>
<simpara>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the Engine virtual machine.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>Confirm that the environment is in global maintenance mode before proceeding:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>You should see a message indicating that the cluster is in global maintenance mode.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Restoring_a_Backup_to_Overwrite_an_Existing_Installation_SHE_overwrite">
<title>Restoring a Backup to Overwrite an Existing Installation</title>
<simpara>The <literal>engine-backup</literal> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up. This is useful when you have taken a backup of an environment, performed changes on that environment, and then want to undo the changes by restoring the environment from the backup.</simpara>
<simpara>Changes made to the environment since the backup was taken, such as adding or removing a host, will not appear in the restored environment. You must redo these changes.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Engine machine.</simpara>
</listitem>
<listitem>
<simpara>Remove the configuration files and clean the database associated with the Engine:</simpara>
<screen># engine-cleanup</screen>
<simpara>The <literal>engine-cleanup</literal> command only cleans the Engine database; it does not drop the database or delete the user that owns that database.</simpara>
</listitem>
<listitem>
<simpara>Restore a full backup or a database-only backup. You do not need to create a new database or specify the database credentials because the user and database already exist.</simpara>
<itemizedlist>
<listitem>
<simpara>Restore a full backup:</simpara>
<screen># engine-backup --mode=restore --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --restore-permissions</screen>
</listitem>
<listitem>
<simpara>Restore a database-only backup by restoring the configuration files and the database backup:</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=db --scope=dwhdb --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --restore-permissions</screen>
<note>
<simpara>To restore only the Engine database (for example, if the Data Warehouse database is located on another machine), you can omit the <literal>--scope=dwhdb</literal> parameter.</simpara>
</note>
<simpara>If successful, the following output displays:</simpara>
<screen>You should now run engine-setup.
Done.</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Reconfigure the Engine:</simpara>
<screen># engine-setup</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Disabling_Global_Maintenance_Mode_SHE_overwrite">
<title>Disabling global maintenance mode</title>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Engine virtual machine and shut it down.</simpara>
</listitem>
<listitem>
<simpara>Log in to one of the self-hosted engine nodes
and disable global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
<simpara>When you exit global maintenance mode, ovirt-ha-agent starts the Engine virtual machine, and then the Engine automatically starts. It can take up to ten minutes for the Engine to start.</simpara>
</listitem>
<listitem>
<simpara>Confirm that the environment is running:</simpara>
<screen># hosted-engine --vm-status</screen>
<simpara>The listed information includes <emphasis role="strong">Engine Status</emphasis>. The value for <emphasis role="strong">Engine status</emphasis> should be:</simpara>
<screen>{"health": "good", "vm": "up", "detail": "Up"}</screen>
<note>
<simpara>When the virtual machine is still booting and the Engine hasn&#8217;t started yet, the <emphasis role="strong">Engine status</emphasis> is:</simpara>
<screen>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</screen>
<simpara>If this happens, wait a few minutes and try again.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>When the environment is running again, you can start any virtual machines that were stopped, and check that the resources in the environment are behaving as expected.</simpara>
</section>
</section>
</section>
<section xml:id="migrating-rhv-databases">
<title>Migrating oVirt Databases to Remote Servers</title>
<section xml:id="Migrating_Data_Warehouse_to_a_Separate_Machine_migrate_database">
<title>Migrating Data Warehouse to a Separate Machine</title>
<simpara>This section describes how to migrate the Data Warehouse database and service from the oVirt Engine machine to a separate machine. Hosting the Data Warehouse service on a separate machine reduces the load on each individual machine, and avoids potential conflicts caused by sharing CPU and memory resources with other processes.</simpara>
<note>
<simpara>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</simpara>
</note>
<simpara>You have the following migration options:</simpara>
<itemizedlist>
<listitem>
<simpara>You can migrate the Data Warehouse service away from the Engine machine and connect it with the existing Data Warehouse database (<literal>ovirt_engine_history</literal>).</simpara>
</listitem>
<listitem>
<simpara>You can migrate the Data Warehouse database away from the Engine machine and then migrate the Data Warehouse service.</simpara>
</listitem>
</itemizedlist>
<section xml:id="Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">
<title>Migrating the Data Warehouse Database to a Separate Machine</title>
<simpara>Migrate the Data Warehouse database (<literal>ovirt_engine_history</literal>) before you migrate the Data Warehouse service. Use <literal>engine-backup</literal> to create a database backup and restore it on the new database machine. For more information on <literal>engine-backup</literal>, run <literal>engine-backup --help</literal>.</simpara>
<simpara>To migrate the Data Warehouse service, see <xref linkend="Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH"/>.</simpara>
<note>
<simpara>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</simpara>
</note>
<simpara>The new database server must have Enterprise Linux 8 installed.
Enable the required repositories on the new database server.</simpara>
<bridgehead xml:id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_migrate_DWH_DB" renderas="sect5">Enabling the oVirt Engine Repositories</bridgehead>
<simpara>Ensure the correct repositories are enabled:</simpara>
<screen># dnf install <link xl:href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</link></screen>
<simpara>You can check which repositories are currently enabled by running <literal>dnf repolist</literal>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable the <literal>javapackages-tools</literal> module.</simpara>
<screen># dnf module -y javapackages-tools</screen>
</listitem>
<listitem>
<simpara>Enable version 12 of the <literal>postgresql</literal> module.</simpara>
<screen># dnf module -y enable postgresql:12</screen>
</listitem>
<listitem>
<simpara>Synchronize installed packages to update them to the latest available versions.</simpara>
<screen># dnf distro-sync --nobest</screen>
<formalpara>
<title>Additional resources</title>
<para>For information on modules and module streams, see the following sections in <emphasis>Installing, managing, and removing user-space components</emphasis></para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</link></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<bridgehead xml:id="_migrating_the_data_warehouse_database_to_a_separate_machine" renderas="sect5">Migrating the Data Warehouse Database to a Separate Machine</bridgehead>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a backup of the Data Warehouse database and configuration files on the Engine:</simpara>
<screen># engine-backup --mode=backup --scope=dwhdb --scope=files --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis></screen>
</listitem>
<listitem>
<simpara>Copy the backup file from the Engine to the new machine:</simpara>
<screen># scp <emphasis>/tmp/file_name</emphasis> <emphasis>root@new.dwh.server.com:/tmp</emphasis></screen>
</listitem>
<listitem>
<simpara>Install <literal>engine-backup</literal> on the new machine:</simpara>
<screen># dnf install ovirt-engine-tools-backup</screen>
</listitem>
<listitem>
<simpara>Install the PostgreSQL server package:</simpara>
<screen># dnf install postgresql-server postgresql-contrib</screen>
</listitem>
<listitem>
<simpara>Initialize the PostgreSQL database, start the <literal>postgresql</literal> service, and ensure that this service starts on boot:</simpara>
<screen># su - postgres -c 'initdb'
# systemctl enable postgresql
# systemctl start postgresql</screen>
</listitem>
<listitem>
<simpara>Restore the Data Warehouse database on the new machine. <emphasis>file_name</emphasis> is the backup file copied from the Engine.</simpara>
<screen># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<emphasis>file_name</emphasis> --log=<emphasis>log_file_name</emphasis> --provision-dwh-db --restore-permissions</screen>
</listitem>
</orderedlist>
<simpara>The Data Warehouse database is now hosted on a separate machine from that on which the Engine is hosted. After successfully restoring the Data Warehouse database, a prompt instructs you to run the <literal>engine-setup</literal> command. Before running this command, migrate the Data Warehouse service.</simpara>
</section>
<section xml:id="Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH">
<title>Migrating the Data Warehouse Service to a Separate Machine</title>
<simpara>You can migrate the Data Warehouse service installed and configured on the oVirt Engine to a separate machine. Hosting the Data Warehouse service on a separate machine helps to reduce the load on the Engine machine.</simpara>
<simpara>Notice that this procedure migrates the Data Warehouse service only.</simpara>
<simpara>To migrate the Data Warehouse database (<literal>ovirt_engine_history</literal>) prior to migrating the Data Warehouse service, see <xref linkend="Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH"/>.</simpara>
<note>
<simpara>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</simpara>
</note>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>You must have installed and configured the Engine and Data Warehouse on the same machine.</simpara>
</listitem>
<listitem>
<simpara>To set up the new Data Warehouse machine, you must have the following:</simpara>
<itemizedlist>
<listitem>
<simpara>The password from the Engine&#8217;s <emphasis role="strong">/etc/ovirt-engine/engine.conf.d/10-setup-database.conf</emphasis> file.</simpara>
</listitem>
<listitem>
<simpara>Allowed access from the Data Warehouse machine to the Engine database machine&#8217;s TCP port 5432.</simpara>
</listitem>
<listitem>
<simpara>The username and password for the Data Warehouse database from the Engine&#8217;s <emphasis role="strong">/etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf</emphasis> file. If you migrated the <literal>ovirt_engine_history</literal> database using <xref linkend="Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH"/>, the backup includes these credentials, which you defined during the database setup on that machine.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
<simpara>Installing this scenario requires four steps:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="setting_up_machine">Setting up the New Data Warehouse Machine</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="stopping_dwh_service">Stopping the Data Warehouse service on the Engine machine</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="configuring_new_machine">Configuring the new Data Warehouse machine</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="disabling_dwh_package">Disabling the Data Warehouse package on the Engine machine</link></simpara>
</listitem>
</orderedlist>
<section xml:id="setting_up_machine">
<title>Setting up the New Data Warehouse Machine</title>
<simpara>Enable the oVirt repositories and install the Data Warehouse setup package on a Enterprise Linux 8 machine:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable the <literal>pki-deps</literal> module.</simpara>
<screen># dnf module -y enable pki-deps</screen>
</listitem>
<listitem>
<simpara>Ensure that all packages currently installed are up to date:</simpara>
<screen># dnf upgrade --nobest</screen>
</listitem>
<listitem>
<simpara>Install the <literal>ovirt-engine-dwh-setup</literal> package:</simpara>
<screen># dnf install ovirt-engine-dwh-setup</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="stopping_dwh_service">
<title>Stopping the Data Warehouse Service on the Engine Machine</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Stop the Data Warehouse service:</simpara>
<screen># systemctl stop ovirt-engine-dwhd.service</screen>
</listitem>
<listitem>
<simpara>If the database is hosted on a remote machine, you must manually grant access by editing the postgres.conf file. Edit the <literal role="filename">/var/lib/pgsql/data/postgresql.conf</literal> file and modify the listen_addresses line so that it matches the following:</simpara>
<screen>listen_addresses = '*'</screen>
<simpara>If the line does not exist or has been commented out, add it manually.</simpara>
<simpara>If the database is hosted on the Engine machine and was configured during a clean setup of the oVirt Engine, access is granted by default.</simpara>
<simpara>See <xref linkend="Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH"/> for more information on how to configure and migrate the Data Warehouse database.</simpara>
</listitem>
<listitem>
<simpara>Restart the postgresql service:</simpara>
<screen># systemctl restart postgresql</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="configuring_new_machine">
<title>Configuring the New Data Warehouse Machine</title>
<simpara>The order of the options or settings shown in this section may differ depending on your environment.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>If you are migrating both the <literal>ovirt_engine_history</literal> database and the Data Warehouse service to the <emphasis role="strong">same</emphasis> machine, run the following, otherwise proceed to the next step.</simpara>
<screen># sed -i '/^ENGINE_DB_/d' \
        /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf

# sed -i \
     -e 's;^\(OVESETUP_ENGINE_CORE/enable=bool\):True;\1:False;' \
     -e '/^OVESETUP_CONFIG\/fqdn/d' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</screen>
</listitem>
<listitem>
<simpara>Run the <literal>engine-setup</literal> command to begin configuration of Data Warehouse on the machine:</simpara>
<screen># engine-setup</screen>
</listitem>
<listitem>
<simpara>Press <emphasis role="strong">Enter</emphasis> to accept the automatically detected host name, or enter an alternative host name and press <emphasis role="strong">Enter</emphasis>:</simpara>
<screen>Host fully qualified DNS name of this server [<emphasis>autodetected host name</emphasis>]:</screen>
</listitem>
<listitem>
<simpara>Press <literal>Enter</literal> to automatically configure the firewall, or type <literal>No</literal> and press <literal>Enter</literal> to maintain existing settings:</simpara>
<screen>Setup can automatically configure the firewall on this system.
Note: automatic configuration of the firewall may overwrite current settings.
Do you want Setup to configure the firewall? (Yes, No) [Yes]:</screen>
<simpara>If you choose to automatically configure the firewall, and no firewall managers are active, you are prompted to select your chosen firewall manager from a list of supported options. Type the name of the firewall manager and press <literal>Enter</literal>. This applies even in cases where only one option is listed.</simpara>
</listitem>
<listitem>
<simpara>Enter the fully qualified domain name and password for the Engine. Press <emphasis role="strong">Enter</emphasis> to accept the default values in each other field:</simpara>
<screen>Host fully qualified DNS name of the engine server []: <emphasis>engine-fqdn</emphasis>
Setup needs to do some actions on the remote engine server. Either automatically, using ssh as root to access it, or you will be prompted to manually perform each such action.
Please choose one of the following:
1 - Access remote engine server using ssh as root
2 - Perform each action manually, use files to copy content around
(1, 2) [1]:
ssh port on remote engine server [22]:
root password on remote engine server <emphasis>engine-fqdn</emphasis>: <emphasis>password</emphasis></screen>
</listitem>
<listitem>
<simpara>Enter the FQDN and password for the Engine database machine. Press <literal>Enter</literal> to accept the default values in each other field:</simpara>
<screen>Engine database host []: <emphasis>manager-db-fqdn</emphasis>
Engine database port [5432]:
Engine database secured connection (Yes, No) [No]:
Engine database name [engine]:
Engine database user [engine]:
Engine database password: <emphasis>password</emphasis></screen>
</listitem>
<listitem>
<simpara>Confirm your installation settings:</simpara>
<screen>Please confirm installation settings (OK, Cancel) [OK]:</screen>
</listitem>
</orderedlist>
<simpara>The Data Warehouse service is now configured on the remote machine. Proceed to disable the Data Warehouse service on the Engine machine.</simpara>
</section>
<section xml:id="disabling_dwh_package">
<title>Disabling the Data Warehouse Service on the Engine Machine</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine machine, restart the Engine:</simpara>
<screen># service ovirt-engine restart</screen>
</listitem>
<listitem>
<simpara>Run the following command to modify the file <emphasis role="strong">/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</emphasis> and set the options to <literal>False</literal>:</simpara>
<screen># sed -i \
     -e 's;^\(OVESETUP_DWH_CORE/enable=bool\):True;\1:False;' \
     -e 's;^\(OVESETUP_DWH_CONFIG/remoteEngineConfigured=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf

# sed -i \
     -e 's;^\(OVESETUP_GRAFANA_CORE/enable=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</screen>
</listitem>
<listitem>
<simpara>Disable the Data Warehouse service:</simpara>
<screen># systemctl disable ovirt-engine-dwhd.service</screen>
</listitem>
<listitem>
<simpara>Remove the Data Warehouse files:</simpara>
<screen># rm -f /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/* .conf /var/lib/ovirt-engine-dwh/backups/*</screen>
</listitem>
</orderedlist>
<simpara>The Data Warehouse service is now hosted on a separate machine from the Engine.</simpara>
</section>
</section>
</section>
</section>
<section xml:id="sect-Backing_Up_and_Restoring_Virtual_Machines_Using_a_Backup_Domain">
<title>Backing Up and Restoring Virtual Machines Using a Backup Storage Domain</title>
<section xml:id="con_Backup_domains_explained_backup_domain">
<title>Backup storage domains explained</title>
<simpara>A backup storage domain is one that you can use specifically for storing and migrating virtual machines and virtual machine templates for the purpose of backing up and restoring for disaster recovery, migration, or any other backup/restore usage model. A backup domain differs from a non-backup domain in that all virtual machines on a backup domain are in a powered-down state. A virtual machine cannot run on a backup domain.</simpara>
<simpara>You can set any data storage domain to be a backup domain. You can enable or disable this setting by selecting or deselecting a checkbox in the Manage Domain dialog box. You can enable this setting only after all virtual machines on that storage domain are stopped.</simpara>
<simpara>You cannot start a virtual machine stored on a backup domain. The Manager blocks this and any other operation that might invalidate the backup. However, you can run a virtual machine based on a template stored on a backup domain if the virtual machine&#8217;s disks are not part of a backup domain.</simpara>
<simpara>As with other types of storage domains, you can attach or detach backup domains to or from a data center. So, in addition to storing backups, you can use backup domains to migrate virtual machines between data centers.</simpara>
<formalpara>
<title>Advantages</title>
<para>Some reasons to use a backup domain, rather than an export domain, are listed here:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>You can have multiple backup storage domains in a data center, as opposed to only one export domain.</simpara>
</listitem>
<listitem>
<simpara>You can dedicate a backup storage domain to use for backup and disaster recovery.</simpara>
</listitem>
<listitem>
<simpara>You can transfer a backup of a virtual machine, a template, or a snapshot to a backup storage domain</simpara>
</listitem>
<listitem>
<simpara>Migrating a large number of virtual machines, templates, or OVF files is significantly faster with backup domains than export domains.</simpara>
</listitem>
<listitem>
<simpara>A backup domain uses disk space more efficiently than an export domain.</simpara>
</listitem>
<listitem>
<simpara>Backup domains support both file storage (NFS, Gluster) and block storage (Fiber Channel and iSCSI). This contrasts with export domains, which only support file storage.</simpara>
</listitem>
<listitem>
<simpara>You can dynamically enable and disable the backup setting for a storage domain, taking into account the restrictions.</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Restrictions</title>
<listitem>
<simpara>Any virtual machine or template on a _backup domain must have all its disks on that same domain.</simpara>
</listitem>
<listitem>
<simpara>All virtual machines on a storage domain must be powered down before you can set it to be a backup domain.</simpara>
</listitem>
<listitem>
<simpara>You cannot run a virtual machine that is stored on a backup domain, because doing so might manipulate the disk&#8217;s data.</simpara>
</listitem>
<listitem>
<simpara>A backup domain cannot be the target of memory volumes because memory volumes are only supported for active virtual machines.</simpara>
</listitem>
<listitem>
<simpara>You cannot preview a virtual machine on a backup domain.</simpara>
</listitem>
<listitem>
<simpara>Live migration of a virtual machine to a backup domain is not possible.</simpara>
</listitem>
<listitem>
<simpara>You cannot set a backup domain to be the master domain.</simpara>
</listitem>
<listitem>
<simpara>You cannot set a Self-hosted engine&#8217;s domain to be a backup domain.</simpara>
</listitem>
<listitem>
<simpara>Do not use the default storage domain as a backup domain.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Setting_a_storage_domain_to_be_a_backup_domain_backup_domain">
<title>Setting a data storage domain to be a backup domain</title>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>All disks belonging to a virtual machine or template on the storage domain must be on the same domain.</simpara>
</listitem>
<listitem>
<simpara>All virtual machines on the domain must be powered down.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, select <menuchoice><guimenu>Storage</guimenu> <guimenuitem>Domains</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Create a new storage domain or select an existing storage domain and click <emphasis role="strong">Manage Domain</emphasis>. The Manage Domains dialog box opens.</simpara>
</listitem>
<listitem>
<simpara>Under <emphasis role="strong">Advanced Parameters</emphasis>, select the <emphasis role="strong">Backup</emphasis> checkbox.</simpara>
</listitem>
</orderedlist>
<simpara>The domain is now a backup domain.</simpara>
</section>
<section xml:id="proc_Backing_Up_a_Virtual_Machine_backup_domain">
<title>Backing up or Restoring a Virtual Machine or Snapshot Using a Backup Domain</title>
<simpara>You can back up a powered down virtual machine or snapshot. You can then store the backup on the same data center and restore it as needed, or migrate it to another data center.</simpara>
<orderedlist numeration="arabic">
<title>Procedure: Backing Up a Virtual Machine</title>
<listitem>
<simpara>Create a backup domain. See <xref linkend="Setting_a_storage_domain_to_be_a_backup_domain_backup_domain"/>.</simpara>
</listitem>
<listitem>
<simpara>Create a new virtual machine based on the virtual machine you want to back up:</simpara>
<itemizedlist>
<listitem>
<simpara>To back up a snapshot, first create a virtual machine from a snapshot. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#creating_a_virtual_machine_from_a_snapshot">Creating a Virtual Machine from a Snapshot</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>To back up a virtual machine, first clone the virtual machine. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#cloning_a_virtual_machine">Cloning a Virtual Machine</link> in the <emphasis>Virtual Machine Management Guide</emphasis>. Make sure the clone is powered down before proceeding.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Export the new virtual machine to a backup domain. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#proc_Exporting_individual_virtual_machines_to_a_data_domain_vm_guide_administrative_tasks">Exporting a Virtual Machine to a Data Domain</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Procedure: Restoring a Virtual Machine</title>
<listitem>
<simpara>Make sure that the backup storage domain that stores the virtual machine backup is attached to a data center.</simpara>
</listitem>
<listitem>
<simpara>Import the virtual machine from the backup domain. See <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_Data_Domain">Importing Virtual Machines from a Data Domain</link>.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Related information</title>
<listitem>
<simpara><xref linkend="Importing_storage_domains"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Migrating_SD_between_DC_Same_Env"/></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Migrating_SD_between_DC_different_env"/></simpara>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="sect-Backing_Up_and_Restoring_Virtual_Machines_Using_the_Backup_and_Restore_API">
<title>Backing Up and Restoring Virtual Machines Using the Backup and Restore API</title>
<section xml:id="The_Backup_and_Restore_API">
<title>The Backup and Restore API</title>
<simpara>The backup and restore API is a collection of functions that allows you to perform full or file-level backup and restoration of virtual machines. The API combines several components of oVirt, such as live snapshots and the REST API, to create and work with temporary volumes that can be attached to a virtual machine containing backup software provided by an independent software provider.</simpara>
<simpara>For supported third-party backup vendors, consult the <link xl:href="https://access.redhat.com/ecosystem">oVirt Ecosystem</link>.</simpara>
</section>
<section xml:id="Backing_Up_a_Virtual_Machine">
<title>Backing Up a Virtual Machine</title>
<simpara>Use the backup and restore API to back up a virtual machine. This procedure assumes you have two virtual machines: the virtual machine to back up, and a virtual machine on which the software for managing the backup is installed.</simpara>
<simpara><emphasis role="strong">Backing Up a Virtual Machine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Using the REST API, create a snapshot of the virtual machine to back up:</simpara>
<screen>POST /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/snapshots/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;snapshot&gt;
    &lt;description&gt;BACKUP&lt;/description&gt;
&lt;/snapshot&gt;</screen>
<note>
<itemizedlist>
<listitem>
<simpara>Here, replace <literal><emphasis>{vm:id}</emphasis></literal> with the VM ID of the virtual machine whose snapshot you are making. This ID is available from the <emphasis role="strong">General</emphasis> tab of the <emphasis role="strong">New Virtual Machine</emphasis> and <emphasis role="strong">Edit Virtual Machine</emphasis> windows in the <emphasis role="strong">Administration Portal</emphasis> and <emphasis role="strong">VM Portal</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Taking a snapshot of a virtual machine stores its current configuration data in the <literal>data</literal> attribute of the <literal>configuration</literal> attribute in <literal>initialization</literal> under the snapshot.</simpara>
</listitem>
</itemizedlist>
</note>
<important>
<simpara>You cannot take snapshots of disks marked as shareable or based on direct LUN disks.</simpara>
</important>
</listitem>
<listitem>
<simpara>Retrieve the configuration data of the virtual machine from the <literal>data</literal> attribute under the snapshot:</simpara>
<screen>GET /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/snapshots/<literal><emphasis>{snapshot:id}</emphasis></literal> HTTP/1.1
All-Content: true
Accept: application/xml
Content-type: application/xml</screen>
<note>
<itemizedlist>
<listitem>
<simpara>Here, replace <literal><emphasis>{vm:id}</emphasis></literal> with the ID of the virtual machine whose snapshot you made earlier. Replace <literal><emphasis>{snapshot:id}</emphasis></literal> with the snapshot ID.</simpara>
</listitem>
<listitem>
<simpara>Add the <literal>All-Content: true</literal> header to retrieve additional OVF data in the response. The OVF data in the XML response is located within the VM configuration element, <literal>&lt;initialization&gt;&lt;configuration&gt;</literal>. Later, you will use this data to restore the virtual machine.</simpara>
</listitem>
</itemizedlist>
</note>
</listitem>
<listitem>
<simpara>Get the snapshot ID:</simpara>
<screen>GET /api/vms/{vm:id}/snapshots/ HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
</listitem>
<listitem>
<simpara>Identify the disk ID of the snapshot:</simpara>
<screen>GET /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/snapshots/<literal><emphasis>{snapshot:id}</emphasis></literal>/disks HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
</listitem>
<listitem>
<simpara>Attach the snapshot to a backup virtual machine as an active disk attachment, with the correct interface type (for example, <emphasis role="strong">virtio_scsi</emphasis>):</simpara>
<screen>POST /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/diskattachments/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk_attachment&gt;
	&lt;active&gt;true&lt;/active&gt;
	&lt;interface&gt;_virtio_scsi_&lt;/interface&gt;
	&lt;disk id="<emphasis>{disk:id}</emphasis>"&gt;
	&lt;snapshot id="<emphasis>{snapshot:id}</emphasis>"/&gt;
	&lt;/disk&gt;
&lt;/disk_attachment&gt;</screen>
<note>
<simpara>Here, replace <literal><emphasis>{vm:id}</emphasis></literal> with the ID of the <emphasis>backup</emphasis> virtual machine, not the virtual machine whose snapshot you made earlier. Replace <literal><emphasis>{disk:id}</emphasis></literal> with the disk ID. Replace <literal><emphasis>{snapshot:id}</emphasis></literal> with the snapshot ID.</simpara>
</note>
</listitem>
<listitem>
<simpara>Use the backup software on the backup virtual machine to back up the data on the snapshot disk.</simpara>
</listitem>
<listitem>
<simpara>Remove the snapshot disk attachment from the backup virtual machine:</simpara>
<screen>DELETE /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/diskattachments/<literal><emphasis>{snapshot:id}</emphasis></literal> HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
<note>
<simpara>Here, replace <literal><emphasis>{vm:id}</emphasis></literal> with the ID of the <emphasis>backup</emphasis> virtual machine, not the virtual machine whose snapshot you made earlier. Replace <literal><emphasis>{snapshot:id}</emphasis></literal> with the snapshot ID.</simpara>
</note>
</listitem>
<listitem>
<simpara>Optionally, delete the snapshot:</simpara>
<screen>DELETE /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/snapshots/<literal><emphasis>{snapshot:id}</emphasis></literal> HTTP/1.1
Accept: application/xml
Content-type: application/xml</screen>
<note>
<simpara>Here, replace <literal><emphasis>{vm:id}</emphasis></literal> with the ID of the virtual machine whose snapshot you made earlier. Replace <literal><emphasis>{snapshot:id}</emphasis></literal> with the snapshot ID.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>You have backed up the state of a virtual machine at a fixed point in time using backup software installed on a separate virtual machine.</simpara>
</section>
<section xml:id="Restoring_a_Virtual_Machine">
<title>Restoring a Virtual Machine</title>
<simpara>Restore a virtual machine that has been backed up using the backup and restore API. This procedure assumes you have a backup virtual machine on which the software used to manage the previous backup is installed.</simpara>
<simpara><emphasis role="strong">Restoring a Virtual Machine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In the Administration Portal, create a floating disk on which to restore the backup. See <xref linkend="Creating_a_Virtual_Disk"/> for details on how to create a floating disk.</simpara>
</listitem>
<listitem>
<simpara>Attach the disk to the backup virtual machine:</simpara>
<screen>POST /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/disks/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk id="<emphasis>{disk:id}</emphasis>"&gt;
&lt;/disk&gt;</screen>
<note>
<simpara>Here, replace <literal>{vm:id}</literal> with the ID of this <emphasis>backup</emphasis> virtual machine, not the virtual machine whose snapshot you made earlier.
Replace <literal>{disk:id}</literal> with the disk ID you got while backing up the virtual machine.</simpara>
</note>
</listitem>
<listitem>
<simpara>Use the backup software to restore the backup to the disk.</simpara>
</listitem>
<listitem>
<simpara>Detach the disk from the backup virtual machine:</simpara>
<screen>DELETE /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/disks/<emphasis>{disk:id}</emphasis> HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;action&gt;
    &lt;detach&gt;true&lt;/detach&gt;
&lt;/action&gt;</screen>
<note>
<simpara>Here, replace <literal>{vm:id}</literal> with the ID of this <emphasis>backup</emphasis> virtual machine, not the virtual machine whose snapshot you made earlier.
Replace <literal>{disk:id}</literal> with the disk ID.</simpara>
</note>
</listitem>
<listitem>
<simpara>Create a new virtual machine using the configuration data of the virtual machine being restored:</simpara>
<screen>POST /api/vms/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;vm&gt;
    &lt;cluster&gt;
        &lt;name&gt;cluster_name&lt;/name&gt;
    &lt;/cluster&gt;
    &lt;name&gt;_NAME_&lt;/name&gt;
      &lt;initialization&gt;
      &lt;configuration&gt;
  &lt;data&gt;
  &lt;!-- omitting long ovf data --&gt;
  &lt;/data&gt;
      &lt;type&gt;ovf&lt;/type&gt;
      &lt;/configuration&gt;
      &lt;/initialization&gt;
    ...
&lt;/vm&gt;</screen>
<note>
<simpara>To override any of the values in the ovf while creating the virtual machine,  redefine the element <emphasis>before</emphasis> or <emphasis>after</emphasis> the <literal>initialization</literal> element. Not within the initialization element.</simpara>
</note>
</listitem>
<listitem>
<simpara>Attach the disk to the new virtual machine:</simpara>
<screen>POST /api/vms/<literal><emphasis>{vm:id}</emphasis></literal>/disks/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk id="<emphasis>{disk:id}</emphasis>"&gt;
&lt;/disk&gt;</screen>
<note>
<simpara>Here, replace <literal>{vm:id}</literal> with the ID of the new virtual machine, not the virtual machine whose snapshot you made earlier. Replace <literal>{disk:id}</literal> with the disk ID.</simpara>
</note>
</listitem>
</orderedlist>
<simpara>You have restored a virtual machine using a backup that was created using the backup and restore API.</simpara>
</section>
</section>
<section xml:id="_backing_up_and_restoring_virtual_machines_using_the_incremental_backup_and_restore_api">
<title>Backing Up and Restoring Virtual Machines Using the Incremental Backup and Restore API</title>
<simpara xml:id="assembly_incremental-backup-and-restore_RHV_backup_restore" role="_abstract">oVirt provides an Incremental Backup API that you can use for full backups of QCOW2 or RAW virtual disks, or incremental backups of QCOW 2 virtual disks, without any temporary snapshots. Data is backed-up in RAW format, whether the virtual disk  being backed up is QCOW2 or RAW. You can restore RAW guest data and either RAW or QCOW2 disks. The Incremental Backup API is part of the oVirt REST API. You can backup virtual machines that are running or that are not.</simpara>
<simpara>As a developer, you can use the API to develop a backup application.</simpara>
<formalpara>
<title>Features</title>
<para>Backups are simpler, faster and more robust than when using the Backup and Restore API. The Incremental Backup API provides improved integration with backup applications, with new support for backing up and restoring RAW guest data, regardless of the underlying disk format.</para>
</formalpara>
<itemizedlist>
<title>Limitations:</title>
<listitem>
<simpara>Only disks in QCOW2 format can be backed up incrementally, not RAW format disks. The backup process saves the backed up data in RAW format.</simpara>
</listitem>
<listitem>
<simpara>Only backed up data in RAW format can be restored.</simpara>
</listitem>
<listitem>
<simpara>Incremental restore does not support restoring snapshots as they existed at the time of the backup, rather incremental restore restores only the data and not the structure of volumes or images in snapshots as they existed at the time of the backup. This limit is common in backup solutions for other systems.</simpara>
</listitem>
<listitem>
<simpara>As is commonly the case with backup solutions, incremental restore restores only the data and not the structure of volumes or images in snapshots as they existed at the time of the backup.</simpara>
</listitem>
<listitem>
<simpara>An unclean shutdown of a virtual machine, whatever the cause, might invalidate bitmaps on the disk, which invalidates the entire backup chain. Restoring an incremental backup using an invalid bitmap leads to corrupt virtual machine data.</simpara>
<simpara>There is no way to detect an invalid bitmap, other than starting a backup. If the disk includes any invalid bitmaps, the operation fails.</simpara>
<simpara>To recover from invalid bitmaps, you must remove the entire backup chain and run a full backup.</simpara>
</listitem>
</itemizedlist>
<table frame="all" rowsep="1" colsep="1">
<title>How enabling incremental backup affects disk format:</title>
<tgroup cols="5">
<colspec colname="col_1" colwidth="20*"/>
<colspec colname="col_2" colwidth="20*"/>
<colspec colname="col_3" colwidth="20*"/>
<colspec colname="col_4" colwidth="20*"/>
<colspec colname="col_5" colwidth="20*"/>
<thead>
<row>
<entry align="left" valign="top">Storage type</entry>
<entry align="left" valign="top">Provisioning type</entry>
<entry align="left" valign="top">When incremental backup is&#8230;&#8203;</entry>
<entry align="left" valign="top">Virtual disk format is&#8230;&#8203;</entry>
<entry align="left" valign="top"></entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>block</simpara></entry>
<entry align="left" valign="top"><simpara>thin</simpara></entry>
<entry align="left" valign="top"><simpara>enabled</simpara></entry>
<entry align="left" valign="top"><simpara>qcow2</simpara></entry>
<entry align="left" valign="top"><simpara>block</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>thin</simpara></entry>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
<entry align="left" valign="top"><simpara>qcow2</simpara></entry>
<entry align="left" valign="top"><simpara>file</simpara></entry>
<entry align="left" valign="top"><simpara>thin</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>enabled</simpara></entry>
<entry align="left" valign="top"><simpara>qcow2</simpara></entry>
<entry align="left" valign="top"><simpara>file</simpara></entry>
<entry align="left" valign="top"><simpara>thin</simpara></entry>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>raw (sparse)</simpara></entry>
<entry align="left" valign="top"><simpara>block</simpara></entry>
<entry align="left" valign="top"><simpara>preallocated</simpara></entry>
<entry align="left" valign="top"><simpara>enabled</simpara></entry>
<entry align="left" valign="top"><simpara>qcow2 (preallocated)</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>block</simpara></entry>
<entry align="left" valign="top"><simpara>preallocated</simpara></entry>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
<entry align="left" valign="top"><simpara>raw (preallocated)</simpara></entry>
<entry align="left" valign="top"><simpara>file</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>preallocated</simpara></entry>
<entry align="left" valign="top"><simpara>enabled</simpara></entry>
<entry align="left" valign="top"><simpara>qcow2 (preallocated)</simpara></entry>
<entry align="left" valign="top"><simpara>file</simpara></entry>
<entry align="left" valign="top"><simpara>preallocated</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
<entry align="left" valign="top"><simpara>raw (preallocated)</simpara></entry>
<entry align="left" valign="top"><simpara>network</simpara></entry>
<entry align="left" valign="top"><simpara>Not applicable</simpara></entry>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>raw</simpara></entry>
<entry align="left" valign="top"><simpara>lun</simpara></entry>
<entry align="left" valign="top"><simpara>Not applicable</simpara></entry>
<entry align="left" valign="top"><simpara>disabled</simpara></entry>
<entry align="left" valign="top"><simpara>raw</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<section xml:id="_the_incremental_backup_flow">
<title>The Incremental Backup Flow</title>
<simpara>A backup application that uses the Incremental Backup API must follow this sequence to back up virtual machine disks that have already been enabled for incremental backup:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>The backup application uses the REST API to <link linkend="find-disks-enabled-for-incremental-backup">find virtual machine disks</link> that should be included in the backup. Only disks in QCOW2 format are included.</simpara>
</listitem>
<listitem>
<simpara>The backup application starts a <link linkend="start-a-full-backup_assembly_incremental-backup-and-restore">full backup</link> or an <link linkend="start-an-incremental-backup_assembly_incremental-backup-and-restore">incremental backup</link>. The API call specifies a virtual machine ID, an optional previous checkpoint ID, and a list of disks to back up. If the API call does not specify a previous checkpoint ID, a full backup begins, which includes all data in the specified disks, based on the current state of each disk.</simpara>
</listitem>
<listitem>
<simpara>The engine prepares the virtual machine for backup. The virtual machine can continue running during the backup.</simpara>
</listitem>
<listitem>
<simpara>The backup application polls the engine for the backup status, until the engine reports that the backup is ready to begin.</simpara>
</listitem>
<listitem>
<simpara>When the backup is ready to begin, the backup application <link linkend="image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">creates an image transfer object</link> for every disk included in the backup.</simpara>
</listitem>
<listitem>
<simpara>The backup application <link linkend="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">gets a list of changed blocks from <literal>ovirt-imageio</literal> for every image transfer</link>. If a change list is not available, the backup application gets an error.</simpara>
</listitem>
<listitem>
<simpara>The backup application <link linkend="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">downloads changed blocks in RAW format from <literal>ovirt-imageio</literal> and stores them in the backup media</link>. If a list of changed blocks is not available, the backup application can fall back to copying the entire disk.</simpara>
</listitem>
<listitem>
<simpara>The backup application finalizes all image transfers.</simpara>
</listitem>
<listitem>
<simpara>The backup application <link linkend="finalize-a-backup_assembly_incremental-backup-and-restore">finalizes the backup using the REST API</link>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="_the_incremental_restore_flow">
<title>The Incremental Restore Flow</title>
<simpara>A backup application that uses the Incremental Backup API must follow this sequence to restore virtual machine disks that have been backed up:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>The user selects a restore point based on available backups using the backup application.</simpara>
</listitem>
<listitem>
<simpara>The backup application creates a new disk or a snapshot with an existing disk to hold the restored data.</simpara>
</listitem>
<listitem>
<simpara>The backup application <link linkend="image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">starts an upload image transfer for every disk</link>, specifying <literal>format</literal> is <literal>raw</literal>. This enables format conversion when uploading RAW data to a QCOW2 disk.</simpara>
</listitem>
<listitem>
<simpara>The backup application <link linkend="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">transfers the data included in this restore point to <literal>imageio</literal> using the API</link>.</simpara>
</listitem>
<listitem>
<simpara>The backup application finalizes the image transfers.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="_incremental_backup_and_restore_api_tasks">
<title>Incremental Backup and Restore API Tasks</title>
<simpara>The Incremental Backup and Restore API is documented in the <link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index">oVirt REST API Guide</link>. The backup and restore flow requires the following actions.</simpara>
<itemizedlist>
<listitem>
<simpara>Enabling incremental backup on either a new or existing virtual disk:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="enabling-incremental-backup-on-a-new-disk_assembly_incremental-backup-and-restore">A new disk, using the Administration Portal</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="enabling-incremental-backup-on-an-existing-virtual-disk_assembly_incremental-backup-and-restore">An existing disk, using the Administration Portal</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">A new or existing disk, using an API call</link></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara><link linkend="find-disks-enabled-for-incremental-backup">Finding disks that are enabled for incremental backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="start-a-full-backup_assembly_incremental-backup-and-restore">Starting a full backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="start-an-incremental-backup_assembly_incremental-backup-and-restore">Starting an incremental backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="finalize-a-backup_assembly_incremental-backup-and-restore">Finalizing a backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="getting-information-about-a-backup_assembly_incremental-backup-and-restore">Getting information about a backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="getting-information-about-the-disks-in-a-backup_assembly_incremental-backup-and-restore">Getting information about the disks in a backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="listing-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing all checkpoints for a virtual machine</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="listing-specific-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing information for a specific virtual machine checkpoint</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="removing-a-checkpoint_assembly_incremental-backup-and-restore">Removing a checkpoint of a specific virtual machine</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">Downloading an image transfer object to archive a backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">Uploading an image transfer object to restore a backup</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">Listing changed blocks</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">Downloading and uploading changed blocks</link></simpara>
</listitem>
</itemizedlist>
<section xml:id="enabling-incremental-backup-on-a-new-disk_assembly_incremental-backup-and-restore">
<title>Enabling Incremental Backup on a new virtual disk</title>
<simpara role="_abstract">Enable incremental backup for a virtual disk to mark it as included in an incremental backup. When adding a disk, you can enable incremental backup for every disk, either with the REST API or using the Administration Portal. You can back up existing disks that are not enabled for incremental backup using full backup or in the same way you did previously.</simpara>
<note>
<simpara>The Engine does not require the disk to be enabled for it to be included in an incremental backup, but you can enable it to keep track of which disks are enabled.</simpara>
</note>
<simpara>Because incremental backup requires disks to be formatted in QCOW2, use QCOW2 format instead of RAW format.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Add a new virtual disk. For more information see <link linkend="Creating_a_Virtual_Disk">Creating a Virtual Disk</link>.</simpara>
</listitem>
<listitem>
<simpara>When configuring the disk, select the <emphasis role="strong">Enable Incremental Backup</emphasis> checkbox.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link linkend="enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">Enabling incremental backup for a disk using the API</link>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="enabling-incremental-backup-on-an-existing-virtual-disk_assembly_incremental-backup-and-restore">
<title>Enabling Incremental Backup on an existing RAW virtual disk</title>
<simpara>Because incremental backup is not supported for disks in RAW format, a QCOW2 format layer must exist on top of any RAW format disks in order to use incremental backup. Creating a snapshot generates a QCOW2 layer, enabling incremental backup on all disks that are included in the snapshot, from the point at which the snapshot is created.</simpara>
<warning>
<simpara>If the base layer of a disk uses RAW format, deleting the last snapshot and merging the top QCOW2 layer into the base layer converts the disk to RAW format, thereby disabling incremental backup if it was set. To re-enable incremental backup, you can create a new snapshot, including this disk.</simpara>
</warning>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select a virtual machine and click the <emphasis role="strong">Disks</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click the <guibutton>Edit</guibutton> button. The <emphasis role="strong">Edit Disk</emphasis> dialog box opens.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Enable Incremental Backup</emphasis> checkbox.</simpara>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link linkend="enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">Enabling incremental backup for a disk using the API</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">
<title>Enabling incremental backup</title>
<simpara role="_abstract">You can use a REST API request to enable incremental backup for a virtual machine’s disk.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Enable incremental backup for a new disk. For example, for a new disk on a virtual machine with id <literal>123</literal>, send this request:</simpara>
<screen>POST /ovirt-engine/api/vms/123/diskattachments</screen>
<simpara>The request body should include <literal>backup</literal> set to <literal>incremental</literal> as part of a <literal>disk</literal> object, like this:</simpara>
<screen>&lt;disk_attachment&gt;
    &#8230;&#8203;
    &lt;disk&gt;
       &#8230;&#8203;
       &lt;backup&gt;incremental&lt;/backup&gt;
       &#8230;&#8203;
    &lt;/disk&gt;
&lt;/disk_attachment&gt;</screen>
</listitem>
</itemizedlist>
<simpara>The response is:</simpara>
<screen>&lt;disk_attachment&gt;
    &#8230;&#8203;
    &lt;disk href="/ovirt-engine/api/disks/456" id="456"/&gt;
    &#8230;&#8203;
&lt;/disk_attachment&gt;</screen>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk_backup">DiskBackup enum</link> in the <emphasis>REST API Guide</emphasis> for oVirt</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="find-disks-enabled-for-incremental-backup">
<title>Finding disks that are enabled for incremental backup</title>
<simpara role="_abstract">For the specified virtual machine, you can list the disks that are enabled for incremental backup, filtered according to the backup property.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>List the disks that are attached to the virtual machine. For example, for a virtual machine with the id <literal>123</literal>, send this request:</simpara>
<screen>GET /ovirt-engine/api/vms/123/diskattachments</screen>
<simpara>The response includes all <literal>disk_attachment</literal> objects, each of which includes one or more <literal>disk</literal> objects. For example:</simpara>
<screen>&lt;disk_attachments&gt;
    &lt;disk_attachment&gt;
       &#8230;&#8203;
       &lt;disk href="/ovirt-engine/api/disks/456" id="456"/&gt;
       &#8230;&#8203;
    &lt;/disk_attachment&gt;
    &#8230;&#8203;
&lt;/disk_attachments&gt;</screen>
</listitem>
<listitem>
<simpara>Use the <literal>disk</literal> service to see the properties of a disk from the previous step. For example, for the disk with the id <literal>456</literal>, send this request:</simpara>
<screen>GET /ovirt-engine/api/disks/456</screen>
<simpara>The response includes all properties for the disk. <literal>backup</literal> is set to <literal>none</literal> or <literal>incremental</literal>. For example:</simpara>
<screen>&lt;disk href="/ovirt-engine/api/disks/456" id="456"&gt;
    &#8230;&#8203;
    &lt;backup&gt;incremental&lt;/backup&gt;
    &#8230;&#8203;
&lt;/disk&gt;</screen>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk"><literal>backup</literal> attribute of <literal>Disk</literal> struct</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk_backup"><literal>DiskBackup</literal> enum</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="start-a-full-backup_assembly_incremental-backup-and-restore">
<title>Starting a full backup</title>
<simpara role="_abstract">After a full backup you can use the resulting checkpoint id as the start point in the next incremental backup.</simpara>
<simpara>When taking a backup of a running virtual machine, the process creates a scratch disk on the same storage domain as the disk being backed up. The backup process creates this disk to enable new data to be written to the running virtual machine during the backup. You can see this scratch disk in the Administration Portal during the backup. It is automatically deleted when the backup finishes.</simpara>
<simpara>Starting a full backup requires a request call with a body, and includes a response.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Send a request specifying a virtual machine to back up. For example, specify a virtual machine with id <literal>123</literal> like this:</simpara>
<screen>POST /ovirt-engine/api/vms/123/backups</screen>
</listitem>
<listitem>
<simpara>In the request body, specify a disk to back up. For example, to start a full backup of a disk with id <literal>456</literal>, send the following request body:</simpara>
<screen>&lt;backup&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</screen>
<simpara>The response body should look similar to this:</simpara>
<screen>&lt;backup id="789"&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
       &#8230;&#8203;
    &lt;/disks&gt;
    &lt;status&gt;initializing&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</screen>
<simpara>The response includes the following:</simpara>
<itemizedlist>
<listitem>
<simpara>The backup id</simpara>
</listitem>
<listitem>
<simpara>The status of the backup, indicating that the backup is initializing.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Poll the backup until the status is <literal>ready</literal>. The response includes <literal>to_checkpoint_id</literal>. Note this id and use it for <literal>from_checkpoint_id</literal> in the next incremental backup.</simpara>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups"><literal>add</literal> method of the <literal>VmBackups</literal> service</link> in the <emphasis>REST API Guide</emphasis> for oVirt</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="start-an-incremental-backup_assembly_incremental-backup-and-restore">
<title>Starting an incremental backup</title>
<simpara role="_abstract">Once a full backup is completed for a given virtual disk, subsequent incremental backups that disk contain only the changes since the last backup. Use the value of <literal>to_checkpoint_id</literal> from the most recent backup as the value for <literal>from_checkpoint_id</literal> in the request body.</simpara>
<simpara>When taking a backup of a running virtual machine, the process creates a scratch disk on the same storage domain as the disk being backed up. The backup process creates this disk to enable new data to be written to the running virtual machine during the backup. You can see this scratch disk in the Administration Portal during the backup. It is automatically deleted when the backup finishes.</simpara>
<simpara>Starting an incremental backup or mixed backup requires a request call with a body, and includes a response.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Send a request specifying a virtual machine to back up. For example, specify a virtual machine with id <literal>123</literal> like this:</simpara>
<screen>POST /ovirt-engine/api/vms/123/backups</screen>
</listitem>
<listitem>
<simpara>In the request body, specify a disk to back up. For example, to start an incremental backup of a disk with id <literal>456</literal>, send the following request body:</simpara>
<screen>&lt;backup&gt;
    &lt;from_checkpoint_id&gt;<emphasis>previous-checkpoint-uuid</emphasis>&lt;/from_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</screen>
<note>
<simpara>In the request body, if you include a disk that is not included in the previous checkpoint, the request also runs a full backup of this disk. For example, a disk with id <literal>789</literal> has not been backed up yet. To add a full backup of <literal>789</literal> to the above request body, send a request body like this:</simpara>
<screen>&lt;backup&gt;
    &lt;from_checkpoint_id&gt;<emphasis>previous-checkpoint-uuid</emphasis>&lt;/from_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       <emphasis role="strong">&lt;disk id="789" /&gt;</emphasis>
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</screen>
</note>
<simpara>The response body should look similar to this:</simpara>
<screen>&lt;backup id="101112"&gt;
&lt;from_checkpoint_id&gt;<emphasis>previous-checkpoint-uuid</emphasis>&lt;/from_checkpoint_id&gt;
&lt;to_checkpoint_id&gt;<emphasis>new-checkpoint-uuid</emphasis>&lt;/to_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &lt;disk id="789" /&gt;
       &#8230;&#8203;
       &#8230;&#8203;
    &lt;/disks&gt;
    &lt;status&gt;initializing&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</screen>
<simpara>The response includes the following:</simpara>
<itemizedlist>
<listitem>
<simpara>The backup id.</simpara>
</listitem>
<listitem>
<simpara>The id of any disk that was included in the backup.</simpara>
</listitem>
<listitem>
<simpara>The status, indicating that the backup is initializing.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Poll the backup until the status is <literal>ready</literal>. The response includes <literal>to_checkpoint_id</literal>. Note this id and use it for <literal>from_checkpoint_id</literal> in the next incremental backup.</simpara>
</listitem>
</orderedlist>
<itemizedlist role="_additonal-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups-methods-add"><literal>add</literal> method of the VmBackups service</link>  in the <emphasis>REST API Guide</emphasis> for oVirt.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="getting-information-about-a-backup_assembly_incremental-backup-and-restore">
<title>Getting information about a backup</title>
<simpara role="_abstract">You can get information about a backup that you can use to start a new incremental backup.</simpara>
<simpara>The <literal>list</literal> method of the VmBackups service returns the following information about a backup:</simpara>
<itemizedlist>
<listitem>
<simpara>the id of each disk that was backed up</simpara>
</listitem>
<listitem>
<simpara>the ids of the start and end checkpoints of the backup</simpara>
</listitem>
<listitem>
<simpara>the id of the disk image of the backup, for each disk included in the backup</simpara>
</listitem>
<listitem>
<simpara>the status of the backup</simpara>
</listitem>
<listitem>
<simpara>the date the backup was created</simpara>
</listitem>
</itemizedlist>
<simpara>When the value of &lt;status&gt; is <literal>ready</literal>, the response includes &lt;to_checkpoint_id&gt; which should be used as the &lt;from_checkpoint_id&gt; in the next incremental backup and you can start downloading the disks to back up the virtual machine storage.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To get information about a backup with id 456 of a virtual machine with id 123, send a request like this:</simpara>
<screen>GET /ovirt-engine/api/vms/456/backups/123</screen>
<simpara>The response includes the backup with id 456, with &lt;from_checkpoint_id&gt; 999 and &lt;to_checkpoint_id&gt; 666. The disks included in the backup are referenced in the &lt;link&gt; element.</simpara>
<screen>&lt;backup id="456"&gt;
    &lt;from_checkpoint_id&gt;999&lt;/from_checkpoint_id&gt;
    &lt;to_checkpoint_id&gt;666&lt;/to_checkpoint_id&gt;
    &lt;link href="/ovirt-engine/api/vms/456/backups/123/disks" rel="disks"/&gt;
    &lt;status&gt;ready&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</screen>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups-methods-list"><literal>list</literal> method of the VmBackups service</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="getting-information-about-the-disks-in-a-backup_assembly_incremental-backup-and-restore">
<title>Getting information about the disks in a backup</title>
<simpara role="_abstract">You can get information about the disks that are part of the backup, including the backup mode that was used for each disk in a backup, which helps determine the mode that you use to download the backup.</simpara>
<simpara>The <literal>list</literal> method of the VmBackupDisks service returns the following information about a backup:</simpara>
<itemizedlist>
<listitem>
<simpara>The id and name of each disk that was backed up.</simpara>
</listitem>
<listitem>
<simpara>The id of the disk image of the backup, for each disk included in the backup.</simpara>
</listitem>
<listitem>
<simpara>The disk format.</simpara>
</listitem>
<listitem>
<simpara>The backup behavior supported by the disk.</simpara>
</listitem>
<listitem>
<simpara>The backup type that was taken for the disk (full/incremental).</simpara>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To get information about a backup with id 456 of a virtual machine with id 123, send a request like this:</simpara>
<screen>GET /ovirt-engine/api/vms/456/backups/123/disks</screen>
<simpara>The response includes the disk with id 789, and the id of the disk image is 555.</simpara>
<screen>&lt;disks&gt;
    &lt;disk id="789"&gt;
        &lt;name&gt;vm1_Disk1&lt;/name&gt;
        &lt;actual_size&gt;671744&lt;/actual_size&gt;
        &lt;backup&gt;incremental&lt;/backup&gt;
        &lt;backup_mode&gt;full&lt;/backup_mode&gt;
        &lt;format&gt;cow&lt;/format&gt;
        &lt;image_id&gt;555&lt;/image_id&gt;
        &lt;qcow_version&gt;qcow2_v3&lt;/qcow_version&gt;
        &lt;status&gt;locked&lt;/status&gt;
        &lt;storage_type&gt;image&lt;/storage_type&gt;
        &lt;total_size&gt;0&lt;/total_size&gt;
    &lt;/disk&gt;
&lt;/disks&gt;</screen>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backup_disks"><literal>list</literal> method of the VmBackupDisks service</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="finalize-a-backup_assembly_incremental-backup-and-restore">
<title>Finalizing a backup</title>
<simpara role="_abstract">Finalizing a backup ends the backup, unlocks resources, and performs cleanups. Use the <literal>finalize</literal> backup service method</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>To finalize a backup of a disk with id <literal>456</literal> on a virtual machine with id <literal>123</literal>, send a request like this:</simpara>
<screen>POST /vms/123/backups/456/finalize</screen>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backup-methods-finalize">finalize POST</link> in the <emphasis>REST API Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">
<title>Creating an image transfer object for incremental backup</title>
<simpara role="_abstract">When the backup is ready to download, the backup application should create an <literal>imagetransfer</literal> object, which initiates a transfer for an incremental backup.</simpara>
<simpara>Creating an image transfer object requires a request call with a body.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Send a request like this:</simpara>
<screen>POST /ovirt-engine/api/imagetransfers</screen>
</listitem>
<listitem>
<simpara>In the request body, specify the following parameters:</simpara>
<itemizedlist>
<listitem>
<simpara>disk id</simpara>
</listitem>
<listitem>
<simpara>backup id</simpara>
</listitem>
<listitem>
<simpara>direction of the disk set to <literal>download</literal></simpara>
</listitem>
<listitem>
<simpara>format of the disk set to <literal>raw</literal></simpara>
</listitem>
</itemizedlist>
<simpara>For example, to transfer a backup of a disk where the id of the disk is <literal>123</literal> and the id of the backup is <literal>456</literal>, send the following request body:</simpara>
<screen>&lt;image_transfer&gt;
    &lt;disk id="123"/&gt;
    &lt;backup id="456"/&gt;
    &lt;direction&gt;download&lt;/direction&gt;
    &lt;format&gt;raw&lt;/format&gt;
&lt;/image_transfer&gt;</screen>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers-methods-add"><literal>add</literal> method for creating an imagetransfer object</link> in the <emphasis>REST API Guide</emphasis> for oVirt.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">
<title>Creating an image transfer object for incremental restore</title>
<simpara role="_abstract">To enable restoring raw data backed up using the incremental backup API to a QCOW2-formatted disk, the backup application should create an <literal>imagetransfer</literal> object.</simpara>
<simpara>When the transfer format is <literal>raw</literal> and the underlying disk format is QCOW2, uploaded data is converted on the fly to QCOW2 format when writing to storage. Uploading data from a QCOW2 disk to a RAW disk is not supported.</simpara>
<simpara>Creating an image transfer object requires a request call with a body.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Send a request like this:</simpara>
<screen>POST /ovirt-engine/api/imagetransfers</screen>
</listitem>
<listitem>
<simpara>In the request body, specify the following parameters:</simpara>
<itemizedlist>
<listitem>
<simpara>disk id or snapshot id</simpara>
</listitem>
<listitem>
<simpara>direction of the disk set to <literal>upload</literal></simpara>
</listitem>
<listitem>
<simpara>format of the disk set to <literal>raw</literal></simpara>
</listitem>
</itemizedlist>
<simpara>For example, to transfer a backup of a disk where the id of the disk is <literal>123</literal>, send the following request body:</simpara>
<screen>&lt;image_transfer&gt;
    &lt;disk id="123"/&gt;
    &lt;direction&gt;upload&lt;/direction&gt;
    &lt;format&gt;raw&lt;/format&gt;
&lt;/image_transfer&gt;</screen>
</listitem>
</orderedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers-methods-add"><literal>add</literal> method for creating an imagetransfer object</link> in the <emphasis>REST API Guide</emphasis> for oVirt.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="listing-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">
<title>Listing checkpoints for a virtual machine</title>
<simpara role="_abstract">You can list all checkpoints for a virtual machine, including information for each checkpoint, by sending a request call.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Send a request specifying a virtual machine. For example, specify a virtual machine with id <literal>123</literal> like this:</simpara>
<screen>GET /vms/123/checkpoints/</screen>
</listitem>
</itemizedlist>
<simpara>The response includes all the virtual machine checkpoints. Each checkpoint contains the following information:</simpara>
<itemizedlist>
<listitem>
<simpara>The checkpoint’s disks</simpara>
</listitem>
<listitem>
<simpara>The id of the parent checkpoint</simpara>
</listitem>
<listitem>
<simpara>Creation date of the checkpoint</simpara>
</listitem>
<listitem>
<simpara>The virtual machine to which it belongs</simpara>
</listitem>
</itemizedlist>
<simpara>For example:</simpara>
<screen>&lt;parent_id&gt;, &lt;creation_date&gt; and the virtual machine it belongs to &lt;vm&gt;:
&lt;checkpoints&gt;
    &lt;checkpoint id="456"&gt;
         &lt;link href="/ovirt-engine/api/vms/vm-uuid/checkpoints/456/disks" rel="disks"/&gt;
         &lt;parent_id&gt;parent-checkpoint-uuid&lt;/parent_id&gt;
         &lt;creation_date&gt;xxx&lt;/creation_date&gt;
         &lt;vm href="/ovirt-engine/api/vms/123" id="123"/&gt;
    &lt;/checkpoint&gt;
&lt;/checkpoints&gt;</screen>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoints-methods-list"><literal>list</literal> method to list virtual machine checkpoints</link> in the <emphasis>REST API Guide</emphasis> for oVirt.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="listing-specific-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">
<title>Listing a specific checkpoint for a virtual machine</title>
<simpara role="_abstract">You can list information for a specific checkpoint for a virtual machine by sending a request call.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Send a request specifying a virtual machine. For example, specify a virtual machine with id <literal>123</literal> and checkpoint id <literal>456</literal> like this:</simpara>
<screen>GET /vms/123/checkpoints/456</screen>
</listitem>
</itemizedlist>
<simpara>The response includes the following information for the checkpoint:</simpara>
<itemizedlist>
<listitem>
<simpara>The checkpoint’s disks</simpara>
</listitem>
<listitem>
<simpara>The id of the parent checkpoint</simpara>
</listitem>
<listitem>
<simpara>Creation date of the checkpoint</simpara>
</listitem>
<listitem>
<simpara>The virtual machine to which it belongs</simpara>
</listitem>
</itemizedlist>
<simpara>For example:</simpara>
<screen>&lt;checkpoint id="456"&gt;
     &lt;link href="/ovirt-engine/api/vms/vm-uuid/checkpoints/456/disks" rel="disks"/&gt;
     &lt;parent_id&gt;parent-checkpoint-uuid&lt;/parent_id&gt;
     &lt;creation_date&gt;xxx&lt;/creation_date&gt;
     &lt;vm href="/ovirt-engine/api/vms/123" id="123"/&gt;
&lt;/checkpoint&gt;</screen>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoints-methods-list"><literal>list</literal> method to list virtual machine checkpoints</link> in the <emphasis>REST API Guide</emphasis> for oVirt.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="removing-a-checkpoint_assembly_incremental-backup-and-restore">
<title>Removing a checkpoint</title>
<simpara role="_abstract">You can remove a checkpoint of a virtual machine by sending a DELETE request. You can remove a checkpoint on a virtual machine whether it is running or not.</simpara>
<itemizedlist>
<title>Procedure</title>
<listitem>
<simpara>Send a request specifying a virtual machine and a checkpoint. For example, specify a virtual machine with id <literal>123</literal> and a checkpoint with id <literal>456</literal> like this:</simpara>
<screen>DELETE /vms/123/checkpoints/456/</screen>
</listitem>
</itemizedlist>
<itemizedlist role="_additional-resources">
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoint-methods-remove"><literal>remove</literal> method of VmCheckpoint</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">
<title>Using the imageio API to transfer backup data</title>
<simpara role="_abstract">Image transfer APIs start and stop an image transfer. The result is a
transfer URL.</simpara>
<simpara>You use the imageio API to actually transfer the data from the transfer URL.</simpara>
<simpara>For complete information on using the imageio API, see the <link xl:href="http://ovirt.github.io/ovirt-imageio/images.html">ovirt-imageio Images API reference</link>.</simpara>
<table xml:id="imageio-Image-API-methods-used-in-incremental-backup-and-restore" frame="all" rowsep="1" colsep="1">
<title>imageio Image API methods used in incremental backup and restore</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">API request</entry>
<entry align="left" valign="top">Description</entry>
<entry align="left" valign="top">imageio Image API reference section</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>OPTIONS /images/{ticket-id} HTTP/1.1</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Gets the server options, to find out what features the server supports.</simpara></entry>
<entry align="left" valign="top"><simpara>See <emphasis>OPTIONS</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>GET /images/{ticket-id}/extents</literal></simpara></entry>
<entry align="left" valign="top"><simpara>Gets information about disk image content and allocation, or about blocks that changed during an incremental backup. This information is known as <emphasis>extent</emphasis> information.</simpara></entry>
<entry align="left" valign="top"><simpara>See <emphasis>EXTENTS</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>GET /images/{ticket-id}/extent?context=dirty</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The program doing image transfer needs to download changes from the backup. These changes are know as dirty extents. To download changes, send a request like this:</simpara></entry>
<entry align="left" valign="top"><simpara>See <emphasis>EXTENTS</emphasis>&#8594; <emphasis>Examples</emphasis>&#8594; <emphasis>Request dirty extents</emphasis></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>PUT /images/{ticket-id}</literal></simpara></entry>
<entry align="left" valign="top"><simpara>The backup application creates a new disk or a snapshot with an existing disk to hold the restored data.</simpara></entry>
<entry align="left" valign="top"><simpara>See <emphasis>PUT</emphasis></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara role="_additional-resources">
<title>Additional resources</title>
<para>The oVirt Python SDK includes several implementation examples you can use to get started with transferring backups:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="http://ovirt.github.io/ovirt-imageio/images.html">ovirt-imageio Images API reference</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/upload_disk.py">Creating a disk</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/upload_disk.py#L241">Calling imagetransfer.create_transfer()</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/helpers/imagetransfer.py#L123">a helper to simplify creating a transfer</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://github.com/oVirt/ovirt-engine-sdk/tree/master/sdk">oVirt Engine API Python SDK</link></simpara>
</listitem>
</itemizedlist>
</section>
</section>
</section>
</chapter>
<chapter xml:id="chap-Errata_Management_with_Satellite">
<title>Setting up errata viewing with Red Hat Satellite</title>
<simpara>In the Administration Portal, you can configure oVirt to view errata from Red Hat Satellite in the oVirt Engine. After you associate your hosts, virtual machines, and the Engine with a Red Hat Satellite provider, you can receive updates about available errata and their importance, and decide when to apply them. For more information about Red Hat Satellite see the <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/">Red Hat Satellite Documentation</link>.</simpara>
<simpara>oVirt 4.4 supports viewing errata with Red Hat Satellite 6.6.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>The Satellite server must be added as an external provider.</simpara>
</listitem>
<listitem>
<simpara>The Engine, hosts, and virtual machines must all be registered in the Satellite server by their respective FQDNs. This ensures that external content host IDs do not need to be maintained in oVirt.</simpara>
</listitem>
<listitem>
<simpara>The Satellite account that manages the Engine, hosts and virtual machines must have Administrator permissions and a default organization set.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely.</simpara>
</note>
<formalpara>
<title>Configuring oVirt errata</title>
<para>To associate the Engine, host, and virtual machine with a Red Hat Satellite provider, complete the following tasks:</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara><link linkend="Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">Add the required Satellite server to the Engine as an external provider</link>.</simpara>
</listitem>
<listitem>
<simpara><link linkend="Configuring_Satellite_Errata_Management_for_a_Host">Configure the required hosts to display available errata</link>.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_Satellite_Errata">Configure the required virtual machines to display available errata</link>.</simpara>
</listitem>
</orderedlist>
<orderedlist numeration="arabic">
<title>Viewing oVirt Engine errata</title>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Errata</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Security</emphasis>, <emphasis role="strong">Bugs</emphasis>, or <emphasis role="strong">Enhancements</emphasis> check boxes to view only those errata types.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><xref linkend="Configuring_Satellite_Errata_Management_for_a_Host"/></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents, Tools, and Drivers on Linux</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for Enterprise Linux virtual machines.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Windows">Installing the Guest Agents, Tools, and Drivers on Windows</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for Windows virtual machines.</simpara>
</listitem>
<listitem>
<simpara><xref linkend="Viewing_Host_Errata"/></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_Satellite_Errata">Configuring Satellite errata viewing for a virtual machine</link> in the <emphasis>Virtual Machine Management Guide</emphasis> for more information.</simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Viewing_Satellite_Errata">Viewing Red Hat Satellite errata for a virtual machine</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</listitem>
</itemizedlist>
</chapter>
<chapter xml:id="chap-Automating_RHV_Configuration_using_Ansible">
<title>Automating Configuration Tasks using Ansible</title>
<simpara>Ansible is an automation tool used to configure systems, deploy software, and perform rolling updates. Ansible includes support for oVirt, and Ansible modules are available to allow you to automate post-installation tasks such as data center setup and configuration, managing users, or virtual machine operations.</simpara>
<simpara>Ansible provides an easier method of automating oVirt configuration compared to REST APIs and SDKs, and allows you to integrate with other Ansible modules. For more information about the Ansible modules available for oVirt, see the <link xl:href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">oVirt Ansible Collection</link> in the Red Hat Ansible Automation Hub documentation.</simpara>
<note>
<simpara>Ansible Tower is a graphically enabled framework accessible through a web interface and REST APIs for Ansible. If you want support for Ansible Tower, then you must have an Ansible Tower license, which is not part of the oVirt subscription.</simpara>
</note>
<simpara>Ansible is shipped with oVirt. To install Ansible, run the following command on the Engine machine:</simpara>
<screen># dnf install ansible</screen>
<simpara>See the <link xl:href="http://docs.ansible.com/">Ansible Documentation</link> for alternate installation instructions, and information about using Ansible.</simpara>
<section xml:id="oVirt_Ansible_Collection">
<title>oVirt Ansible Collection</title>
<simpara><emphasis role="strong">oVirt Ansible Collection</emphasis> provides modules, roles, and plugins for managing various parts of the Red Hat Virtualization infrastructure.
The modules are used for communication between Ansible and the Red Hat Virtualization Manager.
Ansible roles provide a method of modularizing Ansible code by breaking up large playbooks into smaller reusable files that can be shared with other users.
For more information about <emphasis role="strong">oVirt Ansible Collection</emphasis>, see the <link xl:href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">Automation Hub</link> documentation.</simpara>
</section>
<section xml:id="Installing_ovirt_Ansible_Collection">
<title>Installing oVirt Ansible Collection from an RPM package</title>
<simpara>You can install <emphasis role="strong">oVirt Ansible Collection</emphasis> for Red Hat Virtualization from the Red Hat Virtualization Manager repository.</simpara>
<formalpara>
<title>Prerequisites</title>
<para>To install oVirt Ansible Collection, you must subscribe to one of the following subscription channels:</para>
</formalpara>
<itemizedlist>
<listitem>
<simpara>Using a Red Hat Virtualization subscription - <emphasis role="strong">rhv-4.4-manager-for-rhel-8-x86_64-rpms</emphasis></simpara>
</listitem>
<listitem>
<simpara>Using any Red Hat Enterprise Linux subscription - <emphasis role="strong">rhv-4-tools-for-rhel-8-x86_64-rpms</emphasis></simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Run the following command to install the <emphasis role="strong">oVirt Ansible Collection</emphasis> on the Manager machine:</simpara>
<screen># dnf install ovirt-ansible-collection</screen>
</listitem>
<listitem>
<simpara>By default, the collection is installed to:</simpara>
<simpara><emphasis role="strong">/usr/share/ansible/collections/ansible_collections/redhat/rhv</emphasis>.</simpara>
<simpara>The structure of the <literal>ovirt-ansible-collection</literal> package is as follows:</simpara>
<simpara><emphasis role="strong">/usr/share/ansible/collections/ansible_collections/redhat/rhv</emphasis>
<emphasis role="strong">/usr/share/doc/ovirt-ansible-collection/</emphasis></simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Installing_Ansible_Collection_from_Automation_Hub">
<title>Installing oVirt Ansible Collection from Automation Hub</title>
<simpara>Automation Hub is a new place that can be used to install <emphasis role="strong">oVirt Ansible Collection</emphasis>.
To configure the environment, follow the instructions in <link xl:href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">oVirt Ansible Collection documentation</link>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Install the collection</simpara>
<screen># ansible-galaxy collection install redhat.rhv</screen>
</listitem>
<listitem>
<simpara>The Automation Hub currently does not install RPM dependencies. Make sure that you have these packages on the host where you execute the playbook:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>python3-ovirt-engine-sdk4</literal></simpara>
</listitem>
<listitem>
<simpara><literal>python3-netaddr</literal></simpara>
</listitem>
<listitem>
<simpara><literal>python3-jmespath</literal></simpara>
</listitem>
<listitem>
<simpara><literal>python3-passlib</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="Using_Ansible_Collection">
<title>Using oVirt Ansible Collection to Configure oVirt</title>
<simpara>The following procedure guides you through creating and running a playbook that uses <emphasis role="strong">oVirt Ansible Collection</emphasis> to configure Red Hat Virtualization. This example uses Ansible to connect to the Manager on the local machine and create a new data center.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Ensure that you have the Python SDK installed on the machine running the playbook.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Create your playbook.</simpara>
<screen>- name: RHV infrastructure
  hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
   # Contains variables to connect to the Manager
   - engine_vars.yml
   # Contains encrypted engine_password variable using ansible-vault
   - passwords.yml

  pre_tasks:
   # The use of redhat.rhv before ovirt_auth is to check if oVirt Ansible Collection is correctly loaded
   - name: Login to RHV
     redhat.rhv.ovirt_auth:
       hostname: "{{ engine_fqdn }}"
       username: "{{ engine_user }}"
       password: "{{ engine_password }}"
       ca_file: "{{ engine_cafile | default(omit) }}"
       insecure: "{{ engine_insecure | default(true) }}"
     tags:
       - always

 vars:
   data_center_name: mydatacenter
   data_center_description: mydatacenter
   data_center_local: false
   compatibility_version: 4.4

 roles:
   - infra
 collections:
   - redhat.rhv
 post_tasks:
   - name: Logout from RHV
     ovirt_auth:
       state: absent
       ovirt_auth: "{{ ovirt_auth }}"
     tags:
       - always</screen>
</listitem>
</orderedlist>
<simpara>You have successfully used the <literal>infra</literal> Ansible role from <emphasis role="strong">oVirt Ansible Collection</emphasis> to create a data center named <literal>mydatacenter</literal>.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Users_and_Roles">
<title>Users and Roles</title>
<section xml:id="Introduction_to_users">
<title>Introduction to Users</title>
<simpara>In oVirt, there are two types of user domains: local domain and external domain. A default local domain called the <emphasis role="strong">internal</emphasis> domain and a default user <emphasis role="strong">admin</emphasis> is created during the the Engine installation process.</simpara>
<simpara>You can create additional users on the <emphasis role="strong">internal</emphasis> domain using <literal>ovirt-aaa-jdbc-tool</literal>. User accounts created on local domains are known as local users. You can also attach external directory servers such as Red Hat Directory Server, Active Directory, OpenLDAP, and many other supported options to your oVirt environment and use them as external domains. User accounts created on external domains are known as directory users.</simpara>
<simpara>Both local users and directory users need to be assigned with appropriate roles and permissions through the Administration Portal before they can function in the environment. There are two main types of user roles: end user and administrator. An end user role uses and manages virtual resources from the VM Portal. An administrator role maintains the system infrastructure using the Administration Portal. The roles can be assigned to the users for individual resources like virtual machines and hosts, or on a hierarchy of objects like clusters and data centers.</simpara>
</section>
<section xml:id="Introduction_to_Directory_Servers">
<title>Introduction to Directory Servers</title>
<simpara>During installation, oVirt Engine creates an <emphasis role="strong">admin</emphasis> user on the <emphasis role="strong">internal</emphasis> domain. The user is also referred to as <literal>admin@internal</literal>. This account is intended for use when initially configuring the environment and for troubleshooting. After you have attached an external directory server, added the directory users, and assigned them with appropriate roles and permissions, the <literal>admin@internal</literal> user can be disabled if it is not required.The directory servers supported are:</simpara>
<itemizedlist>
<listitem>
<simpara>389ds</simpara>
</listitem>
<listitem>
<simpara>389ds RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>Active Directory</simpara>
</listitem>
<listitem>
<simpara>IBM Security Directory Server</simpara>
</listitem>
<listitem>
<simpara>IBM Security Directory Server RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>FreeIPA</simpara>
</listitem>
<listitem>
<simpara>iDM</simpara>
</listitem>
<listitem>
<simpara>Novell eDirectory RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>OpenLDAP RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>OpenLDAP Standard Schema</simpara>
</listitem>
<listitem>
<simpara>Oracle Unified Directory RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>RFC-2307 Schema (Generic)</simpara>
</listitem>
<listitem>
<simpara>Red Hat Directory Server (RHDS)</simpara>
</listitem>
<listitem>
<simpara>Red Hat Directory Server (RHDS) RFC-2307 Schema</simpara>
</listitem>
<listitem>
<simpara>iPlanet</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>It is not possible to install oVirt Engine (<literal>rhevm</literal>) and IdM (<literal>ipa-server</literal>) on the same system. IdM is incompatible with the <literal>mod_ssl</literal> package, which is required by oVirt Engine.</simpara>
</important>
<important>
<simpara>If you are using Active Directory as your directory server, and you want to use <emphasis role="strong">sysprep</emphasis> in the creation of templates and virtual machines, then the oVirt administrative user must be delegated control over the Domain to:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Join a computer to the domain</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Modify the membership of a group</emphasis></simpara>
</listitem>
</itemizedlist>
<simpara>For information on creation of user accounts in Active Directory, see <link xl:href="http://technet.microsoft.com/en-us/library/cc732336.aspx">http://technet.microsoft.com/en-us/library/cc732336.aspx</link>.</simpara>
<simpara>For information on delegation of control in Active Directory, see <link xl:href="http://technet.microsoft.com/en-us/library/cc732524.aspx">http://technet.microsoft.com/en-us/library/cc732524.aspx</link>.</simpara>
</important>
</section>
<section xml:id="sect-Configuring_an_External_LDAP_Provider">
<title>Configuring an External LDAP Provider</title>
<section xml:id="Configuring_an_External_LDAP_Provider">
<title>Configuring an External LDAP Provider (Interactive Setup)</title>
<simpara>The <emphasis role="strong">ovirt-engine-extension-aaa-ldap</emphasis> extension allows users to customize their external directory setup easily. The <emphasis role="strong">ovirt-engine-extension-aaa-ldap</emphasis> extension supports many different LDAP server types, and an interactive setup script is provided to assist you with the setup for most LDAP types.</simpara>
<simpara>If the LDAP server type is not listed in the interactive setup script, or you want to do more customization, you can manually edit the configuration files. See <xref linkend="Configuring_an_External_LDAP_Provider_ManualMethod"/> for more information.</simpara>
<simpara>For an Active Directory example, see <xref linkend="Attaching_an_Active_Directory"/>.</simpara>
<simpara><emphasis role="strong">Prerequisites:</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>You must know the domain name of the DNS or the LDAP server.</simpara>
</listitem>
<listitem>
<simpara>To set up secure connection between the LDAP server and the Engine, ensure that a PEM-encoded CA certificate has been prepared.</simpara>
</listitem>
<listitem>
<simpara>Have at least one set of account name and password ready to perform search and login queries to the LDAP server.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Configuring an External LDAP Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, install the LDAP extension package:</simpara>
<screen># dnf install ovirt-engine-extension-aaa-ldap-setup</screen>
</listitem>
<listitem>
<simpara>Run <literal>ovirt-engine-extension-aaa-ldap-setup</literal> to start the interactive setup:</simpara>
<screen># ovirt-engine-extension-aaa-ldap-setup</screen>
</listitem>
<listitem>
<simpara>Select an LDAP type by entering the corresponding number. If you are not sure which schema your LDAP server is, select the standard schema of your LDAP server type. For Active Directory, follow the procedure at <xref linkend="Attaching_an_Active_Directory"/>.</simpara>
<screen>Available LDAP implementations:
 1 - 389ds
 2 - 389ds RFC-2307 Schema
 3 - Active Directory
 4 - IBM Security Directory Server
 5 - IBM Security Directory Server RFC-2307 Schema
 6 - IPA
 7 - Novell eDirectory RFC-2307 Schema
 8 - OpenLDAP RFC-2307 Schema
 9 - OpenLDAP Standard Schema
10 - Oracle Unified Directory RFC-2307 Schema
11 - RFC-2307 Schema (Generic)
12 - RHDS
13 - RHDS RFC-2307 Schema
14 - iPlanet
Please select:</screen>
</listitem>
<listitem>
<simpara>Press <literal>Enter</literal> to accept the default and configure domain name resolution for your LDAP server name:</simpara>
<screen>It is highly recommended to use DNS resolution for LDAP server.
If for some reason you intend to use hosts or plain address disable DNS usage.
Use DNS (Yes, No) [Yes]:</screen>
</listitem>
<listitem>
<simpara>Select a DNS policy method:</simpara>
<itemizedlist>
<listitem>
<simpara>For option 1, the DNS servers listed in <emphasis role="strong">/etc/resolv.conf</emphasis> are used to resolve the IP address. Check that the <emphasis role="strong">/etc/resolv.conf</emphasis> file is updated with the correct DNS servers.</simpara>
</listitem>
<listitem>
<simpara>For option 2, enter the fully qualified domain name (FQDN) or the IP address of the LDAP server. You can use the <literal>dig</literal> command with the SRV record to find out the domain name. An SRV record takes the following format:</simpara>
<screen><emphasis>_service._protocol</emphasis>.<emphasis>domain_name</emphasis></screen>
<simpara>Example: <literal>dig _ldap._tcp.redhat.com SRV</literal>.</simpara>
</listitem>
<listitem>
<simpara>For option 3, enter a space-separated list of LDAP servers. Use either the FQDN or IP address of the servers. This policy provides load-balancing between the LDAP servers. Queries are distributed among all LDAP servers according to the round-robin algorithm.</simpara>
</listitem>
<listitem>
<simpara>For option 4, enter a space-separated list of LDAP servers. Use either the FQDN or IP address of the servers. This policy defines the first LDAP server to be the default LDAP server to respond to queries. If the first server is not available, the query will go to the next LDAP server on the list.</simpara>
<screen>1 - Single server
2 - DNS domain LDAP SRV record
3 - Round-robin between multiple hosts
4 - Failover between multiple hosts
Please select:</screen>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Select the secure connection method your LDAP server supports and specify the method to obtain a PEM-encoded CA certificate:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>File</literal> allows you to provide the full path to the certificate.</simpara>
</listitem>
<listitem>
<simpara><literal>URL</literal> allows you to specify a URL for the certificate.</simpara>
</listitem>
<listitem>
<simpara><literal>Inline</literal> allows you to paste the content of the certificate in the terminal.</simpara>
</listitem>
<listitem>
<simpara><literal>System</literal> allows you to specify the default location for all CA files.</simpara>
</listitem>
<listitem>
<simpara><literal>Insecure</literal> skips certificate validation, but the connection is still encrypted using TLS.</simpara>
<screen>NOTE:
It is highly recommended to use secure protocol to access the LDAP server.
Protocol startTLS is the standard recommended method to do so.
Only in cases in which the startTLS is not supported, fallback to non standard ldaps protocol.
Use plain for test environments only.
Please select protocol to use (startTLS, ldaps, plain) [startTLS]: <emphasis>startTLS</emphasis>
Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure):
Please enter the password:</screen>
<note>
<simpara>LDAPS stands for Lightweight Directory Access Protocol Over Secure Socket Links. For SSL connections, select the <literal>ldaps</literal> option.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Enter the search user distinguished name (DN). The user must have permissions to browse all users and groups on the directory server. The search user must be specified in LDAP annotation. If anonymous search is allowed, press <literal>Enter</literal> without any input.</simpara>
<screen>Enter search user DN (for example uid=username,dc=example,dc=com or leave empty for anonymous): <literal>uid=user1,ou=Users,ou=department-1,dc=example,dc=com</literal>
Enter search user password:</screen>
</listitem>
<listitem>
<simpara>Enter the base DN:</simpara>
<screen>Please enter base DN (dc=redhat,dc=com) [dc=redhat,dc=com]: <emphasis>ou=department-1,dc=redhat,dc=com</emphasis></screen>
</listitem>
<listitem>
<simpara>Select <literal>Yes</literal> if you intend to configure single sign-on for virtual machines. Note that the feature cannot be used with single sign-on to the Administration Portal feature. The script reminds you that the profile name must match the domain name. You will still need to follow the instructions in <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Configuring_Single_Sign-On_for_Virtual_Machines">Configuring Single Sign-On for Virtual Machines</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
<screen>Are you going to use Single Sign-On for Virtual Machines (Yes, No) [Yes]:</screen>
</listitem>
<listitem>
<simpara>Specify a profile name. The profile name is visible to users on the login page. This example uses <literal>redhat.com</literal>.</simpara>
<note>
<simpara>To rename the profile after the domain has been configured, edit the <literal>ovirt.engine.aaa.authn.profile.name</literal> attribute in the <emphasis role="strong">/etc/ovirt-engine/extensions.d/<emphasis>redhat.com</emphasis>-authn.properties</emphasis> file. Restart the <literal>ovirt-engine</literal> service for the changes to take effect.</simpara>
</note>
<screen>Please specify profile name that will be visible to users: <emphasis>redhat.com</emphasis></screen>
<figure>
<title>The Administration Portal Login Page</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/AAA_login_profile.png"/>
</imageobject>
<textobject><phrase>AAA login profile</phrase></textobject>
</mediaobject>
</figure>
<note>
<simpara>Users must select the profile from the drop-down list when logging in for the first time. The information is stored in browser cookies and preselected the next time the user logs in.</simpara>
</note>
</listitem>
<listitem>
<simpara>Test the login function to ensure your LDAP server is connected to your oVirt environment properly. For the login query, enter your <literal>user name</literal> and <literal>password</literal>:</simpara>
<screen>NOTE:
It is highly recommended to test drive the configuration before applying it into engine.
Login sequence is executed automatically, but it is recommended to also execute Search sequence manually after successful Login sequence.

Please provide credentials to test login flow:
Enter user name:
Enter user password:
[ INFO  ] Executing login sequence...
...
[ INFO  ] Login sequence executed successfully</screen>
</listitem>
<listitem>
<simpara>Check that the user details are correct. If the user details are incorrect, select <literal>Abort</literal>:</simpara>
<screen>Please make sure that user details are correct and group membership meets expectations (search for PrincipalRecord and GroupRecord titles).
Abort if output is incorrect.
Select test sequence to execute (Done, Abort, Login, Search) [Abort]:</screen>
</listitem>
<listitem>
<simpara>Manually testing the Search function is recommended. For the search query, select <literal>Principal</literal> for user accounts or <literal>Group</literal> for group accounts. Select <literal>Yes</literal> to <literal>Resolve Groups</literal> if you want the group account information for the user account to be returned. Three configuration files are created and displayed in the screen output.</simpara>
<screen>Select test sequence to execute (Done, Abort, Login, Search) [Search]: <emphasis>Search</emphasis>
Select entity to search (Principal, Group) [Principal]:
Term to search, trailing '*' is allowed: <emphasis>testuser1</emphasis>
Resolve Groups (Yes, No) [No]:</screen>
</listitem>
<listitem>
<simpara>Select <literal>Done</literal> to complete the setup:</simpara>
<screen>Select test sequence to execute (Done, Abort, Login, Search) [Abort]: <emphasis>Done</emphasis>
[ INFO  ] Stage: Transaction setup
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Package installation
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Transaction commit
[ INFO  ] Stage: Closing up
CONFIGURATION SUMMARY
Profile name is: redhat.com
The following files were created:
    /etc/ovirt-engine/aaa/redhat.com.properties
    /etc/ovirt-engine/extensions.d/redhat.com.properties
    /etc/ovirt-engine/extensions.d/redhat.com-authn.properties
[ INFO  ] Stage: Clean up
Log file is available at /tmp/ovirt-engine-extension-aaa-ldap-setup-20171004101225-mmneib.log:
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service. The profile you have created is now available on the Administration Portal and the VM Portal login pages. To assign the user accounts on the LDAP server appropriate roles and permissions, for example, to log in to the VM Portal, see <xref linkend="sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks"/>.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
<note>
<simpara>For more information, see the LDAP authentication and authorization extension README file at <emphasis role="strong">/usr/share/doc/ovirt-engine-extension-aaa-ldap-<emphasis>version</emphasis></emphasis>.</simpara>
</note>
</section>
<section xml:id="Attaching_an_Active_Directory">
<title>Attaching an Active Directory</title>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>You need to know the Active Directory forest name. The forest name is also known as the root domain name.</simpara>
<note>
<simpara>Examples of the most common Active Directory configurations, which cannot be configured using the ovirt-engine-extension-aaa-ldap-setup tool, are provided in <literal role="filename">/usr/share/ovirt-engine-extension-aaa-ldap/examples/README.md</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>You need to either add the DNS server that can resolve the Active Directory forest name to the <emphasis role="strong">/etc/resolv.conf</emphasis> file on the Engine, or note down the Active Directory DNS servers and enter them when prompted by the interactive setup script.</simpara>
</listitem>
<listitem>
<simpara>To set up secure connection between the LDAP server and the Engine, ensure a PEM-encoded CA certificate has been prepared. See <xref linkend="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server"/> for more information.</simpara>
</listitem>
<listitem>
<simpara>Unless anonymous search is supported, a user with permissions to browse all users and groups must be available on the Active Directory to be used as the search user. Note down the search user&#8217;s distinguished name (DN). Do not use the administrative user for the Active Directory.</simpara>
</listitem>
<listitem>
<simpara>You must have at least one account name and password ready to perform search and login queries to the Active Directory.</simpara>
</listitem>
<listitem>
<simpara>If your Active Directory deployment spans multiple domains, be aware of the limitation described in the <literal>/usr/share/ovirt-engine-extension-aaa-ldap/profiles/ad.properties</literal> file.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Configuring an External LDAP Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, install the LDAP extension package:</simpara>
<screen># dnf install ovirt-engine-extension-aaa-ldap-setup</screen>
</listitem>
<listitem>
<simpara>Run <literal>ovirt-engine-extension-aaa-ldap-setup</literal> to start the interactive setup:</simpara>
<screen># ovirt-engine-extension-aaa-ldap-setup</screen>
</listitem>
<listitem>
<simpara>Select an LDAP type by entering the corresponding number. The LDAP-related questions after this step are different for different LDAP types.</simpara>
<screen>Available LDAP implementations:
 1 - 389ds
 2 - 389ds RFC-2307 Schema
 3 - Active Directory
 4 - IBM Security Directory Server
 5 - IBM Security Directory Server RFC-2307 Schema
 6 - IPA
 7 - Novell eDirectory RFC-2307 Schema
 8 - OpenLDAP RFC-2307 Schema
 9 - OpenLDAP Standard Schema
10 - Oracle Unified Directory RFC-2307 Schema
11 - RFC-2307 Schema (Generic)
12 - RHDS
13 - RHDS RFC-2307 Schema
14 - iPlanet
Please select: 3</screen>
</listitem>
<listitem>
<simpara>Enter the Active Directory forest name. If the forest name is not resolvable by your Engine&#8217;s DNS, the script prompts you to enter a space-separated list of Active Directory DNS server names.</simpara>
<screen>Please enter Active Directory Forest name: <emphasis>ad-example.redhat.com</emphasis>
[ INFO  ] Resolving Global Catalog SRV record for <emphasis>ad-example.redhat.com</emphasis>
[ INFO  ] Resolving LDAP SRV record for <emphasis>ad-example.redhat.com</emphasis></screen>
</listitem>
<listitem>
<simpara>Select the secure connection method your LDAP server supports and specify the method to obtain a PEM-encoded CA certificate. The file option allows you to provide the full path to the certificate. The URL option allows you to specify a URL to the certificate. Use the inline option to paste the content of the certificate in the terminal. The system option allows you to specify the location for all CA files. The insecure option allows you to use startTLS in insecure mode.</simpara>
<screen>NOTE:
It is highly recommended to use secure protocol to access the LDAP server.
Protocol startTLS is the standard recommended method to do so.
Only in cases in which the startTLS is not supported, fallback to non standard ldaps protocol.
Use plain for test environments only.
Please select protocol to use (startTLS, ldaps, plain) [startTLS]: <emphasis>startTLS</emphasis>
Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure): <emphasis>File</emphasis>
Please enter the password:</screen>
<note>
<simpara>LDAPS stands for Lightweight Directory Access Protocol Over Secure Socket Links. For SSL connections, select the <literal>ldaps</literal> option.</simpara>
<simpara>For more information on creating a PEM-encoded CA certificate, see <xref linkend="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server"/>.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enter the search user distinguished name (DN). The user must have permissions to browse all users and groups on the directory server. The search user must be of LDAP annotation. If anonymous search is allowed, press <literal>Enter</literal> without any input.</simpara>
<screen>Enter search user DN (empty for anonymous): <emphasis>cn=user1,ou=Users,dc=test,dc=redhat,dc=com</emphasis>
Enter search user password:</screen>
</listitem>
<listitem>
<simpara>Specify whether to use single sign-on for virtual machines. This feature is enabled by default, but cannot be used if single sign-on to the Administration Portal is enabled. The script reminds you that the profile name must match the domain name. You will still need to follow the instructions in <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Configuring_Single_Sign-On_for_Virtual_Machines">Configuring Single Sign-On for Virtual Machines</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
<screen>Are you going to use Single Sign-On for Virtual Machines (Yes, No) [Yes]:</screen>
</listitem>
<listitem>
<simpara>Specify a profile name. The profile name is visible to users on the login page. This example uses <literal>redhat.com</literal>.</simpara>
<screen>Please specify profile name that will be visible to users:<emphasis>redhat.com</emphasis></screen>
<figure>
<title>The Administration Portal Login Page</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/AAA_login_profile.png"/>
</imageobject>
<textobject><phrase>AAA login profile</phrase></textobject>
</mediaobject>
</figure>
<note>
<simpara>Users need to select the desired profile from the drop-down list when logging in for the first time. The information is then stored in browser cookies and preselected the next time the user logs in.</simpara>
</note>
</listitem>
<listitem>
<simpara>Test the search and login function to ensure your LDAP server is connected to your oVirt environment properly. For the login query, enter the account name and password. For the search query, select <literal>Principal</literal> for user accounts, and select <literal>Group</literal> for group accounts. Enter <literal>Yes</literal> to <literal>Resolve Groups</literal> if you want the group account information for the user account to be returned. Select <literal>Done</literal> to complete the setup. Three configuration files are created and displayed in the screen output.</simpara>
<screen>NOTE:
It is highly recommended to test drive the configuration before applying it into engine.
Login sequence is executed automatically, but it is recommended to also execute Search sequence manually after successful Login sequence.
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Login
Enter search user name: <emphasis>testuser1</emphasis>
Enter search user password:
[ INFO  ] Executing login sequence...
...
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Search
Select entity to search (Principal, Group) [Principal]:
Term to search, trailing '*' is allowed: <emphasis>testuser1</emphasis>
Resolve Groups (Yes, No) [No]:
[ INFO  ] Executing login sequence...
...
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Done
[ INFO  ] Stage: Transaction setup
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Package installation
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Transaction commit
[ INFO  ] Stage: Closing up
          CONFIGURATION SUMMARY
          Profile name is: <emphasis>redhat.com</emphasis>
          The following files were created:
              /etc/ovirt-engine/aaa/<emphasis>redhat.com</emphasis>.properties
              /etc/ovirt-engine/extensions.d/<emphasis>redhat.com</emphasis>-authz.properties
              /etc/ovirt-engine/extensions.d/<emphasis>redhat.com</emphasis>-authn.properties
[ INFO  ] Stage: Clean up
          Log file is available at /tmp/ovirt-engine-extension-aaa-ldap-setup-20160114064955-1yar9i.log:
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination</screen>
</listitem>
<listitem>
<simpara>The profile you have created is now available on the Administration Portal and the VM Portal login pages. To assign the user accounts on the LDAP server appropriate roles and permissions, for example, to log in to the VM Portal, see <xref linkend="sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>For more information, see the LDAP authentication and authorization extension README file at <emphasis role="strong">/usr/share/doc/ovirt-engine-extension-aaa-ldap-<emphasis>version</emphasis></emphasis>.</simpara>
</note>
</section>
<section xml:id="Configuring_an_External_LDAP_Provider_ManualMethod">
<title>Configuring an External LDAP Provider (Manual Method)</title>
<simpara>The <literal>ovirt-engine-extension-aaa-ldap</literal> extension uses the LDAP protocol to access directory servers and is fully customizable. Kerberos authentication is not required unless you want to enable the single sign-on to the VM Portal or the Administration Portal feature.</simpara>
<simpara>If the interactive setup method in the previous section does not cover your use case, you can manually modify the configuration files to attach your LDAP server. The following procedure uses generic details. Specific values depend on your setup.</simpara>
<simpara><emphasis role="strong">Configuring an External LDAP Provider Manually</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, install the LDAP extension package:</simpara>
<screen># dnf install ovirt-engine-extension-aaa-ldap</screen>
</listitem>
<listitem>
<simpara>Copy the LDAP configuration template file into the <emphasis role="strong">/etc/ovirt-engine</emphasis> directory. Template files are available for active directories (<emphasis role="strong">ad</emphasis>) and other directory types (<emphasis role="strong">simple</emphasis>). This example uses the simple configuration template.</simpara>
<screen># cp -r /usr/share/ovirt-engine-extension-aaa-ldap/examples/simple/. /etc/ovirt-engine</screen>
</listitem>
<listitem>
<simpara>Rename the configuration files to match the profile name you want visible to users on the Administration Portal and the VM Portal login pages:</simpara>
<screen># mv /etc/ovirt-engine/aaa/profile1.properties /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties
# mv /etc/ovirt-engine/extensions.d/profile1-authn.properties /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authn.properties
# mv /etc/ovirt-engine/extensions.d/profile1-authz.properties /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
</listitem>
<listitem>
<simpara>Edit the LDAP property configuration file by uncommenting an LDAP server type and updating the domain and passwords fields:</simpara>
<screen>#  vi /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
<example>
<title>Example profile: LDAP server section</title>
<screen># Select one
#
include = &lt;openldap.properties&gt;
#include = &lt;389ds.properties&gt;
#include = &lt;rhds.properties&gt;
#include = &lt;ipa.properties&gt;
#include = &lt;iplanet.properties&gt;
#include = &lt;rfc2307-389ds.properties&gt;
#include = &lt;rfc2307-rhds.properties&gt;
#include = &lt;rfc2307-openldap.properties&gt;
#include = &lt;rfc2307-edir.properties&gt;
#include = &lt;rfc2307-generic.properties&gt;

# Server
#
vars.server = <emphasis>ldap1.company.com</emphasis>

# Search user and its password.
#
vars.user = uid=search,cn=users,cn=accounts,dc=<emphasis>company</emphasis>,dc=<emphasis>com</emphasis>
vars.password = <emphasis>123456</emphasis>

pool.default.serverset.single.server = ${global:vars.server}
pool.default.auth.simple.bindDN = ${global:vars.user}
pool.default.auth.simple.password = ${global:vars.password}</screen>
</example>
<simpara>To use TLS or SSL protocol to interact with the LDAP server, obtain the root CA certificate for the LDAP server and use it to create a public keystore file. Uncomment the following lines and specify the full path to the public keystore file and the password to access the file.</simpara>
<note>
<simpara>For more information on creating a public keystore file, see <xref linkend="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server"/>.</simpara>
</note>
<example>
<title>Example profile: keystore section</title>
<screen># Create keystore, import certificate chain and uncomment
# if using tls.
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = <emphasis>/full/path/to/myrootca.jks</emphasis>
pool.default.ssl.truststore.password = <emphasis>password</emphasis></screen>
</example>
</listitem>
<listitem>
<simpara>Review the authentication configuration file. The profile name visible to users on the Administration Portal and the VM Portal login pages is defined by <emphasis role="strong">ovirt.engine.aaa.authn.profile.name</emphasis>. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</simpara>
<screen># vi /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authn.properties</screen>
<example>
<title>Example authentication configuration file</title>
<screen>ovirt.engine.extension.name = <emphasis>example</emphasis>-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = <emphasis>example</emphasis>
ovirt.engine.aaa.authn.authz.plugin = <emphasis>example</emphasis>-authz
config.profile.file.1 = ../aaa/<emphasis>example</emphasis>.properties</screen>
</example>
</listitem>
<listitem>
<simpara>Review the authorization configuration file. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</simpara>
<screen># vi /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
<example>
<title>Example authorization configuration file</title>
<screen>ovirt.engine.extension.name = <emphasis>example</emphasis>-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.profile.file.1 = ../aaa/<emphasis>example</emphasis>.properties</screen>
</example>
</listitem>
<listitem>
<simpara>Ensure that the ownership and permissions of the configuration profile are appropriate:</simpara>
<screen># chown ovirt:ovirt /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties
# chmod 600 /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
</listitem>
<listitem>
<simpara>Restart the engine service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>The <emphasis>example</emphasis> profile you have created is now available on the Administration Portal and the VM Portal login pages. To give the user accounts on the LDAP server appropriate permissions, for example, to log in to the VM Portal, see <xref linkend="sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks"/>.</simpara>
</listitem>
</orderedlist>
<note>
<simpara>For more information, see the LDAP authentication and authorization extension README file at <emphasis role="strong">/usr/share/doc/ovirt-engine-extension-aaa-ldap-<emphasis>version</emphasis></emphasis>.</simpara>
</note>
</section>
<section xml:id="_removing_an_external_ldap_provider">
<title>Removing an External LDAP Provider</title>
<simpara>This procedure shows you how to remove an external configured LDAP provider and its users.</simpara>
<simpara><emphasis role="strong">Removing an External LDAP Provider</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Remove the LDAP provider configuration files, replacing the default name <emphasis>profile1</emphasis>:</simpara>
<screen># rm /etc/ovirt-engine/extensions.d/<emphasis>profile1</emphasis>-authn.properties
# rm /etc/ovirt-engine/extensions.d/<emphasis>profile1</emphasis>-authz.properties
# rm /etc/ovirt-engine/aaa/<emphasis>profile1</emphasis>.properties</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine</screen>
</listitem>
<listitem>
<simpara>In the Administration Portal, in the <emphasis role="strong">Users</emphasis> resource tab, select the users of this provider (those whose <literal>Authorization provider</literal> is <emphasis>profile1</emphasis>-authz) and click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Configuring_LDAP_and_Kerberos_for_Single_Sign-on">
<title>Configuring LDAP and Kerberos for Single Sign-on</title>
<simpara>Single sign-on allows users to log in to the VM Portal or the Administration Portal without re-typing their passwords. Authentication credentials are obtained from the Kerberos server. To configure single sign-on to the Administration Portal and the VM Portal, you need to configure two extensions: <emphasis role="strong">ovirt-engine-extension-aaa-misc</emphasis> and <emphasis role="strong">ovirt-engine-extension-aaa-ldap</emphasis>; and two Apache modules: <emphasis role="strong">mod_auth_gssapi</emphasis> and <emphasis role="strong">mod_session</emphasis>. You can configure single sign-on that does not involve Kerberos, however this is outside the scope of this documentation.</simpara>
<note>
<simpara>If single sign-on to the VM Portal is enabled, single sign-on to virtual machines is not possible. With single sign-on to the VM Portal enabled, the VM Portal does not need to accept a password, so you cannot delegate the password to sign in to virtual machines.</simpara>
</note>
<simpara>This example assumes the following:</simpara>
<itemizedlist>
<listitem>
<simpara>The existing Key Distribution Center (KDC) server uses the MIT version of Kerberos 5.</simpara>
</listitem>
<listitem>
<simpara>You have administrative rights to the KDC server.</simpara>
</listitem>
<listitem>
<simpara>The Kerberos client is installed on the oVirt Engine and user machines.</simpara>
</listitem>
<listitem>
<simpara>The <literal>kadmin</literal> utility is used to create Kerberos service principals and <emphasis role="strong">keytab</emphasis> files.</simpara>
</listitem>
</itemizedlist>
<simpara>This procedure involves the following components:</simpara>
<simpara><emphasis role="strong">On the KDC server</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>Create a service principal and a <emphasis role="strong">keytab</emphasis> file for the Apache service on the oVirt Engine.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">On the oVirt Engine</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>Install the authentication and authorization extension packages and the Apache Kerberos authentication module.</simpara>
</listitem>
<listitem>
<simpara>Configure the extension files.</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Configuring Kerberos for the Apache Service</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the KDC server, use the <literal>kadmin</literal> utility to create a service principal for the Apache service on the oVirt Engine. The service principal is a reference ID to the KDC for the Apache service.</simpara>
<screen># kadmin
kadmin&gt; addprinc -randkey <emphasis>HTTP/fqdn-of-rhevm</emphasis>@<emphasis>REALM.COM</emphasis></screen>
</listitem>
<listitem>
<simpara>Generate a <emphasis role="strong">keytab</emphasis> file for the Apache service. The <emphasis role="strong">keytab</emphasis> file stores the shared secret key.</simpara>
<note>
<simpara>The <literal>engine-backup</literal> command includes the file <literal role="filename">/etc/httpd/http.keytab</literal> when backing up and  restoring. If you use a different name for the <emphasis role="strong">keytab</emphasis> file, make sure you back up and restore it.</simpara>
</note>
<screen>kadmin&gt; ktadd -k /tmp/http.keytab <emphasis>HTTP/fqdn-of-rhevm</emphasis>@<emphasis>REALM.COM</emphasis>
kadmin&gt; quit</screen>
</listitem>
<listitem>
<simpara>Copy the <emphasis role="strong">keytab</emphasis> file from the KDC server to the oVirt Engine:</simpara>
<screen># scp /tmp/http.keytab root@<emphasis>rhevm.example.com</emphasis>:/etc/httpd</screen>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Configuring Single Sign-on to the VM Portal or Administration Portal</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, ensure that the ownership and permissions for the keytab are appropriate:</simpara>
<screen># chown apache /etc/httpd/http.keytab
# chmod 400 /etc/httpd/http.keytab</screen>
</listitem>
<listitem>
<simpara>Install the authentication extension package, LDAP extension package, and the <literal>mod_auth_gssapi</literal> and  <literal>mod_session</literal> Apache modules:</simpara>
<screen># dnf install ovirt-engine-extension-aaa-misc ovirt-engine-extension-aaa-ldap mod_auth_gssapi mod_session</screen>
</listitem>
<listitem>
<simpara>Copy the SSO configuration template file into the <emphasis role="strong">/etc/ovirt-engine</emphasis> directory. Template files are available for Active Directory (<emphasis role="strong">ad-sso</emphasis>) and other directory types (<emphasis role="strong">simple-sso</emphasis>). This example uses the simple SSO configuration template.</simpara>
<screen># cp -r /usr/share/ovirt-engine-extension-aaa-ldap/examples/simple-sso/. /etc/ovirt-engine</screen>
</listitem>
<listitem>
<simpara>Move <emphasis role="strong">ovirt-sso.conf</emphasis> into the Apache configuration directory.</simpara>
<note>
<simpara>The <literal>engine-backup</literal> command includes the file <literal role="filename">/etc/httpd/conf.d/ovirt-sso.conf</literal> when backing up and  restoring. If you use a different name for this file, make sure you back up and restore it.</simpara>
</note>
<screen># mv /etc/ovirt-engine/aaa/ovirt-sso.conf /etc/httpd/conf.d</screen>
</listitem>
<listitem>
<simpara>Review the authentication method file. You do not need to edit this file, as the realm is automatically fetched from the <emphasis role="strong">keytab</emphasis> file.</simpara>
<screen># vi /etc/httpd/conf.d/ovirt-sso.conf</screen>
<example>
<title>Example authentication method file</title>
<screen>&lt;LocationMatch ^/ovirt-engine/sso/(interactive-login-negotiate|oauth/token-http-auth)|^/ovirt-engine/api&gt;
  &lt;If "req('Authorization') !~ /^(Bearer|Basic)/i"&gt;
    RewriteEngine on
    RewriteCond %{LA-U:REMOTE_USER} ^(.*)$
    RewriteRule ^(.*)$ - [L,NS,P,E=REMOTE_USER:%1]
    RequestHeader set X-Remote-User %{REMOTE_USER}s

    AuthType GSSAPI
    AuthName "Kerberos Login"

    # Modify to match installation
    GssapiCredStore keytab:/etc/httpd/http.keytab
    GssapiUseSessions On
    Session On
    SessionCookieName ovirt_gssapi_session path=/private;httponly;secure;

    Require valid-user
    ErrorDocument 401 "&lt;html&gt;&lt;meta http-equiv=\"refresh\" content=\"0; url=/ovirt-engine/sso/login-unauthorized\"/&gt;&lt;body&gt;&lt;a href=\"/ovirt-engine/sso/login-unauthorized\"&gt;Here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
  &lt;/If&gt;
&lt;/LocationMatch&gt;</screen>
</example>
</listitem>
<listitem>
<simpara>Rename the configuration files to match the profile name you want visible to users on the Administration Portal and the VM Portal login pages:</simpara>
<screen># mv /etc/ovirt-engine/aaa/profile1.properties /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
<screen># mv /etc/ovirt-engine/extensions.d/profile1-http-authn.properties /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-authn.properties</screen>
<screen># mv /etc/ovirt-engine/extensions.d/profile1-http-mapping.properties /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-mapping.properties</screen>
<screen># mv /etc/ovirt-engine/extensions.d/profile1-authz.properties /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
</listitem>
<listitem>
<simpara>Edit the LDAP property configuration file by uncommenting an LDAP server type and updating the domain and passwords fields:</simpara>
<screen>#  vi /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
<example>
<title>Example profile: LDAP server section</title>
<screen># Select one
include = &lt;openldap.properties&gt;
#include = &lt;389ds.properties&gt;
#include = &lt;rhds.properties&gt;
#include = &lt;ipa.properties&gt;
#include = &lt;iplanet.properties&gt;
#include = &lt;rfc2307-389ds.properties&gt;
#include = &lt;rfc2307-rhds.properties&gt;
#include = &lt;rfc2307-openldap.properties&gt;
#include = &lt;rfc2307-edir.properties&gt;
#include = &lt;rfc2307-generic.properties&gt;

# Server
#
vars.server = <emphasis>ldap1.company.com</emphasis>

# Search user and its password.
#
vars.user = uid=search,cn=users,cn=accounts,dc=company,dc=com
vars.password = <emphasis>123456</emphasis>

pool.default.serverset.single.server = ${global:vars.server}
pool.default.auth.simple.bindDN = ${global:vars.user}
pool.default.auth.simple.password = ${global:vars.password}</screen>
</example>
<simpara>To use TLS or SSL protocol to interact with the LDAP server, obtain the root CA certificate for the LDAP server and use it to create a public keystore file. Uncomment the following lines and specify the full path to the public keystore file and the password to access the file.</simpara>
<note>
<simpara>For more information on creating a public keystore file, see <xref linkend="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server"/>.</simpara>
</note>
<example>
<title>Example profile: keystore section</title>
<screen># Create keystore, import certificate chain and uncomment
# if using ssl/tls.
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = <emphasis>/full/path/to/myrootca.jks</emphasis>
pool.default.ssl.truststore.password = <emphasis>password</emphasis></screen>
</example>
</listitem>
<listitem>
<simpara>Review the authentication configuration file. The profile name visible to users on the Administration Portal and the VM Portal login pages is defined by <emphasis role="strong">ovirt.engine.aaa.authn.profile.name</emphasis>. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</simpara>
<screen># vi /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-authn.properties</screen>
<example>
<title>Example authentication configuration file</title>
<screen>ovirt.engine.extension.name = <emphasis>example</emphasis>-http-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = <emphasis>example</emphasis>-http
ovirt.engine.aaa.authn.authz.plugin = <emphasis>example</emphasis>-authz
ovirt.engine.aaa.authn.mapping.plugin = <emphasis>example</emphasis>-http-mapping
config.artifact.name = HEADER
config.artifact.arg = X-Remote-User</screen>
</example>
</listitem>
<listitem>
<simpara>Review the authorization configuration file. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</simpara>
<screen>#  vi /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
<example>
<title>Example authorization configuration file</title>
<screen>ovirt.engine.extension.name = <emphasis>example</emphasis>-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.profile.file.1 = ../aaa/<emphasis>example</emphasis>.properties</screen>
</example>
</listitem>
<listitem>
<simpara>Review the authentication mapping configuration file. The configuration profile location must match the LDAP configuration file location. The configuration profile extension name must match the <literal>ovirt.engine.aaa.authn.mapping.plugin</literal> value in the authentication configuration file. All fields can be left as default.</simpara>
<screen># vi /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-mapping.properties</screen>
<example>
<title>Example authentication mapping configuration file</title>
<screen>ovirt.engine.extension.name = <emphasis>example</emphasis>-http-mapping
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.mapping.MappingExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Mapping
config.mapAuthRecord.type = regex
config.mapAuthRecord.regex.mustMatch = true
config.mapAuthRecord.regex.pattern = ^(?&lt;user&gt;.*?)((\\\\(?&lt;at&gt;@)(?&lt;suffix&gt;.*?)@.*)|(?&lt;realm&gt;@.*))$
config.mapAuthRecord.regex.replacement = ${user}${at}${suffix}</screen>
</example>
</listitem>
<listitem>
<simpara>Ensure that the ownership and permissions of the configuration files are appropriate:</simpara>
<screen># chown ovirt:ovirt /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
<screen># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-authn.properties</screen>
<screen># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-mapping.properties</screen>
<screen># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
<screen># chmod 600 /etc/ovirt-engine/aaa/<emphasis>example</emphasis>.properties</screen>
<screen># chmod 640 /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-authn.properties</screen>
<screen># chmod 640 /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-http-mapping.properties</screen>
<screen># chmod 640 /etc/ovirt-engine/extensions.d/<emphasis>example</emphasis>-authz.properties</screen>
</listitem>
<listitem>
<simpara>Restart the Apache service and the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart httpd.service
# systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Configuring_Red_Hat_SSO">
<title>Installing and Configuring Red Hat Single Sign-On</title>
<simpara>To use Red Had Single Sign-On as your authorization method, you need to:</simpara>
<itemizedlist>
<listitem>
<simpara>Install Red Hat SSO.</simpara>
</listitem>
<listitem>
<simpara>Configure the LDAP group mapper.</simpara>
</listitem>
<listitem>
<simpara>Configure Apache on the Engine.</simpara>
</listitem>
<listitem>
<simpara>Configure OVN provider credentials.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>If Red Hat SSO is configured, previous LDAP sign ons will not work, as only a single authorization protocol may be used at a time.</simpara>
</note>
<section xml:id="_installing_red_hat_single_sign_on">
<title>Installing Red Hat Single Sign-On</title>
<simpara xml:id="Installing_RH_SSO">You can install Red Hat Single Sign-On by downloading a ZIP file and unpacking it, or by using an RPM file.</simpara>
<simpara>Follow the installation instructions at <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html-single/server_installation_and_configuration_guide/index#installation">Red Hat SSO Installation</link></simpara>
<simpara>Prepare the following information:</simpara>
<itemizedlist>
<listitem>
<simpara>Path/location of the <literal>Open ID Connect</literal> server.</simpara>
</listitem>
<listitem>
<simpara>The subscription channel for the correct repositories.</simpara>
</listitem>
<listitem>
<simpara>Valid Red Hat subscription login credentials.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="_configuring_the_ldap_group_mapper">
<title>Configuring the LDAP group mapper</title>
<orderedlist xml:id="Configuring_RHSSO_ldap" numeration="arabic">
<listitem>
<simpara>Add the LDAP groups mapper with the following information:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>Name</literal>: ldapgroups</simpara>
</listitem>
<listitem>
<simpara><literal>Mapper Type</literal>: group-ldap-mapper</simpara>
</listitem>
<listitem>
<simpara><literal>LDAP Groups DN</literal>: ou=groups,dc=example,dc=com</simpara>
</listitem>
<listitem>
<simpara><literal>Group Object Classes</literal>: groupofuniquenames (<emphasis>adapt this class according to your LDAP server setup</emphasis>)</simpara>
</listitem>
<listitem>
<simpara><literal>Membership LDAP Attribute</literal>: uniquemember (<emphasis>adapt this class according to your LDAP server setup</emphasis>)</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Click <literal>Save</literal>.</simpara>
</listitem>
<listitem>
<simpara>Click <literal>Sync LDAP Groups to KeyCloak</literal>.</simpara>
</listitem>
<listitem>
<simpara>At the bottom of the <literal>User Federation Provider</literal> page, click <literal>Synchronize all users</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <literal>Clients</literal> tab, under <literal>Add Client</literal>, add <literal>ovirt-engine</literal> as the <literal>Client ID</literal>, and enter the engine url as the <literal>Root URL</literal>.</simpara>
</listitem>
<listitem>
<simpara>Modify the <literal>Client Protocol</literal> to <literal>openid-connect</literal> and the <literal>Access Type</literal> to <literal>confidential</literal>.</simpara>
</listitem>
<listitem>
<simpara>In the <literal>Clients</literal> tab, under <literal>Ovirt-engine</literal> &gt; <literal>Advanced Settings</literal>, increase the <literal>Access Token Lifespan</literal>.</simpara>
</listitem>
<listitem>
<simpara>Add <literal>https://rhvm.example.com:443/*</literal> as a valid redirect URI.</simpara>
</listitem>
<listitem>
<simpara>The client secret is generated, and can be viewed in the Credentials tab.</simpara>
</listitem>
<listitem>
<simpara>In the <literal>Clients</literal> tab under <literal>Create Mapper Protocol</literal>, create a mapper with the following settings:</simpara>
<itemizedlist>
<listitem>
<simpara><literal>Name</literal>: groups</simpara>
</listitem>
<listitem>
<simpara><literal>Mapper Type</literal>: Group Membership</simpara>
</listitem>
<listitem>
<simpara><literal>Token Claim Name</literal>: groups</simpara>
</listitem>
<listitem>
<simpara><literal>Full group path</literal>: <literal>ON</literal></simpara>
</listitem>
<listitem>
<simpara><literal>Add to ID token</literal>: <literal>ON</literal></simpara>
</listitem>
<listitem>
<simpara><literal>Add to access token</literal>: <literal>ON</literal></simpara>
</listitem>
<listitem>
<simpara><literal>Add to userinfo</literal>: <literal>ON</literal></simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Add the <literal>Builtin Protocol Mapper</literal> for <literal>username</literal>.</simpara>
</listitem>
<listitem>
<simpara>Create the scopes needed by <literal>ovirt-engine</literal>, <literal>ovirt-app-api</literal>, <literal>ovirt-app-admin</literal>, and <literal>ovirt-ext=auth:sequence-priority=~</literal>.</simpara>
</listitem>
<listitem>
<simpara>Use the scopes created in the previous step to set up optional client scopes for the ovirt-engine client.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="_configuring_apache_in_the_engine">
<title>Configuring Apache in the Engine</title>
<orderedlist xml:id="Configuring_RHSSO_apache" numeration="arabic">
<listitem>
<simpara>Enable the <literal>mod_auth_openidc</literal> module.</simpara>
<screen># dnf module enable mod_auth_openidc:2.3 -y</screen>
</listitem>
<listitem>
<simpara>Configure Apache in the Engine</simpara>
<screen># dnf install mod_auth_openidc</screen>
</listitem>
<listitem>
<simpara>Create a new <literal>httpd</literal> config file <literal>ovirt-openidc.conf</literal> in <emphasis role="strong">/etc/httpd/conf.d/</emphasis> with the following content:</simpara>
<screen>LoadModule auth_openidc_module modules/mod_auth_openidc.so

OIDCProviderMetadataURL https://SSO.example.com/auth/realms/master/.well-known/openid-configuration
OIDCSSLValidateServer Off

OIDCClientID ovirt-engine
OIDCClientSecret &lt;client_SSO _generated_key&gt;
OIDCRedirectURI https://rhvm.example.com/ovirt-engine/callback
OIDCDefaultURL https://rhvm.example.com/ovirt-engine/login?scope=ovirt-app-admin+ovirt-app-portal+ovirt-ext%3Dauth%3Asequence-priority%3D%7E

# maps the prefered_username claim to the REMOTE_USER environment variable:

OIDCRemoteUserClaim &lt;preferred_username&gt;
OIDCCryptoPassphrase &lt;random1234&gt;

&lt;LocationMatch ^/ovirt-engine/sso/(interactive-login-negotiate|oauth/token-http-auth)|^/ovirt-engine/callback&gt;
    &lt;If "req('Authorization') !~ /^(Bearer|Basic)/i"&gt;

      Require valid-user
      AuthType openid-connect

      ErrorDocument 401 "&lt;html&gt;&lt;meta http-equiv=\"refresh\" content=\"0; url=/ovirt-engine/sso/login-unauthorized\"/&gt;&lt;body&gt;&lt;a href=\"/ovirt-engine/sso/login-unauthorized\"&gt;Here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
    &lt;/If&gt;
&lt;/LocationMatch&gt;

OIDCOAuthIntrospectionEndpoint https://SSO.example.com/auth/realms/master/protocol/openid-connect/token/introspect
OIDCOAuthSSLValidateServer    Off
OIDCOAuthIntrospectionEndpointParams token_type_hint=access_token
OIDCOAuthClientID ovirt-engine
OIDCOAuthClientSecret &lt;client_SSO _generated_key&gt;
OIDCOAuthRemoteUserClaim sub

&lt;LocationMatch ^/ovirt-engine/(api$|api/)&gt;
   AuthType oauth20
   Require valid-user
&lt;/LocationMatch&gt;</screen>
</listitem>
<listitem>
<simpara>To save the configuration changes, restart <emphasis role="strong">httpd</emphasis> and <emphasis role="strong">ovirt-engine</emphasis>:</simpara>
<screen># systemctl restart httpd
# systemctl restart ovirt-engine</screen>
</listitem>
<listitem>
<simpara>Create the file <literal>openidc-authn.properties</literal> in <emphasis role="strong">/etc/ovirt-engine/extensions.d/</emphasis> with the following content:</simpara>
<screen>ovirt.engine.extension.name = openidc-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = openidchttp
ovirt.engine.aaa.authn.authz.plugin = openidc-authz
ovirt.engine.aaa.authn.mapping.plugin = openidc-http-mapping
config.artifact.name = HEADER
config.artifact.arg = OIDC_CLAIM_preferred_username</screen>
</listitem>
<listitem>
<simpara>Create the file <literal>openidc-http-mapping.properties</literal> in <emphasis role="strong">/etc/ovirt-engine/extensions.d/</emphasis> with the following content:</simpara>
<screen>ovirt.engine.extension.name = openidc-http-mapping
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.mapping.MappingExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Mapping
config.mapAuthRecord.type = regex
config.mapAuthRecord.regex.mustMatch = false
config.mapAuthRecord.regex.pattern = ^(?&lt;user&gt;.*?)((\\\\(?&lt;at&gt;@)(?&lt;suffix&gt;.*?)@.*)|(?&lt;realm&gt;@.*))$
config.mapAuthRecord.regex.replacement = ${user}${at}${suffix}</screen>
</listitem>
<listitem>
<simpara>Create  the file <literal>openidc-authz.properties</literal> in <emphasis role="strong">/etc/ovirt-engine/extensions.d/</emphasis> with the following content:</simpara>
<screen>ovirt.engine.extension.name = openidc-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.artifact.name.arg = OIDC_CLAIM_preferred_username
config.artifact.groups.arg = OIDC_CLAIM_groups</screen>
</listitem>
<listitem>
<simpara>Create the file <literal>99-enable-external-auth.conf</literal> in <emphasis role="strong">/etc/ovirt-engine/engine.conf.d/</emphasis> with the following content:</simpara>
<screen>ENGINE_SSO_ENABLE_EXTERNAL_SSO=true
ENGINE_SSO_EXTERNAL_SSO_LOGOUT_URI="${ENGINE_URI}/callback"
EXTERNAL_OIDC_USER_INFO_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/userinfo
EXTERNAL_OIDC_TOKEN_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/token
EXTERNAL_OIDC_LOGOUT_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/logout
EXTERNAL_OIDC_CLIENT_ID=ovirt-engine
EXTERNAL_OIDC_CLIENT_SECRET="&lt;client_SSO _generated_key&gt;"
EXTERNAL_OIDC_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"
EXTERNAL_OIDC_HTTPS_PKI_TRUST_STORE_PASSWORD=""
EXTERNAL_OIDC_SSL_VERIFY_CHAIN=false
EXTERNAL_OIDC_SSL_VERIFY_HOST=false</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="_configuring_ovn">
<title>Configuring OVN</title>
<simpara xml:id="Configuring_RHSSO_OVN">If you configured the <emphasis role="strong">ovirt-ovn-provider</emphasis> in the Engine, you need to configure the OVN provider credentials.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create the file <literal>20-setup-ovirt-provider-ovn.conf</literal> in <emphasis role="strong">/etc/ovirt-provider-ovn/conf.d/</emphasis> with the following contents,
where <emphasis role="strong">user1</emphasis> belongs to the LDAP group <emphasis role="strong">ovirt-administrator</emphasis>, and <emphasis role="strong">openidchttp</emphasis> is the profile configured for <emphasis role="strong">aaa-ldap-misc</emphasis>.</simpara>
<screen>[OVIRT]
# ovirt-admin-user-name=user1@openidchttp</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-provider-ovn</literal>:</simpara>
<screen># systemctl restart ovirt-provider-ovn</screen>
</listitem>
<listitem>
<simpara>Log in to the Administration Portal, navigate to <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Providers</guimenuitem></menuchoice>, select <emphasis role="strong">ovirt-provider-ovn</emphasis>, and click <guibutton>Edit</guibutton> to update the password for the ovn provider.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-User_Authorization">
<title>User Authorization</title>
<section xml:id="User_authorization_model">
<title>User Authorization Model</title>
<simpara>oVirt applies authorization controls based on the combination of the three components:</simpara>
<itemizedlist>
<listitem>
<simpara>The user performing the action</simpara>
</listitem>
<listitem>
<simpara>The type of action being performed</simpara>
</listitem>
<listitem>
<simpara>The object on which the action is being performed</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="User_actions">
<title>User Actions</title>
<simpara>For an action to be successfully performed, the <emphasis role="strong">user</emphasis> must have the appropriate <emphasis role="strong">permission</emphasis> for the <emphasis role="strong">object</emphasis> being acted upon. Each type of action has a corresponding <emphasis role="strong">permission</emphasis>.</simpara>
<simpara>Some actions are performed on more than one object. For example, copying a template to another storage domain will impact both the template and the destination storage domain. The user performing an action must have appropriate permissions for all objects the action impacts.</simpara>
</section>
</section>
<section xml:id="sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">
<title>Administering User Tasks From the Administration Portal</title>
<section xml:id="Adding_users">
<title>Adding Users and Assigning VM Portal Permissions</title>
<simpara>Users must be created already before they can be added and assigned roles and permissions. The roles and permissions assigned in this procedure give the user the permission to log in to the VM Portal and to start creating virtual machines. The procedure also applies to group accounts.</simpara>
<simpara><emphasis role="strong">Adding Users and Assigning VM Portal Permissions</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the header bar, click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Configure</guimenuitem></menuchoice>. This opens the <emphasis role="strong">Configure</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">System Permissions</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>. This opens the <emphasis role="strong">Add System Permission to User</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Select a profile under <emphasis role="strong">Search</emphasis>. The profile is the domain you want to search. Enter a name or part of a name in the search text field, and click <emphasis role="strong">GO</emphasis>. Alternatively, click <emphasis role="strong">GO</emphasis> to view a list of all users and groups.</simpara>
</listitem>
<listitem>
<simpara>Select the check boxes for the appropriate users or groups.</simpara>
</listitem>
<listitem>
<simpara>Select an appropriate role to assign under <emphasis role="strong">Role to Assign</emphasis>. The <emphasis role="strong">UserRole</emphasis> role gives the user account the permission to log in to the VM Portal.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>Log in to the VM Portal to verify that the user account has the permissions to log in.</simpara>
</section>
<section xml:id="Viewing_user_information">
<title>Viewing User Information</title>
<simpara><emphasis role="strong">Viewing User Information</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice> to display the list of authorized users.</simpara>
</listitem>
<listitem>
<simpara>Click the user&#8217;s name. This opens the details view, usually with the <emphasis role="strong">General</emphasis> tab displaying general information, such as the domain name, email and status of the user.</simpara>
</listitem>
<listitem>
<simpara>The other tabs allow you to view groups, permissions, quotas, and events for the user.</simpara>
</listitem>
</orderedlist>
<simpara>For example, to view the groups to which the user belongs, click the <emphasis role="strong">Directory Groups</emphasis> tab.</simpara>
</section>
<section xml:id="Viewing_User_Permissions_on_Resources">
<title>Viewing User Permissions on Resources</title>
<simpara>Users can be assigned permissions on specific resources or a hierarchy of resources. You can view the assigned users and their permissions on each resource.</simpara>
<simpara><emphasis role="strong">Viewing User Permissions on Resources</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Find and click the resource&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Permissions</emphasis> tab to list the assigned users, the user&#8217;s role, and the inherited permissions for the selected resource.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_Users">
<title>Removing Users</title>
<simpara>When a user account is no longer required, remove it from oVirt.</simpara>
<simpara><emphasis role="strong">Removing Users</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice> to display the list of authorized users.</simpara>
</listitem>
<listitem>
<simpara>Select the user to be removed. Ensure the user is not running any virtual machines.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>, then click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>The user is removed from oVirt, but not from the external directory.</simpara>
</section>
<section xml:id="Viewing_Logged_In_Users">
<title>Viewing Logged-In Users</title>
<simpara>You can view the users who are currently logged in, along with session times and other details. Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Active User Sessions</guimenuitem></menuchoice> to view the <emphasis role="strong">Session DB ID</emphasis>, <emphasis role="strong">User Name</emphasis>, <emphasis role="strong">Authorization provider</emphasis>, <emphasis role="strong">User id</emphasis>, <emphasis role="strong">Source IP</emphasis>, <emphasis role="strong">Session Start Time</emphasis>, and <emphasis role="strong">Session Last Active Time</emphasis> for each logged-in user.</simpara>
</section>
<section xml:id="Terminating_a_User_Session">
<title>Terminating a User Session</title>
<simpara>You can terminate the session of a user who is currently logged in.</simpara>
<simpara><emphasis role="strong">Terminating a User Session</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Active User Sessions</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the user session to be terminated.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Terminate Session</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-Administering_User_Tasks_From_the_commandline">
<title>Administering User Tasks From the Command Line</title>
<simpara>You can use the <literal>ovirt-aaa-jdbc-tool</literal> tool to manage user accounts on the internal domain. Changes made using the tool take effect immediately and do not require you to restart the <literal>ovirt-engine</literal> service. For a full list of user options, run <literal>ovirt-aaa-jdbc-tool user --help</literal>. Common examples are provided in this section.</simpara>
<important>
<simpara>You must be logged into the Engine machine.</simpara>
</important>
<section xml:id="_creating_a_new_user">
<title>Creating a New User</title>
<simpara>You can create a new user account. The optional <literal>--attribute</literal> command specifies account details. For a full list of options, run <literal>ovirt-aaa-jdbc-tool user add --help</literal>.</simpara>
<screen># ovirt-aaa-jdbc-tool user add <emphasis>test1</emphasis> --attribute=firstName=<emphasis>John</emphasis> --attribute=lastName=<emphasis>Doe</emphasis>
adding user test1...
user added successfully</screen>
<simpara>You can add the newly created user in the Administration Portal and assign the user appropriate roles and permissions. See <xref linkend="Adding_users"/> for more information.</simpara>
</section>
<section xml:id="_setting_a_user_password">
<title>Setting a User Password</title>
<simpara>You can create a password. You must set a value for <literal>--password-valid-to</literal>, otherwise the password expiry time defaults to the current time. The date format is <literal>yyyy-MM-dd HH:mm:ssX</literal>. In this example, <literal>-0800</literal> stands for GMT minus 8 hours. For more options, run <literal>ovirt-aaa-jdbc-tool user password-reset --help</literal>.</simpara>
<screen># ovirt-aaa-jdbc-tool user password-reset <emphasis>test1</emphasis> --password-valid-to=<emphasis>"2025-08-01 12:00:00-0800"</emphasis>
Password:
updating user test1...
user updated successfully</screen>
<note>
<simpara>By default, the password policy for user accounts on the internal domain has the following restrictions:</simpara>
<itemizedlist>
<listitem>
<simpara>A minimum of 6 characters.</simpara>
</listitem>
<listitem>
<simpara>Three previous passwords used cannot be set again during the password change.</simpara>
</listitem>
</itemizedlist>
<simpara>For more information on the password policy and other default settings, run <literal>ovirt-aaa-jdbc-tool settings show</literal>.</simpara>
</note>
</section>
<section xml:id="_setting_user_timeout">
<title>Setting User Timeout</title>
<simpara>You can set the user timeout period:</simpara>
<screen># engine-config --set UserSessionTimeOutInterval=<emphasis>integer</emphasis></screen>
</section>
<section xml:id="_pre_encrypting_a_user_password">
<title>Pre-encrypting a User Password</title>
<simpara>You can create a pre-encrypted user password using the <literal>ovirt-engine-crypto-tool</literal> script. This option is useful if you are adding users and passwords to the database with a script.</simpara>
<note>
<simpara>Passwords are stored in the Engine database in encrypted form. The <literal>ovirt-engine-crypto-tool</literal> script is used because all passwords must be encrypted with the same algorithm.</simpara>
<simpara>If the password is pre-encrypted, password validity tests cannot be performed. The password will be accepted even if it does not comply with the password validation policy.</simpara>
</note>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run the following command:</simpara>
<screen># /usr/share/ovirt-engine/bin/ovirt-engine-crypto-tool.sh pbe-encode</screen>
<simpara>The script will prompt you to enter the password.</simpara>
<simpara>Alternatively, you can use the <literal>--password=file:<emphasis>file</emphasis></literal> option to encrypt a single password that appears as the first line of a file. This option is useful for automation. In the following example, <literal><emphasis>file</emphasis></literal> is a text file containing a single password for encryption:</simpara>
<screen># /usr/share/ovirt-engine/bin/ovirt-engine-crypto-tool.sh pbe-encode --password=file:<emphasis>file</emphasis></screen>
</listitem>
<listitem>
<simpara>Set the new password with the <literal>ovirt-aaa-jdbc-tool</literal> script, using the <literal>--encrypted</literal> option:</simpara>
<screen># ovirt-aaa-jdbc-tool user password-reset <emphasis>test1</emphasis> --password-valid-to="2025-08-01 12:00:00-0800" --encrypted</screen>
</listitem>
<listitem>
<simpara>Enter and confirm the encrypted password:</simpara>
<screen>Password:
Reenter password:
updating user test1...
user updated successfully</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="_viewing_user_information">
<title>Viewing User Information</title>
<simpara>You can view detailed user account information:</simpara>
<screen># ovirt-aaa-jdbc-tool user show test1</screen>
<simpara>This command displays more information than in the Administration Portal&#8217;s <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice> screen.</simpara>
</section>
<section xml:id="_editing_user_information">
<title>Editing User Information</title>
<simpara>You can update user information, such as the email address:</simpara>
<screen># ovirt-aaa-jdbc-tool user edit test1 --attribute=email=jdoe@example.com</screen>
</section>
<section xml:id="_removing_a_user">
<title>Removing a User</title>
<simpara>You can remove a user account:</simpara>
<screen># ovirt-aaa-jdbc-tool user delete test1</screen>
<simpara>Remove the user from the Administration Portal. See <xref linkend="Removing_Users"/> for more information.</simpara>
</section>
<section xml:id="Disabling_the_Internal_Administrative_User">
<title>Disabling the Internal Administrative User</title>
<simpara>You can disable users on the local domains including the <emphasis role="strong">admin@internal</emphasis> user created during <literal>engine-setup</literal>. Make sure you have at least one user in the envrionment with full administrative permissions before disabling the default <emphasis role="strong">admin</emphasis> user.</simpara>
<simpara><emphasis role="strong">Disabling the Internal Administrative User</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>Make sure another user with the <emphasis role="strong">SuperUser</emphasis> role has been added to the environment. See <xref linkend="Adding_users"/> for more information.</simpara>
</listitem>
<listitem>
<simpara>Disable the default <emphasis role="strong">admin</emphasis> user:</simpara>
<screen># ovirt-aaa-jdbc-tool user edit <literal>admin</literal> --flag=+disabled</screen>
</listitem>
</orderedlist>
<note>
<simpara>To enable a disabled user, run <literal>ovirt-aaa-jdbc-tool user edit <emphasis>username</emphasis> --flag=-disabled</literal></simpara>
</note>
</section>
<section xml:id="Managing_Groups">
<title>Managing Groups</title>
<simpara>You can use the <literal>ovirt-aaa-jdbc-tool</literal> tool to manage group accounts on your internal domain. Managing group accounts is similar to managing user accounts. For a full list of group options, run <literal>ovirt-aaa-jdbc-tool group --help</literal>. Common examples are provided in this section.</simpara>
<simpara><emphasis role="strong">Creating a Group</emphasis></simpara>
<simpara>This procedure shows you how to create a group account, add users to the group, and view the details of the group.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>Create a new group:</simpara>
<screen># ovirt-aaa-jdbc-tool group add <emphasis>group1</emphasis></screen>
</listitem>
<listitem>
<simpara>Add users to the group. The users must be created already.</simpara>
<screen># ovirt-aaa-jdbc-tool group-manage useradd <emphasis>group1</emphasis> --user=<emphasis>test1</emphasis></screen>
<note>
<simpara>For a full list of the group-manage options, run <literal>ovirt-aaa-jdbc-tool group-manage --help</literal>.</simpara>
</note>
</listitem>
<listitem>
<simpara>View group account details:</simpara>
<screen># ovirt-aaa-jdbc-tool group show <emphasis>group1</emphasis></screen>
</listitem>
<listitem>
<simpara>Add the newly created group in the Administration Portal and assign the group appropriate roles and permissions. The users in the group inherit the roles and permissions of the group. See <xref linkend="Adding_users"/> for more information.</simpara>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Creating Nested Groups</emphasis></simpara>
<simpara>This procedure shows you how to create groups within groups.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>Create the first group:</simpara>
<screen># ovirt-aaa-jdbc-tool group add <emphasis>group1</emphasis></screen>
</listitem>
<listitem>
<simpara>Create the second group:</simpara>
<screen># ovirt-aaa-jdbc-tool group add <emphasis>group1-1</emphasis></screen>
</listitem>
<listitem>
<simpara>Add the second group to the first group:</simpara>
<screen># ovirt-aaa-jdbc-tool group-manage groupadd <emphasis>group1</emphasis> --group=<emphasis>group1-1</emphasis></screen>
</listitem>
<listitem>
<simpara>Add the first group in the Administration Portal and assign the group appropriate roles and permissions. See <xref linkend="Adding_users"/> for more information.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Querying_Users_and_Groups">
<title>Querying Users and Groups</title>
<simpara>The <literal>query</literal> module allows you to query user and group information. For a full list of options, run <literal>ovirt-aaa-jdbc-tool query --help</literal>.</simpara>
<simpara><emphasis role="strong">Listing All User or Group Account Details</emphasis></simpara>
<simpara>This procedure shows you how to list all account information.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>List the account details.</simpara>
<itemizedlist>
<listitem>
<simpara>All user account details:</simpara>
<screen># ovirt-aaa-jdbc-tool query --what=user</screen>
</listitem>
<listitem>
<simpara>All group account details:</simpara>
<screen># ovirt-aaa-jdbc-tool query --what=group</screen>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Listing Filtered Account Details</emphasis></simpara>
<simpara>This procedure shows you how to apply filters when listing account information.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>Filter account details using the <literal>--pattern</literal> parameter.</simpara>
<itemizedlist>
<listitem>
<simpara>List user account details with names that start with the character <emphasis>j</emphasis>.</simpara>
<screen># ovirt-aaa-jdbc-tool query --what=user --pattern="name=<emphasis>j*</emphasis>"</screen>
</listitem>
<listitem>
<simpara>List groups that have the department attribute set to <emphasis>marketing</emphasis>:</simpara>
<screen># ovirt-aaa-jdbc-tool query --what=group --pattern="department=<emphasis>marketing</emphasis>"</screen>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
<section xml:id="Managing_Account_Settings">
<title>Managing Account Settings</title>
<simpara>To change the default account settings, use the <literal>ovirt-aaa-jdbc-tool</literal> <literal>settings</literal> module.</simpara>
<simpara><emphasis role="strong">Updating Account Settings</emphasis></simpara>
<simpara>This procedure shows you how to update the default account settings.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log in to the machine on which the oVirt Engine is installed.</simpara>
</listitem>
<listitem>
<simpara>Run the following command to show all the settings available:</simpara>
<screen># ovirt-aaa-jdbc-tool settings show</screen>
</listitem>
<listitem>
<simpara>Change the desired settings:</simpara>
<itemizedlist>
<listitem>
<simpara>This example updates the default log in session time to 60 minutes for all user accounts. The default value is 10080 minutes.</simpara>
<screen># ovirt-aaa-jdbc-tool settings set --name=MAX_LOGIN_MINUTES --value=<emphasis>60</emphasis></screen>
</listitem>
<listitem>
<simpara>This example updates the number of failed login attempts a user can perform before the user account is locked. The default value is 5.</simpara>
<screen># ovirt-aaa-jdbc-tool settings set --name=MAX_FAILURES_SINCE_SUCCESS --value=<emphasis>3</emphasis></screen>
<note>
<simpara>To unlock a locked user account, run <literal>ovirt-aaa-jdbc-tool user unlock <emphasis>test1</emphasis></literal>.</simpara>
</note>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Configuring_Additional_Local_Domains">
<title>Configuring Additional Local Domains</title>
<simpara>Creating additional local domains other than the default <emphasis role="strong">internal</emphasis> domain is also supported. This can be done using the <emphasis role="strong">ovirt-engine-extension-aaa-jdbc</emphasis> extension and allows you to create multiple domains without attaching external directory servers, though the use case may not be common for enterprise environments.</simpara>
<simpara>Additionally created local domains will not get upgraded autonmatically during standard oVirt upgrades and need to be upgraded manually for each future release. For more information on creating additional local domains and how to upgrade the domains, see the README file at <emphasis role="strong">/usr/share/doc/ovirt-engine-extension-aaa-jdbc-<emphasis>version</emphasis>/README.admin</emphasis>.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Quotas_and_Service_Level_Agreement_Policy">
<title>Quotas and Service Level Agreement Policy</title>
<section xml:id="Introduction_to_Quota">
<title>Introduction to Quota</title>
<simpara>Quota is a resource limitation tool provided with oVirt. Quota may be thought of as a layer of limitations on top of the layer of limitations set by User Permissions.</simpara>
<simpara>Quota is a data center object.</simpara>
<simpara>Quota allows administrators of oVirt environments to limit user access to memory, CPU, and storage. Quota defines the memory resources and storage resources an administrator can assign users. As a result users may draw on only the resources assigned to them. When the quota resources are exhausted, oVirt does not permit further user actions.</simpara>
<simpara>There are two different kinds of Quota:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>The Two Different Kinds of Quota</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Quota type</entry>
<entry align="left" valign="top">Definition</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Run-time Quota</simpara></entry>
<entry align="left" valign="top"><simpara>This quota limits the consumption of runtime resources, like CPU and memory.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Storage Quota</simpara></entry>
<entry align="left" valign="top"><simpara>This quota limits the amount of storage available.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>Quota, like SELinux, has three modes:</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>Quota Modes</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Quota Mode</entry>
<entry align="left" valign="top">Function</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Enforced</simpara></entry>
<entry align="left" valign="top"><simpara>This mode puts into effect the quota that you have set in Audit mode, limiting resources to the group or user affected by the quota.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Audit</simpara></entry>
<entry align="left" valign="top"><simpara>This mode logs quota violations without blocking users and can be used to test quotas. In Audit mode, you can increase or decrease the amount of runtime quota and the amount of storage quota available to users affected by it.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Disabled</simpara></entry>
<entry align="left" valign="top"><simpara>This mode turns off the runtime and storage limitations defined by the quota.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>When a user attempts to run a virtual machine, the specifications of the virtual machine are compared to the storage allowance and the runtime allowance set in the applicable quota.</simpara>
<simpara>If starting a virtual machine causes the aggregated resources of all running virtual machines covered by a quota to exceed the allowance defined in the quota, then the Engine refuses to run the virtual machine.</simpara>
<simpara>When a user creates a new disk, the requested disk size is added to the aggregated disk usage of all the other disks covered by the applicable quota. If the new disk takes the total aggregated disk usage above the amount allowed by the quota, disk creation fails.</simpara>
<simpara>Quota allows for resource sharing of the same hardware. It supports hard and soft thresholds. Administrators can use a quota to set thresholds on resources. These thresholds appear, from the user&#8217;s point of view, as 100% usage of that resource. To prevent failures when the customer unexpectedly exceeds this threshold, the interface supports a "grace" amount by which the threshold can be briefly exceeded. Exceeding the threshold results in a warning sent to the customer.</simpara>
<important>
<simpara>Quota imposes limitations upon the running of virtual machines. Ignoring these limitations is likely to result in a situation in which you cannot use your virtual machines and virtual disks.</simpara>
<simpara>When quota is running in enforced mode, virtual machines and disks that do not have quotas assigned cannot be used.</simpara>
<simpara>To power on a virtual machine, a quota must be assigned to that virtual machine.</simpara>
<simpara>To create a snapshot of a virtual machine, the disk associated with the virtual machine must have a quota assigned.</simpara>
<simpara>When creating a template from a virtual machine, you are prompted to select the quota that you want the template to consume. This allows you to set the template (and all future machines created from the template) to consume a different quota than the virtual machine and disk from which the template is generated.</simpara>
</important>
</section>
<section xml:id="Shared_Quota_and_Individually-defined_Quota">
<title>Shared Quota and Individually Defined Quota</title>
<simpara>Users with SuperUser permissions can create quotas for individual users or quotas for groups.</simpara>
<simpara>Group quotas can be set for Active Directory users. If a group of ten users are given a quota of 1 TB of storage and one of the ten users fills the entire terabyte, then the entire group will be in excess of the quota and none of the ten users will be able to use any of the storage associated with their group.</simpara>
<simpara>An individual user&#8217;s quota is set for only the individual. Once the individual user has used up all of his or her storage or runtime quota, the user will be in excess of the quota and the user will no longer be able to use the storage associated with his or her quota.</simpara>
</section>
<section xml:id="Quota_Accounting">
<title>Quota Accounting</title>
<simpara>When a quota is assigned to a consumer or a resource, each action by that consumer or on the resource involving storage, vCPU, or memory results in quota consumption or quota release.</simpara>
<simpara>Since the quota acts as an upper bound that limits the user&#8217;s access to resources, the quota calculations may differ from the actual current use of the user. The quota is calculated for the max growth potential and not the current usage.</simpara>
<example>
<title>Accounting example</title>
<simpara>A user runs a virtual machine with 1 vCPU and 1024 MB memory. The action consumes 1 vCPU and 1024 MB of the quota assigned to that user. When the virtual machine is stopped 1 vCPU and 1024 MB of RAM are released back to the quota assigned to that user. Run-time quota consumption is accounted for only during the actual run-time of the consumer.</simpara>
<simpara>A user creates a virtual thin provision disk of 10 GB. The actual disk usage may indicate only 3 GB of that disk are actually in use. The quota consumption, however, would be 10 GB, the max growth potential of that disk.</simpara>
</example>
</section>
<section xml:id="Enabling_and_Changing_Quota_for_a_DC">
<title>Enabling and Changing a Quota Mode in a Data Center</title>
<simpara>This procedure enables or changes the quota mode in a data center. You must select a quota mode before you can define quotas. You must be logged in to the Administration Portal to follow the steps of this procedure.</simpara>
<simpara>Use <emphasis role="strong">Audit</emphasis> mode to test your quota to verify that it works as you expect it to. You do not need to have your quota in <emphasis role="strong">Audit</emphasis> mode to create or change a quota.</simpara>
<simpara><emphasis role="strong">Enabling and Changing Quota in a Data Center</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Data Centers</guimenuitem></menuchoice> and select a data center.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Quota Mode</emphasis> drop-down list, change the quota mode to <emphasis role="strong">Enforced</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>If you set the quota mode to <emphasis role="strong">Audit</emphasis> during testing, then you must change it to <emphasis role="strong">Enforced</emphasis> in order for the quota settings to take effect.</simpara>
</section>
<section xml:id="Creating_a_New_Quota_Policy">
<title>Creating a New Quota Policy</title>
<simpara>You have enabled quota mode, either in Audit or Enforcing mode. You want to define a quota policy to manage resource usage in your data center.</simpara>
<simpara><emphasis role="strong">Creating a New Quota Policy</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Quota</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Fill in the <emphasis role="strong">Name</emphasis> and <emphasis role="strong">Description</emphasis> fields.</simpara>
</listitem>
<listitem>
<simpara>Select a <emphasis role="strong">Data Center</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Memory &amp; CPU</emphasis> section, use the green slider to set <emphasis role="strong">Cluster Threshold</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Memory &amp; CPU</emphasis> section, use the blue slider to set <emphasis role="strong">Cluster Grace</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">All Clusters</emphasis> or the <emphasis role="strong">Specific Clusters</emphasis> radio button. If you select <emphasis role="strong">Specific Clusters</emphasis>, select the check box of the clusters that you want to add a quota policy to.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>. This opens the <emphasis role="strong">Edit Quota</emphasis> window.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Under the <emphasis role="strong">Memory</emphasis> field, select either the <emphasis role="strong">Unlimited</emphasis> radio button (to allow limitless use of Memory resources in the cluster), or select the <emphasis role="strong">limit to</emphasis> radio button to set the amount of memory set by this quota. If you select the <emphasis role="strong">limit to</emphasis> radio button, input a memory quota in megabytes (MB) in the <emphasis role="strong">MB</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Under the <emphasis role="strong">CPU</emphasis> field, select either the <emphasis role="strong">Unlimited</emphasis> radio button or the <emphasis role="strong">limit to</emphasis> radio button to set the amount of CPU set by this quota. If you select the <emphasis role="strong">limit to</emphasis> radio button, input a number of vCPUs in the <emphasis role="strong">vCpus</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> in the <emphasis role="strong">Edit Quota</emphasis> window.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Storage</emphasis> section, use the green slider to set <emphasis role="strong">Storage Threshold</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Storage</emphasis> section, use the blue slider to set <emphasis role="strong">Storage Grace</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">All Storage Domains</emphasis> or the <emphasis role="strong">Specific Storage Domains</emphasis> radio button. If you select <emphasis role="strong">Specific Storage Domains</emphasis>, select the check box of the storage domains that you want to add a quota policy to.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>. This opens the <emphasis role="strong">Edit Quota</emphasis> window.</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>Under the <emphasis role="strong">Storage Quota</emphasis> field, select either the <emphasis role="strong">Unlimited</emphasis> radio button (to allow limitless use of Storage) or the <emphasis role="strong">limit to</emphasis> radio button to set the amount of storage to which quota will limit users. If you select the <emphasis role="strong">limit to</emphasis> radio button, input a storage quota size in gigabytes (GB) in the <emphasis role="strong">GB</emphasis> field.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> in the <emphasis role="strong">Edit Quota</emphasis> window.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton> in the <emphasis role="strong">New Quota</emphasis> window.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Explanation_of_Quota_Threshold_Settings">
<title>Explanation of Quota Threshold Settings</title>
<table frame="all" rowsep="1" colsep="1">
<title>Quota thresholds and grace</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Setting</entry>
<entry align="left" valign="top">Definition</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Cluster Threshold</simpara></entry>
<entry align="left" valign="top"><simpara>The amount of cluster resources available per data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Cluster Grace</simpara></entry>
<entry align="left" valign="top"><simpara>The amount of the cluster available for the data center after exhausting the data center&#8217;s Cluster Threshold.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Storage Threshold</simpara></entry>
<entry align="left" valign="top"><simpara>The amount of storage resources available per data center.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Storage Grace</simpara></entry>
<entry align="left" valign="top"><simpara>The amount of storage available for the data center after exhausting the data center&#8217;s Storage Threshold.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>If a quota is set to 100 GB with 20% Grace, then consumers are blocked from using storage after they use 120 GB of storage. If the same quota has a Threshold set at 70%, then consumers receive a warning when they exceed 70 GB of storage consumption (but they remain able to consume storage until they reach 120 GB of storage consumption.) Both "Threshold" and "Grace" are set relative to the quota. "Threshold" may be thought of as the "soft limit", and exceeding it generates a warning. "Grace" may be thought of as the "hard limit", and exceeding it makes it impossible to consume any more storage resources.</simpara>
</section>
<section xml:id="Assigning_a_Quota_to_an_Object">
<title>Assigning a Quota to an Object</title>
<simpara><emphasis role="strong">Assigning a Quota to a Virtual Machine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> and select a virtual machine.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the quota you want the virtual machine to consume from the <emphasis role="strong">Quota</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">Assigning a Quota to a Virtual Disk</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click a virtual machine&#8217;s name. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Disks</emphasis> tab and select the disk you plan to associate with a quota.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the quota you want the virtual disk to consume from the <emphasis role="strong">Quota</emphasis> drop-down list.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<important>
<simpara>Quota must be selected for all objects associated with a virtual machine, in order for that virtual machine to work. If you fail to select a quota for the objects associated with a virtual machine, the virtual machine will not work. The error that the Engine throws in this situation is generic, which makes it difficult to know if the error was thrown because you did not associate a quota with all of the objects associated with the virtual machine. It is not possible to take snapshots of virtual machines that do not have an assigned quota. It is not possible to create templates of virtual machines whose virtual disks do not have assigned quotas.</simpara>
</important>
</section>
<section xml:id="Using_Quota_to_limit_user_resources">
<title>Using Quota to Limit Resources by User</title>
<simpara>This procedure describes how to use quotas to limit the resources a user has access to.</simpara>
<simpara><emphasis role="strong">Assigning a User to a Quota</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Quota</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the name of the target quota. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Consumers</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Search</emphasis> field, type the name of the user you want to associate with the quota.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">GO</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Select the check box next to the user&#8217;s name.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<simpara>After a short time, the user will appear in the <emphasis role="strong">Consumers</emphasis> tab in the details view.</simpara>
</section>
<section xml:id="Editing_Quotas">
<title>Editing Quotas</title>
<simpara>This procedure describes how to change existing quotas.</simpara>
<simpara><emphasis role="strong">Editing Quotas</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Quota</guimenuitem></menuchoice> and select a quota.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Edit the fields as required.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Removing_Quotas">
<title>Removing Quotas</title>
<simpara>This procedure describes how to remove quotas.</simpara>
<simpara><emphasis role="strong">Removing Quotas</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Quota</guimenuitem></menuchoice> and select a quota.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Service_Level_Agreement_Policy_Enforcement">
<title>Service Level Agreement Policy Enforcement</title>
<simpara>This procedure describes how to set service level agreement CPU features.</simpara>
<simpara><emphasis role="strong">Setting a Service Level Agreement CPU Policy</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">New</emphasis>, or select a virtual machine and click <emphasis role="strong">Edit</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Resource Allocation</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Specify <emphasis role="strong">CPU Shares</emphasis>. Possible options are <emphasis role="strong">Low</emphasis>, <emphasis role="strong">Medium</emphasis>, <emphasis role="strong">High</emphasis>, <emphasis role="strong">Custom</emphasis>, and <emphasis role="strong">Disabled</emphasis>. Virtual machines set to <emphasis role="strong">High</emphasis> receive twice as many shares as <emphasis role="strong">Medium</emphasis>, and virtual machines set to <emphasis role="strong">Medium</emphasis> receive twice as many shares as virtual machines set to <emphasis role="strong">Low</emphasis>. <emphasis role="strong">Disabled</emphasis> instructs VDSM to use an older algorithm for determining share dispensation; usually the number of shares dispensed under these conditions is 1020.</simpara>
</listitem>
</orderedlist>
<simpara>The CPU consumption of users is now governed by the policy you have set.</simpara>
</section>
</chapter>
<chapter xml:id="chap-Event_Notifications">
<title>Event Notifications</title>
<section xml:id="Configuring_event_notifications">
<title>Configuring Event Notifications in the Administration Portal</title>
<simpara>The oVirt Engine can notify designated users via email when specific events occur in the environment that the oVirt Engine manages. To use this functionality, you must set up a mail transfer agent to deliver messages. Only email notifications can be configured through the Administration Portal. SNMP traps must be configured on the Engine machine.</simpara>
<simpara><emphasis role="strong">Configuring Event Notifications</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Ensure that you have access to an email server that can accept automated messages from Engine and deliver them to a distribution list.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice> and select a user.</simpara>
</listitem>
<listitem>
<simpara>Click the user&#8217;s <emphasis role="strong">User Name</emphasis> to go to the details page.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Event Notifier</emphasis> tab, click <emphasis role="strong">Manage Events</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Expand All</emphasis> button or the subject-specific expansion buttons to view the events.</simpara>
</listitem>
<listitem>
<simpara>Select the appropriate check boxes.</simpara>
</listitem>
<listitem>
<simpara>Enter an email address in the <emphasis role="strong">Mail Recipient</emphasis> field.</simpara>
<note>
<simpara>The email address can be a text message email address (for example, <literal><emphasis>1234567890@carrierdomainname.com</emphasis></literal>) or an email group address that includes email addresses and text message email addresses.</simpara>
</note>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>On the Engine machine, copy <literal>ovirt-engine-notifier.conf</literal> to a new file called <literal>90-email-notify.conf</literal>:</simpara>
<screen># cp /usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf /etc/ovirt-engine/notifier/notifier.conf.d/90-email-notify.conf</screen>
</listitem>
<listitem>
<simpara>Edit <literal>90-email-notify.conf</literal>, deleting everything except the <literal>EMAIL Notifications</literal> section.</simpara>
</listitem>
<listitem>
<simpara>Enter the correct email variables, as in the example below. This file overrides the values in the original <literal>ovirt-engine-notifier.conf</literal> file.</simpara>
<screen>#---------------------#
# EMAIL Notifications #
#---------------------#

# The SMTP mail server address. Required.
MAIL_SERVER=myemailserver.example.com

# The SMTP port (usually 25 for plain SMTP, 465 for SMTP with SSL, 587 for SMTP with TLS)
MAIL_PORT=25

# Required if SSL or TLS enabled to authenticate the user. Used also to specify 'from' user address if mail server
# supports, when MAIL_FROM is not set. Address is in RFC822 format
MAIL_USER=

# Required to authenticate the user if mail server requires authentication or if SSL or TLS is enabled
SENSITIVE_KEYS="${SENSITIVE_KEYS},MAIL_PASSWORD"
MAIL_PASSWORD=

# Indicates type of encryption (none, ssl or tls) should be used to communicate with mail server.
MAIL_SMTP_ENCRYPTION=none

# If set to true, sends a message in HTML format.
HTML_MESSAGE_FORMAT=false

# Specifies 'from' address on sent mail in RFC822 format, if supported by mail server.
MAIL_FROM=rhevm2017@example.com

# Specifies 'reply-to' address on sent mail in RFC822 format.
MAIL_REPLY_TO=

# Interval to send smtp messages per # of IDLE_INTERVAL
MAIL_SEND_INTERVAL=1

# Amount of times to attempt sending an email before failing.
MAIL_RETRIES=4</screen>
<note>
<simpara>See <literal>/etc/ovirt-engine/notifier/notifier.conf.d/README</literal> for more options.</simpara>
</note>
</listitem>
<listitem>
<simpara>Enable and restart the <literal>ovirt-engine-notifier</literal> service to activate the changes you have made:</simpara>
<screen># systemctl daemon-reload
# systemctl enable ovirt-engine-notifier.service
# systemctl restart ovirt-engine-notifier.service</screen>
</listitem>
</orderedlist>
<simpara>The specified user now receives emails based on events in the oVirt environment. The selected events are displayed on the <emphasis role="strong">Event Notifier</emphasis> tab for that user.</simpara>
</section>
<section xml:id="Cancelling_event_notifications">
<title>Canceling Event Notifications in the Administration Portal</title>
<simpara>A user has configured some unnecessary email notifications and wants them canceled.</simpara>
<simpara><emphasis role="strong">Canceling Event Notifications</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Click <menuchoice><guimenu>Administration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Click the user&#8217;s <emphasis role="strong">User Name</emphasis>. This opens the details view.</simpara>
</listitem>
<listitem>
<simpara>Click the <emphasis role="strong">Event Notifier</emphasis> tab to list events for which the user receives email notifications.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Manage Events</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Expand All</emphasis> button, or the subject-specific expansion buttons, to view the events.</simpara>
</listitem>
<listitem>
<simpara>Clear the appropriate check boxes to remove notification for that event.</simpara>
</listitem>
<listitem>
<simpara>Click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="Parameters_for_event_notifications_in_notifier">
<title>Parameters for Event Notifications in ovirt-engine-notifier.conf</title>
<simpara>The event notifier configuration file can be found in <emphasis role="strong">/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</emphasis>.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>ovirt-engine-notifier.conf variables</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Variable Name</entry>
<entry align="left" valign="top">Default</entry>
<entry align="left" valign="top">Remarks</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>SENSITIVE_KEYS</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>A comma-separated list of keys that will not be logged.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>JBOSS_HOME</simpara></entry>
<entry align="left" valign="top"><simpara>/opt/rh/eap7/root/usr/share/wildfly</simpara></entry>
<entry align="left" valign="top"><simpara>The location of the JBoss application server used by the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_ETC</simpara></entry>
<entry align="left" valign="top"><simpara>/etc/ovirt-engine</simpara></entry>
<entry align="left" valign="top"><simpara>The location of the <literal>etc</literal> directory used by the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_LOG</simpara></entry>
<entry align="left" valign="top"><simpara>/var/log/ovirt-engine</simpara></entry>
<entry align="left" valign="top"><simpara>The location of the <literal>logs</literal> directory used by the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_USR</simpara></entry>
<entry align="left" valign="top"><simpara>/usr/share/ovirt-engine</simpara></entry>
<entry align="left" valign="top"><simpara>The location of the <literal>usr</literal> directory used by the Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_JAVA_MODULEPATH</simpara></entry>
<entry align="left" valign="top"><simpara>${ENGINE_USR}/modules</simpara></entry>
<entry align="left" valign="top"><simpara>The file path to which the JBoss modules are appended.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NOTIFIER_DEBUG_ADDRESS</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>The address of a machine that can be used to perform remote debugging of the Java virtual machine that the notifier uses.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NOTIFIER_STOP_TIME</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>The time, in seconds, after which the service will time out.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>NOTIFIER_STOP_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
<entry align="left" valign="top"><simpara>The time, in seconds, by which the timeout counter will be incremented.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>INTERVAL_IN_SECONDS</simpara></entry>
<entry align="left" valign="top"><simpara>120</simpara></entry>
<entry align="left" valign="top"><simpara>The interval in seconds between instances of dispatching messages to subscribers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>IDLE_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>The interval, in seconds, between which low-priority tasks will be performed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DAYS_TO_KEEP_HISTORY</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
<entry align="left" valign="top"><simpara>This variable sets the number of days dispatched events will be preserved in the history table. If this variable is not set, events remain on the history table indefinitely.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FAILED_QUERIES_NOTIFICATION_THRESHOLD</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>The number of failed queries after which a notification email is sent. A notification email is sent after the first failure to fetch notifications, and then once every time the number of failures specified by this variable is reached. If you specify a value of <literal>0</literal> or <literal>1</literal>, an email will be sent with each failure.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FAILED_QUERIES_NOTIFICATION_RECIPIENTS</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>The email addresses of the recipients to which notification emails will be sent. Email addresses must be separated by a comma. This entry has been deprecated by the <literal>FILTER</literal> variable.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>DAYS_TO_SEND_ON_STARTUP</simpara></entry>
<entry align="left" valign="top"><simpara>0</simpara></entry>
<entry align="left" valign="top"><simpara>The number of days of old events that will be processed and sent when the notifier starts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>FILTER</simpara></entry>
<entry align="left" valign="top"><simpara>exclude:*</simpara></entry>
<entry align="left" valign="top"><simpara>The algorithm used to determine the triggers for and recipients of email notifications. The value for this variable comprises a combination of <literal>include</literal> or <literal>exclude</literal>, the event, and the recipient. For example, <literal>include:VDC_START(smtp:mail@example.com) ${FILTER}</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_SERVER</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>The SMTP mail server address. Required.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_PORT</simpara></entry>
<entry align="left" valign="top"><simpara>25</simpara></entry>
<entry align="left" valign="top"><simpara>The port used for communication. Possible values include <literal>25</literal> for plain SMTP, <literal>465</literal> for SMTP with SSL, and <literal>587</literal> for SMTP with TLS.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_USER</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>If SSL is enabled to authenticate the user, then this variable must be set. This variable is also used to specify the "from" user address when the MAIL_FROM variable is not set. Some mail servers do not support this functionality. The address is in RFC822 format.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SENSITIVE_KEYS</simpara></entry>
<entry align="left" valign="top"><simpara>${SENSITIVE_KEYS},MAIL_PASSWORD</simpara></entry>
<entry align="left" valign="top"><simpara>Required to authenticate the user if the mail server requires authentication or if SSL or TLS is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_PASSWORD</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>Required to authenticate the user if the mail server requires authentication or if SSL or TLS is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_SMTP_ENCRYPTION</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>The type of encryption to be used in communication. Possible values are <literal>none</literal>, <literal>ssl</literal>, <literal>tls</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>HTML_MESSAGE_FORMAT</simpara></entry>
<entry align="left" valign="top"><simpara>false</simpara></entry>
<entry align="left" valign="top"><simpara>The mail server sends messages in HTML format if this variable is set to <literal>true</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_FROM</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>This variable specifies a sender address in RFC822 format, if supported by the mail server.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_REPLY_TO</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>This variable specifies reply-to addresses in RFC822 format on sent mail, if supported by the mail server.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_SEND_INTERVAL</simpara></entry>
<entry align="left" valign="top"><simpara>1</simpara></entry>
<entry align="left" valign="top"><simpara>The number of SMTP messages to be sent for each IDLE_INTERVAL</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>MAIL_RETRIES</simpara></entry>
<entry align="left" valign="top"><simpara>4</simpara></entry>
<entry align="left" valign="top"><simpara>The number of times to attempt to send an email before failing.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SNMP_MANAGER</simpara></entry>
<entry align="left" valign="top"><simpara>none</simpara></entry>
<entry align="left" valign="top"><simpara>The IP addresses or fully qualified domain names of machines that will act as the SNMP managers. Entries must be separated by a space and can contain a port number. For example, <literal>manager1.example.com manager2.example.com:164</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SNMP_COMMUNITY</simpara></entry>
<entry align="left" valign="top"><simpara>public</simpara></entry>
<entry align="left" valign="top"><simpara>The default SNMP community.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SNMP_OID</simpara></entry>
<entry align="left" valign="top"><simpara>1.3.6.1.4.1.2312.13.1.1</simpara></entry>
<entry align="left" valign="top"><simpara>The default trap object identifiers for alerts. All trap types are sent, appended with event information, to the SNMP manager when this OID is defined. Note that changing the default trap prevents generated traps from complying with the Engine&#8217;s management information base.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_INTERVAL_IN_SECONDS</simpara></entry>
<entry align="left" valign="top"><simpara>300</simpara></entry>
<entry align="left" valign="top"><simpara>The interval, in seconds, between monitoring the machine on which the Engine is installed. The interval is measured from the time the monitoring is complete.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_MONITOR_RETRIES</simpara></entry>
<entry align="left" valign="top"><simpara>3</simpara></entry>
<entry align="left" valign="top"><simpara>The number of times the notifier attempts to monitor the status of the machine on which the Engine is installed in a given interval after a failure.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_TIMEOUT_IN_SECONDS</simpara></entry>
<entry align="left" valign="top"><simpara>30</simpara></entry>
<entry align="left" valign="top"><simpara>The time, in seconds, to wait before the notifier attempts to monitor the status of the machine on which the Engine is installed in a given interval after a failure.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>IS_HTTPS_PROTOCOL</simpara></entry>
<entry align="left" valign="top"><simpara>false</simpara></entry>
<entry align="left" valign="top"><simpara>This entry must be set to <literal>true</literal> if JBoss is being run in secured mode.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SSL_PROTOCOL</simpara></entry>
<entry align="left" valign="top"><simpara>TLS</simpara></entry>
<entry align="left" valign="top"><simpara>The protocol used by JBoss configuration connector when SSL is enabled.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SSL_IGNORE_CERTIFICATE_ERRORS</simpara></entry>
<entry align="left" valign="top"><simpara>false</simpara></entry>
<entry align="left" valign="top"><simpara>This value must be set to <literal>true</literal> if JBoss is running in secure mode and SSL errors is to be ignored.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>SSL_IGNORE_HOST_VERIFICATION</simpara></entry>
<entry align="left" valign="top"><simpara>false</simpara></entry>
<entry align="left" valign="top"><simpara>This value must be set to <literal>true</literal> if JBoss is running in secure mode and host name verification is to be ignored.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>REPEAT_NON_RESPONSIVE_NOTIFICATION</simpara></entry>
<entry align="left" valign="top"><simpara>false</simpara></entry>
<entry align="left" valign="top"><simpara>This variable specifies whether repeated failure messages will be sent to subscribers if the machine on which the Engine is installed is non-responsive.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>ENGINE_PID</simpara></entry>
<entry align="left" valign="top"><simpara>/var/lib/ovirt-engine/ovirt-engine.pid</simpara></entry>
<entry align="left" valign="top"><simpara>The path and file name of the PID of the Engine.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Configuring_the_Red_Hat_Enterprise_Virtualization_Manager_to_Send_SNMP_Traps">
<title>Configuring the oVirt Engine to Send SNMP Traps</title>
<simpara>Configure your oVirt Engine to send Simple Network Management Protocol traps to one or more external SNMP managers. SNMP traps contain system event information; they are used to monitor your oVirt environment. The number and type of traps sent to the SNMP manager can be defined within the oVirt Engine.</simpara>
<simpara>This procedure assumes that you have configured one or more external SNMP managers to receive traps, and that you have the following details:</simpara>
<itemizedlist>
<listitem>
<simpara>The IP addresses or fully qualified domain names of machines that will act as SNMP managers. Optionally, determine the port through which Engine receives trap notifications; by default, this is UDP port 162.</simpara>
</listitem>
<listitem>
<simpara>The SNMP community. Multiple SNMP managers can belong to a single community. Management systems and agents can communicate only if they are within the same community. The default community is <literal>public</literal>.</simpara>
</listitem>
<listitem>
<simpara>The trap object identifier for alerts. The oVirt Engine provides a default OID of 1.3.6.1.4.1.2312.13.1.1. All trap types are sent, appended with event information, to the SNMP manager when this OID is defined. Note that changing the default trap prevents generated traps from complying with the Engine&#8217;s management information base.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>The oVirt Engine provides management information bases at <emphasis role="strong">/usr/share/doc/ovirt-engine/mibs/OVIRT-MIB.txt</emphasis> and <emphasis role="strong">/usr/share/doc/ovirt-engine/mibs/REDHAT-MIB.txt</emphasis>. Load the MIBs in your SNMP manager before proceeding.</simpara>
</note>
<simpara>Default SNMP configuration values exist on the Engine in the events notification daemon configuration file <emphasis role="strong">/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</emphasis>. The values outlined in the following procedure are based on the default or example values provided in that file. It is recommended that you define an override file, rather than edit the <emphasis role="strong">ovirt-engine-notifier.conf</emphasis> file, to persist your configuration options after changes such as system upgrades.</simpara>
<simpara><emphasis role="strong">Configuring SNMP Traps on the Engine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine, create the SNMP configuration file:</simpara>
<screen># vi /etc/ovirt-engine/notifier/notifier.conf.d/20-snmp.conf</screen>
</listitem>
<listitem>
<simpara>Specify the SNMP manager(s), the SNMP community, and the OID in the following format:</simpara>
<screen>SNMP_MANAGERS="<emphasis>manager1.example.com</emphasis> <emphasis>manager2.example.com:162"</emphasis>
SNMP_COMMUNITY=public
SNMP_OID=1.3.6.1.4.1.2312.13.1.1</screen>
</listitem>
<listitem>
<simpara>Define which events to send to the SNMP manager:</simpara>
<example>
<title>Event Examples</title>
<simpara>Send all events to the default SNMP profile:</simpara>
<screen>FILTER="include:*(snmp:) ${FILTER}"</screen>
<simpara>Send all events with the severity <literal>ERROR</literal> or <literal>ALERT</literal> to the default SNMP profile:</simpara>
<screen>FILTER="include:*:ERROR(snmp:) ${FILTER}"</screen>
<screen>FILTER="include:*:ALERT(snmp:) ${FILTER}"</screen>
<simpara>Send events for <emphasis>VDC_START</emphasis> to the specified email address:</simpara>
<screen>FILTER="include:<emphasis>VDC_START</emphasis>(snmp:<emphasis>mail@example.com</emphasis>) ${FILTER}"</screen>
<simpara>Send events for everything but <emphasis>VDC_START</emphasis> to the default SNMP profile:</simpara>
<screen>FILTER="exclude:<emphasis>VDC_START</emphasis> include:*(snmp:) ${FILTER}"</screen>
<simpara>This the default filter defined in <emphasis role="strong">ovirt-engine-notifier.conf</emphasis>; if you do not disable this filter or apply overriding filters, no notifications will be sent:</simpara>
<screen>FILTER="exclude:*"</screen>
</example>
<simpara><literal>VDC_START</literal> is an example of the audit log messages available. A full list of audit log messages can be found in <emphasis role="strong">/usr/share/doc/ovirt-engine/AuditLogMessages.properties</emphasis>. Alternatively, filter results within your SNMP manager.</simpara>
</listitem>
<listitem>
<simpara>Save the file.</simpara>
</listitem>
<listitem>
<simpara>Start the <literal>ovirt-engine-notifier</literal> service, and ensure that this service starts on boot:</simpara>
<screen># systemctl start ovirt-engine-notifier.service
# systemctl enable ovirt-engine-notifier.service</screen>
</listitem>
</orderedlist>
<simpara>Check your SNMP manager to ensure that traps are being received.</simpara>
<note>
<simpara><literal>SNMP_MANAGERS</literal>, <literal>MAIL_SERVER</literal>, or both must be properly defined in <emphasis role="strong">/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</emphasis> or in an override file in order for the notifier service to run.</simpara>
</note>
</section>
</chapter>
<chapter xml:id="chap-Utilities">
<title>Utilities</title>
<section xml:id="sect-The_oVirt_Engine_Rename_Tool">
<title>The oVirt Engine Rename Tool</title>
<section xml:id="The_oVirt_Engine_Rename_Tool">
<title>The oVirt Engine Rename Tool</title>
<simpara>When the <literal>engine-setup</literal> command is run in a clean environment, the command generates a number of certificates and keys that use the fully qualified domain name of the Engine supplied during the setup process. If the fully qualified domain name of the Engine must be changed later on (for example, due to migration of the machine hosting the Engine to a different domain), the records of the fully qualified domain name must be updated to reflect the new name. The <literal>ovirt-engine-rename</literal> command automates this task.</simpara>
<simpara>The <literal>ovirt-engine-rename</literal> command updates records of the fully qualified domain name of the Engine in the following locations:</simpara>
<itemizedlist>
<listitem>
<simpara>/etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf</simpara>
</listitem>
<listitem>
<simpara>/etc/ovirt-engine/isouploader.conf.d/10-engine-setup.conf</simpara>
</listitem>
<listitem>
<simpara>/etc/ovirt-engine/logcollector.conf.d/10-engine-setup.conf</simpara>
</listitem>
<listitem>
<simpara>/etc/pki/ovirt-engine/cert.conf</simpara>
</listitem>
<listitem>
<simpara>/etc/pki/ovirt-engine/cert.template</simpara>
</listitem>
<listitem>
<simpara>/etc/pki/ovirt-engine/certs/apache.cer</simpara>
</listitem>
<listitem>
<simpara>/etc/pki/ovirt-engine/keys/apache.key.nopass</simpara>
</listitem>
<listitem>
<simpara>/etc/pki/ovirt-engine/keys/apache.p12</simpara>
</listitem>
</itemizedlist>
<warning>
<simpara>While the <literal>ovirt-engine-rename</literal> command creates a new certificate for the web server on which the Engine runs, it does not affect the certificate for the Engine or the certificate authority. Due to this, there is some risk involved in using the <literal>ovirt-engine-rename</literal> command, particularly in environments that have been upgraded from Red Hat Enterprise Virtualization 3.2 and earlier. Therefore, changing the fully qualified domain name of the Engine by running <literal>engine-cleanup</literal> and <literal>engine-setup</literal> is recommended where possible.</simpara>
</warning>
<warning>
<simpara>During the upgrade process, the old hostname must be resolvable. If the oVirt Engine Rename Tool fails with the message <literal>[ ERROR ] Host name is not valid: &lt;OLD FQDN&gt; did not resolve into an IP address</literal>, add the old hostname to the <literal>/etc/hosts</literal> file, use the oVirt Engine Rename Tool, and then remove the old hostname from the <literal>/etc/hosts</literal> file.</simpara>
</warning>
</section>
<section xml:id="Syntax_for_the_oVirt_Engine_Rename_Command">
<title>Syntax for the oVirt Engine Rename Command</title>
<simpara>The basic syntax for the <literal>ovirt-engine-rename</literal> command is:</simpara>
<screen># /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename</screen>
<simpara>The command also accepts the following options:</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>--newname=<emphasis>[new name]</emphasis></literal></emphasis></term>
<listitem>
<simpara>Allows you to specify the new fully qualified domain name for the Engine without user interaction.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--log=<emphasis>[file]</emphasis></literal></emphasis></term>
<listitem>
<simpara>Allows you to specify the path and name of a file into which logs of the rename operation are to be written.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--config=<emphasis>[file]</emphasis></literal></emphasis></term>
<listitem>
<simpara>Allows you to specify the path and file name of a configuration file to load into the rename operation.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--config-append=<emphasis>[file]</emphasis></literal></emphasis></term>
<listitem>
<simpara>Allows you to specify the path and file name of a configuration file to append to the rename operation. This option can be used to specify the path and file name of an existing answer file to automate the rename operation.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--generate-answer=<emphasis>[file]</emphasis></literal></emphasis></term>
<listitem>
<simpara>Allows you to specify the path and file name of the file in which your answers and the values changed by the <literal>ovirt-engine-rename</literal> command are recorded.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool">
<title>Renaming the Engine with the oVirt Engine Rename Tool</title>
<simpara>You can use the <literal>ovirt-engine-rename</literal> command to update records of the fully qualified domain name (FQDN) of the Engine.</simpara>
<important>
<simpara>The <literal>ovirt-engine-rename</literal> command does not update SSL certificates, such as <literal>imageio-proxy</literal> or <literal>websocket-proxy</literal>. These must be updated manually, after running <literal>ovirt-engine-rename</literal>. See <link linkend="Updating_SSL_Certificates">Updating SSL Certificates</link> below.</simpara>
</important>
<simpara>The tool checks whether the Engine provides a local ISO or Data storage domain. If it does, the tool prompts the user to eject, shut down, or place into maintenance mode any virtual machine or storage domain connected to the storage before continuing with the operation. This ensures that virtual machines do not lose connectivity with their virtual disks, and prevents ISO storage domains from losing connectivity during the renaming process.</simpara>
<simpara><emphasis role="strong">Using the oVirt Engine Rename Tool</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Prepare all DNS and other relevant records for the new FQDN.</simpara>
</listitem>
<listitem>
<simpara>Update the DHCP server configuration if DHCP is used.</simpara>
</listitem>
<listitem>
<simpara>Update the host name on the Engine.</simpara>
</listitem>
<listitem>
<simpara>Run the following command:</simpara>
<screen># /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename</screen>
</listitem>
<listitem>
<simpara>When prompted, press <literal>Enter</literal> to stop the engine service:</simpara>
<screen>During execution engine service will be stopped (OK, Cancel) [OK]:</screen>
</listitem>
<listitem>
<simpara>When prompted, enter the new FQDN for the Engine:</simpara>
<screen>New fully qualified server name:<emphasis>new_engine_fqdn</emphasis></screen>
</listitem>
</orderedlist>
<simpara>The <literal>ovirt-engine-rename</literal> command updates records of the FQDN of the Engine.</simpara>
<simpara><emphasis role="strong">For a self-hosted engine, complete these additional steps:</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Run the following command on every existing self-hosted engine node:</simpara>
<screen># hosted-engine --set-shared-config fqdn <emphasis>new_engine_fqdn</emphasis> --type=he_local</screen>
<simpara>This command modifies the FQDN in each self-hosted engine node&#8217;s local copy of <literal role="filename">/etc/ovirt-hosted-engine-ha/hosted-engine.conf</literal></simpara>
</listitem>
<listitem>
<simpara>Run the following command on one of the self-hosted engine nodes:</simpara>
<screen># hosted-engine --set-shared-config fqdn <emphasis>new_engine_fqdn</emphasis> --type=he_shared</screen>
<simpara>This command modifies the FQDN in the master copy of <literal role="filename">/etc/ovirt-hosted-engine-ha/hosted-engine.conf</literal> on the shared storage domain.</simpara>
</listitem>
</orderedlist>
<simpara>Now, all new and existing self-hosted engine nodes use the new FQDN.</simpara>
<section xml:id="Updating_SSL_Certificates">
<title>Updating SSL Certificates</title>
<simpara>Run the following commands after the <literal>ovirt-engine-rename</literal> command to update the SSL certificates:</simpara>
<screen># names="websocket-proxy"</screen>
<screen># subject="$(\
    openssl x509 \
    -in /etc/pki/ovirt-engine/certs/apache.cer \
    -noout \
    -subject | \
        sed \
            's;subject= \(.*\);\1;'
  )"</screen>
<screen># . /usr/share/ovirt-engine/bin/engine-prolog.sh</screen>
<screen># for name in $names; do
    /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --keep-key \
        --san=DNS:"${ENGINE_FQDN}"
  done</screen>
</section>
</section>
</section>
<section xml:id="sect-The_Engine_Configuration_Tool">
<title>The Engine Configuration Tool</title>
<section xml:id="The_Engine_Configuration_Tool">
<title>The Engine Configuration Tool</title>
<simpara>The engine configuration tool is a command-line utility for configuring global settings for your oVirt environment. The tool interacts with a list of key-value mappings that are stored in the engine database, and allows you to retrieve and set the value of individual keys, and retrieve a list of all available configuration keys and values. Furthermore, different values can be stored for each configuration level in your oVirt environment.</simpara>
<note>
<simpara>Neither the oVirt Engine nor Red Hat JBoss Enterprise Application Platform need to be running to retrieve or set the value of a configuration key. Because the configuration key value-key mappings are stored in the engine database, they can be updated while the <literal>postgresql</literal> service is running. Changes are then applied when the <literal>ovirt-engine</literal> service is restarted.</simpara>
</note>
</section>
<section xml:id="Syntax_for_the_engine-config_Command">
<title>Syntax for the engine-config Command</title>
<simpara>You can run the engine configuration tool from the machine on which the oVirt Engine is installed. For detailed information on usage, print the help output for the command:</simpara>
<screen># engine-config --help</screen>
<simpara><emphasis role="strong">Common tasks:</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>List available configuration keys</simpara>
<screen># engine-config --list</screen>
</listitem>
<listitem>
<simpara>List available configuration values</simpara>
<screen># engine-config --all</screen>
</listitem>
<listitem>
<simpara>Retrieve value of configuration key</simpara>
<screen># engine-config --get <emphasis>KEY_NAME</emphasis></screen>
<simpara>Replace <emphasis>KEY_NAME</emphasis> with the name of the preferred key to retrieve the value for the given version of the key. Use the <literal>--cver</literal> parameter to specify the configuration version of the value to be retrieved. If no version is provided, values for all existing versions are returned.</simpara>
</listitem>
<listitem>
<simpara>Set value of configuration key</simpara>
<screen># engine-config --set <emphasis>KEY_NAME</emphasis>=<emphasis>KEY_VALUE</emphasis> --cver=<emphasis>VERSION</emphasis></screen>
<simpara>Replace <emphasis>KEY_NAME</emphasis> with the name of the specific key to set, and replace <emphasis>KEY_VALUE</emphasis> with the value to be set. You must specify the <emphasis>VERSION</emphasis> in environments with more than one configuration version.</simpara>
</listitem>
<listitem>
<simpara>Restart the ovirt-engine service to load changes</simpara>
<simpara>The <emphasis role="strong">ovirt-engine</emphasis> service needs to be restarted for your changes to take effect.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</itemizedlist>
</section>
</section>
<section xml:id="sect-The_USB_Filter_Editor">
<title>The USB Filter Editor</title>
<section xml:id="Installing_the_USB_Filter_Editor">
<title>Installing the USB Filter Editor</title>
<simpara>The USB Filter Editor is a Windows tool used to configure the <emphasis role="strong">usbfilter.txt</emphasis> policy file. The policy rules defined in this file allow or deny automatic passthrough of specific USB devices from client machines to virtual machines managed using the oVirt Engine. The policy file resides on the oVirt Engine in the following location:
<emphasis role="strong">/etc/ovirt-engine/usbfilter.txt</emphasis>
Changes to USB filter policies do not take effect unless the <emphasis role="strong">ovirt-engine</emphasis> service on the oVirt Engine is restarted.</simpara>
<simpara>Download the <emphasis role="strong">USB Filter Editor</emphasis> installer from <link xl:href="https://access.redhat.com/downloads/content/415/">this "Installers and Images for oVirt Engine"</link> topic.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>On a Windows machine, extract the <emphasis role="strong">.msi</emphasis> intaller from the <emphasis role="strong">.zip</emphasis> file and run the <emphasis role="strong">.msi</emphasis> installer.</simpara>
</listitem>
<listitem>
<simpara>Follow the steps of the installation wizard. Unless otherwise specified, the USB Filter Editor will be installed by default in either <emphasis role="strong">C:\Program Files\RedHat\USB Filter Editor</emphasis> or <emphasis role="strong">C:\Program Files(x86)\RedHat\USB Filter Editor</emphasis> depending on your version of Windows.</simpara>
</listitem>
<listitem>
<simpara>A USB Filter Editor shortcut icon is created on your desktop.</simpara>
</listitem>
</orderedlist>
<important>
<simpara>Use a Secure Copy (SCP) client to import and export filter policies from the oVirt Engine. A Secure Copy tool for Windows machines is WinSCP (<link xl:href="http://winscp.net">http://winscp.net</link>).</simpara>
</important>
<simpara>The default USB device policy provides virtual machines with basic access to USB devices; update the policy to allow the use of additional USB devices.</simpara>
</section>
<section xml:id="The_USB_Filter_Editor_interface">
<title>The USB Filter Editor Interface</title>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop.</simpara>
<simpara>The <emphasis role="strong">Red Hat USB Filter Editor</emphasis> interface displays the <emphasis role="strong">Class</emphasis>, <emphasis role="strong">Vendor</emphasis>, <emphasis role="strong">Product</emphasis>, <emphasis role="strong">Revision</emphasis>, and <emphasis role="strong">Action</emphasis> for each USB device. Permitted USB devices are set to <emphasis role="strong">Allow</emphasis> in the <emphasis role="strong">Action</emphasis> column; prohibited devices are set to <emphasis role="strong">Block</emphasis>.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>USB Editor Fields</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Class</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Type of USB device; for example, printers, mass storage controllers.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Vendor</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The manufacturer of the selected type of device.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Product</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The specific USB device model.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Revision</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The revision of the product.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Action</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Allow or block the specified device.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>The USB device policy rules are processed in their listed order. Use the <emphasis role="strong">Up</emphasis> and <emphasis role="strong">Down</emphasis> buttons to move rules higher or lower in the list. The universal <emphasis role="strong">Block</emphasis> rule needs to remain as the lowest entry to ensure all USB devices are denied unless explicitly allowed in the USB Filter Editor.</simpara>
</section>
<section xml:id="Adding_a_USB_policy">
<title>Adding a USB Policy</title>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click  <emphasis role="strong">Add</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">USB Class</emphasis>, <emphasis role="strong">Vendor ID</emphasis>, <emphasis role="strong">Product ID</emphasis>, and <emphasis role="strong">Revision</emphasis> check boxes and lists to specify the device.</simpara>
<simpara>Click the <emphasis role="strong">Allow</emphasis> button to permit virtual machines use of the USB device; click the <emphasis role="strong">Block</emphasis> button to prohibit the USB device from virtual machines.</simpara>
<simpara>Click <guibutton>OK</guibutton> to add the selected filter rule to the list and close the window.</simpara>
<example>
<title>Adding a Device</title>
<simpara>The following is an example of how to add USB Class <literal>Smartcard</literal>, device <literal>EP-1427X-2 Ethernet Adapter</literal>, from manufacturer <literal>Acer Communications &amp; Multimedia</literal> to the list of allowed devices.</simpara>
<informalfigure>
<mediaobject>
<imageobject>
<imagedata fileref="images/306.png"/>
</imageobject>
<textobject><phrase>306</phrase></textobject>
</mediaobject>
</informalfigure>
</example>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>File</guimenu> <guimenuitem>Save</guimenuitem></menuchoice> to save the changes.</simpara>
</listitem>
</orderedlist>
<simpara>You have added a USB policy to the USB Filter Editor. You need to export USB filter policies to the oVirt Engine for them to take effect.</simpara>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#Exporting_a_USB_policy">Exporting a USB Policy</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Removing_a_USB_policy">
<title>Removing a USB Policy</title>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Select the policy to be removed.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Remove</emphasis>. A message displays prompting you to confirm that you want to remove the policy.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Yes</emphasis> to confirm that you want to remove the policy.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>File</guimenu> <guimenuitem>Save</guimenuitem></menuchoice> to save the changes.</simpara>
</listitem>
</orderedlist>
<simpara>You have removed a USB policy from the USB Filter Editor. You need to export USB filter policies to the oVirt Engine for them to take effect.</simpara>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://ovirt.org/documentation/administration_guide/index#Exporting_a_USB_policy">Exporting a USB Policy</link></simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Searching_for_USB_device_policies">
<title>Searching for USB Device Policies</title>
<simpara>Search for attached USB devices to either allow or block them in the USB Filter Editor.</simpara>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <emphasis role="strong">Search</emphasis>. The <emphasis role="strong">Attached USB Devices</emphasis> window displays a list of all the attached devices.</simpara>
</listitem>
<listitem>
<simpara>Select the device and click <emphasis role="strong">Allow</emphasis> or <emphasis role="strong">Block</emphasis> as appropriate. Double-click the selected device to close the window. A policy rule for the device is added to the list.</simpara>
</listitem>
<listitem>
<simpara>Use the <emphasis role="strong">Up</emphasis> and <emphasis role="strong">Down</emphasis> buttons to change the position of the new policy rule in the list.</simpara>
</listitem>
<listitem>
<simpara>Click <menuchoice><guimenu>File</guimenu> <guimenuitem>Save</guimenuitem></menuchoice> to save the changes.</simpara>
</listitem>
</orderedlist>
<simpara>You have searched the attached USB devices. USB filter policies need to be exported to the oVirt Engine to take effect.</simpara>
</section>
<section xml:id="Exporting_a_USB_policy">
<title>Exporting a USB Policy</title>
<simpara>USB device policy changes need to be exported and uploaded to the oVirt Engine for the updated policy to take effect. Upload the policy and restart the <emphasis role="strong">ovirt-engine</emphasis> service.</simpara>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Click <emphasis role="strong">Export</emphasis>; the <emphasis role="strong">Save As</emphasis> window opens.</simpara>
</listitem>
<listitem>
<simpara>Save the file with a file name of <emphasis role="strong">usbfilter.txt</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Using a Secure Copy client, such as WinSCP, upload the <emphasis role="strong">usbfilter.txt</emphasis> file to the server running oVirt Engine. The file must be placed in the following directory on the server:
<emphasis role="strong">/etc/ovirt-engine/</emphasis></simpara>
</listitem>
<listitem>
<simpara>As the <emphasis role="strong">root</emphasis> user on the server running oVirt Engine, restart the <emphasis role="strong">ovirt-engine</emphasis> service.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
</section>
<section xml:id="Importing_a_USB_policy">
<title>Importing a USB Policy</title>
<simpara>An existing USB device policy must be downloaded and imported into the USB Filter Editor before you can edit it.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Using a Secure Copy client, such as WinSCP, download the <emphasis role="strong">usbfilter.txt</emphasis> file from the server running oVirt Engine. The file can be found in the following directory on the server:
<emphasis role="strong">/etc/ovirt-engine/</emphasis></simpara>
</listitem>
<listitem>
<simpara>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</simpara>
</listitem>
<listitem>
<simpara>Click <emphasis role="strong">Import</emphasis>. This opens the <emphasis role="strong">Open</emphasis> window.</simpara>
</listitem>
<listitem>
<simpara>Open the <emphasis role="strong">usbfilter.txt</emphasis> file that was downloaded from the server.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="sect-The_ISO_Uploader_Tool">
<title>The ISO Uploader Tool</title>
<section xml:id="The_ISO_Uploader_Tool">
<title>The ISO Uploader Tool</title>
<note>
<simpara>The ISO Uploader tool has been deprecated. Upload ISO images to the data domain with the Administration Portal or with the REST API. See <xref linkend="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks"/> for details.</simpara>
</note>
<simpara>The ISO uploader is a tool for uploading ISO images to the ISO storage domain. It is installed as part of the oVirt Engine.</simpara>
<simpara>The ISO uploader command is <literal>engine-iso-uploader</literal>. You must log in as the <emphasis role="strong">root</emphasis> user and provide the administration credentials for the oVirt environment to use this command. The <literal>engine-iso-uploader -h</literal> command displays usage information, including a list of all valid options for the <literal>engine-iso-uploader</literal> command.</simpara>
</section>
<section xml:id="Syntax_for_the_engine-iso-uploader_Command">
<title>Syntax for the engine-iso-uploader Command</title>
<simpara>The basic syntax for the ISO uploader command is:</simpara>
<screen># engine-iso-uploader <emphasis>options</emphasis> list
# engine-iso-uploader <emphasis>options</emphasis> upload <emphasis>file file file</emphasis></screen>
<simpara>The ISO uploader command supports two actions - <literal>list</literal>, and <literal>upload</literal>.</simpara>
<itemizedlist>
<listitem>
<simpara>The <literal>list</literal> action lists the ISO storage domains to which ISO files can be uploaded. The oVirt Engine creates this list on the machine on which the Engine is installed during the installation process.</simpara>
</listitem>
<listitem>
<simpara>The <literal>upload</literal> action uploads a single ISO file or multiple ISO files separated by spaces to the specified ISO storage domain. NFS is used by default, but SSH is also available.</simpara>
<note>
<simpara>If you use SSH, you are prompted multiple times to enter the SSH user password. You can avoid these prompts by uploading the public SSH key to the iso domain server before uploading an ISO file, and then using the <literal>--key-file=<emphasis>KEYFILE</emphasis></literal> option. One way to upload the public SSH key is to use the <literal>ssh-copy-id -i ~/.ssh/<emphasis>mykey</emphasis> <emphasis>user@host</emphasis></literal> command.</simpara>
</note>
</listitem>
</itemizedlist>
<simpara>You must specify one of the above actions when you use the ISO uploader command. Moreover, you must specify at least one local file to use the <literal>upload</literal> action.</simpara>
<simpara>There are several parameters to further refine the <literal>engine-iso-uploader</literal> command.</simpara>
<simpara><emphasis role="strong">General Options</emphasis></simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>--version</literal></emphasis></term>
<listitem>
<simpara>Displays the version of the ISO uploader command.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-h</literal>, <literal>--help</literal></emphasis></term>
<listitem>
<simpara>Displays information on how to use the ISO uploader command.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--conf-file=<emphasis>PATH</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>PATH</emphasis> as the configuration file the command will to use. The default is <emphasis role="strong">/etc/ovirt-engine/isouploader.conf</emphasis>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--log-file=<emphasis>PATH</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>PATH</emphasis> as the specific file name the command will use to write log output. The default is <emphasis role="strong">/var/log/ovirt-engine/ovirt-iso-uploader/ovirt-iso-uploader<emphasis>_date</emphasis>.log</emphasis>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--cert-file=<emphasis>PATH</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>PATH</emphasis> as the certificate for validating the engine. The default is <emphasis role="strong">/etc/pki/ovirt-engine/ca.pem</emphasis>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--insecure</literal></emphasis></term>
<listitem>
<simpara>Specifies that no attempt will be made to verify the engine.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--nossl</literal></emphasis></term>
<listitem>
<simpara>Specifies that SSL will not be used to connect to the engine.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--quiet</literal></emphasis></term>
<listitem>
<simpara>Sets quiet mode, reducing console output to a minimum.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-v</literal>, <literal>--verbose</literal></emphasis></term>
<listitem>
<simpara>Sets verbose mode, providing more console output.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-f</literal>, <literal>--force</literal></emphasis></term>
<listitem>
<simpara>Force mode is necessary when the source file being uploaded has the same file name as an existing file in the destination ISO domain. This option forces the existing file to be overwritten.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><emphasis role="strong">oVirt Engine Options</emphasis></simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>-u <emphasis>USER</emphasis></literal>, <literal>--user=<emphasis>USER</emphasis></literal></emphasis></term>
<listitem>
<simpara>Specifies the user whose credentials will be used to execute the command. The <emphasis>USER</emphasis> is specified in the format <emphasis>username</emphasis>@<emphasis>domain</emphasis>. The user must exist in the specified domain and be known to the oVirt Engine.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-r <emphasis>FQDN</emphasis></literal>, <literal>--engine=<emphasis>FQDN</emphasis></literal></emphasis></term>
<listitem>
<simpara>Specifies the IP address or fully qualified domain name of the oVirt Engine from which the images will be uploaded. It is assumed that the image uploader is being run from the same machine on which the oVirt Engine is installed. The default value is <literal>localhost:443</literal>.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><emphasis role="strong">ISO Storage Domain Options</emphasis></simpara>
<simpara>The following options specify the ISO domain to which the images will be uploaded. These options cannot be used together; you must used either the <literal>-i</literal> option or the <literal>-n</literal> option.</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>-i</literal>, <literal>--iso-domain=<emphasis>ISODOMAIN</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets the storage domain <emphasis>ISODOMAIN</emphasis> as the destination for uploads.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-n</literal>, <literal>--nfs-server=<emphasis>NFSSERVER</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets the NFS path <emphasis>NFSSERVER</emphasis> as the destination for uploads.</simpara>
</listitem>
</varlistentry>
</variablelist>
<simpara><emphasis role="strong">Connection Options</emphasis></simpara>
<simpara>The ISO uploader uses NFS as default to upload files. These options specify SSH file transfer instead.</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>--ssh-user=<emphasis>USER</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>USER</emphasis> as the SSH user name to use for the upload. The default is <literal>root</literal>.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>--ssh-port=<emphasis>PORT</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>PORT</emphasis> as the port to use when connecting to SSH.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-k <emphasis>KEYFILE</emphasis></literal>, <literal>--key-file=<emphasis>KEYFILE</emphasis></literal></emphasis></term>
<listitem>
<simpara>Sets <emphasis>KEYFILE</emphasis> as the private key to use for SSH authentication. If you don&#8217;t set a key, you are prompted to enter the password of the user specified by <literal>--ssh-user=<emphasis>USER</emphasis></literal>. You must upload the public SSH key to the ISO domain server before uploading an ISO file. One way to do this is to use the <literal>ssh-copy-id -i ~/.ssh/<emphasis>mykey</emphasis> <emphasis>user@host</emphasis></literal> command.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Specifying_an_NFS_Server">
<title>Specifying an NFS Server</title>
<example>
<title>Uploading to an NFS Server</title>
<screen># <literal>engine-iso-uploader --nfs-server=<emphasis>storage.demo.redhat.com:/iso/path</emphasis> upload <emphasis>RHEL6.0.iso</emphasis></literal></screen>
</example>
</section>
<section xml:id="Basic_ISO_Uploader_Usage">
<title>Basic ISO Uploader Usage</title>
<simpara>The example below demonstrates the ISO uploader and the list parameter. The first command lists the available ISO storage domains; the <literal>admin@internal</literal> user is used because no user was specified in the command. The second command uploads an ISO file over NFS to the specified ISO domain.</simpara>
<example>
<title>List Domains and Upload Image</title>
<screen># <literal>engine-iso-uploader list</literal>
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
ISO Storage Domain Name   | Datacenter          | ISO Domain Status
ISODomain                 | Default             | active</screen>
<screen># <literal>engine-iso-uploader --iso-domain=<emphasis>[ISODomain]</emphasis> upload <emphasis>[RHEL6.iso]</emphasis></literal>
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):</screen>
</example>
</section>
<section xml:id="Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain">
<title>Uploading the VirtIO and guest tool image files to a storage domain</title>
<note>
<simpara>The ISO domain is a deprecated storage domain type. The ISO Uploader tool has been removed in oVirt 4.4. oVirt recommends uploading ISO images to the data domain with the Administration Portal or with the REST API. See <xref linkend="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks"/> for details.</simpara>
</note>
<simpara>The <literal>virtio-win<emphasis>_version</emphasis>.iso</literal> image contains the following for Windows virtual machines to improve performance and usability:</simpara>
<itemizedlist>
<listitem>
<simpara>VirtIO drivers</simpara>
</listitem>
<listitem>
<simpara>an installer for the guest agents</simpara>
</listitem>
<listitem>
<simpara>an installer for the drivers</simpara>
</listitem>
</itemizedlist>
<simpara>To install and upload the most recent version of <literal>virtio-win<emphasis>_version</emphasis>.iso</literal>:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install the image files on the Engine machine:</simpara>
<screen># dnf -y install virtio-win</screen>
<simpara>After you install it on the Engine machine, the image file is <literal role="filename">/usr/share/virtio-win/virtio-win<emphasis>_version</emphasis>.iso</literal></simpara>
</listitem>
<listitem>
<simpara>Upload the image file to a data storage domain that was not created locally during installation. For more information, see <link xl:href="https://ovirt.org/documentation/administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</link> in the <emphasis>Administration Guide</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Attach the image file to virtual machines.</simpara>
</listitem>
</orderedlist>
<simpara>The virtual machines can now use the virtio drivers and agents.</simpara>
<simpara>For information on attaching the image files to a virtual machine, see <link xl:href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Windows">Installing the Guest Agents, Tools, and Drivers on Windows</link> in the <emphasis>Virtual Machine Management Guide</emphasis>.</simpara>
</section>
</section>
<section xml:id="sect-The_Engine_Vacuum_Tool">
<title>The Engine Vacuum Tool</title>
<section xml:id="The_Engine_Vacuum_Tool">
<title>The Engine Vacuum Tool</title>
<simpara>The Engine Vacuum tool maintains PostgreSQL databases by updating tables and removing dead rows, allowing disk space to be reused. See the <link xl:href="https://www.postgresql.org/docs/10/sql-vacuum.html">PostgreSQL documentation</link> for information about the <literal>VACUUM</literal> command and its parameters.</simpara>
<simpara>The Engine Vacuum command is <literal>engine-vacuum</literal>. You must log in as the <emphasis role="strong">root</emphasis> user and provide the administration credentials for the oVirt environment.</simpara>
<simpara>Alternatively, the Engine Vacuum tool can be run while using the <literal>engine-setup</literal> command to customize an existing installation:</simpara>
<screen>$ engine-setup
...
[ INFO  ] Stage: Environment customization
...
Perform full vacuum on the engine database engine@localhost?
This operation may take a while depending on this setup health and the
configuration of the db vacuum process.
See https://www.postgresql.org/docs/12/static/sql-vacuum.html
(Yes, No) [No]:</screen>
<simpara>The <emphasis role="strong">Yes</emphasis> option runs the Engine Vacuum tool in full vacuum verbose mode.</simpara>
</section>
<section xml:id="Engine_Vacuum_Modes">
<title>Engine Vacuum Modes</title>
<simpara>Engine Vacuum has two modes:</simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong">Standard Vacuum</emphasis></term>
<listitem>
<simpara>Frequent standard vacuuming is recommended.</simpara>
<simpara>Standard vacuum removes dead row versions in tables and indexes and marks the space as available for future reuse. Frequently updated tables should be vacuumed on a regular basis. However, standard vacuum does not return the space to the operating system.</simpara>
<simpara>Standard vacuum, with no parameters, processes every table in the current database.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong">Full Vacuum</emphasis></term>
<listitem>
<simpara>Full vacuum is not recommended for routine use, but should only be run when a significant amount of space needs to be reclaimed from within the table.</simpara>
<simpara>Full vacuum compacts the tables by writing a new copy of the table file with no dead space, thereby enabling the operating system to reclaim the space. Full vacuum can take a long time.</simpara>
<simpara>Full vacuum requires extra disk space for the new copy of the table, until the operation completes and the old copy is deleted. Because full vacuum requires an exclusive lock on the table, it cannot be run in parallel with other uses of the table.</simpara>
</listitem>
</varlistentry>
</variablelist>
</section>
<section xml:id="Syntax_for_the_engine-vacuum_Command">
<title>Syntax for the engine-vacuum Command</title>
<simpara>The basic syntax for the <literal>engine-vacuum</literal> command is:</simpara>
<screen># engine-vacuum</screen>
<screen># engine-vacuum <emphasis>option</emphasis></screen>
<simpara>Running the <literal>engine-vacuum</literal> command with no options performs a standard vacuum.</simpara>
<simpara>There are several parameters to further refine the <literal>engine-vacuum</literal> command.</simpara>
<simpara><emphasis role="strong">General Options</emphasis></simpara>
<variablelist>
<varlistentry>
<term><emphasis role="strong"><literal>-h</literal> <literal>--help</literal></emphasis></term>
<listitem>
<simpara>Displays information on how to use the <literal>engine-vacuum</literal> command.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-a</literal></emphasis></term>
<listitem>
<simpara>Runs a standard vacuum, analyzes the database, and updates the optimizer statistics.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-A</literal></emphasis></term>
<listitem>
<simpara>Analyzes the database and updates the optimizer statistics, without vacuuming.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-f</literal></emphasis></term>
<listitem>
<simpara>Runs a full vacuum.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-v</literal></emphasis></term>
<listitem>
<simpara>Runs in verbose mode, providing more console output.</simpara>
</listitem>
</varlistentry>
<varlistentry>
<term><emphasis role="strong"><literal>-t <emphasis>table_name</emphasis></literal></emphasis></term>
<listitem>
<simpara>Vacuums a specific table or tables.</simpara>
<screen># engine-vacuum -f -v -t vm_dynamic -t vds_dynamic</screen>
</listitem>
</varlistentry>
</variablelist>
</section>
</section>
<section xml:id="sect-The_VDSM_To_Network_Name_Tool">
<title>The VDSM to Network Name Mapping Tool</title>
<section xml:id="Vdsm_To_Network_Mapping_Tool">
<title>Mapping VDSM Names to Logical Network Names</title>
<simpara>If the name of a logical network is longer than 15 characters or contains non-ASCII characters, the system automatically generates an on-host identifier (<emphasis>vdsm_name</emphasis>) name; it comprises the letters <emphasis>on</emphasis> and the first 13 characters of the network&#8217;s unique identifier, for example, <literal>ona1b2c3d4e5f6g</literal>. It is this name that appears in the host&#8217;s log files. To view a list of logical network names and their auto-generated network name, use the  VDSM-to-Network-Name Mapping tool located in <literal>/usr/share/ovirt-engine/bin/</literal>.</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>The first time you run the tool, define a PASSWORD environment variable, which is the password of a database user with read access to the Engine database.
For example, run:</simpara>
<screen># export PASSWORD=<emphasis>DatabaseUserPassword</emphasis></screen>
</listitem>
<listitem>
<simpara>Run the VDSM-to-Network-Name Mapping tool:</simpara>
<screen># vdsm_to_network_name_map  --user USER</screen>
<simpara>where <emphasis>USER</emphasis> is the database user with read access to the Engine database, whose password is assigned to the PASSWORD environment variable.</simpara>
</listitem>
</orderedlist>
<simpara>The tool displays a list of logical network names that are mapped to their equivalent on-host identifiers.</simpara>
<formalpara>
<title>Additional Flags</title>
<para>You can run the tool with the following flags:</para>
</formalpara>
<simpara><literal>--host</literal> is the hostname/IP address of the database server. The default value is <literal>localhost</literal>.</simpara>
<simpara><literal>--port</literal> is the port number of the database server. The default value is <literal>5432</literal>.
<literal>--database</literal> is the name of the database. The default value is <literal>engine</literal>, which is the Engine database.</simpara>
<simpara><literal>--secure</literal> enables a secure connection with the database. By default the tool is run without a secure connection.</simpara>
</section>
</section>
</chapter>
</part>
<part xml:id="part-Gathering_Information_About_the_Environment">
<title>Gathering Information About the Environment</title>
<chapter xml:id="monitoring_and_observability">
<title>Monitoring and observability</title>
<simpara>This chapter provides a number of ways to monitor and obtain metrics and logs from your oVirt system. These methods include:</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Using Data Warehouse and Grafana to monitor oVirt</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Sending metrics to a remote instance of Elasticsearch</emphasis></simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Deploying Insights in Red Hat Virtualization Manager</emphasis></simpara>
</listitem>
</itemizedlist>
<section xml:id="_using_data_warehouse_and_grafana_to_monitor_ovirt">
<title>Using Data Warehouse and Grafana to monitor oVirt</title>
<section xml:id="_grafana">
<title>Grafana</title>
<simpara xml:id="Grafana_overview">Grafana is a web-based UI tool used to display reports based on data collected from the oVirt Data Warehouse PostgreSQL database under the database name <literal>ovirt_engine_history</literal>. See <link xl:href="https://grafana.com/grafana/dashboards">Grafana dashboards</link>.</simpara>
<simpara>Data from the Engine is aggregated in hourly and daily aggregations. The data is retained according to the scale setting defined in the Data Warehouse configuration during engine-setup (Basic or Full scale):</simpara>
<itemizedlist>
<listitem>
<simpara><emphasis role="strong">Basic</emphasis> (default) - sampled every 24 hours, hourly data saved for 1 month, daily data - no daily aggregations saved.</simpara>
</listitem>
<listitem>
<simpara><emphasis role="strong">Full</emphasis> (recommended)- sampled every 24 hours, hourly data saved for 2 months, daily aggregations saved for 5 years.</simpara>
</listitem>
</itemizedlist>
<simpara>Full sample scaling may require migrating the Data Warehouse to a separate virtual machine.</simpara>
<itemizedlist>
<listitem>
<simpara>For Data Warehouse scaling instructions, see <link xl:href="https://ovirt.org/documentation/data_warehouse_guide/index#Changing_the_Data_Warehouse_Sampling_Scale">Changing the Data Warehouse Sampling Scale</link>.</simpara>
</listitem>
<listitem>
<simpara>For instructions on migrating the Data Warehouse to or installing on a separate machine,
see <link xl:href="https://ovirt.org/documentation/data_warehouse_guide/index#Migrating_Data_Warehouse_to_a_Separate_Machine_DWH_admin">Migrating Data Warehouse to a Separate Machine</link>
and <link xl:href="https://ovirt.org/documentation/data_warehouse_guide/index#Installing_and_Configuring_Data_Warehouse_on_a_Separate_Machine_DWH_admin">Installing and Configuring Data Warehouse on a Separate Machine</link>.</simpara>
</listitem>
</itemizedlist>
<note>
<simpara>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</simpara>
</note>
</section>
<section xml:id="_configuring_grafana">
<title>Configuring Grafana</title>
<formalpara xml:id="Configure_grafana">
<title>Installation</title>
<para>Grafana integration is enabled and installed by default when running oVirt Engine <literal>engine-setup</literal> for Stand Alone Manager installations. For Self-Hosted engine installations, you must enable Grafana integration manually when running <literal>engine-setup</literal>.</para>
</formalpara>
<simpara>To enable Grafana integration in the Self-Hosted engine:</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Put the environment in global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
</listitem>
<listitem>
<simpara>Log in to the machine where you want to install Grafana.</simpara>
</listitem>
<listitem>
<simpara>Run the <literal>engine-setup</literal> command as follows:</simpara>
<screen># engine-setup --reconfigure-optional-components</screen>
</listitem>
<listitem>
<simpara>Answer <literal>Yes</literal> to install Grafana on this machine:</simpara>
<screen>Configure Grafana on this host (Yes, No) [Yes]:</screen>
</listitem>
<listitem>
<simpara>Disable global maintenance mode:</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
</listitem>
</orderedlist>
<simpara>To access the Grafana dashboards:</simpara>
<itemizedlist>
<listitem>
<simpara>Go to <literal>https://&lt;engine FQDN or IP address&gt;/ovirt-engine-grafana</literal></simpara>
</listitem>
</itemizedlist>
<simpara>or</simpara>
<itemizedlist>
<listitem>
<simpara>Click <emphasis role="strong">Monitoring Portal</emphasis> in the web administration welcome page for the <emphasis role="strong">Administration Portal</emphasis>.</simpara>
</listitem>
</itemizedlist>
<formalpara xml:id="Configure_grafana_SSO">
<title>Configuring Grafana for Single Sign-on</title>
<para>The Engine engine-setup automatically configures Grafana to allow existing users on the Engine to log in with SSO from the Administration Portal, but does not automatically create users. You need to create new users (<literal>Invite</literal> in the Grafana UI), confirm the new user, and then they can log in.</para>
</formalpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Set an email address for the user in the Engine, if it is not already defined.</simpara>
</listitem>
<listitem>
<simpara>Log in to Grafana with an existing admin user (the initially configured admin).</simpara>
</listitem>
<listitem>
<simpara>Go to <menuchoice><guimenu>Configuration</guimenu> <guimenuitem>Users</guimenuitem></menuchoice> and select <guibutton>Invite</guibutton>.</simpara>
</listitem>
<listitem>
<simpara>Input the email address and name, and select a Role.</simpara>
</listitem>
<listitem>
<simpara>Send the invitation using one of these options:</simpara>
<itemizedlist>
<listitem>
<simpara>Select <guibutton>Send invite mail</guibutton> and click <guibutton>Submit</guibutton>. For this option, you need an operational local mail server configured on the Grafana machine.</simpara>
<simpara>or</simpara>
</listitem>
<listitem>
<simpara>Select <guibutton>Pending Invites</guibutton></simpara>
<itemizedlist>
<listitem>
<simpara>Locate the entry you want</simpara>
</listitem>
<listitem>
<simpara>Select <guibutton>Copy invite</guibutton></simpara>
</listitem>
<listitem>
<simpara>Copy and use this link to create the account by pasting it directly into a browser address bar, or by sending it to another user.</simpara>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>If you use the Pending Invites option, no email is sent, and the email address does not really need to exist - any valid looking address will work, as long as it’s configured as the email address of a Engine user.</simpara>
<orderedlist numeration="arabic">
<title>To log in with this account:</title>
<listitem>
<simpara>Log in to the oVirt web administration welcome page using the account that has this email address.</simpara>
</listitem>
<listitem>
<simpara>Select <literal>Monitoring Portal</literal> to open the Grafana dashboard.</simpara>
</listitem>
<listitem>
<simpara>Select <guibutton>Sign in with oVirt Engine Auth</guibutton>.</simpara>
</listitem>
</orderedlist>
</section>
<section xml:id="_grafana_dashboards">
<title>Grafana dashboards</title>
<formalpara xml:id="Grafana_dashboards">
<title>Built-in Grafana dashboards</title>
<para>The following dashboards are available in the initial Grafana setup to report Data Center, Cluster, Host, and Virtual Machine data:</para>
</formalpara>
<table frame="all" rowsep="1" colsep="1">
<title>Built-in Grafana dashboards</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Dashboard type</entry>
<entry align="left" valign="top">Content</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Executive dashboards</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Cluster dashboard - resource usage, peaks, over-commit, and up-time for hosts and virtual machines in a selected cluster, according to the latest configurations.</simpara>
</listitem>
<listitem>
<simpara>Data Center dashboard - resource usage, peaks, and up-time for clusters, hosts, and storage domains in a selected data center, according to the latest configurations.</simpara>
</listitem>
<listitem>
<simpara>Executive dashboard - user resource usage and number of operating systems for hosts and virtual machines in selected clusters over a selected period.</simpara>
</listitem>
<listitem>
<simpara>Host dashboard - latest and historical configuration details and resource usage metrics of a selected host over a selected period.</simpara>
</listitem>
<listitem>
<simpara>System dashboard - resource usage and up-time for hosts and storage domains in the system, according to in the latest configurations.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machine dashboard - latest and historical configuration details and resource usage metrics of a selected virtual machine over a selected period.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Trend dashboards</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Hosts Resource Usage dashboard - daily and hourly resource usage (number of virtual machines, CPU, memory, network Tx/Rx) for selected hosts in a selected period.</simpara>
</listitem>
<listitem>
<simpara>Hosts Trend dashboard - resource usage (number of virtual machines, CPU, memory, and network Tx/Rx) for selected hosts over a selected period.</simpara>
</listitem>
<listitem>
<simpara>Trend dashboard - usage rates for the 5 most and least utilized virtual machines and hosts by memory and by CPU in selected clusters over a selected period.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machines Resource Usage dashboard - daily and hourly resource usage (CPU, memory, network Tx/Rx, disk I/O) for selected virtual machines in a selected period.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machines Trend dashboard -resource usage (CPU, memory, network Tx/Rx, disk I/O) for selected virtual machines over a selected period.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Service Level dashboards</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Cluster Quality of Service</simpara>
<itemizedlist>
<listitem>
<simpara>Hosts dashboard - the time selected hosts have performed above and below the CPU and memory threshold in a selected period.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machines dashboard - the time selected virtual machines have performed above and below the CPU and memory threshold in a selected period.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>Hosts Uptime dashboard - the uptime, planned downtime, and unplanned downtime for selected hosts in a selected period.</simpara>
</listitem>
<listitem>
<simpara>Uptime dashboard - planned downtime, unplanned downtime, and total time for the hosts, high availability virtual machines, and all virtual machines in selected clusters in a selected period.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machines Uptime dashboard - the uptime, planned downtime, and unplanned downtime for selected virtual machines in a selected period.</simpara>
</listitem>
</itemizedlist></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">Inventory dashboards</emphasis></simpara></entry>
<entry align="left" valign="top"><itemizedlist>
<listitem>
<simpara>Hosts Inventory dashboard - FQDN, VDSM version, operating system, CPU model, CPU cores, memory size, create date, delete date, and hardware details for selected hosts, according to the latest configurations.</simpara>
</listitem>
<listitem>
<simpara>Inventory dashboard - number of hosts, virtual machines, and running virtual machines, resources usage and over-commit rates for selected data centers, according to the latest configurations.</simpara>
</listitem>
<listitem>
<simpara>Storage Domains Inventory dashboard - domain type, storage type, available disk size, used disk size, total disk size, creation date, and delete date for selected storage domains over a selected period.</simpara>
</listitem>
<listitem>
<simpara>Virtual Machines Inventory dashboard - template name, operating system, CPU cores, memory size, create date, and delete date for selected virtual machines, according to the latest configurations.</simpara>
</listitem>
</itemizedlist></entry>
</row>
</tbody>
</tgroup>
</table>
<formalpara>
<title>Customized Grafana dashboards</title>
<para>You can create customized dashboards or copy and modify existing dashboards according to your reporting needs.</para>
</formalpara>
<note>
<simpara>Built-in dashboards cannot be customized.</simpara>
</note>
</section>
</section>
<section xml:id="_sending_metrics_to_a_remote_instance_of_elasticsearch">
<title>Sending metrics to a remote instance of Elasticsearch</title>
<note xml:id="Sending_metrics_to_ELK">
<simpara>Red Hat does not own or maintain Elasticsearch. You need to have a working familiarity with Elasticsearch setup and maintenance to deploy this option.</simpara>
</note>
<simpara>You can configure the oVirt Engine and hosts to send metrics data to your existing Elasticsearch instance.</simpara>
<simpara>To do this, run the Ansible role that configures <literal>collectd</literal> and <literal>rsyslog</literal> on the Engine and all hosts to collect <literal>engine.log</literal>, <literal>vdsm.log</literal> and collectd metrics, and send them to your Elasticsearch instance.</simpara>
<section xml:id="_installing_collectd_and_rsyslog">
<title>Installing collectd and rsyslog</title>
<simpara xml:id="Install_collectd_and_rsyslog">Deploy <literal>collectd</literal> and <literal>rsyslog</literal> on the hosts to collect logs and metrics.</simpara>
<note>
<simpara>You do not need to repeat this procedure for new hosts. Every new host that is added is automatically configured by the Engine to send the data to Elasticsearch during host-deploy.</simpara>
</note>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Log in to the Engine machine using SSH.</simpara>
</listitem>
<listitem>
<simpara>Copy <literal>/etc/ovirt-engine-metrics/config.yml.example</literal> to create <literal>/etc/ovirt-engine-metrics/config.yml.d/config.yml</literal>:</simpara>
<screen># cp /etc/ovirt-engine-metrics/config.yml.example /etc/ovirt-engine-metrics/config.yml.d/config.yml</screen>
</listitem>
<listitem>
<simpara>Edit the <literal>ovirt_env_name</literal> and <literal>elasticsearch_host</literal> parameters in <literal>config.yml</literal> and save the file. These parameters are mandatory and are documented in the file. Add the following variables:</simpara>
<screen>use_omelasticsearch_cert: false
viaq_metrics_store: false
rsyslog_elasticsearch_usehttps_metrics: !!str off
rsyslog_elasticsearch_usehttps_logs: !!str off</screen>
</listitem>
<listitem>
<simpara>Deploy <literal>collectd</literal> and <literal>rsyslog</literal> on the hosts:</simpara>
<screen># /usr/share/ovirt-engine-metrics/setup/ansible/configure_ovirt_machines_for_metrics.sh</screen>
<simpara>The <literal>configure_ovirt_machines_for_metrics.sh</literal> script runs an Ansible role that includes <literal>linux-system-roles</literal> (see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/administration_and_configuration_tasks_using_system_roles_in_rhel/index">Administration and configuration tasks using System Roles in RHEL</link>) and uses it to deploy and configure <literal>rsyslog</literal> on the host. <literal>rsyslog</literal> collects metrics from <literal>collectd</literal> and sends them to Elasticsearch.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="_metrics_schema">
<title>Metrics schema</title>

</section>
</chapter>
<chapter xml:id="chap-Log_Files">
<title>Log Files</title>
<section xml:id="Manager_Installation_Log_Files">
<title>Engine Installation Log Files</title>
<table frame="all" rowsep="1" colsep="1">
<title>Installation</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Log File</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/engine-cleanup<emphasis>_yyyy_mm_dd_hh_mm_ss</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log from the <literal>engine-cleanup</literal> command. This is the command used to reset a oVirt Engine installation. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/engine-db-install-<emphasis>yyyy_mm_dd_hh_mm_ss</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log from the <literal>engine-setup</literal> command detailing the creation and configuration of the <emphasis role="strong">engine</emphasis> database.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/ovirt-engine-dwh-setup-<emphasis>yyyy_mm_dd_hh_mm_ss</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log from the <literal>ovirt-engine-dwh-setup</literal> command. This is the command used to create the <emphasis role="strong">ovirt_engine_history</emphasis> database for reporting. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist concurrently.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/setup/ovirt-engine-setup-<emphasis>yyyymmddhhmmss</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log from the <literal>engine-setup</literal> command. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist concurrently.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Manager_Log_Files">
<title>oVirt Engine Log Files</title>
<table frame="all" rowsep="1" colsep="1">
<title>Service Activity</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Log File</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/engine.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Reflects all oVirt Engine GUI crashes, Active Directory lookups, Database issues, and other events.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovirt-engine/host-deploy</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log files from hosts deployed from the oVirt Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/lib/ovirt-engine/setup-history.txt</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Tracks the installation and upgrade of packages associated with the oVirt Engine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/httpd/ovirt-requests-log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Logs files from requests made to the oVirt Engine via HTTPS, including how long each request took.</simpara><simpara>A <literal>Correlation-Id</literal> header is included to allow you to compare requests when comparing a log file with <emphasis role="strong">/var/log/ovirt-engine/engine.log</emphasis>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/ovn-provider/ovirt-provider-ovn.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Logs the activities of the OVN provider.
For information about Open vSwitch logs, see the <link xl:href="http://openvswitch.org">Open vSwitch documentation</link>.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="sect-SPICE_Log_Files">
<title>SPICE Log Files</title>
<simpara>SPICE log files are useful when troubleshooting SPICE connection issues. To start SPICE debugging, change the log level to <literal>debugging</literal>. Then, identify the log location.</simpara>
<simpara>Both the clients used to access the guest machines and the guest machines themselves have SPICE log files. For client-side logs, if a SPICE client was launched using the native client, for which a <emphasis role="strong">console.vv</emphasis> file is downloaded, use the <literal>remote-viewer</literal> command to enable debugging and generate log output.</simpara>
<section xml:id="SPICE_Logs_for_Hypervisor_SPICE_Servers">
<title>SPICE Logs for Hypervisor SPICE Servers</title>
<table frame="all" rowsep="1" colsep="1">
<title>SPICE Logs for Hypervisor SPICE Servers</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Log Type</entry>
<entry align="left" valign="top">Log Location</entry>
<entry align="left" valign="top">To Change Log Level:</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Host/Hypervisor SPICE Server</simpara></entry>
<entry align="left" valign="top"><simpara>/var/log/libvirt/qemu/(guest_name).log</simpara></entry>
<entry align="left" valign="top"><simpara>Run <literal>export SPICE_DEBUG_LEVEL=5</literal> on the host/hypervisor prior to launching the guest. This variable is parsed by QEMU, and if run system-wide will print the debugging information of all virtual machines on the system. This command must be run on each host in the cluster. This command works only on a per-host/hypervisor basis, not a per-cluster basis.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="SPICE_Logs_for_Guest_Machines">
<title>SPICE Logs for Guest Machines</title>
<table frame="all" rowsep="1" colsep="1">
<title>spice-vdagent Logs for Guest Machines</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Log Type</entry>
<entry align="left" valign="top">Log Location</entry>
<entry align="left" valign="top">To Change Log Level:</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Windows Guest</simpara></entry>
<entry align="left" valign="top"><simpara>C:\Windows\Temp\vdagent.log</simpara><simpara>C:\Windows\Temp\vdservice.log</simpara></entry>
<entry align="left" valign="top"><simpara>Not applicable</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Enterprise Linux Guest</simpara></entry>
<entry align="left" valign="top"><simpara>Use <literal>journalctl</literal> as the root user.</simpara></entry>
<entry align="left" valign="top"><simpara>To run the <literal>spice-vdagentd</literal> service in debug mode, as the root user create a <emphasis role="strong">/etc/sysconfig/spice-vdagentd</emphasis> file with this entry: <literal>SPICE_VDAGENTD_EXTRA_ARGS=”-d -d”</literal></simpara>
<simpara>To run <literal>spice-vdagent</literal> in debug mode, from the command line:</simpara>
<screen>$ killall - u $USER spice-vdagent
$ spice-vdagent -x -d [-d] [ |&amp; tee spice-vdagent.log ]</screen></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="SPICE_Logs_for_SPICE_Clients_Launched_Using_consolevv_Files">
<title>SPICE Logs for SPICE Clients Launched Using console.vv Files</title>
<simpara><emphasis role="strong">For Linux client machines:</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Enable SPICE debugging by running the <literal>remote-viewer</literal> command with the <literal>--spice-debug</literal> option. When prompted, enter the connection URL, for example, spice://<emphasis>virtual_machine_IP</emphasis>:<emphasis>port</emphasis>.</simpara>
<screen>#  remote-viewer --spice-debug</screen>
</listitem>
<listitem>
<simpara>To run SPICE client with the debug parameter and to pass a .vv file to it, download the <emphasis role="strong">console.vv</emphasis> file and run the <literal>remote-viewer</literal> command with the <literal>--spice-debug</literal> option and specify the full path to the <emphasis role="strong">console.vv</emphasis> file.</simpara>
<screen># remote-viewer --spice-debug <emphasis>/path/to/</emphasis>console.vv</screen>
</listitem>
</orderedlist>
<simpara><emphasis role="strong">For Windows client machines:</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>In versions of <literal>virt-viewer</literal> 2.0-11.el7ev and later, <emphasis role="strong">virt-viewer.msi</emphasis> installs <literal>virt-viewer</literal> and <literal>debug-viewer.exe</literal>.</simpara>
</listitem>
<listitem>
<simpara>Run the <literal>remote-viewer</literal> command with the <literal>spice-debug</literal> argument and direct the command at the path to the console:</simpara>
<screen>remote-viewer --spice-debug <emphasis>path\to\</emphasis>console.vv</screen>
</listitem>
<listitem>
<simpara>To view logs, connect to the virtual machine, and you will see a command prompt running GDB that prints standard output and standard error of <literal>remote-viewer</literal>.</simpara>
</listitem>
</orderedlist>
</section>
</section>
<section xml:id="Host_Log_Files">
<title>Host Log Files</title>
<informaltable frame="all" rowsep="1" colsep="1">
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Log File</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/messages</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>The log file used by <literal>libvirt</literal>. Use <literal>journalctl</literal> to view the log. You must be a member of the <emphasis>adm</emphasis>,
<emphasis>systemd-journal</emphasis>, or <emphasis>wheel</emphasis> groups to view the log.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/spm-lock.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log file detailing the host&#8217;s ability to obtain a lease on the Storage Pool Manager role. The log details when the host has acquired, released, renewed, or failed to renew the lease.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/vdsm.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log file for VDSM, the Engine&#8217;s agent on the host(s).</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/tmp/ovirt-host-deploy-<emphasis>Date</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>A host deployment log that is copied to the Engine as <literal>/var/log/ovirt-engine/host-deploy/ovirt-<emphasis>Date-Host-Correlation_ID</emphasis></literal>.log after the host has been successfully deployed.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/import/import-<emphasis>UUID-Date</emphasis>.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Log file detailing virtual machine imports from a KVM host, a VMWare provider, or a RHEL 5 Xen host, including import failure information. <emphasis>UUID</emphasis> is the UUID of the virtual machine that was imported and <emphasis>Date</emphasis> is the date and time that the import began.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/supervdsm.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Logs VDSM tasks that were executed with superuser permissions.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/upgrade.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>VDSM uses this log file during host upgrades to log configuration changes.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><emphasis role="strong">/var/log/vdsm/mom.log</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara>Logs the activities of the VDSM&#8217;s memory overcommitment manager.</simpara></entry>
</row>
</tbody>
</tgroup>
</informaltable>
</section>
<section xml:id="proc-setting_up_debug_level_logging">
<title>Setting debug-level logging for oVirt services</title>
<simpara>You can set the logs of the following oVirt (oVirt) services to debug-level by modifying the <literal>sysconfig</literal> file of each service.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>oVirt services and <literal>sysconfig</literal> file paths</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Service</entry>
<entry align="left" valign="top">File path</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-engine.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-engine</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-engine-dwhd.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-engine-dwhd</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-fence-kdump-listener.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-fence-kdump-listener</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-websocket-proxy.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-websocket-proxy</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
<simpara>This modification affects logging done by the Python wrapper, not the main service process.</simpara>
<simpara>Setting logging to debug-level is useful for debugging issues related to start up - for example, if the main process fails to start due to a missing or incorrect Java runtime or library.</simpara>
<itemizedlist>
<title>Prerequisites</title>
<listitem>
<simpara>Verify that the <literal>sysconfig</literal> file you want to modify exists. If necessary, create it.</simpara>
</listitem>
</itemizedlist>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Add the following to the <literal>sysconfig</literal> file of the service:</simpara>
<programlisting language="terminal" linenumbering="unnumbered">OVIRT_SERVICE_DEBUG=1</programlisting>
</listitem>
<listitem>
<simpara>Restart the service:</simpara>
<programlisting language="terminal" linenumbering="unnumbered"># systemctl restart &lt;service&gt;</programlisting>
</listitem>
</orderedlist>
<simpara>The <literal>sysconfig</literal> log file of the service is now set to debug-level.</simpara>
<simpara>Logging caused by this setting goes to the system log, so the logs it generates can be found in <literal>/var/log/messages</literal>, not in the service-specific log file, or by using the <literal>journalctl</literal> command.</simpara>
</section>
<section xml:id="ref_debug_level_logging">
<title>Main configuration files for oVirt services</title>
<simpara>In addition to a <literal>sysconfig</literal> file, each of these oVirt (oVirt) services has another configuration file that is used more often.</simpara>
<table frame="all" rowsep="1" colsep="1">
<title>oVirt services and configuration files</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Service</entry>
<entry align="left" valign="top">sysconfig file path</entry>
<entry align="left" valign="top">Main configuration file</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-engine.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-engine</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/ovirt-engine/engine.conf.d/*.conf</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-engine-dwhd.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-engine-dwhd</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/*.conf</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-fence-kdump-listener.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-fence-kdump-listener</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/ovirt-engine/ovirt-fence-kdump-listener.conf.d/*.conf</literal></simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>ovirt-websocket-proxy.service</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/sysconfig/ovirt-websocket-proxy</literal></simpara></entry>
<entry align="left" valign="top"><simpara><literal>/etc/ovirt-engine/ovirt-websocket-proxy.conf.d/*.conf</literal></simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Setting_up_a_Host_Logging_Server">
<title>Setting Up a Host Logging Server</title>
<simpara>Hosts generate and update log files, recording their actions and problems. Collecting these log files centrally simplifies debugging.</simpara>
<simpara>This procedure should be used on your centralized log server. You could use a separate logging server, or use this procedure to enable host logging on the oVirt Engine.</simpara>
<simpara><emphasis role="strong">Setting up a Host Logging Server</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Check to see if the firewall allows traffic on the <literal>UDP 514</literal> port, and is open to <literal>syslog</literal> service traffic:</simpara>
<screen># firewall-cmd --query-service=syslog</screen>
<simpara>If the output is <literal>no</literal>, allow traffic on the <literal>UDP 514</literal> port with:</simpara>
<screen># firewall-cmd --add-service=syslog --permanent
# firewall-cmd --reload</screen>
</listitem>
<listitem>
<simpara>Create a new <literal>.conf</literal> file on the syslog server, for example, <literal>/etc/rsyslog.d/from_remote.conf</literal>, and add the following lines:</simpara>
<screen>template(name="DynFile" type="string" string="/var/log/%HOSTNAME%/%PROGRAMNAME%.log")
RuleSet(name="RemoteMachine"){  action(type="omfile" dynaFile="DynFile")  }
Module(load="imudp")
Input(type="imudp" port="514" ruleset="RemoteMachine")</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>rsyslog</literal> service:</simpara>
<screen># systemctl restart rsyslog.service</screen>
</listitem>
<listitem>
<simpara>Log in to the hypervisor, and in the <literal>/etc/rsyslog.conf</literal> add the following line:</simpara>
<screen>*.info;mail.none;authpriv.none;cron.none @&lt;syslog-FQDN&gt;:514</screen>
</listitem>
<listitem>
<simpara>Restart the rsyslog service on the hypervisor.</simpara>
<screen># systemctl restart rsyslog.service</screen>
</listitem>
</orderedlist>
<simpara>Your centralized log server is now configured to receive and store the <emphasis role="strong">messages</emphasis> and <emphasis role="strong">secure</emphasis> logs from your virtualization hosts.</simpara>
</section>
<section xml:id="Enabling_the_oVirt_Engine_Extension_Logger_log4j">
<title>Enabling the oVirt Engine Extension Logger log4j</title>
<simpara>Logger implementation requires the ovirt-engine-extension-logger-log4j package. With the implementation, Red Had Virtualization Engine delegates records into log4j. Log4j is a customizable framework that provides appenders for various technologies, including SNMP and syslog.</simpara>
<simpara>The oVirt Engine Extension Logger log4j passes the <literal>engine.log</literal> files to an existing syslog server. The configuration procedure overlaps with <link xl:href="https://ovirt.org/documentation/administration_guide/index#Setting_up_a_Host_Logging_Server">Setting up a Host Logging Server</link>.</simpara>
<simpara>Use this procedure on the central syslog server. You can use a separate logging server, or use this procedure to pass the <literal>engine.log</literal> files from the Engine to the syslog server.</simpara>
<note>
<simpara>To define the syslog server for this extension, navigate to the <emphasis role="strong">/etc/ovirt-engine/extensions.d</emphasis> directory and edit the value for <literal>log4j.appender.myappender.SyslogHost</literal> in the <literal>Log4jLogger.properties</literal> file.</simpara>
<simpara>To define the syslog facility, navigate to the <emphasis role="strong">/etc/ovirt-engine/extensions.d</emphasis> directory and edit the value for <literal>log4j.appender.myappender.Facility</literal> in the <literal>Log4jLogger.properties</literal> file. For example, <literal>log4j.appender.myappender.Facility=local1</literal>.</simpara>
</note>
<simpara><emphasis role="strong">Configuring the oVirt Engine Extension Logger log4j</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Install the extension.</simpara>
<screen># dnf install ovirt-engine-extension-logger-log4j</screen>
</listitem>
<listitem>
<simpara>Create the <literal>Log4jLogger.properties</literal> file in the <emphasis role="strong">/etc/ovirt-engine/extensions.d/</emphasis> directory and include the following contents.</simpara>
<screen>ovirt.engine.extension.name = log4jlogger
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.logger.Logger
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.logger.log4j
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.logger.log4j.Log4jLogger
log4j.rootLogger=DEBUG, myappender
log4j.appender.myappender=org.apache.log4j.net.SyslogAppender
log4j.appender.myappender.SyslogHost=localhost
log4j.appender.myappender.layout=org.apache.log4j.PatternLayout
log4j.appender.myappender.layout.ConversionPattern=[%c] %m%n</screen>
</listitem>
<listitem>
<simpara>Install and configure rsyslog.</simpara>
<screen># dnf install rsyslog</screen>
</listitem>
<listitem>
<simpara>Configure SELinux to allow <literal>rsyslog</literal> traffic.</simpara>
<screen># semanage port -a -t syslogd_port_t -p udp 514</screen>
</listitem>
<listitem>
<simpara>Edit <emphasis role="strong">/etc/rsyslog.conf</emphasis> and add the following lines:</simpara>
<screen>$template TmplAuth, "/var/log/%fromhost%/secure"
$template TmplMsg, "/var/log/%fromhost%/messages"

$RuleSet remote
authpriv.*   ?TmplAuth
*.info,mail.none;authpriv.none,cron.none   ?TmplMsg
$RuleSet RSYSLOG_DefaultRuleset
$InputUDPServerBindRuleset remote</screen>
</listitem>
<listitem>
<simpara>Uncomment the following two lines.</simpara>
<screen>#$ModLoad imudp
#$UDPServerRun 514</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>rsyslog</literal> service:</simpara>
<screen># systemctl restart rsyslog.service</screen>
</listitem>
<listitem>
<simpara>If the firewall is enabled and active, run the following command to add the necessary rules for opening the rsyslog ports in Firewalld.</simpara>
<screen># firewall-cmd --permanent --add-port=514/udp
# firewall-cmd --reload</screen>
</listitem>
<listitem>
<simpara>Restart oVirt Engine.</simpara>
<screen># systemctl restart ovirt-engine</screen>
</listitem>
</orderedlist>
<simpara>The existing syslog server can now receive and store the <literal>engine.log</literal> files.</simpara>
</section>
</chapter>
<appendix xml:id="appe-VDSM_and_Hooks">
<title>VDSM and Hooks</title>
<section xml:id="VDSM">
<title>VDSM</title>
<simpara>The VDSM service is used by the oVirt Engine to manage oVirt Nodes (oVirt Node) and Enterprise Linux hosts. VDSM manages and monitors the host&#8217;s storage, memory and network resources. It also co-ordinates virtual machine creation, statistics gathering, log collection and other host administration tasks. VDSM is run as a daemon on each host managed by oVirt Engine. It answers XML-RPC calls from clients. The oVirt Engine functions as a VDSM client.</simpara>
</section>
<section xml:id="VDSM_hooks">
<title>VDSM Hooks</title>
<simpara>VDSM is extensible via hooks. Hooks are scripts executed on the host when key events occur. When a supported event occurs VDSM runs any executable hook scripts in <emphasis role="strong">/usr/libexec/vdsm/hooks/<emphasis>nn_event-name</emphasis>/</emphasis> on the host in alphanumeric order. By convention each hook script is assigned a two digit number, included at the front of the file name, to ensure that the order in which the scripts will be run in is clear. You are able to create hook scripts in any programming language, Python will however be used for the examples contained in this chapter.</simpara>
<simpara>Note that all scripts defined on the host for the event are executed. If you require that a given hook is only executed for a subset of the virtual machines which run on the host then you must ensure that the hook script itself handles this requirement by evaluating the <emphasis role="strong">Custom Properties</emphasis> associated with the virtual machine.</simpara>
<warning>
<simpara>VDSM hooks can interfere with the operation of oVirt. A bug in a VDSM hook has the potential to cause virtual machine crashes and loss of data. VDSM hooks should be implemented with caution and tested rigorously. The Hooks API is new and subject to significant change in the future.</simpara>
</warning>
</section>
<section xml:id="Extending_VDSM_with_hooks">
<title>Extending VDSM with Hooks</title>
<simpara>This chapter describes how to extend VDSM with event-driven hooks. Extending VDSM with hooks is an experimental technology, and this chapter is intended for experienced developers. By setting custom properties on virtual machines it is possible to pass additional parameters, specific to a given virtual machine, to the hook scripts.</simpara>
</section>
<section xml:id="Supported_VDSM_events">
<title>Supported VDSM Events</title>
<table xml:id="vdsm-hook-names" frame="all" rowsep="1" colsep="1">
<title>Supported VDSM Events</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Name</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>before_vm_start</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine starts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_start</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine starts.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_cont</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine continues.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_cont</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine continues.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_pause</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine pauses.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_pause</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine pauses.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_hibernate</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine hibernates.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_hibernate</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine hibernates.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_dehibernate</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine dehibernates.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_dehibernate</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine dehibernates.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_migrate_source</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine migration, run on the source host from which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_migrate_source</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine migration, run on the source host from which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vm_migrate_destination</simpara></entry>
<entry align="left" valign="top"><simpara>Before virtual machine migration, run on the destination host to which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_migrate_destination</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine migration, run on the destination host to which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vm_destroy</simpara></entry>
<entry align="left" valign="top"><simpara>After virtual machine destruction.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_vdsm_start</simpara></entry>
<entry align="left" valign="top"><simpara>Before VDSM is started on the host. <emphasis role="strong">before_vdsm_start</emphasis> hooks are executed as the user root, and do not inherit the environment of the VDSM process.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_vdsm_stop</simpara></entry>
<entry align="left" valign="top"><simpara>After VDSM is stopped on the host. <emphasis role="strong">after_vdsm_stop</emphasis> hooks are executed as the user root, and do not inherit the environment of the VDSM process.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_nic_hotplug</simpara></entry>
<entry align="left" valign="top"><simpara>Before the NIC is hot plugged into the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_nic_hotplug</simpara></entry>
<entry align="left" valign="top"><simpara>After the NIC is hot plugged into the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_nic_hotunplug</simpara></entry>
<entry align="left" valign="top"><simpara>Before the NIC is hot unplugged from the virtual machine</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_nic_hotunplug</simpara></entry>
<entry align="left" valign="top"><simpara>After the NIC is hot unplugged from the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_nic_hotplug_fail</simpara></entry>
<entry align="left" valign="top"><simpara>After hot plugging the NIC to the virtual machine fails.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_nic_hotunplug_fail</simpara></entry>
<entry align="left" valign="top"><simpara>After hot unplugging the NIC from the virtual machine fails.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_disk_hotplug</simpara></entry>
<entry align="left" valign="top"><simpara>Before the disk is hot plugged into the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_disk_hotplug</simpara></entry>
<entry align="left" valign="top"><simpara>After the disk is hot plugged into the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_disk_hotunplug</simpara></entry>
<entry align="left" valign="top"><simpara>Before the disk is hot unplugged from the virtual machine</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_disk_hotunplug</simpara></entry>
<entry align="left" valign="top"><simpara>After the disk is hot unplugged from the virtual machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_disk_hotplug_fail</simpara></entry>
<entry align="left" valign="top"><simpara>After hot plugging the disk to the virtual machine fails.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_disk_hotunplug_fail</simpara></entry>
<entry align="left" valign="top"><simpara>After hot unplugging the disk from the virtual machine fails.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_device_create</simpara></entry>
<entry align="left" valign="top"><simpara>Before creating a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_device_create</simpara></entry>
<entry align="left" valign="top"><simpara>After creating a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_update_device</simpara></entry>
<entry align="left" valign="top"><simpara>Before updating a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_update_device</simpara></entry>
<entry align="left" valign="top"><simpara>After updating a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_device_destroy</simpara></entry>
<entry align="left" valign="top"><simpara>Before destroying a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_device_destroy</simpara></entry>
<entry align="left" valign="top"><simpara>After destroying a device that supports custom properties.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_device_migrate_destination</simpara></entry>
<entry align="left" valign="top"><simpara>Before device migration, run on the destination host to which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_device_migrate_destination</simpara></entry>
<entry align="left" valign="top"><simpara>After device migration, run on the destination host to which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_device_migrate_source</simpara></entry>
<entry align="left" valign="top"><simpara>Before device migration, run on the source host from which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_device_migrate_source</simpara></entry>
<entry align="left" valign="top"><simpara>After device migration, run on the source host from which the migration is occurring.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>after_network_setup</simpara></entry>
<entry align="left" valign="top"><simpara>After setting up the network when starting a host machine.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>before_network_setup</simpara></entry>
<entry align="left" valign="top"><simpara>Before setting up the network when starting a host machine.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="VDSM_hooks_environment">
<title>The VDSM Hook Environment</title>
<simpara>Most hook scripts are run as the <emphasis role="strong">vdsm</emphasis> user and inherit the environment of the VDSM process. The exceptions are hook scripts triggered by the <emphasis role="strong">before_vdsm_start</emphasis> and <emphasis role="strong">after_vdsm_stop</emphasis> events. Hook scripts triggered by these events run as the <emphasis role="strong">root</emphasis> user and do not inherit the environment of the VDSM process.</simpara>
</section>
<section xml:id="VDSM_hooks_domain_xml">
<title>The VDSM Hook Domain XML Object</title>
<simpara>When hook scripts are started, the _hook_domxml variable is appended to the environment. This variable contains the path of the libvirt domain XML representation of the relevant virtual machine. Several hooks are an exception to this rule, as outlined below.
The _hook_domxml variable of the following hooks contains the XML representation of the NIC and not the virtual machine.</simpara>
<itemizedlist>
<listitem>
<simpara>*_nic_hotplug_*</simpara>
</listitem>
<listitem>
<simpara>*_nic_hotunplug_*</simpara>
</listitem>
<listitem>
<simpara>*_update_device</simpara>
</listitem>
<listitem>
<simpara>*_device_create</simpara>
</listitem>
<listitem>
<simpara>*_device_migrate_*</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>The <emphasis role="strong">before_migration_destination</emphasis> and <emphasis role="strong">before_dehibernation</emphasis> hooks currently receive the XML of the domain from the source host. The XML of the domain at the destination will have various differences.</simpara>
</important>
<simpara>The libvirt domain XML format is used by VDSM to define virtual machines. Details on the libvirt domain XML format can be found at <link xl:href="http://libvirt.org/formatdomain.html">http://libvirt.org/formatdomain.html</link>. The UUID of the virtual machine may be deduced from the domain XML, but it is also available as the environment variable vmId.</simpara>
</section>
<section xml:id="VDSM_hooks_defining_custom_properties">
<title>Defining Custom Properties</title>
<simpara>The custom properties that are accepted by the oVirt Engine - and in turn passed to custom hooks - are defined using the <literal>engine-config</literal> command. Run this command as the <emphasis role="strong">root</emphasis> user on the host where oVirt Engine is installed.</simpara>
<simpara>The <literal>UserDefinedVMProperties</literal> and <literal>CustomDeviceProperties</literal> configuration keys are used to store the names of the custom properties supported. Regular expressions defining the valid values for each named custom property are also contained in these configuration keys.</simpara>
<simpara>Multiple custom properties are separated by a semi-colon. Note that when setting the configuration key, any existing value it contained is overwritten. When combining new and existing custom properties, all of the custom properties in the command used to set the key&#8217;s value must be included.</simpara>
<simpara>Once the configuration key has been updated, the <emphasis role="strong">ovirt-engine</emphasis> service must be restarted for the new values to take effect.</simpara>
<example>
<title>Virtual Machine Properties - Defining the <literal>smartcard</literal> Custom Property</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Check the existing custom properties defined by the <literal>UserDefinedVMProperties</literal> configuration key using the following command:</simpara>
<screen># engine-config -g UserDefinedVMProperties</screen>
<simpara>As shown by the output below, the custom property <literal>memory</literal> is already defined. The regular expression <literal>^[0-9]+$</literal> ensures that the custom property will only ever contain numeric characters.</simpara>
<screen># engine-config -g UserDefinedVMProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : memory=^[0-9]+$ version: 4.4</screen>
</listitem>
<listitem>
<simpara>Because the <literal>memory</literal> custom property is already defined in the <literal>UserDefinedVMProperties</literal> configuration key, the new custom property must be appended to it. The additional custom property, <literal>smartcard</literal>, is added to the configuration key&#8217;s value. The new custom property is able to hold a value of <literal>true</literal> or <literal>false</literal>.</simpara>
<screen># engine-config -s UserDefinedVMProperties='memory=^[0-9]+$;smartcard=^(true|false)$' --cver=4.4</screen>
</listitem>
<listitem>
<simpara>Verify that the custom properties defined by the <literal>UserDefinedVMProperties</literal> configuration key have been updated correctly.</simpara>
<screen># engine-config -g UserDefinedVMProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : memory=^[0-9]+$;smartcard=^(true|false)$ version: 4.4</screen>
</listitem>
<listitem>
<simpara>Finally, the <emphasis role="strong">ovirt-engine</emphasis> service must be restarted for the configuration change to take effect.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
</example>
<example>
<title>Device Properties - Defining the <literal>interface</literal> Custom Property</title>
<orderedlist numeration="arabic">
<listitem>
<simpara>Check the existing custom properties defined by the <literal>CustomDeviceProperties</literal> configuration key using the following command:</simpara>
<screen># engine-config -g CustomDeviceProperties</screen>
<simpara>As shown by the output below, no custom properties have yet been defined.</simpara>
<screen># engine-config -g CustomDeviceProperties
CustomDeviceProperties:  version: 4.3
CustomDeviceProperties:  version: 4.4</screen>
</listitem>
<listitem>
<simpara>The <literal>interface</literal> custom property does not already exist, so it can be appended as is. In this example, the value of the <literal>speed</literal> sub-property is set to a range of 0 to 99999, and the value of the <literal>duplex</literal> sub-property is set to a selection of either <literal>full</literal> or <literal>half</literal>.</simpara>
<screen># engine-config -s CustomDeviceProperties="{type=interface;prop={speed=^([0-9]{1,5})$;duplex=^(full|half)$}}" --cver=4.4</screen>
</listitem>
<listitem>
<simpara>Verify that the custom properties defined by the <literal>CustomDeviceProperties</literal> configuration key have been updated correctly.</simpara>
<screen># engine-config -g CustomDeviceProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : {type=interface;prop={speed=^([0-9]{1,5})$;duplex=^(full|half)$}} version: 4.4</screen>
</listitem>
<listitem>
<simpara>Finally, the <emphasis role="strong">ovirt-engine</emphasis> service must be restarted for the configuration change to take effect.</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
</orderedlist>
</example>
</section>
<section xml:id="VDSM_hooks_setting_custom_properties">
<title>Setting Virtual Machine Custom Properties</title>
<simpara>Once custom properties are defined in the oVirt Engine, you can begin setting them on virtual machines. Custom properties are set on the <emphasis role="strong">Custom Properties</emphasis> tab of the <emphasis role="strong">New Virtual Machine</emphasis> and <emphasis role="strong">Edit Virtual Machine</emphasis> windows in the Administration Portal.</simpara>
<simpara>You can also set custom properties from the <emphasis role="strong">Run Virtual Machine(s)</emphasis> dialog box. Custom properties set from the <emphasis role="strong">Run Virtual Machine(s)</emphasis> dialog box will only apply to the virtual machine until it is next shutdown.</simpara>
<simpara>The <emphasis role="strong">Custom Properties</emphasis> tab provides a facility for you to select from the list of defined custom properties. Once you select a custom property key an additional field will display allowing you to enter a value for that key. Add additional key/value pairs by clicking the <emphasis role="strong">+</emphasis> button and remove them by clicking the <emphasis role="strong">-</emphasis> button.</simpara>
</section>
<section xml:id="VDSM_hooks_evaluating_custom_properties">
<title>Evaluating Virtual Machine Custom Properties in a VDSM Hook</title>
<simpara>Each key set in the <emphasis role="strong">Custom Properties</emphasis> field for a virtual machine is appended as an environment variable when calling hook scripts. Although the regular expressions used to validate the <emphasis role="strong">Custom Properties</emphasis> field provide some protection you should ensure that your scripts also validate that the inputs provided match their expectations.</simpara>
<example>
<title>Evaluating Custom Properties</title>
<simpara>This short Python example checks for the existence of the custom property <literal>key1</literal>. If the custom property is set then the value is printed to standard error. If the custom property is not set then no action is taken.</simpara>
<screen>#!/usr/bin/python

import os
import sys

if os.environ.has_key('key1'):
	sys.stderr.write('key1 value was : %s\n' % os.environ['key1'])
else:
    sys.exit(0)</screen>
</example>
</section>
<section xml:id="VDSM_hooks_hooking_module">
<title>Using the VDSM Hooking Module</title>
<simpara>VDSM ships with a Python hooking module, providing helper functions for VDSM hook scripts. This module is provided as an example, and is only relevant to VDSM hooks written in Python.</simpara>
<simpara>The hooking module supports reading of a virtual machine&#8217;s libvirt XML into a DOM object. Hook scripts can then use Python&#8217;s built in <emphasis role="strong">xml.dom</emphasis> library (<link xl:href="http://docs.python.org/release/2.6/library/xml.dom.html">http://docs.python.org/release/2.6/library/xml.dom.html</link>) to manipulate the object.</simpara>
<simpara>The modified object can then be saved back to libvirt XML using the hooking module. The hooking module provides the following functions to support hook development:</simpara>
<table xml:id="hooking-module-functions" frame="all" rowsep="1" colsep="1">
<title>Hooking module functions</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">Name</entry>
<entry align="left" valign="top">Argument</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara><literal>tobool</literal></simpara></entry>
<entry align="left" valign="top"><simpara>string</simpara></entry>
<entry align="left" valign="top"><simpara>Converts a string "true" or "false" to a Boolean value</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>read_domxml</literal></simpara></entry>
<entry align="left" valign="top"><simpara>-</simpara></entry>
<entry align="left" valign="top"><simpara>Reads the virtual machine&#8217;s libvirt XML into a DOM object</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara><literal>write_domxml</literal></simpara></entry>
<entry align="left" valign="top"><simpara>DOM object</simpara></entry>
<entry align="left" valign="top"><simpara>Writes the virtual machine&#8217;s libvirt XML from a DOM object</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="VDSM_hooks_execution">
<title>VDSM Hook Execution</title>
<simpara><emphasis role="strong">before_vm_start</emphasis> scripts can edit the domain XML in order to change VDSM&#8217;s definition of a virtual machine before it reaches libvirt. Caution must be exercised in doing so. Hook scripts have the potential to disrupt the operation of VDSM, and buggy scripts can result in outages to the oVirt environment. In particular, ensure you never change the UUID of the domain, and do not attempt to remove a device from the domain without sufficient background knowledge.</simpara>
<simpara>Both <emphasis role="strong">before_vdsm_start</emphasis> and <emphasis role="strong">after_vdsm_stop</emphasis> hook scripts are run as the <emphasis role="strong">root</emphasis> user. Other hook scripts that require <emphasis role="strong">root</emphasis> access to the system must be written to use the <literal>sudo</literal> command for privilege escalation. To support this the <emphasis role="strong">/etc/sudoers</emphasis> must be updated to allow the <emphasis role="strong">vdsm</emphasis> user to use <literal>sudo</literal> without reentering a password. This is required as hook scripts are executed non-interactively.</simpara>
<example>
<title>Configuring <literal>sudo</literal> for VDSM Hooks</title>
<simpara>In this example the <literal>sudo</literal> command will be configured to allow the <emphasis role="strong">vdsm</emphasis> user to run the <literal>/bin/chown</literal> command as <emphasis role="strong">root</emphasis>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Log into the virtualization host as <emphasis role="strong">root</emphasis>.</simpara>
</listitem>
<listitem>
<simpara>Open the <emphasis role="strong">/etc/sudoers</emphasis> file in a text editor.</simpara>
</listitem>
<listitem>
<simpara>Add this line to the file:</simpara>
<screen>vdsm ALL=(ALL) NOPASSWD: /bin/chown</screen>
<simpara>This specifies that the <emphasis role="strong">vdsm</emphasis> user has the ability to run the <literal>/bin/chown</literal> command as the <emphasis role="strong">root</emphasis> user. The <literal>NOPASSWD</literal> parameter indicates that the user will not be prompted to enter their password when calling <literal>sudo</literal>.</simpara>
</listitem>
</orderedlist>
<simpara>Once this configuration change has been made VDSM hooks are able to use the <literal>sudo</literal> command to run <literal>/bin/chown</literal> as <emphasis role="strong">root</emphasis>. This Python code uses <literal>sudo</literal> to execute <literal>/bin/chown</literal> as <emphasis role="strong">root</emphasis> on the file <emphasis role="strong">/my_file</emphasis>.</simpara>
<screen>retcode = subprocess.call( ["/usr/bin/sudo", "/bin/chown", "root", "/my_file"] )</screen>
</example>
<simpara>The standard error stream of hook scripts is collected in VDSM&#8217;s log. This information is used to debug hook scripts.</simpara>
</section>
<section xml:id="VDSM_hooks_return_codes">
<title>VDSM Hook Return Codes</title>
<simpara>Hook scripts must return one of the return codes shown in <xref linkend="hook-return-codes"/>. The return code will determine whether further hook scripts are processed by VDSM.</simpara>
<table xml:id="hook-return-codes" frame="all" rowsep="1" colsep="1">
<title>Hook Return Codes</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Code</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>0</simpara></entry>
<entry align="left" valign="top"><simpara>The hook script ended successfully</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>1</simpara></entry>
<entry align="left" valign="top"><simpara>The hook script failed, other hooks should be processed</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>2</simpara></entry>
<entry align="left" valign="top"><simpara>The hook script failed, no further hooks should be processed</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>&gt;2</simpara></entry>
<entry align="left" valign="top"><simpara>Reserved</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="VDSM_hooks_examples">
<title>VDSM Hook Examples</title>
<simpara>The example hook scripts provided in this section are strictly not supported by Red Hat. You must ensure that any and all hook scripts that you install to your system, regardless of source, are thoroughly tested for your environment.</simpara>
<example xml:id="VDSM_Hooks-example-numaset">
<title>NUMA Node Tuning</title>
<simpara><emphasis role="strong">Purpose:</emphasis></simpara>
<simpara>This hook script allows for tuning the allocation of memory on a NUMA host based on the <literal>numaset</literal> custom property. Where the custom property is not set no action is taken.</simpara>
<simpara><emphasis role="strong">Configuration String:</emphasis></simpara>
<screen>numaset=^(interleave|strict|preferred):[\^]?\d+(-\d+)?(,[\^]?\d+(-\d+)?)*$</screen>
<simpara>The regular expression used allows the <literal>numaset</literal> custom property for a given virtual machine to specify both the allocation mode (<literal>interleave</literal>, <literal>strict</literal>, <literal>preferred</literal>) and the node to use. The two values are separated by a colon (<literal>:</literal>). The regular expression allows specification of the <literal>nodeset</literal> as:</simpara>
<itemizedlist>
<listitem>
<simpara>that a specific node (<literal>numaset=strict:1</literal>, specifies that only node 1 be used), or</simpara>
</listitem>
<listitem>
<simpara>that a range of nodes be used (<literal>numaset=strict:1-4</literal>, specifies that nodes 1 through 4 be used), or</simpara>
</listitem>
<listitem>
<simpara>that a specific node not be used (<literal>numaset=strict:^3</literal>, specifies that node 3 not be used), or</simpara>
</listitem>
<listitem>
<simpara>any comma-separated combination of the above (<literal>numaset=strict:1-4,6</literal>, specifies that nodes 1 to 4, and 6 be used).</simpara>
</listitem>
</itemizedlist>
<simpara><emphasis role="strong">Script:</emphasis></simpara>
<simpara><emphasis role="strong">/usr/libexec/vdsm/hooks/before_vm_start/50_numa</emphasis></simpara>
<screen>#!/usr/bin/python

import os
import sys
import hooking
import traceback

'''
numa hook
=========
add numa support for domain xml:

&lt;numatune&gt;
    &lt;memory mode="strict" nodeset="1-4,^3" /&gt;
&lt;/numatune&gt;

memory=interleave|strict|preferred

numaset="1" (use one NUMA node)
numaset="1-4" (use 1-4 NUMA nodes)
numaset="^3" (don't use NUMA node 3)
numaset="1-4,^3,6" (or combinations)

syntax:
    numa=strict:1-4
'''

if os.environ.has_key('numa'):
    try:
        mode, nodeset = os.environ['numa'].split(':')

        domxml = hooking.read_domxml()

        domain = domxml.getElementsByTagName('domain')[0]
        numas = domxml.getElementsByTagName('numatune')

        if not len(numas) &gt; 0:
            numatune = domxml.createElement('numatune')
            domain.appendChild(numatune)

            memory = domxml.createElement('memory')
            memory.setAttribute('mode', mode)
            memory.setAttribute('nodeset', nodeset)
            numatune.appendChild(memory)

            hooking.write_domxml(domxml)
        else:
            sys.stderr.write('numa: numa already exists in domain xml')
            sys.exit(2)
    except:
        sys.stderr.write('numa: [unexpected error]: %s\n' % traceback.format_exc())
        sys.exit(2)</screen>
</example>
</section>
</appendix>
<appendix xml:id="appe-Custom_Network_Properties">
<title>Custom Network Properties</title>
<section xml:id="Explanation_of_bridge_opts_Parameters">
<title>Explanation of bridge_opts Parameters</title>
<table xml:id="Table-Explanation_of_bridge_opts_Parameters" frame="all" rowsep="1" colsep="1">
<title>bridge_opts parameters</title>
<tgroup cols="2">
<colspec colname="col_1" colwidth="50*"/>
<colspec colname="col_2" colwidth="50*"/>
<thead>
<row>
<entry align="left" valign="top">Parameter</entry>
<entry align="left" valign="top">Description</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>forward_delay</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time, in deciseconds, a bridge will spend in the listening and learning states. If no switching loop is discovered in this time, the bridge will enter forwarding state. This allows time to inspect the traffic and layout of the network before normal network operation.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>group_addr</simpara></entry>
<entry align="left" valign="top"><simpara>To send a general query, set this value to zero. To send a group-specific and group-and-source-specific queries, set this value to a 6-byte MAC address, not an IP address. Allowed values are <literal>01:80:C2:00:00:0x</literal> except <literal>01:80:C2:00:00:01</literal>, <literal>01:80:C2:00:00:02</literal> and <literal>01:80:C2:00:00:03</literal>.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>group_fwd_mask</simpara></entry>
<entry align="left" valign="top"><simpara>Enables bridge to forward link local group addresses. Changing this value from the default will allow non-standard bridging behavior.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>hash_max</simpara></entry>
<entry align="left" valign="top"><simpara>The maximum amount of buckets in the hash table. This takes effect immediately and cannot be set to a value less than the current number of multicast group entries. Value must be a power of two.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>hello_time</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time interval, in deciseconds, between sending 'hello' messages, announcing bridge position in the network topology. Applies only if this bridge is the Spanning Tree root bridge.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>max_age</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the maximum time, in deciseconds, to receive a 'hello' message from another root bridge before that bridge is considered dead and takeover begins.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_last_member_count</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the number of 'last member' queries sent to the multicast group after receiving a 'leave group' message from a host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_last_member_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time, in deciseconds, between 'last member' queries.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_membership_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time, in deciseconds, that a bridge will wait to hear from a member of a multicast group before it stops sending multicast traffic to the host.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_querier</simpara></entry>
<entry align="left" valign="top"><simpara>Sets whether the bridge actively runs a multicast querier or not. When a bridge receives a 'multicast host membership' query from another network host, that host is tracked based on the time that the query was received plus the multicast query interval time. If the bridge later attempts to forward traffic for that multicast membership, or is communicating with a querying multicast router, this timer confirms the validity of the querier. If valid, the multicast traffic is delivered via the bridge&#8217;s existing multicast membership table; if no longer valid, the traffic is sent via all bridge ports.Broadcast domains with, or expecting, multicast memberships should run at least one multicast querier for improved performance.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_querier_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the maximum time, in deciseconds, between last 'multicast host membership' query received from a host to ensure it is still valid.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_query_use_ifaddr</simpara></entry>
<entry align="left" valign="top"><simpara>Boolean. Defaults to '0', in which case the querier uses 0.0.0.0 as source address for IPv4 messages. Changing this sets the bridge IP as the source address.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_query_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time, in deciseconds, between query messages sent by the bridge to ensure validity of multicast memberships. At this time, or if the bridge is asked to send a multicast query for that membership, the bridge checks its own multicast querier state based on the time that a check was requested plus multicast_query_interval. If a multicast query for this membership has been sent within the last multicast_query_interval, it is not sent again.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_query_response_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Length of time, in deciseconds, a host is allowed to respond to a query once it has been sent.Must be less than or equal to the value of the multicast_query_interval.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_router</simpara></entry>
<entry align="left" valign="top"><simpara>Allows you to enable or disable ports as having multicast routers attached. A port with one or more multicast routers will receive all multicast traffic. A value of 0 disables completely, a value of 1 enables the system to automatically detect the presence of routers based on queries, and a value of 2 enables ports to always receive all multicast traffic.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_snooping</simpara></entry>
<entry align="left" valign="top"><simpara>Toggles whether snooping is enabled or disabled. Snooping allows the bridge to listen to the network traffic between routers and hosts to maintain a map to filter multicast traffic to the appropriate links.This option allows the user to re-enable snooping if it was automatically disabled due to hash collisions, however snooping will not be re-enabled if the hash collision has not been resolved.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_startup_query_count</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the number of queries sent out at startup to determine membership information.</simpara></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>multicast_startup_query_interval</simpara></entry>
<entry align="left" valign="top"><simpara>Sets the time, in deciseconds, between queries sent out at startup to determine membership information.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="How_to_Set_Up_Red_Hat_Enterprise_Virtualization_Manager_to_Use_Ethtool">
<title>How to Set Up oVirt Engine to Use Ethtool</title>
<simpara>You can configure ethtool properties for host network interface cards from the Administration Portal. The <emphasis role="strong">ethtool_opts</emphasis> key is not available by default and needs to be added to the Engine using the engine configuration tool. You also need to install the required VDSM hook package on the hosts.</simpara>
<simpara><emphasis role="strong">Adding the ethtool_opts Key to the Engine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine, run the following command to add the key:</simpara>
<screen># engine-config -s UserDefinedNetworkCustomProperties=ethtool_opts=.* --cver=4.4</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>On the hosts that you want to configure ethtool properties, install the VDSM hook package. The package is available by default on oVirt Node but needs to be installed on Enterprise Linux hosts.</simpara>
<screen># dnf install vdsm-hook-ethtool-options</screen>
</listitem>
</orderedlist>
<simpara>The <emphasis role="strong">ethtool_opts</emphasis> key is now available in the Administration Portal. See <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/> to apply ethtool properties to logical networks.</simpara>
</section>
<section xml:id="How_to_Set_Up_RHVM_to_Use_FCoE">
<title>How to Set Up oVirt Engine to Use FCoE</title>
<simpara>You can configure Fibre Channel over Ethernet (FCoE) properties for host network interface cards from the Administration Portal. The <emphasis role="strong">fcoe</emphasis> key is not available by default and needs to be added to the Engine using the engine configuration tool. You can check whether <emphasis role="strong">fcoe</emphasis> has already been enabled by running the following command:</simpara>
<screen># engine-config -g UserDefinedNetworkCustomProperties</screen>
<simpara>You also need to install the required VDSM hook package on the hosts. Depending on the FCoE card on the hosts, special configuration may also be needed; see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/fcoe-config.html">Configuring a Fibre Channel over Ethernet Interface</link> in the <emphasis>Enterprise Linux Storage Administration Guide</emphasis>.</simpara>
<simpara><emphasis role="strong">Adding the fcoe Key to the Engine</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the Engine, run the following command to add the key:</simpara>
<screen># engine-config -s UserDefinedNetworkCustomProperties='fcoe=^((enable|dcb|auto_vlan)=(yes|no),?)*$'</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>Install the VDSM hook package on each of the Enterprise Linux hosts on which you want to configure FCoE properties. The package is available by default on oVirt Node (oVirt Node).</simpara>
<screen># dnf install vdsm-hook-fcoe</screen>
</listitem>
</orderedlist>
<simpara>The <emphasis role="strong">fcoe</emphasis> key is now available in the Administration Portal. See <xref linkend="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts"/> to apply FCoE properties to logical networks.</simpara>
</section>
</appendix>
<appendix xml:id="appe-Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">
<title>oVirt User Interface Plugins</title>
<section xml:id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">
<title>oVirt User Interface Plug-ins</title>
<simpara>oVirt supports plug-ins that expose non-standard features. This makes it easier to use the oVirt Administration Portal to integrate with other systems. Each interface plug-in represents a set of user interface extensions that can be packaged and distributed for use with oVirt.</simpara>
<simpara>oVirt&#8217;s User Interface plug-ins integrate with the Administration Portal directly on the client using the JavaScript programming language. Plug-ins are invoked by the Administration Portal and executed in the web browser&#8217;s JavaScript runtime. User Interface plug-ins can use the JavaScript language and its libraries.</simpara>
<simpara>At key events during runtime, the Administration Portal invokes individual plug-ins via event handler functions representing Administration-Portal-to-plug-in communication. Although the Administration Portal supports multiple event-handler functions, a plug-in declares functions which are of interest only to its implementation. Each plug-in must register relevant event handler functions as part of the plug-in bootstrap sequence before the plug-in is put to use by the administration portal.</simpara>
<simpara>To facilitate the plug-in-to-Administration-Portal communication that drives the User Interface extension, the Administration Portal exposes the plug-in API as a global (top-level) pluginApi JavaScript object that individual plug-ins can consume. Each plug-in obtains a separate pluginApi instance, allowing the Administration Portal to control plug-in API-function invocation for each plug-in with respect to the plug-in&#8217;s life cycle.</simpara>
</section>
<section xml:id="sect-Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Lifecycle">
<title>oVirt User Interface Plugin Lifecycle</title>
<section xml:id="RHEV_UI_Plugin_Lifecycle">
<title>oVirt User Interface Plug-in Life cycle</title>
<simpara>The basic life cycle of a User Interface Plug-in divides into three stages:</simpara>
<itemizedlist>
<listitem>
<simpara>Plug-in discovery.</simpara>
</listitem>
<listitem>
<simpara>Plug-in loading.</simpara>
</listitem>
<listitem>
<simpara>Plug-in bootstrapping.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Discovery">
<title>oVirt User Interface Plug-in Discovery</title>
<simpara>Creating plug-in descriptors is the first step in the plug-in discovery process. Plug-in descriptors contain important plug-in metadata and optional default plug-in-specific configurations.</simpara>
<simpara>As part of handling administration portal HTML page requests (<literal>HTTP GET</literal>), User Interface plug-in infrastructure attempts to discover and load plug-in descriptors from your local file system. For each plug-in descriptor, the infrastructure also attempts to load corresponding plug-in user configurations used to override default plug-in-specific configurations (if any exist) and tweak plug-in runtime behavior. Plug-in user configuration is optional. After loading descriptors and corresponding user configuration files, oVirt Engine aggregates User Interface plug-in data and embeds it into the administration portal HTML page for runtime evaluation.</simpara>
<simpara>By default, plug-in descriptors reside in <emphasis role="strong">$ENGINE_USR/ui-plug-ins</emphasis>, with a default mapping of <emphasis role="strong">ENGINE_USR=/usr/share/ovirt-engine</emphasis> as defined by oVirt Engine local configuration. Plug-in descriptors are expected to comply with JSON format specifications, but plug-in descriptors allow Java/C++ style comments (of both <literal>/*</literal> and <literal>//</literal> varieties) in addition to the JSON format specifications.</simpara>
<simpara>By default, plug-in user configuration files reside in <emphasis role="strong">$ENGINE_ETC/ui-plug-ins</emphasis>, with a default mapping of <emphasis role="strong">ENGINE_ETC=/etc/ovirt-engine</emphasis> as defined by oVirt Engine local configuration. Plug-in user configuration files are expected to comply with same content format rules as plug-in descriptors.</simpara>
<note>
<simpara>Plug-in user configuration files generally follow the <emphasis role="strong">&lt;descriptorFileName&gt;-config.json</emphasis> naming convention.</simpara>
</note>
</section>
<section xml:id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Loading">
<title>oVirt User Interface Plug-in Loading</title>
<simpara>After a plug-in has been discovered and its data is embedded into the administration portal HTML page, administration portal tries to load the plug-in as part of application startup (unless you have configured it not to load as part of application startup).</simpara>
<simpara>For each plug-in that has been discovered, the administration portal creates an HTML iframe element that is used to load its host page. The plug-in host page is necessary to begin the plug-in bootstrap process, which (the bootstrap process) is used to evaluate the plug-in code in the context of the plug-in&#8217;s iframe element. User interface plug-in infrastructure supports serving plug-in resource files (such as the plug-in host page) from the local file system. The plug-in host page is loaded into the iframe element and the plug-in code is evaluated. After the plug-in code is evaluated, the plug-in communicates with the administration portal by means of the plug-in API.</simpara>
</section>
<section xml:id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Bootstrapping">
<title>oVirt User Interface Plug-in Bootstrapping</title>
<simpara>A typical plug-in bootstrap sequence consists of following steps:</simpara>
<simpara><emphasis role="strong">Plug-in Bootstrap Sequence</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Obtain pluginApi instance for the given plug-in</simpara>
</listitem>
<listitem>
<simpara>Obtain runtime plug-in configuration object (optional)</simpara>
</listitem>
<listitem>
<simpara>Register relevant event handler functions</simpara>
</listitem>
<listitem>
<simpara>Notify UI plug-in infrastructure to proceed with plug-in initialization</simpara>
</listitem>
</orderedlist>
<simpara>The following code snippet illustrates the above mentioned steps in practice:</simpara>
<screen>// Access plug-in API using 'parent' due to this code being evaluated within the context of an iframe element.
// As 'parent.pluginApi' is subject to Same-Origin Policy, this will only work when WebAdmin HTML page and plug-in
// host page are served from same origin. WebAdmin HTML page and plug-in host page will always be on same origin
// when using UI plug-in infrastructure support to serve plug-in resource files.
var api = parent.pluginApi('MyPlugin');

// Runtime configuration object associated with the plug-in (or an empty object).
var config = api.configObject();

// Register event handler function(s) for later invocation by UI plug-in infrastructure.
api.register({
	    // UiInit event handler function.
		UiInit: function() {
				// Handle UiInit event.
					window.alert('Favorite music band is ' + config.band);
					    }
});

// Notify UI plug-in infrastructure to proceed with plug-in initialization.
api.ready();</screen>
</section>
</section>
<section xml:id="UI_Plugin-related_Files_and_their_Locations">
<title>User Interface Plugin-related Files and Their Locations</title>
<table frame="all" rowsep="1" colsep="1">
<title>UI Plugin-related Files and their Locations</title>
<tgroup cols="3">
<colspec colname="col_1" colwidth="33.3333*"/>
<colspec colname="col_2" colwidth="33.3333*"/>
<colspec colname="col_3" colwidth="33.3334*"/>
<thead>
<row>
<entry align="left" valign="top">File</entry>
<entry align="left" valign="top">Location</entry>
<entry align="left" valign="top">Remarks</entry>
</row>
</thead>
<tbody>
<row>
<entry align="left" valign="top"><simpara>Plug-in descriptor files (meta-data)</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">/usr/share/ovirt-engine/ui-plugins/my-plugin.json</emphasis></simpara></entry>
<entry align="left" valign="top"></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Plug-in user configuration files</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">/etc/ovirt-engine/ui-plugins/my-plugin-config.json</emphasis></simpara></entry>
<entry align="left" valign="top"></entry>
</row>
<row>
<entry align="left" valign="top"><simpara>Plug-in resource files</simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">/usr/share/ovirt-engine/ui-plugins/&lt;resourcePath&gt;/PluginHostPage.html</emphasis></simpara></entry>
<entry align="left" valign="top"><simpara><emphasis role="strong">&lt;resourcePath&gt;</emphasis> is defined by the corresponding attribute in the plug-in descriptor.</simpara></entry>
</row>
</tbody>
</tgroup>
</table>
</section>
<section xml:id="Example_RHEV_UI_Plugin_Deployment">
<title>Example User Interface Plug-in Deployment</title>
<simpara>Follow these instructions to create a user interface plug-in that runs a <emphasis role="strong">Hello World!</emphasis> program when you sign in to the oVirt Engine Administration Portal.</simpara>
<simpara><emphasis role="strong">Deploying a <literal>Hello World!</literal> Plug-in</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Create a plug-in descriptor by creating the following file in the Engine at <emphasis role="strong">/usr/share/ovirt-engine/ui-plugins/helloWorld.json</emphasis>:</simpara>
<screen>{
    "name": "HelloWorld",
    "url": "/ovirt-engine/webadmin/plugin/HelloWorld/start.html",
    "resourcePath": "hello-files"
}</screen>
</listitem>
<listitem>
<simpara>Create the plug-in host page by creating the following file in the Engine at <emphasis role="strong">/usr/share/ovirt-engine/ui-plugins/hello-files/start.html</emphasis>:</simpara>
<screen>&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;
&lt;script&gt;
    var api = parent.pluginApi('HelloWorld');
    api.register({
	UiInit: function() { window.alert('Hello world'); }
    });
    api.ready();
&lt;/script&gt;
&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</screen>
</listitem>
</orderedlist>
<simpara>If you have successfully implemented the <emphasis role="strong">Hello World!</emphasis> plug-in, you will see this screen when you sign in to the Administration Portal:</simpara>
<figure xml:id="ui-plugin-hello-world-success">
<title>A Successful Implementation of the <emphasis role="strong">Hello World!</emphasis> Plug-in</title>
<mediaobject>
<imageobject>
<imagedata fileref="images/1475.png"/>
</imageobject>
<textobject><phrase>1475</phrase></textobject>
</mediaobject>
</figure>
</section>
</appendix>
<appendix xml:id="appe-Red_Hat_Enterprise_Virtualization_and_SSL">
<title>oVirt and encrypted communication</title>
<section xml:id="Replacing_the_Manager_CA_Certificate">
<title>Replacing the oVirt Engine CA Certificate</title>
<warning>
<simpara>Do not change the permissions and ownerships for the <literal>/etc/pki</literal> directory or any subdirectories. The permission for the <literal>/etc/pki</literal> and the <literal>/etc/pki/ovirt-engine</literal> directory must remain as the default, <literal>755</literal>.</simpara>
</warning>
<simpara>You can configure your organization&#8217;s third-party CA certificate to identify the oVirt Engine to users connecting over HTTPS.</simpara>
<note>
<simpara>Using a third-party CA certificate for HTTPS connections does not affect the certificate used for authentication between the Engine and hosts. They will continue to use the self-signed certificate generated by the Engine.</simpara>
</note>
<simpara><emphasis role="strong">Prerequisites</emphasis></simpara>
<itemizedlist>
<listitem>
<simpara>A third-party CA certificate. This is the certificate of the CA (Certificate Authority) that issued the certificate you want to use. It is provided as a <emphasis role="strong">PEM</emphasis> file. The certificate chain must be complete up to the root certificate. The chain&#8217;s order is critical and must be from the last intermediate certificate to the root certificate. This procedure assumes that the third-party CA certificate is provided in <literal>/tmp/3rd-party-ca-cert.pem</literal>.</simpara>
</listitem>
<listitem>
<simpara>The private key that you want to use for Apache httpd. It must not have a password. This procedure assumes that it is located in <literal>/tmp/apache.key</literal>.</simpara>
</listitem>
<listitem>
<simpara>The certificate issued by the CA. This procedure assumes that it is located in <literal>/tmp/apache.cer</literal>.</simpara>
</listitem>
</itemizedlist>
<simpara>If you received the private key and certificate from your CA in a P12 file, use the following procedure to extract them. For other file formats, contact your CA. After extracting the private key and certificate, proceed to <link linkend="Replace">Replacing the oVirt Engine Apache CA Certificate</link>.</simpara>
<simpara xml:id="Extracting"><emphasis role="strong">Extracting the Certificate and Private Key from a P12 Bundle</emphasis></simpara>
<simpara>The internal CA stores the internally generated key and certificate in a P12 file, in <literal>/etc/pki/ovirt-engine/keys/apache.p12</literal>. Store your new file in the same location. The following procedure assumes that the new P12 file is in <literal>/tmp/apache.p12</literal>.</simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>Back up the current <literal>apache.p12</literal> file:</simpara>
<screen># cp -p /etc/pki/ovirt-engine/keys/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12.bck</screen>
</listitem>
<listitem>
<simpara>Replace the current file with the new file:</simpara>
<screen># cp /tmp/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12</screen>
</listitem>
<listitem>
<simpara>Extract the private key and certificate to the required locations. If the file is password protected, you must add <literal>-passin pass:_password_</literal>, replacing <emphasis>password</emphasis> with the required password.</simpara>
<screen># openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nocerts -nodes &gt; /tmp/apache.key
# openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nokeys &gt; /tmp/apache.cer</screen>
</listitem>
</orderedlist>
<important>
<simpara>For new oVirt installations, you must complete all of the steps in this procedure.</simpara>
</important>
<simpara xml:id="Replace"><emphasis role="strong">Replacing the oVirt Engine Apache CA Certificate</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>If you are using a self-hosted engine, put the environment into global maintenance mode.</simpara>
<screen># hosted-engine --set-maintenance --mode=global</screen>
<simpara>For more information, see <xref linkend="Maintaining_the_Self-Hosted_Engine"/>.</simpara>
</listitem>
<listitem>
<simpara>Add your CA certificate to the host-wide trust store:</simpara>
<screen># cp /tmp/<emphasis>3rd-party-ca-cert</emphasis>.pem /etc/pki/ca-trust/source/anchors
# update-ca-trust</screen>
</listitem>
<listitem>
<simpara>The Engine has been configured to use <literal>/etc/pki/ovirt-engine/apache-ca.pem</literal>, which is symbolically linked to <literal>/etc/pki/ovirt-engine/ca.pem</literal>. Remove the symbolic link:</simpara>
<screen># rm /etc/pki/ovirt-engine/apache-ca.pem</screen>
</listitem>
<listitem>
<simpara>Save your CA certificate as <literal>/etc/pki/ovirt-engine/apache-ca.pem</literal>:</simpara>
<screen># cp /tmp/<emphasis>3rd-party-ca-cert</emphasis>.pem /etc/pki/ovirt-engine/apache-ca.pem</screen>
</listitem>
<listitem>
<simpara>Back up the existing private key and certificate:</simpara>
<screen># cp /etc/pki/ovirt-engine/keys/apache.key.nopass /etc/pki/ovirt-engine/keys/apache.key.nopass.bck
# cp /etc/pki/ovirt-engine/certs/apache.cer /etc/pki/ovirt-engine/certs/apache.cer.bck</screen>
</listitem>
<listitem>
<simpara>Copy the private key to the required location:</simpara>
<screen># cp /tmp/apache.key /etc/pki/ovirt-engine/keys/apache.key.nopass</screen>
</listitem>
<listitem>
<simpara>Set the private key owner to root and set the permissions to <literal>0640</literal>:</simpara>
<screen># chown root:ovirt  /etc/pki/ovirt-engine/keys/apache.key.nopass
# chmod 640 /etc/pki/ovirt-engine/keys/apache.key.nopass</screen>
</listitem>
<listitem>
<simpara>Copy the certificate to the required location:</simpara>
<screen># cp /tmp/apache.cer /etc/pki/ovirt-engine/certs/apache.cer</screen>
</listitem>
<listitem>
<simpara>Set the certificate owner to root and set the permissions to <literal>0644</literal>:</simpara>
<screen># chown root:ovirt /etc/pki/ovirt-engine/certs/apache.cer
# chmod 644 /etc/pki/ovirt-engine/certs/apache.cer</screen>
</listitem>
<listitem>
<simpara>Restart the Apache server:</simpara>
<screen># systemctl restart httpd.service</screen>
</listitem>
<listitem>
<simpara>Create a new trust store configuration file, <literal>/etc/ovirt-engine/engine.conf.d/99-custom-truststore.conf</literal>, with the following parameters:</simpara>
<screen>ENGINE_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"
ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD=""</screen>
</listitem>
<listitem>
<simpara>Copy the <literal>/etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf</literal> file, and rename it with an index number that is greater than 10 (for example, <literal>99-setup.conf</literal>). Add the following parameters to the new file:</simpara>
<screen>SSL_CERTIFICATE=/etc/pki/ovirt-engine/certs/apache.cer
SSL_KEY=/etc/pki/ovirt-engine/keys/apache.key.nopass</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>websocket-proxy</literal> service:</simpara>
<screen># systemctl restart ovirt-websocket-proxy.service</screen>
</listitem>
<listitem>
<simpara>If you manually changed the <literal>/etc/ovirt-provider-ovn/conf.d/10-setup-ovirt-provider-ovn.conf</literal> file, or are using a configuration file from an older installation, make sure that the Engine is still configured to use <literal>/etc/pki/ovirt-engine/apache-ca.pem</literal> as the certificate source.</simpara>
</listitem>
<listitem>
<simpara>Enable <literal>engine-backup</literal> to update the system on restore by creating a new file, <literal>/etc/ovirt-engine-backup/engine-backup-config.d/update-system-wide-pki.sh</literal>, with the following content:</simpara>
<screen>BACKUP_PATHS="${BACKUP_PATHS}
/etc/ovirt-engine-backup"
cp -f /etc/pki/ovirt-engine/apache-ca.pem \
/etc/pki/ca-trust/source/anchors/<emphasis>3rd-party-ca-cert</emphasis>.pem
update-ca-trust</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-provider-ovn</literal> service:</simpara>
<screen># systemctl restart ovirt-provider-ovn.service</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-imageio</literal> service:</simpara>
<screen># systemctl restart ovirt-imageio.service</screen>
</listitem>
<listitem>
<simpara>Restart the <literal>ovirt-engine</literal> service:</simpara>
<screen># systemctl restart ovirt-engine.service</screen>
</listitem>
<listitem>
<simpara>If you are using a self-hosted engine, turn off global maintenance mode.</simpara>
<screen># hosted-engine --set-maintenance --mode=none</screen>
</listitem>
</orderedlist>
<simpara>Your users can now connect to the Administration Portal and VM Portal, without seeing a warning about the authenticity of the certificate used to encrypt HTTPS traffic.</simpara>
</section>
<section xml:id="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">
<title>Setting Up Encrypted Communication between the Engine and an LDAP Server</title>
<simpara>To set up encrypted communication between the oVirt Engine and an LDAP server, obtain the root CA certificate of the LDAP server, copy the root CA certificate to the Engine, and create a PEM-encoded CA certificate. The keystore type can be any Java-supported type. The following procedure uses the Java KeyStore (JKS) format.</simpara>
<note>
<simpara>For more information on creating a PEM-encoded CA certificate and importing certificates, see the <literal>X.509 CERTIFICATE TRUST STORE</literal> section of the README file at <emphasis role="strong">/usr/share/doc/ovirt-engine-extension-aaa-ldap-<emphasis>version</emphasis></emphasis>.</simpara>
</note>
<simpara><emphasis role="strong">Creating a PEM-encoded CA certificate</emphasis></simpara>
<orderedlist numeration="arabic">
<listitem>
<simpara>On the oVirt Engine, copy the root CA certificate of the LDAP server to the <emphasis role="strong">/tmp</emphasis> directory and import the root CA certificate using <literal>keytool</literal> to create a PEM-encoded CA certificate. The following command imports the root CA certificate at <emphasis>/tmp/myrootca.pem</emphasis> and creates a PEM-encoded CA certificate <emphasis>myrootca.jks</emphasis> under <emphasis>/etc/ovirt-engine/aaa/</emphasis>. Note down the certificate&#8217;s location and password. If you are using the interactive setup tool, this is all the information you need. If you are configuring the LDAP server manually, follow the rest of the procedure to update the configuration files.</simpara>
<screen>$ keytool -importcert -noprompt -trustcacerts -alias <emphasis>myrootca</emphasis> -file <emphasis>/tmp/myrootca.pem</emphasis> -keystore <emphasis>/etc/ovirt-engine/aaa/myrootca.jks</emphasis> -storepass <emphasis>password</emphasis></screen>
</listitem>
<listitem>
<simpara>Update the <emphasis role="strong">/etc/ovirt-engine/aaa/profile1.properties</emphasis> file with the certificate information:</simpara>
<note>
<simpara><literal>${local:_basedir}</literal> is the directory where the LDAP property configuration file resides and points to the <emphasis role="strong">/etc/ovirt-engine/aaa</emphasis> directory. If you created the PEM-encoded CA certificate in a different directory, replace <literal>${local:_basedir}</literal> with the full path to the certificate.</simpara>
</note>
<itemizedlist>
<listitem>
<simpara>To use startTLS (recommended):</simpara>
<screen># Create keystore, import certificate chain and uncomment
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = ${local:_basedir}/<emphasis>myrootca.jks</emphasis>
pool.default.ssl.truststore.password = <emphasis>password</emphasis></screen>
</listitem>
<listitem>
<simpara>To use SSL:</simpara>
<screen># Create keystore, import certificate chain and uncomment
pool.default.serverset.single.port = 636
pool.default.ssl.enable = true
pool.default.ssl.truststore.file = ${local:_basedir}/<emphasis>myrootca.jks</emphasis>
pool.default.ssl.truststore.password = <emphasis>password</emphasis></screen>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>To continue configuring an external LDAP provider, see <link linkend="Configuring_an_External_LDAP_Provider">Configuring an External LDAP Provider</link>. To continue configuring LDAP and Kerberos for Single Sign-on, see <link linkend="Configuring_LDAP_and_Kerberos_for_Single_Sign-on">Configuring LDAP and Kerberos for Single Sign-on</link>.</simpara>
</section>
<section xml:id="assembly-enabling-encrypted-vnc-consoles-for-fips">
<title>Enabling encrypted VNC consoles for FIPS</title>
<simpara>You can set up encrypted VNC consoles to work with a oVirt (oVirt) Engine and hosts that have FIPS enabled.</simpara>
<simpara>To set up encrypted VNC consoles, you complete the following procedures:</simpara>
<itemizedlist>
<listitem>
<simpara><link linkend="enabling-fips_in_rhv">Enable FIPS in RHV</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="configuring_cluster_to_enable_vnc_encryption">Configure the host cluster&#8217;s console settings to enable VNC Encryption</link>.</simpara>
</listitem>
<listitem>
<simpara><link linkend="running_vnc_sasl_ansible_playbook_for_each_host">Run the VNC SASL ansible playbook on each host.</link></simpara>
</listitem>
<listitem>
<simpara><link linkend="configuring_remote_viewer_trust_rhvm_ca_certificate">Configure the Remote Viewer to trust the Manager&#8217;s CA certificate.</link></simpara>
</listitem>
</itemizedlist>
<bridgehead xml:id="configuring_cluster_to_enable_vnc_encryption" renderas="sect3">Configuring the cluster to enable VNC Encryption</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Clusters</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the cluster where you plan to enable VNC encryption and click <guibutton>Edit</guibutton>. The <emphasis role="strong">Edit Cluster</emphasis> window opens.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Console</emphasis> tab.</simpara>
</listitem>
<listitem>
<simpara>Select the <emphasis role="strong">Enable VNC Encryption</emphasis> checkbox and click <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
<bridgehead xml:id="running_vnc_sasl_ansible_playbook_for_each_host" renderas="sect3">Running the VNC SASL Ansible playbook for each host</bridgehead>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>In the Administration Portal, put the hosts you created with FIPS enabled into maintenance mode:</simpara>
<orderedlist numeration="loweralpha">
<listitem>
<simpara>In the Administration Portal, click <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>In the <emphasis role="strong">Virtual Machines</emphasis> column, verify that each host has zero virtual machines. Perform a live migration to remove all virtual machines from any hosts where necessary. For details, see <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/virtual_machine_management_guide/index#sect-Migrating_Virtual_Machines_Between_Hosts">Migrating Virtual Machines Between Hosts</link></simpara>
</listitem>
<listitem>
<simpara>Select each host and click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Maintenance</guimenuitem></menuchoice> and <guibutton>OK</guibutton>.</simpara>
</listitem>
</orderedlist>
</listitem>
<listitem>
<simpara>Connect to the command line of the machine where the Manager is running.</simpara>
<itemizedlist>
<listitem>
<simpara>If the Manager is running on a stand-alone machine, connect to that machine&#8217;s command line. For example, enter:</simpara>
<screen># ssh root@rhvm</screen>
</listitem>
<listitem>
<simpara>If the Manager is running as a self-hosted engine, use <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Virtual Machines</guimenuitem></menuchoice> to select the self-hosted engine virtual machine, named <literal>HostedEngine</literal> by default, and click <guibutton>Console</guibutton>.</simpara>
</listitem>
</itemizedlist>
</listitem>
<listitem>
<simpara>On the Manager machine, run the VNC SASL ansible playbook for each host.</simpara>
<screen># cd /usr/share/ovirt-engine/ansible-runner-service-project/project/
# ansible-playbook --ask-pass --inventory=&lt;hostname&gt;, ovirt-vnc-sasl.yml</screen>
<simpara>For <literal>&lt;hostname&gt;</literal>, enter the complete <emphasis role="strong">Hostname</emphasis> shown on <menuchoice><guimenu>Compute</guimenu> <guimenuitem>Hosts</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>Select the host and click <menuchoice><guimenu>Installation</guimenu> <guimenuitem>Reinstall</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>After reinstallation, select the host and click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Restart</guimenuitem></menuchoice>.</simpara>
</listitem>
<listitem>
<simpara>After rebooting, select the host and click <menuchoice><guimenu>Management</guimenu> <guimenuitem>Activate</guimenuitem></menuchoice>.</simpara>
</listitem>
</orderedlist>
<formalpara>
<title>Troubleshooting</title>
<para>When running the VNC SASL Ansible playbook, the task might fail with the following error message:</para>
</formalpara>
<screen>Using a SSH password instead of a key is not possible because Host Key checking is enabled and sshpass does not support this.  Please add this host&#8217;s fingerprint to your known_hosts file to manage this host.</screen>
<simpara>To solve this problem, disable host key checking by doing one of the following:</simpara>
<itemizedlist>
<listitem>
<simpara>Disable host key checking permanently by uncommenting the following line in <literal role="filename">/etc/ansible/ansible.cfg</literal>:</simpara>
<screen>#host_key_checking = False</screen>
</listitem>
<listitem>
<simpara>Disable host key checking temporarily by running the following command:</simpara>
<screen>export ANSIBLE_HOST_KEY_CHECKING=False.</screen>
</listitem>
</itemizedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://www.redhat.com/en/blog/configuring-and-applying-scap-policies-during-installation">Configuring and Applying SCAP Policies During Installation</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/downloads/content/415/ver=4.3/rhel---7/4.3/x86_64/product-software">Installers and Images for Red Hat Virtualization Manager (v. 4.3 for x86_64)</link></simpara>
</listitem>
</itemizedlist>
<bridgehead xml:id="configuring_remote_viewer_trust_rhvm_ca_certificate" renderas="sect3">Configuring the Remote Viewer to trust the Manager&#8217;s CA certificate</bridgehead>
<simpara>Configure the Remote Viewer console on your client machine, <literal>virt-viewer</literal> or <literal>remote-viewer</literal>, to trust the RHV Manager&#8217;s certificate authority (CA)</simpara>
<orderedlist numeration="arabic">
<title>Procedure</title>
<listitem>
<simpara>Navigate to <literal>https://&lt;<emphasis>engine_address</emphasis>&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</literal>.</simpara>
</listitem>
<listitem>
<simpara>Enable all the trust settings.</simpara>
</listitem>
<listitem>
<simpara>On the client machine where you plan to run the VNC console, create a directory for the certificate file:</simpara>
<screen>$ mkdir ~/.pki/CA</screen>
<warning>
<simpara>If this step generates an error such as <literal>mkdir: cannot create directory ‘/home/example_user/.pki/CA’: File exists</literal>, take precautions to avoid overwriting <literal>~/.pki/CA/cacert.pem</literal> in the next step. For example, include the current date in the filename.</simpara>
</warning>
</listitem>
<listitem>
<simpara>Download the certificate:</simpara>
<screen>$ curl -k -o ~/.pki/CA/cacert-&lt;today&#8217;s date&gt;.pem '\https://&lt;engine_address&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA'</screen>
</listitem>
<listitem>
<simpara>Install the certificate authority in your browser:</simpara>
<itemizedlist>
<listitem>
<simpara><link xl:href="https://access.redhat.com/solutions/95103">Firefox</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/solutions/17864">Internet Explorer</link></simpara>
</listitem>
<listitem>
<simpara><link xl:href="https://access.redhat.com/solutions/1168383">Google Chrome</link>.</simpara>
</listitem>
</itemizedlist>
</listitem>
</orderedlist>
<simpara>Install the SASL SCRAM libraries on the client machine:</simpara>
<screen>$ sudo dnf install cyrus-sasl-scram</screen>
<orderedlist numeration="arabic">
<title>Verification steps</title>
<listitem>
<simpara>Run a virtual machine on one of the FIPS-enabled hosts you created.</simpara>
</listitem>
<listitem>
<simpara>Connect to the virtual machine using a VNC console.</simpara>
</listitem>
</orderedlist>
<itemizedlist>
<title>Additional resources</title>
<listitem>
<simpara><link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html-single/virtual_machine_management_guide/index#sect-Installing_Console_Components">Installing Console Components</link></simpara>
</listitem>
<listitem>
<simpara><xref linkend="Replacing_the_Manager_CA_Certificate"/></simpara>
</listitem>
</itemizedlist>
</section>
</appendix>
<appendix xml:id="appe-Branding">
<title>Branding</title>
<section xml:id="sect-Branding">
<title>Branding</title>
<section xml:id="Re-Branding_the_Manager1">
<title>Re-Branding the Engine</title>
<simpara>Various aspects of the oVirt Engine can be customized, such as the icons used by and text displayed in pop-up windows and the links shown on the Welcome Page. This allows you to re-brand the Engine and gives you fine-grained control over the end look and feel presented to administrators and users.</simpara>
<simpara>The files required to customize the Engine are located in the <emphasis role="strong">/etc/ovirt-engine/branding/</emphasis> directory on the system on which the Engine is installed. The files comprise a set of cascading style sheet files that are used to style various aspects of the graphical user interface and a set of properties files that contain messages and links that are incorporated into various components of the Engine.</simpara>
<simpara>To customize a component, edit the file for that component and save the changes. The next time you open or refresh that component, the changes will be applied.</simpara>
</section>
<section xml:id="Re-Branding_the_Manager">
<title>Login Screen</title>
<simpara>The login screen is the login screen used by both the Administration Portal and VM Portal. The elements of the login screen that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The border</simpara>
</listitem>
<listitem>
<simpara>The header image on the left</simpara>
</listitem>
<listitem>
<simpara>The header image on the right</simpara>
</listitem>
<listitem>
<simpara>The header text</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for the login screen are located in <emphasis role="strong">common.css</emphasis>.</simpara>
</section>
<section xml:id="Administration_Portal_Screen">
<title>Administration Portal Screen</title>
<simpara>The administration portal screen is the main screen that is shown when you log into the Administration Portal. The elements of the administration portal screen that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The logo</simpara>
</listitem>
<listitem>
<simpara>The left background image</simpara>
</listitem>
<listitem>
<simpara>The center background image</simpara>
</listitem>
<listitem>
<simpara>The right background image</simpara>
</listitem>
<listitem>
<simpara>The text to the right of the logo</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for the administration portal screen are located in <emphasis role="strong">web_admin.css</emphasis>.</simpara>
</section>
<section xml:id="User_Portal_Screen">
<title>VM Portal Screen</title>
<simpara>The VM Portal screen is the screen that is shown when you log into the VM Portal. The elements of the VM Portal screen that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The logo</simpara>
</listitem>
<listitem>
<simpara>The center background image</simpara>
</listitem>
<listitem>
<simpara>The right background image</simpara>
</listitem>
<listitem>
<simpara>The border around the main grid</simpara>
</listitem>
<listitem>
<simpara>The text above the <emphasis role="strong">Logged in user</emphasis> label</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for the VM Portal screen are located in <emphasis role="strong">user_portal.css</emphasis>.</simpara>
</section>
<section xml:id="Pop-up_Windows">
<title>Pop-Up Windows</title>
<simpara>Pop-up windows are all windows in the Engine that allow you to create, edit or update an entity such as a host or virtual machine. The elements of pop-up windows that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The border</simpara>
</listitem>
<listitem>
<simpara>The header image on the left</simpara>
</listitem>
<listitem>
<simpara>The header center image (repeated)</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for pop-up windows are located in <literal>common.css</literal>.</simpara>
</section>
<section xml:id="Tabs">
<title>Tabs</title>
<simpara>Many pop-up windows in the Administration Portal include tabs. The elements of these tabs that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>Active</simpara>
</listitem>
<listitem>
<simpara>Inactive</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for tabs are located in <emphasis role="strong">common.css</emphasis> and <emphasis role="strong">user_portal.css</emphasis>.</simpara>
</section>
<section xml:id="The_Welcome_Page">
<title>The Welcome Page</title>
<simpara>The Welcome Page is the page that is initially displayed when you visit the homepage of the Engine. In addition to customizing the overall look and feel, you can also make other changes such as adding links to the page for additional documentation or internal websites by editing a template file. The elements of the Welcome Page that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The page title</simpara>
</listitem>
<listitem>
<simpara>The header (left, center and right)</simpara>
</listitem>
<listitem>
<simpara>The error message</simpara>
</listitem>
<listitem>
<simpara>The link to forward and the associated message for that link</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for the Welcome Page are located in <emphasis role="strong">welcome_style.css</emphasis>.</simpara>
<simpara><emphasis role="strong">The Template File</emphasis></simpara>
<simpara>The template file for the Welcome Page is a regular HTML file of the name <literal>welcome_page.template</literal> that does not contain <literal>HTML</literal>, <literal>HEAD</literal> or <literal>BODY</literal> tags. This file is inserted directly into the Welcome Page itself, and acts as a container for the content that is displayed in the Welcome Page. As such, you must edit this file to add new links or change the content itself. Another feature of the template file is that it contains placeholder text such as <literal>{user_portal}</literal> that is replaced by corresponding text in the <emphasis role="strong">messages.properties</emphasis> file when the Welcome Page is processed.</simpara>
</section>
<section xml:id="The_File_Not_Found_Page">
<title>The Page Not Found Page</title>
<simpara>The Page Not Found page is a page that is displayed when you open a link to a page that cannot be found in the oVirt Engine. The elements of the Page Not Found page that can be customized are as follows:</simpara>
<itemizedlist>
<listitem>
<simpara>The page title</simpara>
</listitem>
<listitem>
<simpara>The header (left, center and right)</simpara>
</listitem>
<listitem>
<simpara>The error message</simpara>
</listitem>
<listitem>
<simpara>The link to forward and the associated message for that link</simpara>
</listitem>
</itemizedlist>
<simpara>The classes for the Page Not Found page are located in <literal>welcome_style.css</literal>.</simpara>
</section>
</section>
</appendix>
<appendix xml:id="appe-System_Accounts">
<title>System Accounts</title>
<section xml:id="sect-System_Accounts">
<title>System Accounts</title>
<section xml:id="Red_Hat_Enterprise_Virtualization_Manager_User_Accounts">
<title>oVirt Engine User Accounts</title>
<simpara>A number of system user accounts are created to support oVirt when the <literal>rhevm</literal> package is installed. Each system user has a default user identifier (UID). The system user accounts created are:</simpara>
<itemizedlist>
<listitem>
<simpara>The <emphasis role="strong">vdsm</emphasis> user (UID <literal>36</literal>). Required for support tools that mount and access NFS storage domains.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt</emphasis> user (UID <literal>108</literal>). Owner of the <emphasis role="strong">ovirt-engine</emphasis> Red Hat JBoss Enterprise Application Platform instance.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> user (UID <literal>498</literal>). Required for the guest serial console.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Red_Hat_Enterprise_Virtualization_Manager_Groups">
<title>oVirt Engine Groups</title>
<simpara>A number of system user groups are created to support oVirt when the <literal>rhevm</literal> package is installed. Each system user group has a default group identifier (GID). The system user groups created are:</simpara>
<itemizedlist>
<listitem>
<simpara>The <emphasis role="strong">kvm</emphasis> group (GID <literal>36</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">vdsm</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt</emphasis> group (GID <literal>108</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> group (GID <literal>498</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> user.</simpara>
</listitem>
</itemizedlist>
</section>
<section xml:id="Virtualization_Host_User_Accounts">
<title>Virtualization Host User Accounts</title>
<simpara>A number of system user accounts are created on the virtualization host when the <literal>vdsm</literal> and <literal>qemu-kvm-rhev</literal> packages are installed. Each system user has a default user identifier (UID). The system user accounts created are:</simpara>
<itemizedlist>
<listitem>
<simpara>The <emphasis role="strong">vdsm</emphasis> user (UID <literal>36</literal>).</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">qemu</emphasis> user (UID <literal>107</literal>).</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">sanlock</emphasis> user (UID <literal>179</literal>).</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> user (UID <literal>498</literal>).</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>The user identifiers (UIDs) and group identifiers (GIDs) allocated may vary between systems. The <emphasis role="strong">vdsm</emphasis> user is fixed to a UID of <literal>36</literal> and the <emphasis role="strong">kvm</emphasis> group is fixed to a GID of <literal>36</literal>.</simpara>
<simpara>If UID <literal>36</literal> or GID <literal>36</literal> is already used by another account on the system a conflict will arise during installation of the <literal>vdsm</literal> and <literal>qemu-kvm-rhev</literal> packages.</simpara>
</important>
</section>
<section xml:id="Virtualization_Host_Groups">
<title>Virtualization Host Groups</title>
<simpara>A number of system user groups are created on the virtualization host when the <literal>vdsm</literal> and <literal>qemu-kvm-rhev</literal> packages are installed. Each system user group has a default group identifier (GID). The system user groups created are:</simpara>
<itemizedlist>
<listitem>
<simpara>The <emphasis role="strong">kvm</emphasis> group (GID <literal>36</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">qemu</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">sanlock</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">qemu</emphasis> group (GID <literal>107</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">vdsm</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">sanlock</emphasis> user.</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> group (GID <literal>498</literal>). Group members include:</simpara>
</listitem>
<listitem>
<simpara>The <emphasis role="strong">ovirt-vmconsole</emphasis> user.</simpara>
</listitem>
</itemizedlist>
<important>
<simpara>The user identifiers (UIDs) and group identifiers (GIDs) allocated may vary between systems. The <emphasis role="strong">vdsm</emphasis> user is fixed to a UID of <literal>36</literal> and the <emphasis role="strong">kvm</emphasis> group is fixed to a GID of <literal>36</literal>.</simpara>
<simpara>If UID <literal>36</literal> or GID <literal>36</literal> is already used by another account on the system a conflict will arise during installation of the <literal>vdsm</literal> and <literal>qemu-kvm-rhev</literal> packages.</simpara>
</important>
</section>
</section>
</appendix>
<appendix xml:id="_legal_notice">
<title>Legal notice</title>
<simpara>Certain portions of this text first appeared in <link xl:href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/administration_guide/">Red Hat Virtualization 4.4 Administration Guide</link>. Copyright © 2020 Red Hat, Inc. Licensed under a <link xl:href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</link>.</simpara>
</appendix>
</part>
</book>