<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Gluster Sync Configuration With CLI | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Gluster Sync Configuration With CLI" />
<meta name="author" content="Kanagaraj Mayilsamy" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2869/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2869/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gluster Sync Configuration With CLI" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Kanagaraj Mayilsamy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kanagaraj Mayilsamy"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Gluster Sync Configuration With CLI","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2869/images/logo.svg"},"name":"Kanagaraj Mayilsamy"},"url":"https://ovirt.github.io/ovirt-site/previews/2869/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2869/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2869/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2869/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2869/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2869/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2869/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2869/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2869/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2869/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2869/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2869/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2869/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2869/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2869/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2869/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2869/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2869/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2869/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2869/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2869/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2869/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2869/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2869//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2869//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2869/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2869/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2869/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2869/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2869/develop/release-management/features/gluster/">
              <span property="name">Gluster</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ad6a629dcee77b9544df139f8407510f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ad6a629dcee77b9544df139f8407510f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Kanagaraj Mayilsamy</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shireesh Anjal</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2869/documentation/'>Documentation is available here.</a></div>

<h1 id="gluster-sync-configuration-with-cli">Gluster Sync Configuration With CLI</h1>

<h2 id="summary">Summary</h2>

<p>Providing support for automatically sync the changes made through Gluster CLI in oVirt.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature owner: Shireesh Anjal <a href="mailto:sanjal@redhat.com">sanjal@redhat.com</a>
    <ul>
      <li>GUI Component owner: Kanagaraj Mayilsamy <a href="mailto:kmayilsa@redhat.com">kmayilsa@redhat.com</a></li>
      <li>Engine Component owner: Shireesh Anjal <a href="mailto:sanjal@redhat.com">sanjal@redhat.com</a></li>
      <li>QA Owner: Sudhir Dharanendraiah <a href="mailto:sdharane@redhat.com">sdharane@redhat.com</a></li>
    </ul>
  </li>
</ul>

<h2 id="current-status">Current Status</h2>

<ul>
  <li>Status: Completed</li>
  <li>Last updated date: Tue Jan 29 2013</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<h3 id="automatic">Automatic</h3>

<p>Introduce background job(s) in oVirt engine that will periodically fetch latest cluster configuration from GlusterFS and sync the same with the engine DB. Following changes done from gluster CLI should get reflected in the GUI:</p>

<ul>
  <li>volume created</li>
  <li>volume deleted</li>
  <li>volume started/stopped</li>
  <li>brick(s) added</li>
  <li>brick(s) removed</li>
  <li>brick(s) replaced</li>
  <li>new option set</li>
  <li>value of existing option changed</li>
  <li>option reset</li>
  <li>Server removed (peer detach)</li>
  <li>brick process went down / came up</li>
</ul>

<h4 id="key-considerations">Key considerations</h4>

<ul>
  <li>The background job(s) that perform(s) the syncing should be scheduled only if the Application is running in a mode that supports Gluster (vdc option ApplicationMode)</li>
  <li>Most of the data, except brick status is fetched using ‘gluster volume info’ command, which doesn’t add much overhead on the gluster processes, and hence can be executed more frequently. Brick status however, is fetched using ‘gluster volume status’ which adds a significant</li>
</ul>

<p>overhead, and hence must be executed less frequently. For this reason, there should be two separate jobs executed at two different frequencies, for fetching the ‘lightweight’ and ‘heavyweight’ data respectively.</p>

<ul>
  <li>The refresh rates for these two jobs should be configurable as VDC options, with names GlusterRefreshRateLight and GlusterRefreshRateHeavy, with default values of 5 seconds and 5 minutes respectively.</li>
  <li>Server removed from gluster CLI should be removed in engine DB only if it belongs to a ‘gluster-only’ cluster.</li>
  <li>Whenever a change is detected in the configuration and synced in the engine DB, an audit log should be generated with severity of “alert”, containing details of the change.</li>
</ul>

<h3 id="through-notifications">Through Notifications</h3>

<p>Handling of servers added (peer probed) from gluster CLI needs to be done in a different way, as addition of any server in engine requires user’s approval after verifying the SSH fingerprint. To achieve this, - Whenever a cluster is selected in the ‘clusters’ tab, asynchronously send a request to the server to identify if any servers have been added to it from gluster CLI - If yes, provide two links on the cluster general tab - one for adding the missing servers, another for selectively removing the unwanted ones.</p>

<h4 id="import">Import</h4>

<ul>
  <li>When User clicks on ‘import’ link, display a screen containing all newly added servers, along with their SSH fingerprints</li>
  <li>User should be able to edit the server names (not hostname/ip) and provide root password for all these servers</li>
  <li>After user accepts the servers, providing root passwords for all of them, add all of them to the cluster</li>
</ul>

<h4 id="detach">Detach</h4>

<ul>
  <li>When user clicks on the ‘detach’ link, display a screen containing all the additional servers</li>
  <li>User should be able to select one or more of these servers, and click on the ‘Ok’ button</li>
  <li>This should trigger a ‘gluster peer detach’ command to remove the selected servers from the gluster cluster</li>
</ul>

<h2 id="design">Design</h2>

<h3 id="glustermanager">GlusterManager</h3>

<p>This class will have methods that run periodically to sync information with GlusterFS.</p>

<p>refreshLightWeightData() : Runs more frequently and syncs information that can be fetched without much of an overhead on GlusterFS. This refresh rate is controlled by configuration “GlusterRefreshRateLight” , with default value of 5 seconds</p>

<p>getGlusterRefreshRateHeavy(): Runs less frequently and syncs information that adds a significant overhead on GlusterFS. This refresh rate is controlled by configuration “GlusterRefreshRateHeavy” , with default value of 5 minutes</p>

<h3 id="import-1">Import</h3>

<p><img src="/ovirt-site/previews/2869/images/wiki/Gluster-Sync-import.png" alt="" /></p>

<h3 id="detach-1">Detach</h3>

<p><img src="/ovirt-site/previews/2869/images/wiki/Gluster-Sync-detach.png" alt="" /></p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2869/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2869/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2869/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2869/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/gluster/gluster-sync-configuration-with-cli.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
