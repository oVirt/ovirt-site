<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MoveAsCopyAndDelete | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="MoveAsCopyAndDelete" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3185/develop/release-management/features/storage/moveascopyanddelete.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3185/develop/release-management/features/storage/moveascopyanddelete.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MoveAsCopyAndDelete" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"MoveAsCopyAndDelete","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3185/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3185/develop/release-management/features/storage/moveascopyanddelete.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3185/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3185/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3185/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3185/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3185/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3185/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3185/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3185/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3185/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3185/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3185/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3185//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3185/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8f07947836874690665b49430a562713?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8f07947836874690665b49430a562713?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Liron Aravot">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Liron Aravot</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3185/documentation/'>Documentation is available here.</a></div>

<h1 id="move-as-copy-and-delete">Move As Copy And Delete</h1>

<h2 id="move-operation-as-copy-and-delete">Move operation as copy and delete</h2>

<h3 id="summary">Summary</h3>

<p>A move operation is basically a copy to the destination domain, followed by a deletion from the source domain. Currently, when moving a disk in oVirt, the called vdsm verb is <code class="language-plaintext highlighter-rouge">moveImage</code> - which performs the entire operation (copy and delete). The fact that one verb is called for executing both of the operations causes to few issues that would be resolved/improved by this change:</p>

<ol>
  <li>
    <p>Increase availability - When moving an image and attempting to delete with wipe - the operation won’t wait for the deletion to complete, as it might take a long time although the image in the target domain is already “ready” for use (as the copy operation has been completed).</p>
  </li>
  <li>
    <p>In case of an error, the engine will be able to tell on which part of the “move” operation an error has occurred and react accordingly.</p>
  </li>
  <li>
    <p>Moving towards lowering the SPM involvement in the copy/move process.</p>
  </li>
  <li>
    <p>Move operation on vdsm should be deprecated.</p>
  </li>
</ol>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Liron Aravot (laravot)</li>
  <li>Email: <a href="mailto:laravot@redhat.com">laravot@redhat.com</a></li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>Released in oVirt 3.3, see <a href="http://gerrit.ovirt.org/#/c/13042">http://gerrit.ovirt.org/#/c/13042</a> for details</li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<ol>
  <li>
    <p>Add <code class="language-plaintext highlighter-rouge">MoveImageGroupCommand</code> - used for moving images, the execution part (a.k.a, the <code class="language-plaintext highlighter-rouge">execute()</code> method) contains a call to vdsm to copy the image to the target domain, while the end method executes a vdsm call for deletion of the unneeded image (in case of successful copy - the source image, in case of failure during the copy - the target image).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">MoveOrCopyImageGroupCommand</code> has been renamed to <code class="language-plaintext highlighter-rouge">CopyImageGroupCommand</code> and is being used now for copy only.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">moveImage</code> verb in vdsm is being executed from the engine with copy as its operation only (used for copy without collapsing snapshots).</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">RemoveImageCommand</code> has been changed to allow removal of image without performing DB modification (in case of performing move, the called delete on the end method is for storage “cleanup” and shouldn’t affect the db.</p>
  </li>
</ol>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>Ability to determine the state of the move operation, have faster operation when performing move with wipe (post zero).</p>

<h3 id="known-issues">Known issues</h3>

<ul>
  <li>The whole operation <em>might</em> be slower for moving image groups without wipe, as the delete part is quick (and now we will have two vdsm calls rather then one) - this issue is known and accepted.</li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3185/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3185/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3185/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3185/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/moveascopyanddelete.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/storage/moveascopyanddelete.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
