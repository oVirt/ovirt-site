<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MomVdsmSeparation | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="MomVdsmSeparation" />
<meta name="author" content="Francesco Romani" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2921/develop/developer-guide/vdsm/momvdsmseparation.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2921/develop/developer-guide/vdsm/momvdsmseparation.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MomVdsmSeparation" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Francesco Romani" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Francesco Romani"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"MomVdsmSeparation","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2921/images/logo.svg"},"name":"Francesco Romani"},"url":"https://ovirt.github.io/ovirt-site/previews/2921/develop/developer-guide/vdsm/momvdsmseparation.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2921/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2921/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2921/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2921/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2921/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2921/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2921/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2921/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2921/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2921/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2921/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2921/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2921/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2921/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2921/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2921/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2921/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2921/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2921/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2921/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2921/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2921/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2921//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2921//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2921/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2921/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2921/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2921/develop/developer-guide/vdsm/">
              <span property="name">Vdsm</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7054bd65a0f097bbc1e54f4652d59f8b?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7054bd65a0f097bbc1e54f4652d59f8b?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Francesco Romani</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Sivak</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="mom-vdsm-separation">Mom Vdsm Separation</h1>

<h2 id="starting-mom-as-a-separate-process-instead-of-vdsm-thread">Starting MOM as a separate process instead of VDSM thread</h2>

<h3 id="summary">Summary</h3>

<p>MOM is moving to be used as a standalone process again because of some VDSM performance issues caused by a number of threads.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Martin Sivak (Msivak)</li>
  <li>Email: <a href="mailto:msivak@redhat.com">msivak@redhat.com</a></li>
  <li>Name: Francesco Romani (fromani)</li>
  <li>Email: <a href="mailto:fromani@redhat.com">fromani@redhat.com</a></li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<h4 id="the-proposed-changes">The proposed changes</h4>

<ul>
  <li>The RPC port will be enabled in MOM</li>
  <li>MOM will be started using new systemd service (mom-vdsm) provided by VDSM</li>
  <li>the service file will also configure MOM to use the config files and policy dir provided by VDSM</li>
  <li>VDSM will use the RPC port to talk to MOM (UpdateMomPolicy)</li>
  <li>KsmTune command needs to be added to the VDSMâ€™s API</li>
  <li>MOM will use either XML-RPC or json-RPC to talk to VDSM</li>
  <li>MOM will cache the results of getAllVmStats instead of asking for stats per VM</li>
</ul>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>We expect a performance gain in both VDSM and MOM, due to the reduced pressure on the python GIL in both processes. Both processes will be further optimized. Running the two processes separately makes it easier to profile and to evaluate the performances of each one.</p>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>The separation requires MOM &gt;= TBD and VDSM &gt;= 4.17.0. Older version are not compatible with this feature.</p>

<h3 id="documentation--external-references">Documentation / External references</h3>

<p>Bugzilla entry: <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1227714">https://bugzilla.redhat.com/show_bug.cgi?id=1227714</a></p>

<h3 id="testing">Testing</h3>

<ul>
  <li>
    <p>non-regression: MOM as-process should provide the same functionality as MOM as-thread.</p>
  </li>
  <li>
    <p>resilience in presence of crashes: if MOM as-process restarts or is down for some time, VDSM should handle gracefully this event.</p>
  </li>
  <li>
    <p>reduced performance footprint (CPU): to be evaluated.</p>
  </li>
</ul>

<h3 id="contingency-plan">Contingency Plan</h3>

<p>We can tweak the config file (/etc/vdsm/mom.conf) values to use 15 second period for all loops. That provides a huge improvement on the test (120 CPUs) machine.</p>

<p>We want to ship mom as a separate process as new default in 3.6. However, old code will be kept, so it will be possible to run MOM as VDSM thread with manual configuration, obtaining the same behaviour as in oVirt 3.5.x.</p>

<p>Instructions to reconfigure MOM to run as VDSM thread will be provided on this page.</p>

<h3 id="release-notes">Release Notes</h3>

<p>TBD</p>





        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2921/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2921/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2921/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2921/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/vdsm/momvdsmseparation.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/developer-guide/vdsm/momvdsmseparation.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
