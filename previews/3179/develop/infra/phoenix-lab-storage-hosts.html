<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Phoenix Lab Storage Hosts | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Phoenix Lab Storage Hosts" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3179/develop/infra/phoenix-lab-storage-hosts.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3179/develop/infra/phoenix-lab-storage-hosts.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Phoenix Lab Storage Hosts" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Phoenix Lab Storage Hosts","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3179/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3179/develop/infra/phoenix-lab-storage-hosts.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3179/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3179/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3179/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3179/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3179/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3179/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3179/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3179/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3179/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3179/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3179/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3179/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3179/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3179/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3179/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3179/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class="masthead hidden-print" id="branding" role="banner"><section class="hgroup"></section><div id="access"><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3179/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3179/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li>
<li role="menuitem">  <a href="/ovirt-site/previews/3179/download/">Download</a>
</li>
<li role="menuitem">  <a href="/ovirt-site/previews/3179/documentation/">Documentation</a>
</li>
<li class="active" role="menuitem">  <a href="/ovirt-site/previews/3179/develop/">Developers</a>
</li>
<li role="menuitem">  <a href="/ovirt-site/previews/3179/community/">Community</a>
</li>
<li role="menuitem">  <a href="/ovirt-site/previews/3179//lists.ovirt.org/archives/">Forum</a>
</li>
<li role="menuitem">  <a href="/ovirt-site/previews/3179//blogs.ovirt.org/">Blog</a>
</li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3179/">
              <span property="name"></span>
              <meta property="position" content="1">
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3179/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2">
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3179/develop/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="3">
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img src="https://secure.gravatar.com/avatar/bcb2aef8cc1559485f70f69eed60b9bb?s=32&amp;d=mm&amp;r=g" srcset="https://secure.gravatar.com/avatar/bcb2aef8cc1559485f70f69eed60b9bb?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32" loading="lazy" alt="avatar of David">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">David</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class="alert alert-warning">Much of this developer documentation provides historical context but may not reflect the current state of the project.<br>If you see outdated content please navigate to the page footer and click "<strong>Report an issue on GitHub</strong>".<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href="/ovirt-site/previews/3179/documentation/">User Documentation is available here.</a>
</div>

<h1 id="phoenix-lab-storage-hosts">Phoenix Lab Storage Hosts</h1>

<p><strong>NOTE</strong>: for the latest version of this doc, see <a href="http://ovirt-infra-docs.readthedocs.org/en/latest/">http://ovirt-infra-docs.readthedocs.org/en/latest/</a></p>

<p>Currently we have two storage servers, both of them have a CentOS 6.5 installation on them.</p>

<h2 id="disk-configuration">Disk configuration</h2>

<p>The storage servers have a set of 6 disks in a RAID5</p>

<h2 id="storage-replication">Storage replication</h2>

<p>For the storage replication we are using <a href="http://www.drbd.org/users-guide/">DRBD</a>, it was required to install drbd84, and to do that on centos we had to use some special repos as itâ€™s been discontinued on the official repos. Here are the specific ones:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@ovirt-storage01 ~]# cat /etc/yum.repos.d/hacluster.repo
[haclustering]
name=HA Clustering
baseurl=http://download.opensuse.org/repositories/network:/ha-clustering:/Stable/CentOS_CentOS-6/
enabled=1
gpgcheck=0
</code></pre></div></div>

<p>You can check specifically the current status using the command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@ovirt-storage01 ~]# drbd-overview
0:ovirt_storage/0  Connected Primary/Secondary UpToDate/UpToDate C r----- /srv/ovirt_storage ext4 11T 563G 9.7T 6% 
</code></pre></div></div>

<p>The DRBD cluster is started/stopped by the pacemaker cluster, so no need to handle it, but sometimes when the cluster degenerates is required to manually choose which node has to be master and start the replication between the nodes. You can check the cdocumentation on how to fix that type of issues <a href="http://www.drbd.org/users-guide/ch-troubleshooting.html">here</a>.</p>

<h2 id="clustering">Clustering</h2>

<p>The clustering has been configured using crm and pacemaker. Here are a few tips on managing it:</p>

<p>To enter the management shell you can just type:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crm
</code></pre></div></div>

<p>From there you can see a list of available commands using <em>tab</em> completion.</p>

<p>To see the current status of the cluster you can use:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@ovirt-storage01 ~]# crm status
Last updated: Sat Nov  8 03:59:18 2014
Last change: Thu Jul 31 02:41:35 2014 via cibadmin on ovirt-storage01
Stack: cman
Current DC: ovirt-storage02 - partition with quorum
Version: 1.1.10-14.el6_5.3-368c726
2 Nodes configured
7 Resources configured

Online: [ ovirt-storage01 ovirt-storage02 ]

Master/Slave Set: ms_drbd_ovirt_storage [p_drbd_ovirt_storage]
    Masters: [ ovirt-storage01 ]
    Slaves: [ ovirt-storage02 ]
Resource Group: g_ovirt_storage
    p_fs_ovirt_storage  (ocf::heartbeat:Filesystem):    Started ovirt-storage01 
    p_ip_ovirt_storage  (ocf::heartbeat:IPaddr2):   Started ovirt-storage01 
    p_nfs_ovirt_storage (lsb:nfs):  Started ovirt-storage01
Clone Set: cl_exportfs_ovirt_storage [p_exportfs_ovirt_storage]
    Started: [ ovirt-storage01 ovirt-storage02 ]
</code></pre></div></div>

<h3 id="showingediting-the-config">Showing/editing the config</h3>

<p>To see and edit the configuration you have to enter the configuration space from the crm shell, for future reference hereâ€™s the output form the current config:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>crm(live)# cd configure
crm(lise)configure# show

node ovirt-storage01
node ovirt-storage02
primitive p_drbd_ovirt_storage ocf:linbit:drbd \
    params drbd_resource=ovirt_storage \
    op monitor interval=15 role=Master \
    op monitor interval=30 role=Slave
primitive p_exportfs_ovirt_storage exportfs \
    params fsid=0 directory="/srv/ovirt_storage" options="rw,mountpoint,no_root_squash" clientspec="66.187.230.0/255.255.255.192" \
    op monitor interval=30s \
    meta target-role=Started
primitive p_fs_ovirt_storage Filesystem \
    params device="/dev/drbd0" directory="/srv/ovirt_storage" fstype=ext4 \
    op monitor interval=10s \
    meta target-role=Started
primitive p_ip_ovirt_storage IPaddr2 \
    params ip=66.187.230.61 cidr_netmask=26 \
    op monitor interval=30s \
    meta target-role=Started
primitive p_nfs_ovirt_storage lsb:nfs \
    op monitor interval=30s \
    meta target-role=Started
group g_ovirt_storage p_fs_ovirt_storage p_ip_ovirt_storage \
    meta target-role=Started
ms ms_drbd_ovirt_storage p_drbd_ovirt_storage \
    meta master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true target-role=Started
clone cl_exportfs_ovirt_storage p_exportfs_ovirt_storage
location cli-prefer-ms_drbd_ovirt_storage ms_drbd_ovirt_storage role=Started inf: ovirt-storage01
colocation c_all_on_drbd inf: g_ovirt_storage ms_drbd_ovirt_storage:Master
colocation c_nfs_on_drbd inf: p_nfs_ovirt_storage ms_drbd_ovirt_storage:Master
colocation c_nfs_on_exportfs inf: g_ovirt_storage cl_exportfs_ovirt_storage
order o_drbd_first inf: ms_drbd_ovirt_storage:promote g_ovirt_storage:start
order o_exportfs_before_nfs inf: cl_exportfs_ovirt_storage g_ovirt_storage:start
property cib-bootstrap-options: \
    dc-version=1.1.10-14.el6_5.3-368c726 \
    cluster-infrastructure=cman \
    expected-quorum-votes=2 \
    stonith-enabled=false \
    no-quorum-policy=ignore \
    last-lrm-refresh=1404978312
</code></pre></div></div>

<h3 id="networkconfiguration">NetworkConfiguration</h3>

<p>The network is configured to use bonding on all interfaces using 802.3ad bonding protocol (requires special configuration on the switches).</p>

<p>Hereâ€™s the current configuration files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[root@ovirt-storage01 ~]# cat /etc/modprobe.d/bonding.conf
alias bond0 bonding
##mode=4 - 802.3ad   mode=6 - alb
options bond0 mode=4 miimon=100 lacp_rate=1

[root@ovirt-storage01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-em1
DEVICE="em1"
BOOTPROTO=none
HWADDR="F8:BC:12:3B:22:40"
NM_CONTROLLED="no"
ONBOOT="yes"
TYPE="Ethernet"
UUID="c0407968-795b-4fdb-9a43-3c70e4803c09"
SLAVE=yes
MASTER=bond0
USERCTL=no

[root@ovirt-storage01 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond0
DEVICE=bond0
IPADDR=66.187.230.1
NETWORK=66.187.230.0
NETMASK=255.255.255.192
BROADCAST=66.187.230.63
GATEWAY=66.187.230.62
USERCTL=no
BOOTPROTO=none
ONBOOT=yes
</code></pre></div></div>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3179/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class="text-center" id="footer"><hr class="visible-print">
<ul class="footer-nav-list">
<li><a href="/ovirt-site/previews/3179/privacy-policy.html" target="_blank" title="Privacy policy">Privacy policy</a></li>
<li><a href="/ovirt-site/previews/3179/community/about.html" target="_blank" title="About">About</a></li>
<li><a href="/ovirt-site/previews/3179/general-disclaimer.html" target="_blank" title="Disclaimers">Disclaimers</a></li>
</ul>Â© 2013â€“2024 oVirt<div class="edit-this-page"><a href="https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/infra/phoenix-lab-storage-hosts.html&amp;template=" target="_blank" title="Report an issue"><i class="icon fab fa-github"></i>Report an issue with this page</a></div>
<div class="edit-this-page"><a href="https://github.com/oVirt/ovirt-site/edit/main/source/develop/infra/phoenix-lab-storage-hosts.md" target="_blank" title="Edit this page"><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
