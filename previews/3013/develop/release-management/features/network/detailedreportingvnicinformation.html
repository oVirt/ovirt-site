<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>DetailedReportingVnicInformation | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="DetailedReportingVnicInformation" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3013/develop/release-management/features/network/detailedreportingvnicinformation.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3013/develop/release-management/features/network/detailedreportingvnicinformation.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="DetailedReportingVnicInformation" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"DetailedReportingVnicInformation","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3013/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3013/develop/release-management/features/network/detailedreportingvnicinformation.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3013/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3013/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3013/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3013/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3013/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3013/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3013/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3013/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3013/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3013/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3013/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3013/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3013/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3013/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3013/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3013/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3013/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3013/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3013/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3013/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3013/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3013/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3013//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3013//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3013/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3013/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3013/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3013/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3013/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Moti Asayag">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Moti Asayag</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3013/documentation/'>Documentation is available here.</a></div>

<h1 id="detailed-reporting-vnic-information">Detailed Reporting Vnic Information</h1>

<h2 id="reporting-vnic-information-reported-by-guest-agent-detailed-design">Reporting vNIC information reported by Guest Agent Detailed Design</h2>

<h3 id="summary">Summary</h3>

<p>The Guest Agent reports the vNic details:</p>

<ul>
  <li>IP addresses (both IPv4 and IPv6).</li>
  <li>vNic internal name</li>
</ul>

<p><a href="reportingvnicinformation.html">Reporting vNIC implementation reported by Guest Agent Feature Page</a></p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Moti Asayag</li>
  <li>Email: masayag@redhat.com</li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>Target Release: 3.2</li>
  <li>Status: Design</li>
  <li>Last updated date: Nov 12 2012</li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<p>The internal vNic implementation details are reported by VDSM by verbs <code class="language-plaintext highlighter-rouge">getVmStats</code> and <code class="language-plaintext highlighter-rouge">getAllVmStats</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">netIfaces</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">'name'</span><span class="p">:</span> <span class="s">'eth8'</span><span class="p">,</span>
        <span class="s">'inet6'</span><span class="p">:</span> <span class="p">[</span><span class="s">'fe80::21a:4aff:fe16:1ac'</span><span class="p">],</span>
        <span class="s">'inet'</span><span class="p">:</span> <span class="p">[</span><span class="s">'10.35.17.36'</span><span class="p">],</span>
        <span class="s">'hw'</span><span class="p">:</span> <span class="s">'00:1a:4a:16:01:ac'</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'name'</span><span class="p">:</span> <span class="s">'eth9'</span><span class="p">,</span>
        <span class="s">'inet6'</span><span class="p">:</span> <span class="p">[</span><span class="s">'fe80::21a:4aff:fe16:160'</span><span class="p">,</span><span class="s">'fe80::21a:4aff:fe16:161'</span><span class="p">],</span>
        <span class="s">'inet'</span><span class="p">:</span> <span class="p">[</span><span class="s">'10.35.1.254'</span><span class="p">],</span>
        <span class="s">'hw'</span><span class="p">:</span> <span class="s">'00:1a:4a:16:01:60'</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">'name'</span><span class="p">:</span> <span class="s">'eth7'</span><span class="p">,</span>
        <span class="s">'inet6'</span><span class="p">:</span> <span class="p">[</span><span class="s">'fe80::21a:4aff:fe16:1af'</span><span class="p">],</span>
        <span class="s">'inet'</span><span class="p">:</span> <span class="p">[</span><span class="s">'10.35.18.69'</span><span class="p">],</span>
        <span class="s">'hw'</span><span class="p">:</span> <span class="s">'00:1a:4a:16:01:af'</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>
<p>The vNic device data from the guest contains interface name, IPv4 addresses, IPv6 addresses and MAC Address.</p>

<h4 id="engine">Engine</h4>

<p><code class="language-plaintext highlighter-rouge">VM_GUEST_AGENT_INTERFACES</code> a new satellite table of vm, contains the vNic configuration reported by the guest agent</p>

<table class="bordered wikitable sortable">
  <thead>
    <tr>
      <th>Column Name</th>
      <th>Column Type</th>
      <th>Null? / Default</th>
      <th>Definition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>vm_id</td>
      <td>UUID</td>
      <td>not null</td>
      <td>The VM’s ID, <strong>foreign key</strong> to vm_static.vm_guid</td>
    </tr>
    <tr>
      <td>interface_name</td>
      <td>VARCHAR(50)</td>
      <td>null</td>
      <td>The vNic’s name within the VM</td>
    </tr>
    <tr>
      <td>mac_address</td>
      <td>VARCHAR(59)</td>
      <td>null</td>
      <td>The vNic’s MAC address within the VM</td>
    </tr>
    <tr>
      <td>ipv4_addresses</td>
      <td>text</td>
      <td>null</td>
      <td>The vNic’s IPv4 addresses</td>
    </tr>
    <tr>
      <td>ipv6_addresses</td>
      <td>text</td>
      <td>null</td>
      <td>The vNic’s IPv6 addresses</td>
    </tr>
  </tbody>
</table>

<p>The IP addresses columns might contain multiple addresses per vNic and will be stored concatenated by comma.
The table will be updated only when a change is detected by the reported data from VDSM.</p>

<p><code class="language-plaintext highlighter-rouge">VmGuestAgentInterface</code> a new class for representing the data reported by the guest agent:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Guid</span> <span class="n">vmId</span>   <span class="c1">// VM's ID</span>
<span class="nc">String</span> <span class="n">name</span> <span class="c1">// the internal nic's name</span>
<span class="nc">String</span> <span class="n">macAddress</span> <span class="c1">// the internal nic's macAddress</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ipv4Addresses</span> <span class="c1">// the vNic's IPv4 addresses</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ipv6Addresses</span> <span class="c1">// the vNic's IPv6 addresses</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">VmGuestAgentInterfaceDao</code> new DAO will serve as the interface of the <code class="language-plaintext highlighter-rouge">VmGuestAgentInterface</code> entity database related actions.
<code class="language-plaintext highlighter-rouge">VmGuestAgentInterface</code> is stored to the database only as part of refresh VMs.</p>

<h4 id="engine-flows">Engine Flows</h4>

<p><code class="language-plaintext highlighter-rouge">GetVmGuestAgentInterfacesForVmQuery</code> - A query to return the vNic’s data for a specific vm by the VM’s ID.</p>

<p><code class="language-plaintext highlighter-rouge">VdsUpdateRunTimeInfo.refreshVms</code> - will refresh the vnic’s data (as an optimization only if the data was changed). Update should be performed as a mass-operation.</p>

<ul>
  <li>
    <p>Populating the VMs IP addresses and VM guest agent interfaces is done by <code class="language-plaintext highlighter-rouge">getVmStats</code> and <code class="language-plaintext highlighter-rouge">getAllVmStats</code></p>
  </li>
  <li>
    <ul>
      <li>When the <code class="language-plaintext highlighter-rouge">netIfaces</code> element is reported by VDSM, it will be used both for populating the VM’s IP addresses list on <code class="language-plaintext highlighter-rouge">vm_dynamic(vm_ip)</code> as well as the vm guest agent interfaces.</li>
      <li>If <code class="language-plaintext highlighter-rouge">netIfaces</code> is not reported by VDSM (earlier VDSM versions), the VM’s IP addresses list will be populate by <code class="language-plaintext highlighter-rouge">guestIPs</code> as done today.</li>
    </ul>
  </li>
</ul>

<h4 id="rest-api">Rest API</h4>

<p>Populating the VM’s <code class="language-plaintext highlighter-rouge">network_devices</code> element under <code class="language-plaintext highlighter-rouge">guest_info</code> is implemented by mechanism introduced by <a href="http://gerrit.ovirt.org/#/c/9815">“All-Content Header” patch</a>
Rest API will invoke <code class="language-plaintext highlighter-rouge">GetVmGuestAgentInterfacesForVmQuery</code> from the <code class="language-plaintext highlighter-rouge">populate</code> method of VM Resource <code class="language-plaintext highlighter-rouge">BackendVmResource</code> in order to populate the additional information of guest_info.
A mapper should be created as well between <code class="language-plaintext highlighter-rouge">VmGuestAgentInterface</code> to the equivalent Rest API entity.</p>

<p>On <code class="language-plaintext highlighter-rouge">BackendVmNicResource</code>, the new properties of the <code class="language-plaintext highlighter-rouge">HostNic</code> (<code class="language-plaintext highlighter-rouge">interface_name</code>, <code class="language-plaintext highlighter-rouge">ipv4</code> and <code class="language-plaintext highlighter-rouge">ipv6</code>) will be populated by using same query to get relevant data if exists.</p>

<h4 id="ui">UI</h4>

<p>Changes should be made for both Admin-Portal and User-Portal.
The client will invoke <code class="language-plaintext highlighter-rouge">GetVmGuestAgentInterfacesForVmQuery</code> for getting the information and will map them on client side by MAC address
for matching the management vNic to the VM interface reported by the guest agent and populating the information on the VM Interface sub-tab.</p>

<h4 id="vdsm-api">VDSM API</h4>

<p>No changes for VDSM API.</p>

<h4 id="upgrade-db">Upgrade DB</h4>

<ol>
  <li>Add the new table <code class="language-plaintext highlighter-rouge">VM_GUEST_AGENT_INTERFACES</code> and related stored-procedure for save/update/delete/get.</li>
</ol>

<h3 id="dependencies--related-features-and-projects">Dependencies / Related Features and Projects</h3>

<h3 id="open-issues">Open Issues</h3>

<p>NA</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3013/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3013/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3013/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3013/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/detailedreportingvnicinformation.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/detailedreportingvnicinformation.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
