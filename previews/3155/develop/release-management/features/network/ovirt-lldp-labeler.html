<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>oVirt LLDP labeler | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="oVirt LLDP labeler" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3155/develop/release-management/features/network/ovirt-lldp-labeler.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3155/develop/release-management/features/network/ovirt-lldp-labeler.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="oVirt LLDP labeler" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"oVirt LLDP labeler","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3155/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3155/develop/release-management/features/network/ovirt-lldp-labeler.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3155/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3155/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3155/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3155/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3155/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3155/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3155/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3155/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3155/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3155/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3155/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3155/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3155/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3155/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3155/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3155/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3155/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3155/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3155/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3155/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3155/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3155/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3155//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3155//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3155/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3155/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3155/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3155/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3155/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ales Musil">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ales Musil</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3155/documentation/'>Documentation is available here.</a></div>

<h1 id="ovirt-lldp-labeler">oVirt LLDP labeler</h1>

<h2 id="summary">Summary</h2>

<p>oVirt LLDP labeler is a tool that utilizes LLDP support
added to oVirt in 4.2. The tool helps to some extent automate network 
configuration overhead in clusters that are managed by the labeler. 
It can be used as a separate service or as one-time tool using its cli.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Feature Owner: Ales Musil (amusil)</li>
  <li>E-mail: <a href="mailto:amusil@redhat.com">amusil@redhat.com</a></li>
</ul>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>The labeler is a service that is capable of helping the oVirt administrator
to automate some network related tasks. According to configuration reported 
via LLDP from peer switch, the labeler is capable of labeling host network 
interface or bond interfaces together.</p>

<h3 id="example-vlan-flow">Example VLAN flow</h3>

<p>Consider following scenario:</p>

<p>Engine contains logical network <code class="language-plaintext highlighter-rouge">vlan10</code> tagged as VLAN with id 10
and label <code class="language-plaintext highlighter-rouge">lldp_vlan_10</code>. Multiple hosts that have it’s <code class="language-plaintext highlighter-rouge">eth1</code> 
connected to switch with VLAN id 10 configured and LLDP reporting 
enabled for the interfaces connected to the hosts. To automatically 
connect our logical network <code class="language-plaintext highlighter-rouge">vlan10</code> with the <code class="language-plaintext highlighter-rouge">eth1</code> on every host,
the administrator just needs to configure and run the labeler:</p>

<p>First time setup:</p>

<p>1) Write username and password into <code class="language-plaintext highlighter-rouge">/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</code>
2) Write cluster name and API address into <code class="language-plaintext highlighter-rouge">/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-labeler.conf</code></p>

<p>Repeatable invocation:</p>

<p>1) Run the oVirt LLDP labeler by executing <code class="language-plaintext highlighter-rouge">python /usr/share/ovirt-lldp-labeler/ovirt_lldp_labeler_cli.py</code></p>

<p>After the labeler run, the hosts will automatically set a <code class="language-plaintext highlighter-rouge">lldp_vlan_10</code> 
label on top of the <code class="language-plaintext highlighter-rouge">eth1</code> interfaces, which results in the automatic 
connection of <code class="language-plaintext highlighter-rouge">eth1</code> with <code class="language-plaintext highlighter-rouge">vlan10</code> network, due to the matching label. 
This can be repeated every time a new host is added to the cluster, 
as well as for network changes within current hosts e.g. the switch 
port connection was switched between <code class="language-plaintext highlighter-rouge">eth1</code> and <code class="language-plaintext highlighter-rouge">eth2</code> on the host.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The labeler has to be capable of reaching the desired engine REST API and the 
<code class="language-plaintext highlighter-rouge">python-ovirt-engine-sdk4</code> in a version greater than <code class="language-plaintext highlighter-rouge">4.2</code> has to be installed.</p>

<h2 id="limitations">Limitations</h2>

<p>Currently, only Juniper switches support reporting of the needed parameters.
The required parameters are:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Port VLAN</code></li>
  <li><code class="language-plaintext highlighter-rouge">Link Aggregation</code></li>
</ul>

<h2 id="implementation">Implementation</h2>

<p>Overall architecture:
<img src="/ovirt-site/previews/3155/images/wiki/ovirt-lldp-labeler-architecture.png" alt="" /></p>

<h3 id="service">Service</h3>

<p>The labeler service is done through timers available in systemd. The timer calls
a target which executes the cli tool. The delay is one hour by default and can be 
changed in the timer specification.</p>

<h3 id="labeler">Labeler</h3>

<p>The tool itself is divided into two parts. The labeling part and the bonding 
part, each can be enabled or disabled in the configuration file.</p>

<p>Each step described below is done for each host, that is part of the cluster 
specified in the configuration file.</p>

<ul>
  <li>
    <p>The bonding part starts by fetching all LLDP available for interfaces that are 
not part of any existing bond already. The labeler is not trying to modify 
existing bonds, just to create new ones. The LLDP information is then searched 
for <code class="language-plaintext highlighter-rouge">Link Aggregation</code> capabilities. The interfaces, that are capable of 
aggregation, are grouped together by <code class="language-plaintext highlighter-rouge">Aggregation Link ID</code>. Before creating 
a bond, the interface with attached <code class="language-plaintext highlighter-rouge">ovirtmgmt</code> network is filtered out, as we 
don’t want to risk losing connectivity with the host. Also, rules about which 
networks can be attached to an interface are applied. After creating bond 
candidates the last step is to re-attach all networks from slaves to the bond 
candidate. All network configurations made by the labeler are marked as 
permanent so host restart won’t wipe them.</p>
  </li>
  <li>
    <p>The labeling part fetches LLDP from all non-VLAN interfaces and bond slaves.
The labeler search every interface LLDP information for <code class="language-plaintext highlighter-rouge">VLAN ID</code> tlvs. For 
every VLAN tlv, the labeler creates label candidate, in format of 
<code class="language-plaintext highlighter-rouge">lldp_vlan_$(VLAN-ID)</code>, where <code class="language-plaintext highlighter-rouge">$(VLAN-ID)</code> is substituted with VLAN id from 
the reported LLDP information. It is possible to have multiple VLAN on 
the interface, in this case, the interface ends up with multiple labels.</p>
  </li>
</ul>

<h2 id="configuration">Configuration</h2>

<p>The labeler consists of three main configuration files.
Full configuration documentation is available in the <a href="https://github.com/oVirt/ovirt-lldp-labeler/blob/master/README.adoc#configuration">project readme</a>.</p>

<p>First two files are usually located in <code class="language-plaintext highlighter-rouge">/etc/ovirt-lldp-labeler/conf.d/</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">ovirt-lldp-credentials.conf</code> contains login information to access the 
engine API. This file is restricted with permission 0600 to prevent any
unwanted access to the file.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">username</code> username for Engine</li>
  <li><code class="language-plaintext highlighter-rouge">password</code> password for Engine</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">ovirt-lldp-labeler.conf</code> contains basic configuration.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">clusters</code> list of clusters on top of which the labeler will run</li>
  <li><code class="language-plaintext highlighter-rouge">api_url</code> URL of the engine API</li>
  <li><code class="language-plaintext highlighter-rouge">ca_file</code> path to certficate that should be used for API access</li>
  <li><code class="language-plaintext highlighter-rouge">auto_bonding</code> switch to enable/disable auto bonding</li>
  <li><code class="language-plaintext highlighter-rouge">auto_labeling</code> switch to enable/disable auto labeling</li>
</ul>

<p>The last configuration file is the configuration of the systemd timer. It is usually
located in <code class="language-plaintext highlighter-rouge">/usr/lib/systemd/system/</code> and it is called 
<code class="language-plaintext highlighter-rouge">ovirt-lldp-labeler.timer</code>.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">OnUnitActiveSec</code> The timer delay for single labeler runs.</li>
</ul>

<h2 id="testing">Testing</h2>

<p>Run labeler under conditions below:</p>

<ul>
  <li>Auto bonding disabled</li>
  <li>Auto labeling disabled</li>
  <li>Auto bonding and labeling enabled at the same time</li>
  <li>On top of hosts with VLAN interfaces</li>
  <li>On top of hosts with interfaces, with disabled LLDP reporting</li>
</ul>

<p>Setup tests:</p>

<ul>
  <li>Installation</li>
  <li>Security - only the ovirt-lldp-credentials.conf owner should be able to 
read/write into the config</li>
  <li>Service timer</li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3155/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3155/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3155/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3155/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/ovirt-lldp-labeler.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/ovirt-lldp-labeler.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
