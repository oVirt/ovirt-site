<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>oVirtScheduler | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="oVirtScheduler" />
<meta name="author" content="Dan Kenigsberg" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2892/develop/release-management/features/sla/ovirtscheduler.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2892/develop/release-management/features/sla/ovirtscheduler.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="oVirtScheduler" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Dan Kenigsberg" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Dan Kenigsberg"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"oVirtScheduler","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2892/images/logo.svg"},"name":"Dan Kenigsberg"},"url":"https://ovirt.github.io/ovirt-site/previews/2892/develop/release-management/features/sla/ovirtscheduler.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2892/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2892/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2892/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2892/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2892/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2892/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2892/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2892/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2892/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2892/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2892/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2892/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2892/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2892/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2892/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2892/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2892/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2892/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2892/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2892/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2892/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2892/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2892//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2892//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2892/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2892/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2892/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2892/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2892/develop/release-management/features/sla/">
              <span property="name">Sla</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c1c090237aa1d976e9388542299a75f4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c1c090237aa1d976e9388542299a75f4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Doron Fediuck</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d23ba59f40f03f1390a8bbe87e4a8060?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d23ba59f40f03f1390a8bbe87e4a8060?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Gilad Chaplik</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Laszlo Hornyak</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2892/documentation/'>Documentation is available here.</a></div>

<h1 id="ovirt-scheduler">oVirt Scheduler</h1>

<h2 id="summary">Summary</h2>

<p>As oVirt is progressing and continue to gather features, there is an ever growing actual need for better scheduling: configurable,
customized and flexible, both in the programmatic and functionality levels.
It is known that the scheduling problem has NP-complete complexity, therefore there’s a need to optimize the problem solution,
to do that each scheduler implementation should focus on it’s own subjective needs. To accomplish that we propose to have a scheduling
API, in which the users can have their own private optimized schedulers by adding / modifying the default oVirt scheduler.
This page includes the high-level design for the new scheduling model.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Gilad Chaplik (gchaplik)</li>
  <li>Name: Doron Fediuck (Doron)
    <ul>
      <li>Email: <a href="mailto:dfediuck@redhat.com">dfediuck@redhat.com</a></li>
    </ul>
  </li>
</ul>

<h2 id="current-status">Current status</h2>

<p>Status: design</p>

<p>Last updated: ,</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<ul>
  <li>Allow others to integrate with oVirt’s Scheduler.</li>
  <li>Allow users to add their own scheduling logic.</li>
  <li>Should allow other languages (Python), run as script/dynamically.</li>
  <li>Load balancing policies can be overwritten.</li>
  <li>Provides internal modularity and boundaries.</li>
</ul>

<h2 id="description">Description</h2>

<h3 id="ovirt-scheduler-concepts">oVirt Scheduler concepts</h3>

<p>The new oVirt scheduler will use a process that gets a VM scheduling request, and will apply hard constraints
and soft constraints to get the optimal host for that request at this point of time.</p>

<ul>
  <li>Filter: a basic logic unit which filters out hypervisors who do not satisfy the hard constraints for placing a given VM.</li>
  <li>Cost function: a function that gives a score to a given host based on its internal logic. This is a way to implement soft constraints in the scheduling process.</li>
</ul>

<ol>
  <li>The scheduling process will take all relevant hosts and run them through the relevant filters
    <ol>
      <li>Note that from one filter to another the host number may decrease</li>
      <li>Filter order is meaningless</li>
    </ol>
  </li>
  <li>The filtered host list will then be used as an input to the relevant cost functions, which will create a cost table
    <ol>
      <li>The cost table indicates the host with the lowest cost, which is the optimal solution for the given request.</li>
      <li>Cost function results may be prioritized using a factor.</li>
    </ol>
  </li>
</ol>

<p><img src="/ovirt-site/previews/2892/images/wiki/Hosts.png" alt="" /></p>

<h3 id="load-balancing">Load Balancing</h3>

<p>Load balancing logic is a separate logic functionality based on the balancing policy.
The scheduler has a balance function that implements the policy. The internal load balancing
policies oVirt scheduler supports, are based on VM migration. However, any user may implement
a policy which balances the load base on taking a network-related action or even shutting down
a physical server.
So the key insight here, is that load balancing is a general term based on the load the user would like to handle.
Another key insight is the fact that scheduling is strongly related to balancing. The reason is that we would
like on going scheduling to work in synergy with the balancing policy. For example, there’s no point of placing
a VM on a host we would like to shutdown to save power (power saving policy), as this will force the balancing
logic to migrate this VM next time it runs.
The way to express the balancing-scheduling relation is by correlating both in the following way:
The balancing logic calculates over-utilized hosts based on the relevant policy. Then it can pick a VM
to be migrated from each overloaded host. Additionally, the same balancing logic can calculate the
under-utilized hosts. So once we know which VM(s) we want to migrate and where they should move to,
the process will run the standard scheduling process, using the VM balancing wants to move and the
under-utilized hosts. This is the only way to ensure we have no conflicts between scheduling and balancing.
Finally, it is important to understand that balancing can be also expressed by filters and / or cost function.
For example we can implement power saving policy by using a cost function that returns the number of VMs
running on every host. This will give hosts running many VMs a higher grade which most likely to be used
again. In this way every new VM will run on a host running other VMs, and every balancing iteration will migrate
VMs to hosts running more VMs. The end result is a few hosts running most of the VMs and hosts running no VMs
at all.</p>

<h3 id="using-external-code">Using external code</h3>

<p>The new design will be written in Java, but will allow users to add their own logic in Python.
This will allow users to use the Python SDK for Filters, Functions and Balancing. In order to achieve
that, the scheduling process needs to serialize parameters when calling the Python code. Past experience
demonstrated this is a heavy load operation. So in order to reduce the number of serializations, the oVirt
scheduler will have a Python proxy running the Python code, and the invocation to it will be done once for
every request.
So the expected flow is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     scheduling request -&gt; Scheduler
                                                     -&gt; Java Filtering process
                                                     -&gt; Python Filtering process
                                                     -&gt; Java cost process
                                                     -&gt; Python cost process
      &lt;- Scheduling response
</code></pre></div></div>

<p>For safety reasons the proxy will run the external code in a safe way to may sure it does not crash
if the external code crashes.
It is expected that multiple Python logic will delay the scheduling process. So if performance needed,
it’s adviced to add your logic in Java. Either way the scheduler will timeout if unable to satisfy a request
in a given time period. So readers should be aware of the implications of slowing down the scheduling
process.</p>

<p>Since internal filters and load balancers can run much faster, the engine will invoke all internal filters before any external filters.</p>

<h2 id="detailed-design">Detailed Design</h2>

<p>The specific API and design details can be found in the following page: <a href="/ovirt-site/previews/2892/develop/release-management/features/sla/ovirtschedulerapi.html">Features/oVirtSchedulerAPI</a></p>

<h2 id="references">References</h2>

<p>Some of the concepts in this design are related to the filter scheduler
<a href="https://web.archive.org/web/20140627062707/https://docs.openstack.org/trunk/config-reference/content/section_compute-scheduler.html">Nova Scheduler</a> is using.
The idea is to possibly allow logic and potentially some code sharing between these sub-projects,
even though both use different implementations and architectures.</p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2892/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2892/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2892/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2892/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/sla/ovirtscheduler.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/sla/ovirtscheduler.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
