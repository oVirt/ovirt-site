<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Provider Physical Network | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Provider Physical Network" />
<meta name="author" content="Petr Horáček" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2996/develop/release-management/features/network/provider-physical-network.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2996/develop/release-management/features/network/provider-physical-network.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Provider Physical Network" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Petr Horáček" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Petr Horáček"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Provider Physical Network","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2996/images/logo.svg"},"name":"Petr Horáček"},"url":"https://ovirt.github.io/ovirt-site/previews/2996/develop/release-management/features/network/provider-physical-network.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2996/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2996/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2996/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2996/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2996/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2996/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2996/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2996/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2996/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2996/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2996/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2996/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2996/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2996/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2996/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2996/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2996/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2996/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2996/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2996/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2996/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2996/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2996//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2996//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2996/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2996/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2996/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2996/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2996/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/262851154d9e06625593cbf205f180cf?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/262851154d9e06625593cbf205f180cf?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Petr Horáček">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Petr Horáček</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ales Musil">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ales Musil</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dominik Holler">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dominik Holler</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2996/documentation/'>Documentation is available here.</a></div>

<h1 id="provider-physical-network">Provider Physical Network</h1>

<h2 id="summary">Summary</h2>

<p>This feature extends <a href="/ovirt-site/previews/2996/develop/release-management/features/network/ovirt-ovn-provider.html">ovirt-ovn-provider</a> adding support for physical network access. It allows user to connect external OVN networks to a physical (oVirt native) network.</p>

<p>Feature progress is tracked on <a href="https://trello.com/b/lxIBEn0A/ovn-localnet">ovn-localnet Trello</a>. Related patches can be found on <a href="https://gerrit.ovirt.org/#/q/topic:localnet">gerrit topic:localnet</a>.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>
    <p>Name: <a href="https://github.com/almusil">Aleš Musil</a></p>
  </li>
  <li>
    <p>Email: <a href="mailto:amusil@redhat.com">amusil@redhat.com</a></p>
  </li>
</ul>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>This feature replaces OVS bridges networking in oVirt, later it will be extended with advanced OVN features. Physical network access will be required once NAT and routing are introduced to the OVN provider.</p>

<h2 id="usage">Usage</h2>

<h3 id="create-a-cluster-with-network-type-set-to-ovs">Create a cluster with Network Type set to OVS</h3>

<p>This feature requires Cluster enabled with Open vSwitch networking. Create a new Cluster with <code class="language-plaintext highlighter-rouge">Switch Type</code> set to <code class="language-plaintext highlighter-rouge">OVS (experimental)</code>. Please note, that used Hosts must not have any pre-existing oVirt networks (e.g. ovirtmgmt bridge).</p>

<h3 id="create-an-external-network-on-top-of-a-physical-network">Create an external network on top of a physical network</h3>

<p>There are several ways to use this feature.</p>

<ul>
  <li>
    <p><strong>Select physical network from data center networks.</strong> When creating a new external network, select <code class="language-plaintext highlighter-rouge">Data Center Network</code> in <code class="language-plaintext highlighter-rouge">Physical Network</code> section and pick the desired oVirt network from the drop down list. Note, that this network must be attached on all hosts in the cluster. Engine then uses the VDSM network name and VLAN ID from the selected network. This can also be done via REST API using <code class="language-plaintext highlighter-rouge">&lt;external_provider_physical_network id="123"/&gt;</code>, see <a href="http://ovirt.github.io/ovirt-engine-api-model/4.2/#types/network">ovirt-engine-api-model documentation</a>.</p>
  </li>
  <li>
    <p><strong>Create external network implicitly with physical network.</strong> To make this feature more exposed, we implicitly create a matching external OVN network for each new OVS based oVirt network marked as <code class="language-plaintext highlighter-rouge">VM Network</code>. However, there is no connection between them afterwards, they behave as separate units.</p>
  </li>
  <li>
    <p><strong>Attach external network via custom values in ManageIQ</strong>. This option is similar to the first one. In ManageIQ a user can set network type <code class="language-plaintext highlighter-rouge">flat</code> and specify physical network name (VDSM network name), in case physical network is on a VLAN, set type to <code class="language-plaintext highlighter-rouge">vlan</code> and specify VLAN ID as well.</p>
  </li>
</ul>

<p><img src="/ovirt-site/previews/2996/images/features/network/provider-physical-network_new-network-dialog-miq.png" alt="add an external network connected to a physical network ManageIQ dialog" /></p>

<ul>
  <li><strong>Select physical network via a custom physical network name and optional VLAN.</strong> This option is mostly for backward compatibility and for external providers that are not integrated with oVirt Data Center Networks as described in the first option. When creating a new external network, set <code class="language-plaintext highlighter-rouge">Physical Network</code> to physical network name, it will be passed to provider as <code class="language-plaintext highlighter-rouge">provider:physical_network</code>. If the physical network has VLAN tagging enabled, check <code class="language-plaintext highlighter-rouge">Enable VLAN tagging</code> and set the physical network’s tag there, it will be passed to provider as <code class="language-plaintext highlighter-rouge">provider:segmentation_id</code>. When VLAN is specified, <code class="language-plaintext highlighter-rouge">provider:network_type</code> is set to <code class="language-plaintext highlighter-rouge">vlan</code>, <code class="language-plaintext highlighter-rouge">flat</code> otherwise. In case a network name is longer than 15 characters or contains special characters, this option will not work with the OVN implementation, and using the first option is advised.</li>
</ul>

<p><img src="/ovirt-site/previews/2996/images/features/network/provider-physical-network_new-network-dialog-engine.png" alt="add an external network connected to a physical network Engine dialog" /></p>

<h3 id="attach-vm-to-the-external-network">Attach VM to the external network</h3>

<p>Finally add a new NIC to a VM and select a profile of an external network. L2 connectivity should be provided to the VM. In case there is a DHCP server running, the VM should obtain an IP.</p>

<h2 id="caveat">Caveat</h2>

<p>The user needs to make sure that the physical network used by the external network is available on the host used by the VM. There is currently now way for Engine to enforce it. The easiest way to accomplish this is to set physical provider network as required for the cluster.</p>

<h2 id="implementation">Implementation</h2>

<h3 id="openstack-neutron-api">OpenStack Neutron API</h3>

<p>OpenStack Neutron API used by Engine to control external providers already provides means to specify a physical network – attributes <code class="language-plaintext highlighter-rouge">provider:network_type</code>, <code class="language-plaintext highlighter-rouge">provider:physical_network</code> and <code class="language-plaintext highlighter-rouge">provider:segmentation_id</code>. The network types we use are <code class="language-plaintext highlighter-rouge">flat</code> and <code class="language-plaintext highlighter-rouge">vlan</code>. Physical network is matched by the VDSM network name. Segmentation ID is used with VLAN networks and matches the VLAN ID defined for the selected network.</p>

<h3 id="ovirt-provider-ovn">oVirt Provider OVN</h3>

<p>The provider reads the attributes described above. If the physical network is defined, the provider implicitly creates a <code class="language-plaintext highlighter-rouge">localnet</code> port on the given network and attaches it to the received physical network. In case a segmentation ID was passed, it uses it as the VLAN tag on the port.</p>

<h3 id="vdsm">VDSM</h3>

<p>Localnet port is attached to an abstract network name. This name is mapped to an OVS bridge name on each host via OVS DB attribute <code class="language-plaintext highlighter-rouge">external-ids:ovn-bridge-mappings</code>. This attribute is configured after each <code class="language-plaintext highlighter-rouge">setupNetworks</code> command and during upgrades (after reboot or upgrade of vdsm package).</p>

<h3 id="engine">Engine</h3>

<p>The <code class="language-plaintext highlighter-rouge">ProviderNetwork</code> object in Engine is extended with a link to its physical network (<code class="language-plaintext highlighter-rouge">Network</code>). In the database, <code class="language-plaintext highlighter-rouge">provider_physical_network_id</code> is added as a new column to <code class="language-plaintext highlighter-rouge">network</code> table.</p>

<p>Physical network is used to find the VDSM network name and the VLAN ID. These values are then passed to the network provider.</p>

<p>Engine also covers the validation:</p>

<ul>
  <li>Physical network must be on the same Data Center as the external network.</li>
  <li>The custom values (physical network and VLAN ID) must not be specified a when provider physical network is set.</li>
</ul>

<h3 id="import-of-a-provider-physical-network">Import of a provider physical network</h3>
<p>When importing a network with physical network access from an external network
provider into Engine, Engine must map this physical network to the corresponding
logical network in Engine.
If no corresponding logical network is found, the physical network is ignored
during import and synchronization.
The [external network provider][1] describes the physical network with three
attributes <code class="language-plaintext highlighter-rouge">provider:physical_network</code>, <code class="language-plaintext highlighter-rouge">provider:network_type</code> and
<code class="language-plaintext highlighter-rouge">provider:segmentation_id</code>.<br />
The corresponding logical network is detected by matching the three attributes:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">provider:physical_network</code> to [VDSM name][2] of the network</li>
  <li><code class="language-plaintext highlighter-rouge">provider:network_type</code> to the type of the network</li>
  <li><code class="language-plaintext highlighter-rouge">provider:segmentation_id</code> to the VLAN ID of the network</li>
</ul>

<h3 id="engine-ui">Engine UI</h3>

<p>Even without this feature, it is already possible to set the physical network name and VLAN ID for an external network from <code class="language-plaintext highlighter-rouge">New Network</code> dialog. Physical network has a separate field, and the VLAN is obtained from the shared <code class="language-plaintext highlighter-rouge">Network Attributes</code> section. However, this way requires the user to know the VDSM name of the network and manually copy the VLAN ID of the network</p>

<p>For better user experience, this feature exposes an option to select desired provider physical network from Data Center networks to UI.</p>

<p><img src="/ovirt-site/previews/2996/images/features/network/provider-physical-network_new-network-dialog.png" alt="add an external network connected to a physical network dialog" /></p>

<p>To expose this feature, an external OVN network is created implicitly when the user adds a new VM network on an OVS cluster. When selecting a network profile for a VM NIC, we list only external networks, not native oVirt networks that triggered their creation.</p>

<h3 id="rest-api">REST API</h3>

<p><code class="language-plaintext highlighter-rouge">Network</code> object in REST API is now extended with two new links:</p>

<p><code class="language-plaintext highlighter-rouge">&lt;external_provider id="123"/&gt;</code> points to an <code class="language-plaintext highlighter-rouge">OpenStackNetworkProvider</code>. If this link is specified, new network is defined on the selected provider. This mimics Engine UI <code class="language-plaintext highlighter-rouge">New Network</code> dialog with <code class="language-plaintext highlighter-rouge">Create on external provider</code> checked.</p>

<p><code class="language-plaintext highlighter-rouge">&lt;external_provider_physical_network id="123"/&gt;</code> points to a <code class="language-plaintext highlighter-rouge">Network</code>. This link is allowed only if <code class="language-plaintext highlighter-rouge">external_provider</code> is specified.</p>

<h2 id="packaging-and-installation">Packaging and installation</h2>

<p>This feature is integrated into 4.2 version of ovirt-provider-ovn, ovirt-engine and vdsm packages. The only extra requirement is to use Cluster with <code class="language-plaintext highlighter-rouge">Switch Type</code> set to <code class="language-plaintext highlighter-rouge">OVS</code>.</p>

<h2 id="testing">Testing</h2>

<p>Testing of this feature should cover:</p>

<ul>
  <li>Addition/removal of locally attached external network via all UI methods and via REST.</li>
  <li>VM connectivity to physical network, with both VLAN tagged and untagged networks.</li>
  <li>Live migration of VMs attached to external networks.</li>
  <li>In case OVS cluster was configured on 4.1 and only then upgraded to 4.2 (without any <code class="language-plaintext highlighter-rouge">setupNetworks</code> calls after the upgrade was done), previous tests should also pass.</li>
</ul>

<h2 id="external-references">External references</h2>

<p><a href="https://developer.openstack.org/api-ref/network/v2/#provider-extended-attributes">Provider Extended Attributes of Networks in OpenStack Networking API v2.0</a></p>

<p><a href="/ovirt-site/previews/2996/develop/release-management/features/network/unrestricted-network-names.html">Unrestricted Network Names</a></p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2996/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2996/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2996/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2996/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/provider-physical-network.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/provider-physical-network.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
