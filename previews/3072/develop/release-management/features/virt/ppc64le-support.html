<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ppc64le support | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="ppc64le support" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3072/develop/release-management/features/virt/ppc64le-support.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3072/develop/release-management/features/virt/ppc64le-support.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ppc64le support" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"ppc64le support","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3072/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3072/develop/release-management/features/virt/ppc64le-support.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3072/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3072/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3072/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3072/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3072/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3072/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3072/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3072/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3072/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3072/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3072/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3072/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3072/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3072/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3072/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3072/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3072/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3072/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3072/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3072/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3072/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3072/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3072//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3072//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3072/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3072/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3072/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3072/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3072/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ae1cdbedb9e9b2211596267db7af9a2c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ae1cdbedb9e9b2211596267db7af9a2c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Martin Polednik">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Polednik</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3072/documentation/'>Documentation is available here.</a></div>

<h1 id="ppc64le-support">ppc64le Support</h1>

<h2 id="summary">Summary</h2>

<p>This feature adds full support for ppc64le platform. Most of the requirements are already implemented by <a href="/ovirt-site/previews/3072/develop/release-management/features/virt/for-ppc64.html">VDSM’s support</a>.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>name: Martin Polednik (Martin Polednik)</li>
</ul>

<h2 id="current-status">Current Status</h2>

<ul>
  <li>Released in oVirt 3.6</li>
</ul>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>ppc64le machine - currently supported is POWER8</li>
  <li>RHEL 7.2 (ppc64le)</li>
</ul>

<h2 id="differences-between-ppc64le-and-x86_64">Differences Between ppc64le and x86_64</h2>

<p>Most of the differences are already solved by lower components of the stack. That said, there are several details that are not abstracted at all. In order to overcome these issues, VDSM must take care of gathering the information from sources relevant for the platform and Engine must use them adequately.</p>

<h3 id="hardware-info">Hardware Info</h3>

<h4 id="device-tree">Device Tree</h4>

<p>First difference is hardware information. On x86_64, we use <code class="language-plaintext highlighter-rouge">dmidecode</code> to read the low level system information. POWER8 lacks DMI table at all, but another structure - device tree - is used. There are several keys in our info structure, such as <code class="language-plaintext highlighter-rouge">system-id</code>, <code class="language-plaintext highlighter-rouge">model-name</code> and <code class="language-plaintext highlighter-rouge">vendor</code>. Using device-tree to obtain them is possibly via <code class="language-plaintext highlighter-rouge">procfs</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat /proc/device-tree/system-id</span>
&lt;value&gt;
<span class="c"># cat /proc/device-tree/model-name</span>
IBM Power System S822L
<span class="c"># cat /proc/device-tree/vendor</span>
IBM
</code></pre></div></div>

<p>Similar information found in <code class="language-plaintext highlighter-rouge">dmidecode</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Handle 0x0001, DMI type 1, 27 bytes
System Information
        Manufacturer: HP
        Product Name: ProLiant DL160 G6
        Version:
        Serial Number: &lt;value&gt;
        UUID: &lt;value&gt;
        Wake-up Type: Power Switch
        SKU Number: &lt;value&gt;
        Family:
</code></pre></div></div>

<h4 id="different-cpuinfo-format">Different cpuinfo Format</h4>

<p>The fields in cpuinfo have different values. Following table displays how x86_64 fields map to ppc64le fields.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'flags'      -&gt; __not there __
'cpu MHz'    -&gt; 'clock'
'model name' -&gt; 'cpu'
</code></pre></div></div>

<h4 id="cpu-flags">Cpu Flags</h4>

<p>Libvirt uses notion of baseline CPUs for x86_64, meaning that the model of CPU is mapped by it’s flags to a closest baseline subset of these flags. This does not apply for ppc64le where no flags are reported. Since there are data passed in the flags field other then flags (supported baseline CPUs), we use an arbitrary flag <code class="language-plaintext highlighter-rouge">powernv</code>. The machine type is then read from libvirt’s capabilities XML in a same way as on x86_64.</p>

<h3 id="machine-type-differences">Machine Type Differences</h3>

<h4 id="graphics">Graphics</h4>

<p>Various constraints must be considered when launching ppc64le VM. Most notably the SPICE is not supported, therefore VNC (with virtio-vga video) must be used.</p>

<h4 id="cpu">CPU</h4>

<p>The libvirt CPU format for ppc64le is quite different from ppc64le. Relevant information is that POWER8 is a magic constant in qemu, meaning ‘select the most appropriate CPU for the host’. This is achieved by following XML. Also note that this mode currently allows migration between POWER8 hosts in the same cluster.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cpu&gt;</span>
    <span class="nt">&lt;model&gt;</span>POWER8<span class="nt">&lt;/model&gt;</span>
<span class="nt">&lt;/cpu&gt;</span>
</code></pre></div></div>

<p>Using host-model is reserved for POWER compatibility modes. These are not used within VDSM.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cpu</span> <span class="na">mode=</span><span class="s">"host-model"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;model&gt;</span>POWER7<span class="nt">&lt;/model&gt;</span>
<span class="nt">&lt;/cpu&gt;</span>
</code></pre></div></div>

<h4 id="input">Input</h4>

<p>ppc64le uses USB instead of PS2 for mouse. Since the preferred way of interacting with VM is using absolute pointing device (tablet) that is USB on both platforms, this is mostly a fallback.</p>

<h4 id="smbios">SMBIOS</h4>

<p>Not relevant for ppc64le at all.</p>

<h2 id="updating-firmware-from-the-os">Updating firmware from the OS</h2>

<p>The following instructions are taken from <a href="https://www.ibm.com/developerworks/community/wikis/home?lang=en#!/wiki/W51a7ffcf4dfd_4b40_9d82_446ebc23c550/page/Updating%20firmware%20on%20a%20Power%20system%20running%20Ubuntu">IBM’s public wiki</a>. This manual covers update from inside of the OS, no HMC or any other tools available.</p>

<ul>
  <li>1) Determine the model, serial number and firmware version(?) of the machine.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># cat /proc/cpuinfo  | grep model</span>
model           : 8247-22L

<span class="c"># cat /proc/device-tree/system-id</span>
&lt;serial number&gt;

<span class="c"># lsmcode | awk '{print $6}'</span>
FW810.33
</code></pre></div></div>

<ul>
  <li>2) Enter the information obtained in 1) at <a href="http://www-933.ibm.com/support/fixcentral/">http://www-933.ibm.com/support/fixcentral/</a> and download the firmware version requested. The only required part is the rpm.</li>
  <li>3) Install the rpm. The firmware image can be located at <code class="language-plaintext highlighter-rouge">/tmp/fwupdate</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># rpm -Uvh --ignoreos 01SV810_133_081.rpm</span>

Preparing...                          <span class="c">################################# [100%]</span>
Updating / installing...
   1:01SV810_133_081-1.1-1            <span class="c">################################# [100%]</span>
</code></pre></div></div>

<ul>
  <li>4) Verify the firmware.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># update_flash -v -f /tmp/fwupdate/01SV810_133_081.img</span>
info: Current Temporary side will be committed to
Permanent side before being replaced with the new
image.

Projected Flash Update Results:
Current T Image: SV810_133
Current P Image: SV810_081
New T Image:     SV810_133
New P Image:     SV810_133
</code></pre></div></div>

<ul>
  <li>5) If everything seems correct, update the firmware.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># update_flash -f /tmp/fwupdate/01SV810_133_081.img</span>
</code></pre></div></div>

<ul>
  <li>6) The script will reboot the machine and update the firmware. Do not do anything, wait for the process to finish.</li>
  <li>7) The system will eventually boot up. After using it with the new firmware, decide whether to move the image to permanent firmware memory (erasing the previous version).</li>
</ul>

<p>To move from temporary to permanent memory: <code class="language-plaintext highlighter-rouge">update_flash -c</code><br />
To revert the temporary flash update: <code class="language-plaintext highlighter-rouge">update_flash -r</code></p>

<h2 id="fakekvm--faqemu">FakeKVM / faqemu</h2>

<p>There are few issues with FakeKVM. Faqemu should work fine. TBD: fakearch to fix these.</p>

<h2 id="final-goal">Final Goal</h2>

<p>Allow users to use POWER8 in oVirt with only minimal differences to x86_64.</p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3072/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3072/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3072/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3072/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/ppc64le-support.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/virt/ppc64le-support.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
