<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>NetworkPermissions | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="NetworkPermissions" />
<meta name="author" content="Dan Kenigsberg" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/networkpermissions.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/networkpermissions.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NetworkPermissions" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Dan Kenigsberg" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Dan Kenigsberg"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"NetworkPermissions","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3192/images/logo.svg"},"name":"Dan Kenigsberg"},"url":"https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/networkpermissions.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3192/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3192/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3192/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3192/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3192/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3192/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3192/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3192/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3192/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dan Kenigsberg">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Livnat Peer">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Livnat Peer</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Moti Asayag">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Moti Asayag</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3192/documentation/'>Documentation is available here.</a></div>

<h1 id="network-permissions">Network Permissions</h1>

<h2 id="summary">Summary</h2>

<p>The Network Permissions feature is supplementary for network related actions in the system.
It enables permissions management on a Network to control which user is allowed to perform what action when it relates to network.
Please refer to <a href="/ovirt-site/previews/3192/develop/developer-guide/action-permissions-overview.html">Action Permissions overview</a> for further information about Multi-Level-Administration (MLA).</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Moti Asayag</li>
  <li>Email: masayag@redhat.com</li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Status: Design Stage</li>
  <li>Last updated date: Tue Oct 23 2012</li>
</ul>

<h2 id="high-level-feature-description">High Level Feature Description</h2>

<h3 id="admin">Admin</h3>

<ul>
  <li>For creating a network in a DC you need to be <strong>SuperUser</strong> or <strong>DataCenterAdmin</strong> or <strong>NetworkAdmin</strong> on the DC.</li>
  <li>After creating the network you can manipulate the network if you are a <strong>DataCenterAdmin</strong> or <strong>NetworkAdmin</strong> on the relevant network (or the whole DC).</li>
  <li>For attaching the network to cluster user needs to be <strong>NetworkAdmin</strong> on the network (no requirement to have permission on the cluster)</li>
  <li><strong>ClusterAdmin</strong> cannot attach/detach a network from the cluster, the motivation for this is that as long as the network is not attached to the cluster it is not part of the cluster resources thus can not be managed by the cluster administrator.
    <ul>
      <li>The <strong>ClusterAdmin</strong> can change a network from required to non-required for controlling the impact of the network within the cluster.</li>
    </ul>
  </li>
  <li>For setting or manipulating a network on the host you need to be host administrator on the host and you don’t need to be network administrator.</li>
</ul>

<h3 id="user">User</h3>

<ul>
  <li>For attaching a network to a Vnic in the VM you need to have the role of <strong>NetworkUser</strong> on the network and <strong>UserVmManager</strong> on the VM.</li>
  <li>In user portal - the list of shown network for a user will include only the list of networks the user is allowed to attach to its vnics (instead of all cluster’s networks) or those which are currently attached to its VM.</li>
  <li>In RESTFul API the user will be able to see the networks which he has permissions on or those which are attached to its VM.</li>
</ul>

<h4 id="port-mirroring">Port-mirroring</h4>

<ul>
  <li>For configuring in the VM port mirroring you need to have the role of <strong>NetworkAdmin</strong> on the network and <strong>UserVmManager</strong> on the VM.</li>
</ul>

<h2 id="detailed-design">Detailed Design</h2>

<p>The following section describes the permissions on Network entities.</p>

<h3 id="networks-actions">Network’s Actions</h3>

<p>The <strong>existing Action Groups</strong> and their associated Actions:</p>

<ul>
  <li>CONFIGURE_STORAGE_POOL_NETWORK (admin role, requires permissions on VdcObjectType.StoragePool) for actions:
    <ul>
      <li>AddNetwork</li>
      <li>RemoveNetwork</li>
      <li>UpdateNetwork</li>
    </ul>
  </li>
  <li>CONFIGURE_CLUSTER_NETWORK (admin role, on VdcObjectType.VdsGroups) for actions:
    <ul>
      <li>AttachNetworkToVdsGroup</li>
      <li>DetachNetworkToVdsGroup</li>
      <li>UpdateNetworkOnCluster</li>
    </ul>
  </li>
  <li>EDIT_CLUSTER_CONFIGURATION (admin role, on VdcObjectType.VdsGroups) for actions:
    <ul>
      <li>UpdateDisplayToVdsGroup - deprecated.</li>
    </ul>
  </li>
  <li>CONFIGURE_HOST_NETWORK (admin role, on VdcObjectType.VDS) for actions:
    <ul>
      <li>SetupNetworks</li>
      <li>AddBond</li>
      <li>RemoveBond</li>
      <li>AttachNetworkToVdsInterface</li>
      <li>DetachNetworkFromVdsInterface</li>
      <li>UpdateNetworkToVdsInterface</li>
      <li>CommitNetworkChanges</li>
    </ul>
  </li>
  <li>CONFIGURE_VM_NETWORK (user role, on VdcObjectType.VM) for actions:
    <ul>
      <li>ActivateDeactivateVmNic</li>
      <li>AddVmInterface</li>
      <li>RemoveVmInterface</li>
      <li>UpdateVmInterface</li>
    </ul>
  </li>
  <li>CONFIGURE_TEMPLATE_NETWORK (user role, on VdcObjectType.VmTemplate) for actions:
    <ul>
      <li>AddVmTemplateInterface</li>
      <li>RemoveVmTemplateInterface</li>
      <li>UpdateVmTemplateInterface</li>
    </ul>
  </li>
  <li>PORT_MIRRORING (admin role, on VdcObjectType.VmInterface) for actions:
    <ul>
      <li>AddVmInterface</li>
      <li>UpdateVmInterface</li>
    </ul>
  </li>
</ul>

<p><strong>VmInterface</strong> entity is defined and in use for Port Mirroring.</p>

<h4 id="new-action-groups">New Action Groups</h4>

<ul>
  <li><strong>ASSIGN_CLUSTER_NETWORK</strong> (admin role, on VdcObjectType.Network) will be defined for actions:
    <ul>
      <li>AttachNetworkToVdsGroup</li>
      <li>DetachNetworkToVdsGroup</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li><strong>CREATE_STORAGE_POOL_NETWORK</strong> (admin role, on VdcObjectType.StoragePool) will be defined for actions:
    <ul>
      <li>AddNetworkCommand</li>
    </ul>
  </li>
  <li><strong>DELETE_STORAGE_POOL_NETWORK</strong> (admin role, on VdcObjectType.Network) will be defined for actions:
    <ul>
      <li>UpdateNetworkCommand</li>
    </ul>
  </li>
</ul>

<h3 id="roles-and-action-groups">Roles and Action Groups</h3>

<h4 id="new-roles">New Roles</h4>

<ul>
  <li><strong>NetworkUser</strong> a new user role to be associated with the following groups: CONFIGURE_VM_NETWORK and CONFIGURE_TEMPLATE_NETWORK.
    <ul>
      <li>It should allow the user to create vnics attached to the subjected network or to update an existing vnic network.</li>
    </ul>
  </li>
</ul>

<h4 id="updated-roles">Updated Roles</h4>

<ul>
  <li><strong>NetworkAdmin</strong> is currently attached to groups MANIPUTLATE_HOST, CONFIGURE_HOST_NETWORK and CONFIGURE_CLUSTER_NETWORK. It will be changed as follow:
    <ul>
      <li>Removed action groups:
        <ul>
          <li>MANIPUTLATE_HOST - it has nothing to do with networking, therefore should be omitted from the aforementioned list.</li>
        </ul>
      </li>
      <li>Added action groups:
        <ul>
          <li>CREATE_STORAGE_POOL_NETWORK - to allow add networks to the Data-Center.</li>
          <li>DELETE_STORAGE_POOL_NETWORK - to allow remove networks from the Data-Center.</li>
          <li>CONFIGURE_STORAGE_POOL_NETWORK - to allow update networks of the Data-Center.</li>
          <li>ASSIGN_CLUSTER_NETWORK - new action group for attach/detach network from cluster.</li>
        </ul>
      </li>
      <li>Attaching a network to host’s nic will not require permission on the attached network, rather on the host only.</li>
      <li>PORT_MIRRORING - allows to define a network as port-mirroring</li>
    </ul>
  </li>
</ul>

<h4 id="updated-action-groups">Updated Action Groups</h4>

<ul>
  <li><strong>PORT_MIRRORING</strong> should require permissions on both the Vm and the target Network.
    <ul>
      <li>Required permissions:
        <ul>
          <li>Permission on the network with PORT_MIRRORING action group.</li>
          <li>Permission on the VM with CONFIGURE_VM_NETWORK action group.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li><strong>CONFIGURE_CLUSTER_NETWORK</strong> (admin role, on VdcObjectType.VdsGroups) will be restricted for action:
    <ul>
      <li>UpdateNetworkOnCluster - since ClusterAdmin is not allowed to control the Network resource.</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li><strong>SUPER_USER</strong> is extended to include <strong>ASSIGN_CLUSTER_NETWORK</strong>.</li>
  <li><strong>DATA_CENTER_ADMIN</strong> is extended to include <strong>ASSIGN_CLUSTER_NETWORK</strong>.</li>
</ul>

<h4 id="updated-entities-hierarchy">Updated Entities Hierarchy</h4>

<p>A new <strong>Network</strong> entity will be added as a child of <strong>Data-Center</strong>
 cleanup:
The <strong>VmInterface</strong> should be removed from the the hierarchy.
It is not in used today and we see no reason to keep it around.</p>

<h3 id="db-changes">DB Changes</h3>

<p>Modify create_functions.sql:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   Add support for Network to `*`fn_get_entity_parents`*` stored-procedure.
   Add support for Network to `*`fn_get_entity_name`*` stored-procedure.
   Remove VmInterface from `*`fn_get_entity_name`*` and `*`fn_get_entity_parents`*` stored-procedure.
</code></pre></div></div>

<p>Add new view:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   user_network_permissions_view
   A join of users to networks which the user has a permission on, united with permissions a user have for the Data-Center.
</code></pre></div></div>

<h4 id="updated-queries">Updated Queries</h4>

<p>The following queries will be modified to be filtered by the user:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  GetAllNetworksByClusterIdQuery - when filter is set the query returns the networks that the User has permission on or attached to the User's VM.
</code></pre></div></div>

<h4 id="upgrade-db">Upgrade DB</h4>

<p>DB Upgrade should handle the following:</p>

<ul>
  <li>Permissions on VmNetworkInterface should be deleted from the setup (if any).</li>
  <li>Permission on Data Center with PORT_MIRRORING action group will be replaced with:
    <ul>
      <li>Permission on All the networks in the DC with PORT_MIRRORING action group.</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li>Permission with <strong>NetworkUser</strong> role will be granted to ‘everyone’ for each network in the system.</li>
</ul>

<p>bug fix:
Remove MANIPUTLATE_HOST action group from NetworkAdmin role.</p>

<h3 id="ui-changes">UI Changes</h3>

<p>Add Permissions sub-tab under Networks main tab
Add Network as an entity of both User/Admin role dialog.
<img src="/ovirt-site/previews/3192/images/wiki/Network-permissions-dialog.png" alt="" /></p>

<p>Add Network User role to Roles Tree in:</p>

<p><em><code class="language-plaintext highlighter-rouge">frontend/webadmin/modules/uicommonweb/src/main/java/org/ovirt/engine/ui/uicommonweb/models/configure/roles_ui/RoleTreeView.java</code></em>
<em><code class="language-plaintext highlighter-rouge">frontend/webadmin/modules/uicompat/src/main/java/org/ovirt/engine/ui/uicompat/Enums.java</code></em>
<em><code class="language-plaintext highlighter-rouge">frontend/webadmin/modules/uicompat/src/main/resources/org/ovirt/engine/ui/uicompat/Enums.properties</code></em></p>

<p>On ‘New Logical Network’ dialog a new option will be added as check box with message: “Allow all users to use this Network”
Checking this option will grant ‘everyone’ permissions of the created network with ‘VmNetworkUser’ role.</p>

<p>User Portal should be modified to use the updated query.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Permission management for Networks enhances the Network functionality, provides flexibility to users and protects it from misuse.
Granting permissions on Network to user is done via the Administrator Portal or using RESTful API.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<p>The Network Permissions is dependent on the following features:</p>

<ul>
  <li>Network Main Tab</li>
</ul>

<p>Affected oVirt projects:</p>

<ul>
  <li>Engine-core</li>
  <li>Admin Portal</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3192/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3192/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3192/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3192/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/networkpermissions.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/networkpermissions.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
