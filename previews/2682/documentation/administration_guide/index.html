<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Administration Guide | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Administration Guide" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2682/documentation/administration_guide/" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2682/documentation/administration_guide/" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Administration Guide" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2682/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Administration Guide","url":"https://ovirt.github.io/ovirt-site/previews/2682/documentation/administration_guide/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2682/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2682/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2682/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2682/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2682/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2682/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2682/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2682/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2682/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2682/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2682/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2682/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2682/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2682/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2682/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2682/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2682/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2682/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2682/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2682/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2682/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2682/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2682/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2682/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2682/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2682/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2682/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2682/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2682/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2682/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2682/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2682/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2682/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2682/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2682/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2682//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2682//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2682/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2682/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#part-Administering_and_Maintaining_the_Red_Hat_Virtualization_Environment">Administering and Maintaining the oVirt Environment</a>
<ul class="sectlevel1">
<li><a href="#chap-Global_Configuration">1. Global Configuration</a>
<ul class="sectlevel2">
<li><a href="#sect-Roles">1.1. Roles</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_new_role">1.1.1. Creating a New Role</a></li>
<li><a href="#Editing_a_role">1.1.2. Editing or Copying a Role</a></li>
<li><a href="#Authorization_examples">1.1.3. User Role and Authorization Examples</a></li>
</ul>
</li>
<li><a href="#sect-System_Permissions">1.2. System Permissions</a>
<ul class="sectlevel3">
<li><a href="#User_properties">1.2.1. User Properties</a></li>
<li><a href="#User_properties_roles">1.2.2. User and Administrator Roles</a></li>
<li><a href="#User_Roles_Explained">1.2.3. User Roles Explained</a></li>
<li><a href="#Administrator_Roles_Explained">1.2.4. Administrator Roles Explained</a></li>
<li><a href="#Assigning_an_Administrator_or_User_Role_to_a_Resource">1.2.5. Assigning an Administrator or User Role to a Resource</a></li>
<li><a href="#Removing_an_Administrator_or_User_Role_from_a_Resource">1.2.6. Removing an Administrator or User Role from a Resource</a></li>
<li><a href="#Data_center_system_permissions">1.2.7. Managing System Permissions for a Data Center</a></li>
<li><a href="#Data_center_permissions_entities">1.2.8. Data Center Administrator Roles Explained</a></li>
<li><a href="#Managing_system_permissions_for_a_cluster">1.2.9. Managing System Permissions for a Cluster</a></li>
<li><a href="#Cluster_permissions_entities">1.2.10. Cluster Administrator Roles Explained</a></li>
<li><a href="#Managing_System_Permissions_for_a_Network">1.2.11. Managing System Permissions for a Network</a></li>
<li><a href="#Network_Administrator_and_User_Roles_Explained">1.2.12. Network Administrator and User Roles Explained</a></li>
<li><a href="#To_view_hosts_in_a_cluster">1.2.13. Managing System Permissions for a Host</a></li>
<li><a href="#To_view_virtual_machines_in_a_cluster">1.2.14. Host Administrator Roles Explained</a></li>
<li><a href="#Cluster_hosts_entities">1.2.15. Managing System Permissions for a Storage Domain</a></li>
<li><a href="#Cluster_virtual_machine_entities">1.2.16. Storage Administrator Roles Explained</a></li>
<li><a href="#Data_center_logical_network_entities">1.2.17. Managing System Permissions for a Virtual Machine Pool</a></li>
<li><a href="#Cluster_logical_network_entities">1.2.18. Virtual Machine Pool Administrator Roles Explained</a></li>
<li><a href="#Managing_System_Permissions_for_a_Virtual_Disk">1.2.19. Managing System Permissions for a Virtual Disk</a></li>
<li><a href="#Virtual_Disk_User_Roles_Explained">1.2.20. Virtual Disk User Roles Explained</a></li>
<li><a href="#Setting_Legacy_SPICE_Cipher_system_permissions">1.2.21. Setting a Legacy SPICE Cipher</a></li>
</ul>
</li>
<li><a href="#sect-Scheduling_Policies">1.3. Scheduling Policies</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_Scheduling_Policy">1.3.1. Creating a Scheduling Policy</a></li>
<li><a href="#Explanation_of_Settings_in_the_New_Scheduling_Policy_and_Edit_Scheduling_Policy_Window">1.3.2. Explanation of Settings in the New Scheduling Policy and Edit Scheduling Policy Window</a></li>
</ul>
</li>
<li><a href="#sect-Instance_Types">1.4. Instance Types</a>
<ul class="sectlevel3">
<li><a href="#Creating_Instance_Types">1.4.1. Creating Instance Types</a></li>
<li><a href="#Editing_Instance_Types">1.4.2. Editing Instance Types</a></li>
<li><a href="#Removing_Instance_Types">1.4.3. Removing Instance Types</a></li>
</ul>
</li>
<li><a href="#sect-MAC_Address_Pools">1.5. MAC Address Pools</a>
<ul class="sectlevel3">
<li><a href="#Creating_MAC_Address_Pools">1.5.1. Creating MAC Address Pools</a></li>
<li><a href="#Editing_MAC_Address_Pools">1.5.2. Editing MAC Address Pools</a></li>
<li><a href="#Editing_MAC_Address_Pool_Permissions">1.5.3. Editing MAC Address Pool Permissions</a></li>
<li><a href="#Removing_MAC_Address_Pools">1.5.4. Removing MAC Address Pools</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-System_Dashboard">2. Dashboard</a>
<ul class="sectlevel2">
<li><a href="#sect-Prerequisites">2.1. Prerequisites</a></li>
<li><a href="#sect-Global_Inventory">2.2. Global Inventory</a></li>
<li><a href="#sect-Global_Utilization">2.3. Global Utilization</a>
<ul class="sectlevel3">
<li><a href="#sect-Top_Utilized_Resources">2.3.1. Top Utilized Resources</a></li>
</ul>
</li>
<li><a href="#sect-Cluster_Utilization">2.4. Cluster Utilization</a>
<ul class="sectlevel3">
<li><a href="#sect-Cluster_CPU_Utilization">2.4.1. CPU</a></li>
<li><a href="#sect-Cluster_Memory_Utilization">2.4.2. Memory</a></li>
</ul>
</li>
<li><a href="#sect-Storage_Utilization">2.5. Storage Utilization</a></li>
</ul>
</li>
<li><a href="#chap-Searches">3. Searches</a>
<ul class="sectlevel2">
<li><a href="#Performing_searches">3.1. Performing Searches in oVirt</a></li>
<li><a href="#Search_syntax_and_examples">3.2. Search Syntax and Examples</a></li>
<li><a href="#Search_auto_completion">3.3. Search Auto-Completion</a></li>
<li><a href="#Search_result_type_options">3.4. Search Result Type Options</a></li>
<li><a href="#Search_criteria">3.5. Search Criteria</a></li>
<li><a href="#Search_criteria_multiple_criteria_and_wildcards">3.6. Search: Multiple Criteria and Wildcards</a></li>
<li><a href="#Search_determining_search_order">3.7. Search: Determining Search Order</a></li>
<li><a href="#Searching_for_data_centers">3.8. Searching for Data Centers</a></li>
<li><a href="#Searching_for_clusters">3.9. Searching for Clusters</a></li>
<li><a href="#Searching_for_hosts">3.10. Searching for Hosts</a></li>
<li><a href="#Searching_for_Networks">3.11. Searching for Networks</a></li>
<li><a href="#Searching_for_storage">3.12. Searching for Storage</a></li>
<li><a href="#Searching_for_Disks">3.13. Searching for Disks</a></li>
<li><a href="#Searching_for_Volumes">3.14. Searching for Volumes</a></li>
<li><a href="#Searching_for_virtual_machines">3.15. Searching for Virtual Machines</a></li>
<li><a href="#Searching_for_pools">3.16. Searching for Pools</a></li>
<li><a href="#Searching_for_templates">3.17. Searching for Templates</a></li>
<li><a href="#Searching_for_users">3.18. Searching for Users</a></li>
<li><a href="#Searching_for_events">3.19. Searching for Events</a></li>
</ul>
</li>
<li><a href="#chap-Bookmarks">4. Bookmarks</a>
<ul class="sectlevel2">
<li><a href="#Saving_a_query_string_as_a_bookmark">4.1. Saving a Query String as a Bookmark</a></li>
<li><a href="#Editing_a_bookmark">4.2. Editing a Bookmark</a></li>
<li><a href="#Deleting_a_bookmark">4.3. Deleting a Bookmark</a></li>
</ul>
</li>
<li><a href="#chap-Tags">5. Tags</a>
<ul class="sectlevel2">
<li><a href="#Using_tags_to_customize_interactions">5.1. Using Tags to Customize Interactions with oVirt</a></li>
<li><a href="#Creating_a_tag">5.2. Creating a Tag</a></li>
<li><a href="#Modifying_a_tag">5.3. Modifying a Tag</a></li>
<li><a href="#Deleting_a_tag">5.4. Deleting a Tag</a></li>
<li><a href="#Adding_and_removing_tags">5.5. Adding and Removing Tags to and from Objects</a></li>
<li><a href="#Searching_for_objects_using_tags">5.6. Searching for Objects Using Tags</a></li>
<li><a href="#Customizing_hosts_with_tags">5.7. Customizing Hosts with Tags</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-Administering_the_Resources">Administering the Resources</a>
<ul class="sectlevel1">
<li><a href="#chap-Quality_of_Service">6. Quality of Service</a>
<ul class="sectlevel2">
<li><a href="#sect-Storage_Quality_of_Service">6.1. Storage Quality of Service</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_Storage_Quality_of_Service_Entry">6.1.1. Creating a Storage Quality of Service Entry</a></li>
<li><a href="#Removing_a_Storage_Quality_of_Service_Entry">6.1.2. Removing a Storage Quality of Service Entry</a></li>
</ul>
</li>
<li><a href="#sect-VM_Network_Quality_of_Service">6.2. Virtual Machine Network Quality of Service</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_Virtual_Machine_Network_QoS_Entry">6.2.1. Creating a Virtual Machine Network Quality of Service Entry</a></li>
<li><a href="#Settings_in_the_New_VM_Network_QoS_and_Edit_VM_Network_QoS_Windows_Explained">6.2.2. Settings in the New Virtual Machine Network QoS and Edit Virtual Machine Network QoS Windows Explained</a></li>
<li><a href="#Removing_a_Virtual_Machine_Network_QoS_Entry">6.2.3. Removing a Virtual Machine Network Quality of Service Entry</a></li>
</ul>
</li>
<li><a href="#sect-Host_Network_Quality_of_Service">6.3. Host Network Quality of Service</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_Host_Network_Quality_of_Service_Entry">6.3.1. Creating a Host Network Quality of Service Entry</a></li>
<li><a href="#Settings_in_the_New_Host_Network_QoS_and_Edit_Host_Network_QoS_Windows_Explained">6.3.2. Settings in the New Host Network Quality of Service and Edit Host Network Quality of Service Windows Explained</a></li>
<li><a href="#Removing_a_Host_Network_Quality_of_Service_Entry">6.3.3. Removing a Host Network Quality of Service Entry</a></li>
</ul>
</li>
<li><a href="#sect-CPU_Quality_of_Service">6.4. CPU Quality of Service</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_CPU_Quality_of_Service_Entry">6.4.1. Creating a CPU Quality of Service Entry</a></li>
<li><a href="#Removing_a_CPU_Quality_of_Service_Entry">6.4.2. Removing a CPU Quality of Service Entry</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Data_Centers">7. Data Centers</a>
<ul class="sectlevel2">
<li><a href="#Data_Centers">7.1. Introduction to Data Centers</a>
<ul class="sectlevel3">
<li><a href="#The_Storage_Pool_ManagerSPM">7.1.1. The Storage Pool Manager</a></li>
<li><a href="#SPM_Priority">7.1.2. SPM Priority</a></li>
</ul>
</li>
<li><a href="#sect-Data_Center_Tasks">7.2. Data Center Tasks</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_New_Data_Center">7.2.1. Creating a New Data Center</a></li>
<li><a href="#Data_center_properties">7.2.2. Explanation of Settings in the New Data Center and Edit Data Center Windows</a></li>
<li><a href="#Re-initializing_a_Data_Center">7.2.3. Re-Initializing a Data Center: Recovery Procedure</a></li>
<li><a href="#Removing_a_Data_Center">7.2.4. Removing a Data Center</a></li>
<li><a href="#Force_Removing_a_Data_Center">7.2.5. Force Removing a Data Center</a></li>
<li><a href="#Changing_the_Data_Center_Storage_Type">7.2.6. Changing the Data Center Storage Type</a></li>
<li><a href="#Changing_the_Data_Center_Compatibility_Version_admin">7.2.7. Changing the Data Center Compatibility Version</a></li>
</ul>
</li>
<li><a href="#sect-Data_Centers_and_Storage_Domains">7.3. Data Centers and Storage Domains</a>
<ul class="sectlevel3">
<li><a href="#Attaching_a_data_domain">7.3.1. Attaching an Existing Data Domain to a Data Center</a></li>
<li><a href="#Attaching_an_iso_domain">7.3.2. Attaching an Existing ISO domain to a Data Center</a></li>
<li><a href="#Attaching_an_export_domain">7.3.3. Attaching an Existing Export Domain to a Data Center</a></li>
<li><a href="#Detaching_storage_domains_from_a_data_center">7.3.4. Detaching a Storage Domain from a Data Center</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Clusters">8. Clusters</a>
<ul class="sectlevel2">
<li><a href="#Clusters">8.1. Introduction to Clusters</a></li>
<li><a href="#sect-Cluster_Tasks">8.2. Cluster Tasks</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_New_Cluster">8.2.1. Creating a New Cluster</a></li>
<li><a href="#Cluster_General_Settings_Explained">8.2.2. General Cluster Settings Explained</a></li>
<li><a href="#Cluster_Optimization_Settings_Explained">8.2.3. Optimization Settings Explained</a></li>
<li><a href="#Cluster_Migration_Policy_Settings_Explained">8.2.4. Migration Policy Settings Explained</a></li>
<li><a href="#Cluster_Scheduling_Policy_Settings">8.2.5. Scheduling Policy Settings Explained</a></li>
<li><a href="#conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties">8.2.6. MaxFreeMemoryForOverUtilized and MinFreeMemoryForUnderUtilized cluster scheduling policy properties</a></li>
<li><a href="#Cluster_Console_Settings_Explained">8.2.7. Cluster Console Settings Explained</a></li>
<li><a href="#Fencing_Policy_Settings_Explained">8.2.8. Fencing Policy Settings Explained</a></li>
<li><a href="#Configuring_scheduling_policy">8.2.9. Setting Load and Power Management Policies for Hosts in a Cluster</a></li>
<li><a href="#Updating_the_MoM_Policy_on_Hosts_in_a_Cluster">8.2.10. Updating the MoM Policy on Hosts in a Cluster</a></li>
<li><a href="#Creating_a_CPU_Profile">8.2.11. Creating a CPU Profile</a></li>
<li><a href="#Removing_a_CPU_Profile">8.2.12. Removing a CPU Profile</a></li>
<li><a href="#Importing_an_Existing_RHGS_Cluster">8.2.13. Importing an Existing Gluster Storage Cluster</a></li>
<li><a href="#Explanation_of_Settings_in_the_Add_Hosts_Window">8.2.14. Explanation of Settings in the Add Hosts Window</a></li>
<li><a href="#Removing_a_cluster">8.2.15. Removing a Cluster</a></li>
<li><a href="#memory_optimization">8.2.16. Memory Optimization</a></li>
<li><a href="#About_UEFI_Q35-cluster_opt_settings">8.2.17. UEFI and the Q35 chipset</a></li>
<li><a href="#Changing_the_Cluster_Compatibility_Version_admin">8.2.18. Changing the Cluster Compatibility Version</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Logical_Networks">9. Logical Networks</a>
<ul class="sectlevel2">
<li><a href="#sect-Logical_Network_Tasks">9.1. Logical Network Tasks</a>
<ul class="sectlevel3">
<li><a href="#Performing_Networking_Tasks">9.1.1. Performing Networking Tasks</a></li>
<li><a href="#Creating_a_new_logical_network_in_a_data_center_or_cluster">9.1.2. Creating a New Logical Network in a Data Center or Cluster</a></li>
<li><a href="#Editing_a_Logical_Network">9.1.3. Editing a Logical Network</a></li>
<li><a href="#Removing_a_Logical_Network">9.1.4. Removing a Logical Network</a></li>
<li><a href="#Configuring_a_Default_Route">9.1.5. Configuring a Non-Management Logical Network as the Default Route</a></li>
<li><a href="#proc-Adding-a-static-route-on-a-host">9.1.6. Adding a static route on a host</a></li>
<li><a href="#proc-Removing-a-static-route-on-a-host">9.1.7. Removing a static route on a host</a></li>
<li><a href="#Viewing_or_Editing_the_Gateway">9.1.8. Viewing or Editing the Gateway for a Logical Network</a></li>
<li><a href="#Logical_Network_General_Settings_Explained">9.1.9. Logical Network General Settings Explained</a></li>
<li><a href="#Logical_Network_Cluster_Settings_Explained">9.1.10. Logical Network Cluster Settings Explained</a></li>
<li><a href="#Logical_Network_vNIC_Profiles_Settings_Explained">9.1.11. Logical Network vNIC Profiles Settings Explained</a></li>
<li><a href="#Designate_a_Specific_Traffic_Type">9.1.12. Designate a Specific Traffic Type for a Logical Network with the Manage Networks Window</a></li>
<li><a href="#Explanation_of_Settings_in_the_Manage_Networks_Window">9.1.13. Explanation of Settings in the Manage Networks Window</a></li>
<li><a href="#Editing_VFs_on_NIC">9.1.14. Configuring virtual functions on a NIC</a></li>
</ul>
</li>
<li><a href="#sect-Virtual_Network_Interface_Cards">9.2. Virtual Network Interface Cards (vNICs)</a>
<ul class="sectlevel3">
<li><a href="#VNIC_Profile_Overview">9.2.1. vNIC Profile Overview</a></li>
<li><a href="#Creating_a_VNIC_Profile">9.2.2. Creating or Editing a vNIC Profile</a></li>
<li><a href="#Explanation_of_Settings_in_the_VM_Interface_Profile_Window">9.2.3. Explanation of Settings in the VM Interface Profile Window</a></li>
<li><a href="#Enabling_Passthrough_on_a_vNIC_Profile">9.2.4. Enabling Passthrough on a vNIC Profile</a></li>
<li><a href="#Creating_vNIC_profile_SR_IOV_failover">9.2.5. Enabling a vNIC profile for SR-IOV migration with failover</a></li>
<li><a href="#Removing_a_VNIC_Profile">9.2.6. Removing a vNIC Profile</a></li>
<li><a href="#Assigning_Security_Groups_to_VNIC_Profiles">9.2.7. Assigning Security Groups to vNIC Profiles</a></li>
<li><a href="#User_Permissions_for_VNIC_Profiles">9.2.8. User Permissions for vNIC Profiles</a></li>
</ul>
</li>
<li><a href="#sect-External_Provider_Networks">9.3. External Provider Networks</a>
<ul class="sectlevel3">
<li><a href="#Importing_Networks">9.3.1. Importing Networks From External Providers</a></li>
<li><a href="#Limitations_to_Importing_Networks_from_External_Providers">9.3.2. Limitations to Using External Provider Networks</a></li>
<li><a href="#Configuring_Subnets_on_External_Provider_Logical_Networks">9.3.3. Configuring Subnets on External Provider Logical Networks</a></li>
<li><a href="#Adding_Subnets_to_External_Provider_Logical_Networks">9.3.4. Adding Subnets to External Provider Logical Networks</a></li>
<li><a href="#Removing_Subnets_from_External_Provider_Logical_Networks">9.3.5. Removing Subnets from External Provider Logical Networks</a></li>
<li><a href="#Assigning_Security_Groups_to_Logical_Networks">9.3.6. Assigning Security Groups to Logical Networks and Ports</a></li>
</ul>
</li>
<li><a href="#sect-Hosts_and_Networking">9.4. Hosts and Networking</a>
<ul class="sectlevel3">
<li><a href="#con-Network-Manager-Stateful-Configuration-nmstate">9.4.1. Network Manager Stateful Configuration (nmstate)</a></li>
<li><a href="#Refreshing_Host_Capabilities">9.4.2. Refreshing Host Capabilities</a></li>
<li><a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">9.4.3. Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a></li>
<li><a href="#Synchronizing_host_networks">9.4.4. Synchronizing Host Networks</a></li>
<li><a href="#Editing-VLAN-Settings">9.4.5. Editing a Host&#8217;s VLAN Settings</a></li>
<li><a href="#Adding_multiple_VLANs_to_a_single_network_interface_using_logical_networks">9.4.6. Adding Multiple VLANs to a Single Network Interface Using Logical Networks</a></li>
<li><a href="#proc-Copying-host-networks_vlan">9.4.7. Copying host networks</a></li>
<li><a href="#Assigning_Additional_IPv4_Addresses_to_a_Host_Network">9.4.8. Assigning Additional IPv4 Addresses to a Host Network</a></li>
<li><a href="#Adding_Network_Labels_to_Host_Network_Interfaces">9.4.9. Adding Network Labels to Host Network Interfaces</a></li>
<li><a href="#Changing_the_FQDN_of_a_Host">9.4.10. Changing the FQDN of a Host</a></li>
<li><a href="#IPv6-networking-support-labels">9.4.11. IPv6 Networking Support</a></li>
<li><a href="#setting-up-and-configuring-sr-iov">9.4.12. Setting Up and Configuring SR-IOV</a></li>
</ul>
</li>
<li><a href="#sect-Network_Bonding">9.5. Network Bonding</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_bond_device_in_the_administration_portal">9.5.1. Creating a Bond Device in the Administration Portal</a></li>
<li><a href="#Creating_a_bond_device_with_the_lldp_labeler_service">9.5.2. Creating a Bond Device with the LLDP Labeler Service</a></li>
<li><a href="#Bonding_Modes">9.5.3. Bonding Modes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Hosts">10. Hosts</a>
<ul class="sectlevel2">
<li><a href="#Introduction_to_Hosts">10.1. Introduction to Hosts</a></li>
<li><a href="#Intro_to_RHVH">10.2. oVirt Node</a></li>
<li><a href="#Adding_Red_Hat_Enterprise_Linux_Hosts">10.3. Enterprise Linux hosts</a></li>
<li><a href="#Satellite_Host_Provider_Hosts">10.4. Satellite Host Provider Hosts</a></li>
<li><a href="#sect-Host_Tasks">10.5. Host Tasks</a>
<ul class="sectlevel3">
<li><a href="#Adding_standard_hosts_to_the_Manager_host_tasks">10.5.1. Adding Standard Hosts to the oVirt Engine</a></li>
<li><a href="#Adding_a_Satellite_Host_Provider_Host">10.5.2. Adding a Satellite Host Provider Host</a></li>
<li><a href="#Configuring_Satellite_Errata_Management_for_a_Host">10.5.3. Setting up Satellite errata viewing for a host</a></li>
<li><a href="#Configuring_a_Host_for_PCI_Passthrough_host_tasks">10.5.4. Configuring a Host for PCI Passthrough</a></li>
<li><a href="#proc-enabling-nested-virtualization-for-all-virtual-machines">10.5.5. Enabling nested virtualization for all virtual machines</a></li>
<li><a href="#proc-enabling-nested-virtualization-for-individual-virtual-machines">10.5.6. Enabling nested virtualization for individual virtual machines</a></li>
<li><a href="#Moving_a_host_to_maintenance_mode">10.5.7. Moving a Host to Maintenance Mode</a></li>
<li><a href="#Activating_a_host_from_maintenance_mode">10.5.8. Activating a Host from Maintenance Mode</a></li>
<li><a href="#Configuring_Host_Firewall_Rules">10.5.9. Configuring Host Firewall Rules</a></li>
<li><a href="#Removing_a_host">10.5.10. Removing a Host</a></li>
<li><a href="#Updating_a_host_between_minor_releases">10.5.11. Updating Hosts Between Minor Releases</a></li>
<li><a href="#Reinstalling_Hosts_admin">10.5.12. Reinstalling Hosts</a></li>
<li><a href="#Viewing_Host_Errata">10.5.13. Viewing Host Errata</a></li>
<li><a href="#Viewing_Host_Health_Status">10.5.14. Viewing the Health Status of a Host</a></li>
<li><a href="#Viewing_Host_Devices">10.5.15. Viewing Host Devices</a></li>
<li><a href="#Accessing_Cockpit_from_the_Admin_Portal">10.5.16. Accessing Cockpit from the Administration Portal</a></li>
<li><a href="#Setting_Legacy_SPICE_Cipher_host_tasks">10.5.17. Setting a Legacy SPICE Cipher</a></li>
<li><a href="#Configuring_Host_Power_Management_Settings">10.5.18. Configuring Host Power Management Settings</a></li>
<li><a href="#Configuring_Host_SPM_Settings">10.5.19. Configuring Host Storage Pool Manager Settings</a></li>
<li><a href="#migrating_she_host_to_different_cluster_host_tasks">10.5.20. Migrating a self-hosted engine host to a different cluster</a></li>
</ul>
</li>
<li><a href="#explanation-of-settings-and-controls-in-the-new-host-and-edit-host-windows">10.6. Explanation of Settings and Controls in the New Host and Edit Host Windows</a>
<ul class="sectlevel3">
<li><a href="#Host_General_Settings">10.6.1. Host General Settings Explained</a></li>
<li><a href="#Host_Power_Management_settings_explained">10.6.2. Host Power Management Settings Explained</a></li>
<li><a href="#SPM_priority_settings_explained">10.6.3. SPM Priority Settings Explained</a></li>
<li><a href="#Host_Console_Settings_Explained">10.6.4. Host Console Settings Explained</a></li>
<li><a href="#Network_Provider_Settings_Explained">10.6.5. Network Provider Settings Explained</a></li>
<li><a href="#Kernel_Settings_Explained">10.6.6. Kernel Settings Explained</a></li>
<li><a href="#Hosted_Engine_Settings_Explained">10.6.7. Hosted Engine Settings Explained</a></li>
</ul>
</li>
<li><a href="#sect-Host_Resilience">10.7. Host Resilience</a>
<ul class="sectlevel3">
<li><a href="#Host_high_availability">10.7.1. Host High Availability</a></li>
<li><a href="#Power_Management_by_Proxy_in_Red_Hat_Enterprise_Virtualization">10.7.2. Power Management by Proxy in oVirt</a></li>
<li><a href="#Setting_fencing_parameters_on_a_host">10.7.3. Setting Fencing Parameters on a Host</a></li>
<li><a href="#sect-fence_kdump_Advanced_Configuration">10.7.4. fence_kdump Advanced Configuration</a></li>
<li><a href="#Soft-Fencing_Hosts">10.7.5. Soft-Fencing Hosts</a></li>
<li><a href="#Using_power_host_power_management_functions">10.7.6. Using Host Power Management Functions</a></li>
<li><a href="#Manually_fencing_or_isolating_a_nonresponsive_host">10.7.7. Manually Fencing or Isolating a Non-Responsive Host</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Storage">11. Storage</a>
<ul class="sectlevel2">
<li><a href="#Understanding_Storage">11.1. Understanding Storage Domains</a></li>
<li><a href="#sect-Preparing_and_Adding_NFS_Storage">11.2. Preparing and Adding NFS Storage</a>
<ul class="sectlevel3">
<li><a href="#Preparing_NFS_Storage_storage_admin">11.2.1. Preparing NFS Storage</a></li>
<li><a href="#Adding_NFS_Storage_storage_admin">11.2.2. Adding NFS Storage</a></li>
<li><a href="#Increasing_NFS_Storage">11.2.3. Increasing NFS Storage</a></li>
</ul>
</li>
<li><a href="#sect-Preparing_and_Adding_Local_Storage">11.3. Preparing and adding local storage</a>
<ul class="sectlevel3">
<li><a href="#Preparing_Local_Storage_storage_admin">11.3.1. Preparing local storage</a></li>
<li><a href="#Adding_Local_Storage_storage_admin">11.3.2. Adding a local storage domain</a></li>
</ul>
</li>
<li><a href="#sect-Preparing_and_Adding_POSIX_Compliant_File_System_Storage">11.4. Preparing and Adding POSIX-compliant File System Storage</a>
<ul class="sectlevel3">
<li><a href="#Preparing_POSIX_Storage_storage_admin">11.4.1. Preparing POSIX-compliant File System Storage</a></li>
<li><a href="#Adding_POSIX_Storage_storage_admin">11.4.2. Adding POSIX-compliant File System Storage</a></li>
</ul>
</li>
<li><a href="#sect-Preparing_and_Adding_Block_Storage">11.5. Preparing and Adding Block Storage</a>
<ul class="sectlevel3">
<li><a href="#Preparing_iSCSI_Storage_storage_admin">11.5.1. Preparing iSCSI Storage</a></li>
<li><a href="#Adding_iSCSI_Storage_storage_admin">11.5.2. Adding iSCSI Storage</a></li>
<li><a href="#Configuring_iSCSI_Multipathing">11.5.3. Configuring iSCSI Multipathing</a></li>
<li><a href="#Migrating_a_logical_network_to_an_iscsi_bond">11.5.4. Migrating a Logical Network to an iSCSI Bond</a></li>
<li><a href="#Preparing_FCP_Storage_storage_admin">11.5.5. Preparing FCP Storage</a></li>
<li><a href="#Adding_FCP_Storage_storage_admin">11.5.6. Adding FCP Storage</a></li>
<li><a href="#Increasing_iSCSI_or_FCP_Storage">11.5.7. Increasing iSCSI or FCP Storage</a></li>
<li><a href="#Reusing_LUNs">11.5.8. Reusing LUNs</a></li>
<li><a href="#Removing_stale_LUNs">11.5.9. Removing stale LUNs</a></li>
<li><a href="#Creating_LVM_filter_storage_admin">11.5.10. Creating an LVM filter</a></li>
</ul>
</li>
<li><a href="#Adding_Red_Hat_Gluster_Storage">11.6. Preparing and Adding Gluster Storage</a>
<ul class="sectlevel3">
<li><a href="#Preparing_Red_Hat_Gluster_Storage_storage_admin">11.6.1. Preparing Gluster Storage</a></li>
<li><a href="#Adding_Red_Hat_Gluster_Storage_storage_admin">11.6.2. Adding Gluster Storage</a></li>
</ul>
</li>
<li><a href="#sect-Importing_Existing_Storage_Domains">11.7. Importing Existing Storage Domains</a>
<ul class="sectlevel3">
<li><a href="#Overview_of_Importing_Existing_Storage_Domains">11.7.1. Overview of Importing Existing Storage Domains</a></li>
<li><a href="#Importing_storage_domains">11.7.2. Importing storage domains</a></li>
<li><a href="#Migrating_SD_between_DC_Same_Env">11.7.3. Migrating Storage Domains between Data Centers in the Same Environment</a></li>
<li><a href="#Migrating_SD_between_DC_different_env">11.7.4. Migrating Storage Domains between Data Centers in Different Environments</a></li>
<li><a href="#Importing_Templates_from_Imported_Data_Storage_Domains">11.7.5. Importing Templates from Imported Data Storage Domains</a></li>
</ul>
</li>
<li><a href="#sect-Storage_Tasks">11.8. Storage Tasks</a>
<ul class="sectlevel3">
<li><a href="#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">11.8.1. Uploading Images to a Data Storage Domain</a></li>
<li><a href="#Copy_ISO_to_ISO_domain-storage_tasks">11.8.2. Uploading images to an ISO domain</a></li>
<li><a href="#Moving_storage_domains_to_maintenance_mode">11.8.3. Moving Storage Domains to Maintenance Mode</a></li>
<li><a href="#Editing_Storage_Domains">11.8.4. Editing Storage Domains</a></li>
<li><a href="#updating-ovfs">11.8.5. Updating OVFs</a></li>
<li><a href="#Activating_storage_domains">11.8.6. Activating Storage Domains from Maintenance Mode</a></li>
<li><a href="#Detaching_a_storage_domain">11.8.7. Detaching a Storage Domain from a Data Center</a></li>
<li><a href="#Attaching_a_storage_domain">11.8.8. Attaching a Storage Domain to a Data Center</a></li>
<li><a href="#Removing_a_Storage_Domain_storage_tasks">11.8.9. Removing a Storage Domain</a></li>
<li><a href="#Destroying_a_storage_domain">11.8.10. Destroying a Storage Domain</a></li>
<li><a href="#Creating_a_Disk_Profile">11.8.11. Creating a Disk Profile</a></li>
<li><a href="#Removing_a_Disk_Profile">11.8.12. Removing a Disk Profile</a></li>
<li><a href="#Viewing_Storage_Health_Status">11.8.13. Viewing the Health Status of a Storage Domain</a></li>
<li><a href="#Setting_Discard_After_Delete_for_a_Storage_Domain">11.8.14. Setting Discard After Delete for a Storage Domain</a></li>
<li><a href="#Enabling-4K-support-more-than-250-nodes-storage_tasks">11.8.15. Enabling 4K support on environments with more than 250 hosts</a></li>
<li><a href="#Disabling-4K-support-storage_tasks">11.8.16. Disabling 4K support</a></li>
<li><a href="#monitoring-available-space-in-a-storage-domain_storage_tasks">11.8.17. Monitoring available space in a storage domain</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Pools">12. Pools</a>
<ul class="sectlevel2">
<li><a href="#Pools">12.1. Introduction to Virtual Machine Pools</a></li>
<li><a href="#Creating_a_VM_Pool">12.2. Creating a virtual machine pool</a></li>
<li><a href="#sect-Explanation_of_Settings_and_Controls_in_the_New_Pool_Window">12.3. Explanation of Settings and Controls in the New Pool and Edit Pool Windows</a>
<ul class="sectlevel3">
<li><a href="#New_Pool_General_Settings_Explained">12.3.1. New Pool and Edit Pool General Settings Explained</a></li>
<li><a href="#New_Pool_Pool_Settings_Explained">12.3.2. New Pool and Edit Pool Type Settings Explained</a></li>
<li><a href="#New_Pool_and_Edit_Pool_Console_Settings_Explained">12.3.3. New Pool and Edit Pool Console Settings Explained</a></li>
<li><a href="#Virtual_Machine_Pool_Host_settings_explained">12.3.4. Virtual Machine Pool Host Settings Explained</a></li>
<li><a href="#New_Pool_Resource_Settings_Explained">12.3.5. New Pool and Edit Pool Resource Allocation Settings Explained</a></li>
</ul>
</li>
<li><a href="#Editing_a_Virtual_Machine_Pool">12.4. Editing a Virtual Machine Pool</a></li>
<li><a href="#Prestarting_Virtual_Machines_in_a_Pool">12.5. Prestarting Virtual Machines in a Pool</a></li>
<li><a href="#Adding_Virtual_Machines_to_a_VM_Pool">12.6. Adding Virtual Machines to a Virtual Machine Pool</a></li>
<li><a href="#Detaching_Virtual_Machines_from_a_VM_Pool">12.7. Detaching Virtual Machines from a Virtual Machine Pool</a></li>
<li><a href="#Removing_a_Virtual_Machine_Pool">12.8. Removing a Virtual Machine Pool</a></li>
</ul>
</li>
<li><a href="#chap-Virtual_Machine_Disks">13. Virtual Disks</a>
<ul class="sectlevel2">
<li><a href="#Understanding_virtual_machine_storage">13.1. Understanding Virtual Machine Storage</a></li>
<li><a href="#Understanding_virtual_disks">13.2. Understanding Virtual Disks</a></li>
<li><a href="#Settings_to_Wipe_Virtual_Disks_After_Deletion">13.3. Settings to Wipe Virtual Disks After Deletion</a></li>
<li><a href="#Shareable_Disks">13.4. Shareable Disks in oVirt</a></li>
<li><a href="#Read_Only_Disks_in_Red_Hat_Enterprise_Virtualization">13.5. Read Only Disks in oVirt</a></li>
<li><a href="#sect-Virtual_Disk_Tasks">13.6. Virtual Disk Tasks</a>
<ul class="sectlevel3">
<li><a href="#Creating_a_Virtual_Disk">13.6.1. Creating a Virtual Disk</a></li>
<li><a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">13.6.2. Explanation of settings in the New Virtual Disk window</a></li>
<li><a href="#Overview_of_Live_Storage_Migration">13.6.3. Overview of Live Storage Migration</a></li>
<li><a href="#Moving_a_Virtual_Disk">13.6.4. Moving a Virtual Disk</a></li>
<li><a href="#Changing_the_Disk_Interface_Type">13.6.5. Changing the Disk Interface Type</a></li>
<li><a href="#Copying_a_Virtual_Disk">13.6.6. Copying a Virtual Disk</a></li>
<li><a href="#proc_improving_disk_performance">13.6.7. Improving disk performance</a></li>
<li><a href="#uploading-images-to-a-data-storage-domain">13.6.8. Uploading Images to a Data Storage Domain</a></li>
<li><a href="#Importing_a_Disk_Image_from_an_Imported_Storage_Domain">13.6.9. Importing a Disk Image from an Imported Storage Domain</a></li>
<li><a href="#Importing_an_Unregistered_Disk_Image_from_an_Imported_Storage_Domain">13.6.10. Importing an Unregistered Disk Image from an Imported Storage Domain</a></li>
<li><a href="#Importing_a_Disk_Image_from_an_OpenStack_Image_Service">13.6.11. Importing a Virtual Disk from an OpenStack Image Service</a></li>
<li><a href="#Exporting_a_Virtual_Disk_to_an_OpenStack_Image_Service">13.6.12. Exporting a Virtual Disk to an OpenStack Image Service</a></li>
<li><a href="#Reclaiming_virtual_disk_space">13.6.13. Reclaiming Virtual Disk Space</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-External_Providers">14. External Providers</a>
<ul class="sectlevel2">
<li><a href="#Introduction_to_Third_Party_Resource_Providers_in_Red_Hat_Enterprise_Virtualization">14.1. Introduction to External Providers in oVirt</a></li>
<li><a href="#sect-Adding_External_Providers">14.2. Adding External Providers</a>
<ul class="sectlevel3">
<li><a href="#Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">14.2.1. Adding a Red Hat Satellite Instance for Host Provisioning</a></li>
<li><a href="#Adding_an_OpenStack_Image_Service_Glance_for_Image_Management">14.2.2. Adding an OpenStack Image (Glance) Instance for Image Management</a></li>
<li><a href="#proc-adding-kubevirt-openshift-as-an-external-provider_external_providers">14.2.3. Adding KubeVirt/Openshift Virtualization as an external provider</a></li>
<li><a href="#Adding_a_VMware_Instance_as_a_Virtual_Machine_Provider">14.2.4. Adding a VMware Instance as a Virtual Machine Provider</a></li>
<li><a href="#Adding_Xen_as_an_External_Provider">14.2.5. Adding a RHEL 5 Xen Host as a Virtual Machine Provider</a></li>
<li><a href="#Adding_KVM_as_an_External_Provider">14.2.6. Adding a KVM Host as a Virtual Machine Provider</a></li>
<li><a href="#Adding_OVN_as_an_External_Network_Provider">14.2.7. Adding Open Virtual Network (OVN) as an External Network Provider</a></li>
<li><a href="#Adding_an_External_Network_Provider">14.2.8. Adding an External Network Provider</a></li>
<li><a href="#Add_Provider_General_Settings_Explained">14.2.9. Add Provider General Settings Explained</a></li>
</ul>
</li>
<li><a href="#Editing_an_External_Provider">14.3. Editing an External Provider</a></li>
<li><a href="#Removing_an_External_Provider">14.4. Removing an External Provider</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-Administering_the_Environment">Administering the Environment</a>
<ul class="sectlevel1">
<li><a href="#chap-Administering_the_Self-Hosted_Engine">15. Administering the Self-Hosted Engine</a>
<ul class="sectlevel2">
<li><a href="#Maintaining_the_Self-Hosted_Engine">15.1. Maintaining the Self-hosted engine</a>
<ul class="sectlevel3">
<li><a href="#Self-hosted_engine_maintenance_modes_explained_SHE_admin">15.1.1. Self-hosted engine maintenance modes explained</a></li>
<li><a href="#local-maintenance-mode_SHE_admin">15.1.2. Setting local maintenance mode</a></li>
<li><a href="#global-maintenance-mode_SHE_admin">15.1.3. Setting global maintenance mode</a></li>
</ul>
</li>
<li><a href="#Administering_the_Manager_Virtual_Machine">15.2. Administering the Engine Virtual Machine</a>
<ul class="sectlevel3">
<li><a href="#updating-the-self-hosted-engine-configuration">15.2.1. Updating the Self-Hosted Engine Configuration</a></li>
<li><a href="#configuring-email-notifications">15.2.2. Configuring Email Notifications</a></li>
</ul>
</li>
<li><a href="#Configuring_Memory_Slots_Reserved_for_the_SHE">15.3. Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</a></li>
<li><a href="#Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">15.4. Adding Self-Hosted Engine Nodes to the oVirt Engine</a></li>
<li><a href="#Reinstalling_an_Existing_Host_as_a_Self-Hosted_Engine_Node_SHE_admin">15.5. Reinstalling an Existing Host as a Self-Hosted Engine Node</a></li>
<li><a href="#Booting_a_Self-Hosted_Engine_in_Rescue_Mode_SHE_admin">15.6. Booting the Engine Virtual Machine in Rescue Mode</a></li>
<li><a href="#Removing_a_Host_from_a_Self-Hosted_Engine_Environment">15.7. Removing a Host from a Self-Hosted Engine Environment</a></li>
<li><a href="#Updating_a_self-hosted_engine_SHE_admin">15.8. Updating a Self-Hosted Engine</a></li>
<li><a href="#Changing_FQDN_of_RHVM_self-hosted_engine">15.9. Changing the FQDN of the Engine in a Self-Hosted Engine</a></li>
</ul>
</li>
<li><a href="#chap-Backups_and_Migration">16. Backups and Migration</a>
<ul class="sectlevel2">
<li><a href="#sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">16.1. Backing Up and Restoring the oVirt Engine</a>
<ul class="sectlevel3">
<li><a href="#Backing_up_Red_Hat_Enterprise_Virtualization_Manager_using_the_engine-backup_Command">16.1.1. Backing up oVirt Engine - Overview</a></li>
<li><a href="#Syntax_for_the_engine-backup_Command">16.1.2. Syntax for the engine-backup Command</a></li>
<li><a href="#Creating_a_Backup_with_the_engine-backup_Command">16.1.3. Creating a backup with the engine-backup command</a></li>
<li><a href="#Restoring_a_Backup_with_the_engine-backup_Command">16.1.4. Restoring a Backup with the engine-backup Command</a></li>
<li><a href="#Restoring_a_Backup_to_a_Fresh_Installation">16.1.5. Restoring a Backup to a Fresh Installation</a></li>
<li><a href="#Restoring_a_Backup_to_Overwrite_an_Existing_Installation_RHV_backup_restore">16.1.6. Restoring a Backup to Overwrite an Existing Installation</a></li>
<li><a href="#Restoring_a_Backup_with_Different_Credentials">16.1.7. Restoring a Backup with Different Credentials</a></li>
<li><a href="#Backing_up_and_Restoring_a_Self-hosted_Engine">16.1.8. Backing up and Restoring a Self-Hosted Engine</a></li>
<li><a href="#Recovering_a_Self-hosted_Engine">16.1.9. Recovering a Self-Hosted Engine from an Existing Backup</a></li>
<li><a href="#Overwriting_a_Self-Hosted_Engine">16.1.10. Overwriting a Self-Hosted Engine from an Existing Backup</a></li>
</ul>
</li>
<li><a href="#migrating-rhv-databases">16.2. Migrating oVirt Databases to Remote Servers</a>
<ul class="sectlevel3">
<li><a href="#Migrating_Data_Warehouse_to_a_Separate_Machine_migrate_database">16.2.1. Migrating Data Warehouse to a Separate Machine</a></li>
</ul>
</li>
<li><a href="#sect-Backing_Up_and_Restoring_Virtual_Machines_Using_a_Backup_Domain">16.3. Backing Up and Restoring Virtual Machines Using a Backup Storage Domain</a>
<ul class="sectlevel3">
<li><a href="#con_Backup_domains_explained_backup_domain">16.3.1. Backup storage domains explained</a></li>
<li><a href="#Setting_a_storage_domain_to_be_a_backup_domain_backup_domain">16.3.2. Setting a data storage domain to be a backup domain</a></li>
<li><a href="#proc_Backing_Up_a_Virtual_Machine_backup_domain">16.3.3. Backing up or Restoring a Virtual Machine or Snapshot Using a Backup Domain</a></li>
</ul>
</li>
<li><a href="#sect-Backing_Up_and_Restoring_Virtual_Machines_Using_the_Backup_and_Restore_API">16.4. Backing Up and Restoring Virtual Machines Using the Backup and Restore API</a>
<ul class="sectlevel3">
<li><a href="#The_Backup_and_Restore_API">16.4.1. The Backup and Restore API</a></li>
<li><a href="#Backing_Up_a_Virtual_Machine">16.4.2. Backing Up a Virtual Machine</a></li>
<li><a href="#Restoring_a_Virtual_Machine">16.4.3. Restoring a Virtual Machine</a></li>
</ul>
</li>
<li><a href="#backing-up-and-restoring-virtual-machines-using-the-incremental-backup-and-restore-api">16.5. Backing Up and Restoring Virtual Machines Using the Incremental Backup and Restore API</a>
<ul class="sectlevel3">
<li><a href="#the-incremental-backup-flow">16.5.1. The Incremental Backup Flow</a></li>
<li><a href="#the-incremental-restore-flow">16.5.2. The Incremental Restore Flow</a></li>
<li><a href="#incremental-backup-and-restore-api-tasks">16.5.3. Incremental Backup and Restore API Tasks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Errata_Management_with_Satellite">17. Setting up errata viewing with Red Hat Satellite</a></li>
<li><a href="#chap-Automating_RHV_Configuration_using_Ansible">18. Automating Configuration Tasks using Ansible</a>
<ul class="sectlevel2">
<li><a href="#oVirt_Ansible_Collection">18.1. oVirt Ansible Collection</a></li>
<li><a href="#Installing_ovirt_Ansible_Collection">18.2. Installing oVirt Ansible Collection from an RPM package</a></li>
<li><a href="#Installing_Ansible_Collection_from_Automation_Hub">18.3. Installing oVirt Ansible Collection from Automation Hub</a></li>
<li><a href="#Using_Ansible_Collection">18.4. Using oVirt Ansible Collection to Configure oVirt</a></li>
</ul>
</li>
<li><a href="#chap-Users_and_Roles">19. Users and Roles</a>
<ul class="sectlevel2">
<li><a href="#Introduction_to_users">19.1. Introduction to Users</a></li>
<li><a href="#Introduction_to_Directory_Servers">19.2. Introduction to Directory Servers</a></li>
<li><a href="#sect-Configuring_an_External_LDAP_Provider">19.3. Configuring an External LDAP Provider</a>
<ul class="sectlevel3">
<li><a href="#Configuring_an_External_LDAP_Provider">19.3.1. Configuring an External LDAP Provider (Interactive Setup)</a></li>
<li><a href="#Attaching_an_Active_Directory">19.3.2. Attaching an Active Directory</a></li>
<li><a href="#Configuring_an_External_LDAP_Provider_ManualMethod">19.3.3. Configuring an External LDAP Provider (Manual Method)</a></li>
<li><a href="#removing-an-external-ldap-provider">19.3.4. Removing an External LDAP Provider</a></li>
</ul>
</li>
<li><a href="#Configuring_LDAP_and_Kerberos_for_Single_Sign-on">19.4. Configuring LDAP and Kerberos for Single Sign-on</a></li>
<li><a href="#Configuring_Red_Hat_SSO">19.5. Installing and Configuring Red Hat Single Sign-On</a>
<ul class="sectlevel3">
<li><a href="#installing-red-hat-single-sign-on">19.5.1. Installing Red Hat Single Sign-On</a></li>
<li><a href="#configuring-the-ldap-group-mapper">19.5.2. Configuring the LDAP group mapper</a></li>
<li><a href="#configuring-apache-in-the-engine">19.5.3. Configuring Apache in the Engine</a></li>
<li><a href="#configuring-ovn">19.5.4. Configuring OVN</a></li>
<li><a href="#configuring-the-monitoring-portal-grafana">19.5.5. Configuring the Monitoring Portal (Grafana)</a></li>
</ul>
</li>
<li><a href="#sect-User_Authorization">19.6. User Authorization</a>
<ul class="sectlevel3">
<li><a href="#User_authorization_model">19.6.1. User Authorization Model</a></li>
<li><a href="#User_actions">19.6.2. User Actions</a></li>
</ul>
</li>
<li><a href="#sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">19.7. Administering User Tasks From the Administration Portal</a>
<ul class="sectlevel3">
<li><a href="#Adding_users">19.7.1. Adding Users and Assigning VM Portal Permissions</a></li>
<li><a href="#Viewing_user_information">19.7.2. Viewing User Information</a></li>
<li><a href="#Viewing_User_Permissions_on_Resources">19.7.3. Viewing User Permissions on Resources</a></li>
<li><a href="#Removing_Users">19.7.4. Removing Users</a></li>
<li><a href="#Viewing_Logged_In_Users">19.7.5. Viewing Logged-In Users</a></li>
<li><a href="#Terminating_a_User_Session">19.7.6. Terminating a User Session</a></li>
</ul>
</li>
<li><a href="#sect-Administering_User_Tasks_From_the_commandline">19.8. Administering User Tasks From the Command Line</a>
<ul class="sectlevel3">
<li><a href="#creating-a-new-user">19.8.1. Creating a New User</a></li>
<li><a href="#setting-a-user-password">19.8.2. Setting a User Password</a></li>
<li><a href="#setting-user-timeout">19.8.3. Setting User Timeout</a></li>
<li><a href="#pre-encrypting-a-user-password">19.8.4. Pre-encrypting a User Password</a></li>
<li><a href="#viewing-user-information">19.8.5. Viewing User Information</a></li>
<li><a href="#editing-user-information">19.8.6. Editing User Information</a></li>
<li><a href="#removing-a-user">19.8.7. Removing a User</a></li>
<li><a href="#Disabling_the_Internal_Administrative_User">19.8.8. Disabling the Internal Administrative User</a></li>
<li><a href="#Managing_Groups">19.8.9. Managing Groups</a></li>
<li><a href="#Querying_Users_and_Groups">19.8.10. Querying Users and Groups</a></li>
<li><a href="#Managing_Account_Settings">19.8.11. Managing Account Settings</a></li>
</ul>
</li>
<li><a href="#Configuring_Additional_Local_Domains">19.9. Configuring Additional Local Domains</a></li>
</ul>
</li>
<li><a href="#chap-Quotas_and_Service_Level_Agreement_Policy">20. Quotas and Service Level Agreement Policy</a>
<ul class="sectlevel2">
<li><a href="#Introduction_to_Quota">20.1. Introduction to Quota</a></li>
<li><a href="#Shared_Quota_and_Individually-defined_Quota">20.2. Shared Quota and Individually Defined Quota</a></li>
<li><a href="#Quota_Accounting">20.3. Quota Accounting</a></li>
<li><a href="#Enabling_and_Changing_Quota_for_a_DC">20.4. Enabling and Changing a Quota Mode in a Data Center</a></li>
<li><a href="#Creating_a_New_Quota_Policy">20.5. Creating a New Quota Policy</a></li>
<li><a href="#Explanation_of_Quota_Threshold_Settings">20.6. Explanation of Quota Threshold Settings</a></li>
<li><a href="#Assigning_a_Quota_to_an_Object">20.7. Assigning a Quota to an Object</a></li>
<li><a href="#Using_Quota_to_limit_user_resources">20.8. Using Quota to Limit Resources by User</a></li>
<li><a href="#Editing_Quotas">20.9. Editing Quotas</a></li>
<li><a href="#Removing_Quotas">20.10. Removing Quotas</a></li>
<li><a href="#Service_Level_Agreement_Policy_Enforcement">20.11. Service Level Agreement Policy Enforcement</a></li>
</ul>
</li>
<li><a href="#chap-Event_Notifications">21. Event Notifications</a>
<ul class="sectlevel2">
<li><a href="#Configuring_event_notifications">21.1. Configuring Event Notifications in the Administration Portal</a></li>
<li><a href="#Cancelling_event_notifications">21.2. Canceling Event Notifications in the Administration Portal</a></li>
<li><a href="#Parameters_for_event_notifications_in_notifier">21.3. Parameters for Event Notifications in ovirt-engine-notifier.conf</a></li>
<li><a href="#Configuring_the_Red_Hat_Enterprise_Virtualization_Manager_to_Send_SNMP_Traps">21.4. Configuring the oVirt Engine to Send SNMP Traps</a></li>
</ul>
</li>
<li><a href="#chap-Utilities">22. Utilities</a>
<ul class="sectlevel2">
<li><a href="#sect-The_oVirt_Engine_Rename_Tool">22.1. The oVirt Engine Rename Tool</a>
<ul class="sectlevel3">
<li><a href="#The_oVirt_Engine_Rename_Tool">22.1.1. The oVirt Engine Rename Tool</a></li>
<li><a href="#Syntax_for_the_oVirt_Engine_Rename_Command">22.1.2. Syntax for the oVirt Engine Rename Command</a></li>
<li><a href="#Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool">22.1.3. Renaming the Engine with the oVirt Engine Rename Tool</a></li>
</ul>
</li>
<li><a href="#sect-The_Engine_Configuration_Tool">22.2. The Engine Configuration Tool</a>
<ul class="sectlevel3">
<li><a href="#The_Engine_Configuration_Tool">22.2.1. The Engine Configuration Tool</a></li>
<li><a href="#Syntax_for_the_engine-config_Command">22.2.2. Syntax for the engine-config Command</a></li>
</ul>
</li>
<li><a href="#sect-The_USB_Filter_Editor">22.3. The USB Filter Editor</a>
<ul class="sectlevel3">
<li><a href="#Installing_the_USB_Filter_Editor">22.3.1. Installing the USB Filter Editor</a></li>
<li><a href="#The_USB_Filter_Editor_interface">22.3.2. The USB Filter Editor Interface</a></li>
<li><a href="#Adding_a_USB_policy">22.3.3. Adding a USB Policy</a></li>
<li><a href="#Removing_a_USB_policy">22.3.4. Removing a USB Policy</a></li>
<li><a href="#Searching_for_USB_device_policies">22.3.5. Searching for USB Device Policies</a></li>
<li><a href="#Exporting_a_USB_policy">22.3.6. Exporting a USB Policy</a></li>
<li><a href="#Importing_a_USB_policy">22.3.7. Importing a USB Policy</a></li>
</ul>
</li>
<li><a href="#sect-The_ISO_Uploader_Tool">22.4. The ISO Uploader Tool</a>
<ul class="sectlevel3">
<li><a href="#The_ISO_Uploader_Tool">22.4.1. The ISO Uploader Tool</a></li>
<li><a href="#Syntax_for_the_engine-iso-uploader_Command">22.4.2. Syntax for the engine-iso-uploader Command</a></li>
<li><a href="#Specifying_an_NFS_Server">22.4.3. Specifying an NFS Server</a></li>
<li><a href="#Basic_ISO_Uploader_Usage">22.4.4. Basic ISO Uploader Usage</a></li>
<li><a href="#Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain">22.4.5. Uploading the VirtIO and guest tool image files to a storage domain</a></li>
</ul>
</li>
<li><a href="#sect-The_Engine_Vacuum_Tool">22.5. The Engine Vacuum Tool</a>
<ul class="sectlevel3">
<li><a href="#The_Engine_Vacuum_Tool">22.5.1. The Engine Vacuum Tool</a></li>
<li><a href="#Engine_Vacuum_Modes">22.5.2. Engine Vacuum Modes</a></li>
<li><a href="#Syntax_for_the_engine-vacuum_Command">22.5.3. Syntax for the engine-vacuum Command</a></li>
</ul>
</li>
<li><a href="#sect-The_VDSM_To_Network_Name_Tool">22.6. The VDSM to Network Name Mapping Tool</a>
<ul class="sectlevel3">
<li><a href="#Vdsm_To_Network_Mapping_Tool">22.6.1. Mapping VDSM Names to Logical Network Names</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-Gathering_Information_About_the_Environment">Gathering Information About the Environment</a>
<ul class="sectlevel1">
<li><a href="#monitoring_and_observability">23. Monitoring and observability</a>
<ul class="sectlevel2">
<li><a href="#using-data-warehouse-and-grafana-to-monitor-ovirt">23.1. Using Data Warehouse and Grafana to monitor oVirt</a>
<ul class="sectlevel3">
<li><a href="#grafana">23.1.1. Grafana</a></li>
<li><a href="#configuring-grafana">23.1.2. Configuring Grafana</a></li>
<li><a href="#grafana-dashboards">23.1.3. Grafana dashboards</a></li>
</ul>
</li>
<li><a href="#sending-metrics-and-logs-to-a-remote-instance-of-elasticsearch">23.2. Sending metrics and logs to a remote instance of Elasticsearch</a>
<ul class="sectlevel3">
<li><a href="#installing-collectd-and-rsyslog">23.2.1. Installing collectd and rsyslog</a></li>
<li><a href="#logging-schema-and-analyzing-logs">23.2.2. Logging schema and analyzing logs</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#chap-Log_Files">24. Log Files</a>
<ul class="sectlevel2">
<li><a href="#Manager_Installation_Log_Files">24.1. Engine Installation Log Files</a></li>
<li><a href="#Manager_Log_Files">24.2. oVirt Engine Log Files</a></li>
<li><a href="#sect-SPICE_Log_Files">24.3. SPICE Log Files</a>
<ul class="sectlevel3">
<li><a href="#SPICE_Logs_for_Hypervisor_SPICE_Servers">24.3.1. SPICE Logs for Hypervisor SPICE Servers</a></li>
<li><a href="#SPICE_Logs_for_Guest_Machines">24.3.2. SPICE Logs for Guest Machines</a></li>
<li><a href="#SPICE_Logs_for_SPICE_Clients_Launched_Using_consolevv_Files">24.3.3. SPICE Logs for SPICE Clients Launched Using console.vv Files</a></li>
</ul>
</li>
<li><a href="#Host_Log_Files">24.4. Host Log Files</a></li>
<li><a href="#proc-setting_up_debug_level_logging">24.5. Setting debug-level logging for oVirt services</a></li>
<li><a href="#ref_debug_level_logging">24.6. Main configuration files for oVirt services</a></li>
<li><a href="#Setting_up_a_Host_Logging_Server">24.7. Setting Up a Host Logging Server</a></li>
<li><a href="#Enabling_the_oVirt_Engine_Extension_Logger_log4j">24.8. Enabling the oVirt Engine Extension Logger log4j</a></li>
</ul>
</li>
<li><a href="#appe-VDSM_and_Hooks">Appendix A: VDSM and Hooks</a>
<ul class="sectlevel2">
<li><a href="#VDSM">VDSM</a></li>
<li><a href="#VDSM_hooks">VDSM Hooks</a></li>
<li><a href="#Extending_VDSM_with_hooks">Extending VDSM with Hooks</a></li>
<li><a href="#proc_installing-a-vdsm-hook">Installing a VDSM hook</a></li>
<li><a href="#Supported_VDSM_events">Supported VDSM Events</a></li>
<li><a href="#VDSM_hooks_environment">The VDSM Hook Environment</a></li>
<li><a href="#VDSM_hooks_domain_xml">The VDSM Hook Domain XML Object</a></li>
<li><a href="#VDSM_hooks_defining_custom_properties">Defining Custom Properties</a></li>
<li><a href="#VDSM_hooks_setting_custom_properties">Setting Virtual Machine Custom Properties</a></li>
<li><a href="#VDSM_hooks_evaluating_custom_properties">Evaluating Virtual Machine Custom Properties in a VDSM Hook</a></li>
<li><a href="#VDSM_hooks_hooking_module">Using the VDSM Hooking Module</a></li>
<li><a href="#VDSM_hooks_execution">VDSM Hook Execution</a></li>
<li><a href="#VDSM_hooks_return_codes">VDSM Hook Return Codes</a></li>
<li><a href="#VDSM_hooks_examples">VDSM Hook Examples</a></li>
</ul>
</li>
<li><a href="#appe-Custom_Network_Properties">Appendix B: Custom Network Properties</a>
<ul class="sectlevel2">
<li><a href="#Explanation_of_bridge_opts_Parameters">Explanation of bridge_opts Parameters</a></li>
<li><a href="#How_to_Set_Up_Red_Hat_Enterprise_Virtualization_Manager_to_Use_Ethtool">How to Set Up oVirt Engine to Use Ethtool</a></li>
<li><a href="#How_to_Set_Up_RHVM_to_Use_FCoE">How to Set Up oVirt Engine to Use FCoE</a></li>
</ul>
</li>
<li><a href="#appe-Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">Appendix C: oVirt User Interface Plugins</a>
<ul class="sectlevel2">
<li><a href="#Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">oVirt User Interface Plug-ins</a></li>
<li><a href="#sect-Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Lifecycle">oVirt User Interface Plugin Lifecycle</a>
<ul class="sectlevel3">
<li><a href="#RHEV_UI_Plugin_Lifecycle">oVirt User Interface Plug-in Life cycle</a></li>
<li><a href="#Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Discovery">oVirt User Interface Plug-in Discovery</a></li>
<li><a href="#Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Loading">oVirt User Interface Plug-in Loading</a></li>
<li><a href="#Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Bootstrapping">oVirt User Interface Plug-in Bootstrapping</a></li>
</ul>
</li>
<li><a href="#UI_Plugin-related_Files_and_their_Locations">User Interface Plugin-related Files and Their Locations</a></li>
<li><a href="#Example_RHEV_UI_Plugin_Deployment">Example User Interface Plug-in Deployment</a></li>
</ul>
</li>
<li><a href="#appe-Red_Hat_Enterprise_Virtualization_and_SSL">Appendix D: oVirt and encrypted communication</a>
<ul class="sectlevel2">
<li><a href="#Replacing_the_Manager_CA_Certificate">Replacing the oVirt Engine CA Certificate</a></li>
<li><a href="#Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</a></li>
</ul>
</li>
<li><a href="#appe-Branding">Appendix E: Branding</a>
<ul class="sectlevel2">
<li><a href="#sect-Branding">Branding</a>
<ul class="sectlevel3">
<li><a href="#Re-Branding_the_Manager1">Re-Branding the Engine</a></li>
<li><a href="#Re-Branding_the_Manager">Login Screen</a></li>
<li><a href="#Administration_Portal_Screen">Administration Portal Screen</a></li>
<li><a href="#User_Portal_Screen">VM Portal Screen</a></li>
<li><a href="#Pop-up_Windows">Pop-Up Windows</a></li>
<li><a href="#Tabs">Tabs</a></li>
<li><a href="#The_Welcome_Page">The Welcome Page</a></li>
<li><a href="#The_File_Not_Found_Page">The Page Not Found Page</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appe-System_Accounts">Appendix F: System Accounts</a>
<ul class="sectlevel2">
<li><a href="#sect-System_Accounts">System Accounts</a>
<ul class="sectlevel3">
<li><a href="#Red_Hat_Enterprise_Virtualization_Manager_User_Accounts">oVirt Engine User Accounts</a></li>
<li><a href="#Red_Hat_Enterprise_Virtualization_Manager_Groups">oVirt Engine Groups</a></li>
<li><a href="#Virtualization_Host_User_Accounts">Virtualization Host User Accounts</a></li>
<li><a href="#Virtualization_Host_Groups">Virtualization Host Groups</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#legal-notice">Appendix G: Legal notice</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<h1 id="administration-guide" class="discrete">Administration Guide</h1>
</div>
</div>
<h1 id="part-Administering_and_Maintaining_the_Red_Hat_Virtualization_Environment" class="sect0">Administering and Maintaining the oVirt Environment</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>The oVirt environment requires an administrator to keep it running. As an administrator, your tasks include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Managing physical and virtual resources such as hosts and virtual machines. This includes upgrading and adding hosts, importing domains, converting virtual machines created on foreign hypervisors, and managing virtual machine pools.</p>
</li>
<li>
<p>Monitoring the overall system resources for potential problems such as extreme load on one of the hosts, insufficient memory or disk space, and taking any necessary actions (such as migrating virtual machines to other hosts to lessen the load or freeing resources by shutting down machines).</p>
</li>
<li>
<p>Responding to the new requirements of virtual machines (for example, upgrading the operating system or allocating more memory).</p>
</li>
<li>
<p>Managing customized object properties using tags.</p>
</li>
<li>
<p>Managing searches saved as <a href="#chap-Bookmarks">public bookmarks</a>.</p>
</li>
<li>
<p>Managing user setup and setting permission levels.</p>
</li>
<li>
<p>Troubleshooting for specific users or virtual machines for overall system functionality.</p>
</li>
<li>
<p>Generating general and specific reports.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Global_Configuration">1. Global Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Accessed by clicking <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>, the <strong>Configure</strong> window allows you to configure a number of global resources for your oVirt environment, such as users, roles, system permissions, scheduling policies, instance types, and MAC address pools. This window allows you to customize the way in which users interact with resources in the environment, and provides a central location for configuring options that can be applied to multiple clusters.</p>
</div>
<div class="sect2">
<h3 id="sect-Roles">1.1. Roles</h3>
<div class="paragraph">
<p>Roles are predefined sets of privileges that can be configured from oVirt Engine. Roles provide access and management permissions to different levels of resources in the data center, and to specific physical and virtual resources.</p>
</div>
<div class="paragraph">
<p>With multilevel administration, any permissions which apply to a container object also apply to all individual objects within that container. For example, when a host administrator role is assigned to a user on a specific host, the user gains permissions to perform any of the available host operations, but only on the assigned host. However, if the host administrator role is assigned to a user on a data center, the user gains permissions to perform host operations on all hosts within the cluster of the data center.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_new_role">1.1.1. Creating a New Role</h4>
<div class="paragraph">
<p>If the role you require is not on oVirt&#8217;s default list of roles, you can create a new role and customize it to suit your purposes.</p>
</div>
<div class="paragraph">
<p><strong>Creating a New Role</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>. This opens the <strong>Configure</strong> window. The <strong>Roles</strong> tab is selected by default, showing a list of default User and Administrator roles, and any custom roles.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the new role.</p>
</li>
<li>
<p>Select either <strong>Admin</strong> or <strong>User</strong> as the <strong>Account Type</strong>.</p>
</li>
<li>
<p>Use the <strong>Expand All</strong> or <strong>Collapse All</strong> buttons to view more or fewer of the permissions for the listed objects in the <strong>Check Boxes to Allow Action</strong> list. You can also expand or collapse the options for each object.</p>
</li>
<li>
<p>For each of the objects, select or clear the actions you want to permit or deny for the role you are setting up.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to apply the changes. The new role displays on the list of roles.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Editing_a_role">1.1.2. Editing or Copying a Role</h4>
<div class="paragraph">
<p>You can change the settings for roles you have created, but you cannot change default roles. To change default roles, clone and modify them to suit your requirements.</p>
</div>
<div class="paragraph">
<p><strong>Editing or Copying a Role</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>. This opens the <strong>Configure</strong> window, which shows a list of default User and Administrator roles, as well as any custom roles.</p>
</li>
<li>
<p>Select the role you wish to change.</p>
</li>
<li>
<p>Click <b class="button">Edit</b> or <b class="button">Copy</b>. This opens the <strong>Edit Role</strong> or <strong>Copy Role</strong> window.</p>
</li>
<li>
<p>If necessary, edit the <strong>Name</strong> and <strong>Description</strong> of the role.</p>
</li>
<li>
<p>Use the <strong>Expand All</strong> or <strong>Collapse All</strong> buttons to view more or fewer of the permissions for the listed objects. You can also expand or collapse the options for each object.</p>
</li>
<li>
<p>For each of the objects, select or clear the actions you wish to permit or deny for the role you are editing.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to apply the changes you have made.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Authorization_examples">1.1.3. User Role and Authorization Examples</h4>
<div class="paragraph">
<p>The following examples illustrate how to apply authorization controls for various scenarios, using the different features of the authorization system described in this chapter.</p>
</div>
<div id="VM_Cluster_Permissions-1" class="exampleblock">
<div class="title">Example 1. Cluster Permissions</div>
<div class="content">
<div class="paragraph">
<p>Sarah is the system administrator for the accounts department of a company. All the virtual resources for her department are organized under a oVirt <strong>cluster</strong> called <code>Accounts</code>. She is assigned the <strong>ClusterAdmin</strong> role on the accounts cluster. This enables her to manage all virtual machines in the cluster, since the virtual machines are child objects of the cluster. Managing the virtual machines includes editing, adding, or removing virtual resources such as disks, and taking snapshots. It does not allow her to manage any resources outside this cluster. Because <strong>ClusterAdmin</strong> is an administrator role, it allows her to use the Administration Portal or the VM Portal to manage these resources.</p>
</div>
</div>
</div>
<div id="VM_UserVmManager_Permissions-1" class="exampleblock">
<div class="title">Example 2. VM PowerUser Permissions</div>
<div class="content">
<div class="paragraph">
<p>John is a software developer in the accounts department. He uses virtual machines to build and test his software. Sarah has created a virtual desktop called <code>johndesktop</code> for him. John is assigned the <strong>UserVmManager</strong> role on the <code>johndesktop</code> virtual machine. This allows him to access this single virtual machine using the VM Portal. Because he has <strong>UserVmManager</strong> permissions, he can modify the virtual machine. Because <strong>UserVmManager</strong> is a user role, it does not allow him to use the Administration Portal.</p>
</div>
</div>
</div>
<div id="DataCenter_Power_User_Role_Permissions-1" class="exampleblock">
<div class="title">Example 3. Data Center Power User Role Permissions</div>
<div class="content">
<div class="paragraph">
<p>Penelope is an office manager. In addition to her own responsibilities, she occasionally helps the HR manager with recruitment tasks, such as scheduling interviews and following up on reference checks. As per corporate policy, Penelope needs to use a particular application for recruitment tasks.</p>
</div>
<div class="paragraph">
<p>While Penelope has her own machine for office management tasks, she wants to create a separate virtual machine to run the recruitment application. She is assigned <strong>PowerUserRole</strong> permissions for the data center in which her new virtual machine will reside. This is because to create a new virtual machine, she needs to make changes to several components within the data center, including creating the virtual disk in the storage domain.</p>
</div>
<div class="paragraph">
<p>Note that this is not the same as assigning <strong>DataCenterAdmin</strong> privileges to Penelope. As a PowerUser for a data center, Penelope can log in to the VM Portal and perform virtual machine-specific actions on virtual machines within the data center. She cannot perform data center-level operations such as attaching hosts or storage to a data center.</p>
</div>
</div>
</div>
<div id="Network_Role_Permissions" class="exampleblock">
<div class="title">Example 4. Network Administrator Permissions</div>
<div class="content">
<div class="paragraph">
<p>Chris works as the network administrator in the IT department. Her day-to-day responsibilities include creating, manipulating, and removing networks in the department&#8217;s oVirt environment. For her role, she requires administrative privileges on the resources and on the networks of each resource. For example, if Chris has <strong>NetworkAdmin</strong> privileges on the IT department&#8217;s data center, she can add and remove networks in the data center, and attach and detach networks for all virtual machines belonging to the data center.</p>
</div>
</div>
</div>
<div id="Custom_Role_Permissions-1" class="exampleblock">
<div class="title">Example 5. Custom Role Permissions</div>
<div class="content">
<div class="paragraph">
<p>Rachel works in the IT department, and is responsible for managing user accounts in oVirt. She needs permission to add user accounts and assign them the appropriate roles and permissions. She does not use any virtual machines herself, and should not have access to administration of hosts, virtual machines, clusters or data centers. There is no built-in role which provides her with this specific set of permissions. A custom role must be created to define the set of permissions appropriate to Rachel&#8217;s position.</p>
</div>
<div id="rhv-object-hierarchy" class="imageblock">
<div class="content">
<img src="images/UserManagerRole.png" alt="UserManagerRole">
</div>
<div class="title">Figure 1. UserManager Custom Role</div>
</div>
<div class="paragraph">
<p>The <strong>UserManager</strong> custom role shown above allows manipulation of users, permissions and roles. These actions are organized under <strong>System</strong> - the top level object of the hierarchy shown in <a href="#rhev-object-hierarchy-2">oVirt Object Hierarchy</a>. This means they apply to all other objects in the system. The role is set to have an <strong>Account Type</strong> of <strong>Admin</strong>. This means that when she is assigned this role, Rachel can use both the Administration Portal and the VM Portal.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-System_Permissions">1.2. System Permissions</h3>
<div class="paragraph">
<p>Permissions enable users to perform actions on objects, where objects are either individual objects or container objects. Any permissions that apply to a container object also apply to all members of that container.</p>
</div>
<div id="rhev-roles-permissions" class="imageblock">
<div class="content">
<img src="images/496.png" alt="496">
</div>
<div class="title">Figure 2. Permissions &amp; Roles</div>
</div>
<div id="rhev-object-hierarchy-2" class="imageblock">
<div class="content">
<img src="images/492.png" alt="492">
</div>
<div class="title">Figure 3. oVirt Object Hierarchy</div>
</div>
<div class="sect3">
<h4 id="User_properties">1.2.1. User Properties</h4>
<div class="paragraph">
<p>Roles and permissions are the properties of the user. Roles are predefined sets of privileges that permit access to different levels of physical and virtual resources. Multilevel administration provides a finely grained hierarchy of permissions. For example, a data center administrator has permissions to manage all objects in the data center, while a host administrator has system administrator permissions to a single physical host. A user can have permissions to use a single virtual machine but not make any changes to the virtual machine configurations, while another user can be assigned system permissions to a virtual machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="User_properties_roles">1.2.2. User and Administrator Roles</h4>
<div class="paragraph">
<p>oVirt provides a range of pre-configured roles, from an administrator with system-wide permissions to an end user with access to a single virtual machine. While you cannot change or remove the default roles, you can clone and customize them, or create new roles according to your requirements. There are two types of roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Administrator Role: Allows access to the <strong>Administration Portal</strong> for managing physical and virtual resources. An administrator role confers permissions for actions to be performed in the VM Portal; however, it has no bearing on what a user can see in the VM Portal.</p>
</li>
<li>
<p>User Role: Allows access to the <strong>VM Portal</strong> for managing and accessing virtual machines and templates. A user role determines what a user can see in the VM Portal. Permissions granted to a user with an administrator role are reflected in the actions available to that user in the VM Portal.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="User_Roles_Explained">1.2.3. User Roles Explained</h4>
<div class="paragraph">
<p>The table below describes basic user roles which confer permissions to access and configure virtual machines in the VM Portal.</p>
</div>
<table id="User_Roles_Basic" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. oVirt User Roles - Basic</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserRole</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can access and use virtual machines and pools.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can log in to the VM Portal, use assigned virtual machines and pools, view virtual machine state and details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PowerUserRole</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create and manage virtual machines and templates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apply this role to a user for the whole environment with the <strong>Configure</strong> window, or for specific data centers or clusters. For example, if a PowerUserRole is applied on a data center level, the PowerUser can create virtual machines and templates in the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserVmManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System administrator of a virtual machine.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can manage virtual machines and create and use snapshots. A user who creates a virtual machine in the VM Portal is automatically assigned the UserVmManager role on the machine.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The table below describes advanced user roles which allow you to do more fine tuning of permissions for resources in the VM Portal.</p>
</div>
<table id="User_Roles_Advanced" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. oVirt User Roles - Advanced</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UserTemplateBasedVm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limited privileges to only use Templates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use templates to create virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DiskOperator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual disk user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use, view and edit virtual disks. Inherits permissions to use the virtual machine to which the virtual disk is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VmCreator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create virtual machines in the VM Portal.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This role is not applied to a specific virtual machine; apply this role to a user for the whole environment with the <strong>Configure</strong> window. Alternatively apply this role for specific data centers or clusters. When applying this role to a cluster, you must also apply the DiskCreator role on an entire data center, or on specific storage domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TemplateCreator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, edit, manage and remove virtual machine templates within assigned resources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This role is not applied to a specific template; apply this role to a user for the whole environment with the <strong>Configure</strong> window. Alternatively apply this role for specific data centers, clusters, or storage domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DiskCreator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, edit, manage and remove virtual disks within assigned clusters or data centers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This role is not applied to a specific virtual disk; apply this role to a user for the whole environment with the <strong>Configure</strong> window. Alternatively apply this role for specific data centers or storage domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TemplateOwner</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can edit and delete the template, assign and manage user permissions for the template.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This role is automatically assigned to the user who creates a template. Other users who do not have <strong>TemplateOwner</strong> permissions on a template cannot view or use the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VnicProfileUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical network and network interface user for virtual machine and template.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can attach or detach network interfaces from specific logical networks.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Administrator_Roles_Explained">1.2.4. Administrator Roles Explained</h4>
<div class="paragraph">
<p>The table below describes basic administrator roles which confer permissions to access and configure resources in the Administration Portal.</p>
</div>
<table id="Admin_Roles_Basic" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. oVirt System Administrator Roles - Basic</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SuperUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Administrator of the oVirt environment.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Has full permissions across all objects and levels, can manage all objects across all data centers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possesses administrative permissions for all objects underneath a specific cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataCenterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Center Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Possesses administrative permissions for all objects underneath a specific data center except for storage.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the administrative user for the directory server as the oVirt administrative user. Create a user in the directory server specifically for use as the oVirt administrative user.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The table below describes advanced administrator roles which allow you to do more fine tuning of permissions for resources in the Administration Portal.</p>
</div>
<table id="Admin_Roles_Advanced" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. oVirt System Administrator Roles - Advanced</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TemplateAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator of a virtual machine template.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, and configure the storage domains and network details of templates, and move templates between domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StorageAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, configure, and manage an assigned storage domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HostAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can attach, remove, configure, and manage a specific host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can configure and manage the network of a particular data center or cluster. A network administrator of a data center or cluster inherits network permissions for virtual pools within the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VmPoolAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Administrator of a virtual pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, and configure a virtual pool; assign and remove virtual pool users; and perform basic operations on a virtual machine in the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlusterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gluster Storage Administrator.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, configure, and manage Gluster storage volumes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VmImporterExporter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import and export Administrator of a virtual machine.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can import and export virtual machines. Able to view all virtual machines and templates exported by other users.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Assigning_an_Administrator_or_User_Role_to_a_Resource">1.2.5. Assigning an Administrator or User Role to a Resource</h4>
<div class="paragraph">
<p>Assign administrator or user roles to resources to allow users to access or manage that resource.</p>
</div>
<div class="paragraph">
<p><strong>Assigning a Role to a Resource</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find and click the resource&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Permissions</strong> tab to list the assigned users, each user&#8217;s role, and the inherited permissions for the selected resource.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter the name or user name of an existing user into the <strong>Search</strong> text box and click <strong>Go</strong>. Select a user from the resulting list of possible matches.</p>
</li>
<li>
<p>Select a role from the <strong>Role to Assign</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The user now has the inherited permissions of that role enabled for that resource.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Avoid assigning global permissions to regular users on resources such as clusters because permissions are automatically inherited by resources that are lower in a system&#8217;s hierarchy.  Set <code>UserRole</code> and all other user role permissions on specific resources such as virtual machines, pools or virtual machine pools, especially the latter.</p>
</div>
<div class="paragraph">
<p>Assigning global permissions can cause two problems due to the inheritance of permissions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A regular user can automatically be granted permission to control virtual machine pools, even if the administrator assigning permissions did not intend for this to happen.</p>
</li>
<li>
<p>The virtual machine portal might behave unexpectedly with pools.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Therefore, it is strongly recommended to set <code>UserRole</code> and all other user role permissions on specific resources only, especially virtual machine pool resources, and not on resources from which other resources inherit permissions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Removing_an_Administrator_or_User_Role_from_a_Resource">1.2.6. Removing an Administrator or User Role from a Resource</h4>
<div class="paragraph">
<p>Remove an administrator or user role from a resource; the user loses the inherited permissions associated with the role for that resource.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Role from a Resource</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find and click the resource&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Permissions</strong> tab to list the assigned users, the user&#8217;s role, and the inherited permissions for the selected resource.</p>
</li>
<li>
<p>Select the user to remove from the resource.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Data_center_system_permissions">1.2.7. Managing System Permissions for a Data Center</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A data center administrator is a system administration role for a specific data center only. This is useful in virtualization environments with multiple data centers where each data center requires an administrator. The <strong>DataCenterAdmin</strong> role is a hierarchical model; a user assigned the data center administrator role for a data center can manage all objects in the data center with the exception of storage for that data center. Use the <strong>Configure</strong> button in the header bar to assign a data center administrator for all data centers in the environment.</p>
</div>
<div class="paragraph">
<p>The data center administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and remove clusters associated with the data center.</p>
</li>
<li>
<p>Add and remove hosts, virtual machines, and pools associated with the data center.</p>
</li>
<li>
<p>Edit user permissions for virtual machines associated with the data center.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only assign roles and permissions to existing users.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can change the system administrator of a data center by removing the existing system administrator and adding the new system administrator.</p>
</div>
</div>
<div class="sect3">
<h4 id="Data_center_permissions_entities">1.2.8. Data Center Administrator Roles Explained</h4>
<div class="paragraph">
<p><strong>Data Center Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator roles and privileges applicable to data center administration.</p>
</div>
<table id="Data_Center_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataCenterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Center Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use, create, delete, manage all physical and virtual resources within a specific data center except for storage, including clusters, hosts, templates and virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can configure and manage the network of a particular data center. A network administrator of a data center inherits network permissions for virtual machines within the data center as well.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Managing_system_permissions_for_a_cluster">1.2.9. Managing System Permissions for a Cluster</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A cluster administrator is a system administration role for a specific cluster only. This is useful in data centers with multiple clusters, where each cluster requires a system administrator. The <strong>ClusterAdmin</strong> role is a hierarchical model: a user assigned the cluster administrator role for a cluster can manage all objects in the cluster. Use the <strong>Configure</strong> button in the header bar to assign a cluster administrator for all clusters in the environment.</p>
</div>
<div class="paragraph">
<p>The cluster administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create and remove associated clusters.</p>
</li>
<li>
<p>Add and remove hosts, virtual machines, and pools associated with the cluster.</p>
</li>
<li>
<p>Edit user permissions for virtual machines associated with the cluster.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only assign roles and permissions to existing users.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also change the system administrator of a cluster by removing the existing system administrator and adding the new system administrator.</p>
</div>
</div>
<div class="sect3">
<h4 id="Cluster_permissions_entities">1.2.10. Cluster Administrator Roles Explained</h4>
<div class="paragraph">
<p><strong>Cluster Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator roles and privileges applicable to cluster administration.</p>
</div>
<table id="Cluster_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use, create, delete, manage all physical and virtual resources in a specific cluster, including hosts, templates and virtual machines. Can configure network properties within the cluster such as designating display networks, or marking a network as required or non-required.</p>
<p class="tableblock">However, a <strong>ClusterAdmin</strong> does not have permissions to attach or detach networks from a cluster, to do so <strong>NetworkAdmin</strong> permissions are required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can configure and manage the network of a particular cluster. A network administrator of a cluster inherits network permissions for virtual machines within the cluster as well.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Managing_System_Permissions_for_a_Network">1.2.11. Managing System Permissions for a Network</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A network administrator is a system administration role that can be applied for a specific network, or for all networks on a data center, cluster, host, virtual machine, or template. A network user can perform limited administration roles, such as viewing and attaching networks on a specific virtual machine or template. You can use the <strong>Configure</strong> button in the header bar to assign a network administrator for all networks in the environment.</p>
</div>
<div class="paragraph">
<p>The network administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create, edit and remove networks.</p>
</li>
<li>
<p>Edit the configuration of the network, including configuring port mirroring.</p>
</li>
<li>
<p>Attach and detach networks from resources including clusters and virtual machines.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The user who creates a network is automatically assigned <strong>NetworkAdmin</strong> permissions on the created network. You can also change the administrator of a network by removing the existing administrator and adding the new administrator.</p>
</div>
</div>
<div class="sect3">
<h4 id="Network_Administrator_and_User_Roles_Explained">1.2.12. Network Administrator and User Roles Explained</h4>
<div class="paragraph">
<p><strong>Network Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator and user roles and privileges applicable to network administration.</p>
</div>
<table id="Network_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. oVirt Network Administrator and User Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NetworkAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network Administrator for data center, cluster, host, virtual machine, or template. The user who creates a network is automatically assigned <strong>NetworkAdmin</strong> permissions on the created network.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can configure and manage the network of a particular data center, cluster, host, virtual machine, or template. A network administrator of a data center or cluster inherits network permissions for virtual pools within the cluster. To configure port mirroring on a virtual machine network, apply the <strong>NetworkAdmin</strong> role on the network and the <strong>UserVmManager</strong> role on the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VnicProfileUser</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical network and network interface user for virtual machine and template.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can attach or detach network interfaces from specific logical networks.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="To_view_hosts_in_a_cluster">1.2.13. Managing System Permissions for a Host</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A host administrator is a system administration role for a specific host only. This is useful in clusters with multiple hosts, where each host requires a system administrator. You can use the <strong>Configure</strong> button in the header bar to assign a host administrator for all hosts in the environment.</p>
</div>
<div class="paragraph">
<p>The host administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the configuration of the host.</p>
</li>
<li>
<p>Set up the logical networks.</p>
</li>
<li>
<p>Remove the host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also change the system administrator of a host by removing the existing system administrator and adding the new system administrator.</p>
</div>
</div>
<div class="sect3">
<h4 id="To_view_virtual_machines_in_a_cluster">1.2.14. Host Administrator Roles Explained</h4>
<div class="paragraph">
<p><strong>Host Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator roles and privileges applicable to host administration.</p>
</div>
<table id="Host_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HostAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can configure, manage, and remove a specific host. Can also perform network-related operations on a specific host.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Cluster_hosts_entities">1.2.15. Managing System Permissions for a Storage Domain</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A storage administrator is a system administration role for a specific storage domain only. This is useful in data centers with multiple storage domains, where each storage domain requires a system administrator. Use the <strong>Configure</strong> button in the header bar to assign a storage administrator for all storage domains in the environment.</p>
</div>
<div class="paragraph">
<p>The storage domain administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the configuration of the storage domain.</p>
</li>
<li>
<p>Move the storage domain into maintenance mode.</p>
</li>
<li>
<p>Remove the storage domain.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only assign roles and permissions to existing users.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also change the system administrator of a storage domain by removing the existing system administrator and adding the new system administrator.</p>
</div>
</div>
<div class="sect3">
<h4 id="Cluster_virtual_machine_entities">1.2.16. Storage Administrator Roles Explained</h4>
<div class="paragraph">
<p><strong>Storage Domain Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator roles and privileges applicable to storage domain administration.</p>
</div>
<table id="Storage_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">StorageAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, configure and manage a specific storage domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GlusterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gluster Storage Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, configure and manage Gluster storage volumes.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Data_center_logical_network_entities">1.2.17. Managing System Permissions for a Virtual Machine Pool</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>A virtual machine pool administrator is a system administration role for virtual machine pools in a data center. This role can be applied to specific virtual machine pools, to a data center, or to the whole virtualized environment; this is useful to allow different users to manage certain virtual machine pool resources.</p>
</div>
<div class="paragraph">
<p>The virtual machine pool administrator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create, edit, and remove pools.</p>
</li>
<li>
<p>Add and detach virtual machines from the pool.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only assign roles and permissions to existing users.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Cluster_logical_network_entities">1.2.18. Virtual Machine Pool Administrator Roles Explained</h4>
<div class="paragraph">
<p><strong>Pool Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the administrator roles and privileges applicable to pool administration.</p>
</div>
<table id="Pool_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VmPoolAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Administrator role of a virtual pool.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, delete, and configure a virtual pool, assign and remove virtual pool users, and perform basic operations on a virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterAdmin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Administrator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use, create, delete, manage all virtual machine pools in a specific cluster.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Managing_System_Permissions_for_a_Virtual_Disk">1.2.19. Managing System Permissions for a Virtual Disk</h4>
<div class="paragraph">
<p>As the <strong>SuperUser</strong>, the system administrator manages all aspects of the Administration Portal. More specific administrative roles can be assigned to other users. These restricted administrator roles are useful for granting a user administrative privileges that limit them to a specific resource. For example, a <strong>DataCenterAdmin</strong> role has administrator privileges only for the assigned data center with the exception of the storage for that data center, and a <strong>ClusterAdmin</strong> has administrator privileges only for the assigned cluster.</p>
</div>
<div class="paragraph">
<p>oVirt Engine provides two default virtual disk user roles, but no default virtual disk administrator roles. One of these user roles, the <strong>DiskCreator</strong> role, enables the administration of virtual disks from the VM Portal. This role can be applied to specific virtual machines, to a data center, to a specific storage domain, or to the whole virtualized environment; this is useful to allow different users to manage different virtual resources.</p>
</div>
<div class="paragraph">
<p>The virtual disk creator role permits the following actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create, edit, and remove virtual disks associated with a virtual machine or other resources.</p>
</li>
<li>
<p>Edit user permissions for virtual disks.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can only assign roles and permissions to existing users.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Virtual_Disk_User_Roles_Explained">1.2.20. Virtual Disk User Roles Explained</h4>
<div class="paragraph">
<p><strong>Virtual Disk User Permission Roles</strong></p>
</div>
<div class="paragraph">
<p>The table below describes the user roles and privileges applicable to using and administrating virtual disks in the VM Portal.</p>
</div>
<table id="Virtual_Disk_Administrator_Roles" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. oVirt System Administrator Roles</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Role</th>
<th class="tableblock halign-left valign-top">Privileges</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DiskOperator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual disk user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can use, view and edit virtual disks. Inherits permissions to use the virtual machine to which the virtual disk is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DiskCreator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can create, edit, manage and remove virtual disks within assigned clusters or data centers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This role is not applied to a specific virtual disk; apply this role to a user for the whole environment with the <strong>Configure</strong> window. Alternatively apply this role for specific data centers, clusters, or storage domains.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Setting_Legacy_SPICE_Cipher_system_permissions">1.2.21. Setting a Legacy SPICE Cipher</h4>
<div class="paragraph">
<p>SPICE consoles use FIPS-compliant encryption by default, with a cipher string. The default SPICE cipher string is:
<code>kECDHE+FIPS:kDHE+FIPS:kRSA+FIPS:!eNULL:!aNULL</code></p>
</div>
<div class="paragraph">
<p>This string is generally sufficient. However, if you have a virtual machine with an older operating system or SPICE client, where either one or the other does not support FIPS-compliant encryption, you must use a weaker cipher string. Otherwise, a connection security error may occur if you install a new cluster or a new host in an existing cluster and try to connect to that virtual machine.</p>
</div>
<div class="paragraph">
<p>You can change the cipher string by using an Ansible playbook.</p>
</div>
<div class="paragraph">
<p><strong>Changing the cipher string</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, create a file in the directory <code class="filename">/usr/share/ovirt-engine/playbooks</code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</pre>
</div>
</div>
</li>
<li>
<p>Enter the following in the file and save it:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml">name: oVirt - setup weaker SPICE encryption for old clients
hosts: <em>hostname</em>
vars:
  host_deploy_spice_cipher_string: 'DEFAULT:-RC4:-3DES:-DES'
roles:
  - ovirt-host-deploy-spice-encryption</code></pre>
</div>
</div>
</li>
<li>
<p>Run the file you just created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook -l <em>hostname</em> /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, you can reconfigure the host with the Ansible playbook <code>ovirt-host-deploy</code>  using the  <code>--extra-vars</code> option  with the variable <code>host_deploy_spice_cipher_string</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook -l <em>hostname</em> \
  --extra-vars host_deploy_spice_cipher_string=DEFAULT:-RC4:-3DES:-DES \
  /usr/share/ovirt-engine/playbooks/ovirt-host-deploy.yml</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Scheduling_Policies">1.3. Scheduling Policies</h3>
<div class="paragraph">
<p>A scheduling policy is a set of rules that defines the logic by which virtual machines are distributed amongst hosts in the cluster that scheduling policy is applied to. Scheduling policies determine this logic via a combination of filters, weightings, and a load balancing policy. The filter modules apply hard enforcement and filter out hosts that do not meet the conditions specified by that filter. The weights modules apply soft enforcement, and are used to control the relative priority of factors considered when determining the hosts in a cluster on which a virtual machine can run.</p>
</div>
<div class="paragraph">
<p>The oVirt Engine provides five default scheduling policies: <strong>Evenly_Distributed</strong>, <strong>Cluster_Maintenance</strong>, <strong>None</strong>, <strong>Power_Saving</strong>, and <strong>VM_Evenly_Distributed</strong>. You can also define new scheduling policies that provide fine-grained control over the distribution of virtual machines. Regardless of the scheduling policy, a virtual machine will not start on a host with an overloaded CPU. By default, a host&#8217;s CPU is considered overloaded if it has a load of more than 80% for 5 minutes, but these values can be changed using scheduling policies. See <a href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</a> in the <em>Administration Guide</em> for more information about the properties of each scheduling policy.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/RHV_SchedulingPolicies_444396_0417_ECE_EvenlyDistributed.png" alt="RHV SchedulingPolicies 444396 0417 ECE EvenlyDistributed">
</div>
<div class="title">Figure 4. Evenly Distributed Scheduling Policy</div>
</div>
<div class="paragraph">
<p>The <strong>Evenly_Distributed</strong> scheduling policy distributes the memory and CPU processing load evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <strong>CpuOverCommitDurationMinutes</strong>, <strong>HighUtilization</strong>, or <strong>MaxFreeMemoryForOverUtilized</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>VM_Evenly_Distributed</strong> scheduling policy distributes virtual machines evenly between hosts based on a count of the virtual machines. The cluster is considered unbalanced if any host is running more virtual machines than the <strong>HighVmCount</strong> and there is at least one host with a virtual machine count that falls outside of the <strong>MigrationThreshold</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/RHV_SchedulingPolicies_444396_0417_ECE_PowerSaving.png" alt="RHV SchedulingPolicies 444396 0417 ECE PowerSaving">
</div>
<div class="title">Figure 5. Power Saving Scheduling Policy</div>
</div>
<div class="paragraph">
<p>The <strong>Power_Saving</strong> scheduling policy distributes the memory and CPU processing load across a subset of available hosts to reduce power consumption on underutilized hosts. Hosts with a CPU load below the low utilization value for longer than the defined time interval will migrate all virtual machines to other hosts so that it can be powered down. Additional virtual machines attached to a host will not start if that host has reached the defined high utilization value.</p>
</div>
<div class="paragraph">
<p>Set the <strong>None</strong> policy to have no load or power sharing between hosts for running virtual machines. This is the default mode. When a virtual machine is started, the memory and CPU processing load is spread evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <strong>CpuOverCommitDurationMinutes</strong>, <strong>HighUtilization</strong>, or <strong>MaxFreeMemoryForOverUtilized</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>Cluster_Maintenance</strong> scheduling policy limits activity in a cluster during maintenance tasks. When the <strong>Cluster_Maintenance</strong> policy is set, no new virtual machines may be started, except highly available virtual machines. If host failure occurs, highly available virtual machines will restart properly and any virtual machine can migrate.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_Scheduling_Policy">1.3.1. Creating a Scheduling Policy</h4>
<div class="paragraph">
<p>You can create new scheduling policies to control the logic by which virtual machines are distributed amongst a given cluster in your oVirt environment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>Scheduling Policies</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong> for the scheduling policy.</p>
</li>
<li>
<p>Configure filter modules:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Filter Modules</strong> section, drag and drop the preferred filter modules to apply to the scheduling policy from the <strong>Disabled Filters</strong> section into the <strong>Enabled Filters</strong> section.</p>
</li>
<li>
<p>Specific filter modules can also be set as the <strong>First</strong>, to be given highest priority, or <strong>Last</strong>, to be given lowest priority, for basic optimization. To set the priority, right-click any filter module, hover the cursor over <strong>Position</strong> and select <strong>First</strong> or <strong>Last</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure weight modules:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Weights Modules</strong> section, drag and drop the preferred weights modules to apply to the scheduling policy from the <strong>Disabled Weights</strong> section into the <strong>Enabled Weights &amp; Factors</strong> section.</p>
</li>
<li>
<p>Use the <strong>+</strong> and <strong>-</strong> buttons to the left of the enabled weight modules to increase or decrease the weight of those modules.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Specify a load balancing policy:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the drop-down menu in the <strong>Load Balancer</strong> section, select the load balancing policy to apply to the scheduling policy.</p>
</li>
<li>
<p>From the drop-down menu in the <strong>Properties</strong> section, select a load balancing property to apply to the scheduling policy and use the text field to the right of that property to specify a value.</p>
</li>
<li>
<p>Use the <strong>+</strong> and <strong>-</strong> buttons to add or remove additional properties.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Explanation_of_Settings_in_the_New_Scheduling_Policy_and_Edit_Scheduling_Policy_Window">1.3.2. Explanation of Settings in the New Scheduling Policy and Edit Scheduling Policy Window</h4>
<div class="paragraph">
<p>The following table details the options available in the <strong>New Scheduling Policy</strong> and <strong>Edit Scheduling Policy</strong> windows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. New Scheduling Policy and Edit Scheduling Policy Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the scheduling policy. This is the name used to refer to the scheduling policy in the oVirt Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the scheduling policy. This field is recommended but not mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Filter Modules</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A set of filters for controlling the hosts on which a virtual machine in a cluster can run. Enabling a filter will filter out hosts that do not meet the conditions specified by that filter, as outlined below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClusterInMaintenance</code>: Virtual machines being started on the host that are not configured for high availability filter out the host.</p>
</li>
<li>
<p><code>CpuPinning</code>: Hosts which do not satisfy the CPU pinning definition.</p>
</li>
<li>
<p><code>Migration</code>: Prevents migration to the same host.</p>
</li>
<li>
<p><code>CPUOverloaded</code>: Hosts with CPU usage that is above the defined <strong>HighUtilization</strong> threshold for the interval defined by the <strong>CpuOverCommitDurationMinutes</strong>.</p>
</li>
<li>
<p><code>PinToHost</code>: Hosts other than the host to which the virtual machine is pinned.</p>
</li>
<li>
<p><code>CPU-Level</code>: Hosts that do not meet the CPU topology of the virtual machine.</p>
</li>
<li>
<p><code>VmAffinityGroups</code>: Hosts that do not meet the affinity rules defined for the virtual machine.</p>
</li>
<li>
<p><code>NUMA</code>: Hosts that do not have NUMA nodes that can accommodate the virtual machine vNUMA nodes in terms of resources.</p>
</li>
<li>
<p><code>InClusterUpgrade</code>: Hosts that are running an earlier version of the operating system than the host that the virtual machine currently runs on.</p>
</li>
<li>
<p><code>MDevice</code>: Hosts that do not provide the required mediated device (mDev).</p>
</li>
<li>
<p><code>Memory</code>: Hosts that do not have sufficient memory to run the virtual machine.</p>
</li>
<li>
<p><code>CPU</code>: Hosts with fewer CPUs than the number assigned to the virtual machine.</p>
</li>
<li>
<p><code>HostedEnginesSpares</code>: Reserves space for the Engine virtual machine on a specified number of self-hosted engine nodes.</p>
</li>
<li>
<p><code>Swap</code>: Hosts that are not swapping within the threshold.</p>
</li>
<li>
<p><code>VM leases ready</code>: Hosts that do not support virtual machines configured with storage leases.</p>
</li>
<li>
<p><code>VmToHostsAffinityGroups</code>: Group of hosts that do not meet the conditions specified for a virtual machine that is a member of an affinity group. For example, that virtual machines in an affinity group must run on one of the hosts in a group or on a separate host that is excluded from the group.</p>
</li>
<li>
<p><code>HostDevice</code>: Hosts that do not support host devices required by the virtual machine.</p>
</li>
<li>
<p><code>HA</code>: Forces the Engine virtual machine in a self-hosted engine environment to run only on hosts with a positive high availability score.</p>
</li>
<li>
<p><code>Emulated-Machine</code>: Hosts which do not have proper emulated machine support.</p>
</li>
<li>
<p><code>HugePages</code>: Hosts that do not meet the required number of Huge Pages needed for the virtual machine&#8217;s memory.</p>
</li>
<li>
<p><code>Migration-Tsc-Frequency</code>: Hosts that do not have virtual machines with the same TSC frequency as the host currently running the virtual machine.</p>
</li>
<li>
<p><code>Network</code>: Hosts on which networks required by the network interface controller of a virtual machine are not installed, or on which the cluster&#8217;s display network is not installed.</p>
</li>
<li>
<p><code>Label</code>: Hosts that do not have the required affinity labels.</p>
</li>
<li>
<p><code>Compatibility-Version</code>: Hosts that do not have the correct cluster compatibility version support.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Weights Modules</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A set of weightings for controlling the relative priority of factors considered when determining the hosts in a cluster on which a virtual machine can run.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VmAffinityGroups</code>: Weights hosts in accordance with the affinity groups defined for virtual machines. This weight module determines how likely virtual machines in an affinity group are to run on the same host or on separate hosts in accordance with the parameters of that affinity group.</p>
</li>
<li>
<p><code>InClusterUpgrade</code>: Weight hosts in accordance with their operating system version. The weight penalizes hosts with earlier operating systems more than hosts with the same operating system as the host that the virtual machine is currently running on. This ensures that priority is always given to hosts with later operating systems.</p>
</li>
<li>
<p><code>OptimalForCpuEvenDistribution</code>: Weights hosts in accordance with their CPU usage, giving priority to hosts with lower CPU usage.</p>
</li>
<li>
<p><code>CPU for high performance VMs</code>: Prefers hosts that have more or an equal number of sockets, cores and threads than the VM.</p>
</li>
<li>
<p><code>HA</code>: Weights hosts in accordance with their high availability score.</p>
</li>
<li>
<p><code>OptimalForCpuPowerSaving</code>: Weights hosts in accordance with their CPU usage, giving priority to hosts with higher CPU usage.</p>
</li>
<li>
<p><code>OptimalForMemoryPowerSaving</code>: Weights hosts in accordance with their memory usage, giving priority to hosts with lower available memory.</p>
</li>
<li>
<p><code>CPU and NUMA pinning compatibility</code>: Weights hosts in accordance to pinning compatibility. When a virtual machine has both vNUMA and pinning defined, this weight module gives preference to hosts whose CPU pinning does not clash with the vNUMA pinning.</p>
</li>
<li>
<p><code>VmToHostsAffinityGroups</code>: Weights hosts in accordance with the affinity groups defined for virtual machines. This weight module determines how likely virtual machines in an affinity group are to run on one of the hosts in a group or on a separate host that is excluded from the group.</p>
</li>
<li>
<p><code>OptimalForEvenGuestDistribution</code>: Weights hosts in accordance with the number of virtual machines running on those hosts.</p>
</li>
<li>
<p><code>OptimalForHaReservation</code>: Weights hosts in accordance with their high availability score.</p>
</li>
<li>
<p><code>OptimalForMemoryEvenDistribution</code>: Weights hosts in accordance with their memory usage, giving priority to hosts with higher available memory.</p>
</li>
<li>
<p><code>Fit VM to single host NUMA node</code>: Weights hosts in accordance to whether a virtual machine fits into a single NUMA node. When a virtual machine does not have vNUMA defined, this weight module gives preference to hosts that can fit the virtual machine into a single physical NUMA.</p>
</li>
<li>
<p><code>PreferredHosts</code>: Preferred hosts have priority during virtual machine setup.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Load Balancer</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This drop-down menu allows you to select a load balancing module to apply. Load balancing modules determine the logic used to migrate virtual machines from hosts experiencing high usage to hosts experiencing lower usage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Properties</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This drop-down menu allows you to add or remove properties for load balancing modules, and is only available when you have selected a load balancing module for the scheduling policy. No properties are defined by default, and the properties that are available are specific to the load balancing module that is selected. Use the <strong>+</strong> and <strong>-</strong> buttons to add or remove additional properties to or from the load balancing module.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Instance_Types">1.4. Instance Types</h3>
<div class="paragraph">
<p>Instance types can be used to define the hardware configuration of a virtual machine. Selecting an instance type when creating or editing a virtual machine will automatically fill in the hardware configuration fields. This allows users to create multiple virtual machines with the same hardware configuration without having to manually fill in every field.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Support for instance types is now deprecated, and will be removed in a future release.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A set of predefined instance types are available by default, as outlined in the following table:</p>
</div>
<table id="Predef_Instance_Types" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Predefined Instance Types</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Memory</th>
<th class="tableblock halign-left valign-top">vCPUs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiny</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512 MB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XLarge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 GB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Administrators can also create, edit, and remove instance types from the <strong>Instance Types</strong> tab of the <strong>Configure</strong> window.</p>
</div>
<div class="paragraph">
<p>Fields in the <strong>New Virtual Machine</strong> and <strong>Edit Virtual Machine</strong> windows that are bound to an instance type have a chain link image next to them (<span class="image"><img src="images/6121.png" alt="6121"></span>). If the value of one of these fields is changed, the virtual machine will be detached from the instance type, changing to <strong>Custom</strong>, and the chain will appear broken (<span class="image"><img src="images/6122.png" alt="6122"></span>). However, if the value is changed back, the chain will relink and the instance type will move back to the selected one.</p>
</div>
<div class="sect3">
<h4 id="Creating_Instance_Types">1.4.1. Creating Instance Types</h4>
<div class="paragraph">
<p>Administrators can create new instance types, which can then be selected by users when creating or editing virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Creating an Instance Type</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>Instance Types</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong> for the instance type.</p>
</li>
<li>
<p>Click <strong>Show Advanced Options</strong> and configure the instance type&#8217;s settings as required. The settings that appear in the <strong>New Instance Type</strong> window are identical to those in the <strong>New Virtual Machine</strong> window, but with the relevant fields only. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Explanation_of_Settings_in_the_New_Virtual_Machine_and_Edit_Virtual_Machine_Windows">Explanation of Settings in the New Virtual Machine and Edit Virtual Machine Windows</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new instance type will appear in the <strong>Instance Types</strong> tab in the <strong>Configure</strong> window, and can be selected from the <strong>Instance Type</strong> drop-down list when creating or editing a virtual machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Editing_Instance_Types">1.4.2. Editing Instance Types</h4>
<div class="paragraph">
<p>Administrators can edit existing instance types from the <strong>Configure</strong> window.</p>
</div>
<div class="paragraph">
<p><strong>Editing Instance Type Properties</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>Instance Types</strong> tab.</p>
</li>
<li>
<p>Select the instance type to be edited.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the settings as required.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configuration of the instance type is updated. When a new virtual machine based on this instance type is created, or when an existing virtual machine based on this instance type is updated, the new configuration is applied.</p>
</div>
<div class="paragraph">
<p>Existing virtual machines based on this instance type will display fields, marked with a chain icon, that will be updated. If the existing virtual machines were running when the instance type was changed, the orange Pending Changes icon will appear beside them and the fields with the chain icon will be updated at the next restart.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_Instance_Types">1.4.3. Removing Instance Types</h4>
<div class="paragraph">
<p><strong>Removing an Instance Type</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>Instance Types</strong> tab.</p>
</li>
<li>
<p>Select the instance type to be removed.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>If any virtual machines are based on the instance type to be removed, a warning window listing the attached virtual machines will appear. To continue removing the instance type, select the <strong>Approve Operation</strong> check box. Otherwise click <strong>Cancel</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The instance type is removed from the <strong>Instance Types</strong> list and can no longer be used when creating a new virtual machine. Any virtual machines that were attached to the removed instance type will now be attached to <strong>Custom</strong> (no instance type).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-MAC_Address_Pools">1.5. MAC Address Pools</h3>
<div class="paragraph">
<p>MAC address pools define the range(s) of MAC addresses allocated for each cluster. A MAC address pool is specified for each cluster. By using MAC address pools, oVirt can automatically generate and assign MAC addresses to new virtual network devices, which helps to prevent MAC address duplication. MAC address pools are more memory efficient when all MAC addresses related to a cluster are within the range for the assigned MAC address pool.</p>
</div>
<div class="paragraph">
<p>The same MAC address pool can be shared by multiple clusters, but each cluster has a single MAC address pool assigned. A default MAC address pool is created by oVirt and is used if another MAC address pool is not assigned. For more information about assigning MAC address pools to clusters see <a href="#Creating_a_New_Cluster">Creating a New Cluster</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If more than one oVirt cluster shares a network, do not rely solely on the default MAC address pool because the virtual machines of each cluster will try to use the same range of MAC addresses, leading to conflicts. To avoid MAC address conflicts, check the MAC address pool ranges to ensure that each cluster is assigned a unique MAC address range.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The MAC address pool assigns the next available MAC address following the last address that was returned to the pool. If there are no further addresses left in the range, the search starts again from the beginning of the range. If there are multiple MAC address ranges with available MAC addresses defined in a single MAC address pool, the ranges take turns in serving incoming requests in the same way available MAC addresses are selected.</p>
</div>
<div class="sect3">
<h4 id="Creating_MAC_Address_Pools">1.5.1. Creating MAC Address Pools</h4>
<div class="paragraph">
<p>You can create new MAC address pools.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>MAC Address Pools</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the new MAC address pool.</p>
</li>
<li>
<p>Select the <strong>Allow Duplicates</strong> check box to allow a MAC address to be used multiple times in a pool. The MAC address pool will not automatically use a duplicate MAC address, but enabling the duplicates option means a user can manually use a duplicate MAC address.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If one MAC address pool has duplicates disabled, and another has duplicates enabled, each MAC address can be used once in the pool with duplicates disabled but can be used multiple times in the pool with duplicates enabled.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the required <strong>MAC Address Ranges</strong>. To enter multiple ranges click the plus button next to the <strong>From</strong> and <strong>To</strong> fields.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Editing_MAC_Address_Pools">1.5.2. Editing MAC Address Pools</h4>
<div class="paragraph">
<p>You can edit MAC address pools to change the details, including the range of MAC addresses available in the pool and whether duplicates are allowed.</p>
</div>
<div class="paragraph">
<p><strong>Editing MAC Address Pool Properties</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>MAC Address Pools</strong> tab.</p>
</li>
<li>
<p>Select the MAC address pool to be edited.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the <strong>Name</strong>, <strong>Description</strong>, <strong>Allow Duplicates</strong>, and <strong>MAC Address Ranges</strong> fields as required.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a MAC address range is updated, the MAC addresses of existing NICs are not reassigned. MAC addresses that were already assigned, but are outside of the new MAC address range, are added as user-specified MAC addresses and are still tracked by that MAC address pool.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Editing_MAC_Address_Pool_Permissions">1.5.3. Editing MAC Address Pool Permissions</h4>
<div class="paragraph">
<p>After a MAC address pool has been created, you can edit its user permissions. The user permissions control which data centers can use the MAC address pool. See <a href="#sect-Roles">Roles</a> for more information on adding new user permissions.</p>
</div>
<div class="paragraph">
<p><strong>Editing MAC Address Pool Permissions</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>MAC Address Pools</strong> tab.</p>
</li>
<li>
<p>Select the required MAC address pool.</p>
</li>
<li>
<p>Edit the user permissions for the MAC address pool:</p>
<div class="ulist">
<ul>
<li>
<p>To add user permissions to a MAC address pool:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Add</strong> in the user permissions pane at the bottom of the <strong>Configure</strong> window.</p>
</li>
<li>
<p>Search for and select the required users.</p>
</li>
<li>
<p>Select the required role from the <strong>Role to Assign</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to add the user permissions.</p>
</li>
</ol>
</div>
</li>
<li>
<p>To remove user permissions from a MAC address pool:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the user permission to be removed in the user permissions pane at the bottom of the <strong>Configure</strong> window.</p>
</li>
<li>
<p>Click <strong>Remove</strong> to remove the user permissions.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Removing_MAC_Address_Pools">1.5.4. Removing MAC Address Pools</h4>
<div class="paragraph">
<p>You can remove a created MAC address pool if the pool is not associated with a cluster, but the default MAC address pool cannot be removed.</p>
</div>
<div class="paragraph">
<p><strong>Removing a MAC Address Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>.</p>
</li>
<li>
<p>Click the <strong>MAC Address Pools</strong> tab.</p>
</li>
<li>
<p>Select the MAC address pool to be removed.</p>
</li>
<li>
<p>Click the <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-System_Dashboard">2. Dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Dashboard provides an overview of the oVirt system status by displaying a summary of oVirt&#8217;s resources and utilization. This summary can alert you to a problem and allows you to analyze the problem area.</p>
</div>
<div class="paragraph">
<p>The information in the dashboard is updated every 15 minutes by default from Data Warehouse, and every 15 seconds by default by the Engine API, or whenever the Dashboard is refreshed. The Dashboard is refreshed when the user changes back from another page or when manually refreshed. The Dashboard does not automatically refresh. The inventory card information is supplied by the Engine API and the utilization information is supplied by Data Warehouse. The Dashboard is implemented as a UI plugin component, which is automatically installed and upgraded alongside the Engine.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/RHVdashboard.png" alt="RHVdashboard">
</div>
<div class="title">Figure 6. The Dashboard</div>
</div>
<div class="sect2">
<h3 id="sect-Prerequisites">2.1. Prerequisites</h3>
<div class="paragraph">
<p>The Dashboard requires that Data Warehouse is installed and configured. See <a href="https://ovirt.org/documentation/data_warehouse_guide/index#chap-Installing_and_Configuring_Data_Warehouse">Installing and Configuring Data Warehouse</a> in the <em>Data Warehouse Guide</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Global_Inventory">2.2. Global Inventory</h3>
<div class="paragraph">
<p>The top section of the Dashboard provides a global inventory of the oVirt resources and includes items for data centers, clusters, hosts, storage domains, virtual machines, and events. Icons show the status of each resource and numbers show the quantity of the each resource with that status.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Dashboard_Inventory.png" alt="Dashboard Inventory">
</div>
<div class="title">Figure 7. Global Inventory</div>
</div>
<div class="paragraph">
<p>The title shows the number of a type of resource and their status is displayed below the title. Clicking on the resource title navigates to the related page in the oVirt Engine. The status for <strong>Clusters</strong> is always displayed as N/A.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Resource Status</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Icon</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_No_Items.png" alt="Dashboard No Items"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None of that resource added to oVirt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_Warning.png" alt="Dashboard Warning"></span></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Shows the number of a resource with a warning status. Clicking on the icon navigates to the appropriate page with the search limited to that resource with a warning status. The search is limited differently for each resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Centers</strong>: The search is limited to data centers that are not operational or non-responsive.</p>
</li>
<li>
<p><strong>Gluster Volumes</strong>: The search is limited to gluster volumes that are powering up, paused, migrating, waiting, suspended, or powering down.</p>
</li>
<li>
<p><strong>Hosts</strong>: The search is limited to hosts that are unassigned, in maintenance mode, installing, rebooting, preparing for maintenance, pending approval, or connecting.</p>
</li>
<li>
<p><strong>Storage Domains</strong>: The search is limited to storage domains that are uninitialized, unattached, inactive, in maintenance mode, preparing for maintenance, detaching, or activating.</p>
</li>
<li>
<p><strong>Virtual Machines</strong>: The search is limited to virtual machines that are powering up, paused, migrating, waiting, suspended, or powering down.</p>
</li>
<li>
<p><strong>Events</strong>: The search is limited to events with the severity of warning.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_Up.png" alt="Dashboard Up"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the number of a resource with an up status. Clicking on the icon navigates to the appropriate page with the search limited to resources that are up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_Down.png" alt="Dashboard Down"></span></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Shows the number of a resource with a down status. Clicking on the icon navigates to the appropriate page with the search limited to resources with a down status. The search is limited differently for each resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Centers</strong>: The search is limited to data centers that are uninitialized, in maintenance mode, or with a down status.</p>
</li>
<li>
<p><strong>Gluster Volumes</strong>: The search is limited to gluster volumes that are detached or inactive.</p>
</li>
<li>
<p><strong>Hosts</strong>: The search is limited to hosts that are non-responsive, have an error, have an installation error, non-operational, initializing, or down.</p>
</li>
<li>
<p><strong>Storage Domains</strong>: The search is limited to storage domains that are detached or inactive.</p>
</li>
<li>
<p><strong>Virtual Machines</strong>: The search is limited to virtual machines that are down, not responding, or rebooting.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_Alert.png" alt="Dashboard Alert"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the number of events with an alert status. Clicking on the icon navigates to <strong>Events</strong> with the search limited to events with the severity of alert.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="images/Dashboard_Error.png" alt="Dashboard Error"></span></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the number of events with an error status. Clicking on the icon navigates to <strong>Events</strong> with the search limited to events with the severity of error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sect-Global_Utilization">2.3. Global Utilization</h3>
<div class="paragraph">
<p>The <strong>Global Utilization</strong> section shows the system utilization of the CPU, Memory and Storage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Dashboard_Global_Utilization.png" alt="Dashboard Global Utilization">
</div>
<div class="title">Figure 8. Global Utilization</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The top section shows the percentage of the available CPU, memory or storage and the over commit ratio. For example, the over commit ratio for the CPU is calculated by dividing the number of virtual cores by the number of physical cores that are available for the running virtual machines based on the latest data in Data Warehouse.</p>
</li>
<li>
<p>The donut displays the usage in percentage for the CPU, memory or storage and shows the average usage for all hosts based on the average usage in the last 5 minutes. Hovering over a section of the donut will display the value of the selected section.</p>
</li>
<li>
<p>The line graph at the bottom displays the trend in the last 24 hours. Each data point shows the average usage for a specific hour. Hovering over a point on the graph displays the time and the percentage used for the CPU graph and the amount of usage for the memory and storage graphs.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="sect-Top_Utilized_Resources">2.3.1. Top Utilized Resources</h4>
<div class="imageblock">
<div class="content">
<img src="images/Dashboard_Pop_Up.png" alt="Dashboard Pop Up">
</div>
<div class="title">Figure 9. Top Utilized Resources (Memory)</div>
</div>
<div class="paragraph">
<p>Clicking the donut in the global utilization section of the Dashboard will display a list of the top utilized resources for the CPU, memory or storage. For CPU and memory the pop-up shows a list of the ten hosts and virtual machines with the highest usage. For storage the pop-up shows a list of the top ten utilized storage domains and virtual machines. The arrow to the right of the usage bar shows the trend of usage for that resource in the last minute.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Cluster_Utilization">2.4. Cluster Utilization</h3>
<div class="paragraph">
<p>The <strong>Cluster Utilization</strong> section shows the cluster utilization for the CPU and memory in a heatmap.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Dashboard_Cluster_Utilization.png" alt="Dashboard Cluster Utilization">
</div>
<div class="title">Figure 10. Cluster Utilization</div>
</div>
<div class="sect3">
<h4 id="sect-Cluster_CPU_Utilization">2.4.1. CPU</h4>
<div class="paragraph">
<p>The heatmap of the CPU utilization for a specific cluster that shows the average utilization of the CPU for the last 24 hours. Hovering over the heatmap displays the cluster name. Clicking on the heatmap navigates to <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and displays the results of a search on a specific cluster sorted by CPU utilization. The formula used to calculate the usage of the CPU by the cluster is the average host CPU utilization in the cluster. This is calculated by using the average host CPU utilization for each host over the last 24 hours to find the total average usage of the CPU by the cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-Cluster_Memory_Utilization">2.4.2. Memory</h4>
<div class="paragraph">
<p>The heatmap of the memory utilization for a specific cluster that shows the average utilization of the memory for the last 24 hours. Hovering over the heatmap displays the cluster name. Clicking on the heatmap navigates to <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and displays the results of a search on a specific cluster sorted by memory usage. The formula used to calculate the memory usage by the cluster is the total utilization of the memory in the cluster in GB. This is calculated by using the average host memory utilization for each host over the last 24 hours to find the total average usage of memory by the cluster.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Storage_Utilization">2.5. Storage Utilization</h3>
<div class="paragraph">
<p>The <strong>Storage Utilization</strong> section shows the storage utilization in a heatmap.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Dashboard_Storage_Utilization.png" alt="Dashboard Storage Utilization">
</div>
<div class="title">Figure 11. Storage Utilization</div>
</div>
<div class="paragraph">
<p>The heatmap shows the average utilization of the storage for the last 24 hours. The formula used to calculate the storage usage by the cluster is the total utilization of the storage in the cluster. This is calculated by using the average storage utilization for each host over the last 24 hours to find the total average usage of the storage by the cluster. Hovering over the heatmap displays the storage domain name. Clicking on the heatmap navigates to <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span> with the storage domains sorted by utilization.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Searches">3. Searches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Performing_searches">3.1. Performing Searches in oVirt</h3>
<div class="paragraph">
<p>The Administration Portal allows you to manage thousands of resources, such as virtual machines, hosts, users, and more.  To perform a search, enter the search query (free-text or syntax-based) into the search bar, available on the main page for each resource. Search queries can be saved as bookmarks for future reuse, so you do not have to reenter a search query each time the specific search results are required. Searches are not case sensitive.</p>
</div>
</div>
<div class="sect2">
<h3 id="Search_syntax_and_examples">3.2. Search Syntax and Examples</h3>
<div class="paragraph">
<p>The syntax of the search queries for oVirt resources is as follows:</p>
</div>
<div class="paragraph">
<p><code>result type: {criteria} [sortby sort_spec]</code></p>
</div>
<div class="paragraph">
<p><strong>Syntax Examples</strong></p>
</div>
<div class="paragraph">
<p>The following examples describe how the search query is used and help you to understand how oVirt assists with building search queries.</p>
</div>
<table id="search_query_eg" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Example Search Queries</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hosts: Vms.status = up page 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays page 2 of a list of all hosts running virtual machines that are up.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vms: domain = qa.company.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a list of all virtual machines running on the specified domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vms: users.name = Mary</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays a list of all virtual machines belonging to users with the user name Mary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Events: severity &gt; normal sortby time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the list of all Events whose severity is higher than Normal, sorted by time.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Search_auto_completion">3.3. Search Auto-Completion</h3>
<div class="paragraph">
<p>The Administration Portal provides auto-completion to help you create valid and powerful search queries. As you type each part of a search query, a drop-down list of choices for the next part of the search opens below the Search Bar. You can either select from the list and then continue typing/selecting the next part of the search, or ignore the options and continue entering your query manually.</p>
</div>
<div class="paragraph">
<p>The following table specifies by example how the Administration Portal auto-completion assists in constructing a query:</p>
</div>
<div class="paragraph">
<p><code>Hosts: Vms.status = down</code></p>
</div>
<table id="query_contruction" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Example Search Queries Using Auto-Completion</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Input</th>
<th class="tableblock halign-left valign-top">List Items Displayed</th>
<th class="tableblock halign-left valign-top">Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>h</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts</code> (1 option only)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select <code>Hosts</code> or type <strong>Hosts</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts:</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All host properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <strong>v</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts: v</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">host properties starting with a <code>v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select <code>Vms</code> or type <strong>Vms</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts: Vms</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All virtual machine properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type <strong>s</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts: Vms.s</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All virtual machine properties beginning with <code>s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select <code>status</code> or type <strong>status</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts: Vms.status</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p>
<p class="tableblock"><code>!=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select or type <strong>=</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hosts: Vms.status =</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All status values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select or type <strong>down</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Search_result_type_options">3.4. Search Result Type Options</h3>
<div class="paragraph">
<p>The result type allows you to search for resources of any of the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Vms</strong> for a list of virtual machines</p>
</li>
<li>
<p><strong>Host</strong> for a list of hosts</p>
</li>
<li>
<p><strong>Pools</strong> for a list of pools</p>
</li>
<li>
<p><strong>Template</strong> for a list of templates</p>
</li>
<li>
<p><strong>Events</strong> for a list of events</p>
</li>
<li>
<p><strong>Users</strong> for a list of users</p>
</li>
<li>
<p><strong>Cluster</strong> for a list of clusters</p>
</li>
<li>
<p><strong>DataCenter</strong> for a list of data centers</p>
</li>
<li>
<p><strong>Storage</strong> for a list of storage domains</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As each type of resource has a unique set of properties and a set of other resource types that it is associated with, each search type has a set of valid syntax combinations. You can also use the auto-complete feature to create valid queries easily.</p>
</div>
</div>
<div class="sect2">
<h3 id="Search_criteria">3.5. Search Criteria</h3>
<div class="paragraph">
<p>You can specify the search criteria after the colon in the query. The syntax of <code>{criteria}</code> is as follows:</p>
</div>
<div class="paragraph">
<p><code>&lt;prop&gt;&lt;operator&gt;&lt;value&gt;</code></p>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="paragraph">
<p><code>&lt;obj-type&gt;&lt;prop&gt;&lt;operator&gt;&lt;value&gt;</code></p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="paragraph">
<p>The following table describes the parts of the syntax:</p>
</div>
<table id="search_criteria" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Example Search Criteria</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Part</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Values</th>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the searched-for resource. Can also be the property of a resource type (see <code>obj-type</code>), or <strong>tag</strong> (custom tag).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Limit your search to objects with a certain property. For example, search for objects with a <strong>status</strong> property.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">obj-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A resource type that can be associated with the searched-for resource.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">These are system objects, like data centers and virtual machines.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">operator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comparison operators.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p>
<p class="tableblock">!= (not equal)</p>
<p class="tableblock">&gt;</p>
<p class="tableblock">&lt;</p>
<p class="tableblock">&gt;=</p>
<p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value options depend on property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What the expression is being compared to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p>
<p class="tableblock">Integer</p>
<p class="tableblock">Ranking</p>
<p class="tableblock">Date (formatted according to Regional Settings)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jones</p>
<p class="tableblock">256</p>
<p class="tableblock">normal</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Wildcards can be used within strings.</p>
</li>
<li>
<p>"" (two sets of quotation marks with no space between them) can be used to represent an un-initialized (empty) string.</p>
</li>
<li>
<p>Double quotes should be used around a string or date containing spaces</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Search_criteria_multiple_criteria_and_wildcards">3.6. Search: Multiple Criteria and Wildcards</h3>
<div class="paragraph">
<p>Wildcards can be used in the <code>&lt;value&gt;</code> part of the syntax for strings. For example, to find all users beginning with <strong>m</strong>, enter <code>m*</code>.</p>
</div>
<div class="paragraph">
<p>You can perform a search having two criteria by using the Boolean operators <code>AND</code> and <code>OR</code>. For example:</p>
</div>
<div class="paragraph">
<p><code>Vms: users.name = m* AND status = Up</code></p>
</div>
<div class="paragraph">
<p>This query returns all running virtual machines for users whose names begin with "m".</p>
</div>
<div class="paragraph">
<p><code>Vms: users.name = m* AND tag = "paris-loc"</code></p>
</div>
<div class="paragraph">
<p>This query returns all virtual machines tagged with "paris-loc" for users whose names begin with "m".</p>
</div>
<div class="paragraph">
<p>When two criteria are specified without <code>AND</code> or <code>OR</code>, <code>AND</code> is implied. <code>AND</code> precedes <code>OR</code>, and <code>OR</code> precedes implied <code>AND</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Search_determining_search_order">3.7. Search: Determining Search Order</h3>
<div class="paragraph">
<p>You can determine the sort order of the returned information by using <code>sortby</code>. Sort direction (<code>asc</code> for ascending, <code>desc</code> for descending) can be included.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p><code>events: severity &gt; normal sortby time desc</code></p>
</div>
<div class="paragraph">
<p>This query returns all Events whose severity is higher than Normal, sorted by time (descending order).</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_data_centers">3.8. Searching for Data Centers</h3>
<div class="paragraph">
<p>The following table describes all search options for Data Centers.</p>
</div>
<table id="searching_datacenters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Searching for Data Centers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Clusters.<em>clusters-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the clusters associated with the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The availability of the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Datacenter: type = nfs and status != up</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of data centers with a storage type of NFS and status other than up.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_clusters">3.9. Searching for Clusters</h3>
<div class="paragraph">
<p>The following table describes all search options for clusters.</p>
</div>
<table id="searching_clusters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Searching Clusters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Datacenter.<em>datacenter-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the data center associated with the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the cluster belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name that identifies the clusters on the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initialized</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True or False indicating the status of the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Clusters: initialized = true or name = Default</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of clusters which are initialized or named Default.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_hosts">3.10. Searching for Hosts</h3>
<div class="paragraph">
<p>The following table describes all search options for hosts.</p>
</div>
<table id="searching_hosts" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Searching for Hosts</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vms.<em>Vms-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the virtual machines associated with the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Templates.<em>templates-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the templates associated with the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Events.<em>events-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the events associated with the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Users.<em>users-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the users associated with the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The availability of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>external_status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The health status of the host as reported by external systems and plug-ins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cluster to which the host belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name that identifies the host on the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpu_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percent of processing power used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mem_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of memory used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>network_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of network usage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>load</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jobs waiting to be executed in the <strong>run-queue</strong> per processor, in a given time slice.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version number of the operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of CPUs on the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of memory available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpu_speed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The processing speed of the CPU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpu_model</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of CPU.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active_vms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of virtual machines currently running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>migrating_vms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of virtual machines currently being migrated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>committed_mem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of committed memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tag assigned to the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the host belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Hosts: cluster = Default and Vms.os = rhel6</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of hosts which are part of the Default cluster and host virtual machines running the Enterprise Linux 6 operating system.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_Networks">3.11. Searching for Networks</h3>
<div class="paragraph">
<p>The following table describes all search options for networks.</p>
</div>
<table id="searching_networks" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. Searching for Networks</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster_network.<em>clusternetwork-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the cluster associated with the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Host_Network.<em>hostnetwork-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the host associated with the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The human readable name that identifies the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keywords or text describing the network, optionally used when creating the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vlanid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The VLAN ID of the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether Spanning Tree Protocol (STP) is enabled or disabled for the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum transmission unit for the logical network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vmnetwork</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the network is only used for virtual machine traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the network is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Network: mtu &gt; 1500 and vmnetwork = true</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of networks with a maximum transmission unit greater than 1500 bytes, and which are set up for use by only virtual machines.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_storage">3.12. Searching for Storage</h3>
<div class="paragraph">
<p>The following table describes all search options for storage.</p>
</div>
<table id="searching_storage" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Searching for Storage</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts.<em>hosts-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the hosts associated with the storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Clusters.<em>clusters-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the clusters associated with the storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name that identifies the storage on the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the storage domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>external_status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The health status of the storage domain as reported by external systems and plug-ins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the storage belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>free-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size (GB) of the free storage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>used-size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount (GB) of the storage that is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>total_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The total amount (GB) of the storage that is available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>committed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount (GB) of the storage that is committed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Storage: free_size &gt; 6 GB and total_size &lt; 20 GB</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of storage with free storage space greater than 6 GB, or total storage space less than 20 GB.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_Disks">3.13. Searching for Disks</h3>
<div class="paragraph">
<p>The following table describes all search options for disks.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the <code>Disk Type</code> and <code>Content Type</code> filtering options to reduce the number of displayed virtual disks.
</td>
</tr>
</table>
</div>
<table id="searching_disks" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. Searching for Disks</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Datacenters.<em>datacenters-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the data centers associated with the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Storages.<em>storages-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the storage associated with the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The human readable name that identifies the storage on the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keywords or text describing the disk, optionally used when creating the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>provisioned_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual size of the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>actual_size</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The actual size allocated to the disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creation_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date the disk was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bootable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the disk can or cannot be booted. Valid values are one of <code>0</code>, <code>1</code>, <code>yes</code>, or <code>no</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shareable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the disk can or cannot be attached to more than one virtual machine at a time. Valid values are one of <code>0</code>, <code>1</code>, <code>yes</code>, or <code>no</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format of the disk. Can be one of <code>unused</code>, <code>unassigned</code>, <code>cow</code>, or <code>raw</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the disk. Can be one of <code>unassigned</code>, <code>ok</code>, <code>locked</code>, <code>invalid</code>, or <code>illegal</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disk_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of the disk. Can be one of <code>image</code> or <code>lun</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number_of_vms</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of virtual machine(s) to which the disk is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vm_names</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name(s) of the virtual machine(s) to which the disk is attached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quota</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the quota enforced on the virtual disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Disks: format = cow and provisioned_size &gt; 8</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of virtual disks with QCOW format and an allocated disk size greater than 8 GB.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_Volumes">3.14. Searching for Volumes</h3>
<div class="paragraph">
<p>The following table describes all search options for volumes.</p>
</div>
<table id="searching_volumes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. Searching for Volumes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the cluster associated with the volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Cluster.<em>cluster-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type (examples: name, description, comment, architecture)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the clusters associated with the volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The human readable name that identifies the volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be one of distribute, replicate, distributed_replicate, stripe, or distributed_stripe.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>transport_type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be one of TCP or RDMA.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replica_count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of replica.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>stripe_count</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of stripes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the volume. Can be one of Up or Down.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Volume: transport_type = rdma and stripe_count &gt;= 2</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of volumes with transport type set to RDMA, and with 2 or more stripes.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_virtual_machines">3.15. Searching for Virtual Machines</h3>
<div class="paragraph">
<p>The following table describes all search options for virtual machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Currently, the <strong>Network Label</strong>, <strong>Custom Emulated Machine</strong>, and <strong>Custom CPU Type</strong> properties are not supported search parameters.</p>
</div>
</td>
</tr>
</table>
</div>
<table id="searching_Vms_syntax" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. Searching for Virtual Machines</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts.<em>hosts-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the hosts associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Templates.<em>templates-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the templates associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Events.<em>events-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the events associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Users.<em>users-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the users associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Storage.<em>storage-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on the property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of storage devices associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vnic.<em>vnic-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on the property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the vNIC associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The availability of the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP address of the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uptime</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of minutes that the virtual machine has been running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain (usually Active Directory domain) that groups these machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>os</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The operating system selected when the virtual machine was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creationdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date on which the virtual machine was created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>address</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name that identifies the virtual machine on the network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpu_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percent of processing power used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mem_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of memory used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>network_usage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The percentage of network used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>memory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum memory defined.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>apps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The applications currently installed on the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cluster to which the virtual machine belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual machine pool to which the virtual machine belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loggedinuser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the user currently logged in to the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tags to which the virtual machine belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the virtual machine belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual machine type (server or desktop).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quota</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the quota associated with the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keywords or text describing the virtual machine, optionally used when creating the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>next_run_configuration_exists</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual machine has pending configuration changes.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Vms: template.name = Win* and user.name = ""</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of virtual machines whose base template name begins with <strong>Win</strong> and are assigned to any user.</p>
</div>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Vms: cluster = Default and os = windows7</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of virtual machines that belong to the <strong>Default</strong> cluster and are running Windows 7.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_pools">3.16. Searching for Pools</h3>
<div class="paragraph">
<p>The following table describes all search options for Pools.</p>
</div>
<table id="searching_pools" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. Searching for Pools</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Pools: type = automatic</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of pools with a type of <code>automatic</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_templates">3.17. Searching for Templates</h3>
<div class="paragraph">
<p>The following table describes all search options for templates.</p>
</div>
<table id="searching_templates_syntax" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. Searching for Templates</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vms.<em>Vms-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the virtual machines associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts.<em>hosts-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the hosts associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Events.<em>events-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the events associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Users.<em>users-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the users associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The domain of the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>os</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of operating system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creationdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The date on which the template was created.</p>
<p class="tableblock">Date format is <strong>mm/dd/yy</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>childcount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of virtual machines created from the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mem</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defined memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cluster</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cluster associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quota</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The quota associated with the template.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Template: Events.severity &gt;= normal and Vms.uptime &gt; 0</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of templates where events of normal or greater severity have occurred on virtual machines derived from the template, and the virtual machines are still running.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_users">3.18. Searching for Users</h3>
<div class="paragraph">
<p>The following table describes all search options for users.</p>
</div>
<table id="searching_users" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. Searching for Users</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vms.<em>Vms-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the virtual machines associated with the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts.<em>hosts-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the hosts associated with the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Templates.<em>templates-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the templates associated with the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Events.<em>events-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the events associated with the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lastname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The last name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usrname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique name of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>department</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The department to which the user belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The group to which the user belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The title of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>role</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The role of the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The tag to which the user belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The pool to which the user belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Users: Events.severity &gt; normal and Vms.status = up or Vms.status = pause</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of users where events of greater than normal severity have occurred on their virtual machines AND the virtual machines are still running; or the users' virtual machines are paused.</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_events">3.19. Searching for Events</h3>
<div class="paragraph">
<p>The following table describes all search options you can use to search for events. Auto-completion is offered for many options as appropriate.</p>
</div>
<table id="searching_events_syntax" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Searching for Events</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property (of resource or resource-type)</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description (Reference)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Vms.<em>Vms-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the virtual machines associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Hosts.<em>hosts-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the hosts associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Templates.<em>templates-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the templates associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Users.<em>users-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the users associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Clusters.<em>clusters-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the clusters associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Volumes.<em>Volumes-prop</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Depends on property type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The property of the volumes associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>severity</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The severity of the event: Warning/Error/Normal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the event type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Day the event occurred.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>usrname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user name associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_host</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_vm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The virtual machine associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The template associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_storage</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_datacenter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>event_volume</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The volume associated with the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>correlation_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The identification number of the event.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sortby</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorts the returned results by one of the resource properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>page</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The page number of results to display.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Example</strong></p>
</div>
<div class="paragraph">
<p><code>Events: Vms.name = testdesktop and Hosts.name = gonzo.example.com</code></p>
</div>
<div class="paragraph">
<p>This example returns a list of events, where the event occurred on the virtual machine named <code>testdesktop</code> while it was running on the host <code>gonzo.example.com</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Bookmarks">4. Bookmarks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Saving_a_query_string_as_a_bookmark">4.1. Saving a Query String as a Bookmark</h3>
<div class="paragraph">
<p>A bookmark can be used to remember a search query, and shared with other users.</p>
</div>
<div class="paragraph">
<p><strong>Saving a Query String as a Bookmark</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the desired search query in the search bar and perform the search.</p>
</li>
<li>
<p>Click the star-shaped <strong>Bookmark</strong> button to the right of the search bar. This opens the <strong>New Bookmark</strong> window.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> of the bookmark.</p>
</li>
<li>
<p>Edit the <strong>Search string</strong> field, if required.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Click the <strong>Bookmarks</strong> icon (<span class="image"><img src="images/Bookmark.png" alt="Bookmark"></span>) in the header bar to find and select the bookmark.</p>
</div>
</div>
<div class="sect2">
<h3 id="Editing_a_bookmark">4.2. Editing a Bookmark</h3>
<div class="paragraph">
<p>You can modify the name and search string of a bookmark.</p>
</div>
<div class="paragraph">
<p><strong>Editing a Bookmark</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Bookmarks</strong> icon (<span class="image"><img src="images/Bookmark.png" alt="Bookmark"></span>) in the header bar.</p>
</li>
<li>
<p>Select a bookmark and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the <strong>Name</strong> and <strong>Search string</strong> fields as necessary.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_bookmark">4.3. Deleting a Bookmark</h3>
<div class="paragraph">
<p>When a bookmark is no longer needed, remove it.</p>
</div>
<div class="paragraph">
<p><strong>Deleting a Bookmark</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Bookmarks</strong> icon (<span class="image"><img src="images/Bookmark.png" alt="Bookmark"></span>) in the header bar.</p>
</li>
<li>
<p>Select a bookmark and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Tags">5. Tags</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Using_tags_to_customize_interactions">5.1. Using Tags to Customize Interactions with oVirt</h3>
<div class="paragraph">
<p>After your oVirt platform is set up and configured to your requirements, you can customize the way you work with it using tags. Tags allow system resources to be arranged into groups or categories. This is useful when many objects exist in the virtualization environment and the administrator wants to concentrate on a specific set of them.</p>
</div>
<div class="paragraph">
<p>This section describes how to create and edit tags, assign them to hosts or virtual machines and search using the tags as criteria. Tags can be arranged in a hierarchy that matches a structure, to fit the needs of the enterprise.</p>
</div>
<div class="paragraph">
<p>To create, modify, and remove Administration Portal tags, click the <strong>Tags</strong> icon (<span class="image"><img src="images/Tag.png" alt="Tag"></span>) in the header bar.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_tag">5.2. Creating a Tag</h3>
<div class="paragraph">
<p>Create tags so you can filter search results using tags.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Tag</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Tags</strong> icon (<span class="image"><img src="images/Tag.png" alt="Tag"></span>) in the header bar.</p>
</li>
<li>
<p>Click <strong>Add</strong> to create a new tag, or select a tag and click <strong>New</strong> to create a descendant tag.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the new tag.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Modifying_a_tag">5.3. Modifying a Tag</h3>
<div class="paragraph">
<p>You can edit the name and description of a tag.</p>
</div>
<div class="paragraph">
<p><strong>Modifying a Tag</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Tags</strong> icon (<span class="image"><img src="images/Tag.png" alt="Tag"></span>) in the header bar.</p>
</li>
<li>
<p>Select the tag you want to modify and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the <strong>Name</strong> and <strong>Description</strong> fields as necessary.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Deleting_a_tag">5.4. Deleting a Tag</h3>
<div class="paragraph">
<p>When a tag is no longer needed, remove it.</p>
</div>
<div class="paragraph">
<p><strong>Deleting a Tag</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Tags</strong> icon (<span class="image"><img src="images/Tag.png" alt="Tag"></span>) in the header bar.</p>
</li>
<li>
<p>Select the tag you want to delete and click <strong>Remove</strong>. A message warns you that removing the tag will also remove all descendants of the tag.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have removed the tag and all its descendants. The tag is also removed from all the objects that it was attached to.</p>
</div>
</div>
<div class="sect2">
<h3 id="Adding_and_removing_tags">5.5. Adding and Removing Tags to and from Objects</h3>
<div class="paragraph">
<p>You can assign tags to and remove tags from hosts, virtual machines, and users.</p>
</div>
<div class="paragraph">
<p><strong>Adding and Removing Tags to and from Objects</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the object(s) you want to tag or untag.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Assign Tags</strong>.</p>
</li>
<li>
<p>Select the check box to assign a tag to the object, or clear the check box to detach the tag from the object.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The specified tag is now added or removed as a custom property of the selected object(s).</p>
</div>
</div>
<div class="sect2">
<h3 id="Searching_for_objects_using_tags">5.6. Searching for Objects Using Tags</h3>
<div class="paragraph">
<p>Enter a search query using <code>tag</code> as the property and the desired value or set of values as criteria for the search.</p>
</div>
<div class="paragraph">
<p>The objects tagged with the specified criteria are listed in the results list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you search for objects using <code>tag</code> as the property and the inequality operator (<code>!=</code>), for example, <code>Host: Vms.tag!=server1</code>, the results list does not include untagged objects.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Customizing_hosts_with_tags">5.7. Customizing Hosts with Tags</h3>
<div class="paragraph">
<p>You can use tags to store information about your hosts. You can then search for hosts based on tags. For more information on searches, see <a href="#chap-Searches">Searches</a>.</p>
</div>
<div class="paragraph">
<p><strong>Customizing hosts with tags</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a host.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Assign Tags</strong>.</p>
</li>
<li>
<p>Select the check boxes of applicable tags.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have added extra, searchable information about your host as tags.</p>
</div>
</div>
</div>
</div>
<h1 id="part-Administering_the_Resources" class="sect0">Administering the Resources</h1>
<div class="sect1">
<h2 id="chap-Quality_of_Service">6. Quality of Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>oVirt allows you to define quality of service entries that provide fine-grained control over the level of input and output, processing, and networking capabilities that resources in your environment can access. Quality of service entries are defined at the data center level and are assigned to profiles created under clusters and storage domains. These profiles are then assigned to individual resources in the clusters and storage domains where the profiles were created.</p>
</div>
<div class="sect2">
<h3 id="sect-Storage_Quality_of_Service">6.1. Storage Quality of Service</h3>
<div class="paragraph">
<p>Storage quality of service defines the maximum level of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Assigning storage quality of service to a virtual disk allows you to fine tune the performance of storage domains and prevent the storage operations associated with one virtual disk from affecting the storage capabilities available to other virtual disks hosted in the same storage domain.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_Storage_Quality_of_Service_Entry">6.1.1. Creating a Storage Quality of Service Entry</h4>
<div class="paragraph">
<p><strong>Creating a Storage Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>Storage</strong>, click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>QoS Name</strong> and a <strong>Description</strong> for the quality of service entry.</p>
</li>
<li>
<p>Specify the <strong>Throughput</strong> quality of service by clicking one of the radio buttons:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong></p>
</li>
<li>
<p><strong>Total</strong> - Enter the maximum permitted total throughput in the <strong>MB/s</strong> field.</p>
</li>
<li>
<p><strong>Read/Write</strong> - Enter the maximum permitted throughput for read operations in the left <strong>MB/s</strong> field, and the maximum permitted throughput for write operations in the right <strong>MB/s</strong> field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Specify the input and output (<strong>IOps</strong>) quality of service by clicking one of the radio buttons:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong></p>
</li>
<li>
<p><strong>Total</strong> - Enter the maximum permitted number of input and output operations per second in the <strong>IOps</strong> field.</p>
</li>
<li>
<p><strong>Read/Write</strong> - Enter the maximum permitted number of input operations per second in the left <strong>IOps</strong> field, and the maximum permitted number of output operations per second in the right <strong>IOps</strong> field.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have created a storage quality of service entry, and can create disk profiles based on that entry in data storage domains that belong to the data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Storage_Quality_of_Service_Entry">6.1.2. Removing a Storage Quality of Service Entry</h4>
<div class="paragraph">
<p>Remove an existing storage quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Storage Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>Storage</strong>, select a storage quality of service entry and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If any disk profiles were based on that entry, the storage quality of service entry for those profiles is automatically set to <code>[unlimited]</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-VM_Network_Quality_of_Service">6.2. Virtual Machine Network Quality of Service</h3>
<div class="paragraph">
<p>Virtual machine network quality of service is a feature that allows you to create profiles for limiting both the inbound and outbound traffic of individual virtual network interface controllers. With this feature, you can limit bandwidth in a number of layers, controlling the consumption of network resources.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_Virtual_Machine_Network_QoS_Entry">6.2.1. Creating a Virtual Machine Network Quality of Service Entry</h4>
<div class="paragraph">
<p>Create a virtual machine network quality of service entry to regulate network traffic when applied to a virtual network interface controller (vNIC) profile, also known as a virtual machine network interface profile.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Virtual Machine Network Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>VM Network</strong>, click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the virtual machine network quality of service entry.</p>
</li>
<li>
<p>Enter the limits for the <strong>Inbound</strong> and <strong>Outbound</strong> network traffic.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have created a virtual machine network quality of service entry that can be used in a virtual network interface controller.</p>
</div>
</div>
<div class="sect3">
<h4 id="Settings_in_the_New_VM_Network_QoS_and_Edit_VM_Network_QoS_Windows_Explained">6.2.2. Settings in the New Virtual Machine Network QoS and Edit Virtual Machine Network QoS Windows Explained</h4>
<div class="paragraph">
<p>Virtual machine network quality of service settings allow you to configure bandwidth limits for both inbound and outbound traffic on three distinct levels.</p>
</div>
<table id="Network_QoS_Settings" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Virtual Machine Network QoS Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Data Center</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the virtual machine network QoS policy is to be added. This field is configured automatically according to the selected data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A name to represent the virtual machine network QoS policy within the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Inbound</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The settings to be applied to inbound traffic. Select or clear the <strong>Inbound</strong> check box to enable or disable these settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Average</strong>: The average speed of inbound traffic.</p>
</li>
<li>
<p><strong>Peak</strong>: The speed of inbound traffic during peak times.</p>
</li>
<li>
<p><strong>Burst</strong>: The speed of inbound traffic during bursts.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outbound</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The settings to be applied to outbound traffic. Select or clear the <strong>Outbound</strong> check box to enable or disable these settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Average</strong>: The average speed of outbound traffic.</p>
</li>
<li>
<p><strong>Peak</strong>: The speed of outbound traffic during peak times.</p>
</li>
<li>
<p><strong>Burst</strong>: The speed of outbound traffic during bursts.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To change the maximum value allowed by the <strong>Average</strong>, <strong>Peak</strong>, or <strong>Burst</strong> fields, use the <code>engine-config</code> command to change the value of the <code>MaxAverageNetworkQoSValue</code>, <code>MaxPeakNetworkQoSValue</code>, or <code>MaxBurstNetworkQoSValue</code> configuration keys. You must restart the <strong>ovirt-engine</strong> service for any changes to take effect. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># engine-config -s MaxAverageNetworkQoSValue=2048
# systemctl restart ovirt-engine</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Virtual_Machine_Network_QoS_Entry">6.2.3. Removing a Virtual Machine Network Quality of Service Entry</h4>
<div class="paragraph">
<p>Remove an existing virtual machine network quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Virtual Machine Network Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>VM Network</strong>, select a virtual machine network quality of service entry and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Host_Network_Quality_of_Service">6.3. Host Network Quality of Service</h3>
<div class="paragraph">
<p>Host network quality of service configures the networks on a host to enable the control of network traffic through the physical interfaces. Host network quality of service allows for the fine tuning of network performance by controlling the consumption of network resources on the same physical network interface controller. This helps to prevent situations where one network causes other networks attached to the same physical network interface controller to no longer function due to heavy traffic. By configuring host network quality of service, these networks can now function on the same physical network interface controller without congestion issues.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_Host_Network_Quality_of_Service_Entry">6.3.1. Creating a Host Network Quality of Service Entry</h4>
<div class="paragraph">
<p>Create a host network quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Host Network Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>Host Network</strong>, click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Qos Name</strong> and a description for the quality of service entry.</p>
</li>
<li>
<p>Enter the desired values for <strong>Weighted Share</strong>, <strong>Rate Limit [Mbps]</strong>, and <strong>Committed Rate [Mbps]</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Settings_in_the_New_Host_Network_QoS_and_Edit_Host_Network_QoS_Windows_Explained">6.3.2. Settings in the New Host Network Quality of Service and Edit Host Network Quality of Service Windows Explained</h4>
<div class="paragraph">
<p>Host network quality of service settings allow you to configure bandwidth limits for outbound traffic.</p>
</div>
<table id="Host_Network_QoS_Settings" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Host Network QoS Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Data Center</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center to which the host network QoS policy is to be added. This field is configured automatically according to the selected data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QoS Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A name to represent the host network QoS policy within the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the host network QoS policy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Outbound</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The settings to be applied to outbound traffic.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Weighted Share</strong>: Signifies how much of the logical link&#8217;s capacity a specific network should be allocated, relative to the other networks attached to the same logical link. The exact share depends on the sum of shares of all networks on that link. By default this is a number in the range 1-100.</p>
</li>
<li>
<p><strong>Rate Limit [Mbps]</strong>: The maximum bandwidth to be used by a network.</p>
</li>
<li>
<p><strong>Committed Rate [Mbps]</strong>: The minimum bandwidth required by a network. The Committed Rate requested is not guaranteed and will vary depending on the network infrastructure and the Committed Rate requested by other networks on the same logical link.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To change the maximum value allowed by the <strong>Rate Limit [Mbps]</strong> or <strong>Committed Rate [Mbps]</strong> fields, use the <code>engine-config</code> command to change the value of the <code>MaxAverageNetworkQoSValue</code> configuration key. You must restart the <strong>ovirt-engine</strong> service for the change to take effect. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># engine-config -s MaxAverageNetworkQoSValue=2048
# systemctl restart ovirt-engine</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Host_Network_Quality_of_Service_Entry">6.3.3. Removing a Host Network Quality of Service Entry</h4>
<div class="paragraph">
<p>Remove an existing network quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Host Network Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>Host Network</strong>, select a host network quality of service entry and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> when prompted.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-CPU_Quality_of_Service">6.4. CPU Quality of Service</h3>
<div class="paragraph">
<p>CPU quality of service defines the maximum amount of processing capability a virtual machine can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. Assigning CPU quality of service to a virtual machine allows you to prevent the workload on one virtual machine in a cluster from affecting the processing resources available to other virtual machines in that cluster.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_CPU_Quality_of_Service_Entry">6.4.1. Creating a CPU Quality of Service Entry</h4>
<div class="paragraph">
<p>Create a CPU quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Creating a CPU Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>CPU</strong>, click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>QoS Name</strong> and a <strong>Description</strong> for the quality of service entry.</p>
</li>
<li>
<p>Enter the maximum processing capability the quality of service entry permits in the <strong>Limit (%)</strong> field. Do not include the <code>%</code> symbol.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have created a CPU quality of service entry, and can create CPU profiles based on that entry in clusters that belong to the data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_CPU_Quality_of_Service_Entry">6.4.2. Removing a CPU Quality of Service Entry</h4>
<div class="paragraph">
<p>Remove an existing CPU quality of service entry.</p>
</div>
<div class="paragraph">
<p><strong>Removing a CPU Quality of Service Entry</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>QoS</strong> tab.</p>
</li>
<li>
<p>Under <strong>CPU</strong>, select a CPU quality of service entry and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If any CPU profiles were based on that entry, the CPU quality of service entry for those profiles is automatically set to <code>[unlimited]</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Data_Centers">7. Data Centers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Data_Centers">7.1. Introduction to Data Centers</h3>
<div class="paragraph">
<p>A data center is a logical entity that defines the set of resources used in a specific environment. A data center is considered a container resource, in that it is comprised of logical resources, in the form of clusters and hosts; network resources, in the form of logical networks and physical NICs; and storage resources, in the form of storage domains.</p>
</div>
<div class="paragraph">
<p>A data center can contain multiple clusters, which can contain multiple hosts; it can have multiple storage domains associated to it; and it can support multiple virtual machines on each of its hosts. A oVirt environment can contain multiple data centers; the data center infrastructure allows you to keep these centers separate.</p>
</div>
<div class="paragraph">
<p>All data centers are managed from the single Administration Portal.</p>
</div>
<div id="data_center_fig" class="imageblock">
<div class="content">
<img src="images/523.png" alt="523">
</div>
<div class="title">Figure 12. Data Centers</div>
</div>
<div class="paragraph">
<p>oVirt creates a default data center during installation. You can configure the default data center, or set up new appropriately named data centers.</p>
</div>
<div class="sect3">
<h4 id="The_Storage_Pool_ManagerSPM">7.1.1. The Storage Pool Manager</h4>
<div class="paragraph">
<p>The Storage Pool Manager (SPM) is a role given to one of the hosts in the data center enabling it to manage the storage domains of the data center. The SPM entity can be run on any host in the data center; the oVirt Engine grants the role to one of the hosts. The SPM does not preclude the host from its standard operation; a host running as SPM can still host virtual resources.</p>
</div>
<div class="paragraph">
<p>The SPM entity controls access to storage by coordinating the metadata across the storage domains. This includes creating, deleting, and manipulating virtual disks (images), snapshots, and templates, and allocating storage for sparse block devices (on SAN). This is an exclusive responsibility: only one host can be the SPM in the data center at one time to ensure metadata integrity.</p>
</div>
<div class="paragraph">
<p>The oVirt Engine ensures that the SPM is always available. The Engine moves the SPM role to a different host if the SPM host encounters problems accessing the storage. When the SPM starts, it ensures that it is the only host granted the role; therefore it will acquire a storage-centric lease. This process can take some time.</p>
</div>
</div>
<div class="sect3">
<h4 id="SPM_Priority">7.1.2. SPM Priority</h4>
<div class="paragraph">
<p>The SPM role uses some of a host&#8217;s available resources. The SPM priority setting of a host alters the likelihood of the host being assigned the SPM role: a host with high SPM priority will be assigned the SPM role before a host with low SPM priority. Critical virtual machines on hosts with low SPM priority will not have to contend with SPM operations for host resources.</p>
</div>
<div class="paragraph">
<p>You can change a host&#8217;s SPM priority in the <strong>SPM</strong> tab in the <strong>Edit Host</strong> window.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Data_Center_Tasks">7.2. Data Center Tasks</h3>
<div class="sect3">
<h4 id="Creating_a_New_Data_Center">7.2.1. Creating a New Data Center</h4>
<div class="paragraph">
<p>This procedure creates a data center in your virtualization environment. The data center requires a functioning cluster, host, and storage domain to operate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you set the <strong>Compatibility Version</strong>, you cannot lower the version number. Version regression is not supported.</p>
</div>
<div class="paragraph">
<p>You can specify a MAC pool range for a cluster. Setting a MAC pool range is no longer supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Creating a New Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the data center.</p>
</li>
<li>
<p>Select the <strong>Storage Type</strong>, <strong>Compatibility Version</strong>, and <strong>Quota Mode</strong> of the data center from the drop-down menus.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to create the data center and open the <strong>Data Center - Guide Me</strong> window.</p>
</li>
<li>
<p>The <strong>Guide Me</strong> window lists the entities that need to be configured for the data center. Configure these entities or postpone configuration by clicking the <strong>Configure Later</strong> button. Configuration can be resumed by selecting the data center and clicking <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then clicking <strong>Guide Me</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new data center will remain <strong>Uninitialized</strong> until a cluster, host, and storage domain are configured for it; use <strong>Guide Me</strong> to configure these entities.</p>
</div>
</div>
<div class="sect3">
<h4 id="Data_center_properties">7.2.2. Explanation of Settings in the New Data Center and Edit Data Center Windows</h4>
<div class="paragraph">
<p>The table below describes the settings of a data center as displayed in the <strong>New Data Center</strong> and <strong>Edit Data Center</strong> windows. Invalid entries are outlined in orange when you click <b class="button">OK</b>, prohibiting the changes being accepted. In addition, field prompts indicate the expected values or range of values.</p>
</div>
<table id="datacenters-Properties" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Data Center Properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the data center. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the data center. This field is recommended but not mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Storage Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Choose <strong>Shared</strong> or <strong>Local</strong> storage type.</p>
<p class="tableblock">Different types of storage domains (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center. Local and shared domains, however, cannot be mixed.</p>
<p class="tableblock">You can change the storage type after the data center is initialized. See <a href="#Changing_the_Data_Center_Storage_Type">Changing the Data Center Storage Type</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Compatibility Version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of oVirt.</p>
<p class="tableblock">After upgrading the oVirt Engine, the hosts, clusters and data centers may still be in the earlier version. Ensure that you have upgraded all the hosts, then the clusters, before you upgrade the Compatibility Level of the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Quota Mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Quota is a resource limitation tool provided with oVirt. Choose one of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Disabled</strong>: Select if you do not want to implement Quota</p>
</li>
<li>
<p><strong>Audit</strong>: Select if you want to edit the Quota settings</p>
</li>
<li>
<p><strong>Enforced</strong>: Select to implement Quota</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optionally add a plain text comment about the data center.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Re-initializing_a_Data_Center">7.2.3. Re-Initializing a Data Center: Recovery Procedure</h4>
<div class="paragraph">
<p>This recovery procedure replaces the master data domain of your data center with a new master data domain. You must re-initialize your master data domain if its data is corrupted. Re-initializing a data center allows you to restore all other resources associated with the data center, including clusters, hosts, and non-problematic storage domains.</p>
</div>
<div class="paragraph">
<p>You can import any backup or exported virtual machines or templates into your new master data domain.</p>
</div>
<div class="paragraph">
<p><strong>Re-Initializing a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> and select the data center.</p>
</li>
<li>
<p>Ensure that any storage domains attached to the data center are in maintenance mode.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Re-Initialize Data Center</strong>.</p>
</li>
<li>
<p>The <strong>Data Center Re-Initialize</strong> window lists all available (detached; in maintenance mode) storage domains. Click the radio button for the storage domain you are adding to the data center.</p>
</li>
<li>
<p>Select the <strong>Approve operation</strong> check box.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is attached to the data center as the master data domain and activated. You can now import any backup or exported virtual machines or templates into your new master data domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Data_Center">7.2.4. Removing a Data Center</h4>
<div class="paragraph">
<p>An active host is required to remove a data center. Removing a data center will not remove the associated resources.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure the storage domains attached to the data center are in maintenance mode.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> and select the data center to remove.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Force_Removing_a_Data_Center">7.2.5. Force Removing a Data Center</h4>
<div class="paragraph">
<p>A data center becomes <code>Non Responsive</code> if the attached storage domain is corrupt or if the host becomes <code>Non Responsive</code>. You cannot <strong>Remove</strong> the data center under either circumstance.</p>
</div>
<div class="paragraph">
<p><strong>Force Remove</strong> does not require an active host. It also permanently removes the attached storage domain.</p>
</div>
<div class="paragraph">
<p>It may be necessary to <strong>Destroy</strong> a corrupted storage domain before you can <strong>Force Remove</strong> the data center.</p>
</div>
<div class="paragraph">
<p><strong>Force Removing a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> and select the data center to remove.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Force Remove</strong>.</p>
</li>
<li>
<p>Select the <strong>Approve operation</strong> check box.</p>
</li>
<li>
<p>Click <b class="button">OK</b></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The data center and attached storage domain are permanently removed from the oVirt environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="Changing_the_Data_Center_Storage_Type">7.2.6. Changing the Data Center Storage Type</h4>
<div class="paragraph">
<p>You can change the storage type of the data center after it has been initialized. This is useful for data domains that are used to move virtual machines or templates around.</p>
</div>
<div class="paragraph">
<p><strong>Limitations</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Shared to Local - For a data center that does not contain more than one host and more than one cluster, since a local data center does not support it.</p>
</li>
<li>
<p>Local to Shared - For a data center that does not contain a local storage domain.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Changing the Data Center Storage Type</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> and select the data center to change.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the <strong>Storage Type</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Changing_the_Data_Center_Compatibility_Version_admin">7.2.7. Changing the Data Center Compatibility Version</h4>
<div class="paragraph">
<p>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt with which the data center is intended to be compatible. All clusters in the data center must support the desired compatibility level.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>To change the data center compatibility level, you must first update the compatibility version of all clusters and virtual machines in the data center.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Select the data center to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Data Center Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Data_Centers_and_Storage_Domains">7.3. Data Centers and Storage Domains</h3>
<div class="sect3">
<h4 id="Attaching_a_data_domain">7.3.1. Attaching an Existing Data Domain to a Data Center</h4>
<div class="paragraph">
<p>Data domains that are <strong>Unattached</strong> can be attached to a data center. Shared storage domains of multiple types (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center.</p>
</div>
<div class="paragraph">
<p><strong>Attaching an Existing Data Domain to a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab to list the storage domains already attached to the data center.</p>
</li>
<li>
<p>Click <strong>Attach Data</strong>.</p>
</li>
<li>
<p>Select the check box for the data domain to attach to the data center. You can select multiple check boxes to attach multiple data domains.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The data domain is attached to the data center and is automatically activated.</p>
</div>
</div>
<div class="sect3">
<h4 id="Attaching_an_iso_domain">7.3.2. Attaching an Existing ISO domain to a Data Center</h4>
<div class="paragraph">
<p>An ISO domain that is <strong>Unattached</strong> can be attached to a data center. The ISO domain must be of the same <strong>Storage Type</strong> as the data center.</p>
</div>
<div class="paragraph">
<p>Only one ISO domain can be attached to a data center.</p>
</div>
<div class="paragraph">
<p><strong>Attaching an Existing ISO Domain to a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab to list the storage domains already attached to the data center.</p>
</li>
<li>
<p>Click <strong>Attach ISO</strong>.</p>
</li>
<li>
<p>Click the radio button for the appropriate ISO domain.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The ISO domain is attached to the data center and is automatically activated.</p>
</div>
</div>
<div class="sect3">
<h4 id="Attaching_an_export_domain">7.3.3. Attaching an Existing Export Domain to a Data Center</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See <a href="#sect-Importing_Existing_Storage_Domains">Importing Existing Storage Domains</a> for information on importing storage domains.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An export domain that is <strong>Unattached</strong> can be attached to a data center. Only one export domain can be attached to a data center.</p>
</div>
<div class="paragraph">
<p><strong>Attaching an Existing Export Domain to a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab to list the storage domains already attached to the data center.</p>
</li>
<li>
<p>Click <strong>Attach Export</strong>.</p>
</li>
<li>
<p>Click the radio button for the appropriate export domain.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The export domain is attached to the data center and is automatically activated.</p>
</div>
</div>
<div class="sect3">
<h4 id="Detaching_storage_domains_from_a_data_center">7.3.4. Detaching a Storage Domain from a Data Center</h4>
<div class="paragraph">
<p>Detaching a storage domain from a data center stops the data center from associating with that storage domain. The storage domain is not removed from the oVirt environment; it can be attached to another data center.</p>
</div>
<div class="paragraph">
<p>Data, such as virtual machines and templates, remains attached to the storage domain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The master storage, if it is the last available storage domain, cannot be removed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Detaching a Storage Domain from a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab to list the storage domains attached to the data center.</p>
</li>
<li>
<p>Select the storage domain to detach. If the storage domain is <code>Active</code>, click <strong>Maintenance</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to initiate maintenance mode.</p>
</li>
<li>
<p>Click <strong>Detach</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It can take up to several minutes for the storage domain to disappear from the details view.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Clusters">8. Clusters</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Clusters">8.1. Introduction to Clusters</h3>
<div class="paragraph">
<p>A cluster is a logical grouping of hosts that share the same storage domains and have the same type of CPU (either Intel or AMD). If the hosts have different generations of CPU models, they use only the features present in all models.</p>
</div>
<div class="paragraph">
<p>Each cluster in the system must belong to a data center, and each host in the system must belong to a cluster. Virtual machines are dynamically allocated to any host in a cluster and can be migrated between them, according to policies defined on the cluster and settings on the virtual machines. The cluster is the highest level at which power and load-sharing policies can be defined.</p>
</div>
<div class="paragraph">
<p>The number of hosts and number of virtual machines that belong to a cluster are displayed in the results list under <strong>Host Count</strong> and <strong>VM Count</strong>, respectively.</p>
</div>
<div class="paragraph">
<p>Clusters run virtual machines or Gluster Storage Servers. These two purposes are mutually exclusive: A single cluster cannot support virtualization and storage hosts together.</p>
</div>
<div class="paragraph">
<p>oVirt creates a default cluster in the default data center during installation.</p>
</div>
<div id="cluster_tab" class="imageblock">
<div class="content">
<img src="images/223.png" alt="223">
</div>
<div class="title">Figure 13. Cluster</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Cluster_Tasks">8.2. Cluster Tasks</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some cluster options do not apply to Gluster clusters. For more information about using Gluster Storage with oVirt, see <a href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.3/html/configuring_red_hat_virtualization_with_red_hat_gluster_storage/"><em>Configuring oVirt with Gluster Storage</em></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="Creating_a_New_Cluster">8.2.1. Creating a New Cluster</h4>
<div class="paragraph">
<p>A data center can contain multiple clusters, and a cluster can contain multiple hosts. All hosts in a cluster must have the same CPU architecture. To optimize your CPU types, create your hosts before you create your cluster. After creating the cluster, you can configure the hosts using the <strong>Guide Me</strong> button.</p>
</div>
<div class="paragraph">
<p><strong>Creating a New Cluster</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> the cluster will belong to from the drop-down list.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the cluster.</p>
</li>
<li>
<p>Select a network from the <strong>Management Network</strong> drop-down list to assign the management network role.</p>
</li>
<li>
<p>Select the <strong>CPU Architecture</strong>.</p>
</li>
<li>
<p>For <strong>CPU Type</strong>, select <em>the oldest CPU processor family</em> among the hosts that will be part of this cluster. The CPU types are listed in order from the oldest to newest.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A hosts whose CPU processor family is older than the one you specify with <strong>CPU Type</strong> cannot be part of this cluster.
For details, see <a href="https://access.redhat.com/solutions/634853" class="bare">https://access.redhat.com/solutions/634853</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the <strong>Compatibility Version</strong> of the cluster from the drop-down list.</p>
</li>
<li>
<p>Select the <strong>Switch Type</strong> from the drop-down list.</p>
</li>
<li>
<p>Select the <strong>Firewall Type</strong> for hosts in the cluster, either <strong>Firewalld</strong> (default) or <strong>iptables</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>iptables</strong> is only supported on Enterprise Linux 7 hosts, in clusters with compatibility version 4.2 or 4.3. You can only add Enterprise Linux 8 hosts to clusters with firewall type <strong>firewalld</strong></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select either the <strong>Enable Virt Service</strong> or <strong>Enable Gluster Service</strong> check box to define whether the cluster will be populated with virtual machine hosts or with Gluster-enabled nodes.</p>
</li>
<li>
<p>Optionally select the <strong>Enable to set VM maintenance reason</strong> check box to enable an optional reason field when a virtual machine is shut down from the Engine, allowing the administrator to provide an explanation for the maintenance.</p>
</li>
<li>
<p>Optionally select the <strong>Enable to set Host maintenance reason</strong> check box to enable an optional reason field when a host is placed into maintenance mode from the Engine, allowing the administrator to provide an explanation for the maintenance.</p>
</li>
<li>
<p>Optionally select the <strong>/dev/hwrng source</strong> (external hardware device) check box to specify the random number generator device that all hosts in the cluster will use. The <strong>/dev/urandom source</strong> (Linux-provided device) is enabled by default.</p>
</li>
<li>
<p>Click the <strong>Optimization</strong> tab to select the memory page sharing threshold for the cluster, and optionally enable CPU thread handling and memory ballooning on the hosts in the cluster.</p>
</li>
<li>
<p>Click the <strong>Migration Policy</strong> tab to define the virtual machine migration policy for the cluster.</p>
</li>
<li>
<p>Click the <strong>Scheduling Policy</strong> tab to optionally configure a scheduling policy, configure scheduler optimization settings, enable trusted service for hosts in the cluster, enable HA Reservation, and select a serial number policy.</p>
</li>
<li>
<p>Click the <strong>Console</strong> tab to optionally override the global SPICE proxy, if any, and specify the address of a SPICE proxy for hosts in the cluster.</p>
</li>
<li>
<p>Click the <strong>Fencing policy</strong> tab to enable or disable fencing in the cluster, and select fencing options.</p>
</li>
<li>
<p>Click the <strong>MAC Address Pool</strong> tab to specify a MAC address pool other than the default pool for the cluster. For more options on creating, editing, or removing MAC address pools, see <a href="#sect-MAC_Address_Pools">MAC Address Pools</a>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to create the cluster and open the <strong>Cluster - Guide Me</strong> window.</p>
</li>
<li>
<p>The <strong>Guide Me</strong> window lists the entities that need to be configured for the cluster. Configure these entities or postpone configuration by clicking the <strong>Configure Later</strong> button. Configuration can be resumed by selecting the cluster and clicking <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then clicking <strong>Guide Me</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Cluster_General_Settings_Explained">8.2.2. General Cluster Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>General</strong> tab in the <strong>New Cluster</strong> and <strong>Edit Cluster</strong> windows. Invalid entries are outlined in orange when you click <b class="button">OK</b>, prohibiting the changes being accepted. In addition, field prompts indicate the expected values or range of values.</p>
</div>
<table id="Cluster-Properties" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. General Cluster Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Data Center</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The data center that will contain the cluster. The data center must be created before adding a cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the cluster. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description / Comment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the cluster or additional notes. These fields are recommended but not mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Management Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The logical network that will be assigned the management network role. The default is <strong>ovirtmgmt</strong>. This network will also be used for migrating virtual machines if the migration network is not properly attached to the source or the destination hosts.</p>
<p class="tableblock">On existing clusters, the management network can only be changed using the <strong>Manage Networks</strong> button in the <strong>Logical Networks</strong> tab in the details view.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU Architecture</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The CPU architecture of the cluster. All hosts in a cluster must run the architecture you specify. Different CPU types are available depending on which CPU architecture is selected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>undefined</strong>: All other CPU types.</p>
</li>
<li>
<p><strong>x86_64</strong>: For Intel and AMD CPU types.</p>
</li>
<li>
<p><strong>ppc64</strong>: For IBM POWER CPU types.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The oldest CPU family in the cluster. For a list of CPU types, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#CPU_Requirements_RHV_planning">CPU Requirements</a> in the <em>Planning and Prerequisites Guide</em>. You cannot change this cannot after creating the cluster without significant disruption. Set CPU type to the oldest CPU model in the cluster. Only features present in all models can be used. For both Intel and AMD CPU types, the listed CPU models are in logical order from the oldest to the newest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Compatibility Version</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of oVirt. You will not be able to select a version earlier than the version specified for the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Switch Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of switch used by the cluster. <strong>Linux Bridge</strong> is the standard oVirt switch. <strong>OVS</strong> provides support for Open vSwitch networking features.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Firewall Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the firewall type for hosts in the cluster, either <strong>firewalld</strong> (default) or <strong>iptables</strong>.
<strong>iptables</strong> is only supported on Enterprise Linux 7 hosts, in clusters with compatibility version 4.2 or 4.3. You can only add Enterprise Linux 8 hosts to clusters with firewall type <strong>firewalld</strong>.
If you change an existing cluster&#8217;s firewall type, you must <a href="#Reinstalling_Hosts_admin">reinstall all hosts</a> in the cluster to apply the change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default Network Provider</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the default external network provider that the cluster will use. If you select Open Virtual Network (OVN), the hosts added to the cluster are automatically  configured to communicate with the OVN provider.</p>
<p class="tableblock">If you change the default network provider, you must <a href="#Reinstalling_Hosts_admin">reinstall all hosts</a> in the cluster to apply the change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Maximum Log Memory Threshold</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the logging threshold for maximum memory consumption as a percentage or as an absolute value in MB. A message is logged if a host&#8217;s memory usage exceeds the percentage value or if a host&#8217;s available memory falls below the absolute value in MB. The default is <code>95%</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Virt Service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this radio button is selected, hosts in this cluster will be used to run virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Gluster Service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this radio button is selected, hosts in this cluster will be used as Gluster Storage Server nodes, and not for running virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Import existing gluster configuration</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This check box is only available if the <strong>Enable Gluster Service</strong> radio button is selected. This option allows you to import an existing Gluster-enabled cluster and all its attached hosts to oVirt Engine.</p>
</div>
<div class="paragraph">
<p>The following options are required for each host in the cluster that is being imported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Address</strong>: Enter the IP or fully qualified domain name of the Gluster host server.</p>
</li>
<li>
<p><strong>Fingerprint</strong>: oVirt Engine fetches the host&#8217;s fingerprint, to ensure you are connecting with the correct host.</p>
</li>
<li>
<p><strong>Root Password</strong>: Enter the root password required for communicating with the host.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable to set VM maintenance reason</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this check box is selected, an optional reason field will appear when a virtual machine in the cluster is shut down from the Engine. This allows you to provide an explanation for the maintenance, which will appear in the logs and when the virtual machine is powered on again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable to set Host maintenance reason</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this check box is selected, an optional reason field will appear when a host in the cluster is moved into maintenance mode from the Engine. This allows you to provide an explanation for the maintenance, which will appear in the logs and when the host is activated again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Additional Random Number Generator source</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the check box is selected, all hosts in the cluster have the additional random number generator device available. This enables passthrough of entropy from the random number generator device to virtual machines.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Cluster_Optimization_Settings_Explained">8.2.3. Optimization Settings Explained</h4>
<div class="paragraph">
<p><strong>Memory Considerations</strong></p>
</div>
<div class="paragraph">
<p>Memory page sharing allows virtual machines to use up to 200% of their allocated memory by utilizing unused memory in other virtual machines. This process is based on the assumption that the virtual machines in your oVirt environment will not all be running at full capacity at the same time, allowing unused memory to be temporarily allocated to a particular virtual machine.</p>
</div>
<div id="CPU_Considerations_cluster_opt_settings" class="paragraph">
<p><strong>CPU Considerations</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>For non-CPU-intensive workloads</strong>, you can run virtual machines with a total number of processor cores greater than the number of cores in the host. Doing so enables the following:</p>
<div class="ulist">
<ul>
<li>
<p>You can run a greater number of virtual machines, which reduces hardware requirements.</p>
</li>
<li>
<p>You can configure virtual machines with CPU topologies that are otherwise not possible, such as when the number of virtual cores is between the number of host cores and the number of host threads.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>For best performance, and especially for CPU-intensive workloads</strong>, you should use the same topology in the virtual machine as in the host, so the host and the virtual machine expect the same cache usage. When the host has hyperthreading enabled, QEMU treats the host&#8217;s hyperthreads as cores, so the virtual machine is not aware that it is running on a single core with multiple threads. This behavior might impact the performance of a virtual machine, because a virtual core that actually corresponds to a hyperthread in the host core might share a single cache with another hyperthread in the same host core, while the virtual machine treats it as a separate core.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The table below describes the settings for the <strong>Optimization</strong> tab in the <strong>New Cluster</strong> and <strong>Edit Cluster</strong> windows.</p>
</div>
<table id="Memory_Optimization_settings" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Optimization Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Memory Optimization</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>None - Disable memory overcommit</strong>: Disables memory page sharing.</p>
</li>
<li>
<p><strong>For Server Load - Allow scheduling of 150% of physical memory</strong>: Sets the memory page sharing threshold to 150% of the system memory on each host.</p>
</li>
<li>
<p><strong>For Desktop Load - Allow scheduling of 200% of physical memory</strong>: Sets the memory page sharing threshold to 200% of the system memory on each host.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU Threads</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecting the <strong>Count Threads As Cores</strong> check box enables hosts to run virtual machines with a total number of processor cores greater than the number of cores in the host.</p>
<p class="tableblock">When this check box is selected, the exposed host threads are treated as cores that virtual machines can use. For example, a 24-core system with 2 threads per core (48 threads total) can run virtual machines with up to 48 cores each, and the algorithms to calculate host CPU load would compare load against twice as many potential utilized cores.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Memory Balloon</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecting the <strong>Enable Memory Balloon Optimization</strong> check box enables memory overcommitment on virtual machines running on the hosts in this cluster. When this check box is selected, the Memory Overcommit Manager (MoM) starts ballooning where and when possible, with a limitation of the guaranteed memory size of every virtual machine.</p>
<p class="tableblock">To have a balloon running, the virtual machine needs to have a balloon device with relevant drivers. Each virtual machine includes a balloon device unless specifically removed. Each host in this cluster receives a balloon policy update when its status changes to <code>Up</code>. If necessary, you can manually update the balloon policy on a host without having to change the status. See <a href="#Updating_the_MoM_Policy_on_Hosts_in_a_Cluster">Updating the MoM Policy on Hosts in a Cluster</a>.</p>
<p class="tableblock">It is important to understand that in some scenarios ballooning may collide with KSM. In such cases MoM will try to adjust the balloon size to minimize collisions. Additionally, in some scenarios ballooning may cause sub-optimal performance for a virtual machine. Administrators are advised to use ballooning optimization with caution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>KSM control</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selecting the <strong>Enable KSM</strong> check box enables MoM to run Kernel Same-page Merging (KSM) when necessary and when it can yield a memory saving benefit that outweighs its CPU cost.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Cluster_Migration_Policy_Settings_Explained">8.2.4. Migration Policy Settings Explained</h4>
<div class="paragraph">
<p>A migration policy defines the conditions for live migrating virtual machines in the event of host failure. These conditions include the downtime of the virtual machine during migration, network bandwidth, and how the virtual machines are prioritized.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Migration Policies Explained</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cluster default (Minimal downtime)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides in <code>vdsm.conf</code> are still applied. The guest agent hook mechanism is disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Minimal downtime</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A policy that lets virtual machines migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if the virtual machine migration does not converge after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Post-copy migration</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When used, post-copy migration pauses the migrating virtual machine vCPUs on the source host, transfers only a minimum of memory pages, activates the virtual machine vCPUs on the destination host, and transfers the remaining memory pages while the virtual machine is running on the destination.</p>
</div>
<div class="paragraph">
<p>The post-copy policy first tries pre-copy to verify whether convergence can occur. The migration switches to post-copy if the virtual machine migration does not converge after a long time.</p>
</div>
<div class="paragraph">
<p>This significantly reduces the downtime of the migrated virtual machine, and also guarantees that the migration finishes regardless of how rapidly the memory pages of the source virtual machine change. It is optimal for migrating virtual machines in heavy continuous use, which would not be possible to migrate with standard pre-copy migration.</p>
</div>
<div class="paragraph">
<p>The disadvantage of this policy is that in the post-copy phase, the virtual machine may slow down significantly as the missing parts of memory are transferred between the hosts.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the network connection breaks prior to the completion of the post-copy process, the Engine pauses and then kills the running virtual machine. Do not use post-copy migration if the virtual machine availability is critical or if the migration network is unstable.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Suspend workload if needed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A policy that lets virtual machines migrate in most situations, including virtual machines running heavy workloads. Because of this, virtual machines may experience a more significant downtime than with some of the other settings. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The bandwidth settings define the maximum bandwidth of both outgoing and incoming migrations per host.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Bandwidth Explained</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Policy</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Auto</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bandwidth is copied from the <strong>Rate Limit [Mbps]</strong> setting in the data center <strong>Host Network QoS</strong>. If the rate limit has not been defined, it is computed as a minimum of link speeds of sending and receiving network interfaces. If rate limit has not been set, and link speeds are not available,  it is determined by local VDSM setting on sending host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hypervisor default</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bandwidth is controlled by local VDSM setting on sending Host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Custom</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defined by user (in Mbps). This value is divided by the number of concurrent migrations (default is 2, to account for ingoing and outgoing migration). Therefore, the user-defined bandwidth must be large enough to accommodate all concurrent migrations.</p>
<p class="tableblock">For example, if the <code>Custom</code> bandwidth is defined as 600 Mbps, a virtual machine migration&#8217;s maximum bandwidth is actually 300 Mbps.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The resilience policy defines how the virtual machines are prioritized in the migration.</p>
</div>
<table id="Resilience_Policy_settings" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Resilience Policy Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migrate Virtual Machines</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Migrates all virtual machines in order of their defined priority.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migrate only Highly Available Virtual Machines</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Migrates only highly available virtual machines to prevent overloading other hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Do Not Migrate Virtual Machines</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prevents virtual machines from being migrated.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Cluster_Scheduling_Policy_Settings">8.2.5. Scheduling Policy Settings Explained</h4>
<div class="paragraph">
<p>Scheduling policies allow you to specify the usage and distribution of virtual machines between available hosts. Define the scheduling policy to enable automatic load balancing across the hosts in a cluster. Regardless of the scheduling policy, a virtual machine will not start on a host with an overloaded CPU. By default, a host&#8217;s CPU is considered overloaded if it has a load of more than 80% for 5 minutes, but these values can be changed using scheduling policies. See <a href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</a> in the <em>Administration Guide</em> for more information.</p>
</div>
<table id="Cluster-General" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Scheduling Policy Tab Properties</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Select Policy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select a policy from the drop-down list.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong>: Disables load-balancing or power-sharing between hosts for already-running virtual machines. This is the default mode. When a virtual machine is started, the memory and CPU processing load is spread evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <strong>CpuOverCommitDurationMinutes</strong>, <strong>HighUtilization</strong>, or <strong>MaxFreeMemoryForOverUtilized</strong>.</p>
</li>
<li>
<p><strong>evenly_distributed</strong>: Distributes the memory and CPU processing load evenly across all hosts in the cluster. Additional virtual machines attached to a host will not start if that host has reached the defined <strong>CpuOverCommitDurationMinutes</strong>, <strong>HighUtilization</strong>, or <strong>MaxFreeMemoryForOverUtilized</strong>.</p>
</li>
<li>
<p><strong>cluster_maintenance</strong>: Limits activity in a cluster during maintenance tasks. No new virtual machines may be started, except highly available virtual machines. If host failure occurs, highly available virtual machines will restart properly and any virtual machine can migrate.</p>
</li>
<li>
<p><strong>power_saving</strong>: Distributes the memory and CPU processing load across a subset of available hosts to reduce power consumption on underutilized hosts. Hosts with a CPU load below the low utilization value for longer than the defined time interval will migrate all virtual machines to other hosts so that it can be powered down. Additional virtual machines attached to a host will not start if that host has reached the defined high utilization value.</p>
</li>
<li>
<p><strong>vm_evenly_distributed</strong>: Distributes virtual machines evenly between hosts based on a count of the virtual machines. The cluster is considered unbalanced if any host is running more virtual machines than the <strong>HighVmCount</strong> and there is at least one host with a virtual machine count that falls outside of the <strong>MigrationThreshold</strong>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Properties</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The following properties appear depending on the selected policy. Edit them if necessary:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HighVmCount</strong>: Sets the minimum number of virtual machines that must be running per host to enable load balancing. The default value is 10 running virtual machines on one host. Load balancing is only enabled when there is at least one host in the cluster that has at least <code>HighVmCount</code> running virtual machines.</p>
</li>
<li>
<p><strong>MigrationThreshold</strong>: Defines a buffer before virtual machines are migrated from the host. It is the maximum inclusive difference in virtual machine count between the most highly-utilized host and the least-utilized host. The cluster is balanced when every host in the cluster has a virtual machine count that falls inside the migration threshold. The default value is <strong>5</strong>.</p>
</li>
<li>
<p><strong>SpmVmGrace</strong>: Defines the number of slots for virtual machines to be reserved on SPM hosts. The SPM host will have a lower load than other hosts, so this variable defines how many fewer virtual machines the SPM host can run in comparison to other hosts. The default value is <strong>5</strong>.</p>
</li>
<li>
<p><strong>CpuOverCommitDurationMinutes</strong>: Sets the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action. The defined time interval protects against temporary spikes in CPU load activating scheduling policies and instigating unnecessary virtual machine migration. Maximum two characters. The default value is <strong>2</strong>.</p>
</li>
<li>
<p><strong>HighUtilization</strong>: Expressed as a percentage. If the host runs with CPU usage at or above the high utilization value for the defined time interval, the oVirt Engine migrates virtual machines to other hosts in the cluster until the host&#8217;s CPU load is below the maximum service threshold. The default value is <strong>80</strong>.</p>
</li>
<li>
<p><strong>LowUtilization</strong>: Expressed as a percentage. If the host runs with CPU usage below the low utilization value for the defined time interval, the oVirt Engine will migrate virtual machines to other hosts in the cluster. The Engine will power down the original host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. The default value is <strong>20</strong>.</p>
</li>
<li>
<p><strong>ScaleDown</strong>: Reduces the impact of the <strong>HA Reservation</strong> weight function, by dividing a host&#8217;s score by the specified amount. This is an optional property that can be added to any policy, including <strong>none</strong>.</p>
</li>
<li>
<p><strong>HostsInReserve</strong>: Specifies a number of hosts to keep running even though there are no running virtual machines on them. This is an optional property that can be added to the <strong>power_saving</strong> policy.</p>
</li>
<li>
<p><strong>EnableAutomaticHostPowerManagement</strong>: Enables automatic power management for all hosts in the cluster. This is an optional property that can be added to the <strong>power_saving</strong> policy. The default value is <strong>true</strong>.</p>
</li>
<li>
<p><strong>MaxFreeMemoryForOverUtilized</strong>: Specifies the minimum amount of free memory a host should have, in MB. If a host has less free memory than this amount, the oVirt Engine considers the host overutilized. For example, if you set this property to <code>1000</code>, a host that has less than 1 GB of free memory is overutilized.</p>
<div class="paragraph">
<p>For details on how this property interacts with the <strong>power_saving</strong> and <strong>evenly_distributed</strong> policies, see <a href="#conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties">MaxFreeMemoryForOverUtilized and MinFreeMemoryForUnderUtilized cluster scheduling policy properties</a>.</p>
</div>
<div class="paragraph">
<p>You can add this property to the <strong>power_saving</strong> and <strong>evenly_distributed</strong> policies. Although it appears among the list of properties for the <strong>vm_evenly_distributed</strong> policy, it does not apply to that policy.</p>
</div>
</li>
<li>
<p><strong>MinFreeMemoryForUnderUtilized</strong>: Specifies the maximum amount of free memory a host should have, in MB. If a host has more free memory than this amount, the oVirt Engine scheduler considers the host underutilized. For example, if you set this parameter to <code>10000</code>, a host that has more than 10 GB of free memory is underutilized.</p>
<div class="paragraph">
<p>For details on how this property interacts with the <strong>power_saving</strong> and <strong>evenly_distributed</strong> policies, see <a href="#conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties">MaxFreeMemoryForOverUtilized and MinFreeMemoryForUnderUtilized cluster scheduling policy properties</a>.</p>
</div>
<div class="paragraph">
<p>You can add this property to the <strong>power_saving</strong> and <strong>evenly_distributed</strong> policies. Although it appears among the list of properties for the <strong>vm_evenly_distributed</strong> policy, it does not apply to that policy.</p>
</div>
</li>
<li>
<p><strong>HeSparesCount</strong>: Sets the number of additional self-hosted engine nodes that must reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. Other virtual machines are prevented from starting on a self-hosted engine node if doing so would not leave enough free memory for the Engine virtual machine. This is an optional property that can be added to the <strong>power_saving</strong>, <strong>vm_evenly_distributed</strong>, and <strong>evenly_distributed</strong> policies. The default value is <strong>0</strong>.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Scheduler Optimization</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Optimize scheduling for host weighing/ordering.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Optimize for Utilization</strong>: Includes weight modules in scheduling to allow best selection.</p>
</li>
<li>
<p><strong>Optimize for Speed</strong>: Skips host weighting in cases where there are more than ten pending requests.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Trusted Service</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable integration with an OpenAttestation server. Before this can be enabled, use the <code>engine-config</code> tool to enter the OpenAttestation server&#8217;s details. <strong>IMPORTANT</strong>: OpenAttestation and Intel Trusted Execution Technology (Intel TXT) are no longer available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable HA Reservation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable the Engine to monitor cluster capacity for highly available virtual machines. The Engine ensures that appropriate capacity exists within a cluster for virtual machines designated as highly available to migrate in the event that their existing host fails unexpectedly.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Serial Number Policy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the policy for assigning serial numbers to each new virtual machine in the cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>System Default</strong>: Use the system-wide defaults in the Engine database. To configure these defaults, <a href="https://ovirt.org/documentation/administration_guide/index#sect-the_engine_configuration_tool">use the engine configuration tool</a> to set the values of the <code>DefaultSerialNumberPolicy</code> and <code>DefaultCustomSerialNumber</code>. These key-value pairs are saved in the <code>vdc_options</code> table of the Engine database.</p>
<div class="paragraph">
<p>For <code>DefaultSerialNumberPolicy</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default value: <code>HOST_ID</code></p>
</li>
<li>
<p>Possible values: <code>HOST_ID</code>, <code>VM_ID</code>, <code>CUSTOM</code></p>
</li>
<li>
<p>Command line example: <code>engine-config --set DefaultSerialNumberPolicy=VM_ID</code></p>
</li>
<li>
<p>Important: Restart the Engine to apply the configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For <code>DefaultCustomSerialNumber</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default value: Dummy serial number</p>
</li>
<li>
<p>Possible values: Any string (max length 255 characters)</p>
</li>
<li>
<p>Command line example: <code>engine-config --set DefaultCustomSerialNumber="My very special string value"</code></p>
</li>
<li>
<p>Important: Restart the Engine to apply the configuration.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Host ID</strong>: Set each new virtual machine&#8217;s serial number to the UUID of the host.</p>
</li>
<li>
<p><strong>Vm ID</strong>: Set each new virtual machine&#8217;s serial number to the UUID of the virtual machine.</p>
</li>
<li>
<p><strong>Custom serial number</strong>: Set each new virtual machine&#8217;s serial number to the value you specify in the following <strong>Custom Serial Number</strong> parameter.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Custom Serial Number</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify the custom serial number to apply to new virtual machines in the cluster.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a host&#8217;s free memory drops below 20%, ballooning commands like <code>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</code> are logged to <strong>/var/log/vdsm/mom.log</strong>. <strong>/var/log/vdsm/mom.log</strong> is the Memory Overcommit Manager log file.</p>
</div>
</div>
<div class="sect3">
<h4 id="conc_maxfreememoryforoverutilized_and_minfreememoryforunderutilized_scheduling_policy_properties">8.2.6. MaxFreeMemoryForOverUtilized and MinFreeMemoryForUnderUtilized cluster scheduling policy properties</h4>
<div class="paragraph">
<p>The scheduler has a background process that migrates virtual machines according to the current cluster scheduling policy and its parameters. Based on the various criteria and their relative weights in a policy, the scheduler continuously categorizes hosts as <em>source hosts</em> or <em>destination hosts</em> and migrates individual virtual machines from the former to the latter.</p>
</div>
<div class="paragraph">
<p>The following description explains how the <strong>evenly_distributed</strong> and <strong>power_saving</strong> cluster scheduling policies interact with the <strong>MaxFreeMemoryForOverUtilized</strong> and <strong>MinFreeMemoryForUnderUtilized</strong> properties. Although both policies consider CPU and memory load, CPU load is not relevant for the <strong>MaxFreeMemoryForOverUtilized</strong> and <strong>MinFreeMemoryForUnderUtilized</strong> properties.</p>
</div>
<div class="paragraph">
<p>If you define the <strong>MaxFreeMemoryForOverUtilized</strong> and <strong>MinFreeMemoryForUnderUtilized</strong> properties as part of the <strong>evenly_distributed</strong> policy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hosts that have less free memory than <strong>MaxFreeMemoryForOverUtilized</strong> are overutilized and become source hosts.</p>
</li>
<li>
<p>Hosts that have more free memory than <strong>MinFreeMemoryForUnderUtilized</strong> are underutilized and become destination hosts.</p>
</li>
<li>
<p>If <strong>MaxFreeMemoryForOverUtilized</strong> is not defined, the scheduler does not migrate virtual machines based on the memory load. (It continues migrating virtual machines based on the policy&#8217;s other criteria, such as CPU load.)</p>
</li>
<li>
<p>If <strong>MinFreeMemoryForUnderUtilized</strong> is not defined, the scheduler considers all hosts eligible to become destination hosts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you define the <strong>MaxFreeMemoryForOverUtilized</strong> and <strong>MinFreeMemoryForUnderUtilized</strong> properties as part of the <strong>power_saving</strong> policy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hosts that have less free memory than <strong>MaxFreeMemoryForOverUtilized</strong> are overutilized and become source hosts.</p>
</li>
<li>
<p>Hosts that have more free memory than <strong>MinFreeMemoryForUnderUtilized</strong> are underutilized and become source hosts.</p>
</li>
<li>
<p>Hosts that have more free memory than <strong>MaxFreeMemoryForOverUtilized</strong> are not overutilized and become destination hosts.</p>
</li>
<li>
<p>Hosts that have less free memory than <strong>MinFreeMemoryForUnderUtilized</strong> are not underutilized and become destination hosts.</p>
</li>
<li>
<p>The scheduler prefers migrating virtual machines to hosts that are neither overutilized nor underutilized. If there are not enough of these hosts, the scheduler can migrate virtual machines to underutilized hosts. If the underutilized hosts are not needed for this purpose, the scheduler can power them down.</p>
</li>
<li>
<p>If <strong>MaxFreeMemoryForOverUtilized</strong> is not defined, no hosts are overutilized. Therefore, only underutilized hosts are source hosts, and destination hosts include all hosts in the cluster.</p>
</li>
<li>
<p>If <strong>MinFreeMemoryForUnderUtilized</strong> is not defined, only overutilized hosts are source hosts, and hosts that are not overutilized are destination hosts.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Cluster_Scheduling_Policy_Settings">Scheduling Policy Settings Explained</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Cluster_Console_Settings_Explained">8.2.7. Cluster Console Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>Console</strong> tab in the <strong>New Cluster</strong> and <strong>Edit Cluster</strong> windows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Console Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Define SPICE Proxy for Cluster</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this check box to enable overriding the SPICE proxy defined in global configuration. This feature is useful in a case where the user (who is, for example, connecting via the VM Portal) is outside of the network where the hypervisors reside.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Overridden SPICE proxy address</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The proxy by which the SPICE client connects to virtual machines. The address must be in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>protocol://[host]:[port]</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Fencing_Policy_Settings_Explained">8.2.8. Fencing Policy Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>Fencing Policy</strong> tab in the <strong>New Cluster</strong> and <strong>Edit Cluster</strong> windows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Fencing Policy Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable fencing</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables fencing on the cluster. Fencing is enabled by default, but can be disabled if required; for example, if temporary network issues are occurring or expected, administrators can disable fencing until diagnostics or maintenance activities are completed. Note that if fencing is disabled, highly available virtual machines running on non-responsive hosts will not be restarted elsewhere.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Skip fencing if host has live lease on storage</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this check box is selected, any hosts in the cluster that are Non Responsive and still connected to storage will not be fenced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Skip fencing on cluster connectivity issues</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this check box is selected, fencing will be temporarily disabled if the percentage of hosts in the cluster that are experiencing connectivity issues is greater than or equal to the defined <strong>Threshold</strong>. The <strong>Threshold</strong> value is selected from the drop-down list; available values are <strong>25</strong>, <strong>50</strong>, <strong>75</strong>, and <strong>100</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Skip fencing if gluster bricks are up</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option is only available when Gluster Storage functionality is enabled. If this check box is selected, fencing is skipped if bricks are running and can be reached from other peers. See <a href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#configure_high_availability_using_fencing_policies">Chapter 2. Configure High Availability using Fencing Policies</a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#ref-rhgs-fencing-policies">Appendix A. Fencing Policies for Gluster Storage</a> in <em>Maintaining Red Hat Hyperconverged Infrastructure</em> for more information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Skip fencing if gluster quorum not met</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option is only available when Gluster Storage functionality is enabled. If this check box is selected, fencing is skipped if bricks are running and shutting down the host will cause loss of quorum. See <a href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#configure_high_availability_using_fencing_policies">Chapter 2. Configure High Availability using Fencing Policies</a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#ref-rhgs-fencing-policies">Appendix A. Fencing Policies for Gluster Storage</a> in <em>Maintaining Red Hat Hyperconverged Infrastructure</em> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Configuring_scheduling_policy">8.2.9. Setting Load and Power Management Policies for Hosts in a Cluster</h4>
<div class="paragraph">
<p>The <strong>evenly_distributed</strong> and <strong>power_saving</strong> scheduling policies allow you to specify acceptable memory and CPU usage values, and the point at which virtual machines must be migrated to or from a host. The <strong>vm_evenly_distributed</strong> scheduling policy distributes virtual machines evenly between hosts based on a count of the virtual machines. Define the scheduling policy to enable automatic load balancing across the hosts in a cluster. For a detailed explanation of each scheduling policy, see <a href="#Cluster_Scheduling_Policy_Settings">Scheduling Policy Settings Explained</a>.</p>
</div>
<div class="paragraph">
<p><strong>Setting Load and Power Management Policies for Hosts</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select a cluster.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Scheduling Policy</strong> tab.</p>
</li>
<li>
<p>Select one of the following policies:</p>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong></p>
</li>
<li>
<p><strong>vm_evenly_distributed</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set the minimum number of virtual machines that must be running on at least one host to enable load balancing in the <strong>HighVmCount</strong> field.</p>
</li>
<li>
<p>Define the maximum acceptable difference between the number of virtual machines on the most highly-utilized host and the number of virtual machines on the least-utilized host in the <strong>MigrationThreshold</strong> field.</p>
</li>
<li>
<p>Define the number of slots for virtual machines to be reserved on SPM hosts in the <strong>SpmVmGrace</strong> field.</p>
</li>
<li>
<p>Optionally, in the <strong>HeSparesCount</strong> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <a href="#Configuring_Memory_Slots_Reserved_for_the_SHE">Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</a> for more information.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>evenly_distributed</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action in the <strong>CpuOverCommitDurationMinutes</strong> field.</p>
</li>
<li>
<p>Enter the CPU utilization percentage at which virtual machines start migrating to other hosts in the <strong>HighUtilization</strong> field.</p>
</li>
<li>
<p>Optionally, in the <strong>HeSparesCount</strong> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <a href="#Configuring_Memory_Slots_Reserved_for_the_SHE">Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</a> for more information.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>power_saving</strong></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set the time (in minutes) that a host can run a CPU load outside of the defined utilization values before the scheduling policy takes action in the <strong>CpuOverCommitDurationMinutes</strong> field.</p>
</li>
<li>
<p>Enter the CPU utilization percentage below which the host will be considered under-utilized in the <strong>LowUtilization</strong> field.</p>
</li>
<li>
<p>Enter the CPU utilization percentage at which virtual machines start migrating to other hosts in the <strong>HighUtilization</strong> field.</p>
</li>
<li>
<p>Optionally, in the <strong>HeSparesCount</strong> field, enter the number of additional self-hosted engine nodes on which to reserve enough free memory to start the Engine virtual machine if it migrates or shuts down. See <a href="#Configuring_Memory_Slots_Reserved_for_the_SHE">Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</a> for more information.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Choose one of the following as the <strong>Scheduler Optimization</strong> for the cluster:</p>
<div class="ulist">
<ul>
<li>
<p>Select <strong>Optimize for Utilization</strong> to include weight modules in scheduling to allow best selection.</p>
</li>
<li>
<p>Select <strong>Optimize for Speed</strong> to skip host weighting in cases where there are more than ten pending requests.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are using an OpenAttestation server to verify your hosts, and have set up the server&#8217;s details using the <code>engine-config</code> tool, select the <strong>Enable Trusted Service</strong> check box.</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>OpenAttestation and Intel Trusted Execution Technology (Intel TXT) are no longer available.</p>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Optionally select the <strong>Enable HA Reservation</strong> check box to enable the Engine to monitor cluster capacity for highly available virtual machines.</p>
</li>
<li>
<p>Optionally select a <strong>Serial Number Policy</strong> for the virtual machines in the cluster:</p>
<div class="ulist">
<ul>
<li>
<p><strong>System Default</strong>: Use the system-wide defaults, which are configured in the Engine database <a href="https://ovirt.org/documentation/administration_guide/index#sect-the_engine_configuration_tool">using the engine configuration tool</a> and the <code>DefaultSerialNumberPolicy</code> and <code>DefaultCustomSerialNumber</code> key names. The default value for <code>DefaultSerialNumberPolicy</code> is to use the Host ID. See <a href="https://ovirt.org/documentation/administration_guide/index#sect-Scheduling_Policies">Scheduling Policies</a> in the <em>Administration Guide</em> for more information.</p>
</li>
<li>
<p><strong>Host ID</strong>: Set each virtual machine&#8217;s serial number to the UUID of the host.</p>
</li>
<li>
<p><strong>Vm ID</strong>: Set each virtual machine&#8217;s serial number to the UUID of the virtual machine.</p>
</li>
<li>
<p><strong>Custom serial number</strong>: Set each virtual machine&#8217;s serial number to the value you specify in the following <strong>Custom Serial Number</strong> parameter.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Updating_the_MoM_Policy_on_Hosts_in_a_Cluster">8.2.10. Updating the MoM Policy on Hosts in a Cluster</h4>
<div class="paragraph">
<p>The Memory Overcommit Manager handles memory balloon and KSM functions on a host. Changes to these functions for a cluster pass to hosts the next time a host moves to a status of <strong>Up</strong> after being rebooted or in maintenance mode. However, if necessary you can apply important changes to a host immediately by synchronizing the MoM policy while the host is <strong>Up</strong>. The following procedure must be performed on each host individually.</p>
</div>
<div class="paragraph">
<p><strong>Synchronizing MoM Policy on a Host</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Hosts</strong> tab and select the host that requires an updated MoM policy.</p>
</li>
<li>
<p>Click <strong>Sync MoM Policy</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The MoM policy on the host is updated without having to move the host to maintenance mode and back <strong>Up</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_CPU_Profile">8.2.11. Creating a CPU Profile</h4>
<div class="paragraph">
<p>CPU profiles define the maximum amount of processing capability a virtual machine in a cluster can access on the host on which it runs, expressed as a percent of the total processing capability available to that host. CPU profiles are created based on CPU profiles defined under data centers, and are not automatically applied to all virtual machines in a cluster; they must be manually assigned to individual virtual machines for the profile to take effect.</p>
</div>
<div class="paragraph">
<p>This procedure assumes you have already defined one or more CPU quality of service entries under the data center to which the cluster belongs.</p>
</div>
<div class="paragraph">
<p><strong>Creating a CPU Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>CPU Profiles</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and a <strong>Description</strong> for the CPU profile.</p>
</li>
<li>
<p>Select the quality of service to apply to the CPU profile from the <strong>QoS</strong> list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_CPU_Profile">8.2.12. Removing a CPU Profile</h4>
<div class="paragraph">
<p>Remove an existing CPU profile from your oVirt environment.</p>
</div>
<div class="paragraph">
<p><strong>Removing a CPU Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>CPU Profiles</strong> tab and select the CPU profile to remove.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the CPU profile was assigned to any virtual machines, those virtual machines are automatically assigned the <code>default</code> CPU profile.</p>
</div>
</div>
<div class="sect3">
<h4 id="Importing_an_Existing_RHGS_Cluster">8.2.13. Importing an Existing Gluster Storage Cluster</h4>
<div class="paragraph">
<p>You can import a Gluster Storage cluster and all hosts belonging to the cluster into oVirt Engine.</p>
</div>
<div class="paragraph">
<p>When you provide details such as the IP address or host name and password of any host in the cluster, the <code>gluster peer status</code> command is executed on that host through SSH, then displays a list of hosts that are a part of the cluster. You must manually verify the fingerprint of each host and provide passwords for them. You will not be able to import the cluster if one of the hosts in the cluster is down or unreachable. As the newly imported hosts do not have VDSM installed, the bootstrap script installs all the necessary VDSM packages on the hosts after they have been imported, and reboots them.</p>
</div>
<div class="paragraph">
<p><strong>Importing an Existing Gluster Storage Cluster to the oVirt Engine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> the cluster will belong to.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the cluster.</p>
</li>
<li>
<p>Select the <strong>Enable Gluster Service</strong> check box and the <strong>Import existing gluster configuration</strong> check box.</p>
<div class="paragraph">
<p>The <strong>Import existing gluster configuration</strong> field is only displayed if the <strong>Enable Gluster Service</strong> is selected.</p>
</div>
</li>
<li>
<p>In the <strong>Hostname</strong> field, enter the host name or IP address of any server in the cluster.</p>
<div class="paragraph">
<p>The host <strong>SSH Fingerprint</strong> displays to ensure you are connecting with the correct host. If a host is unreachable or if there is a network error, an error <strong>Error in fetching fingerprint</strong> displays in the <strong>Fingerprint</strong> field.</p>
</div>
</li>
<li>
<p>Enter the <strong>Password</strong> for the server, and click <b class="button">OK</b>.</p>
</li>
<li>
<p>The <strong>Add Hosts</strong> window opens, and a list of hosts that are a part of the cluster displays.</p>
</li>
<li>
<p>For each host, enter the <strong>Name</strong> and the <strong>Root Password</strong>.</p>
</li>
<li>
<p>If you wish to use the same password for all hosts, select the <strong>Use a Common Password</strong> check box to enter the password in the provided text field.</p>
<div class="paragraph">
<p>Click <strong>Apply</strong> to set the entered password all hosts.</p>
</div>
<div class="paragraph">
<p>Verify that the fingerprints are valid and submit your changes by clicking <strong>OK</strong>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The bootstrap script installs all the necessary VDSM packages on the hosts after they have been imported, and reboots them. You have now successfully imported an existing Gluster Storage cluster into oVirt Engine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Explanation_of_Settings_in_the_Add_Hosts_Window">8.2.14. Explanation of Settings in the Add Hosts Window</h4>
<div class="paragraph">
<p>The <strong>Add Hosts</strong> window allows you to specify the details of the hosts imported as part of a Gluster-enabled cluster. This window appears after you have selected the <strong>Enable Gluster Service</strong> check box in the <strong>New Cluster</strong> window and provided the necessary host details.</p>
</div>
<table id="Add_Gluster_Hosts" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Add Gluster Hosts Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use a common password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tick this check box to use the same password for all hosts belonging to the cluster. Enter the password in the <strong>Password</strong> field, then click the <strong>Apply</strong> button to set the password on all hosts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the name of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname/IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is automatically populated with the fully qualified domain name or IP of the host you provided in the <strong>New Cluster</strong> window.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter a password in this field to use a different root password for each host. This field overrides the common password provided for all hosts in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fingerprint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host fingerprint is displayed to ensure you are connecting with the correct host. This field is automatically populated with the fingerprint of the host you provided in the <strong>New Cluster</strong> window.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Removing_a_cluster">8.2.15. Removing a Cluster</h4>
<div class="paragraph">
<p>Move all hosts out of a cluster before removing it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot remove the <strong>Default</strong> cluster, as it holds the <strong>Blank</strong> template. You can, however, rename the <strong>Default</strong> cluster and add it to a new data center.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Removing a Cluster</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select a cluster.</p>
</li>
<li>
<p>Ensure there are no hosts in the cluster.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="memory_optimization">8.2.16. Memory Optimization</h4>
<div class="paragraph">
<p>To increase the number of virtual machines on a host, you can use <em>memory overcommitment</em>, in which the memory you assign to virtual machines exceeds RAM and relies on swap space.</p>
</div>
<div class="paragraph">
<p>However, there are potential problems with memory overcommitment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Swapping performance - Swap space is slower and consumes more CPU resources than RAM, impacting virtual machine performance. Excessive swapping can lead to CPU thrashing.</p>
</li>
<li>
<p>Out-of-memory (OOM) killer - If the host runs out of swap space, new processes cannot start, and the kernel&#8217;s OOM killer daemon begins shutting down active processes such as virtual machine guests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To help overcome these shortcomings, you can do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Limit memory overcommitment using the <strong>Memory Optimization</strong> setting and the <em>Memory Overcommit Manager (MoM)</em>.</p>
</li>
<li>
<p>Make the swap space large enough to accommodate the maximum potential demand for virtual memory and have a safety margin remaining.</p>
</li>
<li>
<p>Reduce virtual memory size by enabling <em>memory ballooning</em> and <em>Kernel Same-page Merging (KSM)</em>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="memory-optimization-and-memory-overcommitment">Memory Optimization and Memory Overcommitment</h5>
<div class="paragraph">
<p>You can limit the amount of memory overcommitment by selecting one of the <strong>Memory Optimization</strong> settings: <strong>None</strong> (0%), <strong>150%</strong>, or <strong>200%</strong>.</p>
</div>
<div class="paragraph">
<p>Each setting represents a percentage of RAM. For example, with a host that has 64 GB RAM, selecting <strong>150%</strong> means you can overcommit memory by an additional 32 GB, for a total of 96 GB in virtual memory. If the host uses 4 GB of that total, the remaining 92 GB are available. You can assign most of that to the virtual machines (<strong>Memory Size</strong> on the <strong>System</strong> tab), but consider leaving some of it unassigned as a safety margin.</p>
</div>
<div class="paragraph">
<p>Sudden spikes in demand for virtual memory can impact performance before the MoM, memory ballooning, and KSM have time to re-optimize virtual memory. To reduce that impact, select a limit that is appropriate for the kinds of applications and workloads you are running:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For workloads that produce more incremental growth in demand for memory, select a higher percentage, such as <strong>200%</strong> or <strong>150%</strong>.</p>
</li>
<li>
<p>For more critical applications or workloads that produce more sudden increases in demand for memory, select a lower percentage, such as <strong>150%</strong> or <strong>None</strong> (0%). Selecting <strong>None</strong> helps prevent memory overcommitment but allows the MoM, memory balloon devices, and KSM to continue optimizing virtual memory.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Always test your <strong>Memory Optimization</strong> settings by stress testing under a wide range of conditions before deploying the configuration to production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the <strong>Memory Optimization</strong> setting, click the <strong>Optimization</strong> tab in the <strong>New Cluster</strong> or <strong>Edit Cluster</strong> windows. See <a href="#Cluster_Optimization_Settings_Explained">Optimization Settings Explained</a>.</p>
</div>
<div class="paragraph">
<p>Additional comments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://ovirt.org/documentation/data_warehouse_guide/index#Host_hourly_and_daily_history_views">Host Statistics views</a> display useful historical information for sizing the overcommitment ratio.</p>
</li>
<li>
<p>The actual memory available cannot be determined in real time because the amount of memory optimization achieved by KSM and memory ballooning changes continuously.</p>
</li>
<li>
<p>When virtual machines reach the virtual memory limit, new apps cannot start.</p>
</li>
<li>
<p>When you plan the number of virtual machines to run on a host, use the maximum virtual memory (physical memory size and the <strong>Memory Optimization</strong> setting) as a starting point. Do not factor in the smaller virtual memory achieved by memory optimizations such as memory ballooning and KSM.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="swap-space-and-memory-overcommitment">Swap Space and Memory Overcommitment</h5>
<div class="paragraph">
<p>Red Hat provides <a href="https://access.redhat.com/solutions/15244">these recommendations for configuring swap space</a>.</p>
</div>
<div class="paragraph">
<p>When applying these recommendations, follow the guidance to size the swap space as "last effort memory" for a worst-case scenario. Use the physical memory size and <strong>Memory Optimization</strong> setting as a basis for estimating the total virtual memory size. Exclude any reduction of the virtual memory size from optimization by the MoM, memory ballooning, and KSM.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To help prevent an OOM condition, make the swap space large enough to handle a worst-case scenario and still have a safety margin available. Always stress-test your configuration under a wide range of conditions before deploying it to production.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="the-memory-overcommit-manager-mom">The Memory Overcommit Manager (MoM)</h5>
<div class="paragraph">
<p>The <em>Memory Overcommit Manager (MoM)</em> does two things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It limits memory overcommitment by applying the <strong>Memory Optimization</strong> setting to the hosts in a cluster, as described in the preceding section.</p>
</li>
<li>
<p>It optimizes memory by managing the <em>memory ballooning</em> and <em>KSM</em>, as described in the following sections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You do not need to enable or disable MoM.</p>
</div>
<div class="paragraph">
<p>When a host&#8217;s free memory drops below 20%, ballooning commands like <code>mom.Controllers.Balloon - INFO Ballooning guest:half1 from 1096400 to 1991580</code> are logged to <strong>/var/log/vdsm/mom.log</strong>, the Memory Overcommit Manager log file.</p>
</div>
</div>
<div class="sect4">
<h5 id="memory-ballooning">Memory Ballooning</h5>
<div class="paragraph">
<p>Virtual machines start with the full amount of virtual memory you have assigned to them. As virtual memory usage exceeds RAM, the host relies more on swap space. If enabled, <em>memory ballooning</em> lets virtual machines give up the unused portion of that memory. The freed memory can be reused by other processes and virtual machines on the host. The reduced memory footprint makes swapping less likely and improves performance.</p>
</div>
<div class="paragraph">
<p>The <em>virtio-balloon</em> package that provides the memory balloon device and drivers ships as a loadable kernel module (LKM). By default, it is configured to load automatically. Blacklisting the module or unloading it disables ballooning.</p>
</div>
<div class="paragraph">
<p>The memory balloon devices do not coordinate directly with each other; they rely on the host&#8217;s Memory Overcommit Manager (MoM) process to continuously monitor each virtual machine needs and instruct the balloon device to increase or decrease virtual memory.</p>
</div>
<div class="paragraph">
<p>Performance considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Red Hat does not recommend memory ballooning and overcommitment for workloads that require continuous high-performance and low latency. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</a>.</p>
</li>
<li>
<p>Use memory ballooning when increasing virtual machine density (economy) is more important than performance.</p>
</li>
<li>
<p>Memory ballooning does not have a significant impact on CPU utilization. (KSM consumes some CPU resources, but consumption remains consistent under pressure.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable memory ballooning, click the <strong>Optimization</strong> tab in the <strong>New Cluster</strong> or <strong>Edit Cluster</strong> windows. Then select the <strong>Enable Memory Balloon Optimization</strong> checkbox. This setting enables memory overcommitment on virtual machines running on the hosts in this cluster. When this check box is selected, the MoM starts ballooning where and when possible, with a limitation of the guaranteed memory size of every virtual machine. See <a href="#Cluster_Optimization_Settings_Explained">Optimization Settings Explained</a>.</p>
</div>
<div class="paragraph">
<p>Each host in this cluster receives a balloon policy update when its status changes to Up. If necessary, you can manually update the balloon policy on a host without having to change the status. See <a href="#Updating_the_MoM_Policy_on_Hosts_in_a_Cluster">Updating the MoM Policy on Hosts in a Cluster</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="kernel-same-page-merging-ksm">Kernel Same-page Merging (KSM)</h5>
<div class="paragraph">
<p>When a virtual machine runs, it often creates duplicate memory pages for items such as common libraries and high-use data. Furthermore, virtual machines that run similar guest operating systems and applications produce duplicate memory pages in virtual memory.</p>
</div>
<div class="paragraph">
<p>When enabled, <em>Kernel Same-page Merging</em> (KSM) examines the virtual memory on a host, eliminates duplicate memory pages, and shares the remaining memory pages across multiple applications and virtual machines. These shared memory pages are marked copy-on-write; if a virtual machine needs to write changes to the page, it makes a copy first before writing its modifications to that copy.</p>
</div>
<div class="paragraph">
<p>While KSM is enabled, the MoM manages KSM. You do not need to configure or control KSM manually.</p>
</div>
<div class="paragraph">
<p>KSM increases virtual memory performance in two ways. Because a shared memory page is used more frequently, the host is more likely to the store it in cache or main memory, which improves the memory access speed. Additionally, with memory overcommitment, KSM reduces the virtual memory footprint, reducing the likelihood of swapping and improving performance.</p>
</div>
<div class="paragraph">
<p>KSM consumes more CPU resources than memory ballooning. The amount of CPU KSM consumes remains consistent under pressure. Running identical virtual machines and applications on a host provides KSM with more opportunities to merge memory pages than running dissimilar ones. If you run mostly dissimilar virtual machines and applications, the CPU cost of using KSM may offset its benefits.</p>
</div>
<div class="paragraph">
<p>Performance considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After the KSM daemon merges large amounts of memory, the kernel memory accounting statistics may eventually contradict each other. If your system has a large amount of free memory, you might improve performance by disabling KSM.</p>
</li>
<li>
<p>Red Hat does not recommend KSM and overcommitment for workloads that require continuous high-performance and low latency. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</a>.</p>
</li>
<li>
<p>Use KSM when increasing virtual machine density (economy) is more important than performance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To enable KSM, click the <strong>Optimization</strong> tab in the <strong>New Cluster</strong> or <strong>Edit Cluster</strong> windows. Then select the <strong>Enable KSM</strong> checkbox. This setting enables MoM to run KSM when necessary and when it can yield a memory saving benefit that outweighs its CPU cost. See <a href="#Cluster_Optimization_Settings_Explained">Optimization Settings Explained</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="About_UEFI_Q35-cluster_opt_settings">8.2.17. UEFI and the Q35 chipset</h4>
<div class="paragraph">
<p>The Intel Q35 chipset, the default chipset for new virtual machines, includes support for the Unified Extensible Firmware Interface (UEFI), which replaces legacy BIOS.</p>
</div>
<div class="paragraph">
<p>Alternatively you can configure a virtual machine or cluster to use the legacy Intel i440fx chipset, which does not support UEFI.</p>
</div>
<div class="paragraph">
<p>UEFI provides several advantages over legacy BIOS, including the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A modern boot loader</p>
</li>
<li>
<p>SecureBoot, which authenticates the digital signatures of the boot loader</p>
</li>
<li>
<p>GUID Partition Table (GPT), which enables disks larger than 2 TB</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use UEFI on a virtual machine, you must configure the virtual machines cluster for 4.4 compatibility or later. Then you can set UEFI for any existing virtual machine, or to be the default BIOS type for new virtual machines in the cluster. The following options are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Available BIOS Types</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">BIOS Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q35 Chipset with Legacy BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy BIOS without UEFI (Default for clusters with compatibility version 4.4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q35 Chipset with UEFI BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIOS with UEFI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Q35 Chipset with SecureBoot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UEFI with SecureBoot, which authenticates the digital signatures of the boot loader</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Legacy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i440fx chipset with legacy BIOS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Setting the BIOS type before installing the operating system</div>
<p>You can configure a virtual machine to use the Q35 chipset and UEFI before installing an operating system. Converting a virtual machine from legacy BIOS to UEFI is not supported after installing an operating system.</p>
</div>
<div class="sect4">
<h5 id="Configuring_cluster_to_use_Q35_or_UEFI_cluster_opt_settings">Configuring a cluster to use the Q35 Chipset and UEFI</h5>
<div class="paragraph">
<p>After upgrading a cluster to  oVirt 4.4, all virtual machines in the cluster run the 4.4 version of VDSM. You can configure a clusters default BIOS type, which determines the default BIOS type of any new virtual machines you create in that cluster. If necessary, you can override the cluster&#8217;s default BIOS type by specifying a different BIOS type when you create a virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the VM Portal or the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Select a cluster and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click <strong>General</strong>.</p>
</li>
<li>
<p>Define the default BIOS type for new virtual machines in the cluster by clicking the <strong>BIOS Type</strong> dropdown menu, and selecting one of the following:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Legacy</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with Legacy BIOS</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with UEFI BIOS</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with SecureBoot</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>From the <strong>Compatibility Version</strong> dropdown menu select <strong>4.4</strong>. The Engine checks that all running hosts are compatible with 4.4, and if they are, the Engine uses 4.4 features.</p>
</li>
<li>
<p>If any existing virtual machines in the cluster should use the new BIOS type, configure them to do so.
Any new virtual machines in the cluster that are configured to use the BIOS type <strong>Cluster default</strong> now use the BIOS type you selected. For more information, see <a href="#Configuring_vm_to_use_Q35_or_UEFI_cluster_opt_settings">Configuring a virtual machine to use the Q35 Chipset and UEFI</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because you can change the BIOS type only before installing an operating system, for any existing virtual machines that are configured to use the BIOS type <strong>Cluster default</strong>, change the BIOS type to the previous default cluster BIOS type. Otherwise the virtual machine might not boot. Alternatively, you can reinstall the virtual machine&#8217;s operating system.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Configuring_vm_to_use_Q35_or_UEFI_cluster_opt_settings">Configuring a virtual machine to use the Q35 Chipset and UEFI</h5>
<div class="paragraph">
<p>You can configure a virtual machine to use the Q35 chipset and UEFI before installing an operating system. Converting a virtual machine from legacy BIOS to UEFI, or from UEFI to legacy BIOS, might prevent the virtual machine from booting. If you change the BIOS type of an existing virtual machine, reinstall the operating system.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the virtual machines BIOS type is set to <strong>Cluster default</strong>, changing the BIOS type of the cluster changes the BIOS type of the virtual machine. If the virtual machine has an operating system installed, changing the cluster BIOS type can cause booting the virtual machine to fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure a virtual machine to use the Q35 chipset and UEFI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the VM Portal or the Administration Portal click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Select a virtual machine and click <strong>Edit</strong>.</p>
</li>
<li>
<p>On the <strong>General</strong> tab, click <strong>Show Advanced Options</strong>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">System</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Advanced Parameters</b></span>.</p>
</li>
<li>
<p>Select one of the following from the <strong>BIOS Type</strong> dropdown menu:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Cluster default</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with Legacy BIOS</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with UEFI BIOS</strong></p>
</li>
<li>
<p><strong>Q35 Chipset with SecureBoot</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>From the Virtual Machine portal or the Administration Portal, power off the virtual machine.
The next time you start the virtual machine, it will run with the new BIOS type you selected.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Changing_the_Cluster_Compatibility_Version_admin">8.2.18. Changing the Cluster Compatibility Version</h4>
<div class="paragraph">
<p>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>To change the cluster compatibility level, you must first update all the hosts in your cluster to a level that supports your desired compatibility level. Check if there is an icon next to the host indicating an update is available.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>Virtio NICs are enumerated as a different device after upgrading the cluster compatibility level to 4.6. Therefore, the NICs might need to be reconfigured. oVirt recommends that you test the virtual machines before you upgrade the cluster by setting the cluster compatibility level to 4.6 on the virtual machine and verifying the network connection.</p>
<div class="paragraph">
<p>If the network connection for the virtual machine fails, configure the virtual machine with a custom emulated machine that matches the current emulated machine, for example pc-q35-rhel8.3.0 for 4.5 compatibility version, before upgrading the cluster.</p>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Select the cluster to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>On the <strong>General</strong> tab, change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Cluster Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An error message might warn that some virtual machines and templates are incorrectly configured. To fix this error, edit each virtual machine manually. The <strong>Edit Virtual Machine</strong> window provides additional validations and warnings that show what to correct. Sometimes the issue is automatically corrected and the virtual machine&#8217;s configuration just needs to be saved again. After editing each virtual machine, you will be able to change the cluster compatibility version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After updating a cluster&#8217;s compatibility version, you must update the cluster compatibility version of all running or suspended virtual machines by rebooting them from the Administration Portal, or using the REST API, instead of from within the guest operating system. Virtual machines that require a reboot are marked with the pending changes icon (<span class="image"><img src="common/images/pendingchanges.png" alt="pendingchanges"></span>). You cannot change the cluster compatibility version of a virtual machine snapshot that is in preview. You must first commit or undo the preview.</p>
</div>
<div class="paragraph">
<p>In a self-hosted engine environment, the Engine virtual machine does not need to be restarted.</p>
</div>
<div class="paragraph">
<p>Although you can wait to reboot the virtual machines at a convenient time, rebooting immediately is highly recommended so that the virtual machines use the latest configuration. Virtual machines that have not been updated run with the old configuration, and the new configuration could be overwritten if other changes are made to the virtual machine before the reboot.</p>
</div>
<div class="paragraph">
<p>Once you have updated the compatibility version of all clusters and virtual machines in a data center, you can then change the compatibility version of the data center itself.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Logical_Networks">9. Logical Networks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-Logical_Network_Tasks">9.1. Logical Network Tasks</h3>
<div class="sect3">
<h4 id="Performing_Networking_Tasks">9.1.1. Performing Networking Tasks</h4>
<div class="paragraph">
<p><span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span> provides a central location for users to perform logical network-related operations and search for logical networks based on each network&#8217;s property or association with other resources. The <strong>New</strong>, <strong>Edit</strong> and <strong>Remove</strong> buttons allow you to create, change the properties of, and delete logical networks within data centers.</p>
</div>
<div class="paragraph">
<p>Click each network name and use the tabs in the details view to perform functions including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attaching or detaching the networks to clusters and hosts</p>
</li>
<li>
<p>Removing network interfaces from virtual machines and templates</p>
</li>
<li>
<p>Adding and removing permissions for users to access and manage networks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These functions are also accessible through each individual resource.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not change networking in a data center or a cluster if any hosts are running as this risks making the host unreachable.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you plan to use oVirt nodes to provide any services, remember that the services will stop if the oVirt environment stops operating.</p>
</div>
<div class="paragraph">
<p>This applies to all services, but you should be especially aware of the hazards of running the following on oVirt:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directory Services</p>
</li>
<li>
<p>DNS</p>
</li>
<li>
<p>Storage</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_new_logical_network_in_a_data_center_or_cluster">9.1.2. Creating a New Logical Network in a Data Center or Cluster</h4>
<div class="paragraph">
<p>Create a logical network and define its use in a data center, or in clusters in a data center.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> or <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the data center or cluster name. The <strong>Details</strong> view opens.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab.</p>
</li>
<li>
<p>Open the <strong>New Logical Network</strong> window:</p>
<div class="ulist">
<ul>
<li>
<p>From a data center details view, click <strong>New</strong>.</p>
</li>
<li>
<p>From a cluster details view, click <strong>Add Network</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter a <strong>Name</strong>, <strong>Description</strong>, and <strong>Comment</strong> for the logical network.</p>
</li>
<li>
<p>Optional: Enable <strong>Enable VLAN tagging</strong>.</p>
</li>
<li>
<p>Optional: Disable <strong>VM Network</strong>.</p>
</li>
<li>
<p>Optional: Select the <strong>Create on external provider</strong> checkbox. This disables the network label and the VM network. See <a href="#chap-External_Providers">External Providers</a> for details.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the <strong>External Provider</strong>. The <strong>External Provider</strong> list does not include external providers that are in read-only mode.</p>
</li>
<li>
<p>To create an internal, isolated network, select <strong>ovirt-provider-ovn</strong> on the <strong>External Provider</strong> list and leave <strong>Connect to physical network</strong> cleared.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Enter a new label or select an existing label for the logical network in the <strong>Network Label</strong> text field.</p>
</li>
<li>
<p>For <strong>MTU</strong>, either select <strong>Default (1500)</strong> or select <strong>Custom</strong> and specify a custom value.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you create a network on an external provider, you cannot change the network&#8217;s MTU settings.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the networks <strong>MTU</strong> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machines vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <a href="https://access.redhat.com/solutions/4540631" class="bare">https://access.redhat.com/solutions/4540631</a> and <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you selected <strong>ovirt-provider-ovn</strong> from the <strong>External Provider</strong> drop-down list, define whether the network should implement <strong>Security Groups</strong>. See <a href="#Logical_Network_General_Settings_Explained">Logical Network General Settings Explained</a> for details.</p>
</li>
<li>
<p>From the <strong>Cluster</strong> tab, select the clusters to which the network will be assigned. You can also specify whether the logical network will be a required network.</p>
</li>
<li>
<p>If the <strong>Create on external provider</strong> checkbox is selected, the <strong>Subnet</strong> tab is visible. From the <strong>Subnet</strong> tab, select the <strong>Create subnet</strong> and enter a <strong>Name</strong>, <strong>CIDR</strong>, and <strong>Gateway</strong> address, and select an <strong>IP Version</strong> for the subnet that the logical network will provide. You can also add DNS servers as required.</p>
</li>
<li>
<p>From the <strong>vNIC Profiles</strong> tab, add vNIC profiles to the logical network as required.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you entered a label for the logical network, it is automatically added to all host network interfaces with that label.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When creating a new logical network or making changes to an existing logical network that is used as a display network, any running virtual machines that use that network must be rebooted before the network becomes available or the changes are applied.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Editing_a_Logical_Network">9.1.3. Editing a Logical Network</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A logical network cannot be edited or moved to another interface if it is not synchronized with the network configuration on the host. See <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a> on how to synchronize your networks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Editing a Logical Network</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click the data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab and select a logical network.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Edit the necessary settings.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can edit the name of a new or existing network, with the exception of the default network, without having to stop the virtual machines.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Multi-host network configuration automatically applies updated network settings to all of the hosts within the data center to which the network is assigned. Changes can only be applied when virtual machines using the network are down. You cannot rename a logical network that is already configured on a host. You cannot disable the <strong>VM Network</strong> option while virtual machines or templates using that network are running.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Logical_Network">9.1.4. Removing a Logical Network</h4>
<div class="paragraph">
<p>You can remove a logical network from <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span> or <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>. The following procedure shows you how to remove logical networks associated to a data center. For a working oVirt environment, you must have at least one logical network used as the <strong>ovirtmgmt</strong> management network.</p>
</div>
<div class="paragraph">
<p><strong>Removing Logical Networks</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click a data center&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab to list the logical networks in the data center.</p>
</li>
<li>
<p>Select a logical network and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Optionally, select the <strong>Remove external network(s) from the provider(s) as well</strong> check box to remove the logical network both from the Engine and from the external provider if the network is provided by an external provider. The check box is grayed out if the external provider is in read-only mode.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The logical network is removed from the Engine and is no longer available.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_a_Default_Route">9.1.5. Configuring a Non-Management Logical Network as the Default Route</h4>
<div class="paragraph">
<p>The default route used by hosts in a cluster is through the management network (<code>ovirtmgmt</code>). The following procedure provides instructions to configure a non-management logical network as the default route.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisite:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are using the <code>default_route</code> custom property, you need to clear the custom property from all attached hosts and then follow this procedure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring the Default Route Role</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the name of the non-management logical network to configure as the default route to access its details.</p>
</li>
<li>
<p>Click the <strong>Clusters</strong> tab.</p>
</li>
<li>
<p>Click <strong>Manage Network</strong>. This opens the <strong>Manage Network</strong> window.</p>
</li>
<li>
<p>Select the <strong>Default Route</strong> checkbox for the appropriate cluster(s).</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When networks are attached to a host, the default route of the host will be set on the network of your choice. It is recommended to configure the default route role before any host is added to your cluster. If your cluster already contains hosts, they may become out-of-sync until you sync your change to them.</p>
</div>
<div class="ulist">
<div class="title">Important Limitations with IPv6</div>
<ul>
<li>
<p>For IPv6, oVirt supports only static addressing.</p>
</li>
<li>
<p>If both networks share a single gateway (are on the same subnet), you can move the default route role from the management network (ovirtmgmt) to another logical network.</p>
</li>
<li>
<p>If the host and Engine are not on the same subnet, the Engine loses connectivity with the host because the IPv6 gateway has been removed.</p>
</li>
<li>
<p>Moving the default route role to a non-management network removes the IPv6 gateway from the network interface and generates an alert: "On cluster <em>clustername</em> the 'Default Route Role' network is no longer network ovirtmgmt. The IPv6 gateway is being removed from this network."</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-Adding-a-static-route-on-a-host">9.1.6. Adding a static route on a host</h4>
<div class="paragraph">
<p>You can use nmstate to add static routes to hosts. This method requires you to configure the hosts directly, without using oVirt Engine.</p>
</div>
<div class="paragraph">
<p>Static-routes you add are preserved as long as the related routed bridge, interface, or bond exists and has an IP address. Otherwise, the system removes the static route.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Except for adding or removing a static route on a host, always use the oVirt Engine to configure host network settings in your cluster. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The custom static-route is preserved so long as its interface/bond exists and has an IP address. Otherwise, it will be removed.</p>
</div>
<div class="paragraph">
<p>As a result, VM networks behave differently from non-VM networks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VM networks are based on a bridge. Moving the network from one interfaces/bond to another does not affect the route on a VM Network.</p>
</li>
<li>
<p>Non-VM networks are based on an interface. Moving the network from one interfaces/bond to another deletes the route related to the Non-VM network.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>This procedure requires nmstate, which is only available if your environment uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>oVirt Engine version 4.4</p>
</li>
<li>
<p>Enterprise Linux hosts and oVirt Nodes that are based on Enterprise Linux 8</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the host you want to configure.</p>
</li>
<li>
<p>On the host, create a <code>static_route.yml</code> file, with the following example content:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">routes</span>:
  <span style="color:#606">config</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">destination: 192.168.123.0/24</span></span>
    <span style="color:#606">next-hop-address</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">192.168.178.1</span></span>
    <span style="color:#606">next-hop-interface</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">eth1</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Replace the example values shown with real values for your network.</p>
</li>
<li>
<p>To route your traffic to a secondary added network, use <code>next-hop-interface</code> to specify an interface or network name.</p>
<div class="ulist">
<ul>
<li>
<p>To use a non-virtual machine network, specify an interface such as <code>eth1</code>.</p>
</li>
<li>
<p>To use a virtual machine network, specify a network name that is also the bridge name such as <code>net1</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ nmstatectl set static_route.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification steps</div>
<ul>
<li>
<p>Run the IP route command, <code>ip route</code>, with the destination parameter value you set in <code>static_route.yml</code>. This should show the desired route. For example, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ ip route | grep 192.168.123.0`</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#proc-Removing-a-static-route-on-a-host">Removing a static route on a host</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-Removing-a-static-route-on-a-host">9.1.7. Removing a static route on a host</h4>
<div class="paragraph">
<p>You can use nmstate to remove static routes from hosts. This method requires you to configure the hosts directly, without using oVirt Engine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Except for adding or removing a static route on a host, always use the oVirt Engine to configure host network settings in your cluster. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The custom static-route is preserved so long as its interface/bond exists and has an IP address. Otherwise, it will be removed.</p>
</div>
<div class="paragraph">
<p>As a result, VM networks behave differently from non-VM networks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VM networks are based on a bridge. Moving the network from one interfaces/bond to another does not affect the route on a VM Network.</p>
</li>
<li>
<p>Non-VM networks are based on an interface. Moving the network from one interfaces/bond to another deletes the route related to the Non-VM network.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>This procedure requires nmstate, which is only available if your environment uses:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>oVirt Engine version 4.4</p>
</li>
<li>
<p>Enterprise Linux hosts and oVirt Nodes that are based on Enterprise Linux 8</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Connect to the host you want to reconfigure.</p>
</li>
<li>
<p>On the host, edit the <code>static_route.yml</code> file.</p>
</li>
<li>
<p>Insert a line <code>state: absent</code> as shown in the following example.</p>
</li>
<li>
<p>Add the value of <code>next-hop-interface</code> between the brackets of <code>interfaces: []</code>. The result should look similar to the example shown here.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">routes</span>:
  <span style="color:#606">config</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">destination: 192.168.123.0/24</span></span>
    <span style="color:#606">next-hop-address</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">192.168.178.</span></span>
    <span style="color:#606">next-hop-interface</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">eth1</span></span>
    <span style="color:#606">state</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">absent</span></span>
<span style="color:#606">interfaces</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">[{name: eth1}]</span></span></code></pre>
</div>
</div>
</li>
<li>
<p>Run this command:</p>
<div class="listingblock">
<div class="content">
<pre>$ nmstatectl set static_route.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification steps</div>
<ul>
<li>
<p>Run the IP route command, <code>ip route</code>, with the destination parameter value you set in <code>static_route.yml</code>. This should no longer show the desired route. For example, run the following command:</p>
<div class="listingblock">
<div class="content">
<pre>$ ip route | grep 192.168.123.0`</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#proc-Adding-a-static-route-on-a-host">Adding a static route on a host</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_or_Editing_the_Gateway">9.1.8. Viewing or Editing the Gateway for a Logical Network</h4>
<div class="paragraph">
<p>Users can define the gateway, along with the IP address and subnet mask, for a logical network. This is necessary when multiple networks exist on a host and traffic should be routed through the specified network, rather than the default gateway.</p>
</div>
<div class="paragraph">
<p>If multiple networks exist on a host and the gateways are not defined, return traffic will be routed through the default gateway, which may not reach the intended destination. This would result in users being unable to ping the host.</p>
</div>
<div class="paragraph">
<p>oVirt handles multiple gateways automatically whenever an interface goes up or down.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab to list the network interfaces attached to the host, and their configurations.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Hover your cursor over an assigned logical network and click the pencil icon. This opens the <strong>Edit Management Network</strong> window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>Edit Management Network</strong> window displays the network name, the boot protocol, and the IP, subnet mask, and gateway addresses. The address information can be manually edited by selecting a <strong>Static</strong> boot protocol.</p>
</div>
</div>
<div class="sect3">
<h4 id="Logical_Network_General_Settings_Explained">9.1.9. Logical Network General Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>General</strong> tab of the <strong>New Logical Network</strong> and <strong>Edit Logical Network</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. <strong>New Logical Network</strong> and <strong>Edit Logical Network</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the logical network. This text field must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p>
<p class="tableblock">Note that while the name of the logical network can be longer than 15 characters and can contain non-ASCII characters, the on-host identifier (<em>vdsm_name</em>) will differ from the name you defined. See <a href="#Vdsm_To_Network_Mapping_Tool">Mapping VDSM Names to Logical Network Names</a> for instructions on displaying a mapping of these names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the logical network. This text field has a 40-character limit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field for adding plain text, human-readable comments regarding the logical network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Create on external provider</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to create the logical network to an OpenStack Networking instance that has been added to the Engine as an external provider.</p>
<p class="tableblock"><strong>External Provider</strong> - Allows you to select the external provider on which the logical network will be created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable VLAN tagging</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VLAN tagging is a security feature that gives all network traffic carried on the logical network a special characteristic. VLAN-tagged traffic cannot be read by interfaces that do not also have that characteristic. Use of VLANs on logical networks also allows a single network interface to be associated with multiple, differently VLAN-tagged logical networks. Enter a numeric value in the text entry field if VLAN tagging is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VM Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this option if only virtual machines use this network. If the network is used for traffic that does not involve virtual machines, such as storage communications, do not select this check box.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port Isolation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is set, virtual machines on the same host are prevented from communicating and seeing each other on this logical network. For this option to work on different hypervisors, the switches need to be configured with PVLAN/Port Isolation on the respective port/VLAN connected to the hypervisors, and not reflect back the frames with any hairpin setting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Choose either <strong>Default</strong>, which sets the maximum transmission unit (MTU) to the value given in the parenthesis (), or <strong>Custom</strong> to set a custom MTU for the logical network. You can use this to match the MTU supported by your new logical network to the MTU supported by the hardware it interfaces with. Enter a numeric value in the text entry field if <strong>Custom</strong> is selected.
<strong>IMPORTANT</strong>: If you change the networks <strong>MTU</strong> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machines vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <a href="https://access.redhat.com/solutions/4540631" class="bare">https://access.redhat.com/solutions/4540631</a> and <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Network Label</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify a new label for the network or select from existing labels already attached to host network interfaces. If you select an existing label, the logical network will be automatically assigned to all host network interfaces with that label.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Security Groups</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to assign security groups to the ports on this logical network.
<code>Disabled</code> disables the security group feature.
<code>Enabled</code> enables the feature. When a port is created and attached to this network, it will be defined with port security enabled. This means that access to/from the virtual machines will be subject to the security groups currently being provisioned.
 <code>Inherit from Configuration</code> enables the ports to inherit the behavior from the configuration file that is defined for all networks. By default, the file disables security groups.
 See <a href="#Assigning_Security_Groups_to_Logical_Networks">Assigning Security Groups to Logical Networks and Ports</a> for details.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Logical_Network_Cluster_Settings_Explained">9.1.10. Logical Network Cluster Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>Cluster</strong> tab of the <strong>New Logical Network</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. <strong>New Logical Network</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Attach/Detach Network to/from Cluster(s)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to attach or detach the logical network from clusters in the data center and specify whether the logical network will be a required network for individual clusters.</p>
<p class="tableblock"><strong>Name</strong> - the name of the cluster to which the settings will apply. This value cannot be edited.</p>
<p class="tableblock"><strong>Attach All</strong> - Allows you to attach or detach the logical network to or from all clusters in the data center. Alternatively, select or clear the <strong>Attach</strong> check box next to the name of each cluster to attach or detach the logical network to or from a given cluster.</p>
<p class="tableblock"><strong>Required All</strong> - Allows you to specify whether the logical network is a required network on all clusters. Alternatively, select or clear the <strong>Required</strong> check box next to the name of each cluster to specify whether the logical network is a required network for a given cluster.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Logical_Network_vNIC_Profiles_Settings_Explained">9.1.11. Logical Network vNIC Profiles Settings Explained</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>vNIC Profiles</strong> tab of the <strong>New Logical Network</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. <strong>New Logical Network</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>vNIC Profiles</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify one or more vNIC profiles for the logical network. You can add or remove a vNIC profile to or from the logical network by clicking the plus or minus button next to the vNIC profile. The first field is for entering a name for the vNIC profile.</p>
<p class="tableblock"><strong>Public</strong> - Allows you to specify whether the profile is available to all users.</p>
<p class="tableblock"><strong>QoS</strong> - Allows you to specify a network quality of service (QoS) profile to the vNIC profile.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Designate_a_Specific_Traffic_Type">9.1.12. Designate a Specific Traffic Type for a Logical Network with the Manage Networks Window</h4>
<div class="paragraph">
<p>Specify the traffic type for the logical network to optimize the network traffic flow.</p>
</div>
<div class="paragraph">
<p><strong>Specifying Traffic Types for Logical Networks</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab.</p>
</li>
<li>
<p>Click <strong>Manage Networks</strong>.</p>
</li>
<li>
<p>Select the appropriate check boxes and radio buttons.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Logical networks offered by external providers must be used as virtual machine networks; they cannot be assigned special cluster roles such as display or migration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Explanation_of_Settings_in_the_Manage_Networks_Window">9.1.13. Explanation of Settings in the Manage Networks Window</h4>
<div class="paragraph">
<p>The table below describes the settings for the <strong>Manage Networks</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Manage Networks Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description/Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Assign</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assigns the logical network to all hosts in the cluster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Required</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Network marked "required" must remain operational in order for the hosts associated with it to function properly. If a required network ceases to function, any hosts associated with it become non-operational.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VM Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical network marked "VM Network" carries network traffic relevant to the virtual machine network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Display Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical network marked "Display Network" carries network traffic relevant to SPICE and to the virtual network controller.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migration Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A logical network marked "Migration Network" carries virtual machine and storage migration traffic. If an outage occurs on this network, the management network (<strong>ovirtmgmt</strong> by default) will be used instead.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Editing_VFs_on_NIC">9.1.14. Configuring virtual functions on a NIC</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Single Root I/O Virtualization (SR-IOV) enables you to use each PCIe endpoint as multiple separate devices by using physical functions (PFs) and virtual functions (VFs). A PCIe card can have between one and eight PFs. Each PF can have many VFs. The number of VFs it can have depends on the specific type of PCIe device.</p>
</div>
<div class="paragraph">
<p>To configure SR-IOV-capable Network Interface Controllers (NICs), you use the oVirt Engine.  There, you can configure the number of VFs on each NIC.</p>
</div>
<div class="paragraph">
<p>You can configure a VF like you would configure a standalone NIC, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Assigning one or more logical networks to the VF.</p>
</li>
<li>
<p>Creating bonded interfaces with VFs.</p>
</li>
<li>
<p>Assigning vNICs to VFs for direct device passthrough.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default, all virtual networks have access to the virtual functions. You can disable this default and specify which networks have access to a virtual function.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>For a vNIC to be attached to a VF must, its passthrough property must be enabled. For details, see <a href="#Enabling_Passthrough_on_a_vNIC_Profile">Enabling Passthrough on a vNIC Profile</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the name of an SR-IOV-capable host. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Select an SR-IOV-capable NIC, marked with a <span class="image"><img src="images/SR-IOV-icon.png" alt="SR IOV icon"></span>
, and click the pencil icon.</p>
</li>
<li>
<p>Optional: To change the number of virtual functions, click the <strong>Number of VFs setting</strong> drop-down button and edit the <strong>Number of VFs</strong> text field.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changing the number of VFs deletes all previous VFs on the network interface before creating the new VFs. This includes any VFs that have virtual machines directly attached.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optional: To limit which virtual networks have access virtual functions, select <strong>Specific networks</strong>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the networks that should have access to the VF, or use <strong>Labels</strong> to select networks based on their network labels.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>In the <strong>Setup Host Networks</strong> window, click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Virtual_Network_Interface_Cards">9.2. Virtual Network Interface Cards (vNICs)</h3>
<div class="sect3">
<h4 id="VNIC_Profile_Overview">9.2.1. vNIC Profile Overview</h4>
<div class="paragraph">
<p>A Virtual Network Interface Card (vNIC) profile is a collection of settings that can be applied to individual virtual network interface cards in the Engine. A vNIC profile allows you to apply Network QoS profiles to a vNIC, enable or disable port mirroring, and add or remove custom properties. A vNIC profile also offers an added layer of administrative flexibility in that permission to use (consume) these profiles can be granted to specific users. In this way, you can control the quality of service that different users receive from a given network.</p>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_VNIC_Profile">9.2.2. Creating or Editing a vNIC Profile</h4>
<div class="paragraph">
<p>Create or edit a Virtual Network Interface Controller (vNIC) profile to regulate network bandwidth for users and groups.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are enabling or disabling port mirroring, all virtual machines using the associated profile must be in a down state before editing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Creating or Editing a vNIC Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>vNIC Profiles</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong> or <strong>Edit</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the profile.</p>
</li>
<li>
<p>Select the relevant Quality of Service policy from the <strong>QoS</strong> list.</p>
</li>
<li>
<p>Select a <strong>Network Filter</strong> from the drop-down list to manage the traffic of network packets to and from virtual machines. For more information on network filters, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Virtualization_Deployment_and_Administration_Guide/index.html#sect-Virtual_Networking-Applying_network_filtering">Applying network filtering</a> in the <em>Enterprise Linux Virtualization Deployment and Administration Guide</em>.</p>
</li>
<li>
<p>Select the <strong>Passthrough</strong> check box to enable passthrough of the vNIC and allow direct device assignment of a virtual function. Enabling the passthrough property will disable QoS, network filtering, and port mirroring as these are not compatible. For more information on passthrough, see <a href="#Enabling_Passthrough_on_a_vNIC_Profile">Enabling Passthrough on a vNIC Profile</a>.</p>
</li>
<li>
<p>If <strong>Passthrough</strong> is selected, optionally deselect the <strong>Migratable</strong> check box to disable migration for vNICs using this profile. If you keep this check box selected, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Live_migration_prerequisites">Additional Prerequisites for Virtual Machines with SR-IOV-Enabled vNICs</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
<li>
<p>Use the <strong>Port Mirroring</strong> and <strong>Allow all users to use this Profile</strong> check boxes to toggle these options.</p>
</li>
<li>
<p>Select a custom property from the custom properties list, which displays <strong>Please select a key&#8230;&#8203;</strong> by default. Use the <strong>+</strong> and <strong>-</strong> buttons to add or remove custom properties.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Apply this profile to users and groups to regulate their network bandwidth. If you edited a vNIC profile, you must either restart the virtual machine, or hot unplug and then hot plug the vNIC if the guest operating system supports vNIC hot plug and hot unplug.</p>
</div>
</div>
<div class="sect3">
<h4 id="Explanation_of_Settings_in_the_VM_Interface_Profile_Window">9.2.3. Explanation of Settings in the VM Interface Profile Window</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. VM Interface Profile Window</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Network</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A drop-down list of the available networks to apply the vNIC profile to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the vNIC profile. This must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores between 1 and 50 characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The description of the vNIC profile. This field is recommended but not mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>QoS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A drop-down list of the available Network Quality of Service policies to apply to the vNIC profile. QoS policies regulate inbound and outbound network traffic of the vNIC.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Network Filter</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A drop-down list of the available network filters to apply to the vNIC profile. Network filters improve network security by filtering the type of packets that can be sent to and from virtual machines. The default filter is <code>vdsm-no-mac-spoofing</code>, which is a combination of <code>no-mac-spoofing</code> and <code>no-arp-mac-spoofing</code>. For more information on the network filters provided by libvirt, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Virtual_Networking-Applying_network_filtering.html#sect-Applying_network_filtering-Advanced_Filter_Configuration_Topics">Pre-existing network filters</a> section of the <em>Enterprise Linux Virtualization Deployment and Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p>Use <code>&lt;No Network Filter&gt;</code> for virtual machine VLANs and bonds. On trusted virtual machines, choosing not to use a network filter can improve performance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat no longer supports disabling filters by setting the <code>EnableMACAntiSpoofingFilterRules</code> parameter to <code>false</code> using the <code>engine-config</code> tool. Use the <code>&lt;No Network Filter&gt;</code> option instead.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Passthrough</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A check box to toggle the passthrough property. Passthrough allows a vNIC to connect directly to a virtual function of a host NIC. The passthrough property cannot be edited if the vNIC profile is attached to a virtual machine.</p>
<p class="tableblock">QoS, network filters, and port mirroring are disabled in the vNIC profile if passthrough is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migratable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A check box to toggle whether or not vNICs using this profile can be migrated. Migration is enabled by default on regular vNIC profiles; the check box is selected and cannot be changed. When the <strong>Passthrough</strong> check box is selected, <strong>Migratable</strong> becomes available and can be deselected, if required, to disable migration of passthrough vNICs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Failover</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A drop-down menu to select available vNIC profiles that act as a failover device. Available only when the <strong>Passthrough</strong> and <strong>Migratable</strong> check boxes are checked.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port Mirroring</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A check box to toggle port mirroring. Port mirroring copies layer 3 network traffic on the logical network to a virtual interface on a virtual machine. It it not selected by default. For further details, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/#Port_Mirroring">Port Mirroring</a> in the <em>Technical Reference</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Device Custom Properties</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A drop-down menu to select available custom properties to apply to the vNIC profile. Use the <strong>+</strong> and <strong>-</strong> buttons to add and remove properties respectively.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow all users to use this Profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A check box to toggle the availability of the profile to all users in the environment. It is selected by default.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Enabling_Passthrough_on_a_vNIC_Profile">9.2.4. Enabling Passthrough on a vNIC Profile</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The passthrough property of a vNIC profile enables a vNIC to be directly connected to a virtual function (VF) of an SR-IOV-enabled NIC. The vNIC will then bypass the software network virtualization and connect directly to the VF for direct device assignment.</p>
</div>
<div class="paragraph">
<p>The passthrough property cannot be enabled if the vNIC profile is already attached to a vNIC; this procedure creates a new profile to avoid this. If a vNIC profile has passthrough enabled, QoS, network filters, and port mirroring cannot be enabled on the same profile.</p>
</div>
<div class="paragraph">
<p>For more information on SR-IOV, direct device assignment, and the hardware considerations for implementing these in oVirt, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Hardware Considerations for Implementing SR-IOV</a>.</p>
</div>
<div class="paragraph">
<p><strong>Enabling Passthrough</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>vNIC Profiles</strong> tab to list all vNIC profiles for that logical network.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>Description</strong> of the profile.</p>
</li>
<li>
<p>Select the <strong>Passthrough</strong> check box.</p>
</li>
<li>
<p>Optionally deselect the <strong>Migratable</strong> check box to disable migration for vNICs using this profile. If you keep this check box selected, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Live_migration_prerequisites">Additional Prerequisites for Virtual Machines with SR-IOV-Enabled vNICs</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
<li>
<p>If necessary, select a custom property from the custom properties list, which displays <strong>Please select a key&#8230;&#8203;</strong> by default. Use the <strong>+</strong> and <strong>-</strong> buttons to add or remove custom properties.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The vNIC profile is now passthrough-capable. To use this profile to directly attach a virtual machine to a NIC or PCI VF, attach the logical network to the NIC and create a new <strong>PCI Passthrough</strong> vNIC on the desired virtual machine that uses the passthrough vNIC profile. For more information on these procedures respectively, see <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a>, and <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Adding_a_Network_Interface">Adding a New Network Interface</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Creating_vNIC_profile_SR_IOV_failover">9.2.5. Enabling a vNIC profile for SR-IOV migration with failover</h4>
<div class="paragraph">
<p>Failover allows the selection of a profile that acts as a failover device during virtual machine migration when the VF needs to be detached, preserving virtual machine communication with minimal interruption.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Failover is a Technology Preview feature only.
Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information see <a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The <strong>Passthrough</strong> and <strong>Migratable</strong> check boxes of the profile are selected.</p>
</li>
<li>
<p>The failover network is attached to the host.</p>
</li>
<li>
<p>In order to make a vNIC profile acting as failover editable, you must first remove any failover references.</p>
</li>
<li>
<p>vNIC profiles that can act as failover are profiles that are not selected as <strong>Passthrough</strong> or are not connected to an External Network.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, go to <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">VNIC profiles</b></span>, select the vNIC profile, click <b class="button">Edit</b> and select a <code>Failover vNIC profile</code> from the drop down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to save the profile settings.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Attaching two vNIC profiles that reference the same failover vNIC profile to the same virtual machine will fail in libvirt.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_VNIC_Profile">9.2.6. Removing a vNIC Profile</h4>
<div class="paragraph">
<p>Remove a vNIC profile to delete it from your virtualized environment.</p>
</div>
<div class="paragraph">
<p><strong>Removing a vNIC Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>vNIC Profiles</strong> tab to display available vNIC profiles.</p>
</li>
<li>
<p>Select one or more profiles and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Assigning_Security_Groups_to_VNIC_Profiles">9.2.7. Assigning Security Groups to vNIC Profiles</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is only available when <code>ovirt-provider-ovn</code> is added as an external network provider. Security groups cannot be created through the oVirt Engine. You must create security groups through OpenStack Networking on the <code>ovirt-provider-ovn</code>. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/10/html-single/users_and_identity_management_guide/index#project-security">Project Security Management</a> in the <em>Red Hat OpenStack Platform Users and Identity Management Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can assign security groups to the vNIC profile of networks that have been imported from an OpenStack Networking instance and that use the Open vSwitch plug-in. A security group is a collection of strictly enforced rules that allow you to filter inbound and outbound traffic over a network interface. The following procedure outlines how to attach a security group to a vNIC profile.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A security group is identified using the ID of that security group as registered in the Open Virtual Network (OVN) External Network Provider. You can find the IDs of security groups for a given tenant using the OpenStack Networking API, see <a href="https://docs.openstack.org/api-ref/network/v2/index.html?expanded=#list-security-groups">List Security Groups</a> in the <em>OpenStack API Reference</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Assigning Security Groups to vNIC Profiles</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>vNIC Profiles</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>, or select an existing vNIC profile and click <strong>Edit</strong>.</p>
</li>
<li>
<p>From the custom properties drop-down list, select <strong>SecurityGroups</strong>. Leaving the custom property drop-down blank applies the default security settings, which permit all outbound traffic and intercommunication but deny all inbound traffic from outside of the default security group. Note that removing the <strong>SecurityGroups</strong> property later will not affect the applied security group.</p>
</li>
<li>
<p>In the text field, enter the ID of the security group to attach to the vNIC profile.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have attached a security group to the vNIC profile. All traffic through the logical network to which that profile is attached will be filtered in accordance with the rules defined for that security group.</p>
</div>
</div>
<div class="sect3">
<h4 id="User_Permissions_for_VNIC_Profiles">9.2.8. User Permissions for vNIC Profiles</h4>
<div class="paragraph">
<p>Configure user permissions to assign users to certain vNIC profiles. Assign the <strong>VnicProfileUser</strong> role to a user to enable them to use the profile. Restrict users from certain profiles by removing their permission for that profile.</p>
</div>
<div class="paragraph">
<p><strong>User Permissions for vNIC Profiles</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">vNIC Profile</b></span>.</p>
</li>
<li>
<p>Click the vNIC profile&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Permissions</strong> tab to show the current user permissions for the profile.</p>
</li>
<li>
<p>Click <strong>Add</strong> or <strong>Remove</strong> to change user permissions for the vNIC profile.</p>
</li>
<li>
<p>In the <strong>Add Permissions to User</strong> window, click <strong>My Groups</strong> to display your user groups. You can use this option to grant permissions to other users in your groups.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have configured user permissions for a vNIC profile.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-External_Provider_Networks">9.3. External Provider Networks</h3>
<div class="sect3">
<h4 id="Importing_Networks">9.3.1. Importing Networks From External Providers</h4>
<div class="paragraph">
<p>To use networks from an Open Virtual Network (OVN), register the provider with the Engine. See <a href="#Adding_an_External_Network_Provider">Adding an External Network Provider</a> for more information. Then, use the following procedure to import the networks provided by that provider into the Engine so the networks can be used by virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Importing a Network From an External Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click <strong>Import</strong>.</p>
</li>
<li>
<p>From the <strong>Network Provider</strong> drop-down list, select an external provider. The networks offered by that provider are automatically discovered and listed in the <strong>Provider Networks</strong> list.</p>
</li>
<li>
<p>Using the check boxes, select the networks to import in the <strong>Provider Networks</strong> list and click the down arrow to move those networks into the <strong>Networks to Import</strong> list.</p>
</li>
<li>
<p>You can customize the name of the network that you are importing. To customize the name, click the network&#8217;s name in the <strong>Name</strong> column, and change the text.</p>
</li>
<li>
<p>From the <strong>Data Center</strong> drop-down list, select the data center into which the networks will be imported.</p>
</li>
<li>
<p>Optional: Clear the <strong>Allow All</strong> check box to prevent that network from being available to all users.</p>
</li>
<li>
<p>Click <strong>Import</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The selected networks are imported into the target data center and can be attached to virtual machines. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Adding_a_Network_Interface">Adding a New Network Interface</a> in the <em>Virtual Machine Management Guide</em> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="Limitations_to_Importing_Networks_from_External_Providers">9.3.2. Limitations to Using External Provider Networks</h4>
<div class="paragraph">
<p>The following limitations apply to using logical networks imported from an external provider in a oVirt environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logical networks offered by external providers must be used as virtual machine networks, and cannot be used as display networks.</p>
</li>
<li>
<p>The same logical network can be imported more than once, but only to different data centers.</p>
</li>
<li>
<p>You cannot edit logical networks offered by external providers in the Engine. To edit the details of a logical network offered by an external provider, you must edit the logical network directly from the external provider that provides that logical network.</p>
</li>
<li>
<p>Port mirroring is not available for virtual network interface cards connected to logical networks offered by external providers.</p>
</li>
<li>
<p>If a virtual machine uses a logical network offered by an external provider, that provider cannot be deleted from the Engine while the logical network is still in use by the virtual machine.</p>
</li>
<li>
<p>Networks offered by external providers are non-required. As such, scheduling for clusters in which such logical networks have been imported will not take those logical networks into account during host selection. Moreover, it is the responsibility of the user to ensure the availability of the logical network on hosts in clusters in which such logical networks have been imported.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Subnets_on_External_Provider_Logical_Networks">9.3.3. Configuring Subnets on External Provider Logical Networks</h4>
<div class="paragraph">
<p>A logical network provided by an external provider can only assign IP addresses to virtual machines if one or more subnets have been defined on that logical network. If no subnets are defined, virtual machines will not be assigned IP addresses. If there is one subnet, virtual machines will be assigned an IP address from that subnet, and if there are multiple subnets, virtual machines will be assigned an IP address from any of the available subnets. The DHCP service provided by the external network provider on which the logical network is hosted is responsible for assigning these IP addresses.</p>
</div>
<div class="paragraph">
<p>While the oVirt Engine automatically discovers predefined subnets on imported logical networks, you can also add or remove subnets to or from logical networks from within the Engine.</p>
</div>
<div class="paragraph">
<p>If you add Open Virtual Network (OVN) (ovirt-provider-ovn) as an external network provider, multiple subnets can be connected to each other by routers. To manage these routers, you can use the <a href="https://developer.openstack.org/api-ref/network/v2/?expanded=list-routers-detail,create-router-detail#routers-routers">OpenStack Networking API v2.0</a>. Please note, however, that ovirt-provider-ovn has a limitation: Source NAT (enable_snat in the OpenStack API) is not implemented.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_Subnets_to_External_Provider_Logical_Networks">9.3.4. Adding Subnets to External Provider Logical Networks</h4>
<div class="paragraph">
<p>Create a subnet on a logical network provided by an external provider.</p>
</div>
<div class="paragraph">
<p><strong>Adding Subnets to External Provider Logical Networks</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Subnets</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>CIDR</strong> for the new subnet.</p>
</li>
<li>
<p>From the <strong>IP Version</strong> drop-down list, select either <strong>IPv4</strong> or <strong>IPv6</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For IPv6, oVirt supports only static addressing.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Removing_Subnets_from_External_Provider_Logical_Networks">9.3.5. Removing Subnets from External Provider Logical Networks</h4>
<div class="paragraph">
<p>Remove a subnet from a logical network provided by an external provider.</p>
</div>
<div class="paragraph">
<p><strong>Removing Subnets from External Provider Logical Networks</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Network</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Networks</b></span>.</p>
</li>
<li>
<p>Click the logical network&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Subnets</strong> tab.</p>
</li>
<li>
<p>Select a subnet and click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Assigning_Security_Groups_to_Logical_Networks">9.3.6. Assigning Security Groups to Logical Networks and Ports</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This feature is only available when Open Virtual Network (OVN) is added as an external network provider (as ovirt-provider-ovn). Security groups cannot be created through the oVirt Engine. You must create security groups through OpenStack Networking API v2.0 or Ansible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A security group is a collection of strictly enforced rules that allow you to filter inbound and outbound traffic over a network. You can also use security groups to filter traffic at the port level.</p>
</div>
<div class="paragraph">
<p>In oVirt 4.2.7, security groups are disabled by default.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add Network</strong> and define the properties, ensuring that you select <code>ovirt-provider-ovn</code> from the <code>External Providers</code> drop-down list. For more information, see <a href="#Creating_a_new_logical_network_in_a_data_center_or_cluster">Creating a New Logical Network in a Data Center or Cluster</a>.</p>
</li>
<li>
<p>Select <code>Enabled</code> from the <code>Security Group</code> drop-down list. For more details see <a href="#Logical_Network_General_Settings_Explained">Logical Network General Settings Explained</a>.</p>
</li>
<li>
<p>Click <code>OK</code>.</p>
</li>
<li>
<p>Create security groups using either
<a href="https://developer.openstack.org/api-ref/network/v2/#security-groups-security-groups">OpenStack Networking API v2.0</a> or
<a href="https://docs.ansible.com/ansible/2.7/modules/os_security_group_module.html">Ansible</a>.</p>
</li>
<li>
<p>Create security group rules using either
<a href="https://developer.openstack.org/api-ref/network/v2/#security-group-rules-security-group-rules">OpenStack Networking API v2.0</a> or
 <a href="https://docs.ansible.com/ansible/2.7/modules/os_security_group_rule_module.html">Ansible</a>.</p>
</li>
<li>
<p>Update the ports with the security groups that you defined using either <a href="https://developer.openstack.org/api-ref/network/v2/?expanded=update-port-detail#ports">OpenStack Networking API v2.0</a> or <a href="https://docs.ansible.com/ansible/2.7/modules/os_port_module.html">Ansible</a>.</p>
</li>
<li>
<p>Optional. Define whether the security feature is enabled at the port level. Currently, this is only possible using the <a href="https://developer.openstack.org/api-ref/network/v2/?expanded=update-port-detail#ports">OpenStack Networking API</a>. If the <code>port_security_enabled</code> attribute is not set, it will default to the value specified in the network to which it belongs.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Hosts_and_Networking">9.4. Hosts and Networking</h3>
<div class="sect3">
<h4 id="con-Network-Manager-Stateful-Configuration-nmstate">9.4.1. Network Manager Stateful Configuration (nmstate)</h4>
<div class="paragraph">
<p>Version 4.4 of oVirt (oVirt) uses <em>Network Manager Stateful Configuration (nmstate)</em> to configure networking for oVirt hosts that are based on EL 8. oVirt version 4.3 and earlier use interface configuration (ifcfg) network scripts to manage host networking.</p>
</div>
<div class="paragraph">
<p>To use nmstate, upgrade the oVirt Engine and hosts as described in the <a href="https://ovirt.org/documentation/upgrade_guide/index#">oVirt Upgrade Guide</a>.</p>
</div>
<div class="paragraph">
<p>As an administrator, you do not need to install or configure nmstate. It is enabled by default and runs in the background.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always use oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The change to nmstate is nearly transparent. It only changes how you configure host networking in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After you add a host to a cluster, always use the oVirt Engine to modify the host network.</p>
</li>
<li>
<p>Modifying the host network without using the Engine can create an unsupported configuration.</p>
</li>
<li>
<p>To fix an unsupported configuration, you replace it with a supported one by using the Engine to synchronize the host network. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#Synchronizing_host_networks">Synchronizing Host Networks</a>.</p>
</li>
<li>
<p>The only situation where you modify host networks outside the Engine is to configure a static route on a host. For more details, see <a href="https://ovirt.org/documentation/administration_guide/index#proc-Adding-a-static-route-on-a-host">Adding a static route on a host</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The change to nmstate improves how oVirt Engine applies configuration changes you make in Cockpit and Anaconda before adding the host to the Engine. This fixes some issues, such as <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1680970">BZ#1680970 Static IPv6 Address is lost on host deploy if NM manages the interface</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use <code>dnf</code> or <code>yum</code> to manually update the <code>nmstate</code> package, restart <code>vdsmd</code> and <code>supervdsmd</code> on the host. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf update nmstate
# systemctl restart vdsmd supervdsmd</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use <code>dnf</code> or <code>yum</code> to manually update the Network Manager package, restart <code>NetworkManager</code> on the host. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf update NetworkManager
# systemctl restart NetworkManager</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Refreshing_Host_Capabilities">9.4.2. Refreshing Host Capabilities</h4>
<div class="paragraph">
<p>When a network interface card is added to a host, the capabilities of the host must be refreshed to display that network interface card in the Engine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Refresh Capabilities</b></span>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The list of network interface cards in the <strong>Network Interfaces</strong> tab for the selected host is updated. Any new network interface cards can now be used in the Engine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">9.4.3. Editing Host Network Interfaces and Assigning Logical Networks to Hosts</h4>
<div class="paragraph">
<p>You can change the settings of physical host network interfaces, move the management network from one physical host network interface to another, and assign logical networks to physical host network interfaces. Bridge and ethtool custom properties are also supported.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The only way to change the IP address of a host in oVirt is to remove the host and then to add it again.</p>
</div>
<div class="paragraph">
<p>To change the VLAN settings of a host, see <a href="#Editing-VLAN-Settings">Editing a Host&#8217;s VLAN Settings</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot assign logical networks offered by external providers to physical host network interfaces; such networks are dynamically assigned to hosts as they are required by virtual machines.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the switch has been configured to provide Link Layer Discovery Protocol (LLDP) information, you can hover your cursor over a physical network interface to view the switch port&#8217;s current configuration. This can help to prevent incorrect configuration. Check the following information prior to assigning logical networks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Port Description (TLV type 4)</strong> and <strong>System Name (TLV type 5)</strong> help to detect to which ports and on which switch the host&#8217;s interfaces are
patched.</p>
</li>
<li>
<p><strong>Port VLAN ID</strong> shows the native
VLAN ID configured on the switch port for untagged ethernet frames. All
VLANs configured on the switch port are shown as <strong>VLAN Name</strong> and <strong>VLAN ID</strong>
combinations.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Optionally, hover your cursor over host network interface to view configuration information provided by the switch.</p>
</li>
<li>
<p>Attach a logical network to a physical host network interface by selecting and dragging the logical network into the <strong>Assigned Logical Networks</strong> area next to the physical host network interface.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a NIC is connected to more than one logical network, only one of the networks can be non-VLAN. All the other logical networks must be unique VLANs.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Configure the logical network:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Hover your cursor over an assigned logical network and click the pencil icon. This opens the <strong>Edit Management Network</strong> window.</p>
</li>
<li>
<p>From the <strong>IPv4</strong> tab, select a <strong>Boot Protocol</strong> from <strong>None</strong>, <strong>DHCP</strong>, or <strong>Static</strong>. If you selected <strong>Static</strong>, enter the <strong>IP</strong>, <strong>Netmask / Routing Prefix</strong>, and the <strong>Gateway</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For IPv6, only static IPv6 addressing is supported.
To configure the logical network, select the <strong>IPv6</strong> tab and make the following entries:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set <strong>Boot Protocol</strong> to <strong>Static</strong>.</p>
</li>
<li>
<p>For <strong>Routing Prefix</strong>, enter the <em>length</em> of the prefix using a forward slash and decimals. For example: <code>/48</code></p>
</li>
<li>
<p><strong>IP</strong>: The complete IPv6 address of the host network interface. For example: <code>2001:db8::1:0:0:6</code></p>
</li>
<li>
<p><strong>Gateway</strong>: The source router&#8217;s IPv6 address. For example: <code>2001:db8::1:0:0:1</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the host&#8217;s management network IP address, you must <a href="#Reinstalling_Hosts_admin">reinstall the host</a> for the new IP address to be configured.</p>
</div>
<div class="paragraph">
<p>Each logical network can have a separate gateway defined from the management network gateway. This ensures traffic that arrives on the logical network will be forwarded using the logical network&#8217;s gateway instead of the default gateway used by the management network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Set <strong>all</strong> hosts in a cluster to use the same IP stack for their management network; either IPv4 or IPv6 only. Dual stack is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the <strong>QoS</strong> tab to override the default host network quality of service. Select <strong>Override QoS</strong> and enter the desired values in the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Weighted Share</strong>: Signifies how much of the logical link&#8217;s capacity a specific network should be allocated, relative to the other networks attached to the same logical link. The exact share depends on the sum of shares of all networks on that link. By default this is a number in the range 1-100.</p>
</li>
<li>
<p><strong>Rate Limit [Mbps]</strong>: The maximum bandwidth to be used by a network.</p>
</li>
<li>
<p><strong>Committed Rate [Mbps]</strong>: The minimum bandwidth required by a network. The Committed Rate requested is not guaranteed and will vary depending on the network infrastructure and the Committed Rate requested by other networks on the same logical link.</p>
</li>
</ul>
</div>
</li>
<li>
<p>To configure a network bridge, click the <strong>Custom Properties</strong> tab and select <strong>bridge_opts</strong> from the drop-down list. Enter a valid key and value with the following syntax: <em>key</em>=<em>value</em>. Separate multiple entries with a whitespace character. The following keys are valid, with the values provided as examples. For more information on these parameters, see <a href="#Explanation_of_bridge_opts_Parameters">Explanation of bridge_opts Parameters</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">forward_delay=1500
group_addr=1:80:c2:0:0:0
group_fwd_mask=0x0
hash_max=512
hello_time=200
max_age=2000
multicast_last_member_count=2
multicast_last_member_interval=100
multicast_membership_interval=26000
multicast_querier=0
multicast_querier_interval=25500
multicast_query_interval=13000
multicast_query_response_interval=1000
multicast_query_use_ifaddr=0
multicast_router=1
multicast_snooping=1
multicast_startup_query_count=2
multicast_startup_query_interval=3125</pre>
</div>
</div>
</li>
<li>
<p>To configure ethernet properties, click the <strong>Custom Properties</strong> tab and select <strong>ethtool_opts</strong> from the drop-down list. Enter a valid value using the format of the command-line arguments of ethtool. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--coalesce em1 rx-usecs 14 sample-interval 3 --offload em2 rx on lro on tso off --change em1 speed 1000 duplex half</pre>
</div>
</div>
<div class="paragraph">
<p>This field can accept wildcards. For example, to apply the same option to all of this network&#8217;s interfaces, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">--coalesce * rx-usecs 14 sample-interval 3</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>ethtool_opts</strong> option is not available by default; you need to add it using the engine configuration tool. See <a href="#How_to_Set_Up_Red_Hat_Enterprise_Virtualization_Manager_to_Use_Ethtool">How to Set Up oVirt Engine to Use Ethtool</a> for more information. For more information on ethtool properties, see the manual page by typing <code>man ethtool</code> in the command line.</p>
</div>
</li>
<li>
<p>To configure Fibre Channel over Ethernet (FCoE), click the <strong>Custom Properties</strong> tab and select <strong>fcoe</strong> from the drop-down list. Enter a valid key and value with the following syntax: <em>key</em>=<em>value</em>. At least <code>enable=yes</code> is required. You can also add <code>dcb=</code><code class="yes|no"> and <code>auto_vlan=</code>[yes|no]</code>. Separate multiple entries with a whitespace character. The <strong>fcoe</strong> option is not available by default; you need to add it using the engine configuration tool. See <a href="#How_to_Set_Up_RHVM_to_Use_FCoE">How to Set Up oVirt Engine to Use FCoE</a> for more information.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A separate, dedicated logical network is recommended for use with FCoE.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>To change the default network used by the host from the management network (ovirtmgmt) to a non-management network, configure the non-management network&#8217;s default route. See <a href="#Configuring_a_Default_Route">Configuring a Non-Management Logical Network as the Default Route</a> for more information.</p>
</li>
<li>
<p>If your logical network definition is not synchronized with the network configuration on the host, select the <strong>Sync network</strong> check box. For more information about unsynchronized hosts and how to synchronize them, see <a href="#Synchronizing_host_networks">Synchronizing Host Networks</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Select the <strong>Verify connectivity between Host and Engine</strong> check box to check network connectivity. This action only works if the host is in maintenance mode.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If not all network interface cards for the host are displayed, click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Refresh Capabilities</b></span> to update the list of network interface cards available for that host.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Troubleshooting</div>
<p>In some cases, making multiple concurrent changes to a host network configuration using the <strong>Setup Host Networks</strong> window or <code>setupNetwork</code> command fails with an <code>Operation failed: [Cannot setup Networks]. Another Setup Networks or Host Refresh process in progress on the host. Please try later.]</code> error in the event log. This error indicates that some of the changes were not configured on the host. This happens because, to preserve the integrity of the configuration state, only a single setup network command can be processed at a time. Other concurrent configuration commands are queued for up to a default timeout of 20 seconds. To help prevent the above failure from happening, use the <code>engine-config</code> command to increase the timeout period of <code>SetupNetworksWaitTimeoutSeconds</code> beyond 20 seconds. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set SetupNetworksWaitTimeoutSeconds=40</pre>
</div>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Syntax_for_the_engine-config_Command">Syntax for the engine-config Command</a></p>
</li>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-host-methods-setup_networks">setupnetworks POST</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Synchronizing_host_networks">9.4.4. Synchronizing Host Networks</h4>
<div class="paragraph">
<p>The Engine defines a network interface as <code>out-of-sync</code> when the definition of the interface on the host differs from the definitions stored by the Engine.</p>
</div>
<div class="paragraph">
<p>Out-of-sync networks appear with an Out-of-sync icon <span class="image"><img src="images/out-of-sync.png" alt="out of sync"></span> in the host&#8217;s <strong>Network Interfaces</strong> tab and with this icon <span class="image"><img src="images/out-of-sync-setup.png" alt="out of sync setup"></span> in the <strong>Setup Host Networks</strong> window.</p>
</div>
<div class="paragraph">
<p>When a host&#8217;s network is out of sync, the only activities that you can perform on the unsynchronized network in the <strong>Setup Host Networks</strong> window are detaching the logical network from the network interface or synchronizing the network.</p>
</div>
<div class="paragraph">
<div class="title">Understanding How a Host Becomes out-of-sync</div>
<p>A host will become out of sync if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You make configuration changes on the host rather than using the the <strong>Edit Logical Networks</strong> window, for example:</p>
<div class="ulist">
<ul>
<li>
<p>Changing the VLAN identifier on the physical host.</p>
</li>
<li>
<p>Changing the <strong>Custom MTU</strong> on the physical host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You move a host to a different data center with the same network name, but with different values/parameters.</p>
</li>
<li>
<p>You change a network&#8217;s <strong>VM Network</strong> property by manually removing the bridge from the host.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the networks <strong>MTU</strong> settings, you must propagate this change to the running virtual machines on the network: Hot unplug and replug every virtual machines vNIC that should apply the MTU setting, or restart the virtual machines. Otherwise, these interfaces fail when the virtual machine migrates to another host. For more information, see <a href="https://access.redhat.com/solutions/4540631" class="bare">https://access.redhat.com/solutions/4540631</a> and <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1766414">BZ#1766414</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Preventing Hosts from Becoming Unsynchronized</div>
<p>Following these best practices will prevent your host from becoming unsynchronized:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the Administration Portal to make changes rather than making changes locally on the host.</p>
</li>
<li>
<p>Edit VLAN settings according to the instructions in <a href="#Editing-VLAN-Settings">Editing a Host&#8217;s VLAN Settings</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Synchronizing Hosts</div>
<p>Synchronizing a host&#8217;s network interface definitions involves using the definitions from the Engine and applying them to the host. If these are not the definitions that you require, after synchronizing your hosts update their definitions from the Administration Portal.
You can synchronize a host&#8217;s networks on three levels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Per logical network</p>
</li>
<li>
<p>Per host</p>
</li>
<li>
<p>Per cluster</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Synchronizing Host Networks on the Logical Network Level</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Hover your cursor over the unsynchronized network and click the pencil icon. This opens the <strong>Edit Network</strong> window.</p>
</li>
<li>
<p>Select the <strong>Sync network</strong> check box.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to save the network change.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to close the <strong>Setup Host Networks</strong> window.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Synchronizing a Host&#8217;s Networks on the Host level</div>
<ul>
<li>
<p>Click the <strong>Sync All Networks</strong> button in the host&#8217;s <strong>Network Interfaces</strong> tab to synchronize all of the host&#8217;s unsynchronized network interfaces.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Synchronizing a Host&#8217;s Networks on the Cluster level</div>
<ul>
<li>
<p>Click the <strong>Sync All Networks</strong> button in the cluster&#8217;s <strong>Logical Networks</strong> tab to synchronize all unsynchronized logical network definitions for the entire cluster.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also synchronize a host&#8217;s networks via the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-sync_all_networks">syncallnetworks</a> in the <em>REST API Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Editing-VLAN-Settings">9.4.5. Editing a Host&#8217;s VLAN Settings</h4>
<div class="paragraph">
<p>To change the VLAN settings of a host, the host must be removed from the Engine, reconfigured, and re-added to the Engine.</p>
</div>
<div class="paragraph">
<p>To keep networking synchronized, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the host in maintenance mode.</p>
</li>
<li>
<p>Manually remove the management network from the host. This will make the host reachable over the new VLAN.</p>
</li>
<li>
<p>Add the host to the cluster. Virtual machines that are not connected directly to the management network can be migrated between hosts safely.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following warning message appears when the VLAN ID of the management network is changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Changing certain properties (e.g. VLAN, MTU) of the management network could lead to loss of connectivity to hosts in the data center, if its underlying network infrastructure isn't configured to accommodate the changes. Are you sure you want to proceed?</pre>
</div>
</div>
<div class="paragraph">
<p>Proceeding causes all of the hosts in the data center to lose connectivity to the Engine and causes the migration of hosts to the new management network to fail. The management network will be reported as "out-of-sync".</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you change the management network&#8217;s VLAN ID, you must <a href="#Reinstalling_Hosts_admin">reinstall the host</a> to apply the new VLAN ID.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Adding_multiple_VLANs_to_a_single_network_interface_using_logical_networks">9.4.6. Adding Multiple VLANs to a Single Network Interface Using Logical Networks</h4>
<div class="paragraph">
<p>Multiple VLANs can be added to a single network interface to separate traffic on the one host.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must have created more than one logical network, all with the <strong>Enable VLAN tagging</strong> check box selected in the <strong>New Logical Network</strong> or <strong>Edit Logical Network</strong> windows.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Adding Multiple VLANs to a Network Interface using Logical Networks</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Drag your VLAN-tagged logical networks into the <strong>Assigned Logical Networks</strong> area next to the physical network interface. The physical network interface can have multiple logical networks assigned due to the VLAN tagging.</p>
</li>
<li>
<p>Edit the logical networks:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Hover your cursor over an assigned logical network and click the pencil icon.</p>
</li>
<li>
<p>If your logical network definition is not synchronized with the network configuration on the host, select the <strong>Sync network</strong> check box.</p>
</li>
<li>
<p>Select a <strong>Boot Protocol</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong></p>
</li>
<li>
<p><strong>DHCP</strong></p>
</li>
<li>
<p><strong>Static</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>Provide the <strong>IP</strong> and <strong>Subnet Mask</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Select the <strong>Verify connectivity between Host and Engine</strong> check box to run a network check; this will only work if the host is in maintenance mode.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Add the logical network to each host in the cluster by editing a NIC on each host in the cluster. After this is done, the network will become operational.</p>
</div>
<div class="paragraph">
<p>This process can be repeated multiple times, selecting and editing the same network interface each time on each host to add logical networks with different VLAN tags to a single network interface.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-Copying-host-networks_vlan">9.4.7. Copying host networks</h4>
<div class="paragraph">
<p>To save time, you can copy a source host&#8217;s network configuration to a target host in the same cluster.</p>
</div>
<div class="paragraph">
<p>Copying the network configuration includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Logical networks attached to the host, except the <code>ovirtmgmt</code> management network</p>
</li>
<li>
<p>Bonds attached to interfaces</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>Do not copy network configurations that contain static IP addresses. Doing this sets the boot protocol in the target host to <code>none</code>.</p>
</li>
<li>
<p>Copying a configuration to a target host with the same interface names as the source host but different physical network connections produces a wrong configuration.</p>
</li>
<li>
<p>The target host must have an equal or greater number of interfaces than the source host. Otherwise, the operation fails.</p>
</li>
<li>
<p>Copying <code>QoS</code>, <code>DNS</code>, and <code>custom_properties</code> is not supported.</p>
</li>
<li>
<p>Network interface labels are not copied.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Copying host networks replaces ALL network settings on the target host except its attachment to the <code>ovirtmgmt</code> management network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The number of NICs on the target host must be equal or greater than those on the source host. Otherwise, the operation fails.</p>
</li>
<li>
<p>The hosts must be in the same cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select the source host whose configuration you want to copy.</p>
</li>
<li>
<p>Click <b class="button">Copy Host Networks</b>. This opens the <strong>Copy Host Networks</strong> window.</p>
</li>
<li>
<p>Use <strong>Target Host</strong> to select the host that should receive the configuration. The list only shows hosts that are in the same cluster.</p>
</li>
<li>
<p>Click <b class="button">Copy Host Networks</b>.</p>
</li>
<li>
<p>Verify the network settings of the target host</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Tips</div>
<ul>
<li>
<p>Selecting multiple hosts disables the <b class="button">Copy Host Networks</b> button and context menu.</p>
</li>
<li>
<p>Instead of using the <b class="button">Copy Host Networks</b> button, you can right-click a host and select <b class="menuref">Copy Host Networks</b> from the context menu.</p>
</li>
<li>
<p>The <b class="button">Copy Host Networks</b> button is also available in any host&#8217;s details view.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Assigning_Additional_IPv4_Addresses_to_a_Host_Network">9.4.8. Assigning Additional IPv4 Addresses to a Host Network</h4>
<div class="paragraph">
<p>A host network, such as the <strong>ovirtmgmt</strong> management network, is created with only one IP address when initially set up. This means that if a NIC&#8217;s configuration file is configured with multiple IP addresses, only the first listed IP address will be assigned to the host network. Additional IP addresses may be required if connecting to storage, or to a server on a separate private subnet using the same NIC.</p>
</div>
<div class="paragraph">
<p>The <code>vdsm-hook-extra-ipv4-addrs</code> hook allows you to configure additional IPv4 addresses for host networks. For more information about hooks, see <a href="#appe-VDSM_and_Hooks">VDSM and Hooks</a>.</p>
</div>
<div class="paragraph">
<p>In the following procedure, the host-specific tasks must be performed on each host for which you want to configure additional IP addresses.</p>
</div>
<div class="paragraph">
<p><strong>Assigning Additional IPv4 Addresses to a Host Network</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the host that you want to configure additional IPv4 addresses for, install the VDSM hook package. The package is available by default on oVirt Nodes but needs to be installed on Enterprise Linux hosts.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install vdsm-hook-extra-ipv4-addrs</pre>
</div>
</div>
</li>
<li>
<p>On the Engine, run the following command to add the key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s 'UserDefinedNetworkCustomProperties=ipv4_addrs=.*'</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab and click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Edit the host network interface by hovering the cursor over the assigned logical network and clicking the pencil icon.</p>
</li>
<li>
<p>Select <strong>ipv4_addr</strong> from the <strong>Custom Properties</strong> drop-down list and add the additional IP address and prefix (for example 5.5.5.5/24). Multiple IP addresses must be comma-separated.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to close the <strong>Edit Network</strong> window.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to close the <strong>Setup Host Networks</strong> window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The additional IP addresses will not be displayed in the Engine, but you can run the command <code>ip addr show</code> on the host to confirm that they have been added.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_Network_Labels_to_Host_Network_Interfaces">9.4.9. Adding Network Labels to Host Network Interfaces</h4>
<div class="paragraph">
<p>Using network labels allows you to greatly simplify the administrative workload associated with assigning logical networks to host network interfaces. Setting a label on a role network (for instance, a migration network or a display network) causes a mass deployment of that network on all hosts. Such mass additions of networks are achieved through the use of DHCP. This method of mass deployment was chosen over a method of typing in static addresses, because of the unscalable nature of the task of typing in many static IP addresses.</p>
</div>
<div class="paragraph">
<p>There are two methods of adding labels to a host network interface:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually, in the Administration Portal</p>
</li>
<li>
<p>Automatically, with the LLDP Labeler service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Adding Network Labels in the Administration Portal</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Click <strong>Labels</strong> and right-click <strong>[New Label]</strong>. Select a physical network interface to label.</p>
</li>
<li>
<p>Enter a name for the network label in the <strong>Label</strong> text field.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Adding Network Labels with the LLDP Labeler Service</strong></p>
</div>
<div class="paragraph">
<p>You can automate the process of assigning labels to host network interfaces in the configured list of clusters with the LLDP Labeler service.</p>
</div>
<div id="Configuring_LLDP_Labeler_vlan" class="paragraph">
<p>By default, LLDP Labeler runs as an hourly service. This option is useful if you make hardware changes (for example, NICs, switches, or cables) or change switch configurations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The interfaces must be connected to a Juniper switch.</p>
</li>
<li>
<p>The Juniper switch must be configured to provide the <code>Port VLAN</code> using LLDP.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>username</code> and <code>password</code> in <code>/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>username</code> - the username of the Engine administrator. The default is <code>admin@internal</code>.</p>
</li>
<li>
<p><code>password</code> - the password of the Engine administrator. The default is <code>123456</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the LLDP Labeler service by updating the following values in <code>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>clusters</code> - a comma-separated list of clusters on which the service should run. Wildcards are supported. For example, <code>Cluster*</code> defines LLDP Labeler to run on all clusters starting with word <code>Cluster</code>. To run the service on all clusters in the data center, type <code>*</code>. The default is <code>Def*</code>.</p>
</li>
<li>
<p><code>api_url</code> - the full URL of the Engine&#8217;s API. The default is <code>https://<em>Manager_FQDN</em>/ovirt-engine/api</code></p>
</li>
<li>
<p><code>ca_file</code> - the path to the custom CA certificate file. Leave this value empty if you do not use custom certificates. The default is empty.</p>
</li>
<li>
<p><code>auto_bonding</code> - enables LLDP Labeler&#8217;s bonding capabilities. The default is <code>true</code>.</p>
</li>
<li>
<p><code>auto_labeling</code> - enables LLDP Labeler&#8217;s labeling capabilities. The default is <code>true</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, you can configure the service to run at a different time interval by changing the value of <code>OnUnitActiveSec</code> in <code>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-labeler.timer</code>. The default is <code>1h</code>.</p>
</li>
<li>
<p>Configure the service to start now and at boot by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl enable --now ovirt-lldp-labeler</pre>
</div>
</div>
<div class="paragraph">
<p>To invoke the service manually, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># /usr/bin/python /usr/share/ovirt-lldp-labeler/ovirt_lldp_labeler_cli.py</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have added a network label to a host network interface. Newly created logical networks with the same label are automatically assigned to all host network interfaces with that label. Removing a label from a logical network automatically removes that logical network from all host network interfaces with that label.</p>
</div>
</div>
<div class="sect3">
<h4 id="Changing_the_FQDN_of_a_Host">9.4.10. Changing the FQDN of a Host</h4>
<div class="paragraph">
<p>Use the following procedure to change the fully qualified domain name of hosts.</p>
</div>
<div class="paragraph">
<p><strong>Updating the FQDN of a Host</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Place the host into maintenance mode so the virtual machines are live migrated to another host. See <a href="#Moving_a_host_to_maintenance_mode">Moving a Host to Maintenance Mode</a> for more information. Alternatively, manually shut down or migrate all the virtual machines to another host. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Manually_migrating_virtual_machines">Manually Migrating Virtual Machines</a> in the <em>Virtual Machine Management Guide</em> for more information.</p>
</li>
<li>
<p>Click <strong>Remove</strong>, and click <b class="button">OK</b> to remove the host from the Administration Portal.</p>
</li>
<li>
<p>Use the <code>hostnamectl</code> tool to update the host name. For more options, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Networking_Guide/ch-Configure_Host_Names.html"> Configure Host Names</a> in the <em>Enterprise Linux 7 Networking Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hostnamectl set-hostname <em>NEW_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Reboot the host.</p>
</li>
<li>
<p>Re-register the host with the Engine. See <a href="#Adding_standard_hosts_to_the_Manager_host_tasks">Adding Standard Hosts to the oVirt Engine</a> for more information.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="IPv6-networking-support-labels">9.4.11. IPv6 Networking Support</h4>
<div class="paragraph">
<p>oVirt supports static IPv6 networking in most contexts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt requires IPv6 to remain enabled on the computer or virtual machine where you are running the Engine (also called "the Engine machine"). <a href="https://access.redhat.com/solutions/8709">Do not disable IPv6</a> on the Engine machine, even if your systems do not use it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Limitations for IPv6</div>
<ul>
<li>
<p>Only static IPv6 addressing is supported. Dynamic IPv6 addressing with <strong>DHCP</strong> or <strong>Stateless Address Autoconfiguration</strong> are not supported.</p>
</li>
<li>
<p>Dual-stack addressing, IPv4 <em>and</em> IPv6, is not supported.</p>
</li>
<li>
<p>OVN networking can be used with only IPv4 <em>or</em> IPv6.</p>
</li>
<li>
<p>Switching clusters from IPv4 to IPv6 is not supported.</p>
</li>
<li>
<p>Only a single gateway per host can be set for IPv6.</p>
</li>
<li>
<p>If both networks share a single gateway (are on the same subnet), you can move the default route role from the management network (ovirtmgmt) to another logical network. The host and Engine should have the same IPv6 gateway. If the host and Engine are not on the same subnet, the Engine might lose connectivity with the host because the IPv6 gateway was removed.</p>
</li>
<li>
<p>Using a glusterfs storage domain with an IPv6-addressed gluster server is not supported.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="setting-up-and-configuring-sr-iov">9.4.12. Setting Up and Configuring SR-IOV</h4>
<div class="paragraph">
<p>This topic summarizes the steps for setting up and configuring SR-IOV, with links out to topics that cover each step in detail.</p>
</div>
<div class="sect4">
<h5 id="prerequisites">Prerequisites</h5>
<div class="paragraph">
<p>Set up your hardware in accordance with the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Hardware Considerations for Implementing SR-IOV</a></p>
</div>
</div>
<div class="sect4">
<h5 id="set-up-and-configure-sr-iov">Set Up and Configure SR-IOV</h5>
<div class="paragraph">
<p>To set up and configure SR-IOV, complete the following tasks.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/index#Configuring_a_Host_for_PCI_Passthrough_SHE_cli_deploy">Configuring a Host for PCI Passthrough</a>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Editing_VFs_on_NIC">Editing the virtual function configuration on a NIC</a>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Enabling_Passthrough_on_a_vNIC_Profile">Enabling passthrough on a vNIC Profile</a>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_virtual_machines_with_SR-IOV-Enabled_vNICs">Configuring Virtual Machines with SR-IOV-Enabled vNICs to Reduce Network Outage during Migration</a>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Notes</div>
<ul>
<li>
<p>The number of the 'passthrough' vNICs depends on the number of available virtual functions (VFs) on the host. For example, to run a virtual machine (VM) with three SR-IOV cards (vNICs), the host must have three or more VFs enabled.</p>
</li>
<li>
<p>Hotplug and unplug are supported.</p>
</li>
<li>
<p>Live migration is supported.</p>
</li>
<li>
<p>To migrate a VM, the destination host must also have enough available VFs to receive the VM. During the migration, the VM releases a number of VFs on the source host and occupies the same number of VFs on the destination host.</p>
</li>
<li>
<p>On the host, you will see a device, link, or ifcae like any other interface. That device disappears when it is attached to a VM, and reappears when it is released.</p>
</li>
<li>
<p>Avoid attaching a host device directly to a VM for SR-IOV feature.</p>
</li>
<li>
<p>To use a VF as a trunk port with several VLANs and configure the VLANs within the Guest, please see <a href="https://access.redhat.com/solutions/3951231">Cannot configure VLAN on SR-IOV VF interfaces inside the Virtual Machine</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is an example of what the libvirt XML for the interface would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  ----
  <span style="color:#070;font-weight:bold">&lt;interface</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">hostdev</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;mac</span> <span style="color:#b48">address</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">00:1a:yy:xx:vv:xx</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;driver</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">vfio</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;source&gt;</span>
       <span style="color:#070;font-weight:bold">&lt;address</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pci</span><span style="color:#710">'</span></span> <span style="color:#b48">domain</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x0000</span><span style="color:#710">'</span></span> <span style="color:#b48">bus</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x05</span><span style="color:#710">'</span></span> <span style="color:#b48">slot</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x10</span><span style="color:#710">'</span></span> <span style="color:#b48">function</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x0</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;/source&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;alias</span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ua-18400536-5688-4477-8471-be720e9efc68</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
     <span style="color:#070;font-weight:bold">&lt;address</span> <span style="color:#b48">type</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pci</span><span style="color:#710">'</span></span> <span style="color:#b48">domain</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x0000</span><span style="color:#710">'</span></span> <span style="color:#b48">bus</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x00</span><span style="color:#710">'</span></span> <span style="color:#b48">slot</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x08</span><span style="color:#710">'</span></span> <span style="color:#b48">function</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">0x0</span><span style="color:#710">'</span></span><span style="color:#070;font-weight:bold">/&gt;</span>
   <span style="color:#070;font-weight:bold">&lt;/interface&gt;</span>
   ----</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Troubleshooting</div>
<p>The following example shows you how to get diagnostic information about the VFs attached to an interface.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># ip -s link show dev enp5s0f0

1: enp5s0f0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9000 qdisc mq state UP mode DEFAULT qlen 1000
    link/ether 86:e2:ba:c2:50:f0 brd ff:ff:ff:ff:ff:ff
    RX: bytes  packets  errors  dropped overrun mcast
    30931671   218401   0       0       0       19165434
    TX: bytes  packets  errors  dropped carrier collsns
    997136     13661    0       0       0       0
    vf 0 MAC 02:00:00:00:00:01, spoof checking on, link-state auto, trust off, query_rss off
    vf 1 MAC 00:1a:4b:16:01:5e, spoof checking on, link-state auto, trust off, query_rss off
    vf 2 MAC 02:00:00:00:00:01, spoof checking on, link-state auto, trust off, query_rss off</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="additional-resources">Additional Resources</h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/solutions/3867761">How to configure SR-IOV passthrough for RHV VM?</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/articles/3215851">How to configure bonding with SR-IOV VF(Virtual Function) in RHV</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/articles/2335291">How to enable host device passthrough and SR-IOV to allow assigning dedicated virtual NICs to virtual machines in RHV</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Network_Bonding">9.5. Network Bonding</h3>
<div id="Bonding_Methods" class="paragraph">
<p>Network bonding combines multiple NICs into a bond device, with the following advantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The transmission speed of bonded NICs is greater than that of a single NIC.</p>
</li>
<li>
<p>Network bonding provides fault tolerance, because the bond device will not fail unless all its NICs fail.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using NICs of the same make and model ensures that they support the same bonding options and modes.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt&#8217;s default bonding mode, <code>(Mode 4) Dynamic Link Aggregation</code>, requires a switch that supports 802.3ad.</p>
</div>
<div id="Bond_logical_networks_compatibility" class="paragraph">
<p>The logical networks of a bond must be compatible. A bond can support only 1 non-VLAN logical network. The rest of the logical networks must have unique VLAN IDs.</p>
</div>
<div class="paragraph">
<p>Bonding must be enabled for the switch ports. Consult the manual provided by your switch vendor for specific instructions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can create a network bond device using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manually, in the <a href="#Creating_a_bond_device_in_the_administration_portal">Administration Portal</a>, for a specific host</p>
</li>
<li>
<p>Automatically, using <a href="#Creating_a_bond_device_with_the_lldp_labeler_service">LLDP Labeler</a>, for unbonded NICs of all hosts in a cluster or data center</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If your environment uses iSCSI storage and you want to implement redundancy, follow the instructions for <a href="#Configuring_iSCSI_Multipathing">configuring iSCSI multipathing</a>.</p>
</div>
<div class="sect3">
<h4 id="Creating_a_bond_device_in_the_administration_portal">9.5.1. Creating a Bond Device in the Administration Portal</h4>
<div class="paragraph">
<p>You can create a bond device on a specific host in the Administration Portal. The bond device can carry both VLAN-tagged and untagged traffic.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Network Interfaces</strong> tab to list the physical network interfaces attached to the host.</p>
</li>
<li>
<p>Click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Check the switch configuration. If the switch has been configured to provide Link Layer Discovery Protocol (LLDP) information, hover your cursor over a physical NIC to view the switch port&#8217;s aggregation configuration.</p>
</li>
<li>
<p>Drag and drop a NIC onto another NIC or onto a bond.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Two NICs form a new bond. A NIC and a bond adds the NIC to the existing bond.</p>
</div>
<div class="paragraph">
<p>If the logical networks are <a href="#Bond_logical_networks_compatibility">incompatible</a>, the bonding operation is blocked.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the <strong>Bond Name</strong> and <strong>Bonding Mode</strong> from the drop-down menus. See <a href="#Bonding_Modes">Bonding Modes</a> for details.</p>
<div class="paragraph">
<p>If you select the <strong>Custom</strong> bonding mode, you can enter bonding options in the text field, as in the following examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your environment does not report link states with <code>ethtool</code>, you can set ARP monitoring by entering <code>mode=<em>1</em> arp_interval=<em>1</em> arp_ip_target=<em>192.168.0.2</em></code>.</p>
</li>
<li>
<p>You can designate a NIC with higher throughput as the primary interface by entering <code>mode=<em>1</em> primary=<em>eth0</em></code>.</p>
<div class="paragraph">
<p>For a comprehensive list of bonding options and their descriptions, see the <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt"><em>Linux Ethernet Bonding Driver HOWTO</em></a> on Kernel.org.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Attach a logical network to the new bond and configure it. See <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a> for instructions.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot attach a logical network directly to an individual NIC in the bond.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, you can select <strong>Verify connectivity between Host and Engine</strong> if the host is in maintenance mode.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_bond_device_with_the_lldp_labeler_service">9.5.2. Creating a Bond Device with the LLDP Labeler Service</h4>
<div class="paragraph">
<p>The LLDP Labeler service enables you to create a bond device automatically with all unbonded NICs, for all the hosts in one or more clusters or in the entire data center. The bonding mode is <a href="#Bonding_Modes"><code>(Mode 4) Dynamic Link Aggregation(802.3ad)</code></a>.</p>
</div>
<div class="paragraph">
<p>NICs with <a href="#Bond_logical_networks_compatibility">incompatible logical networks</a> cannot be bonded.</p>
</div>
<div id="Configuring_LLDP_Labeler_labels" class="paragraph">
<p>By default, LLDP Labeler runs as an hourly service. This option is useful if you make hardware changes (for example, NICs, switches, or cables) or change switch configurations.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The interfaces must be connected to a Juniper switch.</p>
</li>
<li>
<p>The Juniper switch must be configured for Link Aggregation Control Protocol (LACP) using LLDP.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Configure the <code>username</code> and <code>password</code> in <code>/etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>username</code> - the username of the Engine administrator. The default is <code>admin@internal</code>.</p>
</li>
<li>
<p><code>password</code> - the password of the Engine administrator. The default is <code>123456</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Configure the LLDP Labeler service by updating the following values in <code>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-credentials.conf</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>clusters</code> - a comma-separated list of clusters on which the service should run. Wildcards are supported. For example, <code>Cluster*</code> defines LLDP Labeler to run on all clusters starting with word <code>Cluster</code>. To run the service on all clusters in the data center, type <code>*</code>. The default is <code>Def*</code>.</p>
</li>
<li>
<p><code>api_url</code> - the full URL of the Engine&#8217;s API. The default is <code>https://<em>Manager_FQDN</em>/ovirt-engine/api</code></p>
</li>
<li>
<p><code>ca_file</code> - the path to the custom CA certificate file. Leave this value empty if you do not use custom certificates. The default is empty.</p>
</li>
<li>
<p><code>auto_bonding</code> - enables LLDP Labeler&#8217;s bonding capabilities. The default is <code>true</code>.</p>
</li>
<li>
<p><code>auto_labeling</code> - enables LLDP Labeler&#8217;s labeling capabilities. The default is <code>true</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, you can configure the service to run at a different time interval by changing the value of <code>OnUnitActiveSec</code> in <code>etc/ovirt-lldp-labeler/conf.d/ovirt-lldp-labeler.timer</code>. The default is <code>1h</code>.</p>
</li>
<li>
<p>Configure the service to start now and at boot by entering the following command:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl enable --now ovirt-lldp-labeler</pre>
</div>
</div>
<div class="paragraph">
<p>To invoke the service manually, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># /usr/bin/python /usr/share/ovirt-lldp-labeler/ovirt_lldp_labeler_cli.py</pre>
</div>
</div>
</li>
<li>
<p>Attach a logical network to the new bond and configure it. See <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a> for instructions.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot attach a logical network directly to an individual NIC in the bond.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Bonding_Modes">9.5.3. Bonding Modes</h4>
<div class="paragraph">
<p>The packet dispersal algorithm is determined by the bonding mode. (See the <a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a> for details). oVirt&#8217;s default bonding mode is <code>(Mode 4) Dynamic Link Aggregation(802.3ad)</code>.</p>
</div>
<div class="paragraph">
<p>oVirt supports the following bonding modes, because they can be used in virtual machine (bridged) networks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(Mode 1) Active-Backup</code></dt>
<dd>
<p>One NIC is active. If the active NIC fails, one of the backup NICs replaces it as the only active NIC in the bond. The MAC address of this bond is visible only on the network adapter port. This prevents MAC address confusion that might occur if the MAC address of the bond were to change, reflecting the MAC address of the new active NIC.</p>
</dd>
<dt class="hdlist1"><code>(Mode 2) Load Balance (balance-xor)</code></dt>
<dd>
<p>The NIC that transmits packets is selected by performing an XOR operation on the source MAC address and the destination MAC address, multiplied by the <code>modulo</code> of the total number of NICs. This algorithm ensures that the same NIC is selected for each destination MAC address.</p>
</dd>
<dt class="hdlist1"><code>(Mode 3) Broadcast</code></dt>
<dd>
<p>Packets are transmitted to all NICs.</p>
</dd>
<dt class="hdlist1"><code>(Mode 4) Dynamic Link Aggregation(802.3ad)</code> (Default)</dt>
<dd>
<p>The NICs are aggregated into groups that share the same speed and duplex settings . All the NICs in the active aggregation group are used.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>(Mode 4) Dynamic Link Aggregation(802.3ad)</code> requires a switch that supports 802.3ad.</p>
</div>
<div class="paragraph">
<p>The bonded NICs must have the same aggregator IDs. Otherwise, the Engine displays a warning exclamation mark icon on the bond in the <strong>Network Interfaces</strong> tab and the <code>ad_partner_mac</code> value of the bond is reported as <code>00:00:00:00:00:00</code>. You can check the aggregator IDs by entering the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /proc/net/bonding/<em>bond0</em></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://access.redhat.com/solutions/67546" class="bare">https://access.redhat.com/solutions/67546</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following bonding modes are incompatible with virtual machine logical networks and therefore only non-VM logical networks can be attached to bonds using these modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>(Mode 0) Round-Robin</code></dt>
<dd>
<p>The NICs transmit packets in sequential order. Packets are transmitted in a loop that begins with the first available NIC in the bond and ends with the last available NIC in the bond. Subsequent loops start with the first available NIC.</p>
</dd>
<dt class="hdlist1"><code>(Mode 5) Balance-TLB</code>, also called Transmit Load-Balance</dt>
<dd>
<p>Outgoing traffic is distributed, based on the load, over all the NICs in the bond. Incoming traffic is received by the active NIC. If the NIC receiving incoming traffic fails, another NIC is assigned.</p>
</dd>
<dt class="hdlist1"><code>(Mode 6) Balance-ALB</code>, also called Adaptive Load-Balance</dt>
<dd>
<p><code>(Mode 5) Balance-TLB</code> is combined with receive load-balancing for IPv4 traffic. ARP negotiation is used for balancing the receive load.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Hosts">10. Hosts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Introduction_to_Hosts">10.1. Introduction to Hosts</h3>
<div class="paragraph">
<p>Hosts, also known as hypervisors, are the physical servers on which virtual machines run. Full virtualization is provided by using a loadable Linux kernel module called Kernel-based Virtual Machine (KVM).</p>
</div>
<div class="paragraph">
<p>KVM can concurrently host multiple virtual machines running either Windows or Linux operating systems. Virtual machines run as individual Linux processes and threads on the host machine and are managed remotely by the oVirt Engine. A oVirt environment has one or more hosts attached to it.</p>
</div>
<div class="paragraph">
<p>oVirt supports two methods of installing hosts. You can use the oVirt Node (oVirt Node) installation media, or install hypervisor packages on a standard Enterprise Linux installation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can identify the host type of an individual host in the oVirt Engine by selecting the host&#8217;s name. This opens the details view. Then look at the <strong>OS Description</strong> under <strong>Software</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hosts use <code>tuned</code> profiles, which provide virtualization optimizations. For more information on <code>tuned</code>, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Performance_Tuning_Guide/sect-Red_Hat_Enterprise_Linux-Performance_Tuning_Guide-Performance_Monitoring_Tools-tuned_and_tuned_adm.html"><em>Enterprise Linux 7 Performance Tuning Guide</em></a>.</p>
</div>
<div class="paragraph">
<p>The oVirt Node has security features enabled. Security Enhanced Linux (SELinux) and the firewall are fully configured and on by default. The status of SELinux on a selected host is reported under <strong>SELinux mode</strong> in the <strong>General</strong> tab of the details view. The Engine can open required ports on Enterprise Linux hosts when it adds them to the environment.</p>
</div>
<div class="paragraph">
<p>A host is a physical 64-bit server with the Intel VT or AMD-V extensions running Enterprise Linux 7 AMD64/Intel 64 version.</p>
</div>
<div class="paragraph">
<p>A physical host on the oVirt platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Must belong to only one cluster in the system.</p>
</li>
<li>
<p>Must have CPUs that support the AMD-V or Intel VT hardware virtualization extensions.</p>
</li>
<li>
<p>Must have CPUs that support all functionality exposed by the virtual CPU type selected upon cluster creation.</p>
</li>
<li>
<p>Has a minimum of 2 GB RAM.</p>
</li>
<li>
<p>Can have an assigned system administrator with system permissions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Administrators can receive the latest security advisories from the oVirt watch list. Subscribe to the oVirt watch list to receive new security advisories for oVirt products by email. Subscribe by completing this form:</p>
</div>
<div class="paragraph">
<p><a href="https://www.redhat.com/mailman/listinfo/rhsa-announce">https://www.redhat.com/mailman/listinfo/rhsa-announce</a></p>
</div>
</div>
<div class="sect2">
<h3 id="Intro_to_RHVH">10.2. oVirt Node</h3>
<div class="paragraph">
<p>oVirt Node (oVirt Node) is installed using a special build of Enterprise Linux with only the packages required to host virtual machines. It uses an <code>Anaconda</code> installation interface based on the one used by Enterprise Linux hosts, and can be updated through the oVirt Engine or via <code>yum</code>. Using the <code>yum</code> command is the only way to install additional packages and have them persist after an upgrade.</p>
</div>
<div class="paragraph">
<p>oVirt Node features a Cockpit web interface for monitoring the host&#8217;s resources and performing administrative tasks. Direct access to oVirt Node via SSH or console is not supported, so the Cockpit web interface provides a graphical user interface for tasks that are performed before the host is added to the oVirt Engine, such as configuring networking or running terminal commands via the <strong>Terminal</strong> sub-tab.</p>
</div>
<div class="paragraph">
<p>Access the Cockpit web interface at https://<em>HostFQDNorIP</em>:9090 in your web browser. Cockpit for oVirt Node includes a custom <strong>Virtualization</strong> dashboard that displays the host&#8217;s health status, SSH Host Key, self-hosted engine status, virtual machines, and virtual machine statistics.</p>
</div>
<div class="paragraph">
<p>oVirt Node uses the Automatic Bug Reporting Tool (ABRT) to collect meaningful debug information about application crashes. For more information, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/system_administrators_guide/index#ch-abrt"><em>Enterprise Linux System Administrator&#8217;s Guide</em></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Custom boot kernel arguments can be added to oVirt Node using the <code>grubby</code> tool. The <code>grubby</code> tool makes persistent changes to the <strong>grub.cfg</strong> file. Navigate to the <strong>Terminal</strong> sub-tab in the host&#8217;s Cockpit web interface to use <code>grubby</code> commands. See the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-Working_with_the_GRUB_2_Boot_Loader#sec-Making_Persistent_Changes_to_a_GRUB_2_Menu_Using_the_grubby_Tool"><em>Enterprise Linux System Administrator&#8217;s Guide</em></a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create untrusted users on oVirt Node, as this can lead to exploitation of local security vulnerabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Red_Hat_Enterprise_Linux_Hosts">10.3. Enterprise Linux hosts</h3>
<div class="paragraph">
<p>You can use a Enterprise Linux 7 installation on capable hardware as a host. oVirt supports hosts running Enterprise Linux 7 Server AMD64/Intel 64 version with Intel VT or AMD-V extensions. To use your Enterprise Linux machine as a host, you must also attach the <code>Enterprise Linux Server</code> and <code>oVirt</code> subscriptions.</p>
</div>
<div class="paragraph">
<p>Adding a host can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, and the creation of a bridge. Use the details view to monitor the process as the host and management system establish a connection.</p>
</div>
<div class="paragraph">
<p>Optionally, you can install a Cockpit web interface for monitoring the host&#8217;s resources and performing administrative tasks. The Cockpit web interface provides a graphical user interface for tasks that are performed before the host is added to the oVirt Engine, such as configuring networking or running terminal commands via the <strong>Terminal</strong> sub-tab.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Third-party watchdogs should not be installed on Enterprise Linux hosts, as they can interfere with the watchdog daemon provided by VDSM.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Satellite_Host_Provider_Hosts">10.4. Satellite Host Provider Hosts</h3>
<div class="paragraph">
<p>Hosts provided by a Satellite host provider can also be used as virtualization hosts by the oVirt Engine. After a Satellite host provider has been added to the Engine as an external provider, any hosts that it provides can be added to and used in oVirt in the same way as oVirt Nodes (oVirt Node) and Enterprise Linux hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Host_Tasks">10.5. Host Tasks</h3>
<div class="sect3">
<h4 id="Adding_standard_hosts_to_the_Manager_host_tasks">10.5.1. Adding Standard Hosts to the oVirt Engine</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Always use the oVirt Engine to modify the network configuration of hosts in your clusters. Otherwise, you might create an unsupported configuration. For details, see <a href="https://ovirt.org/documentation/administration_guide/index#con-Network-Manager-Stateful-Configuration-nmstate">Network Manager Stateful Configuration (nmstate)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Adding a host to your oVirt environment can take some time, as the following steps are completed by the platform: virtualization checks, installation of packages, and creation of a bridge.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>From the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>.</p>
</li>
<li>
<p>Use the drop-down list to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and the <strong>Address</strong> of the new host. The standard SSH port, port 22, is auto-filled in the <strong>SSH Port</strong> field.</p>
</li>
<li>
<p>Select an authentication method to use for the Engine to access the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Alternatively, copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_keys</strong> on the host to use public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, click the <strong>Advanced Parameters</strong> button to change the following advanced host settings:</p>
<div class="ulist">
<ul>
<li>
<p>Disable automatic firewall configuration.</p>
</li>
<li>
<p>Add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally configure power management, where the host has a supported power management card. For information on power management configuration, see <a href="https://ovirt.org/documentation/administration_guide/index#Host_Power_Management_settings_explained">Host Power Management Settings Explained</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new host displays in the list of hosts with a status of <code>Installing</code>, and you can view the progress of the installation in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>). After a brief delay the host status changes to <code>Up</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_a_Satellite_Host_Provider_Host">10.5.2. Adding a Satellite Host Provider Host</h4>
<div class="paragraph">
<p>The process for adding a Satellite host provider host is almost identical to that of adding a Enterprise Linux host except for the method by which the host is identified in the Engine. The following procedure outlines how to add a host provided by a Satellite host provider.</p>
</div>
<div class="paragraph">
<p><strong>Adding a Satellite Host Provider Host</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Use the drop-down menu to select the <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Select the <strong>Foreman/Satellite</strong> check box to display the options for adding a Satellite host provider host and select the provider from which the host is to be added.</p>
</li>
<li>
<p>Select either <strong>Discovered Hosts</strong> or <strong>Provisioned Hosts</strong>.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Discovered Hosts</strong> (default option): Select the host, host group, and compute resources from the drop-down lists.</p>
</li>
<li>
<p><strong>Provisioned Hosts</strong>: Select a host from the <strong>Providers Hosts</strong> drop-down list.</p>
<div class="paragraph">
<p>Any details regarding the host that can be retrieved from the external provider are automatically set, and can be edited as desired.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the <strong>Name</strong> and <strong>SSH Port</strong> (Provisioned Hosts only) of the new host.</p>
</li>
<li>
<p>Select an authentication method to use with the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_hosts</strong> on the host to use public key authentication (Provisioned Hosts only).</p>
</li>
</ul>
</div>
</li>
<li>
<p>You have now completed the mandatory steps to add a Enterprise Linux host. Click the <strong>Advanced Parameters</strong> drop-down button to show the advanced host settings.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Optionally disable automatic firewall configuration.</p>
</li>
<li>
<p>Optionally add a host SSH fingerprint to increase security. You can add it manually, or fetch it automatically.</p>
</li>
</ol>
</div>
</li>
<li>
<p>You can configure the <strong>Power Management</strong>, <strong>SPM</strong>, <strong>Console</strong>, and <strong>Network Provider</strong> using the applicable tabs now; however, as these are not fundamental to adding a Enterprise Linux host, they are not covered in this procedure.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to add the host and close the window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new host displays in the list of hosts with a status of <code>Installing</code>, and you can view the progress of the installation in the details view. After installation is complete, the status will update to <code>Reboot</code>. The host must be activated for the status to change to <code>Up</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Satellite_Errata_Management_for_a_Host">10.5.3. Setting up Satellite errata viewing for a host</h4>
<div class="paragraph">
<p>In the Administration Portal, you can configure a host to view errata from Red Hat Satellite. After you associate a host with a Red Hat Satellite provider, you can receive updates in the host configuration dashboard about available errata and their importance, and decide when it is practical to apply the updates.</p>
</div>
<div class="paragraph">
<p>oVirt 4.4 supports viewing errata with Red Hat Satellite 6.6.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Satellite server must be added as an external provider.</p>
</li>
<li>
<p>The Engine and any hosts on which you want to view errata must be registered in the Satellite server by their respective FQDNs. This ensures that external content host IDs do not need to be maintained in oVirt.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Hosts added using an IP address cannot report errata.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The Satellite account that manages the host must have Administrator permissions and a default organization set.</p>
</li>
<li>
<p>The host must be registered to the Satellite server.</p>
</li>
<li>
<p>Use Red Hat Satellite remote execution to manage packages on hosts.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the <strong>Use Foreman/Satellite</strong> check box.</p>
</li>
<li>
<p>Select the required Satellite server from the drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The host is now configured to show the available errata, and their importance, in the same dashboard used to manage the host&#8217;s configuration.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">Adding a Red Hat Satellite Instance for Host Provisioning</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/html/managing_hosts/host-management-without-goferd-and-katello-agent_managing-hosts">Host Management Without Goferd and Katello Agent</a> in the Red Hat Satellite document <em>Managing Hosts</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_a_Host_for_PCI_Passthrough_host_tasks">10.5.4. Configuring a Host for PCI Passthrough</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is one in a series of topics that show how to set up and configure SR-IOV on oVirt. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#setting-up-and-configuring-sr-iov">Setting Up and Configuring SR-IOV</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enabling PCI passthrough allows a virtual machine to use a host device as if the device were directly attached to the virtual machine. To enable the PCI passthrough function, you must enable virtualization extensions and the IOMMU function. The following procedure requires you to reboot the host. If the host is attached to the Engine already, ensure you place the host into maintenance mode first.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the host hardware meets the requirements for PCI device passthrough and assignment. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/planning_and_prerequisites_guide/index#PCI_Device_Requirements_RHV_planning">PCI Device Requirements</a> for more information.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Configuring a Host for PCI Passthrough</div>
<ol class="arabic">
<li>
<p>Enable the virtualization extension and IOMMU extension in the BIOS. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Virtualization_Deployment_and_Administration_Guide/sect-Troubleshooting-Enabling_Intel_VT_x_and_AMD_V_virtualization_hardware_extensions_in_BIOS.html">Enabling Intel VT-x and AMD-V virtualization hardware extensions in BIOS</a> in the <em>Enterprise Linux Virtualization Deployment and Administration Guide</em> for more information.</p>
</li>
<li>
<p>Enable the IOMMU flag in the kernel by selecting the <strong>Hostdev Passthrough &amp; SR-IOV</strong> check box when adding the host to the Engine or by editing the <strong>grub</strong> configuration file manually.</p>
<div class="ulist">
<ul>
<li>
<p>To enable the IOMMU flag from the Administration Portal, see <a href="https://ovirt.org/documentation/administration_guide#Adding_standard_hosts_to_the_Manager">Adding Standard Hosts to the oVirt Engine</a> and <a href="https://ovirt.org/documentation/administration_guide#Kernel_Settings_Explained">Kernel Settings Explained</a>.</p>
</li>
<li>
<p>To edit the <strong>grub</strong> configuration file manually, see  <a href="#Enabling_IOMMU_Manually">Enabling IOMMU Manually</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For GPU passthrough, you need to run additional configuration steps on both the host and the guest system. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/setting_up_an_nvidia_gpu_for_a_virtual_machine_in_red_hat_virtualization/index#proc_nvidia_gpu_passthrough_nvidia_gpu_passthrough">GPU device passthrough: Assigning a host GPU to a single virtual machine</a> in <em>Setting up an NVIDIA GPU for a virtual machine in Red Hat Virtualization</em> for more information.</p>
</li>
</ol>
</div>
<div id="Enabling_IOMMU_Manually" class="olist arabic">
<div class="title">Enabling IOMMU Manually</div>
<ol class="arabic">
<li>
<p>Enable IOMMU by editing the grub configuration file.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using IBM POWER8 hardware, skip this step as IOMMU is enabled by default.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>For Intel, boot the machine, and append <code>intel_iommu=on</code> to the end of the <code>GRUB_CMDLINE_LINUX</code> line in the <strong>grub</strong> configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/default/grub
...
GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 ... intel_iommu=on
...</pre>
</div>
</div>
</li>
<li>
<p>For AMD, boot the machine, and append <code>amd_iommu=on</code> to the end of the <code>GRUB_CMDLINE_LINUX</code> line in the <strong>grub</strong> configuration file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/default/grub
...
GRUB_CMDLINE_LINUX="nofb splash=quiet console=tty0 ... amd_iommu=on
...</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If <code>intel_iommu=on</code> or an AMD IOMMU is detected, you can try adding <code>iommu=pt</code>. The <code>pt</code> option only enables IOMMU for devices used in passthrough and provides better host performance. However, the option might not be supported on all hardware. Revert to the previous option if the <code>pt</code> option doesn&#8217;t work for your host.</p>
</div>
<div class="paragraph">
<p>If the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling the <code>allow_unsafe_interrupts</code> option if the virtual machines are trusted. The <code>allow_unsafe_interrupts</code> is not enabled by default because enabling it potentially exposes the host to MSI attacks from virtual machines. To enable the option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/modprobe.d
options vfio_iommu_type1 allow_unsafe_interrupts=1</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Refresh the <strong>grub.cfg</strong> file and reboot the host for these changes to take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># grub2-mkconfig -o /boot/grub2/grub.cfg</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># reboot</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To enable SR-IOV and assign dedicated virtual NICs to virtual machines, see <a href="https://access.redhat.com/articles/2335291" class="bare">https://access.redhat.com/articles/2335291</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-enabling-nested-virtualization-for-all-virtual-machines">10.5.5. Enabling nested virtualization for all virtual machines</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using hooks to enable nested virtualization is a Technology Preview feature. Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information, see <a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nested virtualization enables virtual machines to host other virtual machines. For clarity, we will call these the <em>parent virtual machines</em> and <em>nested virtual machines</em>.</p>
</div>
<div class="paragraph">
<p>Child virtual machines are only visible to and managed by users who have access to the parent virtual machine. They are not visible to oVirt (oVirt) administrators.</p>
</div>
<div class="paragraph">
<p>By default, nested virtualization is not enabled in oVirt. To enable nested virtualization, you install a VDSM hook, <code>vdsm-hook-nestedvt</code>, on all of the hosts in the cluster. Then, all of the virtual machines that run on these hosts can function as parent virtual machines.</p>
</div>
<div class="paragraph">
<p>You should only run parent virtual machines on hosts that support nested virtualization. If a parent virtual machine migrates to a host that does not support nested virtualization, its child virtual machines fail. To prevent this from happening, configure all of the hosts in the cluster to support nested virtualization. Otherwise, restrict parent virtual machines from migrating to hosts that do not support nested virtualization.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Take precautions to prevent parent virtual machines from migrating to hosts that do not support nested virtualization.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select a host in the cluster where you want to enable nested virtualization and click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Select the host again, click <b class="button">Host Console</b>, and log into the host console.</p>
</li>
<li>
<p>Install the VDSM hook:</p>
<div class="listingblock">
<div class="content">
<pre># dnf install vdsm-hook-nestedvt</pre>
</div>
</div>
</li>
<li>
<p>Reboot the host.</p>
</li>
<li>
<p>Log into the host console again and verify that nested virtualization is enabled:</p>
<div class="listingblock">
<div class="content">
<pre>$ cat /sys/module/kvm*/parameters/nested</pre>
</div>
</div>
<div class="paragraph">
<p>If this command returns <code>Y</code> or <code>1</code>, the feature is enabled.</p>
</div>
</li>
<li>
<p>Repeat this procedure for all of the hosts in the cluster.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#VDSM_hooks">VDSM Hooks</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-enabling-nested-virtualization-for-individual-virtual-machines">10.5.6. Enabling nested virtualization for individual virtual machines</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Nested virtualization is a Technology Preview feature. Technology Preview features are not supported with Red Hat production service-level agreements (SLAs) and might not be functionally complete, and Red Hat does not recommend using them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process. For more information see <a href="https://access.redhat.com/support/offerings/techpreview/">Red Hat Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nested virtualization enables virtual machines to host other virtual machines. For clarity, we will call these the <em>parent virtual machines</em> and <em>nested virtual machines</em>.</p>
</div>
<div class="paragraph">
<p>Child virtual machines are only visible to and managed by users who have access to the parent virtual machine. They are not visible to oVirt (oVirt) administrators.</p>
</div>
<div class="paragraph">
<p>To enable nested virtualization <em>on specific virtual machines</em>, not all virtual machines, you configure a host or hosts to support nested virtualization. Then you configure the virtual machine or virtual machines on run on those specific hosts and enable <strong>Pass-Through Host CPU</strong>. This option lets the virtual machines use the nested virtualization settings you just configured on the host. This option also restricts which hosts the virtual machines can run on and requires manual migration.</p>
</div>
<div class="paragraph">
<p>Otherwise, to enable nested virtualization for <em>all of the virtual machines</em> in a cluster, see <a href="#proc-enabling-nested-virtualization-for-all-virtual-machines">Enabling nested virtualization for all virtual machines</a></p>
</div>
<div class="paragraph">
<p>Only run parent virtual machines on hosts that support nested virtualization. If you migrate a parent virtual machine to a host that does not support nested virtualization, its child virtual machines will fail.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not migrate parent virtual machines to hosts that do not support nested virtualization.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Avoid live migration of parent virtual machines that are running child virtual machines. Even if the source and destination hosts are identical and support nested virtualization, the live migration can cause the child virtual machines to fail. Instead, shut down virtual machines before migration.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>Configure the hosts to support nested virtualization:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select a host in the cluster where you want to enable nested virtualization and click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Select the host again, click <b class="button">Host Console</b>, and log into the host console.</p>
</li>
<li>
<p>In the <strong>Edit Host</strong> window, select the <strong>Kernel</strong> tab.</p>
</li>
<li>
<p>Under <strong>Kernel boot parameters</strong>, if the checkboxes are greyed-out, click <b class="button">RESET</b>.</p>
</li>
<li>
<p>Select <strong>Nested Virtualization</strong> and click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>This action displays a <code>kvm-&lt;architecture&gt;.nested=1</code> parameter in <strong>Kernel command line</strong>. The following steps add this parameter to the <strong>Current kernel CMD line</strong>.</p>
</div>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>.</p>
</li>
<li>
<p>When the host status returns to <code>Up</code>, click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Restart</b></span> under <strong>Power Management</strong> or <strong>SSH Management</strong>.</p>
</li>
<li>
<p>Verify that nested virtualization is enabled. Log into the host console and enter:</p>
<div class="listingblock">
<div class="content">
<pre>$ cat /sys/module/kvm*/parameters/nested</pre>
</div>
</div>
<div class="paragraph">
<p>If this command returns <code>Y</code> or <code>1</code>, the feature is enabled.</p>
</div>
</li>
<li>
<p>Repeat this procedure for all of the hosts you need to run parent virtual machines.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Enable nested virtualization in specific virtual machines:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Select a virtual machine and click <b class="button">Edit</b></p>
</li>
<li>
<p>In the <strong>Edit Vitual Machine</strong> window, click <b class="button">Show Advanced Options</b> and select the <strong>Host</strong> tab.</p>
</li>
<li>
<p>Under <strong>Start Running On</strong>, click <strong>Specific Host</strong> and select the host or hosts you configured to support nested virtualization.</p>
</li>
<li>
<p>Under <strong>CPU Options</strong>, select <strong>Pass-Through Host CPU</strong>. This action automatically sets the <strong>Migration mode</strong> to <strong>Allow manual migration only</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In RHV version 4.2, you can only enable <strong>Pass-Through Host CPU</strong> when <strong>Do not allow migration</strong> is selected.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#VDSM_hooks">VDSM Hooks</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_and_managing_virtualization/creating-nested-virtual-machines_configuring-and-managing-virtualization">Creating Child virtual Machines</a> in the EL documentation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Moving_a_host_to_maintenance_mode">10.5.7. Moving a Host to Maintenance Mode</h4>
<div class="paragraph">
<p>Many common maintenance tasks, including network configuration and deployment of software updates, require that hosts be placed into maintenance mode. Hosts should be placed into maintenance mode before any event that might cause VDSM to stop working properly, such as a reboot, or issues with networking or storage.</p>
</div>
<div class="paragraph">
<p>When a host is placed into maintenance mode the oVirt Engine attempts to migrate all running virtual machines to alternative hosts. The standard prerequisites for live migration apply, in particular there must be at least one active host in the cluster with capacity to run the migrated virtual machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtual machines that are pinned to the host and cannot be migrated are shut down. You can check which virtual machines are pinned to the host by clicking <b class="button">Pinned to Host</b> in the <strong>Virtual Machines</strong> tab of the host&#8217;s details view.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Placing a Host into Maintenance Mode</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the desired host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span>. This opens the <strong>Maintenance Host(s)</strong> confirmation window.</p>
</li>
<li>
<p>Optionally, enter a <strong>Reason</strong> for moving the host into maintenance mode, which will appear in the logs and when the host is activated again. Then, click <b class="button">OK</b></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The host maintenance <strong>Reason</strong> field will only appear if it has been enabled in the cluster settings. See <a href="#Cluster_General_Settings_Explained">General Cluster Settings Explained</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, select the required options for hosts that support Gluster.</p>
<div class="paragraph">
<p>Select the <strong>Ignore Gluster Quorum and Self-Heal Validations</strong> option to avoid the default checks. By default, the Engine checks that the Gluster quorum is not lost when the host is moved to maintenance mode. The Engine also checks that there is no self-heal activity that will be affected by moving the host to maintenance mode. If the Gluster quorum will be lost or if there is self-heal activity that will be affected, the Engine prevents the host from being placed into maintenance mode. Only use this option if there is no other way to place the host in maintenance mode.</p>
</div>
<div class="paragraph">
<p>Select the <strong>Stop Gluster Service</strong> option to stop all Gluster services while moving the host to maintenance mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These fields will only appear in the host maintenance window when the selected host supports Gluster. See <a href="https://access.redhat.com/documentation/en-us/red_hat_hyperconverged_infrastructure/1.0/html-single/maintaining_red_hat_hyperconverged_infrastructure/#maintenance_tasks">Replacing the Primary Gluster Storage Node</a> in <em>Maintaining Red Hat Hyperconverged Infrastructure</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b> to initiate maintenance mode.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>All running virtual machines are migrated to alternative hosts. If the host is the Storage Pool Manager (SPM), the SPM role is migrated to another host. The <strong>Status</strong> field of the host changes to <code>Preparing for Maintenance</code>, and finally <code>Maintenance</code> when the operation completes successfully. VDSM does not stop while the host is in maintenance mode.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If migration fails on any virtual machine, click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span> on the host to stop the operation placing it into maintenance mode, then click <strong>Cancel Migration</strong> on the virtual machine to stop the migration.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Activating_a_host_from_maintenance_mode">10.5.8. Activating a Host from Maintenance Mode</h4>
<div class="paragraph">
<p>A host that has been placed into maintenance mode, or recently added to the environment, must be activated before it can be used. Activation may fail if the host is not ready; ensure that all tasks are complete before attempting to activate the host.</p>
</div>
<div class="paragraph">
<p><strong>Activating a Host from Maintenance Mode</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The host status changes to <code>Unassigned</code>, and finally <code>Up</code> when the operation is complete. Virtual machines can now run on the host. Virtual machines that were migrated off the host when it was placed into maintenance mode are not automatically migrated back to the host when it is activated, but can be migrated manually. If the host was the Storage Pool Manager (SPM) before being placed into maintenance mode, the SPM role does not return automatically when the host is activated.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Host_Firewall_Rules">10.5.9. Configuring Host Firewall Rules</h4>
<div class="paragraph">
<p>You can configure the host firewall rules so that they are persistent, using Ansible. The cluster must be configured to use <code>firewalld</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changing the <code>firewalld</code> zone is not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Configuring Firewall Rules for Hosts</div>
<ol class="arabic">
<li>
<p>On the Engine machine, edit <strong>ovirt-host-deploy-post-tasks.yml.example</strong> to add a custom firewall port:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/ansible/ovirt-host-deploy-post-tasks.yml.example
---
#
# Any additional tasks required to be executing during host deploy process can
# be added below
#
- name: Enable additional port on firewalld
  firewalld:
    port: "<em>12345/tcp</em>"
    permanent: yes
    immediate: yes
    state: enabled</pre>
</div>
</div>
</li>
<li>
<p>Save the file to another location as <strong>ovirt-host-deploy-post-tasks.yml</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>New or reinstalled hosts are configured with the updated firewall rules.</p>
</div>
<div class="paragraph">
<p>Existing hosts must be reinstalled by clicking <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span> and selecting <strong>Automatically configure host firewall</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_host">10.5.10. Removing a Host</h4>
<div class="paragraph">
<p>Removing a host from your oVirt environment is sometimes necessary, such as when you need to reinstall a host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span>.</p>
</li>
<li>
<p>Once the host is in maintenance mode, click <strong>Remove</strong>. The <strong>Remove Host(s)</strong> confirmation window opens.</p>
</li>
<li>
<p>Select the <strong>Force Remove</strong> check box if the host is part of a Gluster Storage cluster and has volume bricks on it, or if the host is non-responsive.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Updating_a_host_between_minor_releases">10.5.11. Updating Hosts Between Minor Releases</h4>
<div class="paragraph">
<p>You can update <a href="#Updating_all_hosts_in_a_cluster_admin">all hosts in a cluster</a>, or update <a href="#Updating_Individual_Hosts_admin">individual hosts</a>.</p>
</div>
<div class="sect4">
<h5 id="Updating_all_hosts_in_a_cluster_admin">Updating All Hosts in a Cluster</h5>
<div class="paragraph">
<p>You can update all hosts in a cluster instead of updating hosts individually. This is particularly useful during upgrades to new versions of oVirt. See <a href="https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md" class="bare">https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/cluster_upgrade/README.md</a> for more information about the Ansible role used to automate the updates.</p>
</div>
<div class="paragraph">
<p>Update one cluster at a time.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines are shut down during the update, unless you choose to skip that host instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select the cluster. The <strong>Upgrade status</strong> column shows if an upgrade is available for any hosts in the cluster.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
<li>
<p>Select the hosts to update, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Configure the options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Stop Pinned VMs</strong> shuts down any virtual machines that are pinned to hosts in the cluster, and is selected by default. You can clear this check box to skip updating those hosts so that the pinned virtual machines stay running, such as when a pinned virtual machine is running important services or processes and you do not want it to shut down at an unknown time during the update.</p>
</li>
<li>
<p><strong>Upgrade Timeout (Minutes)</strong> sets the time to wait for an individual host to be updated before the cluster upgrade fails with a timeout. The default is <code>60</code>. You can increase it for large clusters where 60 minutes might not be enough, or reduce it for small clusters where the hosts update quickly.</p>
</li>
<li>
<p><strong>Check Upgrade</strong> checks each host for available updates before running the upgrade process. It is not selected by default, but you can select it if you need to ensure that recent updates are included, such as when you have configured the Engine to check for host updates less frequently than the default.</p>
</li>
<li>
<p><strong>Reboot After Upgrade</strong> reboots each host after it is updated, and is selected by default. You can clear this check box to speed up the process if you are sure that there are no pending updates that require a host reboot.</p>
</li>
<li>
<p><strong>Use Maintenance Policy</strong> sets the cluster&#8217;s scheduling policy to <a href="https://ovirt.org/documentation/administration_guide/index#Cluster_Scheduling_Policy_Settings"><code>cluster_maintenance</code></a> during the update. It is selected by default, so activity is limited and virtual machines cannot start unless they are highly available. You can clear this check box if you have a custom scheduling policy that you want to keep using during the update, but this could have unknown consequences. Ensure your custom policy is compatible with cluster upgrade activity before disabling this option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review the summary of the hosts and virtual machines that will be affected.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can track the progress of host updates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> view, the <strong>Upgrade Status</strong> column shows <strong>Upgrade in progress</strong>.</p>
</li>
<li>
<p>in the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> view</p>
</li>
<li>
<p>in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can track the progress of individual virtual machine migrations in the <strong>Status</strong> column of the <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> view. In large environments, you may need to filter the results to show a particular group of virtual machines.</p>
</div>
</div>
<div class="sect4">
<h5 id="Updating_Individual_Hosts_admin">Updating Individual Hosts</h5>
<div class="paragraph">
<p>Use the host upgrade manager to update individual hosts directly from the Administration Portal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The upgrade manager only checks hosts with a status of <strong>Up</strong> or <strong>Non-operational</strong>, but not <strong>Maintenance</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the correct repositories are enabled. To view a list of currently enabled repositories, run <code>dnf repolist</code>.</p>
<div class="ulist">
<ul>
<li>
<p>For oVirt Nodes, the <code>ovirt-release44</code> RPM package enabling the correct repositories is already installed. Ensure it is updated to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf update -y ovirt-release44</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host to be updated.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Check for Upgrade</b></span> and click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>Open the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>) and expand the <strong>Events</strong> section to see the result.</p>
</div>
</li>
<li>
<p>If an update is available, click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Upgrade</b></span>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to update the host. Running virtual machines are migrated according to their migration policy. If migration is disabled for any virtual machines, you are prompted to shut them down.</p>
<div class="paragraph">
<p>The details of the host are updated in <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and the status transitions through these stages:</p>
</div>
<div class="paragraph">
<p><strong>Maintenance &gt; Installing &gt; Reboot &gt; Up</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the update fails, the host&#8217;s status changes to <strong>Install Failed</strong>. From <strong>Install Failed</strong> you can click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Upgrade</b></span> again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat this procedure for each host in the oVirt environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You should update the hosts from the Administration Portal. However, you can update the hosts using <code>dnf upgrade</code> instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="Manually_Updating_Hosts_admin">Manually Updating Hosts</h5>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This information is provided for advanced system administrators who need to update hosts manually, but oVirt does not support this method. The procedure described in this topic does not include important steps, including certificate renewal, assuming advanced knowledge of such information. oVirt supports updating hosts using the Administration Portal. For details, see  <a href="https://ovirt.org/documentation/administration_guide/index#Updating_Individual_Hosts_admin">Updating individual hosts</a> or <a href="https://ovirt.org/documentation/administration_guide/index#Updating_all_hosts_in_a_cluster_admin">Updating all hosts in a cluster</a> in the <em>Administration Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the <code>dnf</code> command to update your hosts. Update your systems regularly, to ensure timely application of security and bug fixes.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure the correct repositories are enabled. You can check which repositories are currently enabled by running <code>dnf repolist</code>.</p>
<div class="ulist">
<ul>
<li>
<p>For oVirt Nodes, the <code>ovirt-release44</code> RPM package enabling the correct repositories is already installed. Ensure it is updated to the latest version:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf update -y ovirt-release44</pre>
</div>
</div>
</li>
<li>
<p>For Enterprise Linux hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host to be updated.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>For Enterprise Linux hosts:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Identify the current version of Enterprise Linux:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/redhat-release</pre>
</div>
</div>
</li>
<li>
<p>Check which version of the redhat-release package is available:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf --refresh info --available redhat-release</pre>
</div>
</div>
<div class="paragraph">
<p>This command shows any available updates. For example, when upgrading from Enterprise Linux 8.2.<em>z</em> to 8.3, compare the version of the package with the currently installed version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Available Packages
Name         : redhat-release
Version      : 8.3
Release      : 1.0.el8
&#8230;&#8203;</pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Enterprise Linux Advanced Virtualization module is usually released later than the Enterprise Linux y-stream. If no new Advanced Virtualization module is available yet, or if there is an error enabling it, stop here and cancel the upgrade. Otherwise you risk corrupting the host.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If the Advanced Virtualization stream is available for Enterprise Linux 8.3 or later, reset the <code>virt</code> module:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module reset virt</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If this module is already enabled in the Advanced Virtualization stream, this step is not necessary, but it has no negative impact.</p>
</div>
<div class="paragraph">
<p>You can see the value of the stream by entering:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf module list virt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enable the <code>virt</code> module in the Advanced Virtualization stream with the following command:</p>
<div class="ulist">
<ul>
<li>
<p>For oVirt 4.4.2:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable virt:8.2</pre>
</div>
</div>
</li>
<li>
<p>For oVirt 4.4.3 to 4.4.5:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable virt:8.3</pre>
</div>
</div>
</li>
<li>
<p>For oVirt 4.4.6 or later:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module enable virt:av</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Starting with EL 8.4, only one Advanced Virtualization stream is used, <code>rhel:av</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Update the host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade --nobest</pre>
</div>
</div>
</li>
<li>
<p>Reboot the host to ensure all updates are correctly applied.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Check the imgbased logs to see if any additional package updates have failed for a oVirt Node. If some packages were not successfully reinstalled after the update, check that the packages are listed in <strong>/var/imgbased/persisted-rpms</strong>. Add any missing packages then run <code>rpm -Uvh /var/imgbased/persisted-rpms/*</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat this process for each host in the oVirt environment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Reinstalling_Hosts_admin">10.5.12. Reinstalling Hosts</h4>
<div class="paragraph">
<p>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</p>
</li>
<li>
<p>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</p>
</li>
<li>
<p>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>. This opens the <strong>Install Host</strong> window.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to reinstall the host.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After a host has been reinstalled and its status returns to <strong>Up</strong>, you can migrate virtual machines back to the host.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <strong>Install Failed</strong>. Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>, and the host will change to an <strong>Up</strong> status and be ready for use.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_Host_Errata">10.5.13. Viewing Host Errata</h4>
<div class="paragraph">
<p>Errata for each host can be viewed after the host has been configured to receive errata information from the Red Hat Satellite server. For more information on configuring a host to receive errata information see <a href="#Configuring_Satellite_Errata_Management_for_a_Host">Setting up Satellite errata viewing for a host</a></p>
</div>
<div class="paragraph">
<p><strong>Viewing Host Errata</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Errata</strong> tab.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_Host_Health_Status">10.5.14. Viewing the Health Status of a Host</h4>
<div class="paragraph">
<p>Hosts have an external health status in addition to their regular <strong>Status</strong>. The external health status is reported by plug-ins or external systems, or set by an administrator, and appears to the left of the host&#8217;s <strong>Name</strong> as one of the following icons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OK</strong>: No icon</p>
</li>
<li>
<p><strong>Info</strong>: <span class="image"><img src="images/Info.png" alt="Info"></span></p>
</li>
<li>
<p><strong>Warning</strong>: <span class="image"><img src="images/Warning.png" alt="Warning"></span></p>
</li>
<li>
<p><strong>Error</strong>: <span class="image"><img src="images/Error.png" alt="Error"></span></p>
</li>
<li>
<p><strong>Failure</strong>: <span class="image"><img src="images/Failure.png" alt="Failure"></span></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view further details about the host&#8217;s health status, click the host&#8217;s name. This opens the details view, and click the <strong>Events</strong> tab.</p>
</div>
<div class="paragraph">
<p>The host&#8217;s health status can also be viewed using the REST API. A <code>GET</code> request on a host will include the <code>external_status</code> element, which contains the health status.</p>
</div>
<div class="paragraph">
<p>You can set a host&#8217;s health status in the REST API via the <code>events</code> collection. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-events-methods-add">Adding Events</a> in the <em>REST API Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_Host_Devices">10.5.15. Viewing Host Devices</h4>
<div class="paragraph">
<p>You can view the host devices for each host in the <strong>Host Devices</strong> tab in the details view. If the host has been configured for direct device assignment, these devices can be directly attached to virtual machines for improved performance.</p>
</div>
<div class="paragraph">
<p>For more information on the hardware requirements for direct device assignment, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/hardware_considerations_for_implementing_sr-iov/index#">Additional Hardware Considerations for Using Device Assignment</a> in <em>Hardware Considerations for Implementing SR-IOV</em>.</p>
</div>
<div class="paragraph">
<p>For more information on configuring the host for direct device assignment, see <a href="#Configuring_a_Host_for_PCI_Passthrough_host_tasks">Configuring a Host for PCI Passthrough</a>.</p>
</div>
<div class="paragraph">
<p>For more information on attaching host devices to virtual machines, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-host_devices">Host Devices</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
<div class="paragraph">
<p><strong>Viewing Host Devices</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click <strong>Host Devices</strong> tab.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This tab lists the details of the host devices, including whether the device is attached to a virtual machine, and currently in use by that virtual machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Accessing_Cockpit_from_the_Admin_Portal">10.5.16. Accessing Cockpit from the Administration Portal</h4>
<div class="paragraph">
<p>Cockpit is available by default on oVirt Nodes (oVirt Node) and Enterprise Linux hosts. You can access the Cockpit web interface by typing the address into a browser, or through the Administration Portal.</p>
</div>
<div class="paragraph">
<p><strong>Accessing Cockpit from the Administration Portal</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a host.</p>
</li>
<li>
<p>Click <strong>Host Console</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Cockpit login page opens in a new browser window.</p>
</div>
</div>
<div class="sect3">
<h4 id="Setting_Legacy_SPICE_Cipher_host_tasks">10.5.17. Setting a Legacy SPICE Cipher</h4>
<div class="paragraph">
<p>SPICE consoles use FIPS-compliant encryption by default, with a cipher string. The default SPICE cipher string is:
<code>kECDHE+FIPS:kDHE+FIPS:kRSA+FIPS:!eNULL:!aNULL</code></p>
</div>
<div class="paragraph">
<p>This string is generally sufficient. However, if you have a virtual machine with an older operating system or SPICE client, where either one or the other does not support FIPS-compliant encryption, you must use a weaker cipher string. Otherwise, a connection security error may occur if you install a new cluster or a new host in an existing cluster and try to connect to that virtual machine.</p>
</div>
<div class="paragraph">
<p>You can change the cipher string by using an Ansible playbook.</p>
</div>
<div class="paragraph">
<p><strong>Changing the cipher string</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, create a file in the directory <code class="filename">/usr/share/ovirt-engine/playbooks</code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vim /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</pre>
</div>
</div>
</li>
<li>
<p>Enter the following in the file and save it:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="yaml">name: oVirt - setup weaker SPICE encryption for old clients
hosts: <em>hostname</em>
vars:
  host_deploy_spice_cipher_string: 'DEFAULT:-RC4:-3DES:-DES'
roles:
  - ovirt-host-deploy-spice-encryption</code></pre>
</div>
</div>
</li>
<li>
<p>Run the file you just created:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook -l <em>hostname</em> /usr/share/ovirt-engine/playbooks/change-spice-cipher.yml</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Alternatively, you can reconfigure the host with the Ansible playbook <code>ovirt-host-deploy</code>  using the  <code>--extra-vars</code> option  with the variable <code>host_deploy_spice_cipher_string</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook -l <em>hostname</em> \
  --extra-vars host_deploy_spice_cipher_string=DEFAULT:-RC4:-3DES:-DES \
  /usr/share/ovirt-engine/playbooks/ovirt-host-deploy.yml</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Host_Power_Management_Settings">10.5.18. Configuring Host Power Management Settings</h4>
<div class="paragraph">
<p>Configure your host power management device settings to perform host life-cycle operations (stop, start, restart) from the Administration Portal.</p>
</div>
<div class="paragraph">
<p>You must configure host power management in order to utilize host high availability and virtual machine high availability. For more information about power management devices, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/index#power_management">Power Management</a> in the <em>Technical Reference</em>.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Power Management Settings</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span>, and click <b class="button">OK</b> to confirm.</p>
</li>
<li>
<p>When the host is in maintenance mode, click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Power Management</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Enable Power Management</strong> check box to enable the fields.</p>
</li>
<li>
<p>Select the <strong>Kdump integration</strong> check box to prevent the host from fencing while performing a kernel crash dump.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you enable or disable <strong>Kdump integration</strong> on an existing host, you must <a href="#Reinstalling_Hosts_admin">reinstall the host</a> for kdump to be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, select the <strong>Disable policy control of power management</strong> check box if you do not want your host&#8217;s power management to be controlled by the <strong>Scheduling Policy</strong> of the host&#8217;s <strong>cluster</strong>.</p>
</li>
<li>
<p>Click the plus (<strong>+</strong>) button to add a new power management device. The <strong>Edit fence agent</strong> window opens.</p>
</li>
<li>
<p>Enter the <strong>User Name</strong> and <strong>Password</strong> of the power management device into the appropriate fields.</p>
</li>
<li>
<p>Select the power management device <strong>Type</strong> in the drop-down list.</p>
</li>
<li>
<p>Enter the IP address in the <strong>Address</strong> field.</p>
</li>
<li>
<p>Enter the <strong>SSH Port</strong> number used by the power management device to communicate with the host.</p>
</li>
<li>
<p>Enter the <strong>Slot</strong> number used to identify the blade of the power management device.</p>
</li>
<li>
<p>Enter the <strong>Options</strong> for the power management device. Use a comma-separated list of <em>'key=value'</em> entries.</p>
<div class="ulist">
<ul>
<li>
<p>If both IPv4 and IPv6 IP addresses can be used (default), leave the <strong>Options</strong> field blank.</p>
</li>
<li>
<p>If only IPv4 IP addresses can be used, enter <code>inet4_only=1</code>.</p>
</li>
<li>
<p>If only IPv6 IP addresses can be used, enter <code>inet6_only=1</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the <strong>Secure</strong> check box to enable the power management device to connect securely to the host.</p>
</li>
<li>
<p>Click <strong>Test</strong> to ensure the settings are correct. <strong>Test Succeeded, Host Status is: on</strong> will display upon successful verification.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to close the <strong>Edit fence agent</strong> window.</p>
</li>
<li>
<p>In the <strong>Power Management</strong> tab, optionally expand the <strong>Advanced Parameters</strong> and use the up and down buttons to specify the order in which the Engine will search the host&#8217;s <strong>cluster</strong> and <strong>dc</strong> (datacenter) for a fencing proxy.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>For IPv6, oVirt supports only static addressing.</p>
</li>
<li>
<p>Dual-stack <strong>IPv4 and IPv6</strong> addressing is not supported.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Power Management</b></span> drop-down menu is now enabled in the Administration Portal.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_Host_SPM_Settings">10.5.19. Configuring Host Storage Pool Manager Settings</h4>
<div class="paragraph">
<p>The Storage Pool Manager (SPM) is a management role given to one of the hosts in a data center to maintain access control over the storage domains. The SPM must always be available, and the SPM role will be assigned to another host if the SPM host becomes unavailable. As the SPM role uses some of the host&#8217;s available resources, it is important to prioritize hosts that can afford the resources.</p>
</div>
<div class="paragraph">
<p>The Storage Pool Manager (SPM) priority setting of a host alters the likelihood of the host being assigned the SPM role: a host with high SPM priority will be assigned the SPM role before a host with low SPM priority.</p>
</div>
<div class="paragraph">
<p><strong>Configuring SPM settings</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>SPM</strong> tab.</p>
</li>
<li>
<p>Use the radio buttons to select the appropriate SPM priority for the host.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="migrating_she_host_to_different_cluster_host_tasks">10.5.20. Migrating a self-hosted engine host to a different cluster</h4>
<div class="paragraph">
<p>You cannot migrate a host that is configured as a self-hosted engine host to a data center or cluster other than the one in which the self-hosted engine virtual machine is running. All self-hosted engine hosts must be in the same data center and cluster.</p>
</div>
<div class="paragraph">
<p>You need to disable the host from being a self-hosted engine host by undeploying the self-hosted engine configuration from the host.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span>. The host&#8217;s status changes to <strong>Maintenance</strong>.</p>
</li>
<li>
<p>Under <strong>Reinstall</strong>, select <strong>Hosted Engine UNDEPLOY</strong>.</p>
</li>
<li>
<p>Click <strong>Reinstall</strong>.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alternatively, you can use the REST API <code>undeploy_hosted_engine</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the target data center and cluster.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Moving_a_host_to_maintenance_mode">Moving a Host to Maintenance mode</a></p>
</li>
<li>
<p><a href="#Activating_a_host_from_maintenance_mode">Activating a Host from Maintenance Mode</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="explanation-of-settings-and-controls-in-the-new-host-and-edit-host-windows">10.6. Explanation of Settings and Controls in the New Host and Edit Host Windows</h3>
<div class="sect3">
<h4 id="Host_General_Settings">10.6.1. Host General Settings Explained</h4>
<div class="paragraph">
<p>These settings apply when editing the details of a host or adding new Enterprise Linux hosts and Satellite host provider hosts.</p>
</div>
<div class="paragraph">
<p>The <strong>General</strong> settings table contains the information required on the <strong>General</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. <strong>General</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Host Cluster</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The cluster and data center to which the host belongs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Use Foreman/Satellite</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select or clear this check box to view or hide options for adding hosts provided by Satellite host providers. The following options are also available:</p>
</div>
<div class="paragraph">
<p><strong>Discovered Hosts</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Discovered Hosts</strong> - A drop-down list that is populated with the name of Satellite hosts discovered by the engine.</p>
</li>
<li>
<p><strong>Host Groups</strong> -A drop-down list of host groups available.</p>
</li>
<li>
<p><strong>Compute Resources</strong> - A drop-down list of hypervisors to provide compute resources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Provisioned Hosts</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Providers Hosts</strong> - A drop-down list that is populated with the name of hosts provided by the selected external provider. The entries in this list are filtered in accordance with any search queries that have been input in the <strong>Provider search filter</strong>.</p>
</li>
<li>
<p><strong>Provider search filter</strong> - A text field that allows you to search for hosts provided by the selected external provider. This option is provider-specific; see provider documentation for details on forming search queries for specific providers. Leave this field blank to view all available hosts.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The name of the host. This text field has a 40-character limit and must be a unique name with any combination of uppercase and lowercase letters, numbers, hyphens, and underscores.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comment</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A field for adding plain text, human-readable comments regarding the host.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hostname</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The IP address or resolvable host name of the host. If a resolvable hostname is used, you must ensure that all addresses that the hostname is resolved to match the IP addresses, IPv4 and IPv6, used by the management network of the host.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The password of the host&#8217;s root user. Set the password when adding the host. The password cannot be edited afterwards.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Activate host after install</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select this checkbox to activate the host after successful installation. This is enabled by default and required for the hypervisors to be activated successfully.</p>
</div>
<div class="paragraph">
<p>After successful installation, you can clear this checkbox to switch the host status to Maintenance. This allows the administrator to perform additional configuration tasks on the hypervisors.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Reboot host after install</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select this checkbox to reboot the host after it is installed. This is enabled by default.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changing the kernel command line parameters of the host, or changing the firewall type of the cluster also require you to reboot the host.</p>
</div>
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SSH Public Key</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Copy the contents in the text box to the <strong>/root/.ssh/authorized_hosts</strong> file on the host to use the Engine&#8217;s SSH key instead of a password to authenticate with a host.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Automatically configure host firewall</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When adding a new host, the Engine can open the required ports on the host&#8217;s firewall. This is enabled by default. This is an <strong>Advanced Parameter</strong>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SSH Fingerprint</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>You can <strong>fetch</strong> the host&#8217;s SSH fingerprint, and compare it with the fingerprint you expect the host to return, ensuring that they match. This is an <strong>Advanced Parameter</strong>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Host_Power_Management_settings_explained">10.6.2. Host Power Management Settings Explained</h4>
<div class="paragraph">
<p>The <strong>Power Management</strong> settings table contains the information required on the <strong>Power Management</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> windows. You can configure power management if the host has a supported power management card.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. <strong>Power Management</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Power Management</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables power management on the host. Select this check box to enable the rest of the fields in the <strong>Power Management</strong> tab.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kdump integration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prevents the host from fencing while performing a kernel crash dump, so that the crash dump is not interrupted. In Enterprise Linux 7.1 and later, kdump is available by default. If kdump is available on the host, but its configuration is not valid (the kdump service cannot be started), enabling <strong>Kdump integration</strong> will cause the host (re)installation to fail. If this is the case, see <a href="#sect-fence_kdump_Advanced_Configuration">fence_kdump Advanced Configuration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disable policy control of power management</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management is controlled by the <strong>Scheduling Policy</strong> of the host&#8217;s <strong>cluster</strong>. If power management is enabled and the defined low utilization value is reached, the Engine will power down the host machine, and restart it again when load balancing requires or there are not enough free hosts in the cluster. Select this check box to disable policy control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Agents by Sequential Order</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lists the host&#8217;s fence agents. Fence agents can be sequential, concurrent, or a mix of both.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If fence agents are used sequentially, the primary agent is used first to stop or start a host, and if it fails, the secondary agent is used.</p>
</li>
<li>
<p>If fence agents are used concurrently, both fence agents have to respond to the Stop command for the host to be stopped; if one agent responds to the Start command, the host will go up.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Fence agents are sequential by default. Use the up and down buttons to change the sequence in which the fence agents are used.</p>
</div>
<div class="paragraph">
<p>To make two fence agents concurrent, select one fence agent from the <strong>Concurrent with</strong> drop-down list next to the other fence agent. Additional fence agents can be added to the group of concurrent fence agents by selecting the group from the <strong>Concurrent with</strong> drop-down list next to the additional fence agent.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Add Fence Agent</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Click the <strong>+</strong> button to add a new fence agent. The <strong>Edit fence agent</strong> window opens. See the table below for more information on the fields in this window.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Power Management Proxy Preference</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, specifies that the Engine will search for a fencing proxy within the same <strong>cluster</strong> as the host, and if no fencing proxy is found, the Engine will search in the same <strong>dc</strong> (data center). Use the up and down buttons to change the sequence in which these resources are used. This field is available under <strong>Advanced Parameters</strong>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table contains the information required in the <strong>Edit fence agent</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. <strong>Edit fence agent</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Address</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The address to access your host&#8217;s power management device. Either a resolvable hostname or an IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>User Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User account with which to access the power management device. You can set up a user on the device, or use the default user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Password</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for the user accessing the power management device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The type of power management device in your host. Choose one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>apc</strong> - APC MasterSwitch network power switch. Not for use with APC 5.x power switch devices.</p>
</li>
<li>
<p><strong>apc_snmp</strong> - Use with APC 5.x power switch devices.</p>
</li>
<li>
<p><strong>bladecenter</strong> - IBM Bladecenter Remote Supervisor Adapter.</p>
</li>
<li>
<p><strong>cisco_ucs</strong> - Cisco Unified Computing System.</p>
</li>
<li>
<p><strong>drac5</strong> - Dell Remote Access Controller for Dell computers.</p>
</li>
<li>
<p><strong>drac7</strong> - Dell Remote Access Controller for Dell computers.</p>
</li>
<li>
<p><strong>eps</strong> - ePowerSwitch 8M+ network power switch.</p>
</li>
<li>
<p><strong>hpblade</strong> - HP BladeSystem.</p>
</li>
<li>
<p><strong>ilo</strong>, <strong>ilo2</strong>, <strong>ilo3</strong>, <strong>ilo4</strong> - HP Integrated Lights-Out.</p>
</li>
<li>
<p><strong>ipmilan</strong> - Intelligent Platform Management Interface and Sun Integrated Lights Out Management devices.</p>
</li>
<li>
<p><strong>rsa</strong> - IBM Remote Supervisor Adapter.</p>
</li>
<li>
<p><strong>rsb</strong> - Fujitsu-Siemens RSB management interface.</p>
</li>
<li>
<p><strong>wti</strong> - WTI Network Power Switch.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about power management devices, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/technical_reference/index#power_management">Power Management</a> in the <em>Technical Reference</em>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number used by the power management device to communicate with the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Slot</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number used to identify the blade of the power management device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Service Profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The service profile name used to identify the blade of the power management device. This field appears instead of <strong>Slot</strong> when the device type is <code>cisco_ucs</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Options</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Power management device specific options. Enter these as 'key=value'. See the documentation of your host&#8217;s power management device for the options available.</p>
<p class="tableblock">For Enterprise Linux 7 hosts, if you are using cisco_ucs as the power management device, you also need to append <code>ssl_insecure=1</code> to the <strong>Options</strong> field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Secure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this check box to allow the power management device to connect securely to the host. This can be done via ssh, ssl, or other authentication protocols depending on the power management agent.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="SPM_priority_settings_explained">10.6.3. SPM Priority Settings Explained</h4>
<div class="paragraph">
<p>The <strong>SPM</strong> settings table details the information required on the <strong>SPM</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. <strong>SPM</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SPM Priority</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the likelihood that the host will be given the role of Storage Pool Manager (SPM). The options are <strong>Low</strong>, <strong>Normal</strong>, and <strong>High</strong> priority. Low priority means that there is a reduced likelihood of the host being assigned the role of SPM, and High priority means there is an increased likelihood. The default setting is Normal.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Host_Console_Settings_Explained">10.6.4. Host Console Settings Explained</h4>
<div class="paragraph">
<p>The <strong>Console</strong> settings table details the information required on the <strong>Console</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. <strong>Console</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Override display address</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this check box to override the display addresses of the host. This feature is useful in a case where the hosts are defined by internal IP and are behind a NAT firewall. When a user connects to a virtual machine from outside of the internal network, instead of returning the private address of the host on which the virtual machine is running, the machine returns a public IP or FQDN (which is resolved in the external network to the public IP).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Display address</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The display address specified here will be used for all virtual machines running on this host. The address must be in the format of a fully qualified domain name or IP.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Network_Provider_Settings_Explained">10.6.5. Network Provider Settings Explained</h4>
<div class="paragraph">
<p>The <strong>Network Provider</strong> settings table details the information required on the <strong>Network Provider</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. <strong>Network Provider</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>External Network Provider</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have added an external network provider and want the host&#8217;s network to be provisioned by the external network provider, select one from the list.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Kernel_Settings_Explained">10.6.6. Kernel Settings Explained</h4>
<div class="paragraph">
<p>The <strong>Kernel</strong> settings table details the information required on the <strong>Kernel</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window. Common kernel boot parameter options are listed as check boxes so you can easily select them.</p>
</div>
<div class="paragraph">
<p>For more complex changes, use the free text entry field next to <strong>Kernel command line</strong> to add in any additional parameters required. If you change any kernel command line parameters, you must  <a href="#Reinstalling_Hosts_admin">reinstall the host</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the host is attached to the Engine, you must place the host into maintenance mode before making changes. After making the changes, <a href="#Reinstalling_Hosts_admin">reinstall the host</a> to apply the changes.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. <strong>Kernel</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hostdev Passthrough &amp; SR-IOV</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the IOMMU flag in the kernel so a virtual machine can use a host device as if it is attached directly to the virtual machine. The host hardware and firmware must also support IOMMU. The virtualization extension and IOMMU extension must be enabled on the hardware. See <a href="#Configuring_a_Host_for_PCI_Passthrough_host_tasks">Configuring a Host for PCI Passthrough</a>. IBM POWER8 has IOMMU enabled by default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Nested Virtualization</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables the <code>vmx</code> or <code>svm</code> flag so virtual machines can run within virtual machines. This option is a Technology Preview feature: It is intended only for evaluation purposes. It is not supported for production purposes. To use this setting, you must install the <code>vdsm-hook-nestedvt</code> hook on the host. For details, see <a href="#proc-enabling-nested-virtualization-for-all-virtual-machines">Enabling nested virtualization for all virtual machines</a> and <a href="#proc-enabling-nested-virtualization-for-individual-virtual-machines">Enabling nested virtualization for individual virtual machines</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Unsafe Interrupts</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If IOMMU is enabled but the passthrough fails because the hardware does not support interrupt remapping, you can consider enabling this option. Note that you should only enable this option if the virtual machines on the host are trusted; having the option enabled potentially exposes the host to MSI attacks from the virtual machines. This option is only intended to be used as a workaround when using uncertified hardware for evaluation purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCI Reallocation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If your SR-IOV NIC is unable to allocate virtual functions because of memory issues, consider enabling this option. The host hardware and firmware must also support PCI reallocation. This option is only intended to be used as a workaround when using uncertified hardware for evaluation purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Blacklist Nouveau</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blocks the nouveau driver. Nouveau is a community driver for NVIDIA GPUs that conflicts with vendor-supplied drivers. The nouveau driver should be blocked when vendor drivers take precedence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SMT Disabled</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables Simultaneous Multi Threading (SMT). Disabling SMT can mitigate security vulnerabilities, such as L1TF or MDS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Kernel command line</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field allows you to append more kernel parameters to the default parameters.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the kernel boot parameters are grayed out, click the <strong>reset</strong> button and the options will be available.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Hosted_Engine_Settings_Explained">10.6.7. Hosted Engine Settings Explained</h4>
<div class="paragraph">
<p>The <strong>Hosted Engine</strong> settings table details the information required on the <strong>Hosted Engine</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 55. <strong>Hosted Engine</strong> Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Choose hosted engine deployment action</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Three options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>None</strong> - No actions required.</p>
</li>
<li>
<p><strong>Deploy</strong> - Select this option to deploy the host as a self-hosted engine node.</p>
</li>
<li>
<p><strong>Undeploy</strong> - For a self-hosted engine node, you can select this option to undeploy the host and remove self-hosted engine related configurations.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Host_Resilience">10.7. Host Resilience</h3>
<div class="sect3">
<h4 id="Host_high_availability">10.7.1. Host High Availability</h4>
<div class="paragraph">
<p>The oVirt Engine uses fencing to keep hosts in a cluster responsive. A <strong>Non Responsive</strong> host is different from a <strong>Non Operational</strong> host. <strong>Non Operational</strong> hosts can be communicated with by the Engine, but have an incorrect configuration, for example a missing logical network. <strong>Non Responsive</strong> hosts cannot be communicated with by the Engine.</p>
</div>
<div class="paragraph">
<p>Fencing allows a cluster to react to unexpected host failures and enforce power saving, load balancing, and virtual machine availability policies. You should configure the fencing parameters for your host&#8217;s power management device and test their correctness from time to time. In a fencing operation, a non-responsive host is rebooted, and if the host does not return to an active status within a prescribed time, it remains non-responsive pending manual intervention and troubleshooting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To automatically check the fencing parameters, you can configure the <code>PMHealthCheckEnabled</code> (false by default) and <code>PMHealthCheckIntervalInSec</code> (3600 sec by default) engine-config options.</p>
</div>
<div class="paragraph">
<p>When set to true, <code>PMHealthCheckEnabled</code> will check all host agents at the interval specified by <code>PMHealthCheckIntervalInSec</code>, and raise warnings if it detects issues. See <a href="#Syntax_for_the_engine-config_Command">Syntax for the engine-config Command</a> for more information about configuring engine-config options.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Power management operations can be performed by oVirt Engine after it reboots, by a proxy host, or manually in the Administration Portal. All the virtual machines running on the non-responsive host are stopped, and highly available virtual machines are started on a different host. At least two hosts are required for power management operations.</p>
</div>
<div class="paragraph">
<p>After the Engine starts up, it automatically attempts to fence non-responsive hosts that have power management enabled after the quiet time (5 minutes by default) has elapsed. The quiet time can be configured by updating the <code>DisableFenceAtStartupInSec</code> engine-config option.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>DisableFenceAtStartupInSec</code> engine-config option helps prevent a scenario where the Engine attempts to fence hosts while they boot up. This can occur after a data center outage because a host&#8217;s boot process is normally longer than the Engine boot process.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hosts can be fenced automatically by the proxy host using the power management parameters, or manually by right-clicking on a host and using the options on the menu.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If a host runs virtual machines that are highly available, power management must be enabled and configured.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Power_Management_by_Proxy_in_Red_Hat_Enterprise_Virtualization">10.7.2. Power Management by Proxy in oVirt</h4>
<div class="paragraph">
<p>The oVirt Engine does not communicate directly with fence agents. Instead, the Engine uses a proxy to send power management commands to a host power management device. The Engine uses VDSM to execute power management device actions, so another host in the environment is used as a fencing proxy.</p>
</div>
<div class="paragraph">
<p>You can select between:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any host in the same cluster as the host requiring fencing.</p>
</li>
<li>
<p>Any host in the same data center as the host requiring fencing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A viable fencing proxy host has a status of either <strong>UP</strong> or <strong>Maintenance</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Setting_fencing_parameters_on_a_host">10.7.3. Setting Fencing Parameters on a Host</h4>
<div class="paragraph">
<p>The parameters for host fencing are set using the <strong>Power Management</strong> fields on the <strong>New Host</strong> or <strong>Edit Host</strong> windows. Power management enables the system to fence a troublesome host using an additional interface such as a Remote Access Card (RAC).</p>
</div>
<div class="paragraph">
<p>All power management operations are done using a proxy host, as opposed to directly by the oVirt Engine. At least two hosts are required for power management operations.</p>
</div>
<div class="paragraph">
<p><strong>Setting fencing parameters on a host</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Power Management</strong> tab.</p>
</li>
<li>
<p>Select the <strong>Enable Power Management</strong> check box to enable the fields.</p>
</li>
<li>
<p>Select the <strong>Kdump integration</strong> check box to prevent the host from fencing while performing a kernel crash dump.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you enable or disable <strong>Kdump integration</strong> on an existing host, you must  <a href="#Reinstalling_Hosts_admin">reinstall the host</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, select the <strong>Disable policy control of power management</strong> check box if you do not want your host&#8217;s power management to be controlled by the <strong>Scheduling Policy</strong> of the host&#8217;s cluster.</p>
</li>
<li>
<p>Click the <strong>+</strong> button to add a new power management device. The <strong>Edit fence agent</strong> window opens.</p>
</li>
<li>
<p>Enter the <strong>Address</strong>, <strong>User Name</strong>, and <strong>Password</strong> of the power management device.</p>
</li>
<li>
<p>Select the power management device <strong>Type</strong> from the drop-down list.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on how to set up a custom power management device, see <a href="https://access.redhat.com/articles/1238743" class="bare">https://access.redhat.com/articles/1238743</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the <strong>SSH Port</strong> number used by the power management device to communicate with the host.</p>
</li>
<li>
<p>Enter the <strong>Slot</strong> number used to identify the blade of the power management device.</p>
</li>
<li>
<p>Enter the <strong>Options</strong> for the power management device. Use a comma-separated list of <em>'key=value'</em> entries.</p>
</li>
<li>
<p>Select the <strong>Secure</strong> check box to enable the power management device to connect securely to the host.</p>
</li>
<li>
<p>Click the <strong>Test</strong> button to ensure the settings are correct. <strong>Test Succeeded, Host Status is: on</strong> will display upon successful verification.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Power management parameters (userid, password, options, etc) are tested by oVirt Engine only during setup and manually after that. If you choose to ignore alerts about incorrect parameters, or if the parameters are changed on the power management hardware without the corresponding change in oVirt Engine, fencing is likely to fail when most needed.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b> to close the <strong>Edit fence agent</strong> window.</p>
</li>
<li>
<p>In the <strong>Power Management</strong> tab, optionally expand the <strong>Advanced Parameters</strong> and use the up and down buttons to specify the order in which the Engine will search the host&#8217;s <strong>cluster</strong> and <strong>dc</strong> (datacenter) for a fencing proxy.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You are returned to the list of hosts. Note that the exclamation mark next to the host&#8217;s name has now disappeared, signifying that power management has been successfully configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect-fence_kdump_Advanced_Configuration">10.7.4. fence_kdump Advanced Configuration</h4>
<div class="paragraph">
<p><strong>kdump</strong></p>
</div>
<div class="paragraph">
<p>Click the name of a host to view the status of the kdump service in the <strong>General</strong> tab of the details view:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Enabled</strong>: kdump is configured properly and the kdump service is running.</p>
</li>
<li>
<p><strong>Disabled</strong>: the kdump service is not running (in this case kdump integration will not work properly).</p>
</li>
<li>
<p><strong>Unknown</strong>: happens only for hosts with an earlier VDSM version that does not report kdump status.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on installing and using kdump, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Kernel_Crash_Dump_Guide/index.html">Enterprise Linux 7 Kernel Crash Dump Guide</a>.</p>
</div>
<div class="paragraph">
<p><strong>fence_kdump</strong></p>
</div>
<div class="paragraph">
<p>Enabling <strong>Kdump integration</strong> in the <strong>Power Management</strong> tab of the <strong>New Host</strong> or <strong>Edit Host</strong> window configures a standard fence_kdump setup. If the environment&#8217;s network configuration is simple and the Engine&#8217;s FQDN is resolvable on all hosts, the default fence_kdump settings are sufficient for use.</p>
</div>
<div class="paragraph">
<p>However, there are some cases where advanced configuration of fence_kdump is necessary. Environments with more complex networking may require manual changes to the configuration of the Engine, fence_kdump listener, or both. For example, if the Engine&#8217;s FQDN is not resolvable on all hosts with <strong>Kdump integration</strong> enabled, you can set a proper host name or IP address using <code>engine-config</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">engine-config -s FenceKdumpDestinationAddress=<em>A.B.C.D</em></pre>
</div>
</div>
<div class="paragraph">
<p>The following example cases may also require configuration changes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Engine has two NICs, where one of these is public-facing, and the second is the preferred destination for fence_kdump messages.</p>
</li>
<li>
<p>You need to execute the fence_kdump listener on a different IP or port.</p>
</li>
<li>
<p>You need to set a custom interval for fence_kdump notification messages, to prevent possible packet loss.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Customized fence_kdump detection settings are recommended for advanced users only, as changes to the default configuration are only necessary in more complex networking setups. For configuration options for the fence_kdump listener see <a href="#fence_kdump_listener_Configuration">fence_kdump listener Configuration</a>.
For configuration of kdump on the Engine see <a href="#Configuring_fence_kdump_on_the_Manager">Configuring fence_kdump on the Manager</a>.</p>
</div>
<div class="sect4">
<h5 id="fence_kdump_listener_Configuration">fence_kdump listener Configuration</h5>
<div class="paragraph">
<p>Edit the configuration of the fence_kdump listener. This is only necessary in cases where the default configuration is not sufficient.</p>
</div>
<div class="paragraph">
<p><strong>Manually Configuring the fence_kdump Listener</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new file (for example, <strong>my-fence-kdump.conf</strong>) in <strong>/etc/ovirt-engine/ovirt-fence-kdump-listener.conf.d/</strong>.</p>
</li>
<li>
<p>Enter your customization with the syntax <em>OPTION</em>=<em>value</em> and save the file.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The edited values must also be changed in <code>engine-config</code> as outlined in the fence_kdump Listener Configuration Options table in <a href="#Configuring_fence_kdump_on_the_Manager">Configuring fence_kdump on the Engine</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Restart the fence_kdump listener:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-fence-kdump-listener.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following options can be customized if required:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 56. fence_kdump Listener Configuration Options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTENER_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the IP address to receive fence_kdump messages on.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.0.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must match the value of <code>FenceKdumpDestinationAddress</code> in <code>engine-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LISTENER_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the port to receive fence_kdump messages on.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7410</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must match the value of <code>FenceKdumpDestinationPort</code> in <code>engine-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HEARTBEAT_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the interval in seconds of the listener&#8217;s heartbeat updates.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be half the size or smaller than the value of <code>FenceKdumpListenerTimeout</code> in <code>engine-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SESSION_SYNC_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the interval in seconds to synchronize the listener&#8217;s host kdumping sessions in memory to the database.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be half the size or smaller than the value of <code>KdumpStartedTimeout</code> in <code>engine-config</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REOPEN_DB_CONNECTION_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the interval in seconds to reopen the database connection which was previously unavailable.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KDUMP_FINISHED_TIMEOUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum timeout in seconds after the last received message from kdumping hosts after which the host kdump flow is marked as FINISHED.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be double the size or higher than the value of <code>FenceKdumpMessageInterval</code> in <code>engine-config</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="Configuring_fence_kdump_on_the_Manager">Configuring fence_kdump on the Engine</h5>
<div class="paragraph">
<p>Edit the Engine&#8217;s kdump configuration. This is only necessary in cases where the default configuration is not sufficient. The current configuration values can be found using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g <em>OPTION</em></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Manually Configuring Kdump with engine-config</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit kdump&#8217;s configuration using the <code>engine-config</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s <em>OPTION</em>=<em>value</em></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The edited values must also be changed in the fence_kdump listener configuration file as outlined in the <code>Kdump Configuration Options</code> table. See <a href="#fence_kdump_listener_Configuration">fence_kdump listener Configuration</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>Reinstall all hosts with <strong>Kdump integration</strong> enabled, if required (see the table below).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following options can be configured using <code>engine-config</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Kdump Configuration Options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FenceKdumpDestinationAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the hostname(s) or IP address(es) to send fence_kdump messages to. If empty, the Engine&#8217;s FQDN is used.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty string (Engine FQDN is used)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must match the value of <code>LISTENER_ADDRESS</code> in the fence_kdump listener configuration file, and all hosts with <strong>Kdump integration</strong> enabled must be reinstalled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FenceKdumpDestinationPort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the port to send fence_kdump messages to.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7410</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must match the value of <code>LISTENER_PORT</code> in the fence_kdump listener configuration file, and all hosts with <strong>Kdump integration</strong> enabled must be reinstalled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FenceKdumpMessageInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the interval in seconds between messages sent by fence_kdump.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be half the size or smaller than the value of <code>KDUMP_FINISHED_TIMEOUT</code> in the fence_kdump listener configuration file, and all hosts with <strong>Kdump integration</strong> enabled must be reinstalled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FenceKdumpListenerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum timeout in seconds since the last heartbeat to consider the fence_kdump listener alive.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">90</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be double the size or higher than the value of <code>HEARTBEAT_INTERVAL</code> in the fence_kdump listener configuration file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KdumpStartedTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the maximum timeout in seconds to wait until the first message from the kdumping host is received (to detect that host kdump flow has started).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the value of this parameter is changed, it must be double the size or higher than the value of <code>SESSION_SYNC_INTERVAL</code> in the fence_kdump listener configuration file, and <code>FenceKdumpMessageInterval</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Soft-Fencing_Hosts">10.7.5. Soft-Fencing Hosts</h4>
<div class="paragraph">
<p>Hosts can sometimes become non-responsive due to an unexpected problem, and though VDSM is unable to respond to requests, the virtual machines that depend upon VDSM remain alive and accessible. In these situations, restarting VDSM returns VDSM to a responsive state and resolves this issue.</p>
</div>
<div class="paragraph">
<p>"SSH Soft Fencing" is a process where the Engine attempts to restart VDSM via SSH on non-responsive hosts. If the Engine fails to restart VDSM via SSH, the responsibility for fencing falls to the external fencing agent if an external fencing agent has been configured.</p>
</div>
<div class="paragraph">
<p>Soft-fencing over SSH works as follows. Fencing must be configured and enabled on the host, and a valid proxy host (a second host, in an UP state, in the data center) must exist. When the connection between the Engine and the host times out, the following happens:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the first network failure, the status of the host changes to "connecting".</p>
</li>
<li>
<p>The Engine then makes three attempts to ask VDSM for its status, or it waits for an interval determined by the load on the host. The formula for determining the length of the interval is configured by the configuration values TimeoutToResetVdsInSeconds (the default is 60 seconds) + [DelayResetPerVmInSeconds (the default is 0.5 seconds)]*(the count of running virtual machines on host) + [DelayResetForSpmInSeconds (the default is 20 seconds)] * 1 (if host runs as SPM) or 0 (if the host does not run as SPM). To give VDSM the maximum amount of time to respond, the Engine chooses the longer of the two options mentioned above (three attempts to retrieve the status of VDSM or the interval determined by the above formula).</p>
</li>
<li>
<p>If the host does not respond when that interval has elapsed, <code>vdsm restart</code> is executed via SSH.</p>
</li>
<li>
<p>If <code>vdsm restart</code> does not succeed in re-establishing the connection between the host and the Engine, the status of the host changes to <code>Non Responsive</code> and, if power management is configured, fencing is handed off to the external fencing agent.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Soft-fencing over SSH can be executed on hosts that have no power management configured. This is distinct from "fencing": fencing can be executed only on hosts that have power management configured.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Using_power_host_power_management_functions">10.7.6. Using Host Power Management Functions</h4>
<div class="paragraph">
<p>When power management has been configured for a host, you can access a number of options from the Administration Portal interface. While each power management device has its own customizable options, they all support the basic options to start, stop, and restart a host.</p>
</div>
<div class="paragraph">
<p><strong>Using Host Power Management Functions</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click the <strong>Management</strong> drop-down menu and select one of the following <strong>Power Management</strong> options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Restart</strong>: This option stops the host and waits until the host&#8217;s status changes to <code>Down</code>. When the agent has verified that the host is down, the highly available virtual machines are restarted on another host in the cluster. The agent then restarts this host. When the host is ready for use its status displays as <code>Up</code>.</p>
</li>
<li>
<p><strong>Start</strong>: This option starts the host and lets it join a cluster. When it is ready for use its status displays as <code>Up</code>.</p>
</li>
<li>
<p><strong>Stop</strong>: This option powers off the host. Before using this option, ensure that the virtual machines running on the host have been migrated to other hosts in the cluster. Otherwise the virtual machines will crash and only the highly available virtual machines will be restarted on another host. When the host has been stopped its status displays as <code>Non-Operational</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If Power Management is not enabled, you can restart or stop the host by selecting it, clicking the <strong>Management</strong> drop-down menu, and selecting an <strong>SSH Management</strong> option, <strong>Restart</strong> or <strong>Stop</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When two fencing agents are defined on a host, they can be used concurrently or sequentially. For concurrent agents, both agents have to respond to the Stop command for the host to be stopped; and when one agent responds to the Start command, the host will go up. For sequential agents, to start or stop a host, the primary agent is used first; if it fails, the secondary agent is used.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Manually_fencing_or_isolating_a_nonresponsive_host">10.7.7. Manually Fencing or Isolating a Non-Responsive Host</h4>
<div class="paragraph">
<p>If a host unpredictably goes into a non-responsive state, for example, due to a hardware failure, it can significantly affect the performance of the environment. If you do not have a power management device, or if it is incorrectly configured, you can reboot the host manually.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not select <strong>Confirm 'Host has been Rebooted'</strong> unless you have manually rebooted the host. Using this option while the host is still running can lead to a virtual machine image corruption.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and confirm the host&#8217;s status is <code>Non Responsive</code>.</p>
</li>
<li>
<p>Manually reboot the host. This could mean physically entering the lab and rebooting the host.</p>
</li>
<li>
<p>In the Administration Portal, select the host and click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Confirm 'Host has been Rebooted'</strong>.</p>
</li>
<li>
<p>Select the <strong>Approve Operation</strong> check box and click <b class="button">OK</b>.</p>
</li>
<li>
<p>If your hosts take an unusually long time to boot, you can set <code>ServerRebootTimeout</code> to specify how many seconds to wait before determining that the host is <code>Non Responsive</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set ServerRebootTimeout=<em>integer</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Storage">11. Storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>oVirt uses a centralized storage system for virtual disks, ISO files and snapshots. Storage networking can be implemented using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Network File System (NFS)</p>
</li>
<li>
<p>GlusterFS exports</p>
</li>
<li>
<p>Other POSIX compliant file systems</p>
</li>
<li>
<p>Internet Small Computer System Interface (iSCSI)</p>
</li>
<li>
<p>Local storage attached directly to the virtualization hosts</p>
</li>
<li>
<p>Fibre Channel Protocol (FCP)</p>
</li>
<li>
<p>Parallel NFS (pNFS)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Setting up storage is a prerequisite for a new data center because a data center cannot be initialized unless storage domains are attached and activated.</p>
</div>
<div class="paragraph">
<p>As a oVirt system administrator, you need to create, configure, attach and maintain storage for the virtualized enterprise. You should be familiar with the storage types and their use. Read your storage array vendor&#8217;s guides, and see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/">Enterprise Linux Storage Administration Guide</a> for more information on the concepts, protocols, requirements or general usage of storage.</p>
</div>
<div class="paragraph">
<p>To add storage domains you must be able to successfully access the Administration Portal, and there must be at least one host connected with a status of <strong>Up</strong>.</p>
</div>
<div class="paragraph">
<p>oVirt has three types of storage domains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Domain:</strong> A data domain holds the virtual hard disks and OVF files of all the virtual machines and templates in a data center. In addition, snapshots of the virtual machines are also stored in the data domain.</p>
<div class="paragraph">
<p>The data domain cannot be shared across data centers. Data domains of multiple types (iSCSI, NFS, FC, POSIX, and Gluster) can be added to the same data center, provided they are all shared, rather than local, domains.</p>
</div>
<div class="paragraph">
<p>You must attach a data domain to a data center before you can attach domains of other types to it.</p>
</div>
</li>
<li>
<p><strong>ISO Domain:</strong> ISO domains store ISO files (or logical CDs) used to install and boot operating systems and applications for the virtual machines. An ISO domain removes the data center&#8217;s need for physical media. An ISO domain can be shared across different data centers. ISO domains can only be NFS-based. Only one ISO domain can be added to a data center.</p>
</li>
<li>
<p><strong>Export Domain:</strong> Export domains are temporary storage repositories that are used to copy and move images between data centers and oVirt environments. Export domains can be used to backup virtual machines. An export domain can be moved between data centers, however, it can only be active in one data center at a time. Export domains can only be NFS-based. Only one export domain can be added to a data center.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center. See <a href="#sect-Importing_Existing_Storage_Domains">Importing Existing Storage Domains</a> for information on importing storage domains.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only commence configuring and attaching storage for your oVirt environment once you have determined the storage needs of your data center(s).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="Understanding_Storage">11.1. Understanding Storage Domains</h3>
<div class="paragraph">
<p>A storage domain is a collection of images that have a common storage interface. A storage domain contains complete images of templates and virtual machines (including snapshots), or ISO files. A storage domain can be made of block devices (SAN - iSCSI or FCP) or a file system (NAS - NFS, GlusterFS, or other POSIX compliant file systems).</p>
</div>
<div class="paragraph">
<p>By default, GlusterFS domains and local storage domains support 4K block size. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</p>
</div>
<div class="paragraph">
<p>On NFS, all virtual disks, templates, and snapshots are files.</p>
</div>
<div class="paragraph">
<p>On SAN (iSCSI/FCP), each virtual disk, template or snapshot is a logical volume. Block devices are aggregated into a logical entity called a volume group, and then divided by LVM (Logical Volume Manager) into logical volumes for use as virtual hard disks. See <em>Enterprise Linux Logical Volume Manager Administration Guide</em> for more information on LVM.</p>
</div>
<div class="paragraph">
<p>Virtual disks can have one of two formats, either QCOW2 or raw. The type of storage can be sparse or preallocated. Snapshots are always sparse but can be taken for disks of either format.</p>
</div>
<div class="paragraph">
<p>Virtual machines that share the same storage domain can be migrated between hosts that belong to the same cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Preparing_and_Adding_NFS_Storage">11.2. Preparing and Adding NFS Storage</h3>
<div class="sect3">
<h4 id="Preparing_NFS_Storage_storage_admin">11.2.1. Preparing NFS Storage</h4>
<div class="paragraph">
<p>Set up NFS shares on your file storage or remote server to serve as storage domains on Red Hat Enterprise Virtualization Host systems. After exporting the shares on the remote storage and configuring them in the Red Hat Virtualization Manager, the shares will be automatically imported on the Red Hat Virtualization hosts.</p>
</div>
<div class="paragraph">
<p>For information on setting up, configuring, mounting and exporting NFS, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_file_systems/index"><em>Managing file systems</em></a> for Red Hat Enterprise Linux 8.</p>
</div>
<div class="paragraph">
<p>Specific system user accounts and system user groups are required by oVirt so the Engine can store data in the storage domains represented by the exported directories. The following procedure sets the permissions for one directory. You must repeat the <code>chown</code> and <code>chmod</code> steps for all of the directories you intend to use as storage domains in oVirt.</p>
</div>
<div class="olist arabic">
<div class="title">Prerequisites</div>
<ol class="arabic">
<li>
<p>Install the NFS <code>utils</code> package.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install nfs-utils -y</pre>
</div>
</div>
</li>
<li>
<p>To check the enabled versions:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /proc/fs/nfsd/versions</pre>
</div>
</div>
</li>
<li>
<p>Enable the following services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl enable nfs-server
# systemctl enable rpcbind</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the group <code>kvm</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># groupadd kvm -g 36</pre>
</div>
</div>
</li>
<li>
<p>Create the user <code>vdsm</code> in the group <code>kvm</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># useradd vdsm -u 36 -g kvm</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>storage</code> directory and modify the access rights.</p>
<div class="listingblock">
<div class="content">
<pre># mkdir /storage
# chmod 0755 /storage
# chown 36:36 /storage/</pre>
</div>
</div>
</li>
<li>
<p>Add the <code>storage</code> directory to <code>/etc/exports</code> with the relevant permissions.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/exports
# cat /etc/exports
 /storage *(rw)</pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart rpcbind
# systemctl restart nfs-server</pre>
</div>
</div>
</li>
<li>
<p>To see which export are available for a specific IP address:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># exportfs
 /nfs_server/srv
               10.46.11.3/24
 /nfs_server       &lt;world&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If changes in <code>/etc/exports</code> have been made after starting the services, the <code class="command">exportfs -ra</code> command can be used to reload the changes.
After performing all the above stages, the exports directory should be ready and can be tested on a different host to check that it is usable.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Adding_NFS_Storage_storage_admin">11.2.2. Adding NFS Storage</h4>
<div class="paragraph">
<p>This procedure shows you how to attach existing NFS storage to your oVirt environment as a data domain.</p>
</div>
<div class="paragraph">
<p>If you require an ISO or export domain, use this procedure, but select <strong>ISO</strong> or <strong>Export</strong> from the <strong>Domain Function</strong> list.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the storage domain.</p>
</li>
<li>
<p>Accept the default values for the <strong>Data Center</strong>, <strong>Domain Function</strong>, <strong>Storage Type</strong>, <strong>Format</strong>, and <strong>Host</strong> lists.</p>
</li>
<li>
<p>Enter the <strong>Export Path</strong> to be used for the storage domain. The export path should be in the format of <em>123.123.0.10:/data</em> (for IPv4), <em>[2001:0:0:0:0:0:0:5db1]:/data</em> (for IPv6), or <em>domain.example.com:/data</em>.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new NFS data domain has a status of <code>Locked</code> until the disk is prepared. The data domain is then automatically attached to the data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Increasing_NFS_Storage">11.2.3. Increasing NFS Storage</h4>
<div class="paragraph">
<p>To increase the amount of NFS storage, you can either create a new storage domain and add it to an existing data center, or increase the available free space on the NFS server. For the former option, see <a href="#Adding_NFS_Storage_storage_admin">Adding NFS Storage</a>. The following procedure explains how to increase the available free space on the existing NFS server.</p>
</div>
<div class="paragraph">
<p><strong>Increasing an Existing NFS Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the NFS storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab and click <strong>Maintenance</strong> to place the storage domain into maintenance mode. This unmounts the existing share and makes it possible to resize the storage domain.</p>
</li>
<li>
<p>On the NFS server, resize the storage. For Enterprise Linux 6 systems, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html-single/Storage_Administration_Guide/index.html#s2-disk-storage-parted-resize-part">Enterprise Linux 6 Storage Administration Guide</a>. For Enterprise Linux 7 systems, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Storage_Administration_Guide/index.html#s2-disk-storage-parted-resize-part">Enterprise Linux 7 Storage Administration Guide</a>.</p>
</li>
<li>
<p>In the details view, click the <strong>Data Center</strong> tab and click <strong>Activate</strong> to mount the storage domain.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Preparing_and_Adding_Local_Storage">11.3. Preparing and adding local storage</h3>
<div class="paragraph">
<p>A virtual machine&#8217;s disk that uses a storage device that is physically installed on the virtual machine&#8217;s host is referred to as a local storage device.</p>
</div>
<div class="paragraph">
<p>A storage device must be part of a storage domain. The storage domain type for local storage is referred to as a local storage domain.</p>
</div>
<div class="paragraph">
<p>Configuring a host to use local storage automatically creates, and adds the host to, a new local storage domain, data center and cluster to which no other host can be added. Multiple-host clusters require that all hosts have access to all storage domains, which is not possible with local storage. Virtual machines created in a single-host cluster cannot be migrated, fenced, or scheduled.</p>
</div>
<div class="sect3">
<h4 id="Preparing_Local_Storage_storage_admin">11.3.1. Preparing local storage</h4>
<div class="paragraph">
<p>On oVirt Node (oVirt Node), local storage should always be defined on a file system that is separate from <code>/</code> (root).
Use a separate logical volume or disk, to prevent possible loss of data during upgrades.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure for Enterprise Linux hosts</div>
<ol class="arabic">
<li>
<p>On the host, create the directory to be used for the local storage:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /data/images</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the directory has permissions allowing read/write access to the <strong>vdsm</strong> user (UID 36) and <strong>kvm</strong> group (GID 36):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown 36:36 /data /data/images
# chmod 0755 /data /data/images</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Procedure for oVirt Nodes</div>
<p>Create the local storage on a logical volume:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a local storage directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /data
# lvcreate -L $SIZE rhvh -n data
# mkfs.ext4 /dev/mapper/rhvh-data
# echo "/dev/mapper/rhvh-data /data ext4 defaults,discard 1 2" &gt;&gt; /etc/fstab
# mount /data</pre>
</div>
</div>
</li>
<li>
<p>Mount the new local storage:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the directory has permissions allowing read/write access to the <strong>vdsm</strong> user (UID 36) and <strong>kvm</strong> group (GID 36):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown 36:36 /data /rhvh-data
# chmod 0755 /data /rhvh-data</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Adding_Local_Storage_storage_admin">11.3.2. Adding a local storage domain</h4>
<div class="paragraph">
<p>When adding a local storage domain to a host, setting the path to the local storage directory automatically creates and places the host in a local data center, local cluster, and local storage domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>. The host&#8217;s status changes to <strong>Maintenance</strong>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure Local Storage</b></span>.</p>
</li>
<li>
<p>Click the <strong>Edit</strong> buttons next to the <strong>Data Center</strong>, <strong>Cluster</strong>, and <strong>Storage</strong> fields to configure and name the local storage domain.</p>
</li>
<li>
<p>Set the path to your local storage in the text entry field.</p>
</li>
<li>
<p>If applicable, click the <strong>Optimization</strong> tab to configure the memory optimization policy for the new local storage cluster.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine sets up the local data center with a local cluster, local storage domain. It also changes the host&#8217;s status to <strong>Up</strong>.</p>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Locate the local storage domain you just added.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The domain&#8217;s status should be <strong>Active</strong> (<span class="image"><img src="common/images/status_active_icon.png" alt="status active icon"></span>), and the value in the <strong>Storage Type</strong> column should be <strong>Local on Host</strong>.</p>
</div>
<div class="paragraph">
<p>You can now upload a disk image in the new local storage domain.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Preparing_and_Adding_POSIX_Compliant_File_System_Storage">11.4. Preparing and Adding POSIX-compliant File System Storage</h3>
<div class="sect3">
<h4 id="Preparing_POSIX_Storage_storage_admin">11.4.1. Preparing POSIX-compliant File System Storage</h4>
<div class="paragraph">
<p>POSIX file system support allows you to mount file systems using the same mount options that you would normally use when mounting them manually from the command line. This functionality is intended to allow access to storage not exposed using NFS, iSCSI, or FCP.</p>
</div>
<div class="paragraph">
<p>Any POSIX-compliant file system used as a storage domain in oVirt must be a clustered file system, such as Global File System 2 (GFS2), and must support sparse files and direct I/O. The Common Internet File System (CIFS), for example, does not support direct I/O, making it incompatible with oVirt.</p>
</div>
<div class="paragraph">
<p>For information on setting up and configuring POSIX-compliant file system storage, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Global_File_System_2/index.html"><em>Enterprise Linux Global File System 2</em></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do <strong>not</strong> mount NFS storage by creating a POSIX-compliant file system storage domain. Always create an NFS storage domain instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Adding_POSIX_Storage_storage_admin">11.4.2. Adding POSIX-compliant File System Storage</h4>
<div class="paragraph">
<p>This procedure shows you how to attach existing POSIX-compliant file system storage to your oVirt environment as a data domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> for the storage domain.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> to be associated with the storage domain. The data center selected must be of type <strong>POSIX (POSIX compliant FS)</strong>. Alternatively, select <code>(none)</code>.</p>
</li>
<li>
<p>Select <code>Data</code> from the <strong>Domain Function</strong> drop-down list, and <code>POSIX compliant FS</code> from the <strong>Storage Type</strong> drop-down list.</p>
<div class="paragraph">
<p>If applicable, select the <strong>Format</strong> from the drop-down menu.</p>
</div>
</li>
<li>
<p>Select a host from the <strong>Host</strong> drop-down list.</p>
</li>
<li>
<p>Enter the <strong>Path</strong> to the POSIX file system, as you would normally provide it to the <code>mount</code> command.</p>
</li>
<li>
<p>Enter the <strong>VFS Type</strong>, as you would normally provide it to the <code>mount</code> command using the <code>-t</code> argument. See <code>man mount</code> for a list of valid VFS types.</p>
</li>
<li>
<p>Enter additional <strong>Mount Options</strong>, as you would normally provide them to the <code>mount</code> command using the <code>-o</code> argument. The mount options should be provided in a comma-separated list. See <code>man mount</code> for a list of valid mount options.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value in the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value in the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Preparing_and_Adding_Block_Storage">11.5. Preparing and Adding Block Storage</h3>
<div class="sect3">
<h4 id="Preparing_iSCSI_Storage_storage_admin">11.5.1. Preparing iSCSI Storage</h4>
<div class="paragraph">
<p>oVirt supports iSCSI storage, which is a storage domain created from a volume group made up of LUNs. Volume groups and LUNs cannot be attached to more than one storage domain at a time.</p>
</div>
<div class="paragraph">
<p>For information on setting up and configuring iSCSI storage, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_storage_devices/index#getting-started-with-iscsi_managing-storage-devices">Getting started with iSCSI</a> in <em>Managing storage devices</em> for Red Hat Enterprise Linux 8.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <code>vdsm-tool config-lvm-filter</code> command to create filters for the LVM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</p>
</div>
<div class="paragraph">
<p>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <em>boot_LUN_wwid</em>
        no_path_retry queue
    }</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Adding_iSCSI_Storage_storage_admin">11.5.2. Adding iSCSI Storage</h4>
<div class="paragraph">
<p>This procedure shows you how to attach existing iSCSI storage to your oVirt environment as a data domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> of the new storage domain.</p>
</li>
<li>
<p>Select a <strong>Data Center</strong> from the drop-down list.</p>
</li>
<li>
<p>Select <strong>Data</strong> as the <strong>Domain Function</strong> and <strong>iSCSI</strong> as the <strong>Storage Type</strong>.</p>
</li>
<li>
<p>Select an active host as the <strong>Host</strong>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Communication to the storage domain is from the selected host and not directly from the Engine. Therefore, all hosts must have access to the storage device before the storage domain can be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The Engine can map iSCSI targets to LUNs or LUNs to iSCSI targets. The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when the iSCSI storage type is selected. If the target that you are using to add storage does not appear, you can use target discovery to find it; otherwise proceed to the next step.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Discover Targets</strong> to enable target discovery options. When targets have been discovered and logged in to, the <strong>New Domain</strong> window automatically displays targets with LUNs unused by the environment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LUNs used externally for the environment are also displayed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can use the <strong>Discover Targets</strong> options to add LUNs on many targets or multiple paths to the same LUNs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use the REST API method <code>discoveriscsi</code> to discover the iscsi targets, you can use an FQDN or an IP address, but you must use the iscsi details from the discovered targets results to log in using the REST API method <code>iscsilogin</code>. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-discover_iscsi">discoveriscsi</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the FQDN or IP address of the iSCSI host in the <strong>Address</strong> field.</p>
</li>
<li>
<p>Enter the port with which to connect to the host when browsing for targets in the <strong>Port</strong> field. The default is <code>3260</code>.</p>
</li>
<li>
<p>If CHAP is used to secure the storage, select the <strong>User Authentication</strong> check box. Enter the <strong>CHAP user name</strong> and <strong>CHAP password</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can define credentials for an iSCSI target for a specific host with the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-storage_server_connection_extensions-methods-add">StorageServerConnectionExtensions: add</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Discover</strong>.</p>
</li>
<li>
<p>Select one or more targets from the discovery results and click <strong>Login</strong> for one target or <strong>Login All</strong> for multiple targets.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If more than one path access is required, you must discover and log in to the target through all the required paths. Modifying a storage domain to add additional paths is currently not supported.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the REST API <code>iscsilogin</code> method to log in, you must use the iscsi details from the discovered targets results in the <code>discoveriscsi</code> method. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-host-methods-iscsi_login">iscsilogin</a> in the <em>REST API Guide</em> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click the <strong>+</strong> button next to the desired target. This expands the entry and displays all unused LUNs attached to the target.</p>
</li>
<li>
<p>Select the check box for each LUN that you are using to create the storage domain.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
<li>
<p>Select the <strong>Discard After Delete</strong> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have configured multiple storage connection paths to the same target, follow the procedure in <a href="https://ovirt.org/documentation/administration_guide/index#Configuring_iSCSI_Multipathing">Configuring iSCSI Multipathing</a> to complete iSCSI bonding.</p>
</div>
<div class="paragraph">
<p>If you want to migrate your current storage network to an iSCSI bond, see <a href="https://ovirt.org/documentation/administration_guide/index#Migrating_a_logical_network_to_an_iscsi_bond">Migrating a Logical Network to an iSCSI Bond</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_iSCSI_Multipathing">11.5.3. Configuring iSCSI Multipathing</h4>
<div class="paragraph">
<p>iSCSI multipathing enables you to create and manage groups of logical networks and iSCSI storage connections. Multiple network paths between the hosts and iSCSI storage prevent host downtime caused by network path failure.</p>
</div>
<div class="paragraph">
<p>The Engine connects each host in the data center to each target, using the NICs or VLANs that are assigned to the logical networks in the iSCSI bond.</p>
</div>
<div class="paragraph">
<p>You can create an iSCSI bond with multiple targets and logical networks for redundancy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>One or more <a href="#Adding_iSCSI_Storage_storage_admin">iSCSI targets</a></p>
</li>
<li>
<p>One or more <a href="#Creating_a_new_logical_network_in_a_data_center_or_cluster">logical networks</a> that meet the following requirements:</p>
<div class="ulist">
<ul>
<li>
<p>Not defined as <a href="#Migrating_a_logical_network_to_an_iscsi_bond"><strong>Required</strong> or <strong>VM Network</strong></a></p>
</li>
<li>
<p><a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Assigned to a host interface</a></p>
</li>
<li>
<p><a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Assigned a static IP address</a> in the same VLAN and subnet as the other logical networks in the iSCSI bond</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click the data center name. This opens the details view.</p>
</li>
<li>
<p>In the <strong>iSCSI Multipathing</strong> tab, click <strong>Add</strong>.</p>
</li>
<li>
<p>In the <strong>Add iSCSI Bond</strong> window, enter a <strong>Name</strong> and a <strong>Description</strong>.</p>
</li>
<li>
<p>Select a logical network from <strong>Logical Networks</strong> and a storage domain from <strong>Storage Targets</strong>. You must select all the paths to the same target.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The hosts in the data center are connected to the iSCSI targets through the logical networks in the iSCSI bond.</p>
</div>
</div>
<div class="sect3">
<h4 id="Migrating_a_logical_network_to_an_iscsi_bond">11.5.4. Migrating a Logical Network to an iSCSI Bond</h4>
<div class="paragraph">
<p>If you have a logical network that you created for iSCSI traffic and configured on top of an existing <a href="#sect-Network_Bonding">network bond</a>, you can migrate it to an iSCSI bond on the same subnet without disruption or downtime.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the current logical network so that it is not <strong>Required</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster name. This opens the details view.</p>
</li>
<li>
<p>In the <strong>Logical Networks</strong> tab, select the current logical network (<code>net-1</code>) and click <strong>Manage Networks</strong>.</p>
</li>
<li>
<p>Clear the <strong>Require</strong> check box and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a new logical network that is not <strong>Required</strong> and not <strong>VM network</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Add Network</strong>. This opens the <strong>New Logical Network</strong> window.</p>
</li>
<li>
<p>In the <strong>General</strong> tab, enter the <strong>Name</strong> (<code>net-2</code>) and clear the <strong>VM network</strong> check box.</p>
</li>
<li>
<p>In the <strong>Cluster</strong> tab, clear the <strong>Require</strong> check box and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Remove the current network bond and reassign the logical networks:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click the host name. This opens the details view.</p>
</li>
<li>
<p>In the <strong>Network Interfaces</strong> tab, click <strong>Setup Host Networks</strong>.</p>
</li>
<li>
<p>Drag <code>net-1</code> to the right to unassign it.</p>
</li>
<li>
<p>Drag the current bond to the right to remove it.</p>
</li>
<li>
<p>Drag <code>net-1</code> and <code>net-2</code> to the left to assign them to physical interfaces.</p>
</li>
<li>
<p>Click the pencil icon of <code>net-2</code>. This opens the <strong>Edit Network</strong> window.</p>
</li>
<li>
<p>In the <strong>IPV4</strong> tab, select <strong>Static</strong>.</p>
</li>
<li>
<p>Enter the <strong>IP</strong> and <strong>Netmask/Routing Prefix</strong> of the subnet and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the iSCSI bond:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Click the data center name. This opens the details view.</p>
</li>
<li>
<p>In the <strong>iSCSI Multipathing</strong> tab, click <strong>Add</strong>.</p>
</li>
<li>
<p>In the <strong>Add iSCSI Bond</strong> window, enter a <strong>Name</strong>, select the networks, <code>net-1</code> and <code>net-2</code>, and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your data center has an iSCSI bond containing the old and new logical networks.</p>
</div>
</div>
<div class="sect3">
<h4 id="Preparing_FCP_Storage_storage_admin">11.5.5. Preparing FCP Storage</h4>
<div class="paragraph">
<p>oVirt supports SAN storage by creating a storage domain from a volume group made of pre-existing LUNs. Neither volume groups nor LUNs can be attached to more than one storage domain at a time.</p>
</div>
<div class="paragraph">
<p>oVirt system administrators need a working knowledge of Storage Area Networks (SAN) concepts. SAN usually uses Fibre Channel Protocol (FCP) for traffic between hosts and shared external storage. For this reason, SAN may occasionally be referred to as FCP storage.</p>
</div>
<div class="paragraph">
<p>For information on setting up and configuring FCP or multipathing on Enterprise Linux, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/index.html"><em>Storage Administration Guide</em></a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/DM_Multipath/index.html"><em>DM Multipath Guide</em></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using block storage and intend to deploy virtual machines on raw devices or direct LUNs and manage them with the Logical Volume Manager (LVM), you must create a filter to hide guest logical volumes. This will prevent guest logical volumes from being activated when the host is booted, a situation that could lead to stale logical volumes and cause data corruption. Use the <code>vdsm-tool config-lvm-filter</code> command to create filters for the LVM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt currently does not support block storage with a block size of 4K. You must configure block storage in legacy (512b block) mode.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your host is booting from SAN storage and loses connectivity to the storage, the storage file systems become read-only and remain in this state after connectivity is restored.</p>
</div>
<div class="paragraph">
<p>To prevent this situation, add a drop-in multipath configuration file on the root file system of the SAN for the boot LUN to ensure that it is queued when there is a connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/multipath/conf.d/host.conf
multipaths {
    multipath {
        wwid <em>boot_LUN_wwid</em>
        no_path_retry queue
    }</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Adding_FCP_Storage_storage_admin">11.5.6. Adding FCP Storage</h4>
<div class="paragraph">
<p>This procedure shows you how to attach existing FCP storage to your oVirt environment as a data domain.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>New Domain</strong>.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> of the storage domain.</p>
</li>
<li>
<p>Select an FCP <strong>Data Center</strong> from the drop-down list.</p>
<div class="paragraph">
<p>If you do not yet have an appropriate FCP data center, select <code>(none)</code>.</p>
</div>
</li>
<li>
<p>Select the <strong>Domain Function</strong> and the <strong>Storage Type</strong> from the drop-down lists. The storage domain types that are not compatible with the chosen data center are not available.</p>
</li>
<li>
<p>Select an active host in the <strong>Host</strong> field. If this is not the first data domain in a data center, you must select the data center&#8217;s SPM host.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All communication to the storage domain is through the selected host and not directly from the oVirt Engine. At least one active host must exist in the system and be attached to the chosen data center. All hosts must have access to the storage device before the storage domain can be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>New Domain</strong> window automatically displays known targets with unused LUNs when <strong>Fibre Channel</strong> is selected as the storage type. Select the <strong>LUN ID</strong> check box to select all of the available LUNs.</p>
</li>
<li>
<p>Optionally, you can configure the advanced parameters.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>Enter a percentage value into the <strong>Warning Low Space Indicator</strong> field. If the free space available on the storage domain is below this percentage, warning messages are displayed to the user and logged.</p>
</li>
<li>
<p>Enter a GB value into the <strong>Critical Space Action Blocker</strong> field. If the free space available on the storage domain is below this value, error messages are displayed to the user and logged, and any new action that consumes space, even temporarily, will be blocked.</p>
</li>
<li>
<p>Select the <strong>Wipe After Delete</strong> check box to enable the wipe after delete option. This option can be edited after the domain is created, but doing so will not change the wipe after delete property of disks that already exist.</p>
</li>
<li>
<p>Select the <strong>Discard After Delete</strong> check box to enable the discard after delete option. This option can be edited after the domain is created. This option is only available to block storage domains.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The new FCP data domain remains in a <code>Locked</code> status while it is being prepared for use. When ready, it is automatically attached to the data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Increasing_iSCSI_or_FCP_Storage">11.5.7. Increasing iSCSI or FCP Storage</h4>
<div class="paragraph">
<p>There are several ways to increase iSCSI or FCP storage size:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add an existing LUN to the current storage domain.</p>
</li>
<li>
<p>Create a new storage domain with new LUNs and add it to an existing data center. See <a href="#Adding_iSCSI_Storage_storage_admin">Adding iSCSI Storage</a>.</p>
</li>
<li>
<p>Expand the storage domain by resizing the underlying LUNs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating, configuring, or resizing iSCSI storage on Enterprise Linux 7 systems, see the  <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/Storage_Administration_Guide/index.html#osm-target-setup"><em>Enterprise Linux 7 Storage Administration Guide</em></a>.</p>
</div>
<div class="paragraph">
<p>The following procedure explains how to expand storage area network (SAN) storage by adding a new LUN to an existing storage domain.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The storage domain&#8217;s status must be <code>UP</code>.</p>
</li>
<li>
<p>The LUN must be accessible to all the hosts whose status is <code>UP</code>, or else the operation will fail and the LUN will not be added to the domain. The hosts themselves, however, will not be affected. If a newly added host, or a host that is coming out of maintenance or a <code>Non Operational</code> state, cannot access the LUN, the host&#8217;s state will be <code>Non Operational</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Increasing an Existing iSCSI or FCP Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span> and select an iSCSI or FCP domain.</p>
</li>
<li>
<p>Click <b class="button">Manage Domain</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Targets</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">LUNs</b></span> and click the <strong>Discover Targets</strong> expansion button.</p>
</li>
<li>
<p>Enter the connection information for the storage server and click <b class="button">Discover</b> to initiate the connection.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">LUNs</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Targets</b></span> and select the check box of the newly available LUN.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to add the LUN to the selected storage domain.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This will increase the storage domain by the size of the added LUN.</p>
</div>
<div class="paragraph">
<p>When expanding the storage domain by resizing the underlying LUNs, the LUNs must also be refreshed in the Administration Portal.</p>
</div>
<div class="paragraph">
<p><strong>Refreshing the LUN Size</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span> and select an iSCSI or FCP domain.</p>
</li>
<li>
<p>Click <b class="menuref">Manage Domain</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">LUNs</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Targets</b></span>.</p>
</li>
<li>
<p>In the <strong>Additional Size</strong> column, click <b class="button">Add <em>Additional_Storage_Size</em></b> button of the LUN to refresh.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to refresh the LUN to indicate the new storage size.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Reusing_LUNs">11.5.8. Reusing LUNs</h4>
<div class="paragraph">
<p>LUNs cannot be reused, as is, to create a storage domain or virtual disk. If you try to reuse the LUNs, the Administration Portal displays the following error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Physical device initialization failed. Please check that the device is empty and accessible by the host.</pre>
</div>
</div>
<div class="paragraph">
<p>A self-hosted engine shows the following error during installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ ERROR ] Error creating Volume Group: Failed to initialize physical device: ("[u'/dev/mapper/000000000000000000000000000000000']",)
[ ERROR ] Failed to execute stage 'Misc configuration': Failed to initialize physical device: ("[u'/dev/mapper/000000000000000000000000000000000']",)</pre>
</div>
</div>
<div class="paragraph">
<p>Before the LUN can be reused, the old partitioning table must be cleared.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Procedure</div>
<div class="paragraph">
<p>You must run this procedure on the correct LUN so that you do not inadvertently destroy data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Delete the partition mappings in <em>&lt;LUN_ID&gt;</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">kpartx -dv /dev/mapper/&lt;LUN_ID&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Erase the fileystem or raid signatures in <em>&lt;LUN_ID&gt;</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">wipefs -a /dev/mapper/&lt;LUN_ID&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Inform the operating system about the partition table changes on <em>&lt;LUN_ID&gt;</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"> partprobe</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Removing_stale_LUNs">11.5.9. Removing stale LUNs</h4>
<div class="paragraph">
<p>When a storage domain is removed, stale LUN links can remain on the storage server. This can lead to slow multipath scans, cluttered log files, and LUN ID conflicts.</p>
</div>
<div class="paragraph">
<p>oVirt does not manage the iSCSI servers and, therefore, cannot automatically remove LUNs when a storage domain is removed. The administrator can manually remove stale LUN links with the <code>remove_stale_lun.yml</code> Ansible role. This role removes stale LUN links from all hosts that belong to given data center. For more information about this role and its variables, see the <a href="https://github.com/oVirt/ovirt-ansible-collection/blob/master/roles/remove_stale_lun/README.md">Remove Stale LUN role in the oVirt Ansible collection</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is assumed that you are running <code>remove_stale_lun.yml</code> from the engine machine as the engine ssh key is already added on all the hosts. If the playbook is not running on the engine machine, a user&#8217;s SSH key must be added to all hosts that belong to the data center, or the user must provide an appropriate inventory file.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domains name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <strong>OK</strong>.</p>
</li>
<li>
<p>Click <strong>Detatch</strong>, then click <strong>OK</strong>.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <strong>OK</strong> to remove the storage domain from the source environment.</p>
</li>
<li>
<p>Remove the LUN from the storage server.</p>
</li>
<li>
<p>Remove the stale LUNs from the host using Ansible:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --extra-vars "lun=&lt;LUN&gt;" /usr/share/ansible/collections/ansible_collections/ovirt/ovirt/roles/remove_stale_lun/examples/remove_stale_lun.yml</pre>
</div>
</div>
<div class="paragraph">
<p>where LUN is the LUN removed from the storage server in the steps above.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you remove the stale LUN from the host using Ansible without first removing the LUN from the storage server, the stale LUN will reappear on the host the next time VDSM performs an iSCSI rescan.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Creating_LVM_filter_storage_admin">11.5.10. Creating an LVM filter</h4>
<div class="paragraph">
<p>An LVM filter is a capability that can be set in <code>/etc/lvm/lvm.conf</code> to accept devices into or reject devices from the list of volumes based on a regex query.  For example, to ignore <code>/dev/cdrom</code> you can use <code>filter=["r|^/dev/cdrom$|"]</code>, or add the following parameter to the <code>lvm</code> command: <code>lvs --config 'devices{filter=["r|cdrom|"]}'</code>.</p>
</div>
<div class="paragraph">
<p>This provides a simple way to prevent a host from scanning and activating logical volumes that are not required directly by the host. In particular, the solution addresses logical volumes on shared storage managed by oVirt, and logical volumes created by a guest in oVirt raw volumes. This solution is needed because scanning and activating other logical volumes may cause data corruption, slow boot, or other issues.</p>
</div>
<div class="paragraph">
<p>The solution is to configure an LVM filter on each host, which allows the LVM on a host to scan only the logical volumes that are required by the host.</p>
</div>
<div class="paragraph">
<p>You can use the command <code>vdsm-tool config-lvm-filter</code> to analyze the current LVM configuration and decide if a filter needs to be configured.</p>
</div>
<div class="paragraph">
<p>If the LVM filter has not yet been configured, the command generates an LVM filter option for the host, and adds the option to the LVM configuration.</p>
</div>
<div class="paragraph">
<div class="title">Scenario 1: An Unconfigured Host</div>
<p>On a host yet to be configured, the command automatically configures the LVM once the user confirms the operation:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre># vdsm-tool config-lvm-filter</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Analyzing host...
Found these mounted logical volumes on this host:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_home
mountpoint:      /home
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_root
mountpoint:      /
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_swap
mountpoint:      [SWAP]
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This is the recommended LVM filter for this host:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>filter = [ "a|^/dev/vda2$|", "r|.*|" ]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This filter will allow LVM to access the local devices used by the
hypervisor, but not shared storage owned by VDSM. If you add a new
device to the volume group, you will need to edit the filter manually.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Configure LVM filter? [yes,NO] ? [NO/yes] yes
Configuration completed successfully!</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Please reboot to verify the LVM configuration.</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Scenario 2: A Configured Host</div>
<p>If the host is already configured, the command simply informs the user that the LVM filter is already configured:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre># vdsm-tool config-lvm-filter</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Analyzing host...
LVM filter is already configured for Vdsm</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<div class="title">Scenario 3: Manual Configuration Required</div>
<p>If the host configuration does not match the configuration required by VDSM, the LVM filter will need to be configured manually:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="literalblock">
<div class="content">
<pre># vdsm-tool config-lvm-filter</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Analyzing host...
Found these mounted logical volumes on this host:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_home
mountpoint:      /home
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_root
mountpoint:      /
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>logical volume:  /dev/mapper/vg0-lv_swap
mountpoint:      [SWAP]
devices:         /dev/vda2</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This is the recommended LVM filter for this host:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>filter = [ "a|^/dev/vda2$|", "r|.*|" ]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This filter will allow LVM to access the local devices used by the
hypervisor, but not shared storage owned by VDSM. If you add a new
device to the volume group, you will need to edit the filter manually.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This is the current LVM filter:</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>filter = [ "a|^/dev/vda2$|", "a|^/dev/vdb1$|", "r|.*|" ]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>WARNING: The current LVM filter does not match the recommended filter,
Vdsm cannot configure the filter automatically.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Please edit /etc/lvm/lvm.conf and set the 'filter' option in the  'devices' section to the recommended value.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>It is recommended to reboot after changing LVM filter.</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Red_Hat_Gluster_Storage">11.6. Preparing and Adding Gluster Storage</h3>
<div class="sect3">
<h4 id="Preparing_Red_Hat_Gluster_Storage_storage_admin">11.6.1. Preparing Gluster Storage</h4>
<div class="paragraph">
<p>For information on setting up and configuring Gluster Storage, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.5/html/installation_guide/"><em>Gluster Storage Installation Guide</em></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_Red_Hat_Gluster_Storage_storage_admin">11.6.2. Adding Gluster Storage</h4>
<div class="paragraph">
<p>To use Gluster Storage with oVirt, see <a href="https://access.redhat.com/documentation/en-us/red_hat_gluster_storage/3.4/html/configuring_red_hat_virtualization_with_red_hat_gluster_storage/"><em>Configuring oVirt with Gluster Storage</em></a>.</p>
</div>
<div class="paragraph">
<p>For the Gluster Storage versions that are supported with oVirt, see <a href="https://access.redhat.com/articles/2356261" class="bare">https://access.redhat.com/articles/2356261</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Importing_Existing_Storage_Domains">11.7. Importing Existing Storage Domains</h3>
<div class="sect3">
<h4 id="Overview_of_Importing_Existing_Storage_Domains">11.7.1. Overview of Importing Existing Storage Domains</h4>
<div class="paragraph">
<p>Aside from adding new storage domains, which contain no data, you can import existing storage domains and access the data they contain. By importing storage domains, you can recover data in the event of a failure in the Manager database, and migrate data from one data center or environment to another.</p>
</div>
<div class="paragraph">
<p>The following is an overview of importing each storage domain type:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Data</strong></dt>
<dd>
<p>Importing an existing data storage domain allows you to access all of the virtual machines and templates that the data storage domain contains. After you import the storage domain, you must manually import virtual machines, floating disk images, and templates into the destination data center. The process for importing the virtual machines and templates that a data storage domain contains is similar to that for an export storage domain. However, because data storage domains contain all the virtual machines and templates in a given data center, importing data storage domains is recommended for data recovery or large-scale migration of virtual machines between data centers or environments.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can import existing data storage domains that were attached to data centers with the correct supported compatibility level. See <a href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</a> for more information.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><strong>ISO</strong></dt>
<dd>
<p>Importing an existing ISO storage domain allows you to access all of the ISO files and virtual diskettes that the ISO storage domain contains. No additional action is required after importing the storage domain to access these resources; you can attach them to virtual machines as required.</p>
</dd>
<dt class="hdlist1"><strong>Export</strong></dt>
<dd>
<p>Importing an existing export storage domain allows you to access all of the virtual machine images and templates that the export storage domain contains. Because export domains are designed for exporting and importing virtual machine images and templates, importing export storage domains is recommended method of migrating small numbers of virtual machines and templates inside an environment or between environments. For information on exporting and importing virtual machines and templates to and from export storage domains, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Exporting_and_Importing_Virtual_Machines_and_Templates">Exporting and Importing Virtual Machines and Templates</a> in the <em>Virtual Machine Management Guide</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The export storage domain is deprecated. Storage data domains can be unattached from a data center and imported to another data center in the same environment, or in a different environment. Virtual machines, floating virtual disks, and templates can then be uploaded from the imported storage domain to the attached data center.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Importing_storage_domains">11.7.2. Importing storage domains</h4>
<div class="paragraph">
<p>Import a storage domain that was previously attached to a data center in the same environment or in a different environment. This procedure assumes the storage domain is no longer attached to any data center in any environment, to avoid data corruption. To import and attach an existing data storage domain to a data center, the target data center must be initialized.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>Import Domain</strong>.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> you want to import the storage domain to.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the storage domain.</p>
</li>
<li>
<p>Select the <strong>Domain Function</strong> and <strong>Storage Type</strong> from the drop-down lists.</p>
</li>
<li>
<p>Select a host from the <strong>Host</strong> drop-down list.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All communication to the storage domain is through the selected host and not directly from the oVirt Engine. At least one active host must exist in the system and be attached to the chosen data center. All hosts must have access to the storage device before the storage domain can be configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the details of the storage domain.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The fields for specifying the details of the storage domain change depending on the values you select in the <strong>Domain Function</strong> and <strong>Storage Type</strong> lists. These fields are the same as those available for adding a new storage domain.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the <strong>Activate Domain in Data Center</strong> check box to activate the storage domain after attaching it to the selected data center.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now import virtual machines and templates from the storage domain to the data center.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Related information</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_Data_Domain">Importing Virtual Machines from a Data Domain</a></p>
</li>
<li>
<p><a href="#Importing_Templates_from_Imported_Data_Storage_Domains">Importing Templates from Imported Data Storage Domains</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Migrating_SD_between_DC_Same_Env">11.7.3. Migrating Storage Domains between Data Centers in the Same Environment</h4>
<div class="paragraph">
<p>Migrate a storage domain from one data center to another in the same oVirt environment to allow the destination data center to access the data contained in the storage domain. This procedure involves detaching the storage domain from one data center, and attaching it to a different data center.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Migrating a data storage domain to a data center that has a higher compatibility level than the original data center upgrades the storage domains storage format version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to move the storage domain back to the original data center for any reason, such as to migrate virtual machines to the new data center, be aware that the higher version prevents reattaching the data storage domain to the original data center.</p>
</div>
<div class="paragraph">
<p>The Administration Portal prompts you to confirm that you want to update the storage domain format, for example, from <strong>V3</strong> to <strong>V5</strong>. It also warns that you will not be able to attach it back to an older data center with a lower DC level.</p>
</div>
<div class="paragraph">
<p>To work around this issue, you can create a target data center that has the same compatibility version as the source data center. When you no longer need to maintain the lower compatibility version, you can increase the target data centers compatibility version.</p>
</div>
<div class="paragraph">
<p>For details, see <a href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Shut down all virtual machines running on the required storage domain.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Detach</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Attach</strong>.</p>
</li>
<li>
<p>Select the destination data center and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is attached to the destination data center and is automatically activated. You can now import virtual machines and templates from the storage domain to the destination data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Migrating_SD_between_DC_different_env">11.7.4. Migrating Storage Domains between Data Centers in Different Environments</h4>
<div class="paragraph">
<p>Migrate a storage domain from one oVirt environment to another
to allow the destination environment to access the data contained in the storage domain.
This procedure involves removing the storage domain from one oVirt environment,
and importing it into a different environment.
To import and attach an existing data storage domain to a oVirt data center,
the storage domain&#8217;s source data center must have the correct supported compatibility level.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Migrating a data storage domain to a data center that has a higher compatibility level than the original data center upgrades the storage domains storage format version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to move the storage domain back to the original data center for any reason, such as to migrate virtual machines to the new data center, be aware that the higher version prevents reattaching the data storage domain to the original data center.</p>
</div>
<div class="paragraph">
<p>The Administration Portal prompts you to confirm that you want to update the storage domain format, for example, from <strong>V3</strong> to <strong>V5</strong>. It also warns that you will not be able to attach it back to an older data center with a lower DC level.</p>
</div>
<div class="paragraph">
<p>To work around this issue, you can create a target data center that has the same compatibility version as the source data center. When you no longer need to maintain the lower compatibility version, you can increase the target data centers compatibility version.</p>
</div>
<div class="paragraph">
<p>For details, see <a href="https://access.redhat.com/solutions/4303801">Supportability and constraints regarding importing Storage Domains and Virtual Machines from older RHV versions</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Administration Portal of the source environment.</p>
</li>
<li>
<p>Shut down all virtual machines running on the required storage domain.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Detach</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>In the <strong>Remove Storage(s)</strong> window, ensure the <strong>Format Domain, i.e. Storage Content will be lost!</strong> check box is not selected. This step preserves the data in the storage domain for later use.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to remove the storage domain from the source environment.</p>
</li>
<li>
<p>Log in to the Administration Portal of the destination environment.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click <strong>Import Domain</strong>.</p>
</li>
<li>
<p>Select the destination data center from the <strong>Data Center</strong> drop-down list.</p>
</li>
<li>
<p>Enter a name for the storage domain.</p>
</li>
<li>
<p>Select the <strong>Domain Function</strong> and <strong>Storage Type</strong> from the appropriate drop-down lists.</p>
</li>
<li>
<p>Select a host from the <strong>Host</strong> drop-down list.</p>
</li>
<li>
<p>Enter the details of the storage domain.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The fields for specifying the details of the storage domain change depending on the value you select in the <strong>Storage Type</strong> drop-down list. These fields are the same as those available for adding a new storage domain.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the <strong>Activate Domain in Data Center</strong> check box to automatically activate the storage domain when it is attached.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is attached to the destination data center in the new oVirt environment and is automatically activated. You can now import virtual machines and templates from the imported storage domain to the destination data center.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Upon attaching a Storage Domain to the destination Data-Center,
it may be upgraded to a newer Storage Domain format and may not re-attach to the source Data-Center.
This breaks the use of a Data-Domain as a replacement for Export Domains.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Importing_Templates_from_Imported_Data_Storage_Domains">11.7.5. Importing Templates from Imported Data Storage Domains</h4>
<div class="paragraph">
<p>Import a template from a data storage domain you have imported into your oVirt environment. This procedure assumes that the imported data storage domain has been attached to a data center and has been activated.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the imported storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Template Import</strong> tab.</p>
</li>
<li>
<p>Select one or more templates to import.</p>
</li>
<li>
<p>Click <strong>Import</strong>.</p>
</li>
<li>
<p>For each template in the <strong>Import Templates(s)</strong> window, ensure the correct target cluster is selected in the <strong>Cluster</strong> list.</p>
</li>
<li>
<p>Map external virtual machine vNIC profiles to profiles that are present on the target cluster(s):</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>vNic Profiles Mapping</strong>.</p>
</li>
<li>
<p>Select the vNIC profile to use from the <strong>Target vNic Profile</strong> drop-down list.</p>
</li>
<li>
<p>If multiple target clusters are selected in the <strong>Import Templates</strong> window, select each target cluster in the <strong>Target Cluster</strong> drop-down list and ensure the mappings are correct.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The imported templates no longer appear in the list under the <strong>Template Import</strong> tab.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Storage_Tasks">11.8. Storage Tasks</h3>
<div class="sect3">
<h4 id="Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">11.8.1. Uploading Images to a Data Storage Domain</h4>
<div class="paragraph">
<p>You can upload virtual disk images and ISO images to your data storage domain in the Administration Portal or with the REST API.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To upload images with the REST API, see <a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers">IMAGETRANSFERS</a> and <a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfer">IMAGETRANSFER</a> in the <em>REST API Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>QEMU-compatible virtual disks can be attached to virtual machines. Virtual disk types must be either QCOW2 or raw. Disks created from a QCOW2 virtual disk cannot be shareable, and the QCOW2 virtual disk file must not have a backing file.</p>
</div>
<div class="paragraph">
<p>ISO images can be attached to virtual machines as CDROMs or used to boot virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="paragraph">
<p>The upload function uses HTML 5 APIs, which requires your environment to have the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certificate authority, imported into the web browser used to access the Administration Portal.</p>
<div class="paragraph">
<p>To import the certificate authority, browse to <code>https://<em>engine_address</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code> and enable all the trust settings. Refer to the instructions to install the certificate authority in <a href="https://access.redhat.com/solutions/95103">Firefox</a>, <a href="https://access.redhat.com/solutions/17864">Internet Explorer</a>, or <a href="https://access.redhat.com/solutions/1168383">Google Chrome</a>.</p>
</div>
</li>
<li>
<p>Browser that supports HTML 5, such as Firefox 35, Internet Explorer 10, Chrome 13, or later.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Uploading an Image to a Data Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span>.</p>
</li>
<li>
<p>Select <strong>Start</strong> from the <strong>Upload</strong> menu.</p>
</li>
<li>
<p>Click <strong>Choose File</strong> and select the image to upload.</p>
</li>
<li>
<p>Fill in the <strong>Disk Options</strong> fields. See <a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">Explanation of settings in the New Virtual Disk window</a> for descriptions of the relevant fields.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>A progress bar indicates the status of the upload. You can pause, cancel, or resume uploads from the <strong>Upload</strong> menu.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Increasing the Upload Timeout Value</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the upload times out and you see the message, <strong>Reason: timeout due to transfer inactivity</strong>, increase the timeout value:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s TransferImageClientInactivityTimeoutInSeconds=6000</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</a> in <em>Installing Red Hat Virtualization as a self-hosted engine using the command line</em>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</a> in <em>Installing Red Hat Virtualization as a standalone Manager with local databases</em>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_remote_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</a> in <em>Installing Red Hat Virtualization as a standalone Manager with remote databases</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Copy_ISO_to_ISO_domain-storage_tasks">11.8.2. Uploading images to an ISO domain</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The ISO domain is a deprecated storage domain type. The ISO Uploader tool, <code>ovirt-iso-uploader</code>, is removed in oVirt 4.4. You should upload ISO images to the data domain with the Administration Portal or with the REST API. See <a href="#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> for details.</p>
</div>
<div class="paragraph">
<p>Although the ISO domain is deprecated, this information is provided in case you must use an ISO domain.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To upload an ISO image to an ISO storage domain in order to make it available from within the Engine, follow these steps.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Login as root to the host that belongs to the Data Center where your ISO storage domain resides.</p>
</li>
<li>
<p>Get a directory tree of <code>/rhv/data-center</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># tree /rhev/data-center
.
|-- 80dfacc7-52dd-4d75-ab82-4f9b8423dc8b
|   |-- 76d1ecba-b61d-45a4-8eb5-89ab710a6275 &#8594; /rhev/data-center/mnt/10.10.10.10:_rhevnfssd/76d1ecba-b61d-45a4-8eb5-89ab710a6275
|   |-- b835cd1c-111c-468d-ba70-fec5346af227 &#8594; /rhev/data-center/mnt/10.10.10.10:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227
|   |-- mastersd &#8594; 76d1ecba-b61d-45a4-8eb5-89ab710a6275
|   |-- tasks &#8594; mastersd/master/tasks
|   `-- vms &#8594; mastersd/master/vms
|-- hsm-tasks
`-- mnt
    |-- 10.10.10.10:_rhevisosd
    |   |-- b835cd1c-111c-468d-ba70-fec5346af227
    |   |   |-- dom_md
    |   |   |   |-- ids
    |   |   |   |-- inbox
    |   |   |   |-- leases
    |   |   |   |-- metadata
    |   |   |   `-- outbox
    |   |   `-- images
    |   |       `-- 11111111-1111-1111-1111-111111111111
    |   `-- lost+found [error opening dir]

(output trimmed)</pre>
</div>
</div>
</li>
<li>
<p>Securely copy the image from the source location into the full path of <code>11111111-1111-1111-1111-111111111111</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@isosource:/isos/example.iso /rhev/data-center/mnt/10.96.4.50:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227/images/11111111-1111-1111-1111-111111111111</pre>
</div>
</div>
</li>
<li>
<p>File permissions for the newly copied ISO image should be 36:36 (vdsm:kvm). If they are not, change user and group ownership of the ISO file to 36:36 (vdsm&#8217;s user and group):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /rhev/data-center/mnt/10.96.4.50:_rhevisosd/b835cd1c-111c-468d-ba70-fec5346af227/images/11111111-1111-1111-1111-111111111111
# chown 36.36 example.iso</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The ISO image should now be available in the ISO domain in the data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Moving_storage_domains_to_maintenance_mode">11.8.3. Moving Storage Domains to Maintenance Mode</h4>
<div class="paragraph">
<p>A storage domain must be in maintenance mode before it can be detached and removed. This is required to redesignate another data domain as the master data domain.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot move a storage domain into maintenance mode if a virtual machine has a lease on the storage domain. The virtual machine needs to be shut down, or the lease needs to be to removed or moved to a different storage domain first. See the <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#What_is_high_availability"><em>Virtual Machine Management Guide</em></a> for information about virtual machine leases.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Expanding iSCSI domains by adding more LUNs can only be done when the domain is active.</p>
</div>
<div class="paragraph">
<p><strong>Moving storage domains to maintenance mode</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Shut down all the virtual machines running on the storage domain.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Ignore OVF update failure</code> check box allows the storage domain to go into maintenance mode even if the OVF update fails.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is deactivated and has an <code>Inactive</code> status in the results list. You can now edit, detach, remove, or reactivate the inactive storage domains from the data center.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also activate, detach, and place domains into maintenance mode using the Storage tab in the details view of the data center it is associated with.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Editing_Storage_Domains">11.8.4. Editing Storage Domains</h4>
<div class="paragraph">
<p>You can edit storage domain parameters through the Administration Portal. Depending on the state of the storage domain, either active or inactive, different fields are available for editing. Fields such as <strong>Data Center</strong>, <strong>Domain Function</strong>, <strong>Storage Type</strong>, and <strong>Format</strong> cannot be changed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Active</strong>: When the storage domain is in an active state, the <strong>Name</strong>, <strong>Description</strong>, <strong>Comment</strong>, <strong>Warning Low Space Indicator (%)</strong>, <strong>Critical Space Action Blocker (GB)</strong>, <strong>Wipe After Delete</strong>, and <strong>Discard After Delete</strong> fields can be edited. The <strong>Name</strong> field can only be edited while the storage domain is active. All other fields can also be edited while the storage domain is inactive.</p>
</li>
<li>
<p><strong>Inactive</strong>: When the storage domain is in maintenance mode or unattached, thus in an inactive state, you can edit all fields except <strong>Name</strong>, <strong>Data Center</strong>, <strong>Domain Function</strong>, <strong>Storage Type</strong>, and <strong>Format</strong>. The storage domain must be inactive to edit storage connections, mount options, and other advanced parameters. This is only supported for NFS, POSIX, and Local storage types.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>iSCSI storage connections cannot be edited via the Administration Portal, but can be edited via the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-storage_server_connection_extension-methods-update">Updating Storage Connections</a> in the <em>REST API Guide</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Editing an Active Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span> and select a storage domain.</p>
</li>
<li>
<p>Click <strong>Manage Domain</strong>.</p>
</li>
<li>
<p>Edit the available fields as required.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Editing an Inactive Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>If the storage domain is active, move it to maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Manage Domain</strong>.</p>
</li>
<li>
<p>Edit the storage path and other details as required. The new connection details must be of the same storage type as the original connection.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Activate the storage domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Activate</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="updating-ovfs">11.8.5. Updating OVFs</h4>
<div class="paragraph">
<p>By default, OVFs are updated every 60 minutes. However, if you have imported an important virtual machine or made a critical update, you can update OVFs manually.</p>
</div>
<div class="paragraph">
<p><strong>Updating OVFs</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Select the storage domain and click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Update OVFs</strong>.</p>
<div class="paragraph">
<p>The OVFs are updated and a message appears in <strong>Events</strong>.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Activating_storage_domains">11.8.6. Activating Storage Domains from Maintenance Mode</h4>
<div class="paragraph">
<p>If you have been making changes to a data center&#8217;s storage, you have to put storage domains into maintenance mode. Activate a storage domain to resume using it.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click an inactive storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Centers</strong> tab.</p>
</li>
<li>
<p>Click <strong>Activate</strong>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you attempt to activate the ISO domain before activating the data domain, an error message displays and the domain is not activated.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Detaching_a_storage_domain">11.8.7. Detaching a Storage Domain from a Data Center</h4>
<div class="paragraph">
<p>Detach a storage domain from one data center to migrate it to another data center.</p>
</div>
<div class="paragraph">
<p><strong>Detaching a Storage Domain from the Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to initiate maintenance mode.</p>
</li>
<li>
<p>Click <strong>Detach</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to detach the storage domain.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain has been detached from the data center, ready to be attached to another data center.</p>
</div>
</div>
<div class="sect3">
<h4 id="Attaching_a_storage_domain">11.8.8. Attaching a Storage Domain to a Data Center</h4>
<div class="paragraph">
<p>Attach a storage domain to a data center.</p>
</div>
<div class="paragraph">
<p><strong>Attaching a Storage Domain to a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Attach</strong>.</p>
</li>
<li>
<p>Select the appropriate data center.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is attached to the data center and is automatically activated.</p>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Storage_Domain_storage_tasks">11.8.9. Removing a Storage Domain</h4>
<div class="paragraph">
<p>You have a storage domain in your data center that you want to remove from the virtualized environment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Move the storage domain to maintenance mode and detach it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Detach</strong>, then click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Optionally select the <strong>Format Domain, i.e. Storage Content will be lost!</strong> check box to erase the content of the domain.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is permanently removed from the environment.</p>
</div>
</div>
<div class="sect3">
<h4 id="Destroying_a_storage_domain">11.8.10. Destroying a Storage Domain</h4>
<div class="paragraph">
<p>A storage domain encountering errors may not be able to be removed through the normal procedure. Destroying a storage domain forcibly removes the storage domain from the virtualized environment.</p>
</div>
<div class="paragraph">
<p><strong>Destroying a Storage Domain</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Select the storage domain and click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Destroy</strong>.</p>
</li>
<li>
<p>Select the <strong>Approve operation</strong> check box.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_Disk_Profile">11.8.11. Creating a Disk Profile</h4>
<div class="paragraph">
<p>Disk profiles define the maximum level of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Disk profiles are created based on storage profiles defined under data centers, and must be manually assigned to individual virtual disks for the profile to take effect.</p>
</div>
<div class="paragraph">
<p>This procedure assumes you have already defined one or more storage quality of service entries under the data center to which the storage domain belongs.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Disk Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the data storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disk Profiles</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and a <strong>Description</strong> for the disk profile.</p>
</li>
<li>
<p>Select the quality of service to apply to the disk profile from the <strong>QoS</strong> list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_Disk_Profile">11.8.12. Removing a Disk Profile</h4>
<div class="paragraph">
<p>Remove an existing disk profile from your oVirt environment.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Disk Profile</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the data storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disk Profiles</strong> tab.</p>
</li>
<li>
<p>Select the disk profile to remove.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the disk profile was assigned to any virtual disks, the disk profile is removed from those virtual disks.</p>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_Storage_Health_Status">11.8.13. Viewing the Health Status of a Storage Domain</h4>
<div class="paragraph">
<p>Storage domains have an external health status in addition to their regular <strong>Status</strong>. The external health status is reported by plug-ins or external systems, or set by an administrator, and appears to the left of the storage domain&#8217;s <strong>Name</strong> as one of the following icons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OK</strong>: No icon</p>
</li>
<li>
<p><strong>Info</strong>: <span class="image"><img src="images/Info.png" alt="Info"></span></p>
</li>
<li>
<p><strong>Warning</strong>: <span class="image"><img src="images/Warning.png" alt="Warning"></span></p>
</li>
<li>
<p><strong>Error</strong>: <span class="image"><img src="images/Error.png" alt="Error"></span></p>
</li>
<li>
<p><strong>Failure</strong>: <span class="image"><img src="images/Failure.png" alt="Failure"></span></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To view further details about the storage domain&#8217;s health status, click the storage domain&#8217;s name. This opens the details view, and click the <strong>Events</strong> tab.</p>
</div>
<div class="paragraph">
<p>The storage domain&#8217;s health status can also be viewed using the REST API. A <code>GET</code> request on a storage domain will include the <code>external_status</code> element, which contains the health status.</p>
</div>
<div class="paragraph">
<p>You can set a storage domain&#8217;s health status in the REST API via the <code>events</code> collection. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-events-methods-add">Adding Events</a> in the <em>REST API Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Setting_Discard_After_Delete_for_a_Storage_Domain">11.8.14. Setting Discard After Delete for a Storage Domain</h4>
<div class="paragraph">
<p>When the <strong>Discard After Delete</strong> check box is selected, a <code>blkdiscard</code> command is called on a logical volume when it is removed and the underlying storage is notified that the blocks are free. The storage array can use the freed space and allocate it when requested. <strong>Discard After Delete</strong> only works on block storage. The flag is not available on the oVirt Engine for file storage, for example NFS.</p>
</div>
<div class="paragraph">
<p><strong>Restrictions:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Discard After Delete</strong> is only available on block storage domains, such as iSCSI or Fibre Channel.</p>
</li>
<li>
<p>The underlying storage must support <code>Discard</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Discard After Delete</strong> can be enabled both when creating a block storage domain or when editing a block storage domain. See <a href="#sect-Preparing_and_Adding_Block_Storage">Preparing and Adding Block Storage</a> and <a href="#Editing_Storage_Domains">Editing Storage Domains</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Enabling-4K-support-more-than-250-nodes-storage_tasks">11.8.15. Enabling 4K support on environments with more than 250 hosts</h4>
<div class="paragraph">
<p>By default, GlusterFS domains and local storage domains support 4K block size on oVirt environments with up to 250 hosts. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</p>
</div>
<div class="paragraph">
<p>The lockspace area that Sanlock allocates is 1 MB when the maximum number of hosts is the default 250. When you increase the maximum number of hosts when using 4K storage, the lockspace area is larger. For example, when using 2000 hosts, the lockspace area could be as large as 8 MB.</p>
</div>
<div class="paragraph">
<p>You can enable 4K block support on environments with more than 250 hosts by setting the engine configuration parameter <code>MaxNumberOfHostsInStoragePool</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Engine machine enable the required maximum number of hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s MaxNumberOfHostsInStoragePool=<em>NUMBER_OF_HOSTS</em></pre>
</div>
</div>
</li>
<li>
<p>Restart the JBoss Application Server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># service jboss-as restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if you have a cluster with 300 hosts, enter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s MaxNumberOfHostsInStoragePool=300
# service jboss-as restart</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>View the value of the <code>MaxNumberOfHostsInStoragePool</code> parameter on the Engine:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> # engine-config --get=MaxNumberOfHostsInStoragePool
 MaxNumberOfHostsInStoragePool: 250 version: general</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Disabling-4K-support-storage_tasks">11.8.16. Disabling 4K support</h4>
<div class="paragraph">
<p>By default, GlusterFS domains and local storage domains support 4K block size. 4K block size can provide better performance, especially when using large files, and it is also necessary when you use tools that require 4K compatibility, such as VDO.</p>
</div>
<div class="paragraph">
<p>You can disable 4K block support.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that 4K block support is enabled.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ vdsm-client Host getCapabilities
&#8230;&#8203;
{
    "GLUSTERFS" : [
         0,
         512,
         4096,
    ]
    &#8230;&#8203;</pre>
</div>
</div>
</li>
<li>
<p>Edit <code class="filename">/etc/vdsm/vdsm.conf.d/gluster.conf</code> and set <code>enable_4k_storage</code> to <code><strong>false</strong></code>. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ vi  /etc/vdsm/vdsm.conf.d/gluster.conf

[gluster]
# Use to disable 4k support
# if needed.
enable_4k_storage = false</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="monitoring-available-space-in-a-storage-domain_storage_tasks">11.8.17. Monitoring available space in a storage domain</h4>
<div class="paragraph _abstract">
<p>You can monitor available space in a storage domain and create an alert to warn you when a storage domain is nearing capacity. You can also define a critical threshold at which point the domain shuts down.</p>
</div>
<div class="paragraph">
<p>With Virtual Data Optimizer (VDO) and thin pool support, you might see more available space than is physically available. For VDO this behavior is expected, but the Engine cannot predict how much data you can actually write. The <strong>Warning Low Confirmed Space Indicator</strong> parameter notifies you when the domain is nearing physical space capacity and shows how much confirmed space remains. Confirmed space refers to the actual space available to write data.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Storage Domain</b></span> and click the name of a storage domain.</p>
</li>
<li>
<p>Click <strong>Manage Domain</strong>. The <strong>Manage Domains</strong> dialog box opens.</p>
</li>
<li>
<p>Expand <strong>Advanced Parameters</strong>.</p>
</li>
<li>
<p>For <strong>Warning Low Space Indicator (%)</strong> enter a percentage value. When the available space in the storage domain reaches this value, the Engine alerts you that the domain is nearing capacity.</p>
</li>
<li>
<p>For <strong>Critical Space Action Blocker (GB)</strong>, enter a value in gigabytes. When the available space in the storage domain reaches this value, the Engine shuts down.</p>
</li>
<li>
<p>For <strong>Warning Low Confirmed Space Indicator (%)</strong> enter a percentage value. When the available space in the storage domain reaches this value, the Engine alerts you that the actual space available to write data is nearing capacity.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Pools">12. Pools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Pools">12.1. Introduction to Virtual Machine Pools</h3>
<div class="paragraph">
<p>A virtual machine pool is a group of virtual machines that are all clones of the same template and that can be used on demand by any user in a given group. Virtual machine pools allow administrators to rapidly configure a set of generalized virtual machines for users.</p>
</div>
<div class="paragraph">
<p>Users access a virtual machine pool by taking a virtual machine from the pool. When a user takes a virtual machine from a pool, they are provided with any one of the virtual machines in the pool if any are available. That virtual machine will have the same operating system and configuration as that of the template on which the pool was based, but users may not receive the same member of the pool each time they take a virtual machine. Users can also take multiple virtual machines from the same virtual machine pool depending on the configuration of that pool.</p>
</div>
<div class="paragraph">
<p>Virtual machine pools are stateless by default, meaning that virtual machine data and configuration changes are not persistent across reboots. However, the pool can be configured to be stateful, allowing changes made by a previous user to persist. However, if a user configures console options for a virtual machine taken from a virtual machine pool, those options will be set as the default for that user for that virtual machine pool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtual machines taken from a pool are not stateless when accessed from the Administration Portal. This is because administrators need to be able to write changes to the disk if necessary.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In principle, virtual machines in a pool are started when taken by a user, and shut down when the user is finished. However, virtual machine pools can also contain pre-started virtual machines. Pre-started virtual machines are kept in an up state, and remain idle until they are taken by a user. This allows users to start using such virtual machines immediately, but these virtual machines will consume system resources even while not in use due to being idle.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_VM_Pool">12.2. Creating a virtual machine pool</h3>
<div class="paragraph">
<p>You can create a virtual machine pool containing multiple virtual machines based on a common template. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#chap-Templates">Templates</a> in the <em>Virtual Machine Management Guide</em> for information about sealing a virtual machine and creating a template.</p>
</div>
<div class="paragraph">
<p><strong><code>Sysprep</code> File Configuration Options for Windows Virtual Machines</strong></p>
</div>
<div class="paragraph">
<p>Several <code>sysprep</code> file configuration options are available, depending on your requirements.</p>
</div>
<div class="paragraph">
<p>If your pool does not need to join a domain, you can use the default <code>sysprep</code> file, located in <code>/usr/share/ovirt-engine/conf/sysprep/</code>.</p>
</div>
<div class="paragraph">
<p>If your pool needs to join a domain, you can create a custom <code>sysprep</code> for each Windows operating system:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the relevant sections for each operating system from <code>/usr/share/ovirt-engine/conf/osinfo-defaults.properties</code> to a new file and save as <code>99-defaults.properties</code>.</p>
</li>
<li>
<p>In <code>99-defaults.properties</code>, specify the Windows product activation key and the path of your new custom <code>sysprep</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">os.<em>operating_system</em>.productKey.value=<em>Windows_product_activation_key</em>
...
os.<em>operating_system</em>.sysprepPath.value = ${ENGINE_USR}/conf/sysprep/sysprep.<em>operating_system</em></pre>
</div>
</div>
</li>
<li>
<p>Create a new <code>sysprep</code> file, specifying the domain, domain password, and domain administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;Credentials&gt;
        &lt;Domain&gt;<em>AD_Domain</em>&lt;/Domain&gt;
        &lt;Password&gt;<em>Domain_Password</em>&lt;/Password&gt;
        &lt;Username&gt;<em>Domain_Administrator</em>&lt;/Username&gt;
    &lt;/Credentials&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you need to configure different <code>sysprep</code> settings for different pools of Windows virtual machines, you can create a custom <code>sysprep</code> file in the Administration Portal (see <a href="#custom_sysprep">Creating a Virtual Machine Pool</a> below). See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Using_Sysprep_to_Automate_the_Configuration_of_Virtual_Machines">Using Sysprep to Automate the Configuration of Virtual Machines</a> in the <em>Virtual Machine Guide</em> for more information.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Virtual Machine Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Select a <strong>Cluster</strong>  from the drop-down list.</p>
</li>
<li>
<p>Select a <strong>Template</strong> and version from the drop-down menu. A template provides standard settings for all the virtual machines in the pool.</p>
</li>
<li>
<p>Select an <strong>Operating System</strong> from the drop-down list.</p>
</li>
<li>
<p>Use <strong>Optimized for</strong> to optimize virtual machines for <strong>Desktop</strong> or <strong>Server</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>High Performance</strong> optimization is not recommended for pools because a high performance virtual machine is pinned to a single host and concrete resources. A pool containing multiple virtual machines with such a configuration would not run well.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter a <strong>Name</strong> and, optionally, a <strong>Description</strong> and <strong>Comment</strong>.</p>
<div class="paragraph">
<p>The <strong>Name</strong> of the pool is applied to each virtual machine in the pool, with a numeric suffix. You can customize the numbering of the virtual machines with <code>?</code> as a placeholder.</p>
</div>
<div class="exampleblock">
<div class="title">Example 6. Pool Name and Virtual Machine Numbering Examples</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Pool: <code>MyPool</code></p>
<div class="paragraph">
<p>Virtual machines: <code>MyPool-1</code>, <code>MyPool-2</code>, &#8230;&#8203; <code>MyPool-10</code></p>
</div>
</li>
<li>
<p>Pool: <code>MyPool-???</code></p>
<div class="paragraph">
<p>Virtual machines: <code>MyPool-001</code>, <code>MyPool-002</code>, &#8230;&#8203; <code>MyPool-010</code></p>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>Enter the <strong>Number of VMs</strong> for the pool.</p>
</li>
<li>
<p>Enter the number of virtual machines to be prestarted in the <strong>Prestarted</strong> field.</p>
</li>
<li>
<p>Select the <strong>Maximum number of VMs per user</strong> that a single user is allowed to run in a session. The minimum is <strong>1</strong>.</p>
</li>
<li>
<p>Select the <strong>Delete Protection</strong> check box to enable delete protection. <a id="custom_sysprep"></a></p>
</li>
<li>
<p>If you are creating a pool of non-Windows virtual machines or if you are using the default <code>sysprep</code>, skip this step. If you are creating a custom <code>sysprep</code> file for a pool of Windows virtual machines:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the <strong>Show Advanced Options</strong> button.</p>
</li>
<li>
<p>Click the <strong>Initial Run</strong> tab and select the <strong>Use Cloud-Init/Sysprep</strong> check box.</p>
</li>
<li>
<p>Click the <strong>Authentication</strong> arrow and enter the <strong>User Name</strong> and <strong>Password</strong> or select <strong>Use already configured password</strong>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This <code>User Name</code> is the name of the local administrator. You can change its value from its default value (<code>user</code>) here in the <strong>Authentication</strong> section or in a custom <code>sysprep</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click the <strong>Custom Script</strong> arrow and paste the contents of the default <code>sysprep</code> file, located in <code>/usr/share/ovirt-engine/conf/sysprep/</code>, into the text box.</p>
</li>
<li>
<p>You can modify the following values of the <code>sysprep</code> file:</p>
<div class="ulist">
<ul>
<li>
<p><code>Key</code>. If you do not want to use the pre-defined Windows activation product key, replace <code>&lt;![CDATA[$ProductKey$]]&gt;</code> with a valid product key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">    &lt;ProductKey&gt;
        &lt;Key&gt;&lt;![CDATA[$ProductKey$]]&gt;&lt;/Key&gt;
    &lt;/ProductKey&gt;</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 7. Windows Product Key Example</div>
<div class="content">
<div class="literalblock">
<div class="content">
<pre>&lt;ProductKey&gt;
    &lt;Key&gt;0000-000-000-000&lt;/Key&gt;
&lt;/ProductKey&gt;</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>Domain</code> that the Windows virtual machines will join, the domain&#8217;s <code>Password</code>, and the domain administrator&#8217;s <code>Username</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">    <span style="color:#F00;background-color:#FAA">&lt;Credentials&gt;</span>
        <span style="color:#F00;background-color:#FAA">&lt;Domain&gt;<em>AD_Domain</em>&lt;/Domain&gt;</span>
        <span style="color:#F00;background-color:#FAA">&lt;Password&gt;<em>Domain_Password</em>&lt;/Password&gt;</span>
        <span style="color:#F00;background-color:#FAA">&lt;Username&gt;<em>Domain_Administrator</em>&lt;/Username&gt;</span>
    <span style="color:#F00;background-color:#FAA">&lt;/Credentials&gt;</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 8. Domain Credentials Example</div>
<div class="content">
<div class="literalblock">
<div class="content">
<pre>&lt;Credentials&gt;
    &lt;Domain&gt;addomain.local&lt;/Domain&gt;
    &lt;Password&gt;12345678&lt;/Password&gt;
    &lt;Username&gt;Sarah_Smith&lt;/Username&gt;
&lt;/Credentials&gt;</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>Domain</code>, <code>Password</code>, and <code>Username</code> are required to join the domain. The <code>Key</code> is for activation. You do not necessarily need both.</p>
</div>
<div class="paragraph">
<p>The domain and credentials cannot be modified in the <strong>Initial Run</strong> tab.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><code>FullName</code> of the local administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">    <span style="color:#F00;background-color:#FAA">&lt;UserData&gt;</span>
    <span style="color:#F00;background-color:#FAA">&#8230;&#8203;</span>
        <span style="color:#F00;background-color:#FAA">&lt;FullName&gt;<em>Local_Administrator</em>&lt;/FullName&gt;</span>
    <span style="color:#F00;background-color:#FAA">&#8230;&#8203;</span>
    <span style="color:#F00;background-color:#FAA">&lt;/UserData&gt;</span></code></pre>
</div>
</div>
</li>
<li>
<p><code>DisplayName</code> and <code>Name</code> of the local administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">    <span style="color:#F00;background-color:#FAA">&lt;LocalAccounts&gt;</span>
        <span style="color:#F00;background-color:#FAA">&lt;LocalAccount wcm:action=&quot;add&quot;&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;Password&gt;</span>
                <span style="color:#F00;background-color:#FAA">&lt;Value&gt;&lt;![CDATA[$AdminPassword$]]&gt;&lt;/Value&gt;</span>
                <span style="color:#F00;background-color:#FAA">&lt;PlainText&gt;true&lt;/PlainText&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;/Password&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;DisplayName&gt;<em>Local_Administrator</em>&lt;/DisplayName&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;Group&gt;administrators&lt;/Group&gt;</span>
            <span style="color:#F00;background-color:#FAA">&lt;Name&gt;<em>Local_Administrator</em>&lt;/Name&gt;</span>
        <span style="color:#F00;background-color:#FAA">&lt;/LocalAccount&gt;</span>
    <span style="color:#F00;background-color:#FAA">&lt;/LocalAccounts&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The remaining variables in the <code>sysprep</code> file can be filled in on the <strong>Initial Run</strong> tab.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Optional. Set a <strong>Pool Type</strong>:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the <strong>Type</strong> tab and select a <strong>Pool Type</strong>:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Manual</strong> - The administrator is responsible for explicitly returning the virtual machine to the pool.</p>
</li>
<li>
<p><strong>Automatic</strong> - The virtual machine is automatically returned to the virtual machine pool.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Select the <strong>Stateful Pool</strong> check box to ensure that virtual machines are started in a stateful mode. This ensures that changes made by a previous user will persist on a virtual machine.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Optional. Override the SPICE proxy:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Console</strong> tab, select the <strong>Override SPICE Proxy</strong> check box.</p>
</li>
<li>
<p>In the  <strong>Overridden SPICE proxy address</strong> text field, specify the address of a SPICE proxy to override the global SPICE proxy.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>For a pool of Windows virtual machines, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>, select each virtual machine from the pool, and click <span class="menuseq"><b class="menu">Run</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Run Once</b></span>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the virtual machine does not start and <code>Info  [windeploy.exe] Found no unattend file</code> appears in <code>%WINDIR%\panther\UnattendGC\setupact.log</code>, add the <strong>UnattendFile</strong> key to the registry of the Windows virtual machine that was used to create the template for the pool:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the virtual machine and click <span class="menuseq"><b class="menu">Run</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Run once</b></span>.</p>
</li>
<li>
<p>Under Boot Options, check <strong>Attach Windows guest tools CD</strong>.</p>
</li>
<li>
<p>Click <strong>Start</strong>, click <strong>Run</strong>, type <code>regedit</code> in the <strong>Open</strong> text box, and click <strong>OK</strong>.</p>
</li>
<li>
<p>In the left pane, go to <span class="menuseq"><b class="menu">HKEY_LOCAL_MACHINE</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">SYSTEM</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Setup</b></span>.</p>
</li>
<li>
<p>Right-click the right pane and select <span class="menuseq"><b class="menu">New</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">String Value</b></span>.</p>
</li>
<li>
<p>Enter <strong>UnattendFile</strong> as the key name.</p>
</li>
<li>
<p>Double-click the new key and enter the <code>unattend</code> file name and path, for example, <strong>A:\Unattend.xml</strong>, as the key&#8217;s value.</p>
</li>
<li>
<p>Save the registry, seal the Windows virtual machine, and create a new template. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#chap-Templates">Templates</a> in the <em>Virtual Machine Management Guide</em> for details.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have created and configured a virtual machine pool with the specified number of identical virtual machines. You can view these virtual machines in <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>, or by clicking the name of a pool to open its details view; a virtual machine in a pool is distinguished from independent virtual machines by its icon.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Explanation_of_Settings_and_Controls_in_the_New_Pool_Window">12.3. Explanation of Settings and Controls in the New Pool and Edit Pool Windows</h3>
<div class="sect3">
<h4 id="New_Pool_General_Settings_Explained">12.3.1. New Pool and Edit Pool General Settings Explained</h4>
<div class="paragraph">
<p>The following table details the information required on the <strong>General</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows that are specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> window.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. <strong>General</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Template</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The template and template sub-version on which the virtual machine pool is based. If you create a pool based on the <code>latest</code> sub-version of a template, all virtual machines in the pool, when rebooted, will automatically receive the latest template version. For more information on configuring templates for virtual machines see <a href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_General_settings_explained">Virtual Machine General Settings Explained</a> and <a href="https://ovirt.org/documentation/virtual_machine_management_guide#Explanation_of_Settings_in_the_New_Template_and_Edit_Template_Windows">Explanation of Settings in the New Template and Edit Template Windows</a> in the <em>Virtual Machine Management Guide</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A meaningful description of the virtual machine pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Comment</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A field for adding plain text human-readable comments regarding the virtual machine pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Prestarted VMs</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify the number of virtual machines in the virtual machine pool that will be started before they are taken and kept in that state to be taken by users. The value of this field must be between <code>0</code> and the total number of virtual machines in the virtual machine pool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Number of VMs/Increase number of VMs in pool by</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify the number of virtual machines to be created and made available in the virtual machine pool. In the edit window it allows you to increase the number of virtual machines in the virtual machine pool by the specified number. By default, the maximum number of virtual machines you can create in a pool is 1000. This value can be configured using the <code>MaxVmsInPool</code> key of the <code>engine-config</code> command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Maximum number of VMs per user</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to specify the maximum number of virtual machines a single user can take from the virtual machine pool at any one time. The value of this field must be between <code>1</code> and <code>32,767</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Delete Protection</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to prevent the virtual machines in the pool from being deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Sealed</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensures that machine-specific settings from the template are not reproduced in virtual machines that are provisioned from the template. For more information about the sealing process, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide#Sealing_a_Windows_Virtual_Machine_for_Deployment_as_a_Template">Sealing a Windows Virtual Machine for Deployment as a Template</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="New_Pool_Pool_Settings_Explained">12.3.2. New Pool and Edit Pool Type Settings Explained</h4>
<div class="paragraph">
<p>The following table details the information required on the <strong>Type</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. <strong>Type</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pool Type</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This drop-down menu allows you to specify the type of the virtual machine pool. The following options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Automatic</strong>: After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is automatically returned to the virtual machine pool.</p>
</li>
<li>
<p><strong>Manual</strong>: After a user finishes using a virtual machine taken from a virtual machine pool, that virtual machine is only returned to the virtual machine pool when an administrator manually returns the virtual machine.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Stateful Pool</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specify whether the state of virtual machines in the pool is preserved when a virtual machine is passed to a different user. This means that changes made by a previous user will persist on the virtual machine.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="New_Pool_and_Edit_Pool_Console_Settings_Explained">12.3.3. New Pool and Edit Pool Console Settings Explained</h4>
<div class="paragraph">
<p>The following table details the information required on the <strong>Console</strong> tab of the <strong>New Pool</strong> or <strong>Edit Pool</strong> window that is specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> and <strong>Edit Virtual Machine</strong> windows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. <strong>Console</strong> settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Override SPICE proxy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this check box to enable overriding the SPICE proxy defined in global configuration. This feature is useful in a case where the user (who is, for example, connecting via the VM Portal) is outside of the network where the hosts reside.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Overridden SPICE proxy address</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The proxy by which the SPICE client connects to virtual machines. This proxy overrides both the global SPICE proxy defined for the oVirt environment and the SPICE proxy defined for the cluster to which the virtual machine pool belongs, if any. The address must be in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">protocol://<em>host</em>:<em>port</em></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="Virtual_Machine_Pool_Host_settings_explained">12.3.4. Virtual Machine Pool Host Settings Explained</h4>
<div class="paragraph">
<p>The following table details the options available on the <strong>Host</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows.</p>
</div>
<table id="New_VMs_Host" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. Virtual Machine Pool: Host Settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Sub-element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Start Running On</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the preferred host on which the virtual machine is to run. Select either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Any Host in Cluster</strong> - The virtual machine can start and run on any available host in the cluster.</p>
</li>
<li>
<p><strong>Specific Host(s)</strong> - The virtual machine will start running on a particular host in the cluster. However, the Engine or an administrator can migrate the virtual machine to a different host in the cluster depending on the migration and high-availability settings of the virtual machine. Select the specific host or group of hosts from the list of available hosts.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU options</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Pass-Through Host CPU</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When selected, allows virtual machines to use the host&#8217;s CPU flags.
When selected, <strong>Migration Options</strong> is set to <strong>Allow manual migration only</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migrate only to hosts with the same TSC frequency</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When selected, this virtual machine can only be migrated to a host with the same TSC frequency. This option is only valid for High Performance virtual machines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migration Options</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migration mode</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines options to run and migrate the virtual machine. If the options here are not used, the virtual machine will run or migrate according to its cluster&#8217;s policy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Allow manual and automatic migration</strong> - The virtual machine can be automatically migrated from one host to another in accordance with the status of the environment, or manually by an administrator.</p>
</li>
<li>
<p><strong>Allow manual migration only</strong> - The virtual machine can only be migrated from one host to another manually by an administrator.</p>
</li>
<li>
<p><strong>Do not allow migration</strong> - The virtual machine cannot be migrated, either automatically or manually.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Migration policy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the migration convergence policy. If the check box is left unselected, the host determines the policy.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cluster default (Minimal downtime)</strong> - Overrides in <code>vdsm.conf</code> are still applied. The guest agent hook mechanism is disabled.</p>
</li>
<li>
<p><strong>Minimal downtime</strong> - Allows the virtual machine to migrate in typical situations. Virtual machines should not experience any significant downtime. The migration will be aborted if virtual machine migration does not converge after a long time (dependent on QEMU iterations, with a maximum of 500 milliseconds). The guest agent hook mechanism is enabled.</p>
</li>
<li>
<p><strong>Post-copy migration</strong> - When used, post-copy migration pauses the migrating virtual machine vCPUs on the source host, transfers only a minimum of memory pages, activates the virtual machine vCPUs on the destination host, and transfers the remaining memory pages while the virtual machine is running on the destination.</p>
<div class="paragraph">
<p>The post-copy policy first tries pre-copy to verify whether convergence can occur. The migration switches to post-copy if the virtual machine migration does not converge after a long time.</p>
</div>
<div class="paragraph">
<p>This significantly reduces the downtime of the migrated virtual machine, and also guarantees that the migration finishes regardless of how rapidly the memory pages of the source virtual machine change. It is optimal for migrating virtual machines in heavy continuous use, which would not be possible to migrate with standard pre-copy migration.</p>
</div>
<div class="paragraph">
<p>The disadvantage of this policy is that in the post-copy phase, the virtual machine may slow down significantly as the missing parts of memory are transferred between the hosts.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the network connection breaks prior to the completion of the post-copy process, the Engine pauses and then kills the running virtual machine. Do not use post-copy migration if the virtual machine availability is critical or if the migration network is unstable.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>Suspend workload if needed</strong> - Allows the virtual machine to migrate in most situations, including when the virtual machine is running a heavy workload. Because of this, virtual machines may experience a more significant downtime than with some other settings. The migration may still be aborted for extreme workloads. The guest agent hook mechanism is enabled.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable migration encryption</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows the virtual machine to be encrypted during migration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Cluster default (Don&#8217;t encrypt)</strong></p>
</li>
<li>
<p><strong>Encrypt</strong></p>
</li>
<li>
<p><strong>Don&#8217;t encrypt</strong></p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Configure NUMA</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NUMA Node Count</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of virtual NUMA nodes available in a host that can be assigned to the virtual machine.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NUMA Pinning</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="New_Pool_Resource_Settings_Explained">12.3.5. New Pool and Edit Pool Resource Allocation Settings Explained</h4>
<div class="paragraph">
<p>The following table details the information required on the <strong>Resource Allocation</strong> tab of the <strong>New Pool</strong> and <strong>Edit Pool</strong> windows that are specific to virtual machine pools. All other settings are identical to those in the <strong>New Virtual Machine</strong> window. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_Resource_Allocation_settings_explained">Virtual Machine Resource Allocation Settings Explained</a> in the <em>Virtual Machine Management Guide</em> for more information.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. <strong>Resource Allocation</strong> settings</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Sub-element</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disk Allocation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Auto select target</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select this check box to automatically select the storage domain that has the most free space. The <strong>Target</strong> and <strong>Disk Profile</strong> fields are disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Format</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field is read-only and always displays <strong>QCOW2</strong>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Editing_a_Virtual_Machine_Pool">12.4. Editing a Virtual Machine Pool</h3>
<div class="paragraph">
<p>After a virtual machine pool has been created, its properties can be edited. The properties available when editing a virtual machine pool are identical to those available when creating a new virtual machine pool except that the <strong>Number of VMs</strong> property is replaced by <strong>Increase number of VMs in pool by</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When editing a virtual machine pool, the changes introduced affect only new virtual machines. Virtual machines that existed already at the time of the introduced changes remain unaffected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Editing a Virtual Machine Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span> and select a virtual machine pool.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Edit the properties of the virtual machine pool.</p>
</li>
<li>
<p>Click <strong>Ok</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Prestarting_Virtual_Machines_in_a_Pool">12.5. Prestarting Virtual Machines in a Pool</h3>
<div class="paragraph">
<p>The virtual machines in a virtual machine pool are powered down by default. When a user requests a virtual machine from a pool, a machine is powered up and assigned to the user. In contrast, a prestarted virtual machine is already running and waiting to be assigned to a user, decreasing the amount of time a user has to wait before being able to access a machine. When a prestarted virtual machine is shut down it is returned to the pool and restored to its original state. The maximum number of prestarted virtual machines is the number of virtual machines in the pool.</p>
</div>
<div class="paragraph">
<p>Prestarted virtual machines are suitable for environments in which users require immediate access to virtual machines which are not specifically assigned to them. Only automatic pools can have prestarted virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Prestarting Virtual Machines in a Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span> and select the virtual machine pool.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Enter the number of virtual machines to be prestarted in the <strong>Prestarted VMs</strong> field.</p>
</li>
<li>
<p>Click the <strong>Type</strong> tab. Ensure <strong>Pool Type</strong> is set to <strong>Automatic</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_Virtual_Machines_to_a_VM_Pool">12.6. Adding Virtual Machines to a Virtual Machine Pool</h3>
<div class="paragraph">
<p>If you require more virtual machines than originally provisioned in a virtual machine pool, add more machines to the pool.</p>
</div>
<div class="paragraph">
<p><strong>Adding Virtual Machines to a Virtual Machine Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span> and select the virtual machine pool.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Enter the number of additional virtual machines in the <strong>Increase number of VMs in pool by</strong> field.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Detaching_Virtual_Machines_from_a_VM_Pool">12.7. Detaching Virtual Machines from a Virtual Machine Pool</h3>
<div class="paragraph">
<p>You can detach virtual machines from a virtual machine pool. Detaching a virtual machine removes it from the pool to become an independent virtual machine.</p>
</div>
<div class="paragraph">
<p><strong>Detaching Virtual Machines from a Virtual Machine Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span>.</p>
</li>
<li>
<p>Click the pool&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Virtual Machines</strong> tab to list the virtual machines in the pool.</p>
</li>
<li>
<p>Ensure the virtual machine has a status of <code>Down</code>; you cannot detach a running virtual machine.</p>
</li>
<li>
<p>Select one or more virtual machines and click <strong>Detach</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The virtual machine still exists in the environment and can be viewed and accessed from <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>. Note that the icon changes to denote that the detached virtual machine is an independent virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Removing_a_Virtual_Machine_Pool">12.8. Removing a Virtual Machine Pool</h3>
<div class="paragraph">
<p>You can remove a virtual machine pool from a data center. You must first either delete or detach all of the virtual machines in the pool. Detaching virtual machines from the pool will preserve them as independent virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Virtual Machine Pool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Pools</b></span> and select the virtual machine pool.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Virtual_Machine_Disks">13. Virtual Disks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Understanding_virtual_machine_storage">13.1. Understanding Virtual Machine Storage</h3>
<div class="paragraph">
<p>oVirt supports three storage types: NFS, iSCSI and FCP.</p>
</div>
<div class="paragraph">
<p>In each type, a host known as the Storage Pool Manager (SPM) manages access between hosts and storage. The SPM host is the only node that has full access within the storage pool; the SPM can modify the storage domain metadata, and the pool&#8217;s metadata. All other hosts can only access virtual machine hard disk image data.</p>
</div>
<div class="paragraph">
<p>By default in an NFS, local, or POSIX compliant data center, the SPM creates the virtual disk using a thin provisioned format as a file in a file system.</p>
</div>
<div class="paragraph">
<p>In iSCSI and other block-based data centers, the SPM creates a volume group on top of the Logical Unit Numbers (LUNs) provided, and makes logical volumes to use as virtual disks. Virtual disks on block-based storage are preallocated by default.</p>
</div>
<div class="paragraph">
<p>If the virtual disk is preallocated, a logical volume of the specified size in GB is created. The virtual machine can be mounted on a Enterprise Linux server using <code>kpartx</code>, <code>vgscan</code>, <code>vgchange</code> or <code>mount</code> to investigate the virtual machine&#8217;s processes or problems.</p>
</div>
<div class="paragraph">
<p>If the virtual disk is thinly provisioned, a 1 GB logical volume is created. The logical volume is continuously monitored by the host on which the virtual machine is running. As soon as the usage nears a threshold the host notifies the SPM, and the SPM extends the logical volume by 1 GB. The host is responsible for resuming the virtual machine after the logical volume has been extended. If the virtual machine goes into a paused state it means that the SPM could not extend the disk in time. This occurs if the SPM is too busy or if there is not enough storage space.</p>
</div>
<div class="paragraph">
<p>A virtual disk with a preallocated (raw) format has significantly faster write speeds than a virtual disk with a thin provisioning (QCOW2) format. Thin provisioning takes significantly less time to create a virtual disk. The thin provision format is suitable for non-I/O intensive virtual machines. The preallocated format is recommended for virtual machines with high I/O writes. If a virtual machine is able to write more than 1 GB every four seconds, use preallocated disks where possible.</p>
</div>
</div>
<div class="sect2">
<h3 id="Understanding_virtual_disks">13.2. Understanding Virtual Disks</h3>
<div class="paragraph">
<p>oVirt features <strong>Preallocated</strong> (thick provisioned) and <strong>Sparse</strong> (thin provisioned) storage options.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Preallocated</p>
<div class="paragraph">
<p>A preallocated virtual disk allocates all the storage required for a virtual machine up front. For example, a 20 GB preallocated logical volume created for the data partition of a virtual machine will take up 20 GB of storage space immediately upon creation.</p>
</div>
</li>
<li>
<p>Sparse</p>
<div class="paragraph">
<p>A sparse allocation allows an administrator to define the total storage to be assigned to the virtual machine, but the storage is only allocated when required.</p>
</div>
<div class="paragraph">
<p>For example, a 20 GB thin provisioned logical volume would take up 0 GB of storage space when first created. When the operating system is installed it may take up the size of the installed file, and would continue to grow as data is added up to a maximum of 20 GB size.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can view a virtual disk&#8217;s <strong>ID</strong> in <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span>. The <strong>ID</strong> is used to identify a virtual disk because its device name (for example, <strong>/dev/vda0</strong>) can change, causing disk corruption. You can also view a virtual disk&#8217;s ID in <strong>/dev/disk/by-id</strong>.</p>
</div>
<div class="paragraph">
<p>You can view the <strong>Virtual Size</strong> of a disk in <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span> and in the <strong>Disks</strong> tab of the details view for storage domains, virtual machines, and templates. The <strong>Virtual Size</strong> is the total amount of disk space that the virtual machine can use. It is the number that you enter in the <strong>Size(GB)</strong> field when you create or edit a virtual disk.</p>
</div>
<div class="paragraph">
<p>You can view the <strong>Actual Size</strong> of a disk in the <strong>Disks</strong> tab of the details view for storage domains and templates. This is the amount of disk space that has been allocated to the virtual machine so far. Preallocated disks show the same value for <strong>Virtual Size</strong> and <strong>Actual Size</strong>. Sparse disks may show different values, depending on how much disk space has been allocated.</p>
</div>
<div class="paragraph">
<p>The possible combinations of storage types and formats are described in the following table.</p>
</div>
<table id="vdisk-combos" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Permitted Storage Combinations</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Storage</th>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A file with an initial size that equals the amount of storage defined for the virtual disk, and has no formatting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sparse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A file with an initial size that is close to zero, and has no formatting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QCOW2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sparse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A file with an initial size that is close to zero, and has QCOW2 formatting. Subsequent layers will be QCOW2 formatted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A block device with an initial size that equals the amount of storage defined for the virtual disk, and has no formatting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">QCOW2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sparse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A block device with an initial size that is much smaller than the size defined for the virtual disk (currently 1 GB), and has QCOW2 formatting for which space is allocated as needed (currently in 1 GB increments).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Settings_to_Wipe_Virtual_Disks_After_Deletion">13.3. Settings to Wipe Virtual Disks After Deletion</h3>
<div class="paragraph">
<p>The <code>wipe_after_delete</code> flag, viewed in the Administration Portal as the <strong>Wipe After Delete</strong> check box will replace used data with zeros when a virtual disk is deleted. If it is set to false, which is the default, deleting the disk will open up those blocks for reuse but will not wipe the data. It is, therefore, possible for this data to be recovered because the blocks have not been returned to zero.</p>
</div>
<div class="paragraph">
<p>The <code>wipe_after_delete</code> flag only works on block storage. On file storage, for example NFS, the option does nothing because the file system will ensure that no data exists.</p>
</div>
<div class="paragraph">
<p>Enabling <code>wipe_after_delete</code> for virtual disks is more secure, and is recommended if the virtual disk has contained any sensitive data. This is a more intensive operation and users may experience degradation in performance and prolonged delete times.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The wipe after delete functionality is not the same as secure delete, and cannot guarantee that the data is removed from the storage, just that new disks created on same storage will not expose data from old disks.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>wipe_after_delete</code> flag default can be changed to <code>true</code> during the setup process (see <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Configuring_the_Red_Hat_Virtualization_Manager_install_RHVM">Configuring the oVirt Engine</a>), or by using the <code>engine-config</code> tool on the oVirt Engine. Restart the <code>ovirt-engine</code> service for the setting change to take effect.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Changing the <code>wipe_after_delete</code> flag&#8217;s default setting will not affect the <strong>Wipe After Delete</strong> property of disks that already exist.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Setting SANWipeAfterDelete to Default to True Using the Engine Configuration Tool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the <code>engine-config</code> tool with the <code>--set</code> action:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set SANWipeAfterDelete=true</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service for the change to take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>/var/log/vdsm/vdsm.log</strong> file located on the host can be checked to confirm that a virtual disk was successfully wiped and deleted.</p>
</div>
<div class="paragraph">
<p>For a successful wipe, the log file will contain the entry, <code><em>storage_domain_id</em>/<em>volume_id</em> was zeroed and will be deleted</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">a9cb0625-d5dc-49ab-8ad1-72722e82b0bf/a49351a7-15d8-4932-8d67-512a369f9d61 was zeroed and will be deleted</pre>
</div>
</div>
<div class="paragraph">
<p>For a successful deletion, the log file will contain the entry, <code>finished with VG:<em>storage_domain_id</em> LVs: <em>list_of_volume_ids</em>, img: <em>image_id</em></code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">finished with VG:a9cb0625-d5dc-49ab-8ad1-72722e82b0bf LVs: {'a49351a7-15d8-4932-8d67-512a369f9d61': ImgsPar(imgs=['11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d'], parent='00000000-0000-0000-0000-000000000000')}, img: 11f8b3be-fa96-4f6a-bb83-14c9b12b6e0d</pre>
</div>
</div>
<div class="paragraph">
<p>An unsuccessful wipe will display a log message <code>zeroing <em>storage_domain_id</em>/<em>volume_id</em> failed. Zero and remove this volume manually</code>, and an unsuccessful delete will display <code>Remove failed for some of VG: <em>storage_domain_id</em> zeroed volumes: <em>list_of_volume_ids</em></code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Shareable_Disks">13.4. Shareable Disks in oVirt</h3>
<div class="paragraph">
<p>Some applications require storage to be shared between servers. oVirt allows you to mark virtual machine hard disks as <strong>Shareable</strong> and attach those disks to virtual machines. That way a single virtual disk can be used by multiple cluster-aware guests.</p>
</div>
<div class="paragraph">
<p>Shared disks are not to be used in every situation. For applications like clustered database servers, and other highly available services, shared disks are appropriate. Attaching a shared disk to multiple guests that are not cluster-aware is likely to cause data corruption because their reads and writes to the disk are not coordinated.</p>
</div>
<div class="paragraph">
<p>You cannot take a snapshot of a shared disk. Virtual disks that have snapshots taken of them cannot later be marked shareable.</p>
</div>
<div class="paragraph">
<p>You can mark a disk shareable either when you create it, or by editing the disk later.</p>
</div>
</div>
<div class="sect2">
<h3 id="Read_Only_Disks_in_Red_Hat_Enterprise_Virtualization">13.5. Read Only Disks in oVirt</h3>
<div class="paragraph">
<p>Some applications require administrators to share data with read-only rights. You can do this when creating or editing a disk attached to a virtual machine via the <strong>Disks</strong> tab in the details view of the virtual machine and selecting the <strong>Read Only</strong> check box. That way, a single disk can be read by multiple cluster-aware guests, while an administrator maintains writing privileges.</p>
</div>
<div class="paragraph">
<p>You cannot change the read-only status of a disk while the virtual machine is running.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mounting a journaled file system requires read-write access. Using the <strong>Read Only</strong> option is not appropriate for virtual disks that contain such file systems (e.g. <strong>EXT3</strong>, <strong>EXT4</strong>, or <strong>XFS</strong>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Virtual_Disk_Tasks">13.6. Virtual Disk Tasks</h3>
<div class="sect3">
<h4 id="Creating_a_Virtual_Disk">13.6.1. Creating a Virtual Disk</h4>
<div class="paragraph">
<p><strong>Image</strong> disk creation is managed entirely by the Engine. <strong>Direct LUN</strong> disks require externally prepared targets that already exist.</p>
</div>
<div class="paragraph">
<p>You can create a virtual disk that is attached to a specific virtual machine. Additional options are available when creating an attached virtual disk, as specified in <a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">Explanation of settings in the New Virtual Disk window</a>.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Virtual Disk Attached to a Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Click the virtual machine&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Click the appropriate button to specify whether the virtual disk will be an <strong>Image</strong> or <strong>Direct LUN</strong> disk.</p>
</li>
<li>
<p>Select the options required for your virtual disk. The options change based on the disk type selected. See <a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">Explanation of settings in the New Virtual Disk window</a> for more details on each option for each disk type.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can also create a floating virtual disk that does not belong to any virtual machines. You can attach this disk to a single virtual machine, or to multiple virtual machines if the disk is shareable. Some options are not available when creating a virtual disk, as specified in <a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">Explanation of settings in the New Virtual Disk window</a>.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Floating Virtual Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>.</p>
</li>
<li>
<p>Click the appropriate button to specify whether the virtual disk will be an <strong>Image</strong> or <strong>Direct LUN</strong> disk.</p>
</li>
<li>
<p>Select the options required for your virtual disk. The options change based on the disk type selected. See <a href="#Explanation_of_Settings_in_the_New_Virtual_Disk_Window">Explanation of settings in the New Virtual Disk window</a> for more details on each option for each disk type.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Explanation_of_Settings_in_the_New_Virtual_Disk_Window">13.6.2. Explanation of settings in the New Virtual Disk window</h4>
<div class="paragraph">
<p>Because the New Virtual Disk windows for creating floating and attached virtual disks are very similar, their settings are described in a single section.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. New Virtual Disk and Edit Virtual Disk settings: <strong>Image</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Size(GB)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size of the new virtual disk in GB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the virtual disk, limited to 40 characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the virtual disk. This field is recommended but not mandatory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">The virtual interface the disk presents to virtual machines. <strong>VirtIO</strong> is faster, but requires drivers. Enterprise Linux 5 and later include these drivers. Windows does not include these drivers, but you can install them from the virtio-win ISO image. IDE and SATA devices do not require special drivers.</p>
<p class="tableblock">The interface type can be updated after stopping all virtual machines that the disk is attached to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Data Center</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating a floating disk.</p>
<p class="tableblock">The data center in which the virtual disk will be available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Storage Domain</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The storage domain in which the virtual disk will be stored. The drop-down list shows all storage domains available in the given data center, and also shows the total space and currently available space in the storage domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allocation Policy</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The provisioning policy for the new virtual disk.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Preallocated</strong> allocates the entire size of the disk on the storage domain at the time the virtual disk is created. The virtual size and the actual size of a preallocated disk are the same. Preallocated virtual disks take more time to create than thin provisioned virtual disks, but have better read and write performance. Preallocated virtual disks are recommended for servers and other I/O intensive virtual machines. If a virtual machine is able to write more than 1 GB every four seconds, use preallocated disks where possible.</p>
</li>
<li>
<p><strong>Thin Provision</strong> allocates 1 GB at the time the virtual disk is created and sets a maximum limit on the size to which the disk can grow. The virtual size of the disk is the maximum limit; the actual size of the disk is the space that has been allocated so far. Thin provisioned disks are faster to create than preallocated disks and allow for storage over-commitment. Thin provisioned virtual disks are recommended for desktops.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Disk Profile</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The disk profile assigned to the virtual disk. Disk profiles define the maximum amount of throughput and the maximum level of input and output operations for a virtual disk in a storage domain. Disk profiles are defined on the storage domain level based on storage quality of service entries created for data centers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Activate Disk(s)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Activate the virtual disk immediately after creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Wipe After Delete</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to enable enhanced security for deletion of sensitive material when the virtual disk is deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bootable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to enable the bootable flag on the virtual disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Shareable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to attach the virtual disk to more than one virtual machine at a time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Read-Only</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Incremental Backup</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables incremental backup on the virtual disk. Incremental backup requires disks to be formatted in QCOW2 format instead of RAW format. See <a href="#assembly_incremental-backup-and-restore_RHV_backup_restore">[assembly_incremental-backup-and-restore_RHV_backup_restore]</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Discard</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to shrink a thin provisioned disk while the virtual machine is up. For block storage, the underlying storage device must support discard calls, and the option cannot be used with <strong>Wipe After Delete</strong> unless the underlying storage supports the discard_zeroes_data property. For file storage, the underlying file system and the block device must support discard calls. If all requirements are met, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <strong>Direct LUN</strong> settings can be displayed in either <strong>Targets &gt; LUNs</strong> or <strong>LUNs &gt; Targets</strong>. <strong>Targets &gt; LUNs</strong> sorts available LUNs according to the host on which they are discovered, whereas <strong>LUNs &gt; Targets</strong> displays a single list of LUNs.</p>
</div>
<div class="paragraph">
<p>Fill in the fields in the <strong>Discover Targets</strong> section and click <strong>Discover</strong> to discover the target server. You can then click the <strong>Login All</strong> button to list the available LUNs on the target server and, using the radio buttons next to each LUN, select the LUN to add.</p>
</div>
<div class="paragraph">
<p>Using LUNs directly as virtual machine hard disk images removes a layer of abstraction between your virtual machines and their data.</p>
</div>
<div class="paragraph">
<p>The following considerations must be made when using a direct LUN as a virtual machine hard disk image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Live storage migration of direct LUN hard disk images is not supported.</p>
</li>
<li>
<p>Direct LUN disks are not included in virtual machine exports.</p>
</li>
<li>
<p>Direct LUN disks are not included in virtual machine snapshots.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. New Virtual Disk and Edit Virtual Disk settings: <strong>Direct LUN</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Alias</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the virtual disk, limited to 40 characters.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A description of the virtual disk. This field is recommended but not mandatory. By default the last 4 characters of the LUN ID is inserted into the field.</p>
<p class="tableblock">The default behavior can be configured by setting the <code>PopulateDirectLUNDiskDescriptionWithLUNId</code> configuration key to the appropriate value using the <code>engine-config</code> command.  The configuration key can be set to <code>-1</code> for the full LUN ID to be used, or <code>0</code> for this feature to be ignored. A positive integer populates the description with the corresponding number of characters of the LUN ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interface</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">The virtual interface the disk presents to virtual machines. <strong>VirtIO</strong> is faster, but requires drivers. Enterprise Linux 5 and later include these drivers. Windows does not include these drivers, but they can be installed from the virtio-win ISO . IDE and SATA devices do not require special drivers.</p>
<p class="tableblock">The interface type can be updated after stopping all virtual machines that the disk is attached to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Data Center</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating a floating disk.</p>
<p class="tableblock">The data center in which the virtual disk will be available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host on which the LUN will be mounted. You can select any host in the data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Storage Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of external LUN to add. You can select from either <strong>iSCSI</strong> or <strong>Fibre Channel</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Discover Targets</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This section can be expanded when you are using iSCSI external LUNs and <strong>Targets &gt; LUNs</strong> is selected.</p>
</div>
<div class="paragraph">
<p><strong>Address</strong> - The host name or IP address of the target server.</p>
</div>
<div class="paragraph">
<p><strong>Port</strong> - The port by which to attempt a connection to the target server. The default port is 3260.</p>
</div>
<div class="paragraph">
<p><strong>User Authentication</strong> - The iSCSI server requires User Authentication. The <strong>User Authentication</strong> field is visible when you are using iSCSI external LUNs.</p>
</div>
<div class="paragraph">
<p><strong>CHAP user name</strong> - The user name of a user with permission to log in to LUNs. This field is accessible when the <strong>User Authentication</strong> check box is selected.</p>
</div>
<div class="paragraph">
<p><strong>CHAP password</strong> - The password of a user with permission to log in to LUNs. This field is accessible when the <strong>User Authentication</strong> check box is selected.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Activate Disk(s)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Activate the virtual disk immediately after creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Bootable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to enable the bootable flag on the virtual disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Shareable</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to attach the virtual disk to more than one virtual machine at a time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Read-Only</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to set the disk as read-only. The same disk can be attached as read-only to one virtual machine, and as rewritable to another.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable Discard</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Allows you to shrink a thin provisioned disk while the virtual machine is up. With this option enabled, SCSI UNMAP commands issued from guest virtual machines is passed on by QEMU to the underlying storage to free up the unused space.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Enable SCSI Pass-Through</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Available when the <strong>Interface</strong> is set to <strong>VirtIO-SCSI</strong>. Selecting this check box enables passthrough of a physical SCSI device to the virtual disk. A VirtIO-SCSI interface with SCSI passthrough enabled automatically includes SCSI discard support. <strong>Read-Only</strong> is not supported when this check box is selected.</p>
<p class="tableblock">When this check box is not selected, the virtual disk uses an emulated SCSI device. <strong>Read-Only</strong> is supported on emulated VirtIO-SCSI disks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow Privileged SCSI I/O</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Available when the <strong>Enable SCSI Pass-Through</strong> check box is selected. Selecting this check box enables unfiltered SCSI Generic I/O (SG_IO) access, allowing privileged SG_IO commands on the disk. This is required for persistent reservations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Using SCSI Reservation</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This field only appears when creating an attached disk.</p>
<p class="tableblock">Available when the <strong>Enable SCSI Pass-Through</strong> and <strong>Allow Privileged SCSI I/O</strong> check boxes are selected. Selecting this check box disables migration for any virtual machine using this disk, to prevent virtual machines that are using SCSI reservation from losing access to the disk.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mounting a journaled file system requires read-write access. Using the <strong>Read-Only</strong> option is not appropriate for virtual disks that contain such file systems (e.g. <strong>EXT3</strong>, <strong>EXT4</strong>, or <strong>XFS</strong>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Overview_of_Live_Storage_Migration">13.6.3. Overview of Live Storage Migration</h4>
<div class="paragraph">
<p>Virtual disks can be migrated from one storage domain to another while the virtual machine to which they are attached is running. This is referred to as live storage migration. When a disk attached to a running virtual machine is migrated, a snapshot of that disk&#8217;s image chain is created in the source storage domain, and the entire image chain is replicated in the destination storage domain. As such, ensure that you have sufficient storage space in both the source storage domain and the destination storage domain to host both the disk image chain and the snapshot. A new snapshot is created on each live storage migration attempt, even when the migration fails.</p>
</div>
<div class="paragraph">
<p>Consider the following when using live storage migration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can live migrate multiple disks at one time.</p>
</li>
<li>
<p>Multiple disks for the same virtual machine can reside across more than one storage domain, but the image chain for each disk must reside on a single storage domain.</p>
</li>
<li>
<p>You can live migrate disks between any two storage domains in the same data center.</p>
</li>
<li>
<p>You cannot live migrate direct LUN hard disk images or disks marked as shareable.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Moving_a_Virtual_Disk">13.6.4. Moving a Virtual Disk</h4>
<div class="paragraph">
<p>Move a virtual disk that is attached to a virtual machine or acts as a floating virtual disk from one storage domain to another. You can move a virtual disk that is attached to a running virtual machine; this is referred to as live storage migration. Alternatively, shut down the virtual machine before continuing.</p>
</div>
<div class="paragraph">
<p>Consider the following when moving a disk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can move multiple disks at the same time.</p>
</li>
<li>
<p>You can move disks between any two storage domains in the same data center.</p>
</li>
<li>
<p>If the virtual disk is attached to a virtual machine that was created based on a template and used the thin provisioning storage allocation option, you must copy the disks for the template on which the virtual machine was based to the same storage domain as the virtual disk.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Moving a Virtual Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span> and select one or more virtual disks to move.</p>
</li>
<li>
<p>Click <strong>Move</strong>.</p>
</li>
<li>
<p>From the <strong>Target</strong> list, select the storage domain to which the virtual disk(s) will be moved.</p>
</li>
<li>
<p>From the <strong>Disk Profile</strong> list, select a profile for the disk(s), if applicable.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The virtual disks are moved to the target storage domain. During the move procedure, the <strong>Status</strong> column displays <code>Locked</code> and a progress bar indicating the progress of the move operation.</p>
</div>
</div>
<div class="sect3">
<h4 id="Changing_the_Disk_Interface_Type">13.6.5. Changing the Disk Interface Type</h4>
<div class="paragraph">
<p>Users can change a disk&#8217;s interface type after the disk has been created. This enables you to attach an existing disk to a virtual machine that requires a different interface type. For example, a disk using the <code>VirtIO</code> interface can be attached to a virtual machine requiring the <code>VirtIO-SCSI</code> or <code>IDE</code> interface. This provides flexibility to migrate disks for the purpose of backup and restore, or disaster recovery. The disk interface for shareable disks can also be updated per virtual machine. This means that each virtual machine that uses the shared disk can use a different interface type.</p>
</div>
<div class="paragraph">
<p>To update a disk interface type, all virtual machines using the disk must first be stopped.</p>
</div>
<div class="paragraph">
<p><strong>Changing a Disk Interface Type</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and stop the appropriate virtual machine(s).</p>
</li>
<li>
<p>Click the virtual machine&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab and select the disk.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>From the <strong>Interface</strong> list, select the new interface type and click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can attach a disk to a different virtual machine that requires a different interface type.</p>
</div>
<div class="paragraph">
<p><strong>Attaching a Disk to a Different Virtual Machine using a Different Interface Type</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and stop the appropriate virtual machine(s).</p>
</li>
<li>
<p>Click the virtual machine&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab and select the disk.</p>
</li>
<li>
<p>Click <strong>Remove</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Go back to <strong>Virtual Machines</strong> and click the name of the new virtual machine that the disk will be attached to.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab, then click <strong>Attach</strong>.</p>
</li>
<li>
<p>Select the disk in the <strong>Attach Virtual Disks</strong> window and select the appropriate interface from the <strong>Interface</strong> drop-down.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Copying_a_Virtual_Disk">13.6.6. Copying a Virtual Disk</h4>
<div class="paragraph">
<p>You can copy a virtual disk from one storage domain to another. The copied disk can be attached to virtual machines.</p>
</div>
<div class="paragraph">
<p><strong>Copying a Virtual Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span> and select the virtual disk(s).</p>
</li>
<li>
<p>Click <strong>Copy</strong> .</p>
</li>
<li>
<p>Optionally, enter a new name in the <strong>Alias</strong> field.</p>
</li>
<li>
<p>From the <strong>Target</strong> list, select the storage domain to which the virtual disk(s) will be copied.</p>
</li>
<li>
<p>From the <strong>Disk Profile</strong> list, select a profile for the disk(s), if applicable.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The virtual disks have a status of <code>Locked</code> while being copied.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc_improving_disk_performance">13.6.7. Improving disk performance</h4>
<div class="paragraph">
<p>In the Administration Portal, on the virtual machine&#8217;s <strong>Resource Allocation</strong> tab, the default <strong>I/O Threads Enabled</strong> setting is checked (enabled), and the number of threads is <code>1</code>.</p>
</div>
<div class="paragraph">
<p>Suppose a virtual machine has multiple disks that have VirtIO controllers, and its workloads make significant use of those controllers. In that case, you can improve performance by increasing the number of I/O threads.</p>
</div>
<div class="paragraph">
<p>However, also consider that increasing the number of I/O threads decreases the virtual machine&#8217;s pool of threads. If your workloads do not use the VirtIO controllers and the threads you allocate to them, increasing the number of I/O threads might decrease overall performance.</p>
</div>
<div class="paragraph">
<p>To find the optimal number of threads, benchmark the performance of your virtual machine running workloads before and after you adjust the number of threads.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>, <strong>Power Off</strong> the virtual machine.</p>
</li>
<li>
<p>Click the name of the virtual machine.</p>
</li>
<li>
<p>In the details pane, click the <strong>Vm Devices</strong> tab.</p>
</li>
<li>
<p>Count the number of controllers whose <strong>Type</strong> is <code>virtio</code> or <code>virtio-scsi</code>.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>In the <strong>Edit Virtual Machine</strong> window, click the <strong>Resource Allocation</strong> tab.</p>
</li>
<li>
<p>Confirm that <strong>I/O Threads Enabled</strong> is checked (enabled).</p>
</li>
<li>
<p>To the right of <strong>I/O Threads Enabled</strong>, increase the number of threads, but do not exceed number of controllers whose type is <code>virtio</code> or <code>virtio-scsi</code>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>In the details pane, click the <strong>Disks</strong> tab.</p>
</li>
<li>
<p>For each disk, use <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>) to <strong>Deactivate</strong> and <strong>Activate</strong> the disk. This action remaps the disks to the controllers.</p>
</li>
<li>
<p>Click <b class="button">Run</b> to start the virtual machine.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification steps</div>
<ul>
<li>
<p>To see which controllers have an I/O thread, click <strong>Vm Devices</strong> in the details pane and look for <code>ioThreadid=</code> in the <strong>Spec Params</strong> column.</p>
</li>
<li>
<p>To see the mapping of disks to controllers, log into the host machine and enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># virsh -r dumpxml virtual_machine_name</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#configuring_high_performance_virtual_machines_templates_and_pools">Configuring High-Performance Virtual Machines, Templates, and Pools</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide#Virtual_Machine_Resource_Allocation_settings_explained">Virtual Machine Resource Allocation Settings Explained</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="uploading-images-to-a-data-storage-domain">13.6.8. Uploading Images to a Data Storage Domain</h4>
<div class="paragraph">
<p>You can upload virtual disk images and ISO images to your data storage domain in the Administration Portal or with the REST API. See <a href="#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Importing_a_Disk_Image_from_an_Imported_Storage_Domain">13.6.9. Importing a Disk Image from an Imported Storage Domain</h4>
<div class="paragraph">
<p>Import floating virtual disks from an imported storage domain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only QEMU-compatible disks can be imported into the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Importing a Disk Image</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the name of an imported storage domain. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disk Import</strong> tab.</p>
</li>
<li>
<p>Select one or more disks and click <strong>Import</strong>.</p>
</li>
<li>
<p>Select the appropriate <strong>Disk Profile</strong> for each disk.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Importing_an_Unregistered_Disk_Image_from_an_Imported_Storage_Domain">13.6.10. Importing an Unregistered Disk Image from an Imported Storage Domain</h4>
<div class="paragraph">
<p>Import floating virtual disks from a storage domain. Floating disks created outside of a oVirt environment are not registered with the Engine. Scan the storage domain to identify unregistered floating disks to be imported.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only QEMU-compatible disks can be imported into the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Importing a Disk Image</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Scan Disks</strong> so that the Engine can identify unregistered disks.</p>
</li>
<li>
<p>Click the <strong>Disk Import</strong> tab.</p>
</li>
<li>
<p>Select one or more disk images and click <strong>Import</strong>.</p>
</li>
<li>
<p>Select the appropriate <strong>Disk Profile</strong> for each disk.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Importing_a_Disk_Image_from_an_OpenStack_Image_Service">13.6.11. Importing a Virtual Disk from an OpenStack Image Service</h4>
<div class="paragraph">
<p>Virtual disks managed by an OpenStack Image Service can be imported into the oVirt Engine if that OpenStack Image Service has been added to the Engine as an external provider.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Click the OpenStack Image Service domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Images</strong> tab and select an image.</p>
</li>
<li>
<p>Click <strong>Import</strong>.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> into which the image will be imported.</p>
</li>
<li>
<p>From the <strong>Domain Name</strong> drop-down list, select the storage domain in which the image will be stored.</p>
</li>
<li>
<p>Optionally, select a quota to apply to the image from the <strong>Quota</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The disk can now be attached to a virtual machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Exporting_a_Virtual_Disk_to_an_OpenStack_Image_Service">13.6.12. Exporting a Virtual Disk to an OpenStack Image Service</h4>
<div class="paragraph">
<p>Virtual disks can be exported to an OpenStack Image Service that has been added to the Engine as an external provider.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Virtual disks can only be exported if they do not have multiple volumes, are not thin provisioned, and do not have any snapshots.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Disks</b></span> and select the disks to export.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Export</strong>.</p>
</li>
<li>
<p>From the <strong>Domain Name</strong> drop-down list, select the OpenStack Image Service to which the disks will be exported.</p>
</li>
<li>
<p>From the <strong>Quota</strong> drop-down list, select a quota for the disks if a quota is to be applied.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Reclaiming_virtual_disk_space">13.6.13. Reclaiming Virtual Disk Space</h4>
<div class="paragraph">
<p>Virtual disks that use thin provisioning do not automatically shrink after deleting files from them. For example, if the actual disk size is 100GB and you delete 50GB of files, the allocated disk size remains at 100GB, and the remaining 50GB is not returned to the host, and therefore cannot be used by other virtual machines. This unused disk space can be reclaimed by the host by performing a sparsify operation on the virtual machine&#8217;s disks. This transfers the free space from the disk image to the host. You can sparsify multiple virtual disks in parallel.</p>
</div>
<div class="paragraph">
<p>Perform this operation before cloning a virtual machine, creating a template based on a virtual machine, or cleaning up a storage domain&#8217;s disk space.</p>
</div>
<div class="paragraph">
<p><strong>Limitations</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>NFS storage domains must use NFS version 4.2 or higher.</p>
</li>
<li>
<p>You cannot sparsify a disk that uses a direct LUN.</p>
</li>
<li>
<p>You cannot sparsify a disk that uses a preallocated allocation policy. If you are creating a virtual machine from a template, you must select <strong>Thin</strong> from the <strong>Storage Allocation</strong> field, or if selecting <strong>Clone</strong>, ensure that the template is based on a virtual machine that has thin provisioning.</p>
</li>
<li>
<p>You can only sparsify active snapshots.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Sparsifying a Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and shut down the required virtual machine.</p>
</li>
<li>
<p>Click the virtual machine&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab. Ensure that the disk&#8217;s status is <code>OK</code>.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Sparsify</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A <code>Started to sparsify</code> event appears in the <strong>Events</strong> tab during the sparsify operation and the disk&#8217;s status displays as <code>Locked</code>. When the operation is complete, a <code>Sparsified successfully</code> event appears in the <strong>Events</strong> tab and the disk&#8217;s status displays as <code>OK</code>. The unused disk space has been returned to the host and is available for use by other virtual machines.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-External_Providers">14. External Providers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Introduction_to_Third_Party_Resource_Providers_in_Red_Hat_Enterprise_Virtualization">14.1. Introduction to External Providers in oVirt</h3>
<div class="paragraph">
<p>In addition to resources managed by the oVirt Engine itself, oVirt can also take advantage of resources managed by external sources. The providers of these resources, known as external providers, can provide resources such as virtualization hosts, virtual machine images, and networks.</p>
</div>
<div class="paragraph">
<p>oVirt currently supports the following external providers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Red Hat Satellite for Host Provisioning</strong></dt>
<dd>
<p>Satellite is a tool for managing all aspects of the life cycle of both physical and virtual hosts. In oVirt, hosts managed by Satellite can be added to and used by the oVirt Engine as virtualization hosts. After you add a Satellite instance to the Engine, the hosts managed by the Satellite instance can be added by searching for available hosts on that Satellite instance when adding a new host. For more information on installing Red Hat Satellite and managing hosts using Red Hat Satellite, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.2/html/installation_guide/"><em>Red Hat Satellite Installation Guide</em></a> and <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.2/html/host_configuration_guide/"><em>Red Hat Satellite Host Configuration Guide</em></a>.</p>
</dd>
</dl>
</div>
<div id="providers-kubevirt-openshift-virtualization" class="dlist">
<dl>
<dt class="hdlist1"><strong>KubeVirt/Openshift Virtualization</strong></dt>
<dd>
<p>Openshift Virtualization (formerly container-native virtualization or "CNV") enables you to bring virtual machines (VMs) into containerized workflows so you can develop, manage, and deploy virtual machines side-by-side with containers and serverless. In oVirt Engine, adding this provider is one of the requirements for using {container-platform-virt}. For details, see <a href="#proc-adding-kubevirt-openshift-as-an-external-provider_external_providers">Adding KubeVirt/Openshift Virtualization as an external provider</a>.</p>
</dd>
<dt class="hdlist1"><strong>OpenStack Image Service (Glance) for Image Management</strong></dt>
<dd>
<p>OpenStack Image Service provides a catalog of virtual machine images. In oVirt, these images can be imported into the oVirt Engine and used as floating disks or attached to virtual machines and converted into templates. After you add an OpenStack Image Service to the Engine, it appears as a storage domain that is not attached to any data center. Virtual disks in a oVirt environment can also be exported to an OpenStack Image Service as virtual disks.</p>
</dd>
<dt class="hdlist1"><strong>VMware for Virtual Machine Provisioning</strong></dt>
<dd>
<p>Virtual machines created in VMware can be converted using V2V (<code>virt-v2v</code>) and imported into a oVirt environment. After you add a VMware provider to the Engine, you can import the virtual machines it provides. V2V conversion is performed on a designated proxy host as part of the import operation.</p>
</dd>
<dt class="hdlist1"><strong>RHEL 5 Xen for Virtual Machine Provisioning</strong></dt>
<dd>
<p>Virtual machines created in RHEL 5 Xen can be converted using V2V (<code>virt-v2v</code>) and imported into a oVirt environment. After you add a RHEL 5 Xen host to the Engine, you can import the virtual machines it provides. V2V conversion is performed on a designated proxy host as part of the import operation.</p>
</dd>
<dt class="hdlist1"><strong>KVM for Virtual Machine Provisioning</strong></dt>
<dd>
<p>Virtual machines created in KVM can be imported into a oVirt environment. After you add a KVM host to the Engine, you can import the virtual machines it provides.</p>
</dd>
<dt class="hdlist1"><strong>Open Virtual Network (OVN) for Network Provisioning</strong></dt>
<dd>
<p>Open Virtual Network (OVN) is an Open vSwitch (OVS) extension that provides software-defined networks. After you add OVN to the Engine, you can import existing OVN networks, and create new OVN networks from the Engine. You can also automatically install OVN on the Engine using <code>engine-setup</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="sect-Adding_External_Providers">14.2. Adding External Providers</h3>
<div class="sect3">
<h4 id="Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">14.2.1. Adding a Red Hat Satellite Instance for Host Provisioning</h4>
<div class="paragraph">
<p>Add a Satellite instance for host provisioning to the oVirt Engine. oVirt 4.2 is supported with Red Hat Satellite 6.1.</p>
</div>
<div class="paragraph">
<p><strong>Adding a Satellite Instance for Host Provisioning</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>Foreman/Satellite</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Enter the URL or fully qualified domain name of the machine on which the Satellite instance is installed in the <strong>Provider URL</strong> text field. You do not need to specify a port number.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>IP addresses cannot be used to add a Satellite instance.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the <strong>Requires Authentication</strong> check box.</p>
</li>
<li>
<p>Enter the <strong>Username</strong> and <strong>Password</strong> for the Satellite instance. You must use the same user name and password as you would use to log in to the Satellite provisioning portal.</p>
</li>
<li>
<p>Test the credentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the Satellite instance using the provided credentials.</p>
</li>
<li>
<p>If the Satellite instance uses SSL, the <strong>Import provider certificates</strong> window opens; click <b class="button">OK</b> to import the certificate that the Satellite instance provides to ensure the Engine can communicate with the instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Adding_an_OpenStack_Image_Service_Glance_for_Image_Management">14.2.2. Adding an OpenStack Image (Glance) Instance for Image Management</h4>
<div class="paragraph">
<p>Add an OpenStack Image (Glance) instance for image management to the oVirt Engine.</p>
</div>
<div class="paragraph">
<p><strong>Adding an OpenStack Image (Glance) Instance for Image Management</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong> and enter the details in the <strong>General Settings</strong> tab. For more information on these fields, see <a href="#Add_Provider_General_Settings_Explained">Add Provider General Settings Explained</a>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>OpenStack Image</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Enter the URL or fully qualified domain name of the machine on which the OpenStack Image instance is installed in the <strong>Provider URL</strong> text field.</p>
</li>
<li>
<p>Optionally, select the <strong>Requires Authentication</strong> check box and enter the <strong>Username</strong> and <strong>Password</strong> for the OpenStack Image instance user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <strong>Protocol</strong> (must be <code>HTTP</code>), <strong>Hostname</strong>, and <strong>API Port.</strong></p>
<div class="paragraph">
<p>Enter the <strong>Tenant</strong> for the OpenStack Image instance.</p>
</div>
</li>
<li>
<p>Test the credentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the OpenStack Image instance using the provided credentials.</p>
</li>
<li>
<p>If the OpenStack Image instance uses SSL, the <strong>Import provider certificates</strong> window opens. Click <b class="button">OK</b> to import the certificate that the OpenStack Image instance provides to ensure the Engine can communicate with the instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-adding-kubevirt-openshift-as-an-external-provider_external_providers">14.2.3. Adding KubeVirt/Openshift Virtualization as an external provider</h4>
<div class="paragraph">
<p>To run virtual machines in a container on the OKD, you add OpenShift as an external provider in Red Hat Virtualization.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This capability is known as <em>OpenShift Virtualization</em>.
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/virt/install/preparing-cluster-for-virt.html">In OpenShift Container Platform, your cluster is configured for OpenShift Virtualization</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the oVirt Administration Portal, go to <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span> and click <b class="button">New</b>.</p>
</li>
<li>
<p>In <strong>Add Provider</strong>, set <strong>Type</strong> to <strong>KubeVirt/Openshift Virtualization</strong>.</p>
</li>
<li>
<p>Enter the <strong>Provider URL</strong> and <strong>Token</strong>, which are required.</p>
</li>
<li>
<p>Optional: Enter values for <strong>Advanced parameters</strong> such as <strong>Certificate Authority</strong>, <strong>Prometheus URL</strong>, and <strong>Prometheus Certificate Authority</strong>.</p>
</li>
<li>
<p>Click <b class="button">Test</b> to verify the connection to the new provider.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to finish adding this new provider.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Verification steps</div>
<ol class="arabic">
<li>
<p>In the oVirt Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the name of new cluster you just created. This cluster name, <strong>kubevirt</strong> for example, is based on the name of the provider. This action opens the cluster details view.</p>
</li>
<li>
<p>Click the <strong>Hosts</strong> tab to verify that the OKD status of the worker nodes is up.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Even if they are running, the status of the master nodes is down because they cannot host virtual machines.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> to deploy a virtual machine to the new cluster.</p>
</li>
<li>
<p>In the OKD web console, in the <strong>Administrator</strong> perspective, use <span class="menuseq"><b class="menu">Workloads</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> to view the virtual machine you deployed.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/virt/about-virt.html">About OpenShift Virtualization</a></p>
</li>
<li>
<p><a href="#Add_Provider_General_Settings_Explained">Add Provider General Settings Explained</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Adding_a_VMware_Instance_as_a_Virtual_Machine_Provider">14.2.4. Adding a VMware Instance as a Virtual Machine Provider</h4>
<div class="paragraph">
<p>Add a VMware vCenter instance to import virtual machines from VMware to the oVirt Engine.</p>
</div>
<div class="paragraph">
<p>oVirt uses V2V to convert VMware virtual machines to the correct format before they are imported. The <code>virt-v2v</code> package must be installed on at least one host. The <code>virt-v2v</code> package is available by default on oVirt Nodes (oVirt Node) and is installed on Enterprise Linux hosts as a dependency of VDSM when added to the oVirt environment. Enterprise Linux hosts must be Enterprise Linux 7.2 or later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>virt-v2v</code> package is not available on ppc64le architecture; these hosts cannot be used as proxy hosts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Adding a VMware vCenter Instance as a Virtual Machine Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>VMware</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> into which VMware virtual machines will be imported, or select <strong>Any Data Center</strong> to instead specify the destination data center during individual import operations.</p>
</li>
<li>
<p>Enter the IP address or fully qualified domain name of the VMware vCenter instance in the <strong>vCenter</strong> field.</p>
</li>
<li>
<p>Enter the IP address or fully qualified domain name of the host from which the virtual machines will be imported in the <strong>ESXi</strong> field.</p>
</li>
<li>
<p>Enter the name of the data center in which the specified ESXi host resides in the <strong>Data Center</strong> field.</p>
</li>
<li>
<p>If you have exchanged the SSL certificate between the ESXi host and the Engine, leave the <strong>Verify server&#8217;s SSL certificate</strong> check box selected to verify the ESXi host&#8217;s certificate. If not, clear the check box.</p>
</li>
<li>
<p>Select a host in the chosen data center with <code>virt-v2v</code> installed to serve as the <strong>Proxy Host</strong> during virtual machine import operations. This host must also be able to connect to the network of the VMware vCenter external provider. If you selected <strong>Any Data Center</strong> above, you cannot choose the host here, but instead can specify a host during individual import operations.</p>
</li>
<li>
<p>Enter the <strong>Username</strong> and <strong>Password</strong> for the VMware vCenter instance. The user must have access to the VMware data center and ESXi host on which the virtual machines reside.</p>
</li>
<li>
<p>Test the credentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the VMware vCenter instance using the provided credentials.</p>
</li>
<li>
<p>If the VMware vCenter instance uses SSL, the <strong>Import provider certificates</strong> window opens; click <b class="button">OK</b> to import the certificate that the VMware vCenter instance provides to ensure the Engine can communicate with the instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To import virtual machines from the VMware external provider, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_VMware_Provider">Importing a Virtual Machine from a VMware Provider</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_Xen_as_an_External_Provider">14.2.5. Adding a RHEL 5 Xen Host as a Virtual Machine Provider</h4>
<div class="paragraph">
<p>Add a RHEL 5 Xen host to import virtual machines from Xen to oVirt.</p>
</div>
<div class="paragraph">
<p>oVirt uses V2V to convert RHEL 5 Xen virtual machines to the correct format before they are imported. The <code>virt-v2v</code> package must be installed on at least one host. The <code>virt-v2v</code> package is available by default on oVirt Nodes (oVirt Node) and is installed on Enterprise Linux hosts as a dependency of VDSM when added to the oVirt environment. Enterprise Linux hosts must be Enterprise Linux 7.2 or later.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>virt-v2v</code> package is not available on ppc64le architecture; these hosts cannot be used as proxy hosts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Adding a RHEL 5 Xen Instance as a Virtual Machine Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable public key authentication between the proxy host and the RHEL 5 Xen host:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in to the proxy host and generate SSH keys for the <strong>vdsm</strong> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the <strong>vdsm</strong> user&#8217;s public key to the RHEL 5 Xen host. The proxy host&#8217;s <strong>known_hosts</strong> file will also be updated to include the host key of the RHEL 5 Xen host.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh-copy-id root@<em>xenhost.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>Log in to the RHEL 5 Xen host to verify that the login works correctly.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh root@<em>xenhost.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>XEN</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> into which Xen virtual machines will be imported, or select <strong>Any Data Center</strong> to specify the destination data center during individual import operations.</p>
</li>
<li>
<p>Enter the URI of the RHEL 5 Xen host in the <strong>URI</strong> field.</p>
</li>
<li>
<p>Select a host in the chosen data center with <code>virt-v2v</code> installed to serve as the <strong>Proxy Host</strong> during virtual machine import operations. This host must also be able to connect to the network of the RHEL 5 Xen external provider. If you selected <strong>Any Data Center</strong> above, you cannot choose the host here, but instead can specify a host during individual import operations.</p>
</li>
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the RHEL 5 Xen host.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To import virtual machines from a RHEL 5 Xen external provider, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_Xen">Importing a Virtual Machine from a RHEL 5 Xen Host</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_KVM_as_an_External_Provider">14.2.6. Adding a KVM Host as a Virtual Machine Provider</h4>
<div class="paragraph">
<p>Add a KVM host to import virtual machines from KVM to oVirt Engine.</p>
</div>
<div class="paragraph">
<p><strong>Adding a KVM Host as a Virtual Machine Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable public key authentication between the proxy host and the KVM host:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Log in to the proxy host and generate SSH keys for the <strong>vdsm</strong> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh-keygen</pre>
</div>
</div>
</li>
<li>
<p>Copy the <strong>vdsm</strong> user&#8217;s public key to the KVM host. The proxy host&#8217;s <strong>known_hosts</strong> file will also be updated to include the host key of the KVM host.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh-copy-id root@<em>kvmhost.example.com</em></pre>
</div>
</div>
</li>
<li>
<p>Log in to the KVM host to verify that the login works correctly.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sudo -u vdsm ssh root@<em>kvmhost.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>KVM</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Select the <strong>Data Center</strong> into which KVM virtual machines will be imported, or select <strong>Any Data Center</strong> to specify the destination data center during individual import operations.</p>
</li>
<li>
<p>Enter the URI of the KVM host in the <strong>URI</strong> field.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">qemu+ssh://root@host.example.com/system</pre>
</div>
</div>
</li>
<li>
<p>Select a host in the chosen data center to serve as the <strong>Proxy Host</strong> during virtual machine import operations. This host must also be able to connect to the network of the KVM external provider. If you selected <strong>Any Data Center</strong> in the <strong>Data Center</strong> field above, you cannot choose the host here. The field is greyed out and shows <strong>Any Host in Data Center</strong>. Instead you can specify a host during individual import operations.</p>
</li>
<li>
<p>Optionally, select the <strong>Requires Authentication</strong> check box and enter the <strong>Username</strong> and <strong>Password</strong> for the KVM host. The user must have access to the KVM host on which the virtual machines reside.</p>
</li>
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the KVM host using the provided credentials.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To import virtual machines from a KVM external provider, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_KVM">Importing a Virtual Machine from a KVM Host</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_OVN_as_an_External_Network_Provider">14.2.7. Adding Open Virtual Network (OVN) as an External Network Provider</h4>
<div class="paragraph">
<p>You can use Open Virtual Network (OVN) to create overlay virtual networks that enable communication among the virtual machines without adding VLANs or changing the infrastructure. OVN is an extension of Open vSwitch (OVS) that provides native support for virtual L2 and L3 overlays.</p>
</div>
<div class="paragraph">
<p>You can <a href="#Installing_a_new_OVN_network_provider">install a new OVN network provider</a> or <a href="#Adding_an_existing_OVN_network_provider">add an existing one</a>.</p>
</div>
<div class="paragraph">
<p>You can also connect an OVN network to a native oVirt network. See <a href="#Connecting_an_OVN_Network_to_a_Physical_Network">Connecting an OVN Network to a Physical Network</a> for more information.</p>
</div>
<div class="paragraph">
<p>The <code>ovirt-provider-ovn</code> exposes an OpenStack Networking REST API. You can use this API to create networks, subnets, ports, and routers. For details, see <a href="https://developer.openstack.org/api-ref/network/v2/"><em>OpenStack Networking API v2.0</em></a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>CloudForms supports OVN as an external provider using the OpenStack Networking API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_cloudforms/5.0/html/managing_providers/network_providers">Network Managers</a> in <em>Red Hat CloudForms: Managing Providers</em> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more details, see the <a href="http://docs.openvswitch.org/en/latest/">Open vSwitch Documentation</a> and <a href="http://openvswitch.org/support/dist-docs/">Open vSwitch Manpages</a>.</p>
</div>
<div class="sect4">
<h5 id="Installing_a_new_OVN_network_provider">Installing a New OVN Network Provider</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>openvswitch</code> package is already installed and if the version is 1:2.6.1 (version 2.6.1, epoch 1), the OVN installation will fail when it tries to install the latest <code>openvswitch</code> package. See the Doc Text in <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1505398">BZ#1505398</a> for the details and a workaround.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Installing OVN using <code>engine-setup</code> performs the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sets up an OVN central server on the Engine machine.</p>
</li>
<li>
<p>Adds OVN to oVirt as an external network provider.</p>
</li>
<li>
<p>On the Default cluster only, sets the <strong>Default Network Provider</strong> to <code>ovirt-provider-ovn</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Installing OVN changes the <strong>Default Network Provider</strong> setting on the Default cluster only, not on other clusters.</p>
</li>
<li>
<p>Changing the <strong>Default Network Provider</strong> setting does not update hosts in that cluster to use the <strong>Default Network Provider</strong>.</p>
</li>
<li>
<p>For hosts and virtual machines to use OVN, perform the addition tasks described in the "Next steps" at the end of this topic.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Optional: If you use a preconfigured answer file with <code>engine-setup</code>, add the following entry to install OVN:</p>
<div class="listingblock">
<div class="content">
<pre>OVESETUP_OVN/ovirtProviderOvn=bool:True</pre>
</div>
</div>
</li>
<li>
<p>Run <code>engine-setup</code> on the Engine machine.</p>
</li>
<li>
<p>If you do not use a preconfigured answer file, answer <code>Yes</code> when the <code>engine-setup</code> asks:</p>
<div class="listingblock">
<div class="content">
<pre>Configuring ovirt-provider-ovn also sets the Default cluster's default network provider to ovirt-provider-ovn.
Non-Default clusters may be configured with an OVN after installation.
Configure ovirt-provider-ovn (Yes, No) [Yes]:</pre>
</div>
</div>
</li>
<li>
<p>Answer the following question:</p>
<div class="listingblock">
<div class="content">
<pre>Use default credentials (admin@internal) for ovirt-provider-ovn (Yes, No) [Yes]?:</pre>
</div>
</div>
<div class="paragraph">
<p>If <code>Yes</code>, <code>engine-setup</code> uses the default engine user and password specified earlier in the setup process. This option is only available during new installations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oVirt OVN provider user[admin]:
oVirt OVN provider password[empty]:</pre>
</div>
</div>
<div class="paragraph">
<p>You can use the default values or specify the oVirt OVN provider user and password.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To change the authentication method later, you can edit the <code>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</code> file, or create a new <code>/etc/ovirt-provider-ovn/conf.d/20_engine_setup.conf</code> file. Restart the <code>ovirt-provider-ovn</code> service for the change to take effect. See <a href="https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc" class="bare">https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc</a> for more information about OVN authentication.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Installing-OVN-next-steps" class="paragraph">
<div class="title">Next steps</div>
<p>Before you can create virtual machines that use a newly-installed OVN network, complete these additional steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Creating_a_new_logical_network_in_a_data_center_or_cluster">Add a network to the <strong>Default</strong> cluster</a>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>While doing so, select the <strong>Create on external provider</strong> check box. This creates a network based on <code>ovirt-provider-ovn</code>.</p>
</li>
<li>
<p>Optional: To <a href="#Connecting_an_OVN_Network_to_a_Physical_Network">connect the OVN network to a physical network</a>, select the <strong>Connect to physical network</strong> check box and specify the oVirt network to use.</p>
</li>
<li>
<p>Optional: Determine whether the network should use a security group and select one from the <strong>Security Groups</strong> drop-down. For more information on the available options see <a href="#Logical_Network_General_Settings_Explained">Logical Network General Settings Explained</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p><a href="#Adding_standard_hosts_to_the_Manager_host_tasks">Add hosts to</a> or <a href="#Reinstalling_Hosts_admin">reinstall the hosts on</a> the Default cluster so they use the cluster&#8217;s new <strong>Default Network Provider</strong>, <code>ovirt-provider-ovn</code>.</p>
</li>
<li>
<p>Optional: Edit non-Default clusters and set <strong>Default Network Provider</strong> to <code>ovirt-provider-ovn</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Optional: Reinstall the hosts on each non-Default cluster so they use the cluster&#8217;s new <strong>Default Network Provider</strong>, <code>ovirt-provider-ovn</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p>To configure your hosts to use an existing, non-default network, see <a href="#Configuring_Hosts_for_an_OVN_tunnel_network">Configuring Hosts for an OVN Tunnel Network</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="Adding_an_existing_OVN_network_provider">Adding an Existing OVN Network Provider</h5>
<div class="paragraph">
<p>Adding an existing OVN central server as an external network provider in oVirt involves the following key steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the OVN provider, a proxy used by the Engine to interact with OVN. The OVN provider can be installed on any machine, but must be able to communicate with the OVN central server and the Engine.</p>
</li>
<li>
<p>Add the OVN provider to oVirt as an external network provider.</p>
</li>
<li>
<p>Create a new cluster that uses OVN as its default network provider. Hosts added to this cluster are automatically configured to communicate with OVN.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>The following packages are required by the OVN provider and must be available on the provider machine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>openvswitch-ovn-central</p>
</li>
<li>
<p>openvswitch</p>
</li>
<li>
<p>openvswitch-ovn-common</p>
</li>
<li>
<p>python-openvswitch</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If these packages are not available from the repositories already enabled on the provider machine, they can be downloaded from the OVS website: <a href="http://openvswitch.org/download/" class="bare">http://openvswitch.org/download/</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install and configure the OVN provider.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Install the provider on the provider machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-provider-ovn</pre>
</div>
</div>
</li>
<li>
<p>If you are not installing the provider on the same machine as the Engine, add the following entry to the <code>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</code> file (create this file if it does not already exist):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OVIRT]
ovirt-host=https://<em>Manager_host_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>This is used for authentication, if authentication is enabled.</p>
</div>
</li>
<li>
<p>If you are not installing the provider on the same machine as the OVN central server, add the following entry to the <code>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</code> file (create this file if it does not already exist):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[OVN REMOTE]
ovn-remote=tcp:<em>OVN_central_server_IP</em>:6641</pre>
</div>
</div>
</li>
<li>
<p>Open ports 9696, 6641, and 6642 in the firewall to allow communication between the OVN provider, the OVN central server, and the Engine. This can be done either manually or by adding the <code>ovirt-provider-ovn</code> and <code>ovirt-provider-ovn-central</code> services to the appropriate zone:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --zone=<em>ZoneName</em> --add-service=ovirt-provider-ovn --permanent
# firewall-cmd --zone=<em>ZoneName</em> --add-service=ovirt-provider-ovn-central --permanent
# firewall-cmd --reload</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start ovirt-provider-ovn
# systemctl enable ovirt-provider-ovn</pre>
</div>
</div>
</li>
<li>
<p>Configure the OVN central server to listen to requests from ports 6642 and 6641:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovn-sbctl set-connection ptcp:6642
# ovn-nbctl set-connection ptcp:6641</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong> and enter the details in the <strong>General Settings</strong> tab. For more information on these fields, see <a href="#Add_Provider_General_Settings_Explained">Add Provider General Settings Explained</a>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>From the <strong>Type</strong> list, select <strong>External Network Provider</strong>.</p>
</li>
<li>
<p>Click the <strong>Networking Plugin</strong> text box and select <strong>oVirt Network Provider for OVN</strong> from the drop-down menu.</p>
</li>
<li>
<p>Optionally, select the <strong>Automatic Synchronization</strong> check box. This enables automatic synchronization of the external network provider with existing networks.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic synchronization is enabled by default on the <strong>ovirt-provider-ovn</strong> network provider created by the <strong>engine-setup</strong> tool.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the URL or fully qualified domain name of the OVN provider in the <strong>Provider URL</strong> text field, followed by the port number. If the OVN provider and the OVN central server are on separate machines, this is the URL of the provider machine, not the central server. If the OVN provider is on the same machine as the Engine, the URL can remain the default <code>http://localhost:9696</code>.</p>
</li>
<li>
<p>Clear the <strong>Read-Only</strong> check box to allow creating new OVN networks from the oVirt Engine.</p>
</li>
<li>
<p>Optionally, select the <strong>Requires Authentication</strong> check box and enter the <strong>Username</strong> and <strong>Password</strong> for the for the external network provider user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <strong>Protocol</strong>, <strong>Hostname</strong>, and <strong>API Port</strong>.</p>
<div class="paragraph">
<p>Optionally, enter the <strong>Tenant</strong> for the external network provider.</p>
</div>
<div class="paragraph">
<p>The authentication method must be configured in the <code>/etc/ovirt-provider-ovn/conf.d/10_engine_setup.conf</code> file (create this file if it does not already exist). Restart the <code>ovirt-provider-ovn</code> service for the change to take effect. See <a href="https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc" class="bare">https://github.com/oVirt/ovirt-provider-ovn/blob/master/README.adoc</a> for more information about OVN authentication.</p>
</div>
</li>
<li>
<p>Test the credentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with OVN using the provided credentials.</p>
</li>
<li>
<p>If the OVN instance uses SSL, the <strong>Import provider certificates</strong> window opens; click <b class="button">OK</b> to import the certificate that the OVN instance provides to ensure the Engine can communicate with the instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Create a new cluster that uses OVN as its default network provider. See <a href="#Creating_a_New_Cluster">Creating a New Cluster</a> and select the OVN network provider from the <strong>Default Network Provider</strong> drop-down list.</p>
</li>
<li>
<p>Add hosts to the cluster. Hosts added to this cluster are automatically configured to communicate with OVN. To add new hosts, see <a href="#Adding_standard_hosts_to_the_Manager_host_tasks">Adding Standard Hosts to the oVirt Engine</a>.</p>
</li>
<li>
<p>Import or add OVN networks to the new cluster. To import networks, see <a href="#Importing_Networks">Importing Networks</a>. To create new networks using OVN, see <a href="#Creating_a_new_logical_network_in_a_data_center_or_cluster">Creating a new logical network in a data center or cluster</a>, and select the <strong>Create on external provider</strong> check box. <code>ovirt-provider-ovn</code> is selected by default.</p>
<div class="paragraph">
<p>To configure your hosts to use an existing, non-default network, see <a href="#Configuring_Hosts_for_an_OVN_tunnel_network">Configuring Hosts for an OVN Tunnel Network</a>.</p>
</div>
<div class="paragraph">
<p>To connect the OVN network to a native oVirt network, select the <strong>Connect to physical network</strong> check box and specify the oVirt network to use. See <a href="#Connecting_an_OVN_Network_to_a_Physical_Network">Connecting an OVN Network to a Physical Network</a> for more information and prerequisites.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now create virtual machines that use OVN networks.</p>
</div>
</div>
<div class="sect4">
<h5 id="Using_an_Ansible_playbook_to_modify_an_OVN_tunnel_network">Using an Ansible playbook to modify an OVN tunnel network</h5>
<div class="paragraph">
<p>You can use the <code>ovirt-provider-ovn-driver</code> Ansible playbook to use long names to modify the tunnel network for OVN controllers.</p>
</div>
<div class="paragraph">
<p><strong>Ansible playbook to modify an OVN tunnel network</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --key-file &lt;path_to_key_file&gt; -i &lt;path_to_inventory&gt; --extra-vars " cluster_name=&lt;cluster_name&gt; ovn_central=&lt;ovn_central_ip_address&gt; ovirt_network=&lt;ovirt network name&gt; ovn_tunneling_interface=&lt;vdsm_network_name&gt;" ovirt-provider-ovn-driver.yml</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Parameters</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">key-file</dt>
<dd>
<p>The key file to log into the host. The default key file is usually found in the <code>/etc/pki/ovirt-engine/keys</code> directory.</p>
</dd>
<dt class="hdlist1">inventory</dt>
<dd>
<p>The oVirt VM inventory. To locate the inventory value, use this script: <code>/usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory</code>.</p>
</dd>
<dt class="hdlist1">cluster_name</dt>
<dd>
<p>The name of the cluster on which to update the name.</p>
</dd>
<dt class="hdlist1">ovn_central</dt>
<dd>
<p>The IP address to the OVN central server. This IP address must be accessible to all hosts.</p>
</dd>
<dt class="hdlist1">ovirt_network</dt>
<dd>
<p>The oVirt network name.</p>
</dd>
<dt class="hdlist1">ovn_tunneling_interface</dt>
<dd>
<p>The VDSM network name.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ovirt-provider-ovn-driver</code> Ansible playbook supports using either the <code>ovirt_network</code> parameter or the <code>ovn_tunneling_interface</code> parameter. This playbook fails if both parameters are present in the same playbook.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Playbook with <code>ovirt_network</code> parameter</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --key-file /etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars " cluster_name=test-cluster ovn_central=192.168.200.2 ovirt_network=\"Long\ Network\ Name\ with\ \Ascii\ character\ \\"" ovirt-provider-ovn-driver.yml</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Playbook with <code>ovn_tunneling_interface</code> parameter</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --key-file /etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars " cluster_name=test-cluster ovn_central=192.168.200.2 ovn_tunneling_interface=on703ea21ddbc34" ovirt-provider-ovn-driver.yml</pre>
</div>
</div>
<div class="paragraph">
<p>On the Engine machine, navigate to the <code>/usr/share/ovirt-engine/playbooks</code> directory to run the Ansible playbooks.</p>
</div>
</div>
<div class="sect4">
<h5 id="Configuring_Hosts_for_an_OVN_tunnel_network">Configuring Hosts for an OVN Tunnel Network</h5>
<div class="paragraph">
<p>You can configure your hosts to use an existing network, other than the default <code>ovirtmgmt</code> network, with the <code>ovirt-provider-ovn-driver</code> Ansible playbook. The network must be accessible to all the hosts in the cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ovirt-provider-ovn-driver</code> Ansible playbook updates existing hosts. If you add new hosts to the cluster, you must run the playbook again.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring Hosts for an OVN Tunnel Network</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, go to the <strong>playbooks</strong> directory:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cd /usr/share/ovirt-engine/playbooks</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>ansible-playbook</code> command with the following parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --private-key=/etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars "&#160;cluster_name=<em>Cluster_Name</em> ovn_central=<em>OVN_Central_IP</em> ovn_tunneling_interface=<em>VDSM_Network_Name</em>" ovirt-provider-ovn-driver.yml</pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ansible-playbook --private-key=/etc/pki/ovirt-engine/keys/engine_id_rsa -i /usr/share/ovirt-engine-metrics/bin/ovirt-engine-hosts-ansible-inventory --extra-vars "&#160;cluster_name=MyCluster ovn_central=192.168.0.1 ovn_tunneling_interface=MyNetwork" ovirt-provider-ovn-driver.yml</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <em>OVN_Central_IP</em> can be on the new network, but this is not a requirement. The <em>OVN_Central_IP</em> must be accessible to all hosts.</p>
</div>
<div class="paragraph">
<p>The <em>VDSM_Network_Name</em> is limited to 15 characters. If you defined a logical network name that was longer than 15 characters or contained non-ASCII characters, a 15-character name is automatically generated. See <a href="#Vdsm_To_Network_Mapping_Tool">Mapping VDSM Names to Logical Network Names</a> for instructions on displaying a mapping of these names.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Updating the OVN Tunnel Network on a Single Host</strong></p>
</div>
<div class="paragraph">
<p>You can update the OVN tunnel network on a single host with <code>vdsm-tool</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vdsm-tool ovn-config <em>OVN_Central_IP</em> <em>Tunneling_IP_or_Network_Name</em></pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 9. Updating a Host with <code>vdsm-tool</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vdsm-tool ovn-config 192.168.0.1 MyNetwork</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="Connecting_an_OVN_Network_to_a_Physical_Network">Connecting an OVN Network to a Physical Network</h5>
<div class="paragraph">
<p>You can create an external provider network that overlays a native oVirt network so that the virtual machines on each appear to be sharing the same subnet.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you created a subnet for the OVN network, a virtual machine using that network will receive an IP address from there. If you want the physical network to allocate the IP address, do not create a subnet for the OVN network.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The cluster must have <strong>OVS</strong> selected as the <strong>Switch Type</strong>. Hosts added to this cluster must not have any pre-existing oVirt networks configured, such as the <strong>ovirtmgmt</strong> bridge.</p>
</li>
<li>
<p>The physical network must be available on the hosts. You can enforce this by setting the physical network as required for the cluster (in the <strong>Manage Networks</strong> window, or the <strong>Cluster</strong> tab of the <strong>New Logical Network</strong> window).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Creating a New External Network Connected to a Physical Network</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Click the cluster&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Logical Networks</strong> tab and click <strong>Add Network</strong>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> for the network.</p>
</li>
<li>
<p>Select the <strong>Create on external provider</strong> check box. <code>ovirt-provider-ovn</code> is selected by default.</p>
</li>
<li>
<p>Select the <strong>Connect to physical network</strong> check box if it is not already selected by default.</p>
</li>
<li>
<p>Choose the physical network to connect the new network to:</p>
<div class="ulist">
<ul>
<li>
<p>Click the <strong>Data Center Network</strong> radio button and select the physical network from the drop-down list. This is the recommended option.</p>
</li>
<li>
<p>Click the <strong>Custom</strong> radio button and enter the name of the physical network. If the physical network has VLAN tagging enabled, you must also select the <strong>Enable VLAN tagging</strong> check box and enter the physical network&#8217;s VLAN tag.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The physical network&#8217;s name must not be longer than 15 characters, or contain special characters.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Adding_an_External_Network_Provider">14.2.8. Adding an External Network Provider</h4>
<div class="paragraph">
<p>Any network provider that implements the OpenStack Networking REST API can be added to oVirt. The virtual interface driver needs to be provided by the implementer of the external network provider. A reference implementation of a network provider and a virtual interface driver are available at <a href="https://github.com/mmirecki/ovirt-provider-mock" class="bare">https://github.com/mmirecki/ovirt-provider-mock</a> and <a href="https://github.com/mmirecki/ovirt-provider-mock/blob/master/docs/driver_instalation" class="bare">https://github.com/mmirecki/ovirt-provider-mock/blob/master/docs/driver_instalation</a>.</p>
</div>
<div class="paragraph">
<p><strong>Adding an External Network Provider for Network Provisioning</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong> and enter the details in the <strong>General Settings</strong> tab. For more information on these fields, see <a href="#Add_Provider_General_Settings_Explained">Add Provider General Settings Explained</a>.</p>
</li>
<li>
<p>Enter a <strong>Name</strong> and <strong>Description</strong>.</p>
</li>
<li>
<p>Select <strong>External Network Provider</strong> from the <strong>Type</strong> drop-down list.</p>
</li>
<li>
<p>Optionally, click the <strong>Networking Plugin</strong> text box and select the appropriate driver from the drop-down menu.</p>
</li>
<li>
<p>Optionally, select the <strong>Automatic Synchronization</strong> check box. This enables automatic synchronization of the external network provider with existing networks. This feature is disabled by default when adding external network providers.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automatic synchronization is enabled by default on the <strong>ovirt-provider-ovn</strong> network provider created by the <strong>engine-setup</strong> tool.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the URL or fully qualified domain name of the machine on which the external network provider is installed in the <strong>Provider URL</strong> text field, followed by the port number. The <strong>Read-Only</strong> check box is selected by default. This prevents users from modifying the external network provider.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must leave the <strong>Read-Only</strong> check box selected for your setup to be supported by Red Hat.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, select the <strong>Requires Authentication</strong> check box and enter the <strong>Username</strong> and <strong>Password</strong> for the external network provider user registered in Keystone.
You must also define the authentication URL of the Keystone server by defining the <strong>Protocol</strong>, <strong>Hostname</strong>, and <strong>API Port</strong>.</p>
<div class="paragraph">
<p>Optionally, enter the <strong>Tenant</strong> for the external network provider.</p>
</div>
</li>
<li>
<p>Test the credentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Test</strong> to test whether you can authenticate successfully with the external network provider using the provided credentials.</p>
</li>
<li>
<p>If the external network provider uses SSL, the <strong>Import provider certificates</strong> window opens; click <b class="button">OK</b> to import the certificate that the external network provider provides to ensure the Engine can communicate with the instance.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Before you can use networks from this provider, you must install the virtual interface driver on the hosts and import the networks. To import networks, see <a href="#Importing_Networks">Importing Networks From External Providers</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Add_Provider_General_Settings_Explained">14.2.9. Add Provider General Settings Explained</h4>
<div class="paragraph">
<p>The <strong>General</strong> tab in the <strong>Add Provider</strong> window allows you to register the core details of the external provider.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. Add Provider: General Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A name to represent the provider in the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A plain text, human-readable description of the provider.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The type of external provider. Changing this setting alters the available fields for configuring the provider.</p>
</div>
<div class="paragraph">
<p><strong>External Network Provider</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Networking Plugin</strong>: Determines which implementation of the driver will be used on the host to handle NIC operations. If an external network provider with the <code>oVirt Network Provider for OVN</code> plugin is added as the default network provider for a cluster, this also determines which driver will be installed on hosts added to the cluster.</p>
</li>
<li>
<p><strong>Automatic Synchronization</strong>: Allows you to specify whether the provider will be automatically synchronized with existing networks.</p>
</li>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name of the machine on which the external network provider is hosted. You must add the port number for the external network provider to the end of the URL or fully qualified domain name. By default, this port number is 9696.</p>
</li>
<li>
<p><strong>Read Only</strong>: Allows you to specify whether the external network provider can be modified from the Administration Portal.</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required to access the external network provider.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the external network provider. If you are authenticating with Active Directory, the user name must be in the format of <em>username</em>@<em>domain</em>@<em>auth_profile</em> instead of the default <em>username</em>@<em>domain</em>.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated.</p>
</li>
<li>
<p><strong>Protocol</strong>: The protocol used to communicate with the Keystone server. The default is <strong>HTTPS</strong>.</p>
</li>
<li>
<p><strong>Hostname</strong>: The IP address or hostname of the Keystone server.</p>
</li>
<li>
<p><strong>API port</strong>: The API port number of the Keystone server.</p>
</li>
<li>
<p><strong>API Version</strong>: The version of the Keystone server.  The value is <code>v2.0</code> and the field is disabled.</p>
</li>
<li>
<p><strong>Tenant Name</strong>: Optional. The name of the tenant of which the external network provider is a member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Foreman/Satellite</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name of the machine that hosts the Satellite instance. You do not need to add the port number to the end of the URL or fully qualified domain name.</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required for the provider. Authentication is mandatory when <strong>Foreman/Satellite</strong> is selected.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the Satellite instance. This user name must be the user name used to log in to the provisioning portal on the Satellite instance.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated. This password must be the password used to log in to the provisioning portal on the Satellite instance.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>KubeVirt/OpenShift Virtualization</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name and port number of the OKD API. By default, this port number is 6443.</p>
</li>
<li>
<p><strong>Token</strong> The <a href="https://docs.openshift.com/container-platform/4.4/security/container_security/security-platform.html#security-platform-auth-controlling-access_security-platform">OAuth access token</a> for authenticating this connection to the API.</p>
</li>
<li>
<p><strong>Certificate Authority</strong> The CA certificate to be trusted when making https requests.</p>
</li>
<li>
<p><strong>Prometheus URL</strong> The URL for the OpenShift cluster&#8217;s prometheus service. If you do not provide this URL, the software will try to automatically detect this URL.</p>
</li>
<li>
<p><strong>Prometheus Certificate Authority</strong> The X509 certificate for prometheus. If you do not specify this CA, the provider uses the KubeVirt CA instead.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>OpenStack Image</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name of the machine on which the OpenStack Image service is hosted. You must add the port number for the OpenStack Image service to the end of the URL or fully qualified domain name. By default, this port number is 9292.</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required to access the OpenStack Image service.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the Keystone server. This user name must be the user name for the OpenStack Image service registered in the Keystone instance of which the OpenStack Image service is a member.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated. This password must be the password for the OpenStack Image service registered in the Keystone instance of which the OpenStack Image service is a member.</p>
</li>
<li>
<p><strong>Protocol</strong>: The protocol used to communicate with the Keystone server. This must be set to <code>HTTP</code>.</p>
</li>
<li>
<p><strong>Hostname</strong>: The IP address or hostname of the Keystone server.</p>
</li>
<li>
<p><strong>API port</strong>: The API port number of the Keystone server.</p>
</li>
<li>
<p><strong>API Version</strong>: The version of the Keystone service. The value is <code>v2.0</code> and the field is disabled.</p>
</li>
<li>
<p><strong>Tenant Name</strong>: The name of the OpenStack tenant of which the OpenStack Image service is a member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>OpenStack Networking</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Networking Plugin</strong>: The networking plugin with which to connect to the OpenStack Networking server. For OpenStack Networking, <strong>Open vSwitch</strong> is the only option, and is selected by default.</p>
</li>
<li>
<p><strong>Automatic Synchronization</strong>: Allows you to specify whether the provider will be automatically synchronized with existing networks.</p>
</li>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name of the machine on which the OpenStack Networking instance is hosted. You must add the port number for the OpenStack Networking instance to the end of the URL or fully qualified domain name. By default, this port number is 9696.</p>
</li>
<li>
<p><strong>Read Only</strong>: Allows you to specify whether the OpenStack Networking instance can be modified from the Administration Portal.</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required to access the OpenStack Networking service.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the OpenStack Networking instance. This user name must be the user name for OpenStack Networking registered in the Keystone instance of which the OpenStack Networking instance is a member.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated. This password must be the password for OpenStack Networking registered in the Keystone instance of which the OpenStack Networking instance is a member.</p>
</li>
<li>
<p><strong>Protocol</strong>: The protocol used to communicate with the Keystone server. The default is <strong>HTTPS</strong>.</p>
</li>
<li>
<p><strong>Hostname</strong>: The IP address or hostname of the Keystone server.</p>
</li>
<li>
<p><strong>API port</strong>: The API port number of the Keystone server.</p>
</li>
<li>
<p><strong>API Version</strong>: The version of the Keystone server. This appears in the URL. If v2.0 appears, select <strong>v2.0</strong>. If v3 appears select <code>v3</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following fields appear when you select <code>v3</code> from the <strong>API Version</strong> field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>User Domain Name</strong>: The name of the user defined in the domain.</p>
<div class="paragraph">
<p>With Keystone API v3, domains are used to determine administrative boundaries of service entities in OpenStack. Domains allow you to group users together for various purposes, such as setting domain-specific configuration or security options. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_openstack_platform/11/html-single/architecture_guide/index#comp-identity">OpenStack Identity (keystone)</a> in the Red Hat OpenStack Platform <em>Architecture Guide</em>.</p>
</div>
</li>
<li>
<p><strong>Project Name</strong>: Defines the project name for OpenStack Identity API v3.</p>
</li>
<li>
<p><strong>Project Domain Name</strong>: Defines the projects domain name for OpenStack Identity API v3.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following field appears when you select <strong>v2.0</strong> from the <strong>API Version</strong> field:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Tenant Name</strong>: Appears only when v2 is selected from the <strong>API Version</strong> field. The name of the OpenStack tenant of which the OpenStack Networking instance is a member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>OpenStack Volume</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Center</strong>: The data center to which OpenStack Volume storage volumes will be attached.</p>
</li>
<li>
<p><strong>Provider URL</strong>: The URL or fully qualified domain name of the machine on which the OpenStack Volume instance is hosted. You must add the port number for the OpenStack Volume instance to the end of the URL or fully qualified domain name. By default, this port number is 8776.</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required to access the OpenStack Volume service.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the Keystone server. This user name must be the user name for OpenStack Volume registered in the Keystone instance of which the OpenStack Volume instance is a member.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated. This password must be the password for OpenStack Volume registered in the Keystone instance of which the OpenStack Volume instance is a member.</p>
</li>
<li>
<p><strong>Protocol</strong>: The protocol used to communicate with the Keystone server. This must be set to <code>HTTP</code>.</p>
</li>
<li>
<p><strong>Hostname</strong>: The IP address or hostname of the Keystone server.</p>
</li>
<li>
<p><strong>API port</strong>: The API port number of the Keystone server.</p>
</li>
<li>
<p><strong>API Version</strong>: The version of the Keystone server.  The value is <code>v2.0</code> and the field is disabled.</p>
</li>
<li>
<p><strong>Tenant Name</strong>: The name of the OpenStack tenant of which the OpenStack Volume instance is a member.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>VMware</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Center</strong>: Specify the data center into which VMware virtual machines will be imported, or select <strong>Any Data Center</strong> to specify the destination data center during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
<li>
<p><strong>vCenter</strong>: The IP address or fully qualified domain name of the VMware vCenter instance.</p>
</li>
<li>
<p><strong>ESXi</strong>: The IP address or fully qualified domain name of the host from which the virtual machines will be imported.</p>
</li>
<li>
<p><strong>Data Center</strong>: The name of the data center in which the specified ESXi host resides.</p>
</li>
<li>
<p><strong>Cluster</strong>: The name of the cluster in which the specified ESXi host resides.</p>
</li>
<li>
<p><strong>Verify server&#8217;s SSL certificate</strong>: Specify whether the ESXi host&#8217;s certificate will be verified on connection.</p>
</li>
<li>
<p><strong>Proxy Host</strong>: Select a host in the chosen data center with <code>virt-v2v</code> installed to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the VMware vCenter external provider. If you selected <strong>Any Data Center</strong>, you cannot choose the host here, but can specify a host during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the VMware vCenter instance. The user must have access to the VMware data center and ESXi host on which the virtual machines reside.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>RHEL 5 Xen</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Center</strong>: Specify the data center into which Xen virtual machines will be imported, or select <strong>Any Data Center</strong> to instead specify the destination data center during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
<li>
<p><strong>URI</strong>: The URI of the RHEL 5 Xen host.</p>
</li>
<li>
<p><strong>Proxy Host</strong>: Select a host in the chosen data center with <code>virt-v2v</code> installed to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the RHEL 5 Xen external provider. If you selected <strong>Any Data Center</strong>, you cannot choose the host here, but instead can specify a host during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>KVM</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data Center</strong>: Specify the data center into which KVM virtual machines will be imported, or select <strong>Any Data Center</strong> to instead specify the destination data center during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
<li>
<p><strong>URI</strong>: The URI of the KVM host.</p>
</li>
<li>
<p><strong>Proxy Host</strong>: Select a host in the chosen data center to serve as the host during virtual machine import operations. This host must also be able to connect to the network of the KVM external provider. If you selected <strong>Any Data Center</strong>, you cannot choose the host here, but instead can specify a host during individual import operations (using the <strong>Import</strong> function in the <strong>Virtual Machines</strong> tab).</p>
</li>
<li>
<p><strong>Requires Authentication</strong>: Allows you to specify whether authentication is required to access the KVM host.</p>
</li>
<li>
<p><strong>Username</strong>: A user name for connecting to the KVM host.</p>
</li>
<li>
<p><strong>Password</strong>: The password against which the above user name is to be authenticated.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Test</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows users to test the specified credentials. This button is available to all provider types.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Editing_an_External_Provider">14.3. Editing an External Provider</h3>
<div class="paragraph">
<p><strong>Editing an External Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span> and select the external provider to edit.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Change the current values for the provider to the preferred values.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Removing_an_External_Provider">14.4. Removing an External Provider</h3>
<div class="paragraph">
<p><strong>Removing an External Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span> and select the external provider to remove.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<h1 id="part-Administering_the_Environment" class="sect0">Administering the Environment</h1>
<div class="sect1">
<h2 id="chap-Administering_the_Self-Hosted_Engine">15. Administering the Self-Hosted Engine</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Maintaining_the_Self-Hosted_Engine">15.1. Maintaining the Self-hosted engine</h3>
<div class="sect3">
<h4 id="Self-hosted_engine_maintenance_modes_explained_SHE_admin">15.1.1. Self-hosted engine maintenance modes explained</h4>
<div class="paragraph">
<p>The maintenance modes enable you to start, stop, and modify the Engine virtual machine without interference from the high-availability agents, and to restart and modify the self-hosted engine nodes in the environment without interfering with the Engine.</p>
</div>
<div class="paragraph">
<p>There are three maintenance modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>global</code> - All high-availability agents in the cluster are disabled from monitoring the state of the Engine virtual machine. The global maintenance mode must be applied for any setup or upgrade operations that require the <code>ovirt-engine</code> service to be stopped, such as upgrading to a later version of oVirt.</p>
</li>
<li>
<p><code>local</code> - The high-availability agent on the node issuing the command is disabled from monitoring the state of the Engine virtual machine. The node is exempt from hosting the Engine virtual machine while in local maintenance mode; if hosting the Engine virtual machine when placed into this mode, the Engine will migrate to another node, provided there is one available. The local maintenance mode is recommended when applying system changes or updates to a self-hosted engine node.</p>
</li>
<li>
<p><code>none</code> - Disables maintenance mode, ensuring that the high-availability agents are operating.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="local-maintenance-mode_SHE_admin">15.1.2. Setting local maintenance mode</h4>
<div class="paragraph">
<p>Enabling local maintenance mode stops the high-availability agent on a single self-hosted engine node.</p>
</div>
<div class="olist arabic">
<div class="title">Setting the local maintenance mode from the Administration Portal</div>
<ol class="arabic">
<li>
<p>Put a self-hosted engine node into local maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select a self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>. Local maintenance mode is automatically triggered for that node.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Setting the local maintenance mode from the command line</div>
<ol class="arabic">
<li>
<p>Log in to a self-hosted engine node and put it into local maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=local</pre>
</div>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="global-maintenance-mode_SHE_admin">15.1.3. Setting global maintenance mode</h4>
<div class="paragraph">
<p>Enabling global maintenance mode stops the high-availability agents on all self-hosted engine nodes in the cluster.</p>
</div>
<div class="olist arabic">
<div class="title">Setting the global maintenance mode from the Administration Portal</div>
<ol class="arabic">
<li>
<p>Put all of the self-hosted engine nodes into global maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select any self-hosted engine node.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Enable Global HA Maintenance</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select any self-hosted engine node.</p>
</li>
<li>
<p>Click <strong>More Actions</strong> (<span class="image"><img src="common/images/moreactions.png" alt="moreactions"></span>), then click <strong>Disable Global HA Maintenance</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Setting the global maintenance mode from the command line</div>
<ol class="arabic">
<li>
<p>Log in to any self-hosted engine node and put it into global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>After you have completed any maintenance tasks, disable the maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Administering_the_Manager_Virtual_Machine">15.2. Administering the Engine Virtual Machine</h3>
<div class="paragraph">
<p>The <code>hosted-engine</code> utility provides many commands to help administer the Engine virtual machine. You can run <code>hosted-engine</code> on any self-hosted engine node. To see all available commands, run <code>hosted-engine --help</code>. For additional information on a specific command, run <code>hosted-engine --<em>command</em> --help</code>.</p>
</div>
<div class="sect3">
<h4 id="updating-the-self-hosted-engine-configuration">15.2.1. Updating the Self-Hosted Engine Configuration</h4>
<div class="paragraph">
<p>To update the self-hosted engine configuration, use the <code>hosted-engine --set-shared-config</code> command. This command updates the self-hosted engine configuration on the shared storage domain after the initial deployment.</p>
</div>
<div class="paragraph">
<p>To see the current configuration values, use the <code>hosted-engine --get-shared-config</code> command.</p>
</div>
<div class="paragraph">
<p>To see a list of all available configuration keys and their corresponding types, enter the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config <em>key</em> --type=<em>type</em> --help</pre>
</div>
</div>
<div class="paragraph">
<p>Where <code><em>type</em></code> is one of the following:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
<code>he_local</code>
</td>
<td class="hdlist2">
<p>Sets values in the local instance of <code class="filename">etc/ovirt-hosted-engine/hosted-engine.conf</code> on the local host, so only that host uses the new values. To enable the new value, restart the ovirt-ha-agent and ovirt-ha-broker services.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>he_shared</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">etc/ovirt-hosted-engine/hosted-engine.conf</code> on shared storage, so all hosts that are deployed after a configuration change use these values. To enable the new value on a host, redeploy that host.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>ha</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">/var/lib/ovirt-hosted-engine-ha/ha.conf</code> on local storage. New settings take effect immediately.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
<code>broker</code>
</td>
<td class="hdlist2">
<p>Sets values in <code class="filename">/var/lib/ovirt-hosted-engine-ha/broker.conf</code> on local storage. Restart the ovirt-ha-broker service to enable new settings.</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-email-notifications">15.2.2. Configuring Email Notifications</h4>
<div class="paragraph">
<p>You can configure email notifications using SMTP for any HA state transitions on the self-hosted engine nodes. The keys that can be updated include: <code>smtp-server</code>, <code>smtp-port</code>, <code>source-email</code>, <code>destination-emails</code>, and <code>state_transition</code>.</p>
</div>
<div class="paragraph">
<p><strong>To configure email notifications:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On a self-hosted engine node, set the <code>smtp-server</code> key to the desired SMTP server address:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config smtp-server <em>smtp.example.com</em> --type=broker</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To verify that the self-hosted engine configuration file has been updated, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --get-shared-config smtp-server --type=broker
broker : smtp.example.com, type : broker</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Check that the default SMTP port (port 25) has been configured:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --get-shared-config smtp-port --type=broker
broker : 25, type : broker</pre>
</div>
</div>
</li>
<li>
<p>Specify an email address you want the SMTP server to use to send out email notifications. Only one address can be specified.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config source-email <em>source@example.com</em> --type=broker</pre>
</div>
</div>
</li>
<li>
<p>Specify the destination email address to receive email notifications. To specify multiple email addresses, separate each address by a comma.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config destination-emails <em>destination1@example.com</em>,<em>destination2@example.com</em> --type=broker</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To verify that SMTP has been properly configured for your self-hosted engine environment, change the HA state on a self-hosted engine node and check if email notifications were sent. For example, you can change the HA state by placing HA agents into maintenance mode. See <a href="#Maintaining_the_Self-Hosted_Engine">Maintaining the Self-hosted engine</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Memory_Slots_Reserved_for_the_SHE">15.3. Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</h3>
<div class="paragraph">
<p>If the Engine virtual machine shuts down or needs to be migrated, there must be enough memory on a self-hosted engine node for the Engine virtual machine to restart on or migrate to it. This memory can be reserved on multiple self-hosted engine nodes by using a scheduling policy. The scheduling policy checks if enough memory to start the Engine virtual machine will remain on the specified number of additional self-hosted engine nodes before starting or migrating any virtual machines. See <a href="https://ovirt.org/documentation/administration_guide/index#Creating_a_Scheduling_Policy">Creating a Scheduling Policy</a> in the <em>Administration Guide</em> for more information about scheduling policies.</p>
</div>
<div class="paragraph">
<p>To add more self-hosted engine nodes to the oVirt Engine, see <a href="#Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">Adding Self-Hosted Engine Nodes to the oVirt Engine</a>.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Memory Slots Reserved for the Self-Hosted Engine on Additional Hosts</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Clusters</b></span> and select the cluster containing the self-hosted engine nodes.</p>
</li>
<li>
<p>Click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Click the <strong>Scheduling Policy</strong> tab.</p>
</li>
<li>
<p>Click <b class="button">+</b> and select <strong>HeSparesCount</strong>.</p>
</li>
<li>
<p>Enter the number of additional self-hosted engine nodes that will reserve enough free memory to start the Engine virtual machine.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Adding_self-hosted_engine_nodes_to_the_Manager_SHE_admin">15.4. Adding Self-Hosted Engine Nodes to the oVirt Engine</h3>
<div class="paragraph">
<p>Add self-hosted engine nodes in the same way as a standard host, with an additional step to deploy the host as a self-hosted engine node. The shared storage domain is automatically detected and the node can be used as a failover host to host the Engine virtual machine when required. You can also attach standard hosts to a self-hosted engine environment, but they cannot host the Engine virtual machine. Have at least two self-hosted engine nodes to ensure the Engine virtual machine is highly available. You can also add additional hosts using the REST API. See <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/rest_api_guide/index#services-hosts">Hosts</a> in the <em>REST API Guide</em>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All self-hosted engine nodes must be in the same cluster.</p>
</li>
<li>
<p>If you are reusing a self-hosted engine node, remove its existing self-hosted engine configuration. See <a href="https://ovirt.org/documentation/administration_guide/index#removing_a_host_from_a_self-hosted_engine_environment">Removing a Host from a Self-Hosted Engine Environment</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Click <b class="button">New</b>.</p>
<div class="paragraph">
<p>For information on additional host settings, see <a href="https://ovirt.org/documentation/administration_guide#sect-Explanation_of_Settings_and_Controls_in_the_New_Host_and_Edit_Host_Windows">Explanation of Settings and Controls in the New Host and Edit Host Windows</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>Use the drop-down list to select the <strong>Data Center</strong> and <strong>Host Cluster</strong> for the new host.</p>
</li>
<li>
<p>Enter the <strong>Name</strong> and the <strong>Address</strong> of the new host. The standard SSH port, port 22, is auto-filled in the <strong>SSH Port</strong> field.</p>
</li>
<li>
<p>Select an authentication method to use for the Engine to access the host.</p>
<div class="ulist">
<ul>
<li>
<p>Enter the root user&#8217;s password to use password authentication.</p>
</li>
<li>
<p>Alternatively, copy the key displayed in the <strong>SSH PublicKey</strong> field to <strong>/root/.ssh/authorized_keys</strong> on the host to use public key authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optionally, configure power management, where the host has a supported power management card. For information on power management configuration, see <a href="https://ovirt.org/documentation/administration_guide#Host_Power_Management_settings_explained">Host Power Management Settings Explained</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab.</p>
</li>
<li>
<p>Select <strong>Deploy</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Reinstalling_an_Existing_Host_as_a_Self-Hosted_Engine_Node_SHE_admin">15.5. Reinstalling an Existing Host as a Self-Hosted Engine Node</h3>
<div class="paragraph">
<p>You can convert an existing, standard host in a self-hosted engine environment to a self-hosted engine node capable of hosting the Engine virtual machine.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>DEPLOY</strong> from the drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The host is reinstalled with self-hosted engine configuration, and is flagged with a crown icon in the Administration Portal.</p>
</div>
</div>
<div class="sect2">
<h3 id="Booting_a_Self-Hosted_Engine_in_Rescue_Mode_SHE_admin">15.6. Booting the Engine Virtual Machine in Rescue Mode</h3>
<div class="paragraph">
<p>This topic describes how to boot the Engine virtual machine into rescue mode when it does not start. For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-working_with_the_grub_2_boot_loader#sec-Terminal_Menu_Editing_During_Boot">Booting to Rescue Mode</a> in the <em>Enterprise Linux System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Connect to one of the hosted-engine nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ ssh root@<em>host_address</em></pre>
</div>
</div>
</li>
<li>
<p>Put the self-hosted engine in global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Check if there is already a running instance of the Engine virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>If a Engine virtual machine instance is running, connect to its host:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ssh root@<em>host_address</em></pre>
</div>
</div>
</li>
<li>
<p>Shut down the virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-shutdown</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the virtual machine does not shut down, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-poweroff</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Start the Engine virtual machine in pause mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hosted-engine --vm-start-paused</pre>
</div>
</div>
</li>
<li>
<p>Set a temporary VNC password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">hosted-engine --add-console-password</pre>
</div>
</div>
<div class="paragraph">
<p>The command outputs the necessary information you need to log in to the Manger virtual machine with VNC.</p>
</div>
</li>
<li>
<p>Log in to the Engine virtual machine with VNC. The Engine virtual machine is still paused, so it appears to be frozen.</p>
</li>
<li>
<p>Resume the Engine virtual machine with the following command on its host:</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After running the following command, the boot loader menu appears. You need to enter into rescue mode before the boot loader proceeds with the normal boot process. Read the next step about entering into rescue mode before proceeding with this command.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/bin/virsh -c qemu:///system?authfile=/etc/ovirt-hosted-engine/virsh_auth.conf resume HostedEngine</pre>
</div>
</div>
</li>
<li>
<p>Boot the Engine virtual machine in rescue mode.</p>
</li>
<li>
<p>Disable global maintenance mode</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now run rescue tasks on the Engine virtual machine.</p>
</div>
</div>
<div class="sect2">
<h3 id="Removing_a_Host_from_a_Self-Hosted_Engine_Environment">15.7. Removing a Host from a Self-Hosted Engine Environment</h3>
<div class="paragraph">
<p>To remove a self-hosted engine node from your environment, place the node into maintenance mode, undeploy the node, and optionally remove it. The node can be managed as a regular host after the HA services have been stopped, and the self-hosted engine configuration files have been removed.</p>
</div>
<div class="paragraph">
<p><strong>Removing a Host from a Self-Hosted Engine Environment</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the self-hosted engine node.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>UNDEPLOY</strong> from the drop-down list. This action stops the <code>ovirt-ha-agent</code> and <code>ovirt-ha-broker</code> services and removes the self-hosted engine configuration file.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>Optionally, click <b class="button">Remove</b>. This opens the <strong>Remove Host(s)</strong> confirmation window.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Updating_a_self-hosted_engine_SHE_admin">15.8. Updating a Self-Hosted Engine</h3>
<div class="paragraph">
<p>To update a self-hosted engine from your current version to the latest version, you must place the environment in global maintenance mode and then follow the standard procedure for updating between minor versions.</p>
</div>
<h4 id="Enabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Enabling global maintenance mode</h4>
<div class="paragraph">
<p>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the Engine virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the environment is in global maintenance mode before proceeding:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>You should see a message indicating that the cluster is in global maintenance mode.</p>
</div>
</li>
</ol>
</div>
<h4 id="Updating_the_Red_Hat_Virtualization_Manager_SHE_minor_updates" class="discrete">Updating the oVirt Engine</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the Engine machine, check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Update the oVirt Engine with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you encounter a required Ansible package conflict during the update, see <a href="https://access.redhat.com/solutions/5480561">Cannot perform yum update on my RHV manager (ansible conflict)</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable global maintenance mode</p>
</li>
<li>
<p>Reboot the machine to complete the update.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Related Information</div>
<p><a href="#Disabling_Global_Maintenance_Mode_SHE_minor_updates">Disabling global maintenance mode</a></p>
</div>
<h4 id="Disabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Disabling global maintenance mode</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine virtual machine and shut it down.</p>
</li>
<li>
<p>Log in to one of the self-hosted engine nodes
and disable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
<div class="paragraph">
<p>When you exit global maintenance mode, ovirt-ha-agent starts the Engine virtual machine, and then the Engine automatically starts. It can take up to ten minutes for the Engine to start.</p>
</div>
</li>
<li>
<p>Confirm that the environment is running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>The listed information includes <strong>Engine Status</strong>. The value for <strong>Engine status</strong> should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"health": "good", "vm": "up", "detail": "Up"}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the virtual machine is still booting and the Engine hasn&#8217;t started yet, the <strong>Engine status</strong> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</pre>
</div>
</div>
<div class="paragraph">
<p>If this happens, wait a few minutes and try again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Changing_FQDN_of_RHVM_self-hosted_engine">15.9. Changing the FQDN of the Engine in a Self-Hosted Engine</h3>
<div class="paragraph">
<p>You can use the <code>ovirt-engine-rename</code> command to update records of the fully qualified domain name (FQDN) of the Engine.</p>
</div>
<div class="paragraph">
<p>For details see <a href="#Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool">Renaming the Engine with the oVirt Engine Rename Tool</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Backups_and_Migration">16. Backups and Migration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">16.1. Backing Up and Restoring the oVirt Engine</h3>
<div class="sect3">
<h4 id="Backing_up_Red_Hat_Enterprise_Virtualization_Manager_using_the_engine-backup_Command">16.1.1. Backing up oVirt Engine - Overview</h4>
<div class="paragraph">
<p>Use the <code>engine-backup</code> tool to take regular backups of the oVirt Engine. The tool backs up the engine database and configuration files into a single file and can be run without interrupting the <code>ovirt-engine</code> service.</p>
</div>
</div>
<div class="sect3">
<h4 id="Syntax_for_the_engine-backup_Command">16.1.2. Syntax for the engine-backup Command</h4>
<div class="paragraph">
<p>The <code>engine-backup</code> command works in one of two basic modes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=backup</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore</pre>
</div>
</div>
<div class="paragraph">
<p>These two modes are further extended by a set of parameters that allow you to specify the scope of the backup and different credentials for the engine database. Run <code>engine-backup --help</code> for a full list of parameters and their function.</p>
</div>
<div class="paragraph">
<p><strong>Basic Options</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>--mode</code></strong></dt>
<dd>
<p>Specifies whether the command will perform a backup operation or a restore operation. Two options are available - <code>backup</code>, and <code>restore</code>. This is a required parameter.</p>
</dd>
<dt class="hdlist1"><strong><code>--file</code></strong></dt>
<dd>
<p>Specifies the path and name of a file into which backups are to be taken in backup mode, and the path and name of a file from which to read backup data in restore mode. This is a required parameter in both backup mode and restore mode.</p>
</dd>
<dt class="hdlist1"><strong><code>--log</code></strong></dt>
<dd>
<p>Specifies the path and name of a file into which logs of the backup or restore operation are to be written. This parameter is required in both backup mode and restore mode.</p>
</dd>
<dt class="hdlist1"><strong><code>--scope</code></strong></dt>
<dd>
<p>Specifies the scope of the backup or restore operation. There are four options: <code>all</code>, which backs up or restores all databases and configuration data; <code>files</code>, which backs up or restores only files on the system; <code>db</code>, which backs up or restores only the Engine database; and <code>dwhdb</code>, which backs up or restores only the Data Warehouse database. The default scope is <code>all</code>.</p>
<div class="paragraph">
<p>The <code>--scope</code> parameter can be specified multiple times in the same <code>engine-backup</code> command.</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Engine Database Options</strong></p>
</div>
<div class="paragraph">
<p>The following options are only available when using the <code>engine-backup</code> command in <code>restore</code> mode. The option syntax below applies to restoring the Engine database. The same options exist for restoring the Data Warehouse database. See <code>engine-backup --help</code> for the Data Warehouse option syntax.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>--provision-db</code></strong></dt>
<dd>
<p>Creates a PostgreSQL database for the Engine database backup to be restored to. This is a required parameter when restoring a backup on a remote host or fresh installation that does not have a PostgreSQL database already configured.</p>
</dd>
<dt class="hdlist1"><strong><code>--change-db-credentials</code></strong></dt>
<dd>
<p>Allows you to specify alternate credentials for restoring the Engine database using credentials other than those stored in the backup itself. See <code>engine-backup --help</code> for the additional parameters required by this parameter.</p>
</dd>
<dt class="hdlist1"><strong><code>--restore-permissions</code> or <code>--no-restore-permissions</code></strong></dt>
<dd>
<p>Restores (or does not restore) the permissions of database users. One of these parameters is required when restoring a backup.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a backup contains grants for extra database users, restoring the backup with the <code>--restore-permissions</code> and <code>--provision-db</code> (or <code>--provision-dwh-db</code>) options will create the extra users with random passwords. You must change these passwords manually if the extra users require access to the restored system. See <a href="https://access.redhat.com/articles/2686731" class="bare">https://access.redhat.com/articles/2686731</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Creating_a_Backup_with_the_engine-backup_Command">16.1.3. Creating a backup with the engine-backup command</h4>
<div class="paragraph">
<p>You can back up the oVirt Engine with the <code class="command">engine-backup</code> command while the Engine is active. Append one of the following values to the <code>--scope</code> option to specify what you want to back up:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>all</code></dt>
<dd>
<p>A full backup of all databases and configuration files on the Engine</p>
</dd>
<dt class="hdlist1"><code>files</code></dt>
<dd>
<p>A backup of only the files on the system</p>
</dd>
<dt class="hdlist1"><code>db</code></dt>
<dd>
<p>A backup of only the Engine database</p>
</dd>
<dt class="hdlist1"><code>dwhdb</code></dt>
<dd>
<p>A backup of only the Data Warehouse database</p>
</dd>
<dt class="hdlist1"><code>cinderlibdb</code></dt>
<dd>
<p>A backup of only the Cinderlib database</p>
</dd>
<dt class="hdlist1"><code>grafanadb</code></dt>
<dd>
<p>A backup of only the Grafana database</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can specify the <code>--scope</code> option more than once.</p>
</div>
<div class="paragraph">
<p>You can also configure the <code class="command">engine-backup</code> command to back up additional files. It restores everything that it backs up.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To restore a database to a fresh installation of oVirt Engine, a database backup alone is not sufficient. The Engine also requires access to the configuration files. If you specify a scope other than <code>all</code>, you must also include <code>--scope=files</code>, or back up the file system.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For a complete explanation of the <code class="command">engine-backup</code> command, enter <code>engine-backup --help</code> on the Engine machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log on to the Engine machine.</p>
</li>
<li>
<p>Create a backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --scope=all --mode=backup --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The command generates the backup in <code><em>file_name</em>.tar</code>, and a log file in <code><em>log_file_name</em></code>.</p>
</div>
<div class="paragraph">
<p>Use <code><em>file_name</em>.tar</code> to restore the environment.</p>
</div>
<div class="paragraph">
<p>The following examples demonstrate several different backup scenarios.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. Full backup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --scope=all --mode=backup --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. Engine database backup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --scope=files --scope=db --mode=backup --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 12. Data Warehouse database backup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --scope=files --scope=dwhdb --mode=backup --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 13. Adding specific files to the backup</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make a directory to store configuration customizations for the <code class="command">engine-backup</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /etc/ovirt-engine-backup/engine-backup-config.d</pre>
</div>
</div>
</li>
<li>
<p>Create a text file in the new directory named <code>ntp-chrony.sh</code> with the following contents:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BACKUP_PATHS="${BACKUP_PATHS}
/etc/chrony.conf
/etc/ntp.conf
/etc/ovirt-engine-backup"</pre>
</div>
</div>
</li>
<li>
<p>When you run the <code class="command">engine-backup</code> command, use <code>--scope=files</code>. The backup and restore includes <code>/etc/chrony.conf</code>, <code>/etc/ntp.conf</code>, and <code>/etc/ovirt-engine-backup</code>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Restoring_a_Backup_with_the_engine-backup_Command">16.1.4. Restoring a Backup with the engine-backup Command</h4>
<div class="paragraph">
<p>Restoring a backup using the engine-backup command involves more steps than creating a backup does, depending on the restoration destination. For example, the <code>engine-backup</code> command can be used to restore backups to fresh installations of oVirt, on top of existing installations of oVirt, and using local or remote databases.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The version of the oVirt Engine (such as 4.4.8) used to restore a backup must be later than or equal to the oVirt Engine version (such as 4.4.7) used to create the backup.
Starting with oVirt 4.4.7, this policy is strictly enforced by the engine-backup command.
To view the version of oVirt contained in a backup file, unpack the backup file and read the value in the <strong>version</strong> file located in the root directory of the unpacked files.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Restoring_a_Backup_to_a_Fresh_Installation">16.1.5. Restoring a Backup to a Fresh Installation</h4>
<div class="paragraph">
<p>The <code>engine-backup</code> command can be used to restore a backup to a fresh installation of the oVirt Engine. The following procedure must be performed on a machine on which the base operating system has been installed and the required packages for the oVirt Engine have been installed, but the <code>engine-setup</code> command has not yet been run. This procedure assumes that the backup file or files can be accessed from the machine on which the backup is to be restored.</p>
</div>
<div class="paragraph">
<p><strong>Restoring a Backup to a Fresh Installation</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log on to the Engine machine. If you are restoring the engine database to a remote host, you will need to log on to and perform the relevant actions on that host. Likewise, if also restoring the Data Warehouse to a remote host, you will need to log on to and perform the relevant actions on that host.</p>
</li>
<li>
<p>Restore a complete backup or a database-only backup.</p>
<div class="ulist">
<ul>
<li>
<p>Restore a complete backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-db --restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>If Data Warehouse is also being restored as part of the complete backup, provision the additional database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-db --provision-dwh-db --restore-permissions</pre>
</div>
</div>
</li>
<li>
<p>Restore a database-only backup by restoring the configuration files and database backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=db --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-db --restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>The example above restores a backup of the Engine database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-dwh-db --restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>The example above restores a backup of the Data Warehouse database.</p>
</div>
<div class="paragraph">
<p>If successful, the following output displays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You should now run engine-setup.
Done.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following command and follow the prompts to configure the restored Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The oVirt Engine has been restored to the version preserved in the backup. To change the fully qualified domain name of the new oVirt system, see <a href="#The_oVirt_Engine_Rename_Tool">The oVirt Engine Rename Tool</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Restoring_a_Backup_to_Overwrite_an_Existing_Installation_RHV_backup_restore">16.1.6. Restoring a Backup to Overwrite an Existing Installation</h4>
<div class="paragraph">
<p>The <code>engine-backup</code> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up. This is useful when you have taken a backup of an environment, performed changes on that environment, and then want to undo the changes by restoring the environment from the backup.</p>
</div>
<div class="paragraph">
<p>Changes made to the environment since the backup was taken, such as adding or removing a host, will not appear in the restored environment. You must redo these changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Remove the configuration files and clean the database associated with the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-cleanup</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>engine-cleanup</code> command only cleans the Engine database; it does not drop the database or delete the user that owns that database.</p>
</div>
</li>
<li>
<p>Restore a full backup or a database-only backup. You do not need to create a new database or specify the database credentials because the user and database already exist.</p>
<div class="ulist">
<ul>
<li>
<p>Restore a full backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --restore-permissions</pre>
</div>
</div>
</li>
<li>
<p>Restore a database-only backup by restoring the configuration files and the database backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=db --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --restore-permissions</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To restore only the Engine database (for example, if the Data Warehouse database is located on another machine), you can omit the <code>--scope=dwhdb</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If successful, the following output displays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You should now run engine-setup.
Done.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reconfigure the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Restoring_a_Backup_with_Different_Credentials">16.1.7. Restoring a Backup with Different Credentials</h4>
<div class="paragraph">
<p>The <code>engine-backup</code> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up, but the credentials of the database in the backup are different to those of the database on the machine on which the backup is to be restored. This is useful when you have taken a backup of an installation and want to restore the installation from the backup to a different system.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When restoring a backup to overwrite an existing installation, you must run the <code>engine-cleanup</code> command to clean up the existing installation before using the <code>engine-backup</code> command. The <code>engine-cleanup</code> command only cleans the engine database, and does not drop the database or delete the user that owns that database. So you do not need to create a new database or specify the database credentials. However, if the credentials for the owner of the engine database are not known, you must change them before you can restore the backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Restoring a Backup with Different Credentials</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the oVirt Engine machine.</p>
</li>
<li>
<p>Run the following command and follow the prompts to remove the Engine&#8217;s configuration files and to clean the Engine&#8217;s database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-cleanup</pre>
</div>
</div>
</li>
<li>
<p>Change the password for the owner of the <code>engine</code> database if the credentials of that user are not known:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter the postgresql command line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c 'psql'</pre>
</div>
</div>
</li>
<li>
<p>Change the password of the user that owns the <code>engine</code> database:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">postgres=# alter role <em>user_name</em> encrypted password '<em>new_password</em>';</pre>
</div>
</div>
<div class="paragraph">
<p>Repeat this for the user that owns the <code>ovirt_engine_history</code> database if necessary.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Restore a complete backup or a database-only backup with the <code>--change-db-credentials</code> parameter to pass the credentials of the new database. The <em>database_location</em> for a database local to the Engine is <code>localhost</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The following examples use a <code>--*password</code> option for each database without specifying a password, which prompts for a password for each database. Alternatively, you can use <code>--*passfile=<em>password_file</em></code> options for each database to securely pass the passwords to the <code>engine-backup</code> tool without the need for interactive prompts.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Restore a complete backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --change-db-credentials --db-host=<em>database_location</em> --db-name=<em>database_name</em> --db-user=engine --db-password --no-restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>If Data Warehouse is also being restored as part of the complete backup, include the revised credentials for the additional database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --change-db-credentials --db-host=<em>database_location</em> --db-name=<em>database_name</em> --db-user=engine --db-password --change-dwh-db-credentials --dwh-db-host=<em>database_location</em> --dwh-db-name=<em>database_name</em> --dwh-db-user=ovirt_engine_history --dwh-db-password --no-restore-permissions</pre>
</div>
</div>
</li>
<li>
<p>Restore a database-only backup by restoring the configuration files and the database backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=db --file=<em>file_name</em> --log=<em>log_file_name</em> --change-db-credentials --db-host=<em>database_location</em> --db-name=<em>database_name</em> --db-user=engine --db-password --no-restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>The example above restores a backup of the Engine database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --change-dwh-db-credentials --dwh-db-host=<em>database_location</em> --dwh-db-name=<em>database_name</em> --dwh-db-user=ovirt_engine_history --dwh-db-password --no-restore-permissions</pre>
</div>
</div>
<div class="paragraph">
<p>The example above restores a backup of the Data Warehouse database.</p>
</div>
<div class="paragraph">
<p>If successful, the following output displays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You should now run engine-setup.
Done.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following command and follow the prompts to reconfigure the firewall and ensure the <code>ovirt-engine</code> service is correctly configured:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Backing_up_and_Restoring_a_Self-hosted_Engine">16.1.8. Backing up and Restoring a Self-Hosted Engine</h4>
<div class="paragraph">
<p>You can back up a self-hosted engine and restore it in a new self-hosted environment. Use this procedure for tasks such as migrating the environment to a new self-hosted engine storage domain with a different storage type.</p>
</div>
<div class="paragraph">
<p>When you specify a backup file during deployment, the backup is restored on a new Engine virtual machine, with a new self-hosted engine storage domain. The old Engine is removed, and the old self-hosted engine storage domain is renamed and can be manually removed after you confirm that the new environment is working correctly. Deploying on a fresh host is highly recommended; if the host used for deployment existed in the backed up environment, it will be removed from the restored database to avoid conflicts in the new environment. If you deploy on a new host, you must assign a unique name to the host. Reusing the name of an existing host included in the backup can cause conflicts in the new environment.</p>
</div>
<div class="paragraph">
<p>The backup and restore operation involves the following key actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Backing_up_the_Original_Manager_SHE_backup_restore">Back up the original Engine using the <code>engine-backup</code> tool.</a></p>
</li>
<li>
<p><a href="#Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_backup_restore">Deploy a new self-hosted engine and restore the backup.</a></p>
</li>
<li>
<p><a href="#Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_backup_restore">Enable the Engine repositories on the new Engine virtual machine.</a></p>
</li>
<li>
<p><a href="#Reinstalling_Hosts_SHE_backup_restore">Reinstall the self-hosted engine nodes to update their configuration.</a></p>
</li>
<li>
<p><a href="#Removing_a_Storage_Domain_SHE_backup_restore">Remove the old self-hosted engine storage domain.</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure assumes that you have access and can make changes to the original Engine.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A fully qualified domain name prepared for your Engine and the host. Forward and reverse lookup records must both be set in the DNS. The new Engine must have the same fully qualified domain name as the original Engine.</p>
</li>
<li>
<p>The original Engine must be updated to the latest minor version.
The version of the oVirt Engine (such as 4.4.8) used to restore a backup must be later than or equal to the oVirt Engine version (such as 4.4.7) used to create the backup.
Starting with oVirt 4.4.7, this policy is strictly enforced by the engine-backup command. See <a href="https://ovirt.org/documentation/upgrade_guide/index#Updating_the_Red_Hat_Virtualization_Manager_minor_updates">Updating the oVirt Engine</a> in the <em>Upgrade Guide</em>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you need to restore a backup, but do not have a new appliance, the restore process will pause, and you can log into the temporary Engine machine via SSH, register, subscribe, or configure channels as needed, and upgrade the Engine packages before resuming the restore process.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The data center compatibility level must be set to the latest version to ensure compatibility with the updated storage version.</p>
</li>
<li>
<p>There must be at least one regular host in the environment. This host (and any other regular hosts) will remain active to host the SPM role and any running virtual machines. If a regular host is not already the SPM, move the SPM role before creating the backup by selecting a regular host and clicking <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Select as SPM</b></span>.</p>
<div class="paragraph">
<p>If no regular hosts are available, there are two ways to  add one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Remove the self-hosted engine configuration from a node (but do not remove the node from the environment). See <a href="#Removing_a_Host_from_a_Self-Hosted_Engine_Environment">Removing a Host from a Self-Hosted Engine Environment</a>.</p>
</li>
<li>
<p>Add a new regular host. See <a href="#Adding_standard_hosts_to_the_Manager_host_tasks">Adding Standard Hosts to the oVirt Engine</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Backing_up_the_Original_Manager_SHE_backup_restore">Backing up the Original Engine</h5>
<div class="paragraph">
<p>Back up the original Engine using the <code>engine-backup</code> command, and copy the backup file to a separate location so that it can be accessed at any point during the process.</p>
</div>
<div class="paragraph">
<p>For more information about <code>engine-backup --mode=backup</code> options, see <a href="https://ovirt.org/documentation/administration_guide/index#sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">Backing Up and Restoring the oVirt Engine</a> in the <em>Administration Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to one of the self-hosted engine nodes and move the environment to global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Log in to the original Engine and stop the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl stop ovirt-engine
# systemctl disable ovirt-engine</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Though stopping the original Engine from running is not obligatory, it is recommended as it ensures no changes are made to the environment after the backup is created. Additionally, it prevents the original Engine and the new Engine from simultaneously managing existing resources.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the <code>engine-backup</code> command, specifying the name of the backup file to create, and the name of the log file to create to store the backup log:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=backup --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</li>
<li>
<p>Copy the files to an external server. In the following example, <code>storage.example.com</code> is the fully qualified domain name of a network storage server that will store the backup until it is needed, and <code>/backup/</code> is any designated folder or path.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp -p <em>file_name</em> <em>log_file_name</em> storage.example.com:/backup/</pre>
</div>
</div>
</li>
<li>
<p>Log in to one of the self-hosted engine nodes and shut down the original Engine virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-shutdown</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After backing up the Engine, deploy a new self-hosted engine and restore the backup on the new virtual machine.</p>
</div>
</div>
<div class="sect4">
<h5 id="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_backup_restore">Restoring the Backup on a New Self-Hosted Engine</h5>
<div class="paragraph">
<p>Run the <code>hosted-engine</code> script on a new host, and use the <code>--restore-from-file=<em>path/to/file_name</em></code> option to restore the Engine backup during the deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using iSCSI storage, and your iSCSI target filters connections according to the initiator&#8217;s ACL, the deployment may fail with a <code>STORAGE_DOMAIN_UNREACHABLE</code> error. To prevent this, you must update your iSCSI configuration before beginning the self-hosted engine deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are redeploying on an existing host, you must update the host&#8217;s iSCSI initiator settings in <code>/etc/iscsi/initiatorname.iscsi</code>. The initiator IQN must be the same as was previously mapped on the iSCSI target, or updated to a new IQN, if applicable.</p>
</li>
<li>
<p>If you are deploying on a fresh host, you must update the iSCSI target configuration to accept connections from that host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the IQN can be updated on the host side (iSCSI initiator), or on the storage side (iSCSI target).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the backup file to the new host. In the following example, <code>host.example.com</code> is the FQDN for the host, and <code>/backup/</code> is any designated folder or path.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp -p <em>file_name</em> host.example.com:/backup/</pre>
</div>
</div>
</li>
<li>
<p>Log in to the new host.</p>
</li>
<li>
<p>If you are deploying on oVirt Node, <code>ovirt-hosted-engine-setup</code> is already installed, so skip this step. If you are deploying on Enterprise Linux, install the <code>ovirt-hosted-engine-setup</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-hosted-engine-setup</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>tmux</code> window manager to run the script to avoid losing the session in case of network or terminal disruption.</p>
<div class="paragraph">
<p>Install and run <code>tmux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf -y install tmux
# tmux</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>hosted-engine</code> script, specifying the path to the backup file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy --restore-from-file=backup/<em>file_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>To escape the script at any time, use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>D</kbd></span> to abort deployment.</p>
</div>
</li>
<li>
<p>Select <strong>Yes</strong> to begin the deployment.</p>
</li>
<li>
<p>Configure the network. The script detects possible NICs to use as a management bridge for the environment.</p>
</li>
<li>
<p>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</p>
</li>
<li>
<p>Enter the root password for the Engine.</p>
</li>
<li>
<p>Enter an SSH public key that will allow you to log in to the Engine as the root user, and specify whether to enable SSH access for the root user.</p>
</li>
<li>
<p>Enter the virtual machine&#8217;s CPU and memory configuration.</p>
</li>
<li>
<p>Enter a MAC address for the Engine virtual machine, or accept a randomly generated one. If you want to provide the Engine virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</p>
</li>
<li>
<p>Enter the virtual machine&#8217;s networking details. If you specify <strong>Static</strong>, enter the IP address of the Engine.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the Engine virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Specify whether to add entries for the Engine virtual machine and the base host to the virtual machine&#8217;s <code>/etc/hosts</code> file. You must ensure that the host names are resolvable.</p>
</li>
<li>
<p>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications:</p>
</li>
<li>
<p>Enter a password for the <code>admin@internal</code> user to access the Administration Portal.</p>
<div class="paragraph">
<p>The script creates the virtual machine. This can take some time if the Engine Appliance needs to be installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the host becomes non operational and the deployment fails (due to missing required network or similar problem), you can repeat the process, and answer <em>YES</em> to the option <em>Pause the execution after adding this host to the engine?</em>. Pausing the process allows you to connect to the restored engine and manually review and remediate the configuration before proceeding with the deployment.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the type of storage to use:</p>
<div class="ulist">
<ul>
<li>
<p>For NFS, enter the version, full address and path to the storage, and any mount options.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><em>Enterprise Linux DM Multipath</em></a> for details. There is also a <a href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</a> tool that generates a script to install and configure multipath with different options.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For Gluster storage, enter the full address and path to the storage, and any mount options.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">gluster volume set <em>VOLUME_NAME</em> group virt
gluster volume set <em>VOLUME_NAME</em> performance.strict-o-direct on
gluster volume set <em>VOLUME_NAME</em> network.remote-dio off
gluster volume set <em>VOLUME_NAME</em> storage.owner-uid 36
gluster volume set <em>VOLUME_NAME</em> storage.owner-gid 36
gluster volume set <em>VOLUME_NAME</em> network.ping-timeout 30</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <a href="https://ovirt.org/documentation/administration_guide/index#Reusing_LUNs">Reusing LUNs</a> in the <em>Administration Guide</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the Engine disk size.</p>
<div class="paragraph">
<p>The script continues until the deployment is complete.</p>
</div>
</li>
<li>
<p>The deployment process changes the Engine&#8217;s SSH keys. To allow client machines to access the new Engine without SSH errors, remove the original Engine&#8217;s entry from the <code>.ssh/known_hosts</code> file on any client machines that accessed the original Engine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the deployment is complete, log in to the new Engine virtual machine and enable the required repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_backup_restore">Enabling the oVirt Engine Repositories</h5>
<div class="paragraph">
<p>Ensure the correct repositories are enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
<div class="paragraph">
<p>You can check which repositories are currently enabled by running <code>dnf repolist</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>javapackages-tools</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable javapackages-tools</pre>
</div>
</div>
</li>
<li>
<p>Enable the <code>pki-deps</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable pki-deps</pre>
</div>
</div>
</li>
<li>
<p>Enable version 12 of the <code>postgresql</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable postgresql:12</pre>
</div>
</div>
</li>
<li>
<p>Synchronize installed packages to update them to the latest available versions.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf distro-sync --nobest</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For information on modules and module streams, see the following sections in <em>Installing, managing, and removing user-space components</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine and its resources are now running in the new self-hosted environment. The self-hosted engine nodes must be reinstalled in the Engine to update their self-hosted engine configuration. Standard hosts are not affected. Perform the following procedure for each self-hosted engine node.</p>
</div>
</div>
<div class="sect4">
<h5 id="Reinstalling_Hosts_SHE_backup_restore">Reinstalling Hosts</h5>
<div class="paragraph">
<p>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</p>
</li>
<li>
<p>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</p>
</li>
<li>
<p>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>. This opens the <strong>Install Host</strong> window.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>DEPLOY</strong> from the drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to reinstall the host.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After a host has been reinstalled and its status returns to <strong>Up</strong>, you can migrate virtual machines back to the host.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <strong>Install Failed</strong>. Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>, and the host will change to an <strong>Up</strong> status and be ready for use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After reinstalling the self-hosted engine nodes, you can check the status of the new environment by running the following command on one of the nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>During the restoration, the old self-hosted engine storage domain was renamed, but was not removed from the new environment in case the restoration was faulty. After confirming that the environment is running normally, you can remove the old self-hosted engine storage domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="Removing_a_Storage_Domain_SHE_backup_restore">Removing a Storage Domain</h5>
<div class="paragraph">
<p>You have a storage domain in your data center that you want to remove from the virtualized environment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Move the storage domain to maintenance mode and detach it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Detach</strong>, then click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Optionally select the <strong>Format Domain, i.e. Storage Content will be lost!</strong> check box to erase the content of the domain.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is permanently removed from the environment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Recovering_a_Self-hosted_Engine">16.1.9. Recovering a Self-Hosted Engine from an Existing Backup</h4>
<div class="paragraph">
<p>If a self-hosted engine is unavailable due to problems that cannot be repaired, you can restore it in a new self-hosted environment using a backup taken before the problem began, if one is available.</p>
</div>
<div class="paragraph">
<p>When you specify a backup file during deployment, the backup is restored on a new Engine virtual machine, with a new self-hosted engine storage domain. The old Engine is removed, and the old self-hosted engine storage domain is renamed and can be manually removed after you confirm that the new environment is working correctly. Deploying on a fresh host is highly recommended; if the host used for deployment existed in the backed up environment, it will be removed from the restored database to avoid conflicts in the new environment. If you deploy on a new host, you must assign a unique name to the host. Reusing the name of an existing host included in the backup can cause conflicts in the new environment.</p>
</div>
<div class="paragraph">
<p>Restoring a self-hosted engine involves the following key actions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_restore_only">Deploy a new self-hosted engine and restore the backup.</a></p>
</li>
<li>
<p><a href="#Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_restore_only">Enable the Engine repositories on the new Engine virtual machine.</a></p>
</li>
<li>
<p><a href="#Reinstalling_Hosts_SHE_restore_only">Reinstall the self-hosted engine nodes to update their configuration.</a></p>
</li>
<li>
<p><a href="#Removing_a_Storage_Domain_SHE_restore_only">Remove the old self-hosted engine storage domain.</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This procedure assumes that you do not have access to the original Engine, and that the new host can access the backup file.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>A fully qualified domain name prepared for your Engine and the host. Forward and reverse lookup records must both be set in the DNS. The new Engine must have the same fully qualified domain name as the original Engine.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Restoring_the_Backup_on_a_New_Self-hosted_Engine_SHE_restore_only">Restoring the Backup on a New Self-Hosted Engine</h5>
<div class="paragraph">
<p>Run the <code>hosted-engine</code> script on a new host, and use the <code>--restore-from-file=<em>path/to/file_name</em></code> option to restore the Engine backup during the deployment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using iSCSI storage, and your iSCSI target filters connections according to the initiator&#8217;s ACL, the deployment may fail with a <code>STORAGE_DOMAIN_UNREACHABLE</code> error. To prevent this, you must update your iSCSI configuration before beginning the self-hosted engine deployment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are redeploying on an existing host, you must update the host&#8217;s iSCSI initiator settings in <code>/etc/iscsi/initiatorname.iscsi</code>. The initiator IQN must be the same as was previously mapped on the iSCSI target, or updated to a new IQN, if applicable.</p>
</li>
<li>
<p>If you are deploying on a fresh host, you must update the iSCSI target configuration to accept connections from that host.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the IQN can be updated on the host side (iSCSI initiator), or on the storage side (iSCSI target).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Copy the backup file to the new host. In the following example, <code>host.example.com</code> is the FQDN for the host, and <code>/backup/</code> is any designated folder or path.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp -p <em>file_name</em> host.example.com:/backup/</pre>
</div>
</div>
</li>
<li>
<p>Log in to the new host.</p>
</li>
<li>
<p>If you are deploying on oVirt Node, <code>ovirt-hosted-engine-setup</code> is already installed, so skip this step. If you are deploying on Enterprise Linux, install the <code>ovirt-hosted-engine-setup</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-hosted-engine-setup</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>tmux</code> window manager to run the script to avoid losing the session in case of network or terminal disruption.</p>
<div class="paragraph">
<p>Install and run <code>tmux</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf -y install tmux
# tmux</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>hosted-engine</code> script, specifying the path to the backup file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --deploy --restore-from-file=backup/<em>file_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>To escape the script at any time, use <span class="keyseq"><kbd>CTRL</kbd>+<kbd>D</kbd></span> to abort deployment.</p>
</div>
</li>
<li>
<p>Select <strong>Yes</strong> to begin the deployment.</p>
</li>
<li>
<p>Configure the network. The script detects possible NICs to use as a management bridge for the environment.</p>
</li>
<li>
<p>If you want to use a custom appliance for the virtual machine installation, enter the path to the OVA archive. Otherwise, leave this field empty to use the Engine Appliance.</p>
</li>
<li>
<p>Enter the root password for the Engine.</p>
</li>
<li>
<p>Enter an SSH public key that will allow you to log in to the Engine as the root user, and specify whether to enable SSH access for the root user.</p>
</li>
<li>
<p>Enter the virtual machine&#8217;s CPU and memory configuration.</p>
</li>
<li>
<p>Enter a MAC address for the Engine virtual machine, or accept a randomly generated one. If you want to provide the Engine virtual machine with an IP address via DHCP, ensure that you have a valid DHCP reservation for this MAC address. The deployment script will not configure the DHCP server for you.</p>
</li>
<li>
<p>Enter the virtual machine&#8217;s networking details. If you specify <strong>Static</strong>, enter the IP address of the Engine.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The static IP address must belong to the same subnet as the host. For example, if the host is in 10.1.1.0/24, the Engine virtual machine&#8217;s IP must be in the same subnet range (10.1.1.1-254/24).</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Specify whether to add entries for the Engine virtual machine and the base host to the virtual machine&#8217;s <code>/etc/hosts</code> file. You must ensure that the host names are resolvable.</p>
</li>
<li>
<p>Provide the name and TCP port number of the SMTP server, the email address used to send email notifications, and a comma-separated list of email addresses to receive these notifications:</p>
</li>
<li>
<p>Enter a password for the <code>admin@internal</code> user to access the Administration Portal.</p>
<div class="paragraph">
<p>The script creates the virtual machine. This can take some time if the Engine Appliance needs to be installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the host becomes non operational and the deployment fails (due to missing required network or similar problem), you can repeat the process, and answer <em>YES</em> to the option <em>Pause the execution after adding this host to the engine?</em>. Pausing the process allows you to connect to the restored engine and manually review and remediate the configuration before proceeding with the deployment.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select the type of storage to use:</p>
<div class="ulist">
<ul>
<li>
<p>For NFS, enter the version, full address and path to the storage, and any mount options.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For iSCSI, enter the portal details and select a target and LUN from the auto-detected lists. You can only select one iSCSI target during the deployment, but multipathing is supported to connect all portals of the same portal group.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To specify more than one iSCSI target, you must enable multipathing before deploying the self-hosted engine. See <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/dm_multipath/"><em>Enterprise Linux DM Multipath</em></a> for details. There is also a <a href="https://access.redhat.com/labs/multipathhelper/#/">Multipath Helper</a> tool that generates a script to install and configure multipath with different options.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For Gluster storage, enter the full address and path to the storage, and any mount options.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not use the old self-hosted engine storage domain&#8217;s mount point for the new storage domain, as you risk losing virtual machine data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only replica 1 and replica 3 Gluster storage are supported. Ensure you configure the volume as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">gluster volume set <em>VOLUME_NAME</em> group virt
gluster volume set <em>VOLUME_NAME</em> performance.strict-o-direct on
gluster volume set <em>VOLUME_NAME</em> network.remote-dio off
gluster volume set <em>VOLUME_NAME</em> storage.owner-uid 36
gluster volume set <em>VOLUME_NAME</em> storage.owner-gid 36
gluster volume set <em>VOLUME_NAME</em> network.ping-timeout 30</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For Fibre Channel, select a LUN from the auto-detected list. The host bus adapters must be configured and connected, and the LUN must not contain any existing data. To reuse an existing LUN, see <a href="https://ovirt.org/documentation/administration_guide/index#Reusing_LUNs">Reusing LUNs</a> in the <em>Administration Guide</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the Engine disk size.</p>
<div class="paragraph">
<p>The script continues until the deployment is complete.</p>
</div>
</li>
<li>
<p>The deployment process changes the Engine&#8217;s SSH keys. To allow client machines to access the new Engine without SSH errors, remove the original Engine&#8217;s entry from the <code>.ssh/known_hosts</code> file on any client machines that accessed the original Engine.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the deployment is complete, log in to the new Engine virtual machine and enable the required repositories.</p>
</div>
</div>
<div class="sect4">
<h5 id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_SHE_restore_only">Enabling the oVirt Engine Repositories</h5>
<div class="paragraph">
<p>Ensure the correct repositories are enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
<div class="paragraph">
<p>You can check which repositories are currently enabled by running <code>dnf repolist</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>javapackages-tools</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable javapackages-tools</pre>
</div>
</div>
</li>
<li>
<p>Enable the <code>pki-deps</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable pki-deps</pre>
</div>
</div>
</li>
<li>
<p>Enable version 12 of the <code>postgresql</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable postgresql:12</pre>
</div>
</div>
</li>
<li>
<p>Synchronize installed packages to update them to the latest available versions.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf distro-sync --nobest</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For information on modules and module streams, see the following sections in <em>Installing, managing, and removing user-space components</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Engine and its resources are now running in the new self-hosted environment. The self-hosted engine nodes must be reinstalled in the Engine to update their self-hosted engine configuration. Standard hosts are not affected. Perform the following procedure for each self-hosted engine node.</p>
</div>
</div>
<div class="sect4">
<h5 id="Reinstalling_Hosts_SHE_restore_only">Reinstalling Hosts</h5>
<div class="paragraph">
<p>Reinstall oVirt Nodes (oVirt Node) and Enterprise Linux hosts from the Administration Portal. The procedure includes stopping and restarting the host.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When installing or reinstalling the host&#8217;s operating system, oVirt strongly recommends that you first detach any existing non-OS storage that is attached to the host to avoid accidental initialization of these disks, and with that, potential data loss.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>If the cluster has migration enabled, virtual machines can automatically migrate to another host in the cluster. Therefore, reinstall a host while its usage is relatively low.</p>
</li>
<li>
<p>Ensure that the cluster has sufficient memory for its hosts to perform maintenance. If a cluster lacks memory, migration of virtual machines will hang and then fail. To reduce memory usage, shut down some or all of the virtual machines before moving the host to maintenance.</p>
</li>
<li>
<p>Ensure that the cluster contains more than one host before performing a reinstall. Do not attempt to reinstall all the hosts at the same time. One host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Hosts</b></span> and select the host.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Maintenance</b></span> and <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reinstall</b></span>. This opens the <strong>Install Host</strong> window.</p>
</li>
<li>
<p>Click the <strong>Hosted Engine</strong> tab and select <strong>DEPLOY</strong> from the drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to reinstall the host.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After a host has been reinstalled and its status returns to <strong>Up</strong>, you can migrate virtual machines back to the host.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After you register a oVirt Node to the oVirt Engine and reinstall it, the Administration Portal may erroneously display its status as <strong>Install Failed</strong>. Click <span class="menuseq"><b class="menu">Management</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Activate</b></span>, and the host will change to an <strong>Up</strong> status and be ready for use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After reinstalling the self-hosted engine nodes, you can check the status of the new environment by running the following command on one of the nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>During the restoration, the old self-hosted engine storage domain was renamed, but was not removed from the new environment in case the restoration was faulty. After confirming that the environment is running normally, you can remove the old self-hosted engine storage domain.</p>
</div>
</div>
<div class="sect4">
<h5 id="Removing_a_Storage_Domain_SHE_restore_only">Removing a Storage Domain</h5>
<div class="paragraph">
<p>You have a storage domain in your data center that you want to remove from the virtualized environment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Move the storage domain to maintenance mode and detach it:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the storage domain&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Data Center</strong> tab.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>, then click <b class="button">OK</b>.</p>
</li>
<li>
<p>Click <strong>Detach</strong>, then click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Optionally select the <strong>Format Domain, i.e. Storage Content will be lost!</strong> check box to erase the content of the domain.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The storage domain is permanently removed from the environment.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Overwriting_a_Self-Hosted_Engine">16.1.10. Overwriting a Self-Hosted Engine from an Existing Backup</h4>
<div class="paragraph">
<p>If a self-hosted engine is accessible, but is experiencing an issue such as database corruption, or a configuration error that is difficult to roll back, you can restore the environment to a previous state using a backup taken before the problem began, if one is available.</p>
</div>
<div class="paragraph">
<p>Restoring a self-hosted engine&#8217;s previous state involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Enabling_Global_Maintenance_Mode_SHE_overwrite">Place the environment in global maintenance mode.</a></p>
</li>
<li>
<p><a href="#Restoring_a_Backup_to_Overwrite_an_Existing_Installation_SHE_overwrite">Restore the backup on the Engine virtual machine.</a></p>
</li>
<li>
<p><a href="#Disabling_Global_Maintenance_Mode_SHE_overwrite">Disable global maintenance mode.</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information about <code>engine-backup --mode=restore</code> options, see <a href="#sect-Backing_Up_and_Restoring_the_Red_Hat_Enterprise_Virtualization_Manager">Backing Up and Restoring the oVirt Engine</a>.</p>
</div>
<div class="sect4">
<h5 id="Enabling_Global_Maintenance_Mode_SHE_overwrite">Enabling global maintenance mode</h5>
<div class="paragraph">
<p>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the Engine virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the environment is in global maintenance mode before proceeding:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>You should see a message indicating that the cluster is in global maintenance mode.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="Restoring_a_Backup_to_Overwrite_an_Existing_Installation_SHE_overwrite">Restoring a Backup to Overwrite an Existing Installation</h5>
<div class="paragraph">
<p>The <code>engine-backup</code> command can restore a backup to a machine on which the oVirt Engine has already been installed and set up. This is useful when you have taken a backup of an environment, performed changes on that environment, and then want to undo the changes by restoring the environment from the backup.</p>
</div>
<div class="paragraph">
<p>Changes made to the environment since the backup was taken, such as adding or removing a host, will not appear in the restored environment. You must redo these changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Remove the configuration files and clean the database associated with the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-cleanup</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>engine-cleanup</code> command only cleans the Engine database; it does not drop the database or delete the user that owns that database.</p>
</div>
</li>
<li>
<p>Restore a full backup or a database-only backup. You do not need to create a new database or specify the database credentials because the user and database already exist.</p>
<div class="ulist">
<ul>
<li>
<p>Restore a full backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --file=<em>file_name</em> --log=<em>log_file_name</em> --restore-permissions</pre>
</div>
</div>
</li>
<li>
<p>Restore a database-only backup by restoring the configuration files and the database backup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=db --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --restore-permissions</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To restore only the Engine database (for example, if the Data Warehouse database is located on another machine), you can omit the <code>--scope=dwhdb</code> parameter.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If successful, the following output displays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">You should now run engine-setup.
Done.</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Reconfigure the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="Disabling_Global_Maintenance_Mode_SHE_overwrite">Disabling global maintenance mode</h5>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine virtual machine and shut it down.</p>
</li>
<li>
<p>Log in to one of the self-hosted engine nodes
and disable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
<div class="paragraph">
<p>When you exit global maintenance mode, ovirt-ha-agent starts the Engine virtual machine, and then the Engine automatically starts. It can take up to ten minutes for the Engine to start.</p>
</div>
</li>
<li>
<p>Confirm that the environment is running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>The listed information includes <strong>Engine Status</strong>. The value for <strong>Engine status</strong> should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"health": "good", "vm": "up", "detail": "Up"}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the virtual machine is still booting and the Engine hasn&#8217;t started yet, the <strong>Engine status</strong> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</pre>
</div>
</div>
<div class="paragraph">
<p>If this happens, wait a few minutes and try again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the environment is running again, you can start any virtual machines that were stopped, and check that the resources in the environment are behaving as expected.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="migrating-rhv-databases">16.2. Migrating oVirt Databases to Remote Servers</h3>
<div class="sect3">
<h4 id="Migrating_Data_Warehouse_to_a_Separate_Machine_migrate_database">16.2.1. Migrating Data Warehouse to a Separate Machine</h4>
<div class="paragraph">
<p>This section describes how to migrate the Data Warehouse database and service from the oVirt Engine machine to a separate machine. Hosting the Data Warehouse service on a separate machine reduces the load on each individual machine, and avoids potential conflicts caused by sharing CPU and memory resources with other processes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You have the following migration options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can migrate the Data Warehouse service away from the Engine machine and connect it with the existing Data Warehouse database (<code>ovirt_engine_history</code>).</p>
</li>
<li>
<p>You can migrate the Data Warehouse database away from the Engine machine and then migrate the Data Warehouse service.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</h5>
<div class="paragraph">
<p>Migrate the Data Warehouse database (<code>ovirt_engine_history</code>) before you migrate the Data Warehouse service. Use <code>engine-backup</code> to create a database backup and restore it on the new database machine. For more information on <code>engine-backup</code>, run <code>engine-backup --help</code>.</p>
</div>
<div class="paragraph">
<p>To migrate the Data Warehouse service, see <a href="#Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Service to a Separate Machine</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The new database server must have Enterprise Linux 8 installed.
Enable the required repositories on the new database server.</p>
</div>
<h6 id="Enabling_the_Red_Hat_Virtualization_Manager_Repositories_migrate_DWH_DB" class="discrete">Enabling the oVirt Engine Repositories</h6>
<div class="paragraph">
<p>Ensure the correct repositories are enabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
<div class="paragraph">
<p>You can check which repositories are currently enabled by running <code>dnf repolist</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>javapackages-tools</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable javapackages-tools</pre>
</div>
</div>
</li>
<li>
<p>Enable version 12 of the <code>postgresql</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable postgresql:12</pre>
</div>
</div>
</li>
<li>
<p>Synchronize installed packages to update them to the latest available versions.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf distro-sync --nobest</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Additional resources</div>
<p>For information on modules and module streams, see the following sections in <em>Installing, managing, and removing user-space components</em></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#module-streams_introduction-to-modules">Module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#selecting-a-stream-before-installation-of-packages_installing-rhel-8-content">Selecting a stream before installation of packages</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#resetting-module-streams_removing-rhel-8-content">Resetting module streams</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/installing_managing_and_removing_user-space_components/index#switching-to-a-later-stream_managing-versions-of-appstream-content">Switching to a later stream</a></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<h6 id="migrating-the-data-warehouse-database-to-a-separate-machine" class="discrete">Migrating the Data Warehouse Database to a Separate Machine</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a backup of the Data Warehouse database and configuration files on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=backup --scope=dwhdb --scope=files --file=<em>file_name</em> --log=<em>log_file_name</em></pre>
</div>
</div>
</li>
<li>
<p>Copy the backup file from the Engine to the new machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp <em>/tmp/file_name</em> <em>root@new.dwh.server.com:/tmp</em></pre>
</div>
</div>
</li>
<li>
<p>Install <code>engine-backup</code> on the new machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-tools-backup</pre>
</div>
</div>
</li>
<li>
<p>Install the PostgreSQL server package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install postgresql-server postgresql-contrib</pre>
</div>
</div>
</li>
<li>
<p>Initialize the PostgreSQL database, start the <code>postgresql</code> service, and ensure that this service starts on boot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su - postgres -c 'initdb'
# systemctl enable postgresql
# systemctl start postgresql</pre>
</div>
</div>
</li>
<li>
<p>Restore the Data Warehouse database on the new machine. <em>file_name</em> is the backup file copied from the Engine.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --scope=files --scope=dwhdb --file=<em>file_name</em> --log=<em>log_file_name</em> --provision-dwh-db --restore-permissions</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse database is now hosted on a separate machine from that on which the Engine is hosted. After successfully restoring the Data Warehouse database, a prompt instructs you to run the <code>engine-setup</code> command. Before running this command, migrate the Data Warehouse service.</p>
</div>
</div>
<div class="sect4">
<h5 id="Migrating_the_Data_Warehouse_Service_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Service to a Separate Machine</h5>
<div class="paragraph">
<p>You can migrate the Data Warehouse service installed and configured on the oVirt Engine to a separate machine. Hosting the Data Warehouse service on a separate machine helps to reduce the load on the Engine machine.</p>
</div>
<div class="paragraph">
<p>Notice that this procedure migrates the Data Warehouse service only.</p>
</div>
<div class="paragraph">
<p>To migrate the Data Warehouse database (<code>ovirt_engine_history</code>) prior to migrating the Data Warehouse service, see <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have installed and configured the Engine and Data Warehouse on the same machine.</p>
</li>
<li>
<p>To set up the new Data Warehouse machine, you must have the following:</p>
<div class="ulist">
<ul>
<li>
<p>The password from the Engine&#8217;s <strong>/etc/ovirt-engine/engine.conf.d/10-setup-database.conf</strong> file.</p>
</li>
<li>
<p>Allowed access from the Data Warehouse machine to the Engine database machine&#8217;s TCP port 5432.</p>
</li>
<li>
<p>The username and password for the Data Warehouse database from the Engine&#8217;s <strong>/etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf</strong> file. If you migrated the <code>ovirt_engine_history</code> database using <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a>, the backup includes these credentials, which you defined during the database setup on that machine.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Installing this scenario requires four steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#setting_up_machine">Setting up the New Data Warehouse Machine</a></p>
</li>
<li>
<p><a href="#stopping_dwh_service">Stopping the Data Warehouse service on the Engine machine</a></p>
</li>
<li>
<p><a href="#configuring_new_machine">Configuring the new Data Warehouse machine</a></p>
</li>
<li>
<p><a href="#disabling_dwh_package">Disabling the Data Warehouse package on the Engine machine</a></p>
</li>
</ol>
</div>
<div class="sect5">
<h6 id="setting_up_machine">Setting up the New Data Warehouse Machine</h6>
<div class="paragraph">
<p>Enable the oVirt repositories and install the Data Warehouse setup package on a Enterprise Linux 8 machine:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>pki-deps</code> module.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf module -y enable pki-deps</pre>
</div>
</div>
</li>
<li>
<p>Ensure that all packages currently installed are up to date:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf upgrade --nobest</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>ovirt-engine-dwh-setup</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-dwh-setup</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="stopping_dwh_service">Stopping the Data Warehouse Service on the Engine Machine</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the Data Warehouse service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl stop ovirt-engine-dwhd.service</pre>
</div>
</div>
</li>
<li>
<p>If the database is hosted on a remote machine, you must manually grant access by editing the postgres.conf file. Edit the <code class="filename">/var/lib/pgsql/data/postgresql.conf</code> file and modify the listen_addresses line so that it matches the following:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">listen_addresses = '*'</pre>
</div>
</div>
<div class="paragraph">
<p>If the line does not exist or has been commented out, add it manually.</p>
</div>
<div class="paragraph">
<p>If the database is hosted on the Engine machine and was configured during a clean setup of the oVirt Engine, access is granted by default.</p>
</div>
<div class="paragraph">
<p>See <a href="#Migrating_the_Data_Warehouse_Database_to_a_Separate_Machine_migrate_DWH">Migrating the Data Warehouse Database to a Separate Machine</a> for more information on how to configure and migrate the Data Warehouse database.</p>
</div>
</li>
<li>
<p>Restart the postgresql service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart postgresql</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect5">
<h6 id="configuring_new_machine">Configuring the New Data Warehouse Machine</h6>
<div class="paragraph">
<p>The order of the options or settings shown in this section may differ depending on your environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are migrating both the <code>ovirt_engine_history</code> database and the Data Warehouse service to the <strong>same</strong> machine, run the following, otherwise proceed to the next step.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sed -i '/^ENGINE_DB_/d' \
        /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/10-setup-database.conf

# sed -i \
     -e 's;^\(OVESETUP_ENGINE_CORE/enable=bool\):True;\1:False;' \
     -e '/^OVESETUP_CONFIG\/fqdn/d' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</pre>
</div>
</div>
</li>
<li>
<p>Run the <code>engine-setup</code> command to begin configuration of Data Warehouse on the machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
<li>
<p>Press <strong>Enter</strong> to accept the automatically detected host name, or enter an alternative host name and press <strong>Enter</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Host fully qualified DNS name of this server [<em>autodetected host name</em>]:</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Enter</code> to automatically configure the firewall, or type <code>No</code> and press <code>Enter</code> to maintain existing settings:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Setup can automatically configure the firewall on this system.
Note: automatic configuration of the firewall may overwrite current settings.
Do you want Setup to configure the firewall? (Yes, No) [Yes]:</pre>
</div>
</div>
<div class="paragraph">
<p>If you choose to automatically configure the firewall, and no firewall managers are active, you are prompted to select your chosen firewall manager from a list of supported options. Type the name of the firewall manager and press <code>Enter</code>. This applies even in cases where only one option is listed.</p>
</div>
</li>
<li>
<p>Enter the fully qualified domain name and password for the Engine. Press <strong>Enter</strong> to accept the default values in each other field:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Host fully qualified DNS name of the engine server []: <em>engine-fqdn</em>
Setup needs to do some actions on the remote engine server. Either automatically, using ssh as root to access it, or you will be prompted to manually perform each such action.
Please choose one of the following:
1 - Access remote engine server using ssh as root
2 - Perform each action manually, use files to copy content around
(1, 2) [1]:
ssh port on remote engine server [22]:
root password on remote engine server <em>engine-fqdn</em>: <em>password</em></pre>
</div>
</div>
</li>
<li>
<p>Enter the FQDN and password for the Engine database machine. Press <code>Enter</code> to accept the default values in each other field:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Engine database host []: <em>manager-db-fqdn</em>
Engine database port [5432]:
Engine database secured connection (Yes, No) [No]:
Engine database name [engine]:
Engine database user [engine]:
Engine database password: <em>password</em></pre>
</div>
</div>
</li>
<li>
<p>Confirm your installation settings:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please confirm installation settings (OK, Cancel) [OK]:</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse service is now configured on the remote machine. Proceed to disable the Data Warehouse service on the Engine machine.</p>
</div>
</div>
<div class="sect5">
<h6 id="disabling_dwh_package">Disabling the Data Warehouse Service on the Engine Machine</h6>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine machine, restart the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># service ovirt-engine restart</pre>
</div>
</div>
</li>
<li>
<p>Run the following command to modify the file <strong>/etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</strong> and set the options to <code>False</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># sed -i \
     -e 's;^\(OVESETUP_DWH_CORE/enable=bool\):True;\1:False;' \
     -e 's;^\(OVESETUP_DWH_CONFIG/remoteEngineConfigured=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf

# sed -i \
     -e 's;^\(OVESETUP_GRAFANA_CORE/enable=bool\):True;\1:False;' \
     /etc/ovirt-engine-setup.conf.d/20-setup-ovirt-post.conf</pre>
</div>
</div>
</li>
<li>
<p>Disable the Data Warehouse service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl disable ovirt-engine-dwhd.service</pre>
</div>
</div>
</li>
<li>
<p>Remove the Data Warehouse files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm -f /etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/* .conf /var/lib/ovirt-engine-dwh/backups/*</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The Data Warehouse service is now hosted on a separate machine from the Engine.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Backing_Up_and_Restoring_Virtual_Machines_Using_a_Backup_Domain">16.3. Backing Up and Restoring Virtual Machines Using a Backup Storage Domain</h3>
<div class="sect3">
<h4 id="con_Backup_domains_explained_backup_domain">16.3.1. Backup storage domains explained</h4>
<div class="paragraph">
<p>A backup storage domain is one that you can use specifically for storing and migrating virtual machines and virtual machine templates for the purpose of backing up and restoring for disaster recovery, migration, or any other backup/restore usage model. A backup domain differs from a non-backup domain in that all virtual machines on a backup domain are in a powered-down state. A virtual machine cannot run on a backup domain.</p>
</div>
<div class="paragraph">
<p>You can set any data storage domain to be a backup domain. You can enable or disable this setting by selecting or deselecting a checkbox in the Manage Domain dialog box. You can enable this setting only after all virtual machines on that storage domain are stopped.</p>
</div>
<div class="paragraph">
<p>You cannot start a virtual machine stored on a backup domain. The Manager blocks this and any other operation that might invalidate the backup. However, you can run a virtual machine based on a template stored on a backup domain if the virtual machine&#8217;s disks are not part of a backup domain.</p>
</div>
<div class="paragraph">
<p>As with other types of storage domains, you can attach or detach backup domains to or from a data center. So, in addition to storing backups, you can use backup domains to migrate virtual machines between data centers.</p>
</div>
<div class="paragraph">
<div class="title">Advantages</div>
<p>Some reasons to use a backup domain, rather than an export domain, are listed here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can have multiple backup storage domains in a data center, as opposed to only one export domain.</p>
</li>
<li>
<p>You can dedicate a backup storage domain to use for backup and disaster recovery.</p>
</li>
<li>
<p>You can transfer a backup of a virtual machine, a template, or a snapshot to a backup storage domain</p>
</li>
<li>
<p>Migrating a large number of virtual machines, templates, or OVF files is significantly faster with backup domains than export domains.</p>
</li>
<li>
<p>A backup domain uses disk space more efficiently than an export domain.</p>
</li>
<li>
<p>Backup domains support both file storage (NFS, Gluster) and block storage (Fiber Channel and iSCSI). This contrasts with export domains, which only support file storage.</p>
</li>
<li>
<p>You can dynamically enable and disable the backup setting for a storage domain, taking into account the restrictions.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Restrictions</div>
<ul>
<li>
<p>Any virtual machine or template on a _backup domain must have all its disks on that same domain.</p>
</li>
<li>
<p>All virtual machines on a storage domain must be powered down before you can set it to be a backup domain.</p>
</li>
<li>
<p>You cannot run a virtual machine that is stored on a backup domain, because doing so might manipulate the disk&#8217;s data.</p>
</li>
<li>
<p>A backup domain cannot be the target of memory volumes because memory volumes are only supported for active virtual machines.</p>
</li>
<li>
<p>You cannot preview a virtual machine on a backup domain.</p>
</li>
<li>
<p>Live migration of a virtual machine to a backup domain is not possible.</p>
</li>
<li>
<p>You cannot set a backup domain to be the master domain.</p>
</li>
<li>
<p>You cannot set a Self-hosted engine&#8217;s domain to be a backup domain.</p>
</li>
<li>
<p>Do not use the default storage domain as a backup domain.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Setting_a_storage_domain_to_be_a_backup_domain_backup_domain">16.3.2. Setting a data storage domain to be a backup domain</h4>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All disks belonging to a virtual machine or template on the storage domain must be on the same domain.</p>
</li>
<li>
<p>All virtual machines on the domain must be powered down.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, select <span class="menuseq"><b class="menu">Storage</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Domains</b></span>.</p>
</li>
<li>
<p>Create a new storage domain or select an existing storage domain and click <strong>Manage Domain</strong>. The Manage Domains dialog box opens.</p>
</li>
<li>
<p>Under <strong>Advanced Parameters</strong>, select the <strong>Backup</strong> checkbox.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The domain is now a backup domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc_Backing_Up_a_Virtual_Machine_backup_domain">16.3.3. Backing up or Restoring a Virtual Machine or Snapshot Using a Backup Domain</h4>
<div class="paragraph">
<p>You can back up a powered down virtual machine or snapshot. You can then store the backup on the same data center and restore it as needed, or migrate it to another data center.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Backing Up a Virtual Machine</div>
<ol class="arabic">
<li>
<p>Create a backup domain. See <a href="#Setting_a_storage_domain_to_be_a_backup_domain_backup_domain">Setting a data storage domain to be a backup domain</a>.</p>
</li>
<li>
<p>Create a new virtual machine based on the virtual machine you want to back up:</p>
<div class="ulist">
<ul>
<li>
<p>To back up a snapshot, first create a virtual machine from a snapshot. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#creating_a_virtual_machine_from_a_snapshot">Creating a Virtual Machine from a Snapshot</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
<li>
<p>To back up a virtual machine, first clone the virtual machine. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#cloning_a_virtual_machine">Cloning a Virtual Machine</a> in the <em>Virtual Machine Management Guide</em>. Make sure the clone is powered down before proceeding.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Export the new virtual machine to a backup domain. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#proc_Exporting_individual_virtual_machines_to_a_data_domain_vm_guide_administrative_tasks">Exporting a Virtual Machine to a Data Domain</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Restoring a Virtual Machine</div>
<ol class="arabic">
<li>
<p>Make sure that the backup storage domain that stores the virtual machine backup is attached to a data center.</p>
</li>
<li>
<p>Import the virtual machine from the backup domain. See <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Importing_a_Virtual_Machine_from_a_Data_Domain">Importing Virtual Machines from a Data Domain</a>.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Related information</div>
<ul>
<li>
<p><a href="#Importing_storage_domains">Importing storage domains</a></p>
</li>
<li>
<p><a href="#Migrating_SD_between_DC_Same_Env">Migrating Storage Domains between Data Centers in the Same Environment</a></p>
</li>
<li>
<p><a href="#Migrating_SD_between_DC_different_env">Migrating Storage Domains between Data Centers in Different Environments</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Backing_Up_and_Restoring_Virtual_Machines_Using_the_Backup_and_Restore_API">16.4. Backing Up and Restoring Virtual Machines Using the Backup and Restore API</h3>
<div class="sect3">
<h4 id="The_Backup_and_Restore_API">16.4.1. The Backup and Restore API</h4>
<div class="paragraph">
<p>The backup and restore API is a collection of functions that allows you to perform full or file-level backup and restoration of virtual machines. The API combines several components of oVirt, such as live snapshots and the REST API, to create and work with temporary volumes that can be attached to a virtual machine containing backup software provided by an independent software provider.</p>
</div>
<div class="paragraph">
<p>For supported third-party backup vendors, consult the <a href="https://access.redhat.com/ecosystem">oVirt Ecosystem</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Backing_Up_a_Virtual_Machine">16.4.2. Backing Up a Virtual Machine</h4>
<div class="paragraph">
<p>Use the backup and restore API to back up a virtual machine. This procedure assumes you have two virtual machines: the virtual machine to back up, and a virtual machine on which the software for managing the backup is installed.</p>
</div>
<div class="paragraph">
<p><strong>Backing Up a Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using the REST API, create a snapshot of the virtual machine to back up:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /api/vms/<code><em>{vm:id}</em></code>/snapshots/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;snapshot&gt;
    &lt;description&gt;BACKUP&lt;/description&gt;
&lt;/snapshot&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Here, replace <code><em>{vm:id}</em></code> with the VM ID of the virtual machine whose snapshot you are making. This ID is available from the <strong>General</strong> tab of the <strong>New Virtual Machine</strong> and <strong>Edit Virtual Machine</strong> windows in the <strong>Administration Portal</strong> and <strong>VM Portal</strong>.</p>
</li>
<li>
<p>Taking a snapshot of a virtual machine stores its current configuration data in the <code>data</code> attribute of the <code>configuration</code> attribute in <code>initialization</code> under the snapshot.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot take snapshots of disks marked as shareable or based on direct LUN disks.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Retrieve the configuration data of the virtual machine from the <code>data</code> attribute under the snapshot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /api/vms/<code><em>{vm:id}</em></code>/snapshots/<code><em>{snapshot:id}</em></code> HTTP/1.1
All-Content: true
Accept: application/xml
Content-type: application/xml</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Here, replace <code><em>{vm:id}</em></code> with the ID of the virtual machine whose snapshot you made earlier. Replace <code><em>{snapshot:id}</em></code> with the snapshot ID.</p>
</li>
<li>
<p>Add the <code>All-Content: true</code> header to retrieve additional OVF data in the response. The OVF data in the XML response is located within the VM configuration element, <code>&lt;initialization&gt;&lt;configuration&gt;</code>. Later, you will use this data to restore the virtual machine.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Get the snapshot ID:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /api/vms/{vm:id}/snapshots/ HTTP/1.1
Accept: application/xml
Content-type: application/xml</pre>
</div>
</div>
</li>
<li>
<p>Identify the disk ID of the snapshot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /api/vms/<code><em>{vm:id}</em></code>/snapshots/<code><em>{snapshot:id}</em></code>/disks HTTP/1.1
Accept: application/xml
Content-type: application/xml</pre>
</div>
</div>
</li>
<li>
<p>Attach the snapshot to a backup virtual machine as an active disk attachment, with the correct interface type (for example, <strong>virtio_scsi</strong>):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /api/vms/<code><em>{vm:id}</em></code>/diskattachments/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk_attachment&gt;
	&lt;active&gt;true&lt;/active&gt;
	&lt;interface&gt;_virtio_scsi_&lt;/interface&gt;
	&lt;disk id="<em>{disk:id}</em>"&gt;
	&lt;snapshot id="<em>{snapshot:id}</em>"/&gt;
	&lt;/disk&gt;
&lt;/disk_attachment&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here, replace <code><em>{vm:id}</em></code> with the ID of the <em>backup</em> virtual machine, not the virtual machine whose snapshot you made earlier. Replace <code><em>{disk:id}</em></code> with the disk ID. Replace <code><em>{snapshot:id}</em></code> with the snapshot ID.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the backup software on the backup virtual machine to back up the data on the snapshot disk.</p>
</li>
<li>
<p>Remove the snapshot disk attachment from the backup virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DELETE /api/vms/<code><em>{vm:id}</em></code>/diskattachments/<code><em>{snapshot:id}</em></code> HTTP/1.1
Accept: application/xml
Content-type: application/xml</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here, replace <code><em>{vm:id}</em></code> with the ID of the <em>backup</em> virtual machine, not the virtual machine whose snapshot you made earlier. Replace <code><em>{snapshot:id}</em></code> with the snapshot ID.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Optionally, delete the snapshot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DELETE /api/vms/<code><em>{vm:id}</em></code>/snapshots/<code><em>{snapshot:id}</em></code> HTTP/1.1
Accept: application/xml
Content-type: application/xml</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Here, replace <code><em>{vm:id}</em></code> with the ID of the virtual machine whose snapshot you made earlier. Replace <code><em>{snapshot:id}</em></code> with the snapshot ID.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have backed up the state of a virtual machine at a fixed point in time using backup software installed on a separate virtual machine.</p>
</div>
</div>
<div class="sect3">
<h4 id="Restoring_a_Virtual_Machine">16.4.3. Restoring a Virtual Machine</h4>
<div class="paragraph">
<p>Restore a virtual machine that has been backed up using the backup and restore API. This procedure assumes you have a backup virtual machine on which the software used to manage the previous backup is installed.</p>
</div>
<div class="paragraph">
<p><strong>Restoring a Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, create a floating disk on which to restore the backup. See <a href="#Creating_a_Virtual_Disk">Creating a Virtual Disk</a> for details on how to create a floating disk.</p>
</li>
<li>
<p>Attach the disk to the backup virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /api/vms/<code><em>{vm:id}</em></code>/disks/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk id="<em>{disk:id}</em>"&gt;
&lt;/disk&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Here, replace <code>{vm:id}</code> with the ID of this <em>backup</em> virtual machine, not the virtual machine whose snapshot you made earlier.
Replace <code>{disk:id}</code> with the disk ID you got while backing up the virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the backup software to restore the backup to the disk.</p>
</li>
<li>
<p>Detach the disk from the backup virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DELETE /api/vms/<code><em>{vm:id}</em></code>/disks/<em>{disk:id}</em> HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;action&gt;
    &lt;detach&gt;true&lt;/detach&gt;
&lt;/action&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Here, replace <code>{vm:id}</code> with the ID of this <em>backup</em> virtual machine, not the virtual machine whose snapshot you made earlier.
Replace <code>{disk:id}</code> with the disk ID.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a new virtual machine using the configuration data of the virtual machine being restored:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /api/vms/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;vm&gt;
    &lt;cluster&gt;
        &lt;name&gt;cluster_name&lt;/name&gt;
    &lt;/cluster&gt;
    &lt;name&gt;_NAME_&lt;/name&gt;
      &lt;initialization&gt;
      &lt;configuration&gt;
  &lt;data&gt;
  &lt;!-- omitting long ovf data --&gt;
  &lt;/data&gt;
      &lt;type&gt;ovf&lt;/type&gt;
      &lt;/configuration&gt;
      &lt;/initialization&gt;
    ...
&lt;/vm&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To override any of the values in the ovf while creating the virtual machine,  redefine the element <em>before</em> or <em>after</em> the <code>initialization</code> element. Not within the initialization element.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Attach the disk to the new virtual machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /api/vms/<code><em>{vm:id}</em></code>/disks/ HTTP/1.1
Accept: application/xml
Content-type: application/xml

&lt;disk id="<em>{disk:id}</em>"&gt;
&lt;/disk&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Here, replace <code>{vm:id}</code> with the ID of the new virtual machine, not the virtual machine whose snapshot you made earlier. Replace <code>{disk:id}</code> with the disk ID.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have restored a virtual machine using a backup that was created using the backup and restore API.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="backing-up-and-restoring-virtual-machines-using-the-incremental-backup-and-restore-api">16.5. Backing Up and Restoring Virtual Machines Using the Incremental Backup and Restore API</h3>
<div id="assembly_incremental-backup-and-restore_RHV_backup_restore" class="paragraph _abstract">
<p>oVirt provides an Incremental Backup API that you can use for full backups of QCOW2 or RAW virtual disks, or incremental backups of QCOW 2 virtual disks, without any temporary snapshots. Data is backed-up in RAW format, whether the virtual disk  being backed up is QCOW2 or RAW. You can restore RAW guest data and either RAW or QCOW2 disks. The Incremental Backup API is part of the oVirt REST API. You can backup virtual machines that are running or that are not.</p>
</div>
<div class="paragraph">
<p>As a developer, you can use the API to develop a backup application.</p>
</div>
<div class="paragraph">
<div class="title">Features</div>
<p>Backups are simpler, faster and more robust than when using the Backup and Restore API. The Incremental Backup API provides improved integration with backup applications, with new support for backing up and restoring RAW guest data, regardless of the underlying disk format.</p>
</div>
<div class="paragraph">
<p>If an invalid bitmap causes a backup to fail, you can remove a specific checkpoint in the backup chain. You do not need to run a full backup.</p>
</div>
<div class="ulist">
<div class="title">Limitations:</div>
<ul>
<li>
<p>Only disks in QCOW2 format can be backed up incrementally, not RAW format disks. The backup process saves the backed up data in RAW format.</p>
</li>
<li>
<p>Only backed up data in RAW format can be restored.</p>
</li>
<li>
<p>Incremental restore does not support restoring snapshots as they existed at the time of the backup, rather incremental restore restores only the data and not the structure of volumes or images in snapshots as they existed at the time of the backup. This limit is common in backup solutions for other systems.</p>
</li>
<li>
<p>As is commonly the case with backup solutions, incremental restore restores only the data and not the structure of volumes or images in snapshots as they existed at the time of the backup.</p>
</li>
<li>
<p>An unclean shutdown of a virtual machine, whatever the cause, might invalidate bitmaps on the disk, which invalidates the entire backup chain. Restoring an incremental backup using an invalid bitmap leads to corrupt virtual machine data.</p>
<div class="paragraph">
<p>There is no way to detect an invalid bitmap, other than starting a backup. If the disk includes any invalid bitmaps, the operation fails.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table describes the disk configurations that support incremental backup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you create a disk using the Administration portal, you set the storage type, provisioning type, and whether incremental backup is enabled or disabled. Based on these settings, the Engine determines the virtual disk format.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. Supported disk configurations for incremental backup</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Storage type</th>
<th class="tableblock halign-left valign-top">Provisioning type</th>
<th class="tableblock halign-left valign-top">When incremental backup is&#8230;&#8203;</th>
<th class="tableblock halign-left valign-top">Virtual disk format is&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">qcow2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">qcow2 (preallocated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">qcow2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">qcow2 (preallocated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">qcow2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">block</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw (preallocated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw (sparse)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preallocated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw (preallocated)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">network</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not applicable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Not applicable</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">raw</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="the-incremental-backup-flow">16.5.1. The Incremental Backup Flow</h4>
<div class="paragraph">
<p>A backup application that uses the Incremental Backup API must follow this sequence to back up virtual machine disks that have already been enabled for incremental backup:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The backup application uses the REST API to <a href="#find-disks-enabled-for-incremental-backup">find virtual machine disks</a> that should be included in the backup. Only disks in QCOW2 format are included.</p>
</li>
<li>
<p>The backup application starts a <a href="#start-a-full-backup_assembly_incremental-backup-and-restore">full backup</a> or an <a href="#start-an-incremental-backup_assembly_incremental-backup-and-restore">incremental backup</a>. The API call specifies a virtual machine ID, an optional previous checkpoint ID, and a list of disks to back up. If the API call does not specify a previous checkpoint ID, a full backup begins, which includes all data in the specified disks, based on the current state of each disk.</p>
</li>
<li>
<p>The engine prepares the virtual machine for backup. The virtual machine can continue running during the backup.</p>
</li>
<li>
<p>The backup application polls the engine for the backup status, until the engine reports that the backup is ready to begin.</p>
</li>
<li>
<p>When the backup is ready to begin, the backup application <a href="#image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">creates an image transfer object</a> for every disk included in the backup.</p>
</li>
<li>
<p>The backup application <a href="#ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">gets a list of changed blocks from <code>ovirt-imageio</code> for every image transfer</a>. If a change list is not available, the backup application gets an error.</p>
</li>
<li>
<p>The backup application <a href="#ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">downloads changed blocks in RAW format from <code>ovirt-imageio</code> and stores them in the backup media</a>. If a list of changed blocks is not available, the backup application can fall back to copying the entire disk.</p>
</li>
<li>
<p>The backup application finalizes all image transfers.</p>
</li>
<li>
<p>The backup application <a href="#finalize-a-backup_assembly_incremental-backup-and-restore">finalizes the backup using the REST API</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="the-incremental-restore-flow">16.5.2. The Incremental Restore Flow</h4>
<div class="paragraph">
<p>A backup application that uses the Incremental Backup API must follow this sequence to restore virtual machine disks that have been backed up:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The user selects a restore point based on available backups using the backup application.</p>
</li>
<li>
<p>The backup application creates a new disk or a snapshot with an existing disk to hold the restored data.</p>
</li>
<li>
<p>The backup application <a href="#image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">starts an upload image transfer for every disk</a>, specifying <code>format</code> is <code>raw</code>. This enables format conversion when uploading RAW data to a QCOW2 disk.</p>
</li>
<li>
<p>The backup application <a href="#ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">transfers the data included in this restore point to <code>imageio</code> using the API</a>.</p>
</li>
<li>
<p>The backup application finalizes the image transfers.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="incremental-backup-and-restore-api-tasks">16.5.3. Incremental Backup and Restore API Tasks</h4>
<div class="paragraph">
<p>The Incremental Backup and Restore API is documented in the <a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index">oVirt REST API Guide</a>. The backup and restore flow requires the following actions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enabling incremental backup on either a new or existing virtual disk:</p>
<div class="ulist">
<ul>
<li>
<p><a href="#enabling-incremental-backup-on-a-new-disk_assembly_incremental-backup-and-restore">A new disk, using the Administration Portal</a></p>
</li>
<li>
<p><a href="#enabling-incremental-backup-on-an-existing-virtual-disk_assembly_incremental-backup-and-restore">An existing disk, using the Administration Portal</a></p>
</li>
<li>
<p><a href="#enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">A new or existing disk, using an API call</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#find-disks-enabled-for-incremental-backup">Finding disks that are enabled for incremental backup</a></p>
</li>
<li>
<p><a href="#start-a-full-backup_assembly_incremental-backup-and-restore">Starting a full backup</a></p>
</li>
<li>
<p><a href="#start-an-incremental-backup_assembly_incremental-backup-and-restore">Starting an incremental backup</a></p>
</li>
<li>
<p><a href="#finalize-a-backup_assembly_incremental-backup-and-restore">Finalizing a backup</a></p>
</li>
<li>
<p><a href="#getting-information-about-a-backup_assembly_incremental-backup-and-restore">Getting information about a backup</a></p>
</li>
<li>
<p><a href="#getting-information-about-the-disks-in-a-backup_assembly_incremental-backup-and-restore">Getting information about the disks in a backup</a></p>
</li>
<li>
<p><a href="#listing-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing all checkpoints for a virtual machine</a></p>
</li>
<li>
<p><a href="#listing-specific-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing information for a specific virtual machine checkpoint</a></p>
</li>
<li>
<p><a href="#removing-a-checkpoint_assembly_incremental-backup-and-restore">Removing a checkpoint of a specific virtual machine</a></p>
</li>
<li>
<p><a href="#image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">Downloading an image transfer object to archive a backup</a></p>
</li>
<li>
<p><a href="#image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">Uploading an image transfer object to restore a backup</a></p>
</li>
<li>
<p><a href="#ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">Listing changed blocks</a></p>
</li>
<li>
<p><a href="#ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">Downloading and uploading changed blocks</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="enabling-incremental-backup-on-a-new-disk_assembly_incremental-backup-and-restore">Enabling Incremental Backup on a new virtual disk</h5>
<div class="paragraph _abstract">
<p>Enable incremental backup for a virtual disk to mark it as included in an incremental backup. When adding a disk, you can enable incremental backup for every disk, either with the REST API or using the Administration Portal. You can back up existing disks that are not enabled for incremental backup using full backup or in the same way you did previously.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Engine does not require the disk to be enabled for it to be included in an incremental backup, but you can enable it to keep track of which disks are enabled.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because incremental backup requires disks to be formatted in QCOW2, use QCOW2 format instead of RAW format.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add a new virtual disk. For more information see <a href="#Creating_a_Virtual_Disk">Creating a Virtual Disk</a>.</p>
</li>
<li>
<p>When configuring the disk, select the <strong>Enable Incremental Backup</strong> checkbox.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">Enabling incremental backup for a disk using the API</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="enabling-incremental-backup-on-an-existing-virtual-disk_assembly_incremental-backup-and-restore">Enabling Incremental Backup on an existing RAW virtual disk</h5>
<div class="paragraph">
<p>Because incremental backup is not supported for disks in RAW format, a QCOW2 format layer must exist on top of any RAW format disks in order to use incremental backup. Creating a snapshot generates a QCOW2 layer, enabling incremental backup on all disks that are included in the snapshot, from the point at which the snapshot is created.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the base layer of a disk uses RAW format, deleting the last snapshot and merging the top QCOW2 layer into the base layer converts the disk to RAW format, thereby disabling incremental backup if it was set. To re-enable incremental backup, you can create a new snapshot, including this disk.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Select a virtual machine and click the <strong>Disks</strong> tab.</p>
</li>
<li>
<p>Click the <b class="button">Edit</b> button. The <strong>Edit Disk</strong> dialog box opens.</p>
</li>
<li>
<p>Select the <strong>Enable Incremental Backup</strong> checkbox.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">Enabling incremental backup for a disk using the API</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="enable-incremental-backup-for-a-virtual-disk-api-call_assembly_incremental-backup-and-restore">Enabling incremental backup</h5>
<div class="paragraph _abstract">
<p>You can use a REST API request to enable incremental backup for a virtual machines disk.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enable incremental backup for a new disk. For example, for a new disk on a virtual machine with id <code>123</code>, send this request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /ovirt-engine/api/vms/123/diskattachments</pre>
</div>
</div>
<div class="paragraph">
<p>The request body should include <code>backup</code> set to <code>incremental</code> as part of a <code>disk</code> object, like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;disk_attachment&gt;
    &#8230;&#8203;
    &lt;disk&gt;
       &#8230;&#8203;
       &lt;backup&gt;incremental&lt;/backup&gt;
       &#8230;&#8203;
    &lt;/disk&gt;
&lt;/disk_attachment&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The response is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;disk_attachment&gt;
    &#8230;&#8203;
    &lt;disk href="/ovirt-site/previews/2682/ovirt-engine/api/disks/456" id="456"/&gt;
    &#8230;&#8203;
&lt;/disk_attachment&gt;</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk_backup">DiskBackup enum</a> in the <em>REST API Guide</em> for oVirt</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="find-disks-enabled-for-incremental-backup">Finding disks that are enabled for incremental backup</h5>
<div class="paragraph _abstract">
<p>For the specified virtual machine, you can list the disks that are enabled for incremental backup, filtered according to the backup property.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>List the disks that are attached to the virtual machine. For example, for a virtual machine with the id <code>123</code>, send this request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /ovirt-engine/api/vms/123/diskattachments</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes all <code>disk_attachment</code> objects, each of which includes one or more <code>disk</code> objects. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;disk_attachments&gt;
    &lt;disk_attachment&gt;
       &#8230;&#8203;
       &lt;disk href="/ovirt-site/previews/2682/ovirt-engine/api/disks/456" id="456"/&gt;
       &#8230;&#8203;
    &lt;/disk_attachment&gt;
    &#8230;&#8203;
&lt;/disk_attachments&gt;</pre>
</div>
</div>
</li>
<li>
<p>Use the <code>disk</code> service to see the properties of a disk from the previous step. For example, for the disk with the id <code>456</code>, send this request:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /ovirt-engine/api/disks/456</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes all properties for the disk. <code>backup</code> is set to <code>none</code> or <code>incremental</code>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;disk href="/ovirt-site/previews/2682/ovirt-engine/api/disks/456" id="456"&gt;
    &#8230;&#8203;
    &lt;backup&gt;incremental&lt;/backup&gt;
    &#8230;&#8203;
&lt;/disk&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk"><code>backup</code> attribute of <code>Disk</code> struct</a></p>
</li>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#types-disk_backup"><code>DiskBackup</code> enum</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="start-a-full-backup_assembly_incremental-backup-and-restore">Starting a full backup</h5>
<div class="paragraph _abstract">
<p>After a full backup you can use the resulting checkpoint id as the start point in the next incremental backup.</p>
</div>
<div class="paragraph">
<p>When taking a backup of a running virtual machine, the process creates a scratch disk on the same storage domain as the disk being backed up. The backup process creates this disk to enable new data to be written to the running virtual machine during the backup. You can see this scratch disk in the Administration Portal during the backup. It is automatically deleted when the backup finishes.</p>
</div>
<div class="paragraph">
<p>Starting a full backup requires a request call with a body, and includes a response.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Send a request specifying a virtual machine to back up. For example, specify a virtual machine with id <code>123</code> like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /ovirt-engine/api/vms/123/backups</pre>
</div>
</div>
</li>
<li>
<p>In the request body, specify a disk to back up. For example, to start a full backup of a disk with id <code>456</code>, send the following request body:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The response body should look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup id="789"&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
       &#8230;&#8203;
    &lt;/disks&gt;
    &lt;status&gt;initializing&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The backup id</p>
</li>
<li>
<p>The status of the backup, indicating that the backup is initializing.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Poll the backup until the status is <code>ready</code>. The response includes <code>to_checkpoint_id</code>. Note this id and use it for <code>from_checkpoint_id</code> in the next incremental backup.</p>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups"><code>add</code> method of the <code>VmBackups</code> service</a> in the <em>REST API Guide</em> for oVirt</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="start-an-incremental-backup_assembly_incremental-backup-and-restore">Starting an incremental backup</h5>
<div class="paragraph _abstract">
<p>Once a full backup is completed for a given virtual disk, subsequent incremental backups that disk contain only the changes since the last backup. Use the value of <code>to_checkpoint_id</code> from the most recent backup as the value for <code>from_checkpoint_id</code> in the request body.</p>
</div>
<div class="paragraph">
<p>When taking a backup of a running virtual machine, the process creates a scratch disk on the same storage domain as the disk being backed up. The backup process creates this disk to enable new data to be written to the running virtual machine during the backup. You can see this scratch disk in the Administration Portal during the backup. It is automatically deleted when the backup finishes.</p>
</div>
<div class="paragraph">
<p>Starting an incremental backup or mixed backup requires a request call with a body, and includes a response.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Send a request specifying a virtual machine to back up. For example, specify a virtual machine with id <code>123</code> like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /ovirt-engine/api/vms/123/backups</pre>
</div>
</div>
</li>
<li>
<p>In the request body, specify a disk to back up. For example, to start an incremental backup of a disk with id <code>456</code>, send the following request body:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup&gt;
    &lt;from_checkpoint_id&gt;<em>previous-checkpoint-uuid</em>&lt;/from_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the request body, if you include a disk that is not included in the previous checkpoint, the request also runs a full backup of this disk. For example, a disk with id <code>789</code> has not been backed up yet. To add a full backup of <code>789</code> to the above request body, send a request body like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup&gt;
    &lt;from_checkpoint_id&gt;<em>previous-checkpoint-uuid</em>&lt;/from_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       <strong>&lt;disk id="789" /&gt;</strong>
       &#8230;&#8203;
    &lt;/disks&gt;
&lt;/backup&gt;</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The response body should look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup id="101112"&gt;
&lt;from_checkpoint_id&gt;<em>previous-checkpoint-uuid</em>&lt;/from_checkpoint_id&gt;
&lt;to_checkpoint_id&gt;<em>new-checkpoint-uuid</em>&lt;/to_checkpoint_id&gt;
    &lt;disks&gt;
       &lt;disk id="456" /&gt;
       &lt;disk id="789" /&gt;
       &#8230;&#8203;
       &#8230;&#8203;
    &lt;/disks&gt;
    &lt;status&gt;initializing&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The backup id.</p>
</li>
<li>
<p>The id of any disk that was included in the backup.</p>
</li>
<li>
<p>The status, indicating that the backup is initializing.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Poll the backup until the status is <code>ready</code>. The response includes <code>to_checkpoint_id</code>. Note this id and use it for <code>from_checkpoint_id</code> in the next incremental backup.</p>
</li>
</ol>
</div>
<div class="ulist _additonal-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups-methods-add"><code>add</code> method of the VmBackups service</a>  in the <em>REST API Guide</em> for oVirt.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="getting-information-about-a-backup_assembly_incremental-backup-and-restore">Getting information about a backup</h5>
<div class="paragraph _abstract">
<p>You can get information about a backup that you can use to start a new incremental backup.</p>
</div>
<div class="paragraph">
<p>The <code>list</code> method of the VmBackups service returns the following information about a backup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the id of each disk that was backed up</p>
</li>
<li>
<p>the ids of the start and end checkpoints of the backup</p>
</li>
<li>
<p>the id of the disk image of the backup, for each disk included in the backup</p>
</li>
<li>
<p>the status of the backup</p>
</li>
<li>
<p>the date the backup was created</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the value of &lt;status&gt; is <code>ready</code>, the response includes &lt;to_checkpoint_id&gt; which should be used as the &lt;from_checkpoint_id&gt; in the next incremental backup and you can start downloading the disks to back up the virtual machine storage.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To get information about a backup with id 456 of a virtual machine with id 123, send a request like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /ovirt-engine/api/vms/456/backups/123</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes the backup with id 456, with &lt;from_checkpoint_id&gt; 999 and &lt;to_checkpoint_id&gt; 666. The disks included in the backup are referenced in the &lt;link&gt; element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;backup id="456"&gt;
    &lt;from_checkpoint_id&gt;999&lt;/from_checkpoint_id&gt;
    &lt;to_checkpoint_id&gt;666&lt;/to_checkpoint_id&gt;
    &lt;link href="/ovirt-site/previews/2682/ovirt-engine/api/vms/456/backups/123/disks" rel="disks"/&gt;
    &lt;status&gt;ready&lt;/status&gt;
    &lt;creation_date&gt;
&lt;/backup&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backups-methods-list"><code>list</code> method of the VmBackups service</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="getting-information-about-the-disks-in-a-backup_assembly_incremental-backup-and-restore">Getting information about the disks in a backup</h5>
<div class="paragraph _abstract">
<p>You can get information about the disks that are part of the backup, including the backup mode that was used for each disk in a backup, which helps determine the mode that you use to download the backup.</p>
</div>
<div class="paragraph">
<p>The <code>list</code> method of the VmBackupDisks service returns the following information about a backup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The id and name of each disk that was backed up.</p>
</li>
<li>
<p>The id of the disk image of the backup, for each disk included in the backup.</p>
</li>
<li>
<p>The disk format.</p>
</li>
<li>
<p>The backup behavior supported by the disk.</p>
</li>
<li>
<p>The backup type that was taken for the disk (full/incremental).</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To get information about a backup with id 456 of a virtual machine with id 123, send a request like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /ovirt-engine/api/vms/456/backups/123/disks</pre>
</div>
</div>
<div class="paragraph">
<p>The response includes the disk with id 789, and the id of the disk image is 555.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;disks&gt;
    &lt;disk id="789"&gt;
        &lt;name&gt;vm1_Disk1&lt;/name&gt;
        &lt;actual_size&gt;671744&lt;/actual_size&gt;
        &lt;backup&gt;incremental&lt;/backup&gt;
        &lt;backup_mode&gt;full&lt;/backup_mode&gt;
        &lt;format&gt;cow&lt;/format&gt;
        &lt;image_id&gt;555&lt;/image_id&gt;
        &lt;qcow_version&gt;qcow2_v3&lt;/qcow_version&gt;
        &lt;status&gt;locked&lt;/status&gt;
        &lt;storage_type&gt;image&lt;/storage_type&gt;
        &lt;total_size&gt;0&lt;/total_size&gt;
    &lt;/disk&gt;
&lt;/disks&gt;</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backup_disks"><code>list</code> method of the VmBackupDisks service</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="finalize-a-backup_assembly_incremental-backup-and-restore">Finalizing a backup</h5>
<div class="paragraph _abstract">
<p>Finalizing a backup ends the backup, unlocks resources, and performs cleanups. Use the <code>finalize</code> backup service method</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To finalize a backup of a disk with id <code>456</code> on a virtual machine with id <code>123</code>, send a request like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /vms/123/backups/456/finalize</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_backup-methods-finalize">finalize POST</a> in the <em>REST API Guide</em>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="image-transfer-object-for-incremental-backup_assembly_incremental-backup-and-restore">Creating an image transfer object for incremental backup</h5>
<div class="paragraph _abstract">
<p>When the backup is ready to download, the backup application should create an <code>imagetransfer</code> object, which initiates a transfer for an incremental backup.</p>
</div>
<div class="paragraph">
<p>Creating an image transfer object requires a request call with a body.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Send a request like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /ovirt-engine/api/imagetransfers</pre>
</div>
</div>
</li>
<li>
<p>In the request body, specify the following parameters:</p>
<div class="ulist">
<ul>
<li>
<p>disk id</p>
</li>
<li>
<p>backup id</p>
</li>
<li>
<p>direction of the disk set to <code>download</code></p>
</li>
<li>
<p>format of the disk set to <code>raw</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to transfer a backup of a disk where the id of the disk is <code>123</code> and the id of the backup is <code>456</code>, send the following request body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;image_transfer&gt;
    &lt;disk id="123"/&gt;
    &lt;backup id="456"/&gt;
    &lt;direction&gt;download&lt;/direction&gt;
    &lt;format&gt;raw&lt;/format&gt;
&lt;/image_transfer&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers-methods-add"><code>add</code> method for creating an imagetransfer object</a> in the <em>REST API Guide</em> for oVirt.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="image-transfer-object-for-incremental-restore_assembly_incremental-backup-and-restore">Creating an image transfer object for incremental restore</h5>
<div class="paragraph _abstract">
<p>To enable restoring raw data backed up using the incremental backup API to a QCOW2-formatted disk, the backup application should create an <code>imagetransfer</code> object.</p>
</div>
<div class="paragraph">
<p>When the transfer format is <code>raw</code> and the underlying disk format is QCOW2, uploaded data is converted on the fly to QCOW2 format when writing to storage. Uploading data from a QCOW2 disk to a RAW disk is not supported.</p>
</div>
<div class="paragraph">
<p>Creating an image transfer object requires a request call with a body.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Send a request like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">POST /ovirt-engine/api/imagetransfers</pre>
</div>
</div>
</li>
<li>
<p>In the request body, specify the following parameters:</p>
<div class="ulist">
<ul>
<li>
<p>disk id or snapshot id</p>
</li>
<li>
<p>direction of the disk set to <code>upload</code></p>
</li>
<li>
<p>format of the disk set to <code>raw</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to transfer a backup of a disk where the id of the disk is <code>123</code>, send the following request body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;image_transfer&gt;
    &lt;disk id="123"/&gt;
    &lt;direction&gt;upload&lt;/direction&gt;
    &lt;format&gt;raw&lt;/format&gt;
&lt;/image_transfer&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-image_transfers-methods-add"><code>add</code> method for creating an imagetransfer object</a> in the <em>REST API Guide</em> for oVirt.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="listing-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing checkpoints for a virtual machine</h5>
<div class="paragraph _abstract">
<p>You can list all checkpoints for a virtual machine, including information for each checkpoint, by sending a request call.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Send a request specifying a virtual machine. For example, specify a virtual machine with id <code>123</code> like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /vms/123/checkpoints/</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The response includes all the virtual machine checkpoints. Each checkpoint contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The checkpoints disks</p>
</li>
<li>
<p>The id of the parent checkpoint</p>
</li>
<li>
<p>Creation date of the checkpoint</p>
</li>
<li>
<p>The virtual machine to which it belongs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;parent_id&gt;, &lt;creation_date&gt; and the virtual machine it belongs to &lt;vm&gt;:
&lt;checkpoints&gt;
    &lt;checkpoint id="456"&gt;
         &lt;link href="/ovirt-site/previews/2682/ovirt-engine/api/vms/vm-uuid/checkpoints/456/disks" rel="disks"/&gt;
         &lt;parent_id&gt;parent-checkpoint-uuid&lt;/parent_id&gt;
         &lt;creation_date&gt;xxx&lt;/creation_date&gt;
         &lt;vm href="/ovirt-site/previews/2682/ovirt-engine/api/vms/123" id="123"/&gt;
    &lt;/checkpoint&gt;
&lt;/checkpoints&gt;</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoints-methods-list"><code>list</code> method to list virtual machine checkpoints</a> in the <em>REST API Guide</em> for oVirt.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="listing-specific-checkpoints-for-a-virtual-machine_assembly_incremental-backup-and-restore">Listing a specific checkpoint for a virtual machine</h5>
<div class="paragraph _abstract">
<p>You can list information for a specific checkpoint for a virtual machine by sending a request call.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Send a request specifying a virtual machine. For example, specify a virtual machine with id <code>123</code> and checkpoint id <code>456</code> like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">GET /vms/123/checkpoints/456</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The response includes the following information for the checkpoint:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The checkpoints disks</p>
</li>
<li>
<p>The id of the parent checkpoint</p>
</li>
<li>
<p>Creation date of the checkpoint</p>
</li>
<li>
<p>The virtual machine to which it belongs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;checkpoint id="456"&gt;
     &lt;link href="/ovirt-site/previews/2682/ovirt-engine/api/vms/vm-uuid/checkpoints/456/disks" rel="disks"/&gt;
     &lt;parent_id&gt;parent-checkpoint-uuid&lt;/parent_id&gt;
     &lt;creation_date&gt;xxx&lt;/creation_date&gt;
     &lt;vm href="/ovirt-site/previews/2682/ovirt-engine/api/vms/123" id="123"/&gt;
&lt;/checkpoint&gt;</pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoints-methods-list"><code>list</code> method to list virtual machine checkpoints</a> in the <em>REST API Guide</em> for oVirt.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="removing-a-checkpoint_assembly_incremental-backup-and-restore">Removing a checkpoint</h5>
<div class="paragraph _abstract">
<p>You can remove a checkpoint of a virtual machine by sending a DELETE request. You can remove a checkpoint on a virtual machine whether it is running or not.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Send a request specifying a virtual machine and a checkpoint. For example, specify a virtual machine with id <code>123</code> and a checkpoint with id <code>456</code> like this:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">DELETE /vms/123/checkpoints/456/</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.github.io/ovirt-engine-api-model/4.4/index#services-vm_checkpoint-methods-remove"><code>remove</code> method of VmCheckpoint</a></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="ref_using-the-imageio-api-to-transfer-backup-data_assembly_incremental-backup-and-restore">Using the imageio API to transfer backup data</h5>
<div class="paragraph _abstract">
<p>Image transfer APIs start and stop an image transfer. The result is a
transfer URL.</p>
</div>
<div class="paragraph">
<p>You use the imageio API to actually transfer the data from the transfer URL.</p>
</div>
<div class="paragraph">
<p>For complete information on using the imageio API, see the <a href="http://ovirt.github.io/ovirt-imageio/images.html">ovirt-imageio Images API reference</a>.</p>
</div>
<table id="imageio-Image-API-methods-used-in-incremental-backup-and-restore" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. imageio Image API methods used in incremental backup and restore</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API request</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">imageio Image API reference section</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OPTIONS /images/{ticket-id} HTTP/1.1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the server options, to find out what features the server supports.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>OPTIONS</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET /images/{ticket-id}/extents</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets information about disk image content and allocation, or about blocks that changed during an incremental backup. This information is known as <em>extent</em> information.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>EXTENTS</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GET /images/{ticket-id}/extent?context=dirty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The program doing image transfer needs to download changes from the backup. These changes are know as dirty extents. To download changes, send a request like this:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>EXTENTS</em>&#8594; <em>Examples</em>&#8594; <em>Request dirty extents</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PUT /images/{ticket-id}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The backup application creates a new disk or a snapshot with an existing disk to hold the restored data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See <em>PUT</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph _additional-resources">
<div class="title">Additional resources</div>
<p>The oVirt Python SDK includes several implementation examples you can use to get started with transferring backups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://ovirt.github.io/ovirt-imageio/images.html">ovirt-imageio Images API reference</a></p>
</li>
<li>
<p><a href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/upload_disk.py">Creating a disk</a></p>
</li>
<li>
<p><a href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/upload_disk.py#L241">Calling imagetransfer.create_transfer()</a></p>
</li>
<li>
<p><a href="https://github.com/oVirt/ovirt-engine-sdk/blob/4a2284e26225e8bf6e64ed0daf896e7a604f4eed/sdk/examples/helpers/imagetransfer.py#L123">a helper to simplify creating a transfer</a></p>
</li>
<li>
<p><a href="https://github.com/oVirt/ovirt-engine-sdk/tree/master/sdk">oVirt Engine API Python SDK</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Errata_Management_with_Satellite">17. Setting up errata viewing with Red Hat Satellite</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the Administration Portal, you can configure oVirt to view errata from Red Hat Satellite in the oVirt Engine. After you associate your hosts, virtual machines, and the Engine with a Red Hat Satellite provider, you can receive updates about available errata and their importance, and decide when to apply them. For more information about Red Hat Satellite see the <a href="https://access.redhat.com/documentation/en-us/red_hat_satellite/6.7/">Red Hat Satellite Documentation</a>.</p>
</div>
<div class="paragraph">
<p>oVirt 4.4 supports viewing errata with Red Hat Satellite 6.6.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Satellite server must be added as an external provider.</p>
</li>
<li>
<p>The Engine, hosts, and virtual machines must all be registered in the Satellite server by their respective FQDNs. This ensures that external content host IDs do not need to be maintained in oVirt.</p>
</li>
<li>
<p>The Satellite account that manages the Engine, hosts and virtual machines must have Administrator permissions and a default organization set.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Katello agent is deprecated and will be removed in a future Satellite version. Migrate your processes to use the remote execution feature to update clients remotely.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Configuring oVirt errata</div>
<p>To associate the Engine, host, and virtual machine with a Red Hat Satellite provider, complete the following tasks:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Adding_a_Red_Hat_Satellite_Instance_for_Host_Provisioning">Add the required Satellite server to the Engine as an external provider</a>.</p>
</li>
<li>
<p><a href="#Configuring_Satellite_Errata_Management_for_a_Host">Configure the required hosts to display available errata</a>.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_Satellite_Errata">Configure the required virtual machines to display available errata</a>.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Viewing oVirt Engine errata</div>
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Errata</b></span>.</p>
</li>
<li>
<p>Select the <strong>Security</strong>, <strong>Bugs</strong>, or <strong>Enhancements</strong> check boxes to view only those errata types.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="#Configuring_Satellite_Errata_Management_for_a_Host">Setting up Satellite errata viewing for a host</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents, Tools, and Drivers on Linux</a> in the <em>Virtual Machine Management Guide</em> for Enterprise Linux virtual machines.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Windows">Installing the Guest Agents, Tools, and Drivers on Windows</a> in the <em>Virtual Machine Management Guide</em> for Windows virtual machines.</p>
</li>
<li>
<p><a href="#Viewing_Host_Errata">Viewing Host Errata</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Configuring_Satellite_Errata">Configuring Satellite errata viewing for a virtual machine</a> in the <em>Virtual Machine Management Guide</em> for more information.</p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Viewing_Satellite_Errata">Viewing Red Hat Satellite errata for a virtual machine</a> in the <em>Virtual Machine Management Guide</em>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Automating_RHV_Configuration_using_Ansible">18. Automating Configuration Tasks using Ansible</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible is an automation tool used to configure systems, deploy software, and perform rolling updates. oVirt includes a limited version of Ansible to automate oVirt post-installation tasks such as data center setup and configuration, managing users, and virtual machine operations.</p>
</div>
<div class="paragraph">
<p>Ansible provides an easier method of automating oVirt configuration compared to REST APIs and SDKs, and you can integrate with other Ansible modules. For more information about the Ansible modules available for oVirt, see the <a href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">oVirt Ansible Collection</a> in the Red Hat Ansible Automation Hub documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Tower is a graphically enabled framework accessible through a web interface and REST APIs for Ansible. If you want support for Ansible Tower, then you must have an Ansible Tower license, which is not part of the oVirt subscription.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the <a href="http://docs.ansible.com/">Ansible documentation</a> for alternate installation instructions, and information about using Ansible.</p>
</div>
<div class="sect2">
<h3 id="oVirt_Ansible_Collection">18.1. oVirt Ansible Collection</h3>
<div class="paragraph">
<p><strong>oVirt Ansible Collection</strong> provides modules, roles, and plugins for managing various parts of the Red Hat Virtualization infrastructure.
The modules are used for communication between Ansible and the Red Hat Virtualization Manager.
Ansible roles provide a method of modularizing Ansible code by breaking up large playbooks into smaller reusable files that can be shared with other users.
For more information about <strong>oVirt Ansible Collection</strong>, see the <a href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">Automation Hub</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="Installing_ovirt_Ansible_Collection">18.2. Installing oVirt Ansible Collection from an RPM package</h3>
<div class="paragraph">
<p>You can install <strong>oVirt Ansible Collection</strong> for Red Hat Virtualization from the Red Hat Virtualization Manager repository.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>To install oVirt Ansible Collection, you must subscribe to one of the following subscription channels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Using a Red Hat Virtualization subscription - <strong>rhv-4.4-manager-for-rhel-8-x86_64-rpms</strong></p>
</li>
<li>
<p>Using any Red Hat Enterprise Linux subscription - <strong>rhv-4-tools-for-rhel-8-x86_64-rpms</strong></p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following command to install the <strong>oVirt Ansible Collection</strong> on the Manager machine:</p>
<div class="listingblock">
<div class="content">
<pre># dnf install ovirt-ansible-collection</pre>
</div>
</div>
</li>
<li>
<p>By default, the collection is installed to:</p>
<div class="paragraph">
<p><strong>/usr/share/ansible/collections/ansible_collections/redhat/rhv</strong>.</p>
</div>
<div class="paragraph">
<p>The structure of the <code>ovirt-ansible-collection</code> package is as follows:</p>
</div>
<div class="paragraph">
<p><strong>/usr/share/ansible/collections/ansible_collections/redhat/rhv</strong>
<strong>/usr/share/doc/ovirt-ansible-collection/</strong></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Installing_Ansible_Collection_from_Automation_Hub">18.3. Installing oVirt Ansible Collection from Automation Hub</h3>
<div class="paragraph">
<p>Automation Hub is a new place that can be used to install <strong>oVirt Ansible Collection</strong>.
To configure the environment, follow the instructions in <a href="https://cloud.redhat.com/ansible/automation-hub/redhat/rhv/docs">oVirt Ansible Collection documentation</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the collection</p>
<div class="listingblock">
<div class="content">
<pre># ansible-galaxy collection install redhat.rhv</pre>
</div>
</div>
</li>
<li>
<p>The Automation Hub currently does not install RPM dependencies. Make sure that you have these packages on the host where you execute the playbook:</p>
<div class="ulist">
<ul>
<li>
<p><code>python3-ovirt-engine-sdk4</code></p>
</li>
<li>
<p><code>python3-netaddr</code></p>
</li>
<li>
<p><code>python3-jmespath</code></p>
</li>
<li>
<p><code>python3-passlib</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Using_Ansible_Collection">18.4. Using oVirt Ansible Collection to Configure oVirt</h3>
<div class="paragraph">
<p>The following procedure guides you through creating and running a playbook that uses <strong>oVirt Ansible Collection</strong> to configure Red Hat Virtualization. This example uses Ansible to connect to the Manager on the local machine and create a new data center.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that you have the Python SDK installed on the machine running the playbook.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create your playbook.</p>
<div class="listingblock">
<div class="content">
<pre>- name: RHV infrastructure
  hosts: localhost
  connection: local
  gather_facts: false

  vars_files:
   # Contains variables to connect to the Manager
   - engine_vars.yml
   # Contains encrypted engine_password variable using ansible-vault
   - passwords.yml

  pre_tasks:
   # The use of redhat.rhv before ovirt_auth is to check if oVirt Ansible Collection is correctly loaded
   - name: Login to RHV
     redhat.rhv.ovirt_auth:
       hostname: "{{ engine_fqdn }}"
       username: "{{ engine_user }}"
       password: "{{ engine_password }}"
       ca_file: "{{ engine_cafile | default(omit) }}"
       insecure: "{{ engine_insecure | default(true) }}"
     tags:
       - always

 vars:
   data_center_name: mydatacenter
   data_center_description: mydatacenter
   data_center_local: false
   compatibility_version: 4.4

 roles:
   - infra
 collections:
   - redhat.rhv
 post_tasks:
   - name: Logout from RHV
     ovirt_auth:
       state: absent
       ovirt_auth: "{{ ovirt_auth }}"
     tags:
       - always</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have successfully used the <code>infra</code> Ansible role from <strong>oVirt Ansible Collection</strong> to create a data center named <code>mydatacenter</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Users_and_Roles">19. Users and Roles</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Introduction_to_users">19.1. Introduction to Users</h3>
<div class="paragraph">
<p>In oVirt, there are two types of user domains: local domain and external domain. A default local domain called the <strong>internal</strong> domain and a default user <strong>admin</strong> is created during the the Engine installation process.</p>
</div>
<div class="paragraph">
<p>You can create additional users on the <strong>internal</strong> domain using <code>ovirt-aaa-jdbc-tool</code>. User accounts created on local domains are known as local users. You can also attach external directory servers such as Red Hat Directory Server, Active Directory, OpenLDAP, and many other supported options to your oVirt environment and use them as external domains. User accounts created on external domains are known as directory users.</p>
</div>
<div class="paragraph">
<p>Both local users and directory users need to be assigned with appropriate roles and permissions through the Administration Portal before they can function in the environment. There are two main types of user roles: end user and administrator. An end user role uses and manages virtual resources from the VM Portal. An administrator role maintains the system infrastructure using the Administration Portal. The roles can be assigned to the users for individual resources like virtual machines and hosts, or on a hierarchy of objects like clusters and data centers.</p>
</div>
</div>
<div class="sect2">
<h3 id="Introduction_to_Directory_Servers">19.2. Introduction to Directory Servers</h3>
<div class="paragraph">
<p>During installation, oVirt Engine creates an <strong>admin</strong> user on the <strong>internal</strong> domain. The user is also referred to as <code>admin@internal</code>. This account is intended for use when initially configuring the environment and for troubleshooting. After you have attached an external directory server, added the directory users, and assigned them with appropriate roles and permissions, the <code>admin@internal</code> user can be disabled if it is not required.The directory servers supported are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>389ds</p>
</li>
<li>
<p>389ds RFC-2307 Schema</p>
</li>
<li>
<p>Active Directory</p>
</li>
<li>
<p>IBM Security Directory Server</p>
</li>
<li>
<p>IBM Security Directory Server RFC-2307 Schema</p>
</li>
<li>
<p>FreeIPA</p>
</li>
<li>
<p>iDM</p>
</li>
<li>
<p>Novell eDirectory RFC-2307 Schema</p>
</li>
<li>
<p>OpenLDAP RFC-2307 Schema</p>
</li>
<li>
<p>OpenLDAP Standard Schema</p>
</li>
<li>
<p>Oracle Unified Directory RFC-2307 Schema</p>
</li>
<li>
<p>RFC-2307 Schema (Generic)</p>
</li>
<li>
<p>Red Hat Directory Server (RHDS)</p>
</li>
<li>
<p>Red Hat Directory Server (RHDS) RFC-2307 Schema</p>
</li>
<li>
<p>iPlanet</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is not possible to install oVirt Engine (<code>rhevm</code>) and IdM (<code>ipa-server</code>) on the same system. IdM is incompatible with the <code>mod_ssl</code> package, which is required by oVirt Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are using Active Directory as your directory server, and you want to use <strong>sysprep</strong> in the creation of templates and virtual machines, then the oVirt administrative user must be delegated control over the Domain to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Join a computer to the domain</strong></p>
</li>
<li>
<p><strong>Modify the membership of a group</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information on creation of user accounts in Active Directory, see <a href="http://technet.microsoft.com/en-us/library/cc732336.aspx" class="bare">http://technet.microsoft.com/en-us/library/cc732336.aspx</a>.</p>
</div>
<div class="paragraph">
<p>For information on delegation of control in Active Directory, see <a href="http://technet.microsoft.com/en-us/library/cc732524.aspx" class="bare">http://technet.microsoft.com/en-us/library/cc732524.aspx</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sect-Configuring_an_External_LDAP_Provider">19.3. Configuring an External LDAP Provider</h3>
<div class="sect3">
<h4 id="Configuring_an_External_LDAP_Provider">19.3.1. Configuring an External LDAP Provider (Interactive Setup)</h4>
<div class="paragraph">
<p>The <strong>ovirt-engine-extension-aaa-ldap</strong> extension allows users to customize their external directory setup easily. The <strong>ovirt-engine-extension-aaa-ldap</strong> extension supports many different LDAP server types, and an interactive setup script is provided to assist you with the setup for most LDAP types.</p>
</div>
<div class="paragraph">
<p>If the LDAP server type is not listed in the interactive setup script, or you want to do more customization, you can manually edit the configuration files. See <a href="#Configuring_an_External_LDAP_Provider_ManualMethod">Configuring an External LDAP Provider (Manual Method)</a> for more information.</p>
</div>
<div class="paragraph">
<p>For an Active Directory example, see <a href="#Attaching_an_Active_Directory">Attaching an Active Directory</a>.</p>
</div>
<div class="paragraph">
<p><strong>Prerequisites:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must know the domain name of the DNS or the LDAP server.</p>
</li>
<li>
<p>To set up secure connection between the LDAP server and the Engine, ensure that a PEM-encoded CA certificate has been prepared.</p>
</li>
<li>
<p>Have at least one set of account name and password ready to perform search and login queries to the LDAP server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring an External LDAP Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the oVirt Engine, install the LDAP extension package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-extension-aaa-ldap-setup</pre>
</div>
</div>
</li>
<li>
<p>Run <code>ovirt-engine-extension-aaa-ldap-setup</code> to start the interactive setup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-engine-extension-aaa-ldap-setup</pre>
</div>
</div>
</li>
<li>
<p>Select an LDAP type by entering the corresponding number. If you are not sure which schema your LDAP server is, select the standard schema of your LDAP server type. For Active Directory, follow the procedure at <a href="#Attaching_an_Active_Directory">Attaching an Active Directory</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Available LDAP implementations:
 1 - 389ds
 2 - 389ds RFC-2307 Schema
 3 - Active Directory
 4 - IBM Security Directory Server
 5 - IBM Security Directory Server RFC-2307 Schema
 6 - IPA
 7 - Novell eDirectory RFC-2307 Schema
 8 - OpenLDAP RFC-2307 Schema
 9 - OpenLDAP Standard Schema
10 - Oracle Unified Directory RFC-2307 Schema
11 - RFC-2307 Schema (Generic)
12 - RHDS
13 - RHDS RFC-2307 Schema
14 - iPlanet
Please select:</pre>
</div>
</div>
</li>
<li>
<p>Press <code>Enter</code> to accept the default and configure domain name resolution for your LDAP server name:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">It is highly recommended to use DNS resolution for LDAP server.
If for some reason you intend to use hosts or plain address disable DNS usage.
Use DNS (Yes, No) [Yes]:</pre>
</div>
</div>
</li>
<li>
<p>Select a DNS policy method:</p>
<div class="ulist">
<ul>
<li>
<p>For option 1, the DNS servers listed in <strong>/etc/resolv.conf</strong> are used to resolve the IP address. Check that the <strong>/etc/resolv.conf</strong> file is updated with the correct DNS servers.</p>
</li>
<li>
<p>For option 2, enter the fully qualified domain name (FQDN) or the IP address of the LDAP server. You can use the <code>dig</code> command with the SRV record to find out the domain name. An SRV record takes the following format:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>_service._protocol</em>.<em>domain_name</em></pre>
</div>
</div>
<div class="paragraph">
<p>Example: <code>dig _ldap._tcp.redhat.com SRV</code>.</p>
</div>
</li>
<li>
<p>For option 3, enter a space-separated list of LDAP servers. Use either the FQDN or IP address of the servers. This policy provides load-balancing between the LDAP servers. Queries are distributed among all LDAP servers according to the round-robin algorithm.</p>
</li>
<li>
<p>For option 4, enter a space-separated list of LDAP servers. Use either the FQDN or IP address of the servers. This policy defines the first LDAP server to be the default LDAP server to respond to queries. If the first server is not available, the query will go to the next LDAP server on the list.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">1 - Single server
2 - DNS domain LDAP SRV record
3 - Round-robin between multiple hosts
4 - Failover between multiple hosts
Please select:</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Select the secure connection method your LDAP server supports and specify the method to obtain a PEM-encoded CA certificate:</p>
<div class="ulist">
<ul>
<li>
<p><code>File</code> allows you to provide the full path to the certificate.</p>
</li>
<li>
<p><code>URL</code> allows you to specify a URL for the certificate.</p>
</li>
<li>
<p><code>Inline</code> allows you to paste the content of the certificate in the terminal.</p>
</li>
<li>
<p><code>System</code> allows you to specify the default location for all CA files.</p>
</li>
<li>
<p><code>Insecure</code> skips certificate validation, but the connection is still encrypted using TLS.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NOTE:
It is highly recommended to use secure protocol to access the LDAP server.
Protocol startTLS is the standard recommended method to do so.
Only in cases in which the startTLS is not supported, fallback to non standard ldaps protocol.
Use plain for test environments only.
Please select protocol to use (startTLS, ldaps, plain) [startTLS]: <em>startTLS</em>
Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure):
Please enter the password:</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LDAPS stands for Lightweight Directory Access Protocol Over Secure Socket Links. For SSL connections, select the <code>ldaps</code> option.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Enter the search user distinguished name (DN). The user must have permissions to browse all users and groups on the directory server. The search user must be specified in LDAP annotation. If anonymous search is allowed, press <code>Enter</code> without any input.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Enter search user DN (for example uid=username,dc=example,dc=com or leave empty for anonymous): <code>uid=user1,ou=Users,ou=department-1,dc=example,dc=com</code>
Enter search user password:</pre>
</div>
</div>
</li>
<li>
<p>Enter the base DN:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please enter base DN (dc=redhat,dc=com) [dc=redhat,dc=com]: <em>ou=department-1,dc=redhat,dc=com</em></pre>
</div>
</div>
</li>
<li>
<p>Select <code>Yes</code> if you intend to configure single sign-on for virtual machines. Note that the feature cannot be used with single sign-on to the Administration Portal feature. The script reminds you that the profile name must match the domain name. You will still need to follow the instructions in <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Configuring_Single_Sign-On_for_Virtual_Machines">Configuring Single Sign-On for Virtual Machines</a> in the <em>Virtual Machine Management Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Are you going to use Single Sign-On for Virtual Machines (Yes, No) [Yes]:</pre>
</div>
</div>
</li>
<li>
<p>Specify a profile name. The profile name is visible to users on the login page. This example uses <code>redhat.com</code>.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To rename the profile after the domain has been configured, edit the <code>ovirt.engine.aaa.authn.profile.name</code> attribute in the <strong>/etc/ovirt-engine/extensions.d/<em>redhat.com</em>-authn.properties</strong> file. Restart the <code>ovirt-engine</code> service for the changes to take effect.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please specify profile name that will be visible to users: <em>redhat.com</em></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/AAA_login_profile.png" alt="AAA login profile">
</div>
<div class="title">Figure 14. The Administration Portal Login Page</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Users must select the profile from the drop-down list when logging in for the first time. The information is stored in browser cookies and preselected the next time the user logs in.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Test the login function to ensure your LDAP server is connected to your oVirt environment properly. For the login query, enter your <code>user name</code> and <code>password</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NOTE:
It is highly recommended to test drive the configuration before applying it into engine.
Login sequence is executed automatically, but it is recommended to also execute Search sequence manually after successful Login sequence.

Please provide credentials to test login flow:
Enter user name:
Enter user password:
[ INFO  ] Executing login sequence...
...
[ INFO  ] Login sequence executed successfully</pre>
</div>
</div>
</li>
<li>
<p>Check that the user details are correct. If the user details are incorrect, select <code>Abort</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please make sure that user details are correct and group membership meets expectations (search for PrincipalRecord and GroupRecord titles).
Abort if output is incorrect.
Select test sequence to execute (Done, Abort, Login, Search) [Abort]:</pre>
</div>
</div>
</li>
<li>
<p>Manually testing the Search function is recommended. For the search query, select <code>Principal</code> for user accounts or <code>Group</code> for group accounts. Select <code>Yes</code> to <code>Resolve Groups</code> if you want the group account information for the user account to be returned. Three configuration files are created and displayed in the screen output.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Select test sequence to execute (Done, Abort, Login, Search) [Search]: <em>Search</em>
Select entity to search (Principal, Group) [Principal]:
Term to search, trailing '*' is allowed: <em>testuser1</em>
Resolve Groups (Yes, No) [No]:</pre>
</div>
</div>
</li>
<li>
<p>Select <code>Done</code> to complete the setup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Select test sequence to execute (Done, Abort, Login, Search) [Abort]: <em>Done</em>
[ INFO  ] Stage: Transaction setup
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Package installation
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Transaction commit
[ INFO  ] Stage: Closing up
CONFIGURATION SUMMARY
Profile name is: redhat.com
The following files were created:
    /etc/ovirt-engine/aaa/redhat.com.properties
    /etc/ovirt-engine/extensions.d/redhat.com.properties
    /etc/ovirt-engine/extensions.d/redhat.com-authn.properties
[ INFO  ] Stage: Clean up
Log file is available at /tmp/ovirt-engine-extension-aaa-ldap-setup-20171004101225-mmneib.log:
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service. The profile you have created is now available on the Administration Portal and the VM Portal login pages. To assign the user accounts on the LDAP server appropriate roles and permissions, for example, to log in to the VM Portal, see <a href="#sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">Administering User Tasks From the Administration Portal</a>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information, see the LDAP authentication and authorization extension README file at <strong>/usr/share/doc/ovirt-engine-extension-aaa-ldap-<em>version</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Attaching_an_Active_Directory">19.3.2. Attaching an Active Directory</h4>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You need to know the Active Directory forest name. The forest name is also known as the root domain name.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Examples of the most common Active Directory configurations, which cannot be configured using the ovirt-engine-extension-aaa-ldap-setup tool, are provided in <code class="filename">/usr/share/ovirt-engine-extension-aaa-ldap/examples/README.md</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You need to either add the DNS server that can resolve the Active Directory forest name to the <strong>/etc/resolv.conf</strong> file on the Engine, or note down the Active Directory DNS servers and enter them when prompted by the interactive setup script.</p>
</li>
<li>
<p>To set up secure connection between the LDAP server and the Engine, ensure a PEM-encoded CA certificate has been prepared. See <a href="#Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</a> for more information.</p>
</li>
<li>
<p>Unless anonymous search is supported, a user with permissions to browse all users and groups must be available on the Active Directory to be used as the search user. Note down the search user&#8217;s distinguished name (DN). Do not use the administrative user for the Active Directory.</p>
</li>
<li>
<p>You must have at least one account name and password ready to perform search and login queries to the Active Directory.</p>
</li>
<li>
<p>If your Active Directory deployment spans multiple domains, be aware of the limitation described in the <code>/usr/share/ovirt-engine-extension-aaa-ldap/profiles/ad.properties</code> file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring an External LDAP Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the oVirt Engine, install the LDAP extension package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-extension-aaa-ldap-setup</pre>
</div>
</div>
</li>
<li>
<p>Run <code>ovirt-engine-extension-aaa-ldap-setup</code> to start the interactive setup:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-engine-extension-aaa-ldap-setup</pre>
</div>
</div>
</li>
<li>
<p>Select an LDAP type by entering the corresponding number. The LDAP-related questions after this step are different for different LDAP types.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Available LDAP implementations:
 1 - 389ds
 2 - 389ds RFC-2307 Schema
 3 - Active Directory
 4 - IBM Security Directory Server
 5 - IBM Security Directory Server RFC-2307 Schema
 6 - IPA
 7 - Novell eDirectory RFC-2307 Schema
 8 - OpenLDAP RFC-2307 Schema
 9 - OpenLDAP Standard Schema
10 - Oracle Unified Directory RFC-2307 Schema
11 - RFC-2307 Schema (Generic)
12 - RHDS
13 - RHDS RFC-2307 Schema
14 - iPlanet
Please select: 3</pre>
</div>
</div>
</li>
<li>
<p>Enter the Active Directory forest name. If the forest name is not resolvable by your Engine&#8217;s DNS, the script prompts you to enter a space-separated list of Active Directory DNS server names.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please enter Active Directory Forest name: <em>ad-example.redhat.com</em>
[ INFO  ] Resolving Global Catalog SRV record for <em>ad-example.redhat.com</em>
[ INFO  ] Resolving LDAP SRV record for <em>ad-example.redhat.com</em></pre>
</div>
</div>
</li>
<li>
<p>Select the secure connection method your LDAP server supports and specify the method to obtain a PEM-encoded CA certificate. The file option allows you to provide the full path to the certificate. The URL option allows you to specify a URL to the certificate. Use the inline option to paste the content of the certificate in the terminal. The system option allows you to specify the location for all CA files. The insecure option allows you to use startTLS in insecure mode.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NOTE:
It is highly recommended to use secure protocol to access the LDAP server.
Protocol startTLS is the standard recommended method to do so.
Only in cases in which the startTLS is not supported, fallback to non standard ldaps protocol.
Use plain for test environments only.
Please select protocol to use (startTLS, ldaps, plain) [startTLS]: <em>startTLS</em>
Please select method to obtain PEM encoded CA certificate (File, URL, Inline, System, Insecure): <em>File</em>
Please enter the password:</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>LDAPS stands for Lightweight Directory Access Protocol Over Secure Socket Links. For SSL connections, select the <code>ldaps</code> option.</p>
</div>
<div class="paragraph">
<p>For more information on creating a PEM-encoded CA certificate, see <a href="#Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enter the search user distinguished name (DN). The user must have permissions to browse all users and groups on the directory server. The search user must be of LDAP annotation. If anonymous search is allowed, press <code>Enter</code> without any input.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Enter search user DN (empty for anonymous): <em>cn=user1,ou=Users,dc=test,dc=redhat,dc=com</em>
Enter search user password:</pre>
</div>
</div>
</li>
<li>
<p>Specify whether to use single sign-on for virtual machines. This feature is enabled by default, but cannot be used if single sign-on to the Administration Portal is enabled. The script reminds you that the profile name must match the domain name. You will still need to follow the instructions in <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Configuring_Single_Sign-On_for_Virtual_Machines">Configuring Single Sign-On for Virtual Machines</a> in the <em>Virtual Machine Management Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Are you going to use Single Sign-On for Virtual Machines (Yes, No) [Yes]:</pre>
</div>
</div>
</li>
<li>
<p>Specify a profile name. The profile name is visible to users on the login page. This example uses <code>redhat.com</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Please specify profile name that will be visible to users:<em>redhat.com</em></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/AAA_login_profile.png" alt="AAA login profile">
</div>
<div class="title">Figure 15. The Administration Portal Login Page</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Users need to select the desired profile from the drop-down list when logging in for the first time. The information is then stored in browser cookies and preselected the next time the user logs in.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Test the search and login function to ensure your LDAP server is connected to your oVirt environment properly. For the login query, enter the account name and password. For the search query, select <code>Principal</code> for user accounts, and select <code>Group</code> for group accounts. Enter <code>Yes</code> to <code>Resolve Groups</code> if you want the group account information for the user account to be returned. Select <code>Done</code> to complete the setup. Three configuration files are created and displayed in the screen output.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">NOTE:
It is highly recommended to test drive the configuration before applying it into engine.
Login sequence is executed automatically, but it is recommended to also execute Search sequence manually after successful Login sequence.
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Login
Enter search user name: <em>testuser1</em>
Enter search user password:
[ INFO  ] Executing login sequence...
...
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Search
Select entity to search (Principal, Group) [Principal]:
Term to search, trailing '*' is allowed: <em>testuser1</em>
Resolve Groups (Yes, No) [No]:
[ INFO  ] Executing login sequence...
...
Select test sequence to execute (Done, Abort, Login, Search) [Abort]: Done
[ INFO  ] Stage: Transaction setup
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Package installation
[ INFO  ] Stage: Misc configuration
[ INFO  ] Stage: Transaction commit
[ INFO  ] Stage: Closing up
          CONFIGURATION SUMMARY
          Profile name is: <em>redhat.com</em>
          The following files were created:
              /etc/ovirt-engine/aaa/<em>redhat.com</em>.properties
              /etc/ovirt-engine/extensions.d/<em>redhat.com</em>-authz.properties
              /etc/ovirt-engine/extensions.d/<em>redhat.com</em>-authn.properties
[ INFO  ] Stage: Clean up
          Log file is available at /tmp/ovirt-engine-extension-aaa-ldap-setup-20160114064955-1yar9i.log:
[ INFO  ] Stage: Pre-termination
[ INFO  ] Stage: Termination</pre>
</div>
</div>
</li>
<li>
<p>The profile you have created is now available on the Administration Portal and the VM Portal login pages. To assign the user accounts on the LDAP server appropriate roles and permissions, for example, to log in to the VM Portal, see <a href="#sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">Administering User Tasks From the Administration Portal</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information, see the LDAP authentication and authorization extension README file at <strong>/usr/share/doc/ovirt-engine-extension-aaa-ldap-<em>version</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Configuring_an_External_LDAP_Provider_ManualMethod">19.3.3. Configuring an External LDAP Provider (Manual Method)</h4>
<div class="paragraph">
<p>The <code>ovirt-engine-extension-aaa-ldap</code> extension uses the LDAP protocol to access directory servers and is fully customizable. Kerberos authentication is not required unless you want to enable the single sign-on to the VM Portal or the Administration Portal feature.</p>
</div>
<div class="paragraph">
<p>If the interactive setup method in the previous section does not cover your use case, you can manually modify the configuration files to attach your LDAP server. The following procedure uses generic details. Specific values depend on your setup.</p>
</div>
<div class="paragraph">
<p><strong>Configuring an External LDAP Provider Manually</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the oVirt Engine, install the LDAP extension package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-extension-aaa-ldap</pre>
</div>
</div>
</li>
<li>
<p>Copy the LDAP configuration template file into the <strong>/etc/ovirt-engine</strong> directory. Template files are available for active directories (<strong>ad</strong>) and other directory types (<strong>simple</strong>). This example uses the simple configuration template.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -r /usr/share/ovirt-engine-extension-aaa-ldap/examples/simple/. /etc/ovirt-engine</pre>
</div>
</div>
</li>
<li>
<p>Rename the configuration files to match the profile name you want visible to users on the Administration Portal and the VM Portal login pages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/aaa/profile1.properties /etc/ovirt-engine/aaa/<em>example</em>.properties
# mv /etc/ovirt-engine/extensions.d/profile1-authn.properties /etc/ovirt-engine/extensions.d/<em>example</em>-authn.properties
# mv /etc/ovirt-engine/extensions.d/profile1-authz.properties /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
</li>
<li>
<p>Edit the LDAP property configuration file by uncommenting an LDAP server type and updating the domain and passwords fields:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 14. Example profile: LDAP server section</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Select one
#
include = &lt;openldap.properties&gt;
#include = &lt;389ds.properties&gt;
#include = &lt;rhds.properties&gt;
#include = &lt;ipa.properties&gt;
#include = &lt;iplanet.properties&gt;
#include = &lt;rfc2307-389ds.properties&gt;
#include = &lt;rfc2307-rhds.properties&gt;
#include = &lt;rfc2307-openldap.properties&gt;
#include = &lt;rfc2307-edir.properties&gt;
#include = &lt;rfc2307-generic.properties&gt;

# Server
#
vars.server = <em>ldap1.company.com</em>

# Search user and its password.
#
vars.user = uid=search,cn=users,cn=accounts,dc=<em>company</em>,dc=<em>com</em>
vars.password = <em>123456</em>

pool.default.serverset.single.server = ${global:vars.server}
pool.default.auth.simple.bindDN = ${global:vars.user}
pool.default.auth.simple.password = ${global:vars.password}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use TLS or SSL protocol to interact with the LDAP server, obtain the root CA certificate for the LDAP server and use it to create a public keystore file. Uncomment the following lines and specify the full path to the public keystore file and the password to access the file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on creating a public keystore file, see <a href="#Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 15. Example profile: keystore section</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Create keystore, import certificate chain and uncomment
# if using tls.
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = <em>/full/path/to/myrootca.jks</em>
pool.default.ssl.truststore.password = <em>password</em></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the authentication configuration file. The profile name visible to users on the Administration Portal and the VM Portal login pages is defined by <strong>ovirt.engine.aaa.authn.profile.name</strong>. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/extensions.d/<em>example</em>-authn.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 16. Example authentication configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = <em>example</em>-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = <em>example</em>
ovirt.engine.aaa.authn.authz.plugin = <em>example</em>-authz
config.profile.file.1 = ../aaa/<em>example</em>.properties</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the authorization configuration file. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 17. Example authorization configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = <em>example</em>-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.profile.file.1 = ../aaa/<em>example</em>.properties</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Ensure that the ownership and permissions of the configuration profile are appropriate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown ovirt:ovirt /etc/ovirt-engine/aaa/<em>example</em>.properties
# chmod 600 /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
</li>
<li>
<p>Restart the engine service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>The <em>example</em> profile you have created is now available on the Administration Portal and the VM Portal login pages. To give the user accounts on the LDAP server appropriate permissions, for example, to log in to the VM Portal, see <a href="#sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">Administering User Tasks From the Administration Portal</a>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information, see the LDAP authentication and authorization extension README file at <strong>/usr/share/doc/ovirt-engine-extension-aaa-ldap-<em>version</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="removing-an-external-ldap-provider">19.3.4. Removing an External LDAP Provider</h4>
<div class="paragraph">
<p>This procedure shows you how to remove an external configured LDAP provider and its users.</p>
</div>
<div class="paragraph">
<p><strong>Removing an External LDAP Provider</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Remove the LDAP provider configuration files, replacing the default name <em>profile1</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/ovirt-engine/extensions.d/<em>profile1</em>-authn.properties
# rm /etc/ovirt-engine/extensions.d/<em>profile1</em>-authz.properties
# rm /etc/ovirt-engine/aaa/<em>profile1</em>.properties</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine</pre>
</div>
</div>
</li>
<li>
<p>In the Administration Portal, in the <strong>Users</strong> resource tab, select the users of this provider (those whose <code>Authorization provider</code> is <em>profile1</em>-authz) and click <strong>Remove</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_LDAP_and_Kerberos_for_Single_Sign-on">19.4. Configuring LDAP and Kerberos for Single Sign-on</h3>
<div class="paragraph">
<p>Single sign-on allows users to log in to the VM Portal or the Administration Portal without re-typing their passwords. Authentication credentials are obtained from the Kerberos server. To configure single sign-on to the Administration Portal and the VM Portal, you need to configure two extensions: <strong>ovirt-engine-extension-aaa-misc</strong> and <strong>ovirt-engine-extension-aaa-ldap</strong>; and two Apache modules: <strong>mod_auth_gssapi</strong> and <strong>mod_session</strong>. You can configure single sign-on that does not involve Kerberos, however this is outside the scope of this documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If single sign-on to the VM Portal is enabled, single sign-on to virtual machines is not possible. With single sign-on to the VM Portal enabled, the VM Portal does not need to accept a password, so you cannot delegate the password to sign in to virtual machines.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example assumes the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The existing Key Distribution Center (KDC) server uses the MIT version of Kerberos 5.</p>
</li>
<li>
<p>You have administrative rights to the KDC server.</p>
</li>
<li>
<p>The Kerberos client is installed on the oVirt Engine and user machines.</p>
</li>
<li>
<p>The <code>kadmin</code> utility is used to create Kerberos service principals and <strong>keytab</strong> files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This procedure involves the following components:</p>
</div>
<div class="paragraph">
<p><strong>On the KDC server</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a service principal and a <strong>keytab</strong> file for the Apache service on the oVirt Engine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>On the oVirt Engine</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install the authentication and authorization extension packages and the Apache Kerberos authentication module.</p>
</li>
<li>
<p>Configure the extension files.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Configuring Kerberos for the Apache Service</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the KDC server, use the <code>kadmin</code> utility to create a service principal for the Apache service on the oVirt Engine. The service principal is a reference ID to the KDC for the Apache service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kadmin
kadmin&gt; addprinc -randkey <em>HTTP/fqdn-of-rhevm</em>@<em>REALM.COM</em></pre>
</div>
</div>
</li>
<li>
<p>Generate a <strong>keytab</strong> file for the Apache service. The <strong>keytab</strong> file stores the shared secret key.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-backup</code> command includes the file <code class="filename">/etc/httpd/http.keytab</code> when backing up and  restoring. If you use a different name for the <strong>keytab</strong> file, make sure you back up and restore it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">kadmin&gt; ktadd -k /tmp/http.keytab <em>HTTP/fqdn-of-rhevm</em>@<em>REALM.COM</em>
kadmin&gt; quit</pre>
</div>
</div>
</li>
<li>
<p>Copy the <strong>keytab</strong> file from the KDC server to the oVirt Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /tmp/http.keytab root@<em>rhevm.example.com</em>:/etc/httpd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Configuring Single Sign-on to the VM Portal or Administration Portal</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the oVirt Engine, ensure that the ownership and permissions for the keytab are appropriate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown apache /etc/httpd/http.keytab
# chmod 400 /etc/httpd/http.keytab</pre>
</div>
</div>
</li>
<li>
<p>Install the authentication extension package, LDAP extension package, and the <code>mod_auth_gssapi</code> and  <code>mod_session</code> Apache modules:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-extension-aaa-misc ovirt-engine-extension-aaa-ldap mod_auth_gssapi mod_session</pre>
</div>
</div>
</li>
<li>
<p>Copy the SSO configuration template file into the <strong>/etc/ovirt-engine</strong> directory. Template files are available for Active Directory (<strong>ad-sso</strong>) and other directory types (<strong>simple-sso</strong>). This example uses the simple SSO configuration template.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -r /usr/share/ovirt-engine-extension-aaa-ldap/examples/simple-sso/. /etc/ovirt-engine</pre>
</div>
</div>
</li>
<li>
<p>Move <strong>ovirt-sso.conf</strong> into the Apache configuration directory.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-backup</code> command includes the file <code class="filename">/etc/httpd/conf.d/ovirt-sso.conf</code> when backing up and  restoring. If you use a different name for this file, make sure you back up and restore it.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/aaa/ovirt-sso.conf /etc/httpd/conf.d</pre>
</div>
</div>
</li>
<li>
<p>Review the authentication method file. You do not need to edit this file, as the realm is automatically fetched from the <strong>keytab</strong> file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/httpd/conf.d/ovirt-sso.conf</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 18. Example authentication method file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;LocationMatch ^/ovirt-engine/sso/(interactive-login-negotiate|oauth/token-http-auth)|^/ovirt-engine/api&gt;
  &lt;If "req('Authorization') !~ /^(Bearer|Basic)/i"&gt;
    RewriteEngine on
    RewriteCond %{LA-U:REMOTE_USER} ^(.*)$
    RewriteRule ^(.*)$ - [L,NS,P,E=REMOTE_USER:%1]
    RequestHeader set X-Remote-User %{REMOTE_USER}s

    AuthType GSSAPI
    AuthName "Kerberos Login"

    # Modify to match installation
    GssapiCredStore keytab:/etc/httpd/http.keytab
    GssapiUseSessions On
    Session On
    SessionCookieName ovirt_gssapi_session path=/private;httponly;secure;

    Require valid-user
    ErrorDocument 401 "&lt;html&gt;&lt;meta http-equiv=\"refresh\" content=\"0; url=/ovirt-engine/sso/login-unauthorized\"/&gt;&lt;body&gt;&lt;a href=\"/ovirt-engine/sso/login-unauthorized\"&gt;Here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
  &lt;/If&gt;
&lt;/LocationMatch&gt;</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Rename the configuration files to match the profile name you want visible to users on the Administration Portal and the VM Portal login pages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/aaa/profile1.properties /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/extensions.d/profile1-http-authn.properties /etc/ovirt-engine/extensions.d/<em>example</em>-http-authn.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/extensions.d/profile1-http-mapping.properties /etc/ovirt-engine/extensions.d/<em>example</em>-http-mapping.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/ovirt-engine/extensions.d/profile1-authz.properties /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
</li>
<li>
<p>Edit the LDAP property configuration file by uncommenting an LDAP server type and updating the domain and passwords fields:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 19. Example profile: LDAP server section</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Select one
include = &lt;openldap.properties&gt;
#include = &lt;389ds.properties&gt;
#include = &lt;rhds.properties&gt;
#include = &lt;ipa.properties&gt;
#include = &lt;iplanet.properties&gt;
#include = &lt;rfc2307-389ds.properties&gt;
#include = &lt;rfc2307-rhds.properties&gt;
#include = &lt;rfc2307-openldap.properties&gt;
#include = &lt;rfc2307-edir.properties&gt;
#include = &lt;rfc2307-generic.properties&gt;

# Server
#
vars.server = <em>ldap1.company.com</em>

# Search user and its password.
#
vars.user = uid=search,cn=users,cn=accounts,dc=company,dc=com
vars.password = <em>123456</em>

pool.default.serverset.single.server = ${global:vars.server}
pool.default.auth.simple.bindDN = ${global:vars.user}
pool.default.auth.simple.password = ${global:vars.password}</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use TLS or SSL protocol to interact with the LDAP server, obtain the root CA certificate for the LDAP server and use it to create a public keystore file. Uncomment the following lines and specify the full path to the public keystore file and the password to access the file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on creating a public keystore file, see <a href="#Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 20. Example profile: keystore section</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Create keystore, import certificate chain and uncomment
# if using ssl/tls.
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = <em>/full/path/to/myrootca.jks</em>
pool.default.ssl.truststore.password = <em>password</em></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the authentication configuration file. The profile name visible to users on the Administration Portal and the VM Portal login pages is defined by <strong>ovirt.engine.aaa.authn.profile.name</strong>. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/extensions.d/<em>example</em>-http-authn.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 21. Example authentication configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = <em>example</em>-http-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = <em>example</em>-http
ovirt.engine.aaa.authn.authz.plugin = <em>example</em>-authz
ovirt.engine.aaa.authn.mapping.plugin = <em>example</em>-http-mapping
config.artifact.name = HEADER
config.artifact.arg = X-Remote-User</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the authorization configuration file. The configuration profile location must match the LDAP configuration file location. All fields can be left as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  vi /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 22. Example authorization configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = <em>example</em>-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.ldap
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.ldap.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.profile.file.1 = ../aaa/<em>example</em>.properties</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Review the authentication mapping configuration file. The configuration profile location must match the LDAP configuration file location. The configuration profile extension name must match the <code>ovirt.engine.aaa.authn.mapping.plugin</code> value in the authentication configuration file. All fields can be left as default.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/extensions.d/<em>example</em>-http-mapping.properties</pre>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 23. Example authentication mapping configuration file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = <em>example</em>-http-mapping
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.mapping.MappingExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Mapping
config.mapAuthRecord.type = regex
config.mapAuthRecord.regex.mustMatch = true
config.mapAuthRecord.regex.pattern = ^(?&lt;user&gt;.*?)((\\\\(?&lt;at&gt;@)(?&lt;suffix&gt;.*?)@.*)|(?&lt;realm&gt;@.*))$
config.mapAuthRecord.regex.replacement = ${user}${at}${suffix}</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>Ensure that the ownership and permissions of the configuration files are appropriate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown ovirt:ovirt /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<em>example</em>-http-authn.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<em>example</em>-http-mapping.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown ovirt:ovirt /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 600 /etc/ovirt-engine/aaa/<em>example</em>.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 640 /etc/ovirt-engine/extensions.d/<em>example</em>-http-authn.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 640 /etc/ovirt-engine/extensions.d/<em>example</em>-http-mapping.properties</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod 640 /etc/ovirt-engine/extensions.d/<em>example</em>-authz.properties</pre>
</div>
</div>
</li>
<li>
<p>Restart the Apache service and the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd.service
# systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Red_Hat_SSO">19.5. Installing and Configuring Red Hat Single Sign-On</h3>
<div class="paragraph">
<p>To use Red Had Single Sign-On as your authorization method, you need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Install Red Hat SSO.</p>
</li>
<li>
<p>Configure the LDAP group mapper.</p>
</li>
<li>
<p>Configure Apache on the Engine.</p>
</li>
<li>
<p>Configure OVN provider credentials.</p>
</li>
<li>
<p>Configure the Monitoring Portal (Grafana)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If Red Hat SSO is configured, previous LDAP sign ons will not work, as only a single authorization protocol may be used at a time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="installing-red-hat-single-sign-on">19.5.1. Installing Red Hat Single Sign-On</h4>
<div id="Installing_RH_SSO" class="paragraph">
<p>You can install Red Hat Single Sign-On by downloading a ZIP file and unpacking it, or by using an RPM file.</p>
</div>
<div class="paragraph">
<p>Follow the installation instructions at <a href="https://access.redhat.com/documentation/en-us/red_hat_single_sign-on/7.4/html-single/server_installation_and_configuration_guide/index#installation">Red Hat SSO Installation</a></p>
</div>
<div class="paragraph">
<p>Prepare the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Path/location of the <code>Open ID Connect</code> server.</p>
</li>
<li>
<p>The subscription channel for the correct repositories.</p>
</li>
<li>
<p>Valid Red Hat subscription login credentials.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-ldap-group-mapper">19.5.2. Configuring the LDAP group mapper</h4>
<div id="Configuring_RHSSO_ldap" class="olist arabic">
<ol class="arabic">
<li>
<p>Add the LDAP groups mapper with the following information:</p>
<div class="ulist">
<ul>
<li>
<p><code>Name</code>: ldapgroups</p>
</li>
<li>
<p><code>Mapper Type</code>: group-ldap-mapper</p>
</li>
<li>
<p><code>LDAP Groups DN</code>: ou=groups,dc=example,dc=com</p>
</li>
<li>
<p><code>Group Object Classes</code>: groupofuniquenames (<em>adapt this class according to your LDAP server setup</em>)</p>
</li>
<li>
<p><code>Membership LDAP Attribute</code>: uniquemember (<em>adapt this class according to your LDAP server setup</em>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <code>Save</code>.</p>
</li>
<li>
<p>Click <code>Sync LDAP Groups to KeyCloak</code>.</p>
</li>
<li>
<p>At the bottom of the <code>User Federation Provider</code> page, click <code>Synchronize all users</code>.</p>
</li>
<li>
<p>In the <code>Clients</code> tab, under <code>Add Client</code>, add <code>ovirt-engine</code> as the <code>Client ID</code>, and enter the engine url as the <code>Root URL</code>.</p>
</li>
<li>
<p>Modify the <code>Client Protocol</code> to <code>openid-connect</code> and the <code>Access Type</code> to <code>confidential</code>.</p>
</li>
<li>
<p>In the <code>Clients</code> tab, under <code>Ovirt-engine</code> &gt; <code>Advanced Settings</code>, increase the <code>Access Token Lifespan</code>.</p>
</li>
<li>
<p>Add <code>https://rhvm.example.com:443/*</code> as a valid redirect URI.</p>
</li>
<li>
<p>The client secret is generated, and can be viewed in the Credentials tab.</p>
</li>
<li>
<p>In the <code>Clients</code> tab under <code>Create Mapper Protocol</code>, create a mapper with the following settings:</p>
<div class="ulist">
<ul>
<li>
<p><code>Name</code>: groups</p>
</li>
<li>
<p><code>Mapper Type</code>: Group Membership</p>
</li>
<li>
<p><code>Token Claim Name</code>: groups</p>
</li>
<li>
<p><code>Full group path</code>: <code>ON</code></p>
</li>
<li>
<p><code>Add to ID token</code>: <code>ON</code></p>
</li>
<li>
<p><code>Add to access token</code>: <code>ON</code></p>
</li>
<li>
<p><code>Add to userinfo</code>: <code>ON</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Add the <code>Builtin Protocol Mapper</code> for <code>username</code>.</p>
</li>
<li>
<p>Create the scopes needed by <code>ovirt-engine</code>, <code>ovirt-app-api</code>, <code>ovirt-app-admin</code>, and <code>ovirt-ext=auth:sequence-priority=~</code>.</p>
</li>
<li>
<p>Use the scopes created in the previous step to set up optional client scopes for the ovirt-engine client.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-apache-in-the-engine">19.5.3. Configuring Apache in the Engine</h4>
<div id="Configuring_RHSSO_apache" class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the <code>mod_auth_openidc</code> module.</p>
<div class="listingblock">
<div class="content">
<pre># dnf module enable mod_auth_openidc:2.3 -y</pre>
</div>
</div>
</li>
<li>
<p>Configure Apache in the Engine</p>
<div class="listingblock">
<div class="content">
<pre># dnf install mod_auth_openidc</pre>
</div>
</div>
</li>
<li>
<p>Create a new <code>httpd</code> config file <code>ovirt-openidc.conf</code> in <strong>/etc/httpd/conf.d/</strong> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre>LoadModule auth_openidc_module modules/mod_auth_openidc.so

OIDCProviderMetadataURL https://SSO.example.com/auth/realms/master/.well-known/openid-configuration
OIDCSSLValidateServer Off

OIDCClientID ovirt-engine
OIDCClientSecret &lt;client_SSO _generated_key&gt;
OIDCRedirectURI https://rhvm.example.com/ovirt-engine/callback
OIDCDefaultURL https://rhvm.example.com/ovirt-engine/login?scope=ovirt-app-admin+ovirt-app-portal+ovirt-ext%3Dauth%3Asequence-priority%3D%7E

# maps the prefered_username claim to the REMOTE_USER environment variable:

OIDCRemoteUserClaim &lt;preferred_username&gt;
OIDCCryptoPassphrase &lt;random1234&gt;

&lt;LocationMatch ^/ovirt-engine/sso/(interactive-login-negotiate|oauth/token-http-auth)|^/ovirt-engine/callback&gt;
    &lt;If "req('Authorization') !~ /^(Bearer|Basic)/i"&gt;

      Require valid-user
      AuthType openid-connect

      ErrorDocument 401 "&lt;html&gt;&lt;meta http-equiv=\"refresh\" content=\"0; url=/ovirt-engine/sso/login-unauthorized\"/&gt;&lt;body&gt;&lt;a href=\"/ovirt-engine/sso/login-unauthorized\"&gt;Here&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;"
    &lt;/If&gt;
&lt;/LocationMatch&gt;

OIDCOAuthIntrospectionEndpoint https://SSO.example.com/auth/realms/master/protocol/openid-connect/token/introspect
OIDCOAuthSSLValidateServer    Off
OIDCOAuthIntrospectionEndpointParams token_type_hint=access_token
OIDCOAuthClientID ovirt-engine
OIDCOAuthClientSecret &lt;client_SSO _generated_key&gt;
OIDCOAuthRemoteUserClaim sub

&lt;LocationMatch ^/ovirt-engine/(api$|api/)&gt;
   AuthType oauth20
   Require valid-user
&lt;/LocationMatch&gt;</pre>
</div>
</div>
</li>
<li>
<p>To save the configuration changes, restart <strong>httpd</strong> and <strong>ovirt-engine</strong>:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd
# systemctl restart ovirt-engine</pre>
</div>
</div>
</li>
<li>
<p>Create the file <code>openidc-authn.properties</code> in <strong>/etc/ovirt-engine/extensions.d/</strong> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre>ovirt.engine.extension.name = openidc-authn
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthnExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authn
ovirt.engine.aaa.authn.profile.name = openidchttp
ovirt.engine.aaa.authn.authz.plugin = openidc-authz
ovirt.engine.aaa.authn.mapping.plugin = openidc-http-mapping
config.artifact.name = HEADER
config.artifact.arg = OIDC_CLAIM_preferred_username</pre>
</div>
</div>
</li>
<li>
<p>Create the file <code>openidc-http-mapping.properties</code> in <strong>/etc/ovirt-engine/extensions.d/</strong> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre>ovirt.engine.extension.name = openidc-http-mapping
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.mapping.MappingExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Mapping
config.mapAuthRecord.type = regex
config.mapAuthRecord.regex.mustMatch = false
config.mapAuthRecord.regex.pattern = ^(?&lt;user&gt;.*?)((\\\\(?&lt;at&gt;@)(?&lt;suffix&gt;.*?)@.*)|(?&lt;realm&gt;@.*))$
config.mapAuthRecord.regex.replacement = ${user}${at}${suffix}</pre>
</div>
</div>
</li>
<li>
<p>Create  the file <code>openidc-authz.properties</code> in <strong>/etc/ovirt-engine/extensions.d/</strong> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre>ovirt.engine.extension.name = openidc-authz
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.aaa.misc
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.aaa.misc.http.AuthzExtension
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.aaa.Authz
config.artifact.name.arg = OIDC_CLAIM_preferred_username
config.artifact.groups.arg = OIDC_CLAIM_groups</pre>
</div>
</div>
</li>
<li>
<p>Create the file <code>99-enable-external-auth.conf</code> in <strong>/etc/ovirt-engine/engine.conf.d/</strong> with the following content:</p>
<div class="listingblock">
<div class="content">
<pre>ENGINE_SSO_ENABLE_EXTERNAL_SSO=true
ENGINE_SSO_EXTERNAL_SSO_LOGOUT_URI="${ENGINE_URI}/callback"
EXTERNAL_OIDC_USER_INFO_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/userinfo
EXTERNAL_OIDC_TOKEN_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/token
EXTERNAL_OIDC_LOGOUT_END_POINT=https://SSO.example.com/auth/realms/master/protocol/openid-connect/logout
EXTERNAL_OIDC_CLIENT_ID=ovirt-engine
EXTERNAL_OIDC_CLIENT_SECRET="&lt;client_SSO _generated_key&gt;"
EXTERNAL_OIDC_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"
EXTERNAL_OIDC_HTTPS_PKI_TRUST_STORE_PASSWORD=""
EXTERNAL_OIDC_SSL_VERIFY_CHAIN=false
EXTERNAL_OIDC_SSL_VERIFY_HOST=false</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-ovn">19.5.4. Configuring OVN</h4>
<div id="Configuring_RHSSO_OVN" class="paragraph">
<p>If you configured the <strong>ovirt-ovn-provider</strong> in the Engine, you need to configure the OVN provider credentials.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the file <code>20-setup-ovirt-provider-ovn.conf</code> in <strong>/etc/ovirt-provider-ovn/conf.d/</strong> with the following contents,
where <strong>user1</strong> belongs to the LDAP group <strong>ovirt-administrator</strong>, and <strong>openidchttp</strong> is the profile configured for <strong>aaa-ldap-misc</strong>.</p>
<div class="listingblock">
<div class="content">
<pre>[OVIRT]
# ovirt-admin-user-name=user1@openidchttp</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-provider-ovn</code>:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart ovirt-provider-ovn</pre>
</div>
</div>
</li>
<li>
<p>Log in to the Administration Portal, navigate to <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>, select <strong>ovirt-provider-ovn</strong>, and click <b class="button">Edit</b> to update the password for the ovn provider.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-the-monitoring-portal-grafana">19.5.5. Configuring the Monitoring Portal (Grafana)</h4>
<div id="Configuring_RHSSO_Monitoring_Portal" class="olist arabic">
<ol class="arabic">
<li>
<p>Configure a client&#8217;s valid redirect URL:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select the client configured in earlier steps (ie. ovirt-engine)</p>
</li>
<li>
<p>Add an additional valid Redirect URI for the Monitoring Portal(Grafana).
Valid Redirect URIs: <a href="https://rhvm.example.com:443/ovirt-engine-grafana/login/generic_oauth/" class="bare">https://rhvm.example.com:443/ovirt-engine-grafana/login/generic_oauth/</a></p>
</li>
<li>
<p>Select the <strong>Mappers</strong> tab.</p>
</li>
<li>
<p>Click <b class="button">Create</b> to create a new Mapper, and fill in the following fields:</p>
<div class="ulist">
<ul>
<li>
<p>Name: <code>realm role</code></p>
</li>
<li>
<p>Mapper Type: <code>User Realm Role</code></p>
</li>
<li>
<p>Token Claim Name: <code>realm_access.roles</code></p>
</li>
<li>
<p>Claim JSON Type: String</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Configure Grafana specific roles:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select <strong>Roles</strong> from the main menu.</p>
</li>
<li>
<p>Add the following roles: <code>admin</code>, <code>editor</code>, <code>viewer</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Assign Grafana specific roles to the desired groups:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Select <strong>Groups</strong> from the main menu, and choose a desired group.</p>
</li>
<li>
<p>Select <strong>Role Mappings</strong>.</p>
</li>
<li>
<p>Move the desired roles from <strong>Available Roles</strong> to <strong>Assigned Roles</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure Grafana - modify the section <code>auth.generic_oauth</code> in <code>/etc/grafana/grafana.ini</code> as follows. Replace the values in arrow brackets &lt; &gt; as needed.</p>
<div class="listingblock">
<div class="content">
<pre>(...)
#################################### Generic OAuth #######################
[auth.generic_oauth]
name = oVirt Engine Auth
enabled = true
allow_sign_up = true
client_id = ovirt-engine
client_secret = &lt;client-secret-of-RH-SSO&gt;
scopes = openid,ovirt-app-admin,ovirt-app-portal,ovirt-ext=auth:sequence-priority=~
email_attribute_name = email:primary
role_attribute_path = "contains(realm_access.roles[*], 'admin') &amp;&amp; 'Admin' || contains(realm_access.roles[*], 'editor') &amp;&amp; 'Editor' || 'Viewer'"
auth_url = https://&lt;rh-sso-hostname&gt;/auth/realms/&lt;RH-SSO-REALM&gt;/protocol/openid-connect/auth
token_url = https://&lt;rh-sso-hostname&gt;/auth/realms/&lt;RH-SSO-REALM&gt;/protocol/openid-connect/token
api_url = https://&lt;rh-sso-hostname&gt;/auth/realms/&lt;RH-SSO-REALM&gt;/protocol/openid-connect/userinfo
team_ids =
allowed_organizations =
tls_skip_verify_insecure = false
tls_client_cert =
tls_client_key =
tls_client_ca = /etc/pki/ovirt-engine/apache-ca.pem
send_client_credentials_via_post = false
(...)</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-User_Authorization">19.6. User Authorization</h3>
<div class="sect3">
<h4 id="User_authorization_model">19.6.1. User Authorization Model</h4>
<div class="paragraph">
<p>oVirt applies authorization controls based on the combination of the three components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The user performing the action</p>
</li>
<li>
<p>The type of action being performed</p>
</li>
<li>
<p>The object on which the action is being performed</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="User_actions">19.6.2. User Actions</h4>
<div class="paragraph">
<p>For an action to be successfully performed, the <strong>user</strong> must have the appropriate <strong>permission</strong> for the <strong>object</strong> being acted upon. Each type of action has a corresponding <strong>permission</strong>.</p>
</div>
<div class="paragraph">
<p>Some actions are performed on more than one object. For example, copying a template to another storage domain will impact both the template and the destination storage domain. The user performing an action must have appropriate permissions for all objects the action impacts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Enterprise_Virtualization_Manager_User_Tasks">19.7. Administering User Tasks From the Administration Portal</h3>
<div class="sect3">
<h4 id="Adding_users">19.7.1. Adding Users and Assigning VM Portal Permissions</h4>
<div class="paragraph">
<p>Users must be created already before they can be added and assigned roles and permissions. The roles and permissions assigned in this procedure give the user the permission to log in to the VM Portal and to start creating virtual machines. The procedure also applies to group accounts.</p>
</div>
<div class="paragraph">
<p><strong>Adding Users and Assigning VM Portal Permissions</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the header bar, click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Configure</b></span>. This opens the <strong>Configure</strong> window.</p>
</li>
<li>
<p>Click <strong>System Permissions</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>. This opens the <strong>Add System Permission to User</strong> window.</p>
</li>
<li>
<p>Select a profile under <strong>Search</strong>. The profile is the domain you want to search. Enter a name or part of a name in the search text field, and click <strong>GO</strong>. Alternatively, click <strong>GO</strong> to view a list of all users and groups.</p>
</li>
<li>
<p>Select the check boxes for the appropriate users or groups.</p>
</li>
<li>
<p>Select an appropriate role to assign under <strong>Role to Assign</strong>. The <strong>UserRole</strong> role gives the user account the permission to log in to the VM Portal.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Log in to the VM Portal to verify that the user account has the permissions to log in.</p>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_user_information">19.7.2. Viewing User Information</h4>
<div class="paragraph">
<p><strong>Viewing User Information</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span> to display the list of authorized users.</p>
</li>
<li>
<p>Click the user&#8217;s name. This opens the details view, usually with the <strong>General</strong> tab displaying general information, such as the domain name, email and status of the user.</p>
</li>
<li>
<p>The other tabs allow you to view groups, permissions, quotas, and events for the user.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, to view the groups to which the user belongs, click the <strong>Directory Groups</strong> tab.</p>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_User_Permissions_on_Resources">19.7.3. Viewing User Permissions on Resources</h4>
<div class="paragraph">
<p>Users can be assigned permissions on specific resources or a hierarchy of resources. You can view the assigned users and their permissions on each resource.</p>
</div>
<div class="paragraph">
<p><strong>Viewing User Permissions on Resources</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find and click the resource&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Permissions</strong> tab to list the assigned users, the user&#8217;s role, and the inherited permissions for the selected resource.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Removing_Users">19.7.4. Removing Users</h4>
<div class="paragraph">
<p>When a user account is no longer required, remove it from oVirt.</p>
</div>
<div class="paragraph">
<p><strong>Removing Users</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span> to display the list of authorized users.</p>
</li>
<li>
<p>Select the user to be removed. Ensure the user is not running any virtual machines.</p>
</li>
<li>
<p>Click <strong>Remove</strong>, then click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The user is removed from oVirt, but not from the external directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="Viewing_Logged_In_Users">19.7.5. Viewing Logged-In Users</h4>
<div class="paragraph">
<p>You can view the users who are currently logged in, along with session times and other details. Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Active User Sessions</b></span> to view the <strong>Session DB ID</strong>, <strong>User Name</strong>, <strong>Authorization provider</strong>, <strong>User id</strong>, <strong>Source IP</strong>, <strong>Session Start Time</strong>, and <strong>Session Last Active Time</strong> for each logged-in user.</p>
</div>
</div>
<div class="sect3">
<h4 id="Terminating_a_User_Session">19.7.6. Terminating a User Session</h4>
<div class="paragraph">
<p>You can terminate the session of a user who is currently logged in.</p>
</div>
<div class="paragraph">
<p><strong>Terminating a User Session</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Active User Sessions</b></span>.</p>
</li>
<li>
<p>Select the user session to be terminated.</p>
</li>
<li>
<p>Click <strong>Terminate Session</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-Administering_User_Tasks_From_the_commandline">19.8. Administering User Tasks From the Command Line</h3>
<div class="paragraph">
<p>You can use the <code>ovirt-aaa-jdbc-tool</code> tool to manage user accounts on the internal domain. Changes made using the tool take effect immediately and do not require you to restart the <code>ovirt-engine</code> service. For a full list of user options, run <code>ovirt-aaa-jdbc-tool user --help</code>. Common examples are provided in this section.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You must be logged into the Engine machine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="creating-a-new-user">19.8.1. Creating a New User</h4>
<div class="paragraph">
<p>You can create a new user account. The optional <code>--attribute</code> command specifies account details. For a full list of options, run <code>ovirt-aaa-jdbc-tool user add --help</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user add <em>test1</em> --attribute=firstName=<em>John</em> --attribute=lastName=<em>Doe</em>
adding user test1...
user added successfully</pre>
</div>
</div>
<div class="paragraph">
<p>You can add the newly created user in the Administration Portal and assign the user appropriate roles and permissions. See <a href="#Adding_users">Adding Users and Assigning VM Portal Permissions</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting-a-user-password">19.8.2. Setting a User Password</h4>
<div class="paragraph">
<p>You can create a password. You must set a value for <code>--password-valid-to</code>, otherwise the password expiry time defaults to the current time. The date format is <code>yyyy-MM-dd HH:mm:ssX</code>. In this example, <code>-0800</code> stands for GMT minus 8 hours. For more options, run <code>ovirt-aaa-jdbc-tool user password-reset --help</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user password-reset <em>test1</em> --password-valid-to=<em>"2025-08-01 12:00:00-0800"</em>
Password:
updating user test1...
user updated successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, the password policy for user accounts on the internal domain has the following restrictions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A minimum of 6 characters.</p>
</li>
<li>
<p>Three previous passwords used cannot be set again during the password change.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on the password policy and other default settings, run <code>ovirt-aaa-jdbc-tool settings show</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the admin password is updated, the change must be manually propagated to <code>ovirt-provider-ovn</code>. Otherwise, the the admin user will become locked because the Red Hat Virtualization Manager will continue to use the old password to synchronize networks from <code>ovirt-provider-ovn</code>. To propogate the new password to <code>ovirt-provider-ovn</code>, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Providers</b></span>.</p>
</li>
<li>
<p>Select <strong>ovirt-provider-ovn</strong>.</p>
</li>
<li>
<p>Click <strong>Edit</strong> and enter the new password in the <strong>Password</strong> field.</p>
</li>
<li>
<p>Click <b class="button">Test</b> to test if authentication succeeds with the credentials you provided.</p>
</li>
<li>
<p>When the authentication test succeeds, click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="setting-user-timeout">19.8.3. Setting User Timeout</h4>
<div class="paragraph">
<p>You can set the user timeout period:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set UserSessionTimeOutInterval=<em>integer</em></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pre-encrypting-a-user-password">19.8.4. Pre-encrypting a User Password</h4>
<div class="paragraph">
<p>You can create a pre-encrypted user password using the <code>ovirt-engine-crypto-tool</code> script. This option is useful if you are adding users and passwords to the database with a script.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Passwords are stored in the Engine database in encrypted form. The <code>ovirt-engine-crypto-tool</code> script is used because all passwords must be encrypted with the same algorithm.</p>
</div>
<div class="paragraph">
<p>If the password is pre-encrypted, password validity tests cannot be performed. The password will be accepted even if it does not comply with the password validation policy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/share/ovirt-engine/bin/ovirt-engine-crypto-tool.sh pbe-encode</pre>
</div>
</div>
<div class="paragraph">
<p>The script will prompt you to enter the password.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <code>--password=file:<em>file</em></code> option to encrypt a single password that appears as the first line of a file. This option is useful for automation. In the following example, <code><em>file</em></code> is a text file containing a single password for encryption:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/share/ovirt-engine/bin/ovirt-engine-crypto-tool.sh pbe-encode --password=file:<em>file</em></pre>
</div>
</div>
</li>
<li>
<p>Set the new password with the <code>ovirt-aaa-jdbc-tool</code> script, using the <code>--encrypted</code> option:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user password-reset <em>test1</em> --password-valid-to="2025-08-01 12:00:00-0800" --encrypted</pre>
</div>
</div>
</li>
<li>
<p>Enter and confirm the encrypted password:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Password:
Reenter password:
updating user test1...
user updated successfully</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="viewing-user-information">19.8.5. Viewing User Information</h4>
<div class="paragraph">
<p>You can view detailed user account information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user show test1</pre>
</div>
</div>
<div class="paragraph">
<p>This command displays more information than in the Administration Portal&#8217;s <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span> screen.</p>
</div>
</div>
<div class="sect3">
<h4 id="editing-user-information">19.8.6. Editing User Information</h4>
<div class="paragraph">
<p>You can update user information, such as the email address:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user edit test1 --attribute=email=jdoe@example.com</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="removing-a-user">19.8.7. Removing a User</h4>
<div class="paragraph">
<p>You can remove a user account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user delete test1</pre>
</div>
</div>
<div class="paragraph">
<p>Remove the user from the Administration Portal. See <a href="#Removing_Users">Removing Users</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="Disabling_the_Internal_Administrative_User">19.8.8. Disabling the Internal Administrative User</h4>
<div class="paragraph">
<p>You can disable users on the local domains including the <strong>admin@internal</strong> user created during <code>engine-setup</code>. Make sure you have at least one user in the envrionment with full administrative permissions before disabling the default <strong>admin</strong> user.</p>
</div>
<div class="paragraph">
<p><strong>Disabling the Internal Administrative User</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>Make sure another user with the <strong>SuperUser</strong> role has been added to the environment. See <a href="#Adding_users">Adding Users and Assigning VM Portal Permissions</a> for more information.</p>
</li>
<li>
<p>Disable the default <strong>admin</strong> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool user edit <code>admin</code> --flag=+disabled</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To enable a disabled user, run <code>ovirt-aaa-jdbc-tool user edit <em>username</em> --flag=-disabled</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Managing_Groups">19.8.9. Managing Groups</h4>
<div class="paragraph">
<p>You can use the <code>ovirt-aaa-jdbc-tool</code> tool to manage group accounts on your internal domain. Managing group accounts is similar to managing user accounts. For a full list of group options, run <code>ovirt-aaa-jdbc-tool group --help</code>. Common examples are provided in this section.</p>
</div>
<div class="paragraph">
<p><strong>Creating a Group</strong></p>
</div>
<div class="paragraph">
<p>This procedure shows you how to create a group account, add users to the group, and view the details of the group.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>Create a new group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group add <em>group1</em></pre>
</div>
</div>
</li>
<li>
<p>Add users to the group. The users must be created already.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group-manage useradd <em>group1</em> --user=<em>test1</em></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a full list of the group-manage options, run <code>ovirt-aaa-jdbc-tool group-manage --help</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>View group account details:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group show <em>group1</em></pre>
</div>
</div>
</li>
<li>
<p>Add the newly created group in the Administration Portal and assign the group appropriate roles and permissions. The users in the group inherit the roles and permissions of the group. See <a href="#Adding_users">Adding Users and Assigning VM Portal Permissions</a> for more information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Creating Nested Groups</strong></p>
</div>
<div class="paragraph">
<p>This procedure shows you how to create groups within groups.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>Create the first group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group add <em>group1</em></pre>
</div>
</div>
</li>
<li>
<p>Create the second group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group add <em>group1-1</em></pre>
</div>
</div>
</li>
<li>
<p>Add the second group to the first group:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool group-manage groupadd <em>group1</em> --group=<em>group1-1</em></pre>
</div>
</div>
</li>
<li>
<p>Add the first group in the Administration Portal and assign the group appropriate roles and permissions. See <a href="#Adding_users">Adding Users and Assigning VM Portal Permissions</a> for more information.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Querying_Users_and_Groups">19.8.10. Querying Users and Groups</h4>
<div class="paragraph">
<p>The <code>query</code> module allows you to query user and group information. For a full list of options, run <code>ovirt-aaa-jdbc-tool query --help</code>.</p>
</div>
<div class="paragraph">
<p><strong>Listing All User or Group Account Details</strong></p>
</div>
<div class="paragraph">
<p>This procedure shows you how to list all account information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>List the account details.</p>
<div class="ulist">
<ul>
<li>
<p>All user account details:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool query --what=user</pre>
</div>
</div>
</li>
<li>
<p>All group account details:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool query --what=group</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Listing Filtered Account Details</strong></p>
</div>
<div class="paragraph">
<p>This procedure shows you how to apply filters when listing account information.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>Filter account details using the <code>--pattern</code> parameter.</p>
<div class="ulist">
<ul>
<li>
<p>List user account details with names that start with the character <em>j</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool query --what=user --pattern="name=<em>j*</em>"</pre>
</div>
</div>
</li>
<li>
<p>List groups that have the department attribute set to <em>marketing</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool query --what=group --pattern="department=<em>marketing</em>"</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Managing_Account_Settings">19.8.11. Managing Account Settings</h4>
<div class="paragraph">
<p>To change the default account settings, use the <code>ovirt-aaa-jdbc-tool</code> <code>settings</code> module.</p>
</div>
<div class="paragraph">
<p><strong>Updating Account Settings</strong></p>
</div>
<div class="paragraph">
<p>This procedure shows you how to update the default account settings.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the machine on which the oVirt Engine is installed.</p>
</li>
<li>
<p>Run the following command to show all the settings available:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool settings show</pre>
</div>
</div>
</li>
<li>
<p>Change the desired settings:</p>
<div class="ulist">
<ul>
<li>
<p>This example updates the default log in session time to 60 minutes for all user accounts. The default value is 10080 minutes.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool settings set --name=MAX_LOGIN_MINUTES --value=<em>60</em></pre>
</div>
</div>
</li>
<li>
<p>This example updates the number of failed login attempts a user can perform before the user account is locked. The default value is 5.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ovirt-aaa-jdbc-tool settings set --name=MAX_FAILURES_SINCE_SUCCESS --value=<em>3</em></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To unlock a locked user account, run <code>ovirt-aaa-jdbc-tool user unlock <em>test1</em></code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Configuring_Additional_Local_Domains">19.9. Configuring Additional Local Domains</h3>
<div class="paragraph">
<p>Creating additional local domains other than the default <strong>internal</strong> domain is also supported. This can be done using the <strong>ovirt-engine-extension-aaa-jdbc</strong> extension and allows you to create multiple domains without attaching external directory servers, though the use case may not be common for enterprise environments.</p>
</div>
<div class="paragraph">
<p>Additionally created local domains will not get upgraded autonmatically during standard oVirt upgrades and need to be upgraded manually for each future release. For more information on creating additional local domains and how to upgrade the domains, see the README file at <strong>/usr/share/doc/ovirt-engine-extension-aaa-jdbc-<em>version</em>/README.admin</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Quotas_and_Service_Level_Agreement_Policy">20. Quotas and Service Level Agreement Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Introduction_to_Quota">20.1. Introduction to Quota</h3>
<div class="paragraph">
<p>Quota is a resource limitation tool provided with oVirt. Quota may be thought of as a layer of limitations on top of the layer of limitations set by User Permissions.</p>
</div>
<div class="paragraph">
<p>Quota is a data center object.</p>
</div>
<div class="paragraph">
<p>Quota allows administrators of oVirt environments to limit user access to memory, CPU, and storage. Quota defines the memory resources and storage resources an administrator can assign users. As a result users may draw on only the resources assigned to them. When the quota resources are exhausted, oVirt does not permit further user actions.</p>
</div>
<div class="paragraph">
<p>There are two different kinds of Quota:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. The Two Different Kinds of Quota</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Quota type</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run-time Quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This quota limits the consumption of runtime resources, like CPU and memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Quota</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This quota limits the amount of storage available.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Quota, like SELinux, has three modes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. Quota Modes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Quota Mode</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforced</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This mode puts into effect the quota that you have set in Audit mode, limiting resources to the group or user affected by the quota.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This mode logs quota violations without blocking users and can be used to test quotas. In Audit mode, you can increase or decrease the amount of runtime quota and the amount of storage quota available to users affected by it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This mode turns off the runtime and storage limitations defined by the quota.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When a user attempts to run a virtual machine, the specifications of the virtual machine are compared to the storage allowance and the runtime allowance set in the applicable quota.</p>
</div>
<div class="paragraph">
<p>If starting a virtual machine causes the aggregated resources of all running virtual machines covered by a quota to exceed the allowance defined in the quota, then the Engine refuses to run the virtual machine.</p>
</div>
<div class="paragraph">
<p>When a user creates a new disk, the requested disk size is added to the aggregated disk usage of all the other disks covered by the applicable quota. If the new disk takes the total aggregated disk usage above the amount allowed by the quota, disk creation fails.</p>
</div>
<div class="paragraph">
<p>Quota allows for resource sharing of the same hardware. It supports hard and soft thresholds. Administrators can use a quota to set thresholds on resources. These thresholds appear, from the user&#8217;s point of view, as 100% usage of that resource. To prevent failures when the customer unexpectedly exceeds this threshold, the interface supports a "grace" amount by which the threshold can be briefly exceeded. Exceeding the threshold results in a warning sent to the customer.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Quota imposes limitations upon the running of virtual machines. Ignoring these limitations is likely to result in a situation in which you cannot use your virtual machines and virtual disks.</p>
</div>
<div class="paragraph">
<p>When quota is running in enforced mode, virtual machines and disks that do not have quotas assigned cannot be used.</p>
</div>
<div class="paragraph">
<p>To power on a virtual machine, a quota must be assigned to that virtual machine.</p>
</div>
<div class="paragraph">
<p>To create a snapshot of a virtual machine, the disk associated with the virtual machine must have a quota assigned.</p>
</div>
<div class="paragraph">
<p>When creating a template from a virtual machine, you are prompted to select the quota that you want the template to consume. This allows you to set the template (and all future machines created from the template) to consume a different quota than the virtual machine and disk from which the template is generated.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Shared_Quota_and_Individually-defined_Quota">20.2. Shared Quota and Individually Defined Quota</h3>
<div class="paragraph">
<p>Users with SuperUser permissions can create quotas for individual users or quotas for groups.</p>
</div>
<div class="paragraph">
<p>Group quotas can be set for Active Directory users. If a group of ten users are given a quota of 1 TB of storage and one of the ten users fills the entire terabyte, then the entire group will be in excess of the quota and none of the ten users will be able to use any of the storage associated with their group.</p>
</div>
<div class="paragraph">
<p>An individual user&#8217;s quota is set for only the individual. Once the individual user has used up all of his or her storage or runtime quota, the user will be in excess of the quota and the user will no longer be able to use the storage associated with his or her quota.</p>
</div>
</div>
<div class="sect2">
<h3 id="Quota_Accounting">20.3. Quota Accounting</h3>
<div class="paragraph">
<p>When a quota is assigned to a consumer or a resource, each action by that consumer or on the resource involving storage, vCPU, or memory results in quota consumption or quota release.</p>
</div>
<div class="paragraph">
<p>Since the quota acts as an upper bound that limits the user&#8217;s access to resources, the quota calculations may differ from the actual current use of the user. The quota is calculated for the max growth potential and not the current usage.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Accounting example</div>
<div class="content">
<div class="paragraph">
<p>A user runs a virtual machine with 1 vCPU and 1024 MB memory. The action consumes 1 vCPU and 1024 MB of the quota assigned to that user. When the virtual machine is stopped 1 vCPU and 1024 MB of RAM are released back to the quota assigned to that user. Run-time quota consumption is accounted for only during the actual run-time of the consumer.</p>
</div>
<div class="paragraph">
<p>A user creates a virtual thin provision disk of 10 GB. The actual disk usage may indicate only 3 GB of that disk are actually in use. The quota consumption, however, would be 10 GB, the max growth potential of that disk.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_and_Changing_Quota_for_a_DC">20.4. Enabling and Changing a Quota Mode in a Data Center</h3>
<div class="paragraph">
<p>This procedure enables or changes the quota mode in a data center. You must select a quota mode before you can define quotas. You must be logged in to the Administration Portal to follow the steps of this procedure.</p>
</div>
<div class="paragraph">
<p>Use <strong>Audit</strong> mode to test your quota to verify that it works as you expect it to. You do not need to have your quota in <strong>Audit</strong> mode to create or change a quota.</p>
</div>
<div class="paragraph">
<p><strong>Enabling and Changing Quota in a Data Center</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Data Centers</b></span> and select a data center.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>In the <strong>Quota Mode</strong> drop-down list, change the quota mode to <strong>Enforced</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you set the quota mode to <strong>Audit</strong> during testing, then you must change it to <strong>Enforced</strong> in order for the quota settings to take effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="Creating_a_New_Quota_Policy">20.5. Creating a New Quota Policy</h3>
<div class="paragraph">
<p>You have enabled quota mode, either in Audit or Enforcing mode. You want to define a quota policy to manage resource usage in your data center.</p>
</div>
<div class="paragraph">
<p><strong>Creating a New Quota Policy</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Quota</b></span>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Fill in the <strong>Name</strong> and <strong>Description</strong> fields.</p>
</li>
<li>
<p>Select a <strong>Data Center</strong>.</p>
</li>
<li>
<p>In the <strong>Memory &amp; CPU</strong> section, use the green slider to set <strong>Cluster Threshold</strong>.</p>
</li>
<li>
<p>In the <strong>Memory &amp; CPU</strong> section, use the blue slider to set <strong>Cluster Grace</strong>.</p>
</li>
<li>
<p>Click the <strong>All Clusters</strong> or the <strong>Specific Clusters</strong> radio button. If you select <strong>Specific Clusters</strong>, select the check box of the clusters that you want to add a quota policy to.</p>
</li>
<li>
<p>Click <strong>Edit</strong>. This opens the <strong>Edit Quota</strong> window.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Under the <strong>Memory</strong> field, select either the <strong>Unlimited</strong> radio button (to allow limitless use of Memory resources in the cluster), or select the <strong>limit to</strong> radio button to set the amount of memory set by this quota. If you select the <strong>limit to</strong> radio button, input a memory quota in megabytes (MB) in the <strong>MB</strong> field.</p>
</li>
<li>
<p>Under the <strong>CPU</strong> field, select either the <strong>Unlimited</strong> radio button or the <strong>limit to</strong> radio button to set the amount of CPU set by this quota. If you select the <strong>limit to</strong> radio button, input a number of vCPUs in the <strong>vCpus</strong> field.</p>
</li>
<li>
<p>Click <b class="button">OK</b> in the <strong>Edit Quota</strong> window.</p>
</li>
</ol>
</div>
</li>
<li>
<p>In the <strong>Storage</strong> section, use the green slider to set <strong>Storage Threshold</strong>.</p>
</li>
<li>
<p>In the <strong>Storage</strong> section, use the blue slider to set <strong>Storage Grace</strong>.</p>
</li>
<li>
<p>Click the <strong>All Storage Domains</strong> or the <strong>Specific Storage Domains</strong> radio button. If you select <strong>Specific Storage Domains</strong>, select the check box of the storage domains that you want to add a quota policy to.</p>
</li>
<li>
<p>Click <strong>Edit</strong>. This opens the <strong>Edit Quota</strong> window.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Under the <strong>Storage Quota</strong> field, select either the <strong>Unlimited</strong> radio button (to allow limitless use of Storage) or the <strong>limit to</strong> radio button to set the amount of storage to which quota will limit users. If you select the <strong>limit to</strong> radio button, input a storage quota size in gigabytes (GB) in the <strong>GB</strong> field.</p>
</li>
<li>
<p>Click <b class="button">OK</b> in the <strong>Edit Quota</strong> window.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click <b class="button">OK</b> in the <strong>New Quota</strong> window.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Explanation_of_Quota_Threshold_Settings">20.6. Explanation of Quota Threshold Settings</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. Quota thresholds and grace</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of cluster resources available per data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluster Grace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of the cluster available for the data center after exhausting the data center&#8217;s Cluster Threshold.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of storage resources available per data center.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Storage Grace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of storage available for the data center after exhausting the data center&#8217;s Storage Threshold.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If a quota is set to 100 GB with 20% Grace, then consumers are blocked from using storage after they use 120 GB of storage. If the same quota has a Threshold set at 70%, then consumers receive a warning when they exceed 70 GB of storage consumption (but they remain able to consume storage until they reach 120 GB of storage consumption.) Both "Threshold" and "Grace" are set relative to the quota. "Threshold" may be thought of as the "soft limit", and exceeding it generates a warning. "Grace" may be thought of as the "hard limit", and exceeding it makes it impossible to consume any more storage resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="Assigning_a_Quota_to_an_Object">20.7. Assigning a Quota to an Object</h3>
<div class="paragraph">
<p><strong>Assigning a Quota to a Virtual Machine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span> and select a virtual machine.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the quota you want the virtual machine to consume from the <strong>Quota</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Assigning a Quota to a Virtual Disk</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Click a virtual machine&#8217;s name. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Disks</strong> tab and select the disk you plan to associate with a quota.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Select the quota you want the virtual disk to consume from the <strong>Quota</strong> drop-down list.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Quota must be selected for all objects associated with a virtual machine, in order for that virtual machine to work. If you fail to select a quota for the objects associated with a virtual machine, the virtual machine will not work. The error that the Engine throws in this situation is generic, which makes it difficult to know if the error was thrown because you did not associate a quota with all of the objects associated with the virtual machine. It is not possible to take snapshots of virtual machines that do not have an assigned quota. It is not possible to create templates of virtual machines whose virtual disks do not have assigned quotas.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Using_Quota_to_limit_user_resources">20.8. Using Quota to Limit Resources by User</h3>
<div class="paragraph">
<p>This procedure describes how to use quotas to limit the resources a user has access to.</p>
</div>
<div class="paragraph">
<p><strong>Assigning a User to a Quota</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Quota</b></span>.</p>
</li>
<li>
<p>Click the name of the target quota. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Consumers</strong> tab.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>In the <strong>Search</strong> field, type the name of the user you want to associate with the quota.</p>
</li>
<li>
<p>Click <strong>GO</strong>.</p>
</li>
<li>
<p>Select the check box next to the user&#8217;s name.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>After a short time, the user will appear in the <strong>Consumers</strong> tab in the details view.</p>
</div>
</div>
<div class="sect2">
<h3 id="Editing_Quotas">20.9. Editing Quotas</h3>
<div class="paragraph">
<p>This procedure describes how to change existing quotas.</p>
</div>
<div class="paragraph">
<p><strong>Editing Quotas</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Quota</b></span> and select a quota.</p>
</li>
<li>
<p>Click <strong>Edit</strong>.</p>
</li>
<li>
<p>Edit the fields as required.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Removing_Quotas">20.10. Removing Quotas</h3>
<div class="paragraph">
<p>This procedure describes how to remove quotas.</p>
</div>
<div class="paragraph">
<p><strong>Removing Quotas</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Quota</b></span> and select a quota.</p>
</li>
<li>
<p>Click <strong>Remove</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Service_Level_Agreement_Policy_Enforcement">20.11. Service Level Agreement Policy Enforcement</h3>
<div class="paragraph">
<p>This procedure describes how to set service level agreement CPU features.</p>
</div>
<div class="paragraph">
<p><strong>Setting a Service Level Agreement CPU Policy</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Compute</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Click <strong>New</strong>, or select a virtual machine and click <strong>Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Resource Allocation</strong> tab.</p>
</li>
<li>
<p>Specify <strong>CPU Shares</strong>. Possible options are <strong>Low</strong>, <strong>Medium</strong>, <strong>High</strong>, <strong>Custom</strong>, and <strong>Disabled</strong>. Virtual machines set to <strong>High</strong> receive twice as many shares as <strong>Medium</strong>, and virtual machines set to <strong>Medium</strong> receive twice as many shares as virtual machines set to <strong>Low</strong>. <strong>Disabled</strong> instructs VDSM to use an older algorithm for determining share dispensation; usually the number of shares dispensed under these conditions is 1020.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The CPU consumption of users is now governed by the policy you have set.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Event_Notifications">21. Event Notifications</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Configuring_event_notifications">21.1. Configuring Event Notifications in the Administration Portal</h3>
<div class="paragraph">
<p>The oVirt Engine can notify designated users via email when specific events occur in the environment that the oVirt Engine manages. To use this functionality, you must set up a mail transfer agent to deliver messages. Only email notifications can be configured through the Administration Portal. SNMP traps must be configured on the Engine machine.</p>
</div>
<div class="paragraph">
<p><strong>Configuring Event Notifications</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure that you have access to an email server that can accept automated messages from Engine and deliver them to a distribution list.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span> and select a user.</p>
</li>
<li>
<p>Click the user&#8217;s <strong>User Name</strong> to go to the details page.</p>
</li>
<li>
<p>In the <strong>Event Notifier</strong> tab, click <strong>Manage Events</strong>.</p>
</li>
<li>
<p>Use the <strong>Expand All</strong> button or the subject-specific expansion buttons to view the events.</p>
</li>
<li>
<p>Select the appropriate check boxes.</p>
</li>
<li>
<p>Enter an email address in the <strong>Mail Recipient</strong> field.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The email address can be a text message email address (for example, <code><em>1234567890@carrierdomainname.com</em></code>) or an email group address that includes email addresses and text message email addresses.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
<li>
<p>On the Engine machine, copy <code>ovirt-engine-notifier.conf</code> to a new file called <code>90-email-notify.conf</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf /etc/ovirt-engine/notifier/notifier.conf.d/90-email-notify.conf</pre>
</div>
</div>
</li>
<li>
<p>Edit <code>90-email-notify.conf</code>, deleting everything except the <code>EMAIL Notifications</code> section.</p>
</li>
<li>
<p>Enter the correct email variables, as in the example below. This file overrides the values in the original <code>ovirt-engine-notifier.conf</code> file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#---------------------#
# EMAIL Notifications #
#---------------------#

# The SMTP mail server address. Required.
MAIL_SERVER=myemailserver.example.com

# The SMTP port (usually 25 for plain SMTP, 465 for SMTP with SSL, 587 for SMTP with TLS)
MAIL_PORT=25

# Required if SSL or TLS enabled to authenticate the user. Used also to specify 'from' user address if mail server
# supports, when MAIL_FROM is not set. Address is in RFC822 format
MAIL_USER=

# Required to authenticate the user if mail server requires authentication or if SSL or TLS is enabled
SENSITIVE_KEYS="${SENSITIVE_KEYS},MAIL_PASSWORD"
MAIL_PASSWORD=

# Indicates type of encryption (none, ssl or tls) should be used to communicate with mail server.
MAIL_SMTP_ENCRYPTION=none

# If set to true, sends a message in HTML format.
HTML_MESSAGE_FORMAT=false

# Specifies 'from' address on sent mail in RFC822 format, if supported by mail server.
MAIL_FROM=rhevm2017@example.com

# Specifies 'reply-to' address on sent mail in RFC822 format.
MAIL_REPLY_TO=

# Interval to send smtp messages per # of IDLE_INTERVAL
MAIL_SEND_INTERVAL=1

# Amount of times to attempt sending an email before failing.
MAIL_RETRIES=4</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>See <code>/etc/ovirt-engine/notifier/notifier.conf.d/README</code> for more options.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Enable and restart the <code>ovirt-engine-notifier</code> service to activate the changes you have made:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl daemon-reload
# systemctl enable ovirt-engine-notifier.service
# systemctl restart ovirt-engine-notifier.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The specified user now receives emails based on events in the oVirt environment. The selected events are displayed on the <strong>Event Notifier</strong> tab for that user.</p>
</div>
</div>
<div class="sect2">
<h3 id="Cancelling_event_notifications">21.2. Canceling Event Notifications in the Administration Portal</h3>
<div class="paragraph">
<p>A user has configured some unnecessary email notifications and wants them canceled.</p>
</div>
<div class="paragraph">
<p><strong>Canceling Event Notifications</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <span class="menuseq"><b class="menu">Administration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span>.</p>
</li>
<li>
<p>Click the user&#8217;s <strong>User Name</strong>. This opens the details view.</p>
</li>
<li>
<p>Click the <strong>Event Notifier</strong> tab to list events for which the user receives email notifications.</p>
</li>
<li>
<p>Click <strong>Manage Events</strong>.</p>
</li>
<li>
<p>Use the <strong>Expand All</strong> button, or the subject-specific expansion buttons, to view the events.</p>
</li>
<li>
<p>Clear the appropriate check boxes to remove notification for that event.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Parameters_for_event_notifications_in_notifier">21.3. Parameters for Event Notifications in ovirt-engine-notifier.conf</h3>
<div class="paragraph">
<p>The event notifier configuration file can be found in <strong>/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. ovirt-engine-notifier.conf variables</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable Name</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENSITIVE_KEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma-separated list of keys that will not be logged.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JBOSS_HOME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/rh/eap7/root/usr/share/wildfly</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the JBoss application server used by the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_ETC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/etc/ovirt-engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the <code>etc</code> directory used by the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_LOG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/ovirt-engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the <code>logs</code> directory used by the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_USR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/share/ovirt-engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the <code>usr</code> directory used by the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_JAVA_MODULEPATH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${ENGINE_USR}/modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file path to which the JBoss modules are appended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTIFIER_DEBUG_ADDRESS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The address of a machine that can be used to perform remote debugging of the Java virtual machine that the notifier uses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTIFIER_STOP_TIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time, in seconds, after which the service will time out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOTIFIER_STOP_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time, in seconds, by which the timeout counter will be incremented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTERVAL_IN_SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval in seconds between instances of dispatching messages to subscribers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDLE_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval, in seconds, between which low-priority tasks will be performed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAYS_TO_KEEP_HISTORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This variable sets the number of days dispatched events will be preserved in the history table. If this variable is not set, events remain on the history table indefinitely.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_QUERIES_NOTIFICATION_THRESHOLD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of failed queries after which a notification email is sent. A notification email is sent after the first failure to fetch notifications, and then once every time the number of failures specified by this variable is reached. If you specify a value of <code>0</code> or <code>1</code>, an email will be sent with each failure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FAILED_QUERIES_NOTIFICATION_RECIPIENTS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email addresses of the recipients to which notification emails will be sent. Email addresses must be separated by a comma. This entry has been deprecated by the <code>FILTER</code> variable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAYS_TO_SEND_ON_STARTUP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of days of old events that will be processed and sent when the notifier starts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FILTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclude:*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The algorithm used to determine the triggers for and recipients of email notifications. The value for this variable comprises a combination of <code>include</code> or <code>exclude</code>, the event, and the recipient. For example, <code>include:VDC_START(smtp:mail@example.com) ${FILTER}</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_SERVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SMTP mail server address. Required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_PORT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used for communication. Possible values include <code>25</code> for plain SMTP, <code>465</code> for SMTP with SSL, and <code>587</code> for SMTP with TLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_USER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If SSL is enabled to authenticate the user, then this variable must be set. This variable is also used to specify the "from" user address when the MAIL_FROM variable is not set. Some mail servers do not support this functionality. The address is in RFC822 format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SENSITIVE_KEYS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">${SENSITIVE_KEYS},MAIL_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to authenticate the user if the mail server requires authentication or if SSL or TLS is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_PASSWORD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required to authenticate the user if the mail server requires authentication or if SSL or TLS is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_SMTP_ENCRYPTION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of encryption to be used in communication. Possible values are <code>none</code>, <code>ssl</code>, <code>tls</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML_MESSAGE_FORMAT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The mail server sends messages in HTML format if this variable is set to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_FROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This variable specifies a sender address in RFC822 format, if supported by the mail server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_REPLY_TO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This variable specifies reply-to addresses in RFC822 format on sent mail, if supported by the mail server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_SEND_INTERVAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of SMTP messages to be sent for each IDLE_INTERVAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAIL_RETRIES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times to attempt to send an email before failing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP_MANAGER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The IP addresses or fully qualified domain names of machines that will act as the SNMP managers. Entries must be separated by a space and can contain a port number. For example, <code>manager1.example.com manager2.example.com:164</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP_COMMUNITY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">public</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default SNMP community.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP_OID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.6.1.4.1.2312.13.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default trap object identifiers for alerts. All trap types are sent, appended with event information, to the SNMP manager when this OID is defined. Note that changing the default trap prevents generated traps from complying with the Engine&#8217;s management information base.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_INTERVAL_IN_SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The interval, in seconds, between monitoring the machine on which the Engine is installed. The interval is measured from the time the monitoring is complete.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_MONITOR_RETRIES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of times the notifier attempts to monitor the status of the machine on which the Engine is installed in a given interval after a failure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_TIMEOUT_IN_SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The time, in seconds, to wait before the notifier attempts to monitor the status of the machine on which the Engine is installed in a given interval after a failure.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IS_HTTPS_PROTOCOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This entry must be set to <code>true</code> if JBoss is being run in secured mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL_PROTOCOL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The protocol used by JBoss configuration connector when SSL is enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL_IGNORE_CERTIFICATE_ERRORS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value must be set to <code>true</code> if JBoss is running in secure mode and SSL errors is to be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSL_IGNORE_HOST_VERIFICATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value must be set to <code>true</code> if JBoss is running in secure mode and host name verification is to be ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REPEAT_NON_RESPONSIVE_NOTIFICATION</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This variable specifies whether repeated failure messages will be sent to subscribers if the machine on which the Engine is installed is non-responsive.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ENGINE_PID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/lib/ovirt-engine/ovirt-engine.pid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path and file name of the PID of the Engine.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Configuring_the_Red_Hat_Enterprise_Virtualization_Manager_to_Send_SNMP_Traps">21.4. Configuring the oVirt Engine to Send SNMP Traps</h3>
<div class="paragraph">
<p>Configure your oVirt Engine to send Simple Network Management Protocol traps to one or more external SNMP managers. SNMP traps contain system event information; they are used to monitor your oVirt environment. The number and type of traps sent to the SNMP manager can be defined within the oVirt Engine.</p>
</div>
<div class="paragraph">
<p>This procedure assumes that you have configured one or more external SNMP managers to receive traps, and that you have the following details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The IP addresses or fully qualified domain names of machines that will act as SNMP managers. Optionally, determine the port through which Engine receives trap notifications; by default, this is UDP port 162.</p>
</li>
<li>
<p>The SNMP community. Multiple SNMP managers can belong to a single community. Management systems and agents can communicate only if they are within the same community. The default community is <code>public</code>.</p>
</li>
<li>
<p>The trap object identifier for alerts. The oVirt Engine provides a default OID of 1.3.6.1.4.1.2312.13.1.1. All trap types are sent, appended with event information, to the SNMP manager when this OID is defined. Note that changing the default trap prevents generated traps from complying with the Engine&#8217;s management information base.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The oVirt Engine provides management information bases at <strong>/usr/share/doc/ovirt-engine/mibs/OVIRT-MIB.txt</strong> and <strong>/usr/share/doc/ovirt-engine/mibs/REDHAT-MIB.txt</strong>. Load the MIBs in your SNMP manager before proceeding.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Default SNMP configuration values exist on the Engine in the events notification daemon configuration file <strong>/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</strong>. The values outlined in the following procedure are based on the default or example values provided in that file. It is recommended that you define an override file, rather than edit the <strong>ovirt-engine-notifier.conf</strong> file, to persist your configuration options after changes such as system upgrades.</p>
</div>
<div class="paragraph">
<p><strong>Configuring SNMP Traps on the Engine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine, create the SNMP configuration file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># vi /etc/ovirt-engine/notifier/notifier.conf.d/20-snmp.conf</pre>
</div>
</div>
</li>
<li>
<p>Specify the SNMP manager(s), the SNMP community, and the OID in the following format:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">SNMP_MANAGERS="<em>manager1.example.com</em> <em>manager2.example.com:162"</em>
SNMP_COMMUNITY=public
SNMP_OID=1.3.6.1.4.1.2312.13.1.1</pre>
</div>
</div>
</li>
<li>
<p>Define which events to send to the SNMP manager:</p>
<div class="exampleblock">
<div class="title">Example 25. Event Examples</div>
<div class="content">
<div class="paragraph">
<p>Send all events to the default SNMP profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="include:*(snmp:) ${FILTER}"</pre>
</div>
</div>
<div class="paragraph">
<p>Send all events with the severity <code>ERROR</code> or <code>ALERT</code> to the default SNMP profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="include:*:ERROR(snmp:) ${FILTER}"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="include:*:ALERT(snmp:) ${FILTER}"</pre>
</div>
</div>
<div class="paragraph">
<p>Send events for <em>VDC_START</em> to the specified email address:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="include:<em>VDC_START</em>(snmp:<em>mail@example.com</em>) ${FILTER}"</pre>
</div>
</div>
<div class="paragraph">
<p>Send events for everything but <em>VDC_START</em> to the default SNMP profile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="exclude:<em>VDC_START</em> include:*(snmp:) ${FILTER}"</pre>
</div>
</div>
<div class="paragraph">
<p>This the default filter defined in <strong>ovirt-engine-notifier.conf</strong>; if you do not disable this filter or apply overriding filters, no notifications will be sent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">FILTER="exclude:*"</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><code>VDC_START</code> is an example of the audit log messages available. A full list of audit log messages can be found in <strong>/usr/share/doc/ovirt-engine/AuditLogMessages.properties</strong>. Alternatively, filter results within your SNMP manager.</p>
</div>
</li>
<li>
<p>Save the file.</p>
</li>
<li>
<p>Start the <code>ovirt-engine-notifier</code> service, and ensure that this service starts on boot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start ovirt-engine-notifier.service
# systemctl enable ovirt-engine-notifier.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Check your SNMP manager to ensure that traps are being received.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>SNMP_MANAGERS</code>, <code>MAIL_SERVER</code>, or both must be properly defined in <strong>/usr/share/ovirt-engine/services/ovirt-engine-notifier/ovirt-engine-notifier.conf</strong> or in an override file in order for the notifier service to run.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Utilities">22. Utilities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-The_oVirt_Engine_Rename_Tool">22.1. The oVirt Engine Rename Tool</h3>
<div class="sect3">
<h4 id="The_oVirt_Engine_Rename_Tool">22.1.1. The oVirt Engine Rename Tool</h4>
<div class="paragraph">
<p>When the <code>engine-setup</code> command is run in a clean environment, the command generates a number of certificates and keys that use the fully qualified domain name of the Engine supplied during the setup process. If the fully qualified domain name of the Engine must be changed later on (for example, due to migration of the machine hosting the Engine to a different domain), the records of the fully qualified domain name must be updated to reflect the new name. The <code>ovirt-engine-rename</code> command automates this task.</p>
</div>
<div class="paragraph">
<p>The <code>ovirt-engine-rename</code> command updates records of the fully qualified domain name of the Engine in the following locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>/etc/ovirt-engine/engine.conf.d/10-setup-protocols.conf</p>
</li>
<li>
<p>/etc/ovirt-engine/isouploader.conf.d/10-engine-setup.conf</p>
</li>
<li>
<p>/etc/ovirt-engine/logcollector.conf.d/10-engine-setup.conf</p>
</li>
<li>
<p>/etc/pki/ovirt-engine/cert.conf</p>
</li>
<li>
<p>/etc/pki/ovirt-engine/cert.template</p>
</li>
<li>
<p>/etc/pki/ovirt-engine/certs/apache.cer</p>
</li>
<li>
<p>/etc/pki/ovirt-engine/keys/apache.key.nopass</p>
</li>
<li>
<p>/etc/pki/ovirt-engine/keys/apache.p12</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While the <code>ovirt-engine-rename</code> command creates a new certificate for the web server on which the Engine runs, it does not affect the certificate for the Engine or the certificate authority. Due to this, there is some risk involved in using the <code>ovirt-engine-rename</code> command, particularly in environments that have been upgraded from Red Hat Enterprise Virtualization 3.2 and earlier. Therefore, changing the fully qualified domain name of the Engine by running <code>engine-cleanup</code> and <code>engine-setup</code> is recommended where possible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>During the upgrade process, the old hostname must be resolvable. If the oVirt Engine Rename Tool fails with the message <code>[ ERROR ] Host name is not valid: &lt;OLD FQDN&gt; did not resolve into an IP address</code>, add the old hostname to the <code>/etc/hosts</code> file, use the oVirt Engine Rename Tool, and then remove the old hostname from the <code>/etc/hosts</code> file.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Syntax_for_the_oVirt_Engine_Rename_Command">22.1.2. Syntax for the oVirt Engine Rename Command</h4>
<div class="paragraph">
<p>The basic syntax for the <code>ovirt-engine-rename</code> command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename</pre>
</div>
</div>
<div class="paragraph">
<p>The command also accepts the following options:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>--newname=<em>[new name]</em></code></strong></dt>
<dd>
<p>Allows you to specify the new fully qualified domain name for the Engine without user interaction.</p>
</dd>
<dt class="hdlist1"><strong><code>--log=<em>[file]</em></code></strong></dt>
<dd>
<p>Allows you to specify the path and name of a file into which logs of the rename operation are to be written.</p>
</dd>
<dt class="hdlist1"><strong><code>--config=<em>[file]</em></code></strong></dt>
<dd>
<p>Allows you to specify the path and file name of a configuration file to load into the rename operation.</p>
</dd>
<dt class="hdlist1"><strong><code>--config-append=<em>[file]</em></code></strong></dt>
<dd>
<p>Allows you to specify the path and file name of a configuration file to append to the rename operation. This option can be used to specify the path and file name of an existing answer file to automate the rename operation.</p>
</dd>
<dt class="hdlist1"><strong><code>--generate-answer=<em>[file]</em></code></strong></dt>
<dd>
<p>Allows you to specify the path and file name of the file in which your answers and the values changed by the <code>ovirt-engine-rename</code> command are recorded.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Renaming_the_Manager_with_the_Ovirt_Engine_Rename_Tool">22.1.3. Renaming the Engine with the oVirt Engine Rename Tool</h4>
<div class="paragraph">
<p>You can use the <code>ovirt-engine-rename</code> command to update records of the fully qualified domain name (FQDN) of the Engine.</p>
</div>
<div class="paragraph">
<p>The tool checks whether the Engine provides a local ISO or Data storage domain. If it does, the tool prompts the user to eject, shut down, or place into maintenance mode any virtual machine or storage domain connected to the storage before continuing with the operation. This ensures that virtual machines do not lose connectivity with their virtual disks, and prevents ISO storage domains from losing connectivity during the renaming process.</p>
</div>
<div class="paragraph">
<p><strong>Using the oVirt Engine Rename Tool</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare all DNS and other relevant records for the new FQDN.</p>
</li>
<li>
<p>Update the DHCP server configuration if DHCP is used.</p>
</li>
<li>
<p>Update the host name on the Engine.</p>
</li>
<li>
<p>Run the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/share/ovirt-engine/setup/bin/ovirt-engine-rename</pre>
</div>
</div>
</li>
<li>
<p>When prompted, press <code>Enter</code> to stop the engine service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">During execution engine service will be stopped (OK, Cancel) [OK]:</pre>
</div>
</div>
</li>
<li>
<p>When prompted, enter the new FQDN for the Engine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">New fully qualified server name:<em>new_engine_fqdn</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>ovirt-engine-rename</code> command updates records of the FQDN of the Engine.</p>
</div>
<div class="paragraph">
<p><strong>For a self-hosted engine, complete these additional steps:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following command on every existing self-hosted engine node:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config fqdn <em>new_engine_fqdn</em> --type=he_local</pre>
</div>
</div>
<div class="paragraph">
<p>This command modifies the FQDN in each self-hosted engine node&#8217;s local copy of <code class="filename">/etc/ovirt-hosted-engine-ha/hosted-engine.conf</code></p>
</div>
</li>
<li>
<p>Run the following command on one of the self-hosted engine nodes:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-shared-config fqdn <em>new_engine_fqdn</em> --type=he_shared</pre>
</div>
</div>
<div class="paragraph">
<p>This command modifies the FQDN in the master copy of <code class="filename">/etc/ovirt-hosted-engine-ha/hosted-engine.conf</code> on the shared storage domain.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Now, all new and existing self-hosted engine nodes use the new FQDN.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-The_Engine_Configuration_Tool">22.2. The Engine Configuration Tool</h3>
<div class="sect3">
<h4 id="The_Engine_Configuration_Tool">22.2.1. The Engine Configuration Tool</h4>
<div class="paragraph">
<p>The engine configuration tool is a command-line utility for configuring global settings for your oVirt environment. The tool interacts with a list of key-value mappings that are stored in the engine database, and allows you to retrieve and set the value of individual keys, and retrieve a list of all available configuration keys and values. Furthermore, different values can be stored for each configuration level in your oVirt environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Neither the oVirt Engine nor Red Hat JBoss Enterprise Application Platform need to be running to retrieve or set the value of a configuration key. Because the configuration key value-key mappings are stored in the engine database, they can be updated while the <code>postgresql</code> service is running. Changes are then applied when the <code>ovirt-engine</code> service is restarted.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Syntax_for_the_engine-config_Command">22.2.2. Syntax for the engine-config Command</h4>
<div class="paragraph">
<p>You can run the engine configuration tool from the machine on which the oVirt Engine is installed. For detailed information on usage, print the help output for the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --help</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Common tasks:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>List available configuration keys</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --list</pre>
</div>
</div>
</li>
<li>
<p>List available configuration values</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --all</pre>
</div>
</div>
</li>
<li>
<p>Retrieve value of configuration key</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --get <em>KEY_NAME</em></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>KEY_NAME</em> with the name of the preferred key to retrieve the value for the given version of the key. Use the <code>--cver</code> parameter to specify the configuration version of the value to be retrieved. If no version is provided, values for all existing versions are returned.</p>
</div>
</li>
<li>
<p>Set value of configuration key</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config --set <em>KEY_NAME</em>=<em>KEY_VALUE</em> --cver=<em>VERSION</em></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <em>KEY_NAME</em> with the name of the specific key to set, and replace <em>KEY_VALUE</em> with the value to be set. You must specify the <em>VERSION</em> in environments with more than one configuration version.</p>
</div>
</li>
<li>
<p>Restart the ovirt-engine service to load changes</p>
<div class="paragraph">
<p>The <strong>ovirt-engine</strong> service needs to be restarted for your changes to take effect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-The_USB_Filter_Editor">22.3. The USB Filter Editor</h3>
<div class="sect3">
<h4 id="Installing_the_USB_Filter_Editor">22.3.1. Installing the USB Filter Editor</h4>
<div class="paragraph">
<p>The USB Filter Editor is a Windows tool used to configure the <strong>usbfilter.txt</strong> policy file. The policy rules defined in this file allow or deny automatic passthrough of specific USB devices from client machines to virtual machines managed using the oVirt Engine. The policy file resides on the oVirt Engine in the following location:
<strong>/etc/ovirt-engine/usbfilter.txt</strong>
Changes to USB filter policies do not take effect unless the <strong>ovirt-engine</strong> service on the oVirt Engine is restarted.</p>
</div>
<div class="paragraph">
<p>Download the <strong>USB Filter Editor</strong> installer from <a href="https://access.redhat.com/downloads/content/415/">this "Installers and Images for oVirt Engine"</a> topic.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On a Windows machine, extract the <strong>.msi</strong> intaller from the <strong>.zip</strong> file and run the <strong>.msi</strong> installer.</p>
</li>
<li>
<p>Follow the steps of the installation wizard. Unless otherwise specified, the USB Filter Editor will be installed by default in either <strong>C:\Program Files\RedHat\USB Filter Editor</strong> or <strong>C:\Program Files(x86)\RedHat\USB Filter Editor</strong> depending on your version of Windows.</p>
</li>
<li>
<p>A USB Filter Editor shortcut icon is created on your desktop.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Use a Secure Copy (SCP) client to import and export filter policies from the oVirt Engine. A Secure Copy tool for Windows machines is WinSCP (<a href="http://winscp.net" class="bare">http://winscp.net</a>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The default USB device policy provides virtual machines with basic access to USB devices; update the policy to allow the use of additional USB devices.</p>
</div>
</div>
<div class="sect3">
<h4 id="The_USB_Filter_Editor_interface">22.3.2. The USB Filter Editor Interface</h4>
<div class="paragraph">
<p>Double-click the USB Filter Editor shortcut icon on your desktop.</p>
</div>
<div class="paragraph">
<p>The <strong>Red Hat USB Filter Editor</strong> interface displays the <strong>Class</strong>, <strong>Vendor</strong>, <strong>Product</strong>, <strong>Revision</strong>, and <strong>Action</strong> for each USB device. Permitted USB devices are set to <strong>Allow</strong> in the <strong>Action</strong> column; prohibited devices are set to <strong>Block</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. USB Editor Fields</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Class</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of USB device; for example, printers, mass storage controllers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Vendor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The manufacturer of the selected type of device.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Product</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The specific USB device model.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The revision of the product.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Action</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow or block the specified device.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The USB device policy rules are processed in their listed order. Use the <strong>Up</strong> and <strong>Down</strong> buttons to move rules higher or lower in the list. The universal <strong>Block</strong> rule needs to remain as the lowest entry to ensure all USB devices are denied unless explicitly allowed in the USB Filter Editor.</p>
</div>
</div>
<div class="sect3">
<h4 id="Adding_a_USB_policy">22.3.3. Adding a USB Policy</h4>
<div class="paragraph">
<p>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click  <strong>Add</strong>.</p>
</li>
<li>
<p>Use the <strong>USB Class</strong>, <strong>Vendor ID</strong>, <strong>Product ID</strong>, and <strong>Revision</strong> check boxes and lists to specify the device.</p>
<div class="paragraph">
<p>Click the <strong>Allow</strong> button to permit virtual machines use of the USB device; click the <strong>Block</strong> button to prohibit the USB device from virtual machines.</p>
</div>
<div class="paragraph">
<p>Click <b class="button">OK</b> to add the selected filter rule to the list and close the window.</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. Adding a Device</div>
<div class="content">
<div class="paragraph">
<p>The following is an example of how to add USB Class <code>Smartcard</code>, device <code>EP-1427X-2 Ethernet Adapter</code>, from manufacturer <code>Acer Communications &amp; Multimedia</code> to the list of allowed devices.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/306.png" alt="306">
</div>
</div>
</div>
</div>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Save</b></span> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have added a USB policy to the USB Filter Editor. You need to export USB filter policies to the oVirt Engine for them to take effect.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Exporting_a_USB_policy">Exporting a USB Policy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Removing_a_USB_policy">22.3.4. Removing a USB Policy</h4>
<div class="paragraph">
<p>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the policy to be removed.</p>
</li>
<li>
<p>Click <strong>Remove</strong>. A message displays prompting you to confirm that you want to remove the policy.</p>
</li>
<li>
<p>Click <strong>Yes</strong> to confirm that you want to remove the policy.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Save</b></span> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have removed a USB policy from the USB Filter Editor. You need to export USB filter policies to the oVirt Engine for them to take effect.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/administration_guide/index#Exporting_a_USB_policy">Exporting a USB Policy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Searching_for_USB_device_policies">22.3.5. Searching for USB Device Policies</h4>
<div class="paragraph">
<p>Search for attached USB devices to either allow or block them in the USB Filter Editor.</p>
</div>
<div class="paragraph">
<p>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Search</strong>. The <strong>Attached USB Devices</strong> window displays a list of all the attached devices.</p>
</li>
<li>
<p>Select the device and click <strong>Allow</strong> or <strong>Block</strong> as appropriate. Double-click the selected device to close the window. A policy rule for the device is added to the list.</p>
</li>
<li>
<p>Use the <strong>Up</strong> and <strong>Down</strong> buttons to change the position of the new policy rule in the list.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">File</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Save</b></span> to save the changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have searched the attached USB devices. USB filter policies need to be exported to the oVirt Engine to take effect.</p>
</div>
</div>
<div class="sect3">
<h4 id="Exporting_a_USB_policy">22.3.6. Exporting a USB Policy</h4>
<div class="paragraph">
<p>USB device policy changes need to be exported and uploaded to the oVirt Engine for the updated policy to take effect. Upload the policy and restart the <strong>ovirt-engine</strong> service.</p>
</div>
<div class="paragraph">
<p>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Click <strong>Export</strong>; the <strong>Save As</strong> window opens.</p>
</li>
<li>
<p>Save the file with a file name of <strong>usbfilter.txt</strong>.</p>
</li>
<li>
<p>Using a Secure Copy client, such as WinSCP, upload the <strong>usbfilter.txt</strong> file to the server running oVirt Engine. The file must be placed in the following directory on the server:
<strong>/etc/ovirt-engine/</strong></p>
</li>
<li>
<p>As the <strong>root</strong> user on the server running oVirt Engine, restart the <strong>ovirt-engine</strong> service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="Importing_a_USB_policy">22.3.7. Importing a USB Policy</h4>
<div class="paragraph">
<p>An existing USB device policy must be downloaded and imported into the USB Filter Editor before you can edit it.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Using a Secure Copy client, such as WinSCP, download the <strong>usbfilter.txt</strong> file from the server running oVirt Engine. The file can be found in the following directory on the server:
<strong>/etc/ovirt-engine/</strong></p>
</li>
<li>
<p>Double-click the USB Filter Editor shortcut icon on your desktop. This opens the editor.</p>
</li>
<li>
<p>Click <strong>Import</strong>. This opens the <strong>Open</strong> window.</p>
</li>
<li>
<p>Open the <strong>usbfilter.txt</strong> file that was downloaded from the server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-The_ISO_Uploader_Tool">22.4. The ISO Uploader Tool</h3>
<div class="sect3">
<h4 id="The_ISO_Uploader_Tool">22.4.1. The ISO Uploader Tool</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The ISO Uploader tool has been deprecated. Upload ISO images to the data domain with the Administration Portal or with the REST API. See <a href="#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The ISO uploader is a tool for uploading ISO images to the ISO storage domain. It is installed as part of the oVirt Engine.</p>
</div>
<div class="paragraph">
<p>The ISO uploader command is <code>engine-iso-uploader</code>. You must log in as the <strong>root</strong> user and provide the administration credentials for the oVirt environment to use this command. The <code>engine-iso-uploader -h</code> command displays usage information, including a list of all valid options for the <code>engine-iso-uploader</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="Syntax_for_the_engine-iso-uploader_Command">22.4.2. Syntax for the engine-iso-uploader Command</h4>
<div class="paragraph">
<p>The basic syntax for the ISO uploader command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-iso-uploader <em>options</em> list
# engine-iso-uploader <em>options</em> upload <em>file file file</em></pre>
</div>
</div>
<div class="paragraph">
<p>The ISO uploader command supports two actions - <code>list</code>, and <code>upload</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>list</code> action lists the ISO storage domains to which ISO files can be uploaded. The oVirt Engine creates this list on the machine on which the Engine is installed during the installation process.</p>
</li>
<li>
<p>The <code>upload</code> action uploads a single ISO file or multiple ISO files separated by spaces to the specified ISO storage domain. NFS is used by default, but SSH is also available.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you use SSH, you are prompted multiple times to enter the SSH user password. You can avoid these prompts by uploading the public SSH key to the iso domain server before uploading an ISO file, and then using the <code>--key-file=<em>KEYFILE</em></code> option. One way to upload the public SSH key is to use the <code>ssh-copy-id -i ~/.ssh/<em>mykey</em> <em>user@host</em></code> command.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You must specify one of the above actions when you use the ISO uploader command. Moreover, you must specify at least one local file to use the <code>upload</code> action.</p>
</div>
<div class="paragraph">
<p>There are several parameters to further refine the <code>engine-iso-uploader</code> command.</p>
</div>
<div class="paragraph">
<p><strong>General Options</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>--version</code></strong></dt>
<dd>
<p>Displays the version of the ISO uploader command.</p>
</dd>
<dt class="hdlist1"><strong><code>-h</code>, <code>--help</code></strong></dt>
<dd>
<p>Displays information on how to use the ISO uploader command.</p>
</dd>
<dt class="hdlist1"><strong><code>--conf-file=<em>PATH</em></code></strong></dt>
<dd>
<p>Sets <em>PATH</em> as the configuration file the command will to use. The default is <strong>/etc/ovirt-engine/isouploader.conf</strong>.</p>
</dd>
<dt class="hdlist1"><strong><code>--log-file=<em>PATH</em></code></strong></dt>
<dd>
<p>Sets <em>PATH</em> as the specific file name the command will use to write log output. The default is <strong>/var/log/ovirt-engine/ovirt-iso-uploader/ovirt-iso-uploader<em>_date</em>.log</strong>.</p>
</dd>
<dt class="hdlist1"><strong><code>--cert-file=<em>PATH</em></code></strong></dt>
<dd>
<p>Sets <em>PATH</em> as the certificate for validating the engine. The default is <strong>/etc/pki/ovirt-engine/ca.pem</strong>.</p>
</dd>
<dt class="hdlist1"><strong><code>--insecure</code></strong></dt>
<dd>
<p>Specifies that no attempt will be made to verify the engine.</p>
</dd>
<dt class="hdlist1"><strong><code>--nossl</code></strong></dt>
<dd>
<p>Specifies that SSL will not be used to connect to the engine.</p>
</dd>
<dt class="hdlist1"><strong><code>--quiet</code></strong></dt>
<dd>
<p>Sets quiet mode, reducing console output to a minimum.</p>
</dd>
<dt class="hdlist1"><strong><code>-v</code>, <code>--verbose</code></strong></dt>
<dd>
<p>Sets verbose mode, providing more console output.</p>
</dd>
<dt class="hdlist1"><strong><code>-f</code>, <code>--force</code></strong></dt>
<dd>
<p>Force mode is necessary when the source file being uploaded has the same file name as an existing file in the destination ISO domain. This option forces the existing file to be overwritten.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>oVirt Engine Options</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>-u <em>USER</em></code>, <code>--user=<em>USER</em></code></strong></dt>
<dd>
<p>Specifies the user whose credentials will be used to execute the command. The <em>USER</em> is specified in the format <em>username</em>@<em>domain</em>. The user must exist in the specified domain and be known to the oVirt Engine.</p>
</dd>
<dt class="hdlist1"><strong><code>-r <em>FQDN</em></code>, <code>--engine=<em>FQDN</em></code></strong></dt>
<dd>
<p>Specifies the IP address or fully qualified domain name of the oVirt Engine from which the images will be uploaded. It is assumed that the image uploader is being run from the same machine on which the oVirt Engine is installed. The default value is <code>localhost:443</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>ISO Storage Domain Options</strong></p>
</div>
<div class="paragraph">
<p>The following options specify the ISO domain to which the images will be uploaded. These options cannot be used together; you must used either the <code>-i</code> option or the <code>-n</code> option.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>-i</code>, <code>--iso-domain=<em>ISODOMAIN</em></code></strong></dt>
<dd>
<p>Sets the storage domain <em>ISODOMAIN</em> as the destination for uploads.</p>
</dd>
<dt class="hdlist1"><strong><code>-n</code>, <code>--nfs-server=<em>NFSSERVER</em></code></strong></dt>
<dd>
<p>Sets the NFS path <em>NFSSERVER</em> as the destination for uploads.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><strong>Connection Options</strong></p>
</div>
<div class="paragraph">
<p>The ISO uploader uses NFS as default to upload files. These options specify SSH file transfer instead.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>--ssh-user=<em>USER</em></code></strong></dt>
<dd>
<p>Sets <em>USER</em> as the SSH user name to use for the upload. The default is <code>root</code>.</p>
</dd>
<dt class="hdlist1"><strong><code>--ssh-port=<em>PORT</em></code></strong></dt>
<dd>
<p>Sets <em>PORT</em> as the port to use when connecting to SSH.</p>
</dd>
<dt class="hdlist1"><strong><code>-k <em>KEYFILE</em></code>, <code>--key-file=<em>KEYFILE</em></code></strong></dt>
<dd>
<p>Sets <em>KEYFILE</em> as the private key to use for SSH authentication. If you don&#8217;t set a key, you are prompted to enter the password of the user specified by <code>--ssh-user=<em>USER</em></code>. You must upload the public SSH key to the ISO domain server before uploading an ISO file. One way to do this is to use the <code>ssh-copy-id -i ~/.ssh/<em>mykey</em> <em>user@host</em></code> command.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Specifying_an_NFS_Server">22.4.3. Specifying an NFS Server</h4>
<div class="exampleblock">
<div class="title">Example 27. Uploading to an NFS Server</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># <code>engine-iso-uploader --nfs-server=<em>storage.demo.redhat.com:/iso/path</em> upload <em>RHEL6.0.iso</em></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Basic_ISO_Uploader_Usage">22.4.4. Basic ISO Uploader Usage</h4>
<div class="paragraph">
<p>The example below demonstrates the ISO uploader and the list parameter. The first command lists the available ISO storage domains; the <code>admin@internal</code> user is used because no user was specified in the command. The second command uploads an ISO file over NFS to the specified ISO domain.</p>
</div>
<div class="exampleblock">
<div class="title">Example 28. List Domains and Upload Image</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="nowrap"># <code>engine-iso-uploader list</code>
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):
ISO Storage Domain Name   | Datacenter          | ISO Domain Status
ISODomain                 | Default             | active</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># <code>engine-iso-uploader --iso-domain=<em>[ISODomain]</em> upload <em>[RHEL6.iso]</em></code>
Please provide the REST API password for the admin@internal oVirt Engine user (CTRL+D to abort):</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="Uploading_the_VirtIO_and_Guest_Tool_Image_Files_to_an_ISO_Storage_Domain">22.4.5. Uploading the VirtIO and guest tool image files to a storage domain</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The ISO domain is a deprecated storage domain type. The ISO Uploader tool has been removed in oVirt 4.4. oVirt recommends uploading ISO images to the data domain with the Administration Portal or with the REST API. See <a href="#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>virtio-win<em>_version</em>.iso</code> image contains the following for Windows virtual machines to improve performance and usability:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VirtIO drivers</p>
</li>
<li>
<p>an installer for the guest agents</p>
</li>
<li>
<p>an installer for the drivers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To install and upload the most recent version of <code>virtio-win<em>_version</em>.iso</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the image files on the Engine machine:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf -y install virtio-win</pre>
</div>
</div>
<div class="paragraph">
<p>After you install it on the Engine machine, the image file is <code class="filename">/usr/share/virtio-win/virtio-win<em>_version</em>.iso</code></p>
</div>
</li>
<li>
<p>Upload the image file to a data storage domain that was not created locally during installation. For more information, see <a href="https://ovirt.org/documentation/administration_guide/index#Uploading_Images_to_a_Data_Storage_Domain_storage_tasks">Uploading Images to a Data Storage Domain</a> in the <em>Administration Guide</em>.</p>
</li>
<li>
<p>Attach the image file to virtual machines.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The virtual machines can now use the virtio drivers and agents.</p>
</div>
<div class="paragraph">
<p>For information on attaching the image files to a virtual machine, see <a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#Installing_the_Guest_Agents_and_Drivers_on_Windows">Installing the Guest Agents, Tools, and Drivers on Windows</a> in the <em>Virtual Machine Management Guide</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-The_Engine_Vacuum_Tool">22.5. The Engine Vacuum Tool</h3>
<div class="sect3">
<h4 id="The_Engine_Vacuum_Tool">22.5.1. The Engine Vacuum Tool</h4>
<div class="paragraph">
<p>The Engine Vacuum tool maintains PostgreSQL databases by updating tables and removing dead rows, allowing disk space to be reused. See the <a href="https://www.postgresql.org/docs/10/sql-vacuum.html">PostgreSQL documentation</a> for information about the <code>VACUUM</code> command and its parameters.</p>
</div>
<div class="paragraph">
<p>The Engine Vacuum command is <code>engine-vacuum</code>. You must log in as the <strong>root</strong> user and provide the administration credentials for the oVirt environment.</p>
</div>
<div class="paragraph">
<p>Alternatively, the Engine Vacuum tool can be run while using the <code>engine-setup</code> command to customize an existing installation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ engine-setup
...
[ INFO  ] Stage: Environment customization
...
Perform full vacuum on the engine database engine@localhost?
This operation may take a while depending on this setup health and the
configuration of the db vacuum process.
See https://www.postgresql.org/docs/12/static/sql-vacuum.html
(Yes, No) [No]:</pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Yes</strong> option runs the Engine Vacuum tool in full vacuum verbose mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="Engine_Vacuum_Modes">22.5.2. Engine Vacuum Modes</h4>
<div class="paragraph">
<p>Engine Vacuum has two modes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Standard Vacuum</strong></dt>
<dd>
<p>Frequent standard vacuuming is recommended.</p>
<div class="paragraph">
<p>Standard vacuum removes dead row versions in tables and indexes and marks the space as available for future reuse. Frequently updated tables should be vacuumed on a regular basis. However, standard vacuum does not return the space to the operating system.</p>
</div>
<div class="paragraph">
<p>Standard vacuum, with no parameters, processes every table in the current database.</p>
</div>
</dd>
<dt class="hdlist1"><strong>Full Vacuum</strong></dt>
<dd>
<p>Full vacuum is not recommended for routine use, but should only be run when a significant amount of space needs to be reclaimed from within the table.</p>
<div class="paragraph">
<p>Full vacuum compacts the tables by writing a new copy of the table file with no dead space, thereby enabling the operating system to reclaim the space. Full vacuum can take a long time.</p>
</div>
<div class="paragraph">
<p>Full vacuum requires extra disk space for the new copy of the table, until the operation completes and the old copy is deleted. Because full vacuum requires an exclusive lock on the table, it cannot be run in parallel with other uses of the table.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="Syntax_for_the_engine-vacuum_Command">22.5.3. Syntax for the engine-vacuum Command</h4>
<div class="paragraph">
<p>The basic syntax for the <code>engine-vacuum</code> command is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-vacuum</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-vacuum <em>option</em></pre>
</div>
</div>
<div class="paragraph">
<p>Running the <code>engine-vacuum</code> command with no options performs a standard vacuum.</p>
</div>
<div class="paragraph">
<p>There are several parameters to further refine the <code>engine-vacuum</code> command.</p>
</div>
<div class="paragraph">
<p><strong>General Options</strong></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong><code>-h</code> <code>--help</code></strong></dt>
<dd>
<p>Displays information on how to use the <code>engine-vacuum</code> command.</p>
</dd>
<dt class="hdlist1"><strong><code>-a</code></strong></dt>
<dd>
<p>Runs a standard vacuum, analyzes the database, and updates the optimizer statistics.</p>
</dd>
<dt class="hdlist1"><strong><code>-A</code></strong></dt>
<dd>
<p>Analyzes the database and updates the optimizer statistics, without vacuuming.</p>
</dd>
<dt class="hdlist1"><strong><code>-f</code></strong></dt>
<dd>
<p>Runs a full vacuum.</p>
</dd>
<dt class="hdlist1"><strong><code>-v</code></strong></dt>
<dd>
<p>Runs in verbose mode, providing more console output.</p>
</dd>
<dt class="hdlist1"><strong><code>-t <em>table_name</em></code></strong></dt>
<dd>
<p>Vacuums a specific table or tables.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-vacuum -f -v -t vm_dynamic -t vds_dynamic</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect-The_VDSM_To_Network_Name_Tool">22.6. The VDSM to Network Name Mapping Tool</h3>
<div class="sect3">
<h4 id="Vdsm_To_Network_Mapping_Tool">22.6.1. Mapping VDSM Names to Logical Network Names</h4>
<div class="paragraph">
<p>If the name of a logical network is longer than 15 characters or contains non-ASCII characters, the system automatically generates an on-host identifier (<em>vdsm_name</em>) name; it comprises the letters <em>on</em> and the first 13 characters of the network&#8217;s unique identifier, for example, <code>ona1b2c3d4e5f6g</code>. It is this name that appears in the host&#8217;s log files. To view a list of logical network names and their auto-generated network name, use the  VDSM-to-Network-Name Mapping tool located in <code>/usr/share/ovirt-engine/bin/</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>The first time you run the tool, define a PASSWORD environment variable, which is the password of a database user with read access to the Engine database.
For example, run:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># export PASSWORD=<em>DatabaseUserPassword</em></pre>
</div>
</div>
</li>
<li>
<p>Run the VDSM-to-Network-Name Mapping tool:</p>
<div class="listingblock">
<div class="content">
<pre># vdsm_to_network_name_map  --user USER</pre>
</div>
</div>
<div class="paragraph">
<p>where <em>USER</em> is the database user with read access to the Engine database, whose password is assigned to the PASSWORD environment variable.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The tool displays a list of logical network names that are mapped to their equivalent on-host identifiers.</p>
</div>
<div class="paragraph">
<div class="title">Additional Flags</div>
<p>You can run the tool with the following flags:</p>
</div>
<div class="paragraph">
<p><code>--host</code> is the hostname/IP address of the database server. The default value is <code>localhost</code>.</p>
</div>
<div class="paragraph">
<p><code>--port</code> is the port number of the database server. The default value is <code>5432</code>.
<code>--database</code> is the name of the database. The default value is <code>engine</code>, which is the Engine database.</p>
</div>
<div class="paragraph">
<p><code>--secure</code> enables a secure connection with the database. By default the tool is run without a secure connection.</p>
</div>
</div>
</div>
</div>
</div>
<h1 id="part-Gathering_Information_About_the_Environment" class="sect0">Gathering Information About the Environment</h1>
<div class="sect1">
<h2 id="monitoring_and_observability">23. Monitoring and observability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides a number of ways to monitor and obtain metrics and logs from your oVirt system. These methods include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Using Data Warehouse and Grafana to monitor oVirt</strong></p>
</li>
<li>
<p><strong>Sending metrics to a remote instance of Elasticsearch</strong></p>
</li>
<li>
<p><strong>Deploying Insights in Red Hat Virtualization Manager</strong></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="using-data-warehouse-and-grafana-to-monitor-ovirt">23.1. Using Data Warehouse and Grafana to monitor oVirt</h3>
<div class="sect3">
<h4 id="grafana">23.1.1. Grafana</h4>
<div id="Grafana_overview" class="paragraph">
<p>Grafana is a web-based UI tool used to display reports based on data collected from the oVirt Data Warehouse PostgreSQL database under the database name <code>ovirt_engine_history</code>. See <a href="https://grafana.com/grafana/dashboards">Grafana dashboards</a>.</p>
</div>
<div class="paragraph">
<p>Data from the Engine is collected every minute and aggregated in hourly and daily aggregations. The data is retained according to the scale setting defined in the Data Warehouse configuration during engine-setup (Basic or Full scale):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Basic</strong> (default) - samples data saved for 24 hours, hourly data saved for 1 month, daily data - no daily aggregations saved.</p>
</li>
<li>
<p><strong>Full</strong> (recommended)- samples data saved for 24 hours, hourly data saved for 2 months, daily aggregations saved for 5 years.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Full sample scaling may require migrating the Data Warehouse to a separate virtual machine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For Data Warehouse scaling instructions, see <a href="https://ovirt.org/documentation/data_warehouse_guide/index#Changing_the_Data_Warehouse_Sampling_Scale">Changing the Data Warehouse Sampling Scale</a>.</p>
</li>
<li>
<p>For instructions on migrating the Data Warehouse to or installing on a separate machine,
see <a href="https://ovirt.org/documentation/data_warehouse_guide/index#Migrating_Data_Warehouse_to_a_Separate_Machine_DWH_admin">Migrating Data Warehouse to a Separate Machine</a>
and <a href="https://ovirt.org/documentation/data_warehouse_guide/index#Installing_and_Configuring_Data_Warehouse_on_a_Separate_Machine_DWH_admin">Installing and Configuring Data Warehouse on a Separate Machine</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>oVirt only supports installing the Data Warehouse database, the Data Warehouse service and Grafana all on the same machine as each other, even though you can install each of these components on separate machines from each other.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="configuring-grafana">23.1.2. Configuring Grafana</h4>
<div id="Configure_grafana" class="paragraph">
<div class="title">Installation</div>
<p>Grafana integration is enabled and installed by default when you run oVirt Engine <code>engine-setup</code> in a Stand Alone Manager installation, and in the Self-Hosted engine installation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Grafana is not installed by default and you may need to install it manually under some scenarios such as performing an upgrade from an earlier version of oVirt, restoring a backup, or when the Data Warehouse is migrated to a separate machine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable Grafana integration manually:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put the environment in global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Log in to the machine where you want to install Grafana. This should be the same machine where the Data Warehouse is configured; usually the Engine machine.</p>
</li>
<li>
<p>Run the <code>engine-setup</code> command as follows:</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup --reconfigure-optional-components</pre>
</div>
</div>
</li>
<li>
<p>Answer <code>Yes</code> to install Grafana on this machine:</p>
<div class="listingblock">
<div class="content">
<pre>Configure Grafana on this host (Yes, No) [Yes]:</pre>
</div>
</div>
</li>
<li>
<p>Disable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To access the Grafana dashboards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go to <code>https://&lt;engine FQDN or IP address&gt;/ovirt-engine-grafana</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click <strong>Monitoring Portal</strong> in the web administration welcome page for the <strong>Administration Portal</strong>.</p>
</li>
</ul>
</div>
<div id="Configure_grafana_SSO" class="paragraph">
<div class="title">Configuring Grafana for Single Sign-on</div>
<p>The Engine engine-setup automatically configures Grafana to allow existing users on the Engine to log in with SSO from the Administration Portal, but does not automatically create users. You need to create new users (<code>Invite</code> in the Grafana UI), confirm the new user, and then they can log in.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set an email address for the user in the Engine, if it is not already defined.</p>
</li>
<li>
<p>Log in to Grafana with an existing admin user (the initially configured admin).</p>
</li>
<li>
<p>Go to <span class="menuseq"><b class="menu">Configuration</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Users</b></span> and select <b class="button">Invite</b>.</p>
</li>
<li>
<p>Input the email address and name, and select a Role.</p>
</li>
<li>
<p>Send the invitation using one of these options:</p>
<div class="ulist">
<ul>
<li>
<p>Select <b class="button">Send invite mail</b> and click <b class="button">Submit</b>. For this option, you need an operational local mail server configured on the Grafana machine.</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Select <b class="button">Pending Invites</b></p>
<div class="ulist">
<ul>
<li>
<p>Locate the entry you want</p>
</li>
<li>
<p>Select <b class="button">Copy invite</b></p>
</li>
<li>
<p>Copy and use this link to create the account by pasting it directly into a browser address bar, or by sending it to another user.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you use the Pending Invites option, no email is sent, and the email address does not really need to exist - any valid looking address will work, as long as its configured as the email address of a Engine user.</p>
</div>
<div class="olist arabic">
<div class="title">To log in with this account:</div>
<ol class="arabic">
<li>
<p>Log in to the oVirt web administration welcome page using the account that has this email address.</p>
</li>
<li>
<p>Select <code>Monitoring Portal</code> to open the Grafana dashboard.</p>
</li>
<li>
<p>Select <b class="button">Sign in with oVirt Engine Auth</b>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="grafana-dashboards">23.1.3. Grafana dashboards</h4>
<div id="Grafana_dashboards" class="paragraph">
<div class="title">Built-in Grafana dashboards</div>
<p>The following dashboards are available in the initial Grafana setup to report Data Center, Cluster, Host, and Virtual Machine data:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. Built-in Grafana dashboards</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Dashboard type</th>
<th class="tableblock halign-left valign-top">Content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Executive dashboards</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>System dashboard - resource usage and up-time for hosts and storage domains in the system, according to the latest configurations.</p>
</li>
<li>
<p>Data Center dashboard - resource usage, peaks, and up-time for clusters, hosts, and storage domains in a selected data center, according to the latest configurations.</p>
</li>
<li>
<p>Cluster dashboard - resource usage, peaks, over-commit, and up-time for hosts and virtual machines in a selected cluster, according to the latest configurations.</p>
</li>
<li>
<p>Host dashboard - latest and historical configuration details and resource usage metrics of a selected host over a selected period.</p>
</li>
<li>
<p>Virtual Machine dashboard - latest and historical configuration details and resource usage metrics of a selected virtual machine over a selected period.</p>
</li>
<li>
<p>Executive dashboard - user resource usage and number of operating systems for hosts and virtual machines in selected clusters over a selected period.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Inventory dashboards</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Inventory dashboard - number of hosts, virtual machines, and running virtual machines, resources usage and over-commit rates for selected data centers, according to the latest configurations.</p>
</li>
<li>
<p>Hosts Inventory dashboard - FQDN, VDSM version, operating system, CPU model, CPU cores, memory size, create date, delete date, and hardware details for selected hosts, according to the latest configurations.</p>
</li>
<li>
<p>Storage Domains Inventory dashboard - domain type, storage type, available disk size, used disk size, total disk size, creation date, and delete date for selected storage domains over a selected period.</p>
</li>
<li>
<p>Virtual Machines Inventory dashboard - template name, operating system, CPU cores, memory size, create date, and delete date for selected virtual machines, according to the latest configurations.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Service Level dashboards</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Uptime dashboard - planned downtime, unplanned downtime, and total time for the hosts, high availability virtual machines, and all virtual machines in selected clusters in a selected period.</p>
</li>
<li>
<p>Hosts Uptime dashboard - the uptime, planned downtime, and unplanned downtime for selected hosts in a selected period.</p>
</li>
<li>
<p>Virtual Machines Uptime dashboard - the uptime, planned downtime, and unplanned downtime for selected virtual machines in a selected period.</p>
</li>
<li>
<p>Cluster Quality of Service</p>
<div class="ulist">
<ul>
<li>
<p>Hosts dashboard - the time selected hosts have performed above and below the CPU and memory threshold in a selected period.</p>
</li>
<li>
<p>Virtual Machines dashboard - the time selected virtual machines have performed above and below the CPU and memory threshold in a selected period.</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trend dashboards</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Trend dashboard - usage rates for the 5 most and least utilized virtual machines and hosts by memory and by CPU in selected clusters over a selected period.</p>
</li>
<li>
<p>Hosts Trend dashboard - resource usage (number of virtual machines, CPU, memory, and network Tx/Rx) for selected hosts over a selected period.</p>
</li>
<li>
<p>Virtual Machines Trend dashboard -resource usage (CPU, memory, network Tx/Rx, disk I/O) for selected virtual machines over a selected period.</p>
</li>
<li>
<p>Hosts Resource Usage dashboard - daily and hourly resource usage (number of virtual machines, CPU, memory, network Tx/Rx) for selected hosts in a selected period.</p>
</li>
<li>
<p>Virtual Machines Resource Usage dashboard - daily and hourly resource usage (CPU, memory, network Tx/Rx, disk I/O) for selected virtual machines in a selected period.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Customized Grafana dashboards</div>
<p>You can create customized dashboards or copy and modify existing dashboards according to your reporting needs.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Built-in dashboards cannot be customized.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sending-metrics-and-logs-to-a-remote-instance-of-elasticsearch">23.2. Sending metrics and logs to a remote instance of Elasticsearch</h3>
<div id="Sending_metrics_to_ELK" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat does not own or maintain Elasticsearch. You need to have a working familiarity with Elasticsearch setup and maintenance to deploy this option.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure the oVirt Engine and hosts to send metrics data and logs to your existing Elasticsearch instance.</p>
</div>
<div class="paragraph">
<p>To do this, run the Ansible role that configures <code>collectd</code> and <code>rsyslog</code> on the Engine and all hosts to collect <code>engine.log</code>, <code>vdsm.log</code>, and <code>collectd</code> metrics, and send them to your Elasticsearch instance.</p>
</div>
<div class="sect3">
<h4 id="installing-collectd-and-rsyslog">23.2.1. Installing collectd and rsyslog</h4>
<div id="Install_collectd_and_rsyslog" class="paragraph">
<p>Deploy <code>collectd</code> and <code>rsyslog</code> on the hosts to collect logs and metrics.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You do not need to repeat this procedure for new hosts. Every new host that is added is automatically configured by the Engine to send the data to Elasticsearch during host-deploy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine using SSH.</p>
</li>
<li>
<p>Copy <code>/etc/ovirt-engine-metrics/config.yml.example</code> to create <code>/etc/ovirt-engine-metrics/config.yml.d/config.yml</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /etc/ovirt-engine-metrics/config.yml.example /etc/ovirt-engine-metrics/config.yml.d/config.yml</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>ovirt_env_name</code> and <code>elasticsearch_host</code> parameters in <code>config.yml</code> and save the file. The following additional parameters can be added to the file:</p>
<div class="listingblock">
<div class="content">
<pre>use_omelasticsearch_cert: false
rsyslog_elasticsearch_usehttps_metrics: !!str off
rsyslog_elasticsearch_usehttps_logs: !!str off</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>When using certificates, set <code>use_omelasticsearch_cert</code> to <strong>true</strong>.</p>
</li>
<li>
<p>To disable logs or metrics, use the <code>rsyslog_elasticsearch_usehttps_metrics</code> and/or <code>rsyslog_elasticsearch_usehttps_logs</code> parameters.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Deploy <code>collectd</code> and <code>rsyslog</code> on the hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># /usr/share/ovirt-engine-metrics/setup/ansible/configure_ovirt_machines_for_metrics.sh</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>configure_ovirt_machines_for_metrics.sh</code> script runs an Ansible role that includes <code>linux-system-roles</code> (see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/administration_and_configuration_tasks_using_system_roles_in_rhel/index">Administration and configuration tasks using System Roles in RHEL</a>) and uses it to deploy and configure <code>rsyslog</code> on the host. <code>rsyslog</code> collects metrics from <code>collectd</code> and sends them to Elasticsearch.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, including a full list with explanations of available Metrics Schema, see <a href="https://access.redhat.com/articles/4921101">Sending RHV monitoring data to a remote Elasticsearch instance</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="logging-schema-and-analyzing-logs">23.2.2. Logging schema and analyzing logs</h4>
<div id="Logging_schema" class="paragraph">
<p>Use the <strong>Discover</strong> page to interactively explore data collected from oVirt. Each set of results that is collected is referred to as a <strong>document</strong>. Documents are collected from the following log files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>engine.log</code> - contains all oVirt Engine UI crashes, Active Directory lookups, database issues, and other events.</p>
</li>
<li>
<p><code>vdsm.log</code> - the log file for the VDSM, the Engine&#8217;s agent on the virtualization hosts, and contains host-related events.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following fields are available:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The unique ID of the document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the index to which the document belongs. The index with the <code>project.ovirt-logs</code> prefix is the only relevant index in the Discover page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hostname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the engine.log this is the hostname of the Engine. For the vdsm.log this is the hostname of the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">level</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log record severity: TRACE, DEBUG, INFO, WARN, ERROR, FATAL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The body of the document message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a Java class that produced this log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.correlationid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the engine.log only. This ID is used to correlate the multiple parts of a single task performed by the Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.thread</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of a Java thread inside which the log record was produced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Predefined sets of metadata that can be used to filter the data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The [time](Troubleshooting#information-is-missing-from-kibana) that the record was issued.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ipaddr4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The machine&#8217;s IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.cluster_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the vdsm.log only. The name of the cluster to which the host belongs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.engine_fqdn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Engine&#8217;s FQDN.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ovirt.module_lineno</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file and line number within the file that ran the command defined in <code>ovirt.class</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chap-Log_Files">24. Log Files</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Manager_Installation_Log_Files">24.1. Engine Installation Log Files</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. Installation</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/engine-cleanup<em>_yyyy_mm_dd_hh_mm_ss</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log from the <code>engine-cleanup</code> command. This is the command used to reset a oVirt Engine installation. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/engine-db-install-<em>yyyy_mm_dd_hh_mm_ss</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log from the <code>engine-setup</code> command detailing the creation and configuration of the <strong>engine</strong> database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/ovirt-engine-dwh-setup-<em>yyyy_mm_dd_hh_mm_ss</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log from the <code>ovirt-engine-dwh-setup</code> command. This is the command used to create the <strong>ovirt_engine_history</strong> database for reporting. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist concurrently.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/setup/ovirt-engine-setup-<em>yyyymmddhhmmss</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log from the <code>engine-setup</code> command. A log is generated each time the command is run. The date and time of the run is used in the filename to allow multiple logs to exist concurrently.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Manager_Log_Files">24.2. oVirt Engine Log Files</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 76. Service Activity</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/engine.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reflects all oVirt Engine GUI crashes, Active Directory lookups, Database issues, and other events.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovirt-engine/host-deploy</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log files from hosts deployed from the oVirt Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/lib/ovirt-engine/setup-history.txt</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tracks the installation and upgrade of packages associated with the oVirt Engine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/httpd/ovirt-requests-log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs files from requests made to the oVirt Engine via HTTPS, including how long each request took.</p>
<p class="tableblock">A <code>Correlation-Id</code> header is included to allow you to compare requests when comparing a log file with <strong>/var/log/ovirt-engine/engine.log</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/ovn-provider/ovirt-provider-ovn.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs the activities of the OVN provider.
For information about Open vSwitch logs, see the <a href="http://openvswitch.org">Open vSwitch documentation</a>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="sect-SPICE_Log_Files">24.3. SPICE Log Files</h3>
<div class="paragraph">
<p>SPICE log files are useful when troubleshooting SPICE connection issues. To start SPICE debugging, change the log level to <code>debugging</code>. Then, identify the log location.</p>
</div>
<div class="paragraph">
<p>Both the clients used to access the guest machines and the guest machines themselves have SPICE log files. For client-side logs, if a SPICE client was launched using the native client, for which a <strong>console.vv</strong> file is downloaded, use the <code>remote-viewer</code> command to enable debugging and generate log output.</p>
</div>
<div class="sect3">
<h4 id="SPICE_Logs_for_Hypervisor_SPICE_Servers">24.3.1. SPICE Logs for Hypervisor SPICE Servers</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. SPICE Logs for Hypervisor SPICE Servers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log Type</th>
<th class="tableblock halign-left valign-top">Log Location</th>
<th class="tableblock halign-left valign-top">To Change Log Level:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host/Hypervisor SPICE Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/var/log/libvirt/qemu/(guest_name).log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run <code>export SPICE_DEBUG_LEVEL=5</code> on the host/hypervisor prior to launching the guest. This variable is parsed by QEMU, and if run system-wide will print the debugging information of all virtual machines on the system. This command must be run on each host in the cluster. This command works only on a per-host/hypervisor basis, not a per-cluster basis.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="SPICE_Logs_for_Guest_Machines">24.3.2. SPICE Logs for Guest Machines</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 78. spice-vdagent Logs for Guest Machines</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log Type</th>
<th class="tableblock halign-left valign-top">Log Location</th>
<th class="tableblock halign-left valign-top">To Change Log Level:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Windows Guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C:\Windows\Temp\vdagent.log</p>
<p class="tableblock">C:\Windows\Temp\vdservice.log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not applicable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise Linux Guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>journalctl</code> as the root user.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>To run the <code>spice-vdagentd</code> service in debug mode, as the root user create a <strong>/etc/sysconfig/spice-vdagentd</strong> file with this entry: <code>SPICE_VDAGENTD_EXTRA_ARGS=-d -d</code></p>
</div>
<div class="paragraph">
<p>To run <code>spice-vdagent</code> in debug mode, from the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ killall - u $USER spice-vdagent
$ spice-vdagent -x -d [-d] [ |&amp; tee spice-vdagent.log ]</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="SPICE_Logs_for_SPICE_Clients_Launched_Using_consolevv_Files">24.3.3. SPICE Logs for SPICE Clients Launched Using console.vv Files</h4>
<div class="paragraph">
<p><strong>For Linux client machines:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable SPICE debugging by running the <code>remote-viewer</code> command with the <code>--spice-debug</code> option. When prompted, enter the connection URL, for example, spice://<em>virtual_machine_IP</em>:<em>port</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#  remote-viewer --spice-debug</pre>
</div>
</div>
</li>
<li>
<p>To run SPICE client with the debug parameter and to pass a .vv file to it, download the <strong>console.vv</strong> file and run the <code>remote-viewer</code> command with the <code>--spice-debug</code> option and specify the full path to the <strong>console.vv</strong> file.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># remote-viewer --spice-debug <em>/path/to/</em>console.vv</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>For Windows client machines:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In versions of <code>virt-viewer</code> 2.0-11.el7ev and later, <strong>virt-viewer.msi</strong> installs <code>virt-viewer</code> and <code>debug-viewer.exe</code>.</p>
</li>
<li>
<p>Run the <code>remote-viewer</code> command with the <code>spice-debug</code> argument and direct the command at the path to the console:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">remote-viewer --spice-debug <em>path\to\</em>console.vv</pre>
</div>
</div>
</li>
<li>
<p>To view logs, connect to the virtual machine, and you will see a command prompt running GDB that prints standard output and standard error of <code>remote-viewer</code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="Host_Log_Files">24.4. Host Log Files</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Log File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/messages</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The log file used by <code>libvirt</code>. Use <code>journalctl</code> to view the log. You must be a member of the <em>adm</em>,
<em>systemd-journal</em>, or <em>wheel</em> groups to view the log.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/spm-lock.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file detailing the host&#8217;s ability to obtain a lease on the Storage Pool Manager role. The log details when the host has acquired, released, renewed, or failed to renew the lease.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/vdsm.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file for VDSM, the Engine&#8217;s agent on the host(s).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/tmp/ovirt-host-deploy-<em>Date</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A host deployment log that is copied to the Engine as <code>/var/log/ovirt-engine/host-deploy/ovirt-<em>Date-Host-Correlation_ID</em></code>.log after the host has been successfully deployed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/import/import-<em>UUID-Date</em>.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log file detailing virtual machine imports from a KVM host, a VMWare provider, or a RHEL 5 Xen host, including import failure information. <em>UUID</em> is the UUID of the virtual machine that was imported and <em>Date</em> is the date and time that the import began.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/supervdsm.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs VDSM tasks that were executed with superuser permissions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/upgrade.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VDSM uses this log file during host upgrades to log configuration changes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/var/log/vdsm/mom.log</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logs the activities of the VDSM&#8217;s memory overcommitment manager.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="proc-setting_up_debug_level_logging">24.5. Setting debug-level logging for oVirt services</h3>
<div class="paragraph">
<p>You can set the logs of the following oVirt (oVirt) services to debug-level by modifying the <code>sysconfig</code> file of each service.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 79. oVirt services and <code>sysconfig</code> file paths</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">File path</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-engine.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-engine</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-engine-dwhd.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-engine-dwhd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-fence-kdump-listener.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-fence-kdump-listener</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-websocket-proxy.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-websocket-proxy</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This modification affects logging done by the Python wrapper, not the main service process.</p>
</div>
<div class="paragraph">
<p>Setting logging to debug-level is useful for debugging issues related to start up - for example, if the main process fails to start due to a missing or incorrect Java runtime or library.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Verify that the <code>sysconfig</code> file you want to modify exists. If necessary, create it.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Add the following to the <code>sysconfig</code> file of the service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal">OVIRT_SERVICE_DEBUG=1</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the service:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="terminal"># systemctl restart &lt;service&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>sysconfig</code> log file of the service is now set to debug-level.</p>
</div>
<div class="paragraph">
<p>Logging caused by this setting goes to the system log, so the logs it generates can be found in <code>/var/log/messages</code>, not in the service-specific log file, or by using the <code>journalctl</code> command.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref_debug_level_logging">24.6. Main configuration files for oVirt services</h3>
<div class="paragraph">
<p>In addition to a <code>sysconfig</code> file, each of these oVirt (oVirt) services has another configuration file that is used more often.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 80. oVirt services and configuration files</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">sysconfig file path</th>
<th class="tableblock halign-left valign-top">Main configuration file</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-engine.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-engine</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/ovirt-engine/engine.conf.d/*.conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-engine-dwhd.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-engine-dwhd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/ovirt-engine-dwh/ovirt-engine-dwhd.conf.d/*.conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-fence-kdump-listener.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-fence-kdump-listener</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/ovirt-engine/ovirt-fence-kdump-listener.conf.d/*.conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ovirt-websocket-proxy.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/sysconfig/ovirt-websocket-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/etc/ovirt-engine/ovirt-websocket-proxy.conf.d/*.conf</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Setting_up_a_Host_Logging_Server">24.7. Setting Up a Host Logging Server</h3>
<div class="paragraph">
<p>Hosts generate and update log files, recording their actions and problems. Collecting these log files centrally simplifies debugging.</p>
</div>
<div class="paragraph">
<p>This procedure should be used on your centralized log server. You could use a separate logging server, or use this procedure to enable host logging on the oVirt Engine.</p>
</div>
<div class="paragraph">
<p><strong>Setting up a Host Logging Server</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check to see if the firewall allows traffic on the <code>UDP 514</code> port, and is open to <code>syslog</code> service traffic:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --query-service=syslog</pre>
</div>
</div>
<div class="paragraph">
<p>If the output is <code>no</code>, allow traffic on the <code>UDP 514</code> port with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --add-service=syslog --permanent
# firewall-cmd --reload</pre>
</div>
</div>
</li>
<li>
<p>Create a new <code>.conf</code> file on the syslog server, for example, <code>/etc/rsyslog.d/from_remote.conf</code>, and add the following lines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">template(name="DynFile" type="string" string="/var/log/%HOSTNAME%/%PROGRAMNAME%.log")
RuleSet(name="RemoteMachine"){  action(type="omfile" dynaFile="DynFile")  }
Module(load="imudp")
Input(type="imudp" port="514" ruleset="RemoteMachine")</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>rsyslog</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart rsyslog.service</pre>
</div>
</div>
</li>
<li>
<p>Log in to the hypervisor, and in the <code>/etc/rsyslog.conf</code> add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">*.info;mail.none;authpriv.none;cron.none @&lt;syslog-FQDN&gt;:514</pre>
</div>
</div>
</li>
<li>
<p>Restart the rsyslog service on the hypervisor.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart rsyslog.service</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your centralized log server is now configured to receive and store the <strong>messages</strong> and <strong>secure</strong> logs from your virtualization hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="Enabling_the_oVirt_Engine_Extension_Logger_log4j">24.8. Enabling the oVirt Engine Extension Logger log4j</h3>
<div class="paragraph">
<p>Logger implementation requires the ovirt-engine-extension-logger-log4j package. With the implementation, Red Had Virtualization Engine delegates records into log4j. Log4j is a customizable framework that provides appenders for various technologies, including SNMP and syslog.</p>
</div>
<div class="paragraph">
<p>The oVirt Engine Extension Logger log4j passes the <code>engine.log</code> files to an existing syslog server. The configuration procedure overlaps with <a href="https://ovirt.org/documentation/administration_guide/index#Setting_up_a_Host_Logging_Server">Setting up a Host Logging Server</a>.</p>
</div>
<div class="paragraph">
<p>Use this procedure on the central syslog server. You can use a separate logging server, or use this procedure to pass the <code>engine.log</code> files from the Engine to the syslog server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To define the syslog server for this extension, navigate to the <strong>/etc/ovirt-engine/extensions.d</strong> directory and edit the value for <code>log4j.appender.myappender.SyslogHost</code> in the <code>Log4jLogger.properties</code> file.</p>
</div>
<div class="paragraph">
<p>To define the syslog facility, navigate to the <strong>/etc/ovirt-engine/extensions.d</strong> directory and edit the value for <code>log4j.appender.myappender.Facility</code> in the <code>Log4jLogger.properties</code> file. For example, <code>log4j.appender.myappender.Facility=local1</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuring the oVirt Engine Extension Logger log4j</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the extension.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install ovirt-engine-extension-logger-log4j</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>Log4jLogger.properties</code> file in the <strong>/etc/ovirt-engine/extensions.d/</strong> directory and include the following contents.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ovirt.engine.extension.name = log4jlogger
ovirt.engine.extension.provides = org.ovirt.engine.api.extensions.logger.Logger
ovirt.engine.extension.bindings.method = jbossmodule
ovirt.engine.extension.binding.jbossmodule.module = org.ovirt.engine.extension.logger.log4j
ovirt.engine.extension.binding.jbossmodule.class = org.ovirt.engine.extension.logger.log4j.Log4jLogger
log4j.rootLogger=DEBUG, myappender
log4j.appender.myappender=org.apache.log4j.net.SyslogAppender
log4j.appender.myappender.SyslogHost=localhost
log4j.appender.myappender.layout=org.apache.log4j.PatternLayout
log4j.appender.myappender.layout.ConversionPattern=[%c] %m%n</pre>
</div>
</div>
</li>
<li>
<p>Install and configure rsyslog.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install rsyslog</pre>
</div>
</div>
</li>
<li>
<p>Configure SELinux to allow <code>rsyslog</code> traffic.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># semanage port -a -t syslogd_port_t -p udp 514</pre>
</div>
</div>
</li>
<li>
<p>Edit <strong>/etc/rsyslog.conf</strong> and add the following lines:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$template TmplAuth, "/var/log/%fromhost%/secure"
$template TmplMsg, "/var/log/%fromhost%/messages"

$RuleSet remote
authpriv.*   ?TmplAuth
*.info,mail.none;authpriv.none,cron.none   ?TmplMsg
$RuleSet RSYSLOG_DefaultRuleset
$InputUDPServerBindRuleset remote</pre>
</div>
</div>
</li>
<li>
<p>Uncomment the following two lines.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#$ModLoad imudp
#$UDPServerRun 514</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>rsyslog</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart rsyslog.service</pre>
</div>
</div>
</li>
<li>
<p>If the firewall is enabled and active, run the following command to add the necessary rules for opening the rsyslog ports in Firewalld.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --permanent --add-port=514/udp
# firewall-cmd --reload</pre>
</div>
</div>
</li>
<li>
<p>Restart oVirt Engine.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The existing syslog server can now receive and store the <code>engine.log</code> files.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-VDSM_and_Hooks">Appendix A: VDSM and Hooks</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="VDSM">VDSM</h3>
<div class="paragraph">
<p>The VDSM service is used by the oVirt Engine to manage oVirt Nodes (oVirt Node) and Enterprise Linux hosts. VDSM manages and monitors the host&#8217;s storage, memory and network resources. It also co-ordinates virtual machine creation, statistics gathering, log collection and other host administration tasks. VDSM is run as a daemon on each host managed by oVirt Engine. It answers XML-RPC calls from clients. The oVirt Engine functions as a VDSM client.</p>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks">VDSM Hooks</h3>
<div class="paragraph">
<p>VDSM is extensible via hooks. Hooks are scripts executed on the host when key events occur. When a supported event occurs VDSM runs any executable hook scripts in <strong>/usr/libexec/vdsm/hooks/<em>nn_event-name</em>/</strong> on the host in alphanumeric order. By convention each hook script is assigned a two digit number, included at the front of the file name, to ensure that the order in which the scripts will be run in is clear. You are able to create hook scripts in any programming language, Python will however be used for the examples contained in this chapter.</p>
</div>
<div class="paragraph">
<p>Note that all scripts defined on the host for the event are executed. If you require that a given hook is only executed for a subset of the virtual machines which run on the host then you must ensure that the hook script itself handles this requirement by evaluating the <strong>Custom Properties</strong> associated with the virtual machine.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>VDSM hooks can interfere with the operation of oVirt. A bug in a VDSM hook has the potential to cause virtual machine crashes and loss of data. VDSM hooks should be implemented with caution and tested rigorously. The Hooks API is new and subject to significant change in the future.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Extending_VDSM_with_hooks">Extending VDSM with Hooks</h3>
<div class="paragraph">
<p>This chapter describes how to extend VDSM with event-driven hooks. Extending VDSM with hooks is an experimental technology, and this chapter is intended for experienced developers. By setting custom properties on virtual machines it is possible to pass additional parameters, specific to a given virtual machine, to the hook scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc_installing-a-vdsm-hook">Installing a VDSM hook</h3>
<div class="paragraph _abstract">
<p>By default, VDSM hooks are not installed. If you need a specific hook, you must install it manually.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The host repository must be enabled.</p>
</li>
<li>
<p>You are logged into the host with root permissions.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Get a list of available hooks:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf list vdsm\*hook\*</pre>
</div>
</div>
</li>
<li>
<p>Install the desired VDSM hook package on the host:</p>
<div class="listingblock">
<div class="content">
<pre># dnf install &lt;vdsm-hook-name&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>For example, to install the <code>vdsm-hook-vhostmd</code> package on the host, enter the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># dnf install vdsm-hook-vhostmd</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/installing_red_hat_virtualization_as_a_self-hosted_engine_using_the_command_line/index#Enabling_the_RHVH_repository_SHE_cli_deploy">Enabling the oVirt Node Repository</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_red_hat_virtualization_as_a_self-hosted_engine_using_the_command_line/index#Enabling_the_Red_Hat_Enterprise_Linux_Host_Repositories_SHE_cli_deploy">Enabling the Enterprise Linux host Repositories</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Supported_VDSM_events">Supported VDSM Events</h3>
<table id="vdsm-hook-names" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 81. Supported VDSM Events</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine starts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine starts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_cont</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine continues.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_cont</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine continues.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_pause</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine pauses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_pause</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine pauses.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_hibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine hibernates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_hibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine hibernates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_dehibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine dehibernates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_dehibernate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine dehibernates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_migrate_source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine migration, run on the source host from which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_migrate_source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine migration, run on the source host from which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vm_migrate_destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before virtual machine migration, run on the destination host to which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_migrate_destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine migration, run on the destination host to which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vm_destroy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After virtual machine destruction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_vdsm_start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before VDSM is started on the host. <strong>before_vdsm_start</strong> hooks are executed as the user root, and do not inherit the environment of the VDSM process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_vdsm_stop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After VDSM is stopped on the host. <strong>after_vdsm_stop</strong> hooks are executed as the user root, and do not inherit the environment of the VDSM process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_nic_hotplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before the NIC is hot plugged into the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_nic_hotplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After the NIC is hot plugged into the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_nic_hotunplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before the NIC is hot unplugged from the virtual machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_nic_hotunplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After the NIC is hot unplugged from the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_nic_hotplug_fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After hot plugging the NIC to the virtual machine fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_nic_hotunplug_fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After hot unplugging the NIC from the virtual machine fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_disk_hotplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before the disk is hot plugged into the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_disk_hotplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After the disk is hot plugged into the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_disk_hotunplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before the disk is hot unplugged from the virtual machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_disk_hotunplug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After the disk is hot unplugged from the virtual machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_disk_hotplug_fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After hot plugging the disk to the virtual machine fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_disk_hotunplug_fail</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After hot unplugging the disk from the virtual machine fails.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_device_create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before creating a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_device_create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After creating a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_update_device</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before updating a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_update_device</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After updating a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_device_destroy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before destroying a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_device_destroy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After destroying a device that supports custom properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_device_migrate_destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before device migration, run on the destination host to which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_device_migrate_destination</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After device migration, run on the destination host to which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_device_migrate_source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before device migration, run on the source host from which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_device_migrate_source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After device migration, run on the source host from which the migration is occurring.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">after_network_setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">After setting up the network when starting a host machine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">before_network_setup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Before setting up the network when starting a host machine.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_environment">The VDSM Hook Environment</h3>
<div class="paragraph">
<p>Most hook scripts are run as the <strong>vdsm</strong> user and inherit the environment of the VDSM process. The exceptions are hook scripts triggered by the <strong>before_vdsm_start</strong> and <strong>after_vdsm_stop</strong> events. Hook scripts triggered by these events run as the <strong>root</strong> user and do not inherit the environment of the VDSM process.</p>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_domain_xml">The VDSM Hook Domain XML Object</h3>
<div class="paragraph">
<p>When hook scripts are started, the _hook_domxml variable is appended to the environment. This variable contains the path of the libvirt domain XML representation of the relevant virtual machine. Several hooks are an exception to this rule, as outlined below.
The _hook_domxml variable of the following hooks contains the XML representation of the NIC and not the virtual machine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*_nic_hotplug_*</p>
</li>
<li>
<p>*_nic_hotunplug_*</p>
</li>
<li>
<p>*_update_device</p>
</li>
<li>
<p>*_device_create</p>
</li>
<li>
<p>*_device_migrate_*</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>before_migration_destination</strong> and <strong>before_dehibernation</strong> hooks currently receive the XML of the domain from the source host. The XML of the domain at the destination will have various differences.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The libvirt domain XML format is used by VDSM to define virtual machines. Details on the libvirt domain XML format can be found at <a href="http://libvirt.org/formatdomain.html">http://libvirt.org/formatdomain.html</a>. The UUID of the virtual machine may be deduced from the domain XML, but it is also available as the environment variable vmId.</p>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_defining_custom_properties">Defining Custom Properties</h3>
<div class="paragraph">
<p>The custom properties that are accepted by the oVirt Engine - and in turn passed to custom hooks - are defined using the <code>engine-config</code> command. Run this command as the <strong>root</strong> user on the host where oVirt Engine is installed.</p>
</div>
<div class="paragraph">
<p>The <code>UserDefinedVMProperties</code> and <code>CustomDeviceProperties</code> configuration keys are used to store the names of the custom properties supported. Regular expressions defining the valid values for each named custom property are also contained in these configuration keys.</p>
</div>
<div class="paragraph">
<p>Multiple custom properties are separated by a semi-colon. Note that when setting the configuration key, any existing value it contained is overwritten. When combining new and existing custom properties, all of the custom properties in the command used to set the key&#8217;s value must be included.</p>
</div>
<div class="paragraph">
<p>Once the configuration key has been updated, the <strong>ovirt-engine</strong> service must be restarted for the new values to take effect.</p>
</div>
<div class="exampleblock">
<div class="title">Example 29. Virtual Machine Properties - Defining the <code>smartcard</code> Custom Property</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the existing custom properties defined by the <code>UserDefinedVMProperties</code> configuration key using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g UserDefinedVMProperties</pre>
</div>
</div>
<div class="paragraph">
<p>As shown by the output below, the custom property <code>memory</code> is already defined. The regular expression <code>^[0-9]+$</code> ensures that the custom property will only ever contain numeric characters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g UserDefinedVMProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : memory=^[0-9]+$ version: 4.4</pre>
</div>
</div>
</li>
<li>
<p>Because the <code>memory</code> custom property is already defined in the <code>UserDefinedVMProperties</code> configuration key, the new custom property must be appended to it. The additional custom property, <code>smartcard</code>, is added to the configuration key&#8217;s value. The new custom property is able to hold a value of <code>true</code> or <code>false</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s UserDefinedVMProperties='memory=^[0-9]+$;smartcard=^(true|false)$' --cver=4.4</pre>
</div>
</div>
</li>
<li>
<p>Verify that the custom properties defined by the <code>UserDefinedVMProperties</code> configuration key have been updated correctly.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g UserDefinedVMProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : memory=^[0-9]+$;smartcard=^(true|false)$ version: 4.4</pre>
</div>
</div>
</li>
<li>
<p>Finally, the <strong>ovirt-engine</strong> service must be restarted for the configuration change to take effect.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 30. Device Properties - Defining the <code>interface</code> Custom Property</div>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check the existing custom properties defined by the <code>CustomDeviceProperties</code> configuration key using the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g CustomDeviceProperties</pre>
</div>
</div>
<div class="paragraph">
<p>As shown by the output below, no custom properties have yet been defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g CustomDeviceProperties
CustomDeviceProperties:  version: 4.3
CustomDeviceProperties:  version: 4.4</pre>
</div>
</div>
</li>
<li>
<p>The <code>interface</code> custom property does not already exist, so it can be appended as is. In this example, the value of the <code>speed</code> sub-property is set to a range of 0 to 99999, and the value of the <code>duplex</code> sub-property is set to a selection of either <code>full</code> or <code>half</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s CustomDeviceProperties="{type=interface;prop={speed=^([0-9]{1,5})$;duplex=^(full|half)$}}" --cver=4.4</pre>
</div>
</div>
</li>
<li>
<p>Verify that the custom properties defined by the <code>CustomDeviceProperties</code> configuration key have been updated correctly.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g CustomDeviceProperties
UserDefinedVMProperties:  version: 4.3
UserDefinedVMProperties:  version: 4.4
UserDefinedVMProperties : {type=interface;prop={speed=^([0-9]{1,5})$;duplex=^(full|half)$}} version: 4.4</pre>
</div>
</div>
</li>
<li>
<p>Finally, the <strong>ovirt-engine</strong> service must be restarted for the configuration change to take effect.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_setting_custom_properties">Setting Virtual Machine Custom Properties</h3>
<div class="paragraph">
<p>Once custom properties are defined in the oVirt Engine, you can begin setting them on virtual machines. Custom properties are set on the <strong>Custom Properties</strong> tab of the <strong>New Virtual Machine</strong> and <strong>Edit Virtual Machine</strong> windows in the Administration Portal.</p>
</div>
<div class="paragraph">
<p>You can also set custom properties from the <strong>Run Virtual Machine(s)</strong> dialog box. Custom properties set from the <strong>Run Virtual Machine(s)</strong> dialog box will only apply to the virtual machine until it is next shutdown.</p>
</div>
<div class="paragraph">
<p>The <strong>Custom Properties</strong> tab provides a facility for you to select from the list of defined custom properties. Once you select a custom property key an additional field will display allowing you to enter a value for that key. Add additional key/value pairs by clicking the <strong>+</strong> button and remove them by clicking the <strong>-</strong> button.</p>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_evaluating_custom_properties">Evaluating Virtual Machine Custom Properties in a VDSM Hook</h3>
<div class="paragraph">
<p>Each key set in the <strong>Custom Properties</strong> field for a virtual machine is appended as an environment variable when calling hook scripts. Although the regular expressions used to validate the <strong>Custom Properties</strong> field provide some protection you should ensure that your scripts also validate that the inputs provided match their expectations.</p>
</div>
<div class="exampleblock">
<div class="title">Example 31. Evaluating Custom Properties</div>
<div class="content">
<div class="paragraph">
<p>This short Python example checks for the existence of the custom property <code>key1</code>. If the custom property is set then the value is printed to standard error. If the custom property is not set then no action is taken.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">#!/usr/bin/python

import os
import sys

if os.environ.has_key('key1'):
	sys.stderr.write('key1 value was : %s\n' % os.environ['key1'])
else:
    sys.exit(0)</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_hooking_module">Using the VDSM Hooking Module</h3>
<div class="paragraph">
<p>VDSM ships with a Python hooking module, providing helper functions for VDSM hook scripts. This module is provided as an example, and is only relevant to VDSM hooks written in Python.</p>
</div>
<div class="paragraph">
<p>The hooking module supports reading of a virtual machine&#8217;s libvirt XML into a DOM object. Hook scripts can then use Python&#8217;s built in <strong>xml.dom</strong> library (<a href="http://docs.python.org/release/2.6/library/xml.dom.html" class="bare">http://docs.python.org/release/2.6/library/xml.dom.html</a>) to manipulate the object.</p>
</div>
<div class="paragraph">
<p>The modified object can then be saved back to libvirt XML using the hooking module. The hooking module provides the following functions to support hook development:</p>
</div>
<table id="hooking-module-functions" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 82. Hooking module functions</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Argument</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tobool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Converts a string "true" or "false" to a Boolean value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>read_domxml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads the virtual machine&#8217;s libvirt XML into a DOM object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>write_domxml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DOM object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Writes the virtual machine&#8217;s libvirt XML from a DOM object</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_execution">VDSM Hook Execution</h3>
<div class="paragraph">
<p><strong>before_vm_start</strong> scripts can edit the domain XML in order to change VDSM&#8217;s definition of a virtual machine before it reaches libvirt. Caution must be exercised in doing so. Hook scripts have the potential to disrupt the operation of VDSM, and buggy scripts can result in outages to the oVirt environment. In particular, ensure you never change the UUID of the domain, and do not attempt to remove a device from the domain without sufficient background knowledge.</p>
</div>
<div class="paragraph">
<p>Both <strong>before_vdsm_start</strong> and <strong>after_vdsm_stop</strong> hook scripts are run as the <strong>root</strong> user. Other hook scripts that require <strong>root</strong> access to the system must be written to use the <code>sudo</code> command for privilege escalation. To support this the <strong>/etc/sudoers</strong> must be updated to allow the <strong>vdsm</strong> user to use <code>sudo</code> without reentering a password. This is required as hook scripts are executed non-interactively.</p>
</div>
<div class="exampleblock">
<div class="title">Example 32. Configuring <code>sudo</code> for VDSM Hooks</div>
<div class="content">
<div class="paragraph">
<p>In this example the <code>sudo</code> command will be configured to allow the <strong>vdsm</strong> user to run the <code>/bin/chown</code> command as <strong>root</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into the virtualization host as <strong>root</strong>.</p>
</li>
<li>
<p>Open the <strong>/etc/sudoers</strong> file in a text editor.</p>
</li>
<li>
<p>Add this line to the file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">vdsm ALL=(ALL) NOPASSWD: /bin/chown</pre>
</div>
</div>
<div class="paragraph">
<p>This specifies that the <strong>vdsm</strong> user has the ability to run the <code>/bin/chown</code> command as the <strong>root</strong> user. The <code>NOPASSWD</code> parameter indicates that the user will not be prompted to enter their password when calling <code>sudo</code>.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once this configuration change has been made VDSM hooks are able to use the <code>sudo</code> command to run <code>/bin/chown</code> as <strong>root</strong>. This Python code uses <code>sudo</code> to execute <code>/bin/chown</code> as <strong>root</strong> on the file <strong>/my_file</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">retcode = subprocess.call( ["/usr/bin/sudo", "/bin/chown", "root", "/my_file"] )</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The standard error stream of hook scripts is collected in VDSM&#8217;s log. This information is used to debug hook scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_return_codes">VDSM Hook Return Codes</h3>
<div class="paragraph">
<p>Hook scripts must return one of the return codes shown in <a href="#hook-return-codes">Hook Return Codes</a>. The return code will determine whether further hook scripts are processed by VDSM.</p>
</div>
<table id="hook-return-codes" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 83. Hook Return Codes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hook script ended successfully</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hook script failed, other hooks should be processed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hook script failed, no further hooks should be processed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="VDSM_hooks_examples">VDSM Hook Examples</h3>
<div class="paragraph">
<p>The example hook scripts provided in this section are strictly not supported by Red Hat. You must ensure that any and all hook scripts that you install to your system, regardless of source, are thoroughly tested for your environment.</p>
</div>
<div id="VDSM_Hooks-example-numaset" class="exampleblock">
<div class="title">Example 33. NUMA Node Tuning</div>
<div class="content">
<div class="paragraph">
<p><strong>Purpose:</strong></p>
</div>
<div class="paragraph">
<p>This hook script allows for tuning the allocation of memory on a NUMA host based on the <code>numaset</code> custom property. Where the custom property is not set no action is taken.</p>
</div>
<div class="paragraph">
<p><strong>Configuration String:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">numaset=^(interleave|strict|preferred):[\^]?\d+(-\d+)?(,[\^]?\d+(-\d+)?)*$</pre>
</div>
</div>
<div class="paragraph">
<p>The regular expression used allows the <code>numaset</code> custom property for a given virtual machine to specify both the allocation mode (<code>interleave</code>, <code>strict</code>, <code>preferred</code>) and the node to use. The two values are separated by a colon (<code>:</code>). The regular expression allows specification of the <code>nodeset</code> as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>that a specific node (<code>numaset=strict:1</code>, specifies that only node 1 be used), or</p>
</li>
<li>
<p>that a range of nodes be used (<code>numaset=strict:1-4</code>, specifies that nodes 1 through 4 be used), or</p>
</li>
<li>
<p>that a specific node not be used (<code>numaset=strict:^3</code>, specifies that node 3 not be used), or</p>
</li>
<li>
<p>any comma-separated combination of the above (<code>numaset=strict:1-4,6</code>, specifies that nodes 1 to 4, and 6 be used).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Script:</strong></p>
</div>
<div class="paragraph">
<p><strong>/usr/libexec/vdsm/hooks/before_vm_start/50_numa</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>#!/usr/bin/python

import os
import sys
import hooking
import traceback

'''
numa hook
=========
add numa support for domain xml:

&lt;numatune&gt;
    &lt;memory mode="strict" nodeset="1-4,^3" /&gt;
&lt;/numatune&gt;

memory=interleave|strict|preferred

numaset="1" (use one NUMA node)
numaset="1-4" (use 1-4 NUMA nodes)
numaset="^3" (don't use NUMA node 3)
numaset="1-4,^3,6" (or combinations)

syntax:
    numa=strict:1-4
'''

if os.environ.has_key('numa'):
    try:
        mode, nodeset = os.environ['numa'].split(':')

        domxml = hooking.read_domxml()

        domain = domxml.getElementsByTagName('domain')[0]
        numas = domxml.getElementsByTagName('numatune')

        if not len(numas) &gt; 0:
            numatune = domxml.createElement('numatune')
            domain.appendChild(numatune)

            memory = domxml.createElement('memory')
            memory.setAttribute('mode', mode)
            memory.setAttribute('nodeset', nodeset)
            numatune.appendChild(memory)

            hooking.write_domxml(domxml)
        else:
            sys.stderr.write('numa: numa already exists in domain xml')
            sys.exit(2)
    except:
        sys.stderr.write('numa: [unexpected error]: %s\n' % traceback.format_exc())
        sys.exit(2)</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-Custom_Network_Properties">Appendix B: Custom Network Properties</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Explanation_of_bridge_opts_Parameters">Explanation of bridge_opts Parameters</h3>
<table id="Table-Explanation_of_bridge_opts_Parameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 84. bridge_opts parameters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forward_delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time, in deciseconds, a bridge will spend in the listening and learning states. If no switching loop is discovered in this time, the bridge will enter forwarding state. This allows time to inspect the traffic and layout of the network before normal network operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">group_addr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To send a general query, set this value to zero. To send a group-specific and group-and-source-specific queries, set this value to a 6-byte MAC address, not an IP address. Allowed values are <code>01:80:C2:00:00:0x</code> except <code>01:80:C2:00:00:01</code>, <code>01:80:C2:00:00:02</code> and <code>01:80:C2:00:00:03</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">group_fwd_mask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables bridge to forward link local group addresses. Changing this value from the default will allow non-standard bridging behavior.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hash_max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum amount of buckets in the hash table. This takes effect immediately and cannot be set to a value less than the current number of multicast group entries. Value must be a power of two.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hello_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time interval, in deciseconds, between sending 'hello' messages, announcing bridge position in the network topology. Applies only if this bridge is the Spanning Tree root bridge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum time, in deciseconds, to receive a 'hello' message from another root bridge before that bridge is considered dead and takeover begins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_last_member_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of 'last member' queries sent to the multicast group after receiving a 'leave group' message from a host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_last_member_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time, in deciseconds, between 'last member' queries.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_membership_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time, in deciseconds, that a bridge will wait to hear from a member of a multicast group before it stops sending multicast traffic to the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_querier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the bridge actively runs a multicast querier or not. When a bridge receives a 'multicast host membership' query from another network host, that host is tracked based on the time that the query was received plus the multicast query interval time. If the bridge later attempts to forward traffic for that multicast membership, or is communicating with a querying multicast router, this timer confirms the validity of the querier. If valid, the multicast traffic is delivered via the bridge&#8217;s existing multicast membership table; if no longer valid, the traffic is sent via all bridge ports.Broadcast domains with, or expecting, multicast memberships should run at least one multicast querier for improved performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_querier_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum time, in deciseconds, between last 'multicast host membership' query received from a host to ensure it is still valid.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_query_use_ifaddr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean. Defaults to '0', in which case the querier uses 0.0.0.0 as source address for IPv4 messages. Changing this sets the bridge IP as the source address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_query_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time, in deciseconds, between query messages sent by the bridge to ensure validity of multicast memberships. At this time, or if the bridge is asked to send a multicast query for that membership, the bridge checks its own multicast querier state based on the time that a check was requested plus multicast_query_interval. If a multicast query for this membership has been sent within the last multicast_query_interval, it is not sent again.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_query_response_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Length of time, in deciseconds, a host is allowed to respond to a query once it has been sent.Must be less than or equal to the value of the multicast_query_interval.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_router</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows you to enable or disable ports as having multicast routers attached. A port with one or more multicast routers will receive all multicast traffic. A value of 0 disables completely, a value of 1 enables the system to automatically detect the presence of routers based on queries, and a value of 2 enables ports to always receive all multicast traffic.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_snooping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toggles whether snooping is enabled or disabled. Snooping allows the bridge to listen to the network traffic between routers and hosts to maintain a map to filter multicast traffic to the appropriate links.This option allows the user to re-enable snooping if it was automatically disabled due to hash collisions, however snooping will not be re-enabled if the hash collision has not been resolved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_startup_query_count</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the number of queries sent out at startup to determine membership information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">multicast_startup_query_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the time, in deciseconds, between queries sent out at startup to determine membership information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="How_to_Set_Up_Red_Hat_Enterprise_Virtualization_Manager_to_Use_Ethtool">How to Set Up oVirt Engine to Use Ethtool</h3>
<div class="paragraph">
<p>You can configure ethtool properties for host network interface cards from the Administration Portal. The <strong>ethtool_opts</strong> key is not available by default and needs to be added to the Engine using the engine configuration tool. You also need to install the required VDSM hook package on the hosts.</p>
</div>
<div class="paragraph">
<p><strong>Adding the ethtool_opts Key to the Engine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine, run the following command to add the key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s UserDefinedNetworkCustomProperties=ethtool_opts=.* --cver=4.4</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>On the hosts that you want to configure ethtool properties, install the VDSM hook package. The package is available by default on oVirt Node but needs to be installed on Enterprise Linux hosts.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install vdsm-hook-ethtool-options</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>ethtool_opts</strong> key is now available in the Administration Portal. See <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a> to apply ethtool properties to logical networks.</p>
</div>
</div>
<div class="sect2">
<h3 id="How_to_Set_Up_RHVM_to_Use_FCoE">How to Set Up oVirt Engine to Use FCoE</h3>
<div class="paragraph">
<p>You can configure Fibre Channel over Ethernet (FCoE) properties for host network interface cards from the Administration Portal. The <strong>fcoe</strong> key is not available by default and needs to be added to the Engine using the engine configuration tool. You can check whether <strong>fcoe</strong> has already been enabled by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -g UserDefinedNetworkCustomProperties</pre>
</div>
</div>
<div class="paragraph">
<p>You also need to install the required VDSM hook package on the hosts. Depending on the FCoE card on the hosts, special configuration may also be needed; see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/Storage_Administration_Guide/fcoe-config.html">Configuring a Fibre Channel over Ethernet Interface</a> in the <em>Enterprise Linux Storage Administration Guide</em>.</p>
</div>
<div class="paragraph">
<p><strong>Adding the fcoe Key to the Engine</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the Engine, run the following command to add the key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-config -s UserDefinedNetworkCustomProperties='fcoe=^((enable|dcb|auto_vlan)=(yes|no),?)*$'</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>Install the VDSM hook package on each of the Enterprise Linux hosts on which you want to configure FCoE properties. The package is available by default on oVirt Node (oVirt Node).</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnf install vdsm-hook-fcoe</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <strong>fcoe</strong> key is now available in the Administration Portal. See <a href="#Editing_Host_Network_Interfaces_and_Assigning_Logical_Networks_to_Hosts">Editing Host Network Interfaces and Assigning Logical Networks to Hosts</a> to apply FCoE properties to logical networks.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">Appendix C: oVirt User Interface Plugins</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugins">oVirt User Interface Plug-ins</h3>
<div class="paragraph">
<p>oVirt supports plug-ins that expose non-standard features. This makes it easier to use the oVirt Administration Portal to integrate with other systems. Each interface plug-in represents a set of user interface extensions that can be packaged and distributed for use with oVirt.</p>
</div>
<div class="paragraph">
<p>oVirt&#8217;s User Interface plug-ins integrate with the Administration Portal directly on the client using the JavaScript programming language. Plug-ins are invoked by the Administration Portal and executed in the web browser&#8217;s JavaScript runtime. User Interface plug-ins can use the JavaScript language and its libraries.</p>
</div>
<div class="paragraph">
<p>At key events during runtime, the Administration Portal invokes individual plug-ins via event handler functions representing Administration-Portal-to-plug-in communication. Although the Administration Portal supports multiple event-handler functions, a plug-in declares functions which are of interest only to its implementation. Each plug-in must register relevant event handler functions as part of the plug-in bootstrap sequence before the plug-in is put to use by the administration portal.</p>
</div>
<div class="paragraph">
<p>To facilitate the plug-in-to-Administration-Portal communication that drives the User Interface extension, the Administration Portal exposes the plug-in API as a global (top-level) pluginApi JavaScript object that individual plug-ins can consume. Each plug-in obtains a separate pluginApi instance, allowing the Administration Portal to control plug-in API-function invocation for each plug-in with respect to the plug-in&#8217;s life cycle.</p>
</div>
</div>
<div class="sect2">
<h3 id="sect-Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Lifecycle">oVirt User Interface Plugin Lifecycle</h3>
<div class="sect3">
<h4 id="RHEV_UI_Plugin_Lifecycle">oVirt User Interface Plug-in Life cycle</h4>
<div class="paragraph">
<p>The basic life cycle of a User Interface Plug-in divides into three stages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Plug-in discovery.</p>
</li>
<li>
<p>Plug-in loading.</p>
</li>
<li>
<p>Plug-in bootstrapping.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Discovery">oVirt User Interface Plug-in Discovery</h4>
<div class="paragraph">
<p>Creating plug-in descriptors is the first step in the plug-in discovery process. Plug-in descriptors contain important plug-in metadata and optional default plug-in-specific configurations.</p>
</div>
<div class="paragraph">
<p>As part of handling administration portal HTML page requests (<code>HTTP GET</code>), User Interface plug-in infrastructure attempts to discover and load plug-in descriptors from your local file system. For each plug-in descriptor, the infrastructure also attempts to load corresponding plug-in user configurations used to override default plug-in-specific configurations (if any exist) and tweak plug-in runtime behavior. Plug-in user configuration is optional. After loading descriptors and corresponding user configuration files, oVirt Engine aggregates User Interface plug-in data and embeds it into the administration portal HTML page for runtime evaluation.</p>
</div>
<div class="paragraph">
<p>By default, plug-in descriptors reside in <strong>$ENGINE_USR/ui-plug-ins</strong>, with a default mapping of <strong>ENGINE_USR=/usr/share/ovirt-engine</strong> as defined by oVirt Engine local configuration. Plug-in descriptors are expected to comply with JSON format specifications, but plug-in descriptors allow Java/C++ style comments (of both <code>/*</code> and <code>//</code> varieties) in addition to the JSON format specifications.</p>
</div>
<div class="paragraph">
<p>By default, plug-in user configuration files reside in <strong>$ENGINE_ETC/ui-plug-ins</strong>, with a default mapping of <strong>ENGINE_ETC=/etc/ovirt-engine</strong> as defined by oVirt Engine local configuration. Plug-in user configuration files are expected to comply with same content format rules as plug-in descriptors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Plug-in user configuration files generally follow the <strong>&lt;descriptorFileName&gt;-config.json</strong> naming convention.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Loading">oVirt User Interface Plug-in Loading</h4>
<div class="paragraph">
<p>After a plug-in has been discovered and its data is embedded into the administration portal HTML page, administration portal tries to load the plug-in as part of application startup (unless you have configured it not to load as part of application startup).</p>
</div>
<div class="paragraph">
<p>For each plug-in that has been discovered, the administration portal creates an HTML iframe element that is used to load its host page. The plug-in host page is necessary to begin the plug-in bootstrap process, which (the bootstrap process) is used to evaluate the plug-in code in the context of the plug-in&#8217;s iframe element. User interface plug-in infrastructure supports serving plug-in resource files (such as the plug-in host page) from the local file system. The plug-in host page is loaded into the iframe element and the plug-in code is evaluated. After the plug-in code is evaluated, the plug-in communicates with the administration portal by means of the plug-in API.</p>
</div>
</div>
<div class="sect3">
<h4 id="Red_Hat_Enterprise_Virtualization_User_Interface_Plugin_Bootstrapping">oVirt User Interface Plug-in Bootstrapping</h4>
<div class="paragraph">
<p>A typical plug-in bootstrap sequence consists of following steps:</p>
</div>
<div class="paragraph">
<p><strong>Plug-in Bootstrap Sequence</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Obtain pluginApi instance for the given plug-in</p>
</li>
<li>
<p>Obtain runtime plug-in configuration object (optional)</p>
</li>
<li>
<p>Register relevant event handler functions</p>
</li>
<li>
<p>Notify UI plug-in infrastructure to proceed with plug-in initialization</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following code snippet illustrates the above mentioned steps in practice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">// Access plug-in API using 'parent' due to this code being evaluated within the context of an iframe element.
// As 'parent.pluginApi' is subject to Same-Origin Policy, this will only work when WebAdmin HTML page and plug-in
// host page are served from same origin. WebAdmin HTML page and plug-in host page will always be on same origin
// when using UI plug-in infrastructure support to serve plug-in resource files.
var api = parent.pluginApi('MyPlugin');

// Runtime configuration object associated with the plug-in (or an empty object).
var config = api.configObject();

// Register event handler function(s) for later invocation by UI plug-in infrastructure.
api.register({
	    // UiInit event handler function.
		UiInit: function() {
				// Handle UiInit event.
					window.alert('Favorite music band is ' + config.band);
					    }
});

// Notify UI plug-in infrastructure to proceed with plug-in initialization.
api.ready();</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="UI_Plugin-related_Files_and_their_Locations">User Interface Plugin-related Files and Their Locations</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 85. UI Plugin-related Files and their Locations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plug-in descriptor files (meta-data)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/usr/share/ovirt-engine/ui-plugins/my-plugin.json</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plug-in user configuration files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/etc/ovirt-engine/ui-plugins/my-plugin-config.json</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plug-in resource files</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>/usr/share/ovirt-engine/ui-plugins/&lt;resourcePath&gt;/PluginHostPage.html</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>&lt;resourcePath&gt;</strong> is defined by the corresponding attribute in the plug-in descriptor.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="Example_RHEV_UI_Plugin_Deployment">Example User Interface Plug-in Deployment</h3>
<div class="paragraph">
<p>Follow these instructions to create a user interface plug-in that runs a <strong>Hello World!</strong> program when you sign in to the oVirt Engine Administration Portal.</p>
</div>
<div class="paragraph">
<p><strong>Deploying a <code>Hello World!</code> Plug-in</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a plug-in descriptor by creating the following file in the Engine at <strong>/usr/share/ovirt-engine/ui-plugins/helloWorld.json</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">{
    "name": "HelloWorld",
    "url": "/ovirt-engine/webadmin/plugin/HelloWorld/start.html",
    "resourcePath": "hello-files"
}</pre>
</div>
</div>
</li>
<li>
<p>Create the plug-in host page by creating the following file in the Engine at <strong>/usr/share/ovirt-engine/ui-plugins/hello-files/start.html</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;
&lt;script&gt;
    var api = parent.pluginApi('HelloWorld');
    api.register({
	UiInit: function() { window.alert('Hello world'); }
    });
    api.ready();
&lt;/script&gt;
&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you have successfully implemented the <strong>Hello World!</strong> plug-in, you will see this screen when you sign in to the Administration Portal:</p>
</div>
<div id="ui-plugin-hello-world-success" class="imageblock">
<div class="content">
<img src="images/1475.png" alt="1475">
</div>
<div class="title">Figure 16. A Successful Implementation of the <strong>Hello World!</strong> Plug-in</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-Red_Hat_Enterprise_Virtualization_and_SSL">Appendix D: oVirt and encrypted communication</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Replacing_the_Manager_CA_Certificate">Replacing the oVirt Engine CA Certificate</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not change the permissions and ownerships for the <code>/etc/pki</code> directory or any subdirectories. The permission for the <code>/etc/pki</code> and the <code>/etc/pki/ovirt-engine</code> directory must remain as the default, <code>755</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can configure your organization&#8217;s third-party CA certificate to identify the oVirt Engine to users connecting over HTTPS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using a third-party CA certificate for HTTPS connections does not affect the certificate used for authentication between the Engine and hosts. They will continue to use the self-signed certificate generated by the Engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Prerequisites</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A third-party CA certificate. This is the certificate of the CA (Certificate Authority) that issued the certificate you want to use. It is provided as a <strong>PEM</strong> file. The certificate chain must be complete up to the root certificate. The chain&#8217;s order is critical and must be from the last intermediate certificate to the root certificate. This procedure assumes that the third-party CA certificate is provided in <code>/tmp/3rd-party-ca-cert.pem</code>.</p>
</li>
<li>
<p>The private key that you want to use for Apache httpd. It must not have a password. This procedure assumes that it is located in <code>/tmp/apache.key</code>.</p>
</li>
<li>
<p>The certificate issued by the CA. This procedure assumes that it is located in <code>/tmp/apache.cer</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you received the private key and certificate from your CA in a P12 file, use the following procedure to extract them. For other file formats, contact your CA. After extracting the private key and certificate, proceed to <a href="#Replace">Replacing the oVirt Engine Apache CA Certificate</a>.</p>
</div>
<div id="Extracting" class="paragraph">
<p><strong>Extracting the Certificate and Private Key from a P12 Bundle</strong></p>
</div>
<div class="paragraph">
<p>The internal CA stores the internally generated key and certificate in a P12 file, in <code>/etc/pki/ovirt-engine/keys/apache.p12</code>. Store your new file in the same location. The following procedure assumes that the new P12 file is in <code>/tmp/apache.p12</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Back up the current <code>apache.p12</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/keys/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12.bck</pre>
</div>
</div>
</li>
<li>
<p>Replace the current file with the new file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/apache.p12 /etc/pki/ovirt-engine/keys/apache.p12</pre>
</div>
</div>
</li>
<li>
<p>Extract the private key and certificate to the required locations. If the file is password protected, you must add <code>-passin pass:_password_</code>, replacing <em>password</em> with the required password.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nocerts -nodes &gt; /tmp/apache.key
# openssl pkcs12 -in /etc/pki/ovirt-engine/keys/apache.p12 -nokeys &gt; /tmp/apache.cer</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For new oVirt installations, you must complete all of the steps in this procedure.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="Replace" class="paragraph">
<p><strong>Replacing the oVirt Engine Apache CA Certificate</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are using a self-hosted engine, put the environment into global maintenance mode.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
<div class="paragraph">
<p>For more information, see <a href="#Maintaining_the_Self-Hosted_Engine">Maintaining the Self-hosted engine</a>.</p>
</div>
</li>
<li>
<p>Add your CA certificate to the host-wide trust store:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/<em>3rd-party-ca-cert</em>.pem /etc/pki/ca-trust/source/anchors
# update-ca-trust</pre>
</div>
</div>
</li>
<li>
<p>The Engine has been configured to use <code>/etc/pki/ovirt-engine/apache-ca.pem</code>, which is symbolically linked to <code>/etc/pki/ovirt-engine/ca.pem</code>. Remove the symbolic link:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/pki/ovirt-engine/apache-ca.pem</pre>
</div>
</div>
</li>
<li>
<p>Save your CA certificate as <code>/etc/pki/ovirt-engine/apache-ca.pem</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/<em>3rd-party-ca-cert</em>.pem /etc/pki/ovirt-engine/apache-ca.pem</pre>
</div>
</div>
</li>
<li>
<p>Back up the existing private key and certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /etc/pki/ovirt-engine/keys/apache.key.nopass /etc/pki/ovirt-engine/keys/apache.key.nopass.bck
# cp /etc/pki/ovirt-engine/certs/apache.cer /etc/pki/ovirt-engine/certs/apache.cer.bck</pre>
</div>
</div>
</li>
<li>
<p>Copy the private key to the required location:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/apache.key /etc/pki/ovirt-engine/keys/apache.key.nopass</pre>
</div>
</div>
</li>
<li>
<p>Set the private key owner to root and set the permissions to <code>0640</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown root:ovirt  /etc/pki/ovirt-engine/keys/apache.key.nopass
# chmod 640 /etc/pki/ovirt-engine/keys/apache.key.nopass</pre>
</div>
</div>
</li>
<li>
<p>Copy the certificate to the required location:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp /tmp/apache.cer /etc/pki/ovirt-engine/certs/apache.cer</pre>
</div>
</div>
</li>
<li>
<p>Set the certificate owner to root and set the permissions to <code>0644</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown root:ovirt /etc/pki/ovirt-engine/certs/apache.cer
# chmod 644 /etc/pki/ovirt-engine/certs/apache.cer</pre>
</div>
</div>
</li>
<li>
<p>Restart the Apache server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart httpd.service</pre>
</div>
</div>
</li>
<li>
<p>Create a new trust store configuration file, <code>/etc/ovirt-engine/engine.conf.d/99-custom-truststore.conf</code>, with the following parameters:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ENGINE_HTTPS_PKI_TRUST_STORE="/etc/pki/java/cacerts"
ENGINE_HTTPS_PKI_TRUST_STORE_PASSWORD=""</pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>/etc/ovirt-engine/ovirt-websocket-proxy.conf.d/10-setup.conf</code> file, and rename it with an index number that is greater than 10 (for example, <code>99-setup.conf</code>). Add the following parameters to the new file:</p>
<div class="listingblock">
<div class="content">
<pre>SSL_CERTIFICATE=/etc/pki/ovirt-engine/certs/apache.cer
SSL_KEY=/etc/pki/ovirt-engine/keys/apache.key.nopass</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>websocket-proxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-websocket-proxy.service</pre>
</div>
</div>
</li>
<li>
<p>If you manually changed the <code>/etc/ovirt-provider-ovn/conf.d/10-setup-ovirt-provider-ovn.conf</code> file, or are using a configuration file from an older installation, make sure that the Engine is still configured to use <code>/etc/pki/ovirt-engine/apache-ca.pem</code> as the certificate source.</p>
</li>
<li>
<p>Enable <code>engine-backup</code> to update the system on restore by creating a new file, <code>/etc/ovirt-engine-backup/engine-backup-config.d/update-system-wide-pki.sh</code>, with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">BACKUP_PATHS="${BACKUP_PATHS}
/etc/ovirt-engine-backup"
cp -f /etc/pki/ovirt-engine/apache-ca.pem \
/etc/pki/ca-trust/source/anchors/<em>3rd-party-ca-cert</em>.pem
update-ca-trust</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-provider-ovn</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-provider-ovn.service</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-imageio</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-imageio.service</pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>ovirt-engine</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart ovirt-engine.service</pre>
</div>
</div>
</li>
<li>
<p>If you are using a self-hosted engine, turn off global maintenance mode.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your users can now connect to the Administration Portal and VM Portal, without seeing a warning about the authenticity of the certificate used to encrypt HTTPS traffic.</p>
</div>
</div>
<div class="sect2">
<h3 id="Setting_Up_SSL_or_TLS_Connections_between_the_Manager_and_an_LDAP_Server">Setting Up Encrypted Communication between the Engine and an LDAP Server</h3>
<div class="paragraph">
<p>To set up encrypted communication between the oVirt Engine and an LDAP server, obtain the root CA certificate of the LDAP server, copy the root CA certificate to the Engine, and create a PEM-encoded CA certificate. The keystore type can be any Java-supported type. The following procedure uses the Java KeyStore (JKS) format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more information on creating a PEM-encoded CA certificate and importing certificates, see the <code>X.509 CERTIFICATE TRUST STORE</code> section of the README file at <strong>/usr/share/doc/ovirt-engine-extension-aaa-ldap-<em>version</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Creating a PEM-encoded CA certificate</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the oVirt Engine, copy the root CA certificate of the LDAP server to the <strong>/tmp</strong> directory and import the root CA certificate using <code>keytool</code> to create a PEM-encoded CA certificate. The following command imports the root CA certificate at <em>/tmp/myrootca.pem</em> and creates a PEM-encoded CA certificate <em>myrootca.jks</em> under <em>/etc/ovirt-engine/aaa/</em>. Note down the certificate&#8217;s location and password. If you are using the interactive setup tool, this is all the information you need. If you are configuring the LDAP server manually, follow the rest of the procedure to update the configuration files.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ keytool -importcert -noprompt -trustcacerts -alias <em>myrootca</em> -file <em>/tmp/myrootca.pem</em> -keystore <em>/etc/ovirt-engine/aaa/myrootca.jks</em> -storepass <em>password</em></pre>
</div>
</div>
</li>
<li>
<p>Update the <strong>/etc/ovirt-engine/aaa/profile1.properties</strong> file with the certificate information:</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>${local:_basedir}</code> is the directory where the LDAP property configuration file resides and points to the <strong>/etc/ovirt-engine/aaa</strong> directory. If you created the PEM-encoded CA certificate in a different directory, replace <code>${local:_basedir}</code> with the full path to the certificate.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>To use startTLS (recommended):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Create keystore, import certificate chain and uncomment
pool.default.ssl.startTLS = true
pool.default.ssl.truststore.file = ${local:_basedir}/<em>myrootca.jks</em>
pool.default.ssl.truststore.password = <em>password</em></pre>
</div>
</div>
</li>
<li>
<p>To use SSL:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># Create keystore, import certificate chain and uncomment
pool.default.serverset.single.port = 636
pool.default.ssl.enable = true
pool.default.ssl.truststore.file = ${local:_basedir}/<em>myrootca.jks</em>
pool.default.ssl.truststore.password = <em>password</em></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>To continue configuring an external LDAP provider, see <a href="#Configuring_an_External_LDAP_Provider">Configuring an External LDAP Provider</a>. To continue configuring LDAP and Kerberos for Single Sign-on, see <a href="#Configuring_LDAP_and_Kerberos_for_Single_Sign-on">Configuring LDAP and Kerberos for Single Sign-on</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-Branding">Appendix E: Branding</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-Branding">Branding</h3>
<div class="sect3">
<h4 id="Re-Branding_the_Manager1">Re-Branding the Engine</h4>
<div class="paragraph">
<p>Various aspects of the oVirt Engine can be customized, such as the icons used by and text displayed in pop-up windows and the links shown on the Welcome Page. This allows you to re-brand the Engine and gives you fine-grained control over the end look and feel presented to administrators and users.</p>
</div>
<div class="paragraph">
<p>The files required to customize the Engine are located in the <strong>/etc/ovirt-engine/branding/</strong> directory on the system on which the Engine is installed. The files comprise a set of cascading style sheet files that are used to style various aspects of the graphical user interface and a set of properties files that contain messages and links that are incorporated into various components of the Engine.</p>
</div>
<div class="paragraph">
<p>To customize a component, edit the file for that component and save the changes. The next time you open or refresh that component, the changes will be applied.</p>
</div>
</div>
<div class="sect3">
<h4 id="Re-Branding_the_Manager">Login Screen</h4>
<div class="paragraph">
<p>The login screen is the login screen used by both the Administration Portal and VM Portal. The elements of the login screen that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The border</p>
</li>
<li>
<p>The header image on the left</p>
</li>
<li>
<p>The header image on the right</p>
</li>
<li>
<p>The header text</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for the login screen are located in <strong>common.css</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Administration_Portal_Screen">Administration Portal Screen</h4>
<div class="paragraph">
<p>The administration portal screen is the main screen that is shown when you log into the Administration Portal. The elements of the administration portal screen that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The logo</p>
</li>
<li>
<p>The left background image</p>
</li>
<li>
<p>The center background image</p>
</li>
<li>
<p>The right background image</p>
</li>
<li>
<p>The text to the right of the logo</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for the administration portal screen are located in <strong>web_admin.css</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="User_Portal_Screen">VM Portal Screen</h4>
<div class="paragraph">
<p>The VM Portal screen is the screen that is shown when you log into the VM Portal. The elements of the VM Portal screen that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The logo</p>
</li>
<li>
<p>The center background image</p>
</li>
<li>
<p>The right background image</p>
</li>
<li>
<p>The border around the main grid</p>
</li>
<li>
<p>The text above the <strong>Logged in user</strong> label</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for the VM Portal screen are located in <strong>user_portal.css</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Pop-up_Windows">Pop-Up Windows</h4>
<div class="paragraph">
<p>Pop-up windows are all windows in the Engine that allow you to create, edit or update an entity such as a host or virtual machine. The elements of pop-up windows that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The border</p>
</li>
<li>
<p>The header image on the left</p>
</li>
<li>
<p>The header center image (repeated)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for pop-up windows are located in <code>common.css</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Tabs">Tabs</h4>
<div class="paragraph">
<p>Many pop-up windows in the Administration Portal include tabs. The elements of these tabs that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Active</p>
</li>
<li>
<p>Inactive</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for tabs are located in <strong>common.css</strong> and <strong>user_portal.css</strong>.</p>
</div>
</div>
<div class="sect3">
<h4 id="The_Welcome_Page">The Welcome Page</h4>
<div class="paragraph">
<p>The Welcome Page is the page that is initially displayed when you visit the homepage of the Engine. In addition to customizing the overall look and feel, you can also make other changes such as adding links to the page for additional documentation or internal websites by editing a template file. The elements of the Welcome Page that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The page title</p>
</li>
<li>
<p>The header (left, center and right)</p>
</li>
<li>
<p>The error message</p>
</li>
<li>
<p>The link to forward and the associated message for that link</p>
</li>
<li>
<p>Add a message banner or preamble</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for the Welcome Page are located in <code>welcome_style.css</code>.</p>
</div>
<div class="paragraph">
<p><strong>The Template File</strong></p>
</div>
<div class="paragraph">
<p>The template file for the Welcome Page is a regular HTML file of the name <code>welcome_page.template</code> that does not contain <code>HTML</code>, <code>HEAD</code> or <code>BODY</code> tags. This file is inserted directly into the Welcome Page itself, and acts as a container for the content that is displayed in the Welcome Page. As such, you must edit this file to add new links or change the content itself. Another feature of the template file is that it contains placeholder text such as <code>{user_portal}</code> that is replaced by corresponding text in the <code>messages.properties</code> file when the Welcome Page is processed.</p>
</div>
<div class="paragraph">
<p><strong>The Preamble</strong></p>
</div>
<div class="paragraph">
<p>You can add a custom message banner to the Welcome Page by adding a <code>preamble.template</code> containing the banner text and a <code>preamble.css</code> file defining the banner size, and linking them in the <code>branding.properties</code> file. Sample files are available at <a href="https://bugzilla.redhat.com/attachment.cgi?id=1783329">sample preamble template</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In an engine upgrade, the custom message banner remains in place and will work without issue.
Following engine backup and restore, during engine restore, the custom message banner needs to be manually restored and verified.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="The_File_Not_Found_Page">The Page Not Found Page</h4>
<div class="paragraph">
<p>The Page Not Found page is a page that is displayed when you open a link to a page that cannot be found in the oVirt Engine. The elements of the Page Not Found page that can be customized are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The page title</p>
</li>
<li>
<p>The header (left, center and right)</p>
</li>
<li>
<p>The error message</p>
</li>
<li>
<p>The link to forward and the associated message for that link</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The classes for the Page Not Found page are located in <code>welcome_style.css</code>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appe-System_Accounts">Appendix F: System Accounts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="sect-System_Accounts">System Accounts</h3>
<div class="sect3">
<h4 id="Red_Hat_Enterprise_Virtualization_Manager_User_Accounts">oVirt Engine User Accounts</h4>
<div class="paragraph">
<p>A number of system user accounts are created to support oVirt when the <code>rhevm</code> package is installed. Each system user has a default user identifier (UID). The system user accounts created are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>vdsm</strong> user (UID <code>36</code>). Required for support tools that mount and access NFS storage domains.</p>
</li>
<li>
<p>The <strong>ovirt</strong> user (UID <code>108</code>). Owner of the <strong>ovirt-engine</strong> Red Hat JBoss Enterprise Application Platform instance.</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> user (UID <code>498</code>). Required for the guest serial console.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Red_Hat_Enterprise_Virtualization_Manager_Groups">oVirt Engine Groups</h4>
<div class="paragraph">
<p>A number of system user groups are created to support oVirt when the <code>rhevm</code> package is installed. Each system user group has a default group identifier (GID). The system user groups created are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>kvm</strong> group (GID <code>36</code>). Group members include:</p>
</li>
<li>
<p>The <strong>vdsm</strong> user.</p>
</li>
<li>
<p>The <strong>ovirt</strong> group (GID <code>108</code>). Group members include:</p>
</li>
<li>
<p>The <strong>ovirt</strong> user.</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> group (GID <code>498</code>). Group members include:</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> user.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="Virtualization_Host_User_Accounts">Virtualization Host User Accounts</h4>
<div class="paragraph">
<p>A number of system user accounts are created on the virtualization host when the <code>vdsm</code> and <code>qemu-kvm-rhev</code> packages are installed. Each system user has a default user identifier (UID). The system user accounts created are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>vdsm</strong> user (UID <code>36</code>).</p>
</li>
<li>
<p>The <strong>qemu</strong> user (UID <code>107</code>).</p>
</li>
<li>
<p>The <strong>sanlock</strong> user (UID <code>179</code>).</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> user (UID <code>498</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user identifiers (UIDs) and group identifiers (GIDs) allocated may vary between systems. The <strong>vdsm</strong> user is fixed to a UID of <code>36</code> and the <strong>kvm</strong> group is fixed to a GID of <code>36</code>.</p>
</div>
<div class="paragraph">
<p>If UID <code>36</code> or GID <code>36</code> is already used by another account on the system a conflict will arise during installation of the <code>vdsm</code> and <code>qemu-kvm-rhev</code> packages.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="Virtualization_Host_Groups">Virtualization Host Groups</h4>
<div class="paragraph">
<p>A number of system user groups are created on the virtualization host when the <code>vdsm</code> and <code>qemu-kvm-rhev</code> packages are installed. Each system user group has a default group identifier (GID). The system user groups created are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>kvm</strong> group (GID <code>36</code>). Group members include:</p>
</li>
<li>
<p>The <strong>qemu</strong> user.</p>
</li>
<li>
<p>The <strong>sanlock</strong> user.</p>
</li>
<li>
<p>The <strong>qemu</strong> group (GID <code>107</code>). Group members include:</p>
</li>
<li>
<p>The <strong>vdsm</strong> user.</p>
</li>
<li>
<p>The <strong>sanlock</strong> user.</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> group (GID <code>498</code>). Group members include:</p>
</li>
<li>
<p>The <strong>ovirt-vmconsole</strong> user.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The user identifiers (UIDs) and group identifiers (GIDs) allocated may vary between systems. The <strong>vdsm</strong> user is fixed to a UID of <code>36</code> and the <strong>kvm</strong> group is fixed to a GID of <code>36</code>.</p>
</div>
<div class="paragraph">
<p>If UID <code>36</code> or GID <code>36</code> is already used by another account on the system a conflict will arise during installation of the <code>vdsm</code> and <code>qemu-kvm-rhev</code> packages.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="legal-notice">Appendix G: Legal notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certain portions of this text first appeared in <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4/html-single/administration_guide/">Red Hat Virtualization 4.4 Administration Guide</a>. Copyright  2021 Red Hat, Inc. Licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 Unported License</a>.</p>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2682/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2682/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2682/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2682/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/administration_guide/&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/documentation/administration_guide/index.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
