<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Testing ovirt-engine patches with Lago | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Testing ovirt-engine patches with Lago" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3007/develop/infra/testing/lago/testing-engine-patches-with-lago.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3007/develop/infra/testing/lago/testing-engine-patches-with-lago.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Testing ovirt-engine patches with Lago" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Testing ovirt-engine patches with Lago","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3007/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3007/develop/infra/testing/lago/testing-engine-patches-with-lago.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3007/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3007/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3007/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3007/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3007/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3007/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3007/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3007/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3007/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3007/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3007/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3007/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3007/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3007/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3007/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3007/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3007/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3007/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3007/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3007/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3007/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3007/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3007//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3007//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3007/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3007/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3007/develop/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3007/develop/infra/testing/">
              <span property="name">Testing</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3007/develop/infra/testing/lago/">
              <span property="name">Lago</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Rafael Martins">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"><a rel="author" href="https://twitter.com/rafaelmartins" title="Rafael Martins">Rafael Martins</a></span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>This developer documentation is <strong>outdated</strong>, but provides historical context.<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3007/documentation/'>Documentation is available here.</a></div>

<h1 id="testing-ovirt-engine-patches-with-lago">Testing ovirt-engine patches with Lago</h1>

<h2 id="introduction">Introduction</h2>

<p><a href="http://lago.readthedocs.io/">Lago</a> is an ad-hoc virtual testing environment framework, that can be used to test ovirt-engine patches using the <a href="http://ovirt-system-tests.readthedocs.io/en/latest/">ovirt-system-tests</a> test suites. Lago can handle the setup of ovirt-engine as well as virtual machine hosts and storage.</p>

<p>This guide will describe how to adapt ovirt-system-tests test suites, that are mainly designed for CI testing, to manually test ovirt-engine patches.</p>

<p>This guide assumes that you have lago and all the ovirt-system-tests requirements installed on your machine, <a href="https://ovirt-system-tests.readthedocs.io/en/latest/">according to the documentation</a>, and that you got yourself previously familiarized with ovirt-system-tests.</p>

<h2 id="creating-the-test-suite">Creating the test suite</h2>

<p>ovirt-system-tests is composed by several test suites designed for CI testing. To test our patches, we will copy one of these test-suites and change it to suit our needs.</p>

<p>The first thing to do is select which test suite can be used as base for our manual test. This guide will be testing a patch for ovirt-engine’s master branch, then it will be based on <code class="language-plaintext highlighter-rouge">basic_suite_master</code>.</p>

<p>Inside the ovirt-system-tests repository, copy the test suite directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cp -r basic_suite_master manual_suite_master
</code></pre></div></div>

<p>Now we need to edit the Lago initialization file. This file is usually a symlink to a common initialization file. We will copy the actual file, so we can change it.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd manual_suite_master
$ cp --remove-destination $(realpath LagoInitFile.in) LagoInitFile.in
</code></pre></div></div>

<p>Edit the <code class="language-plaintext highlighter-rouge">LagoInitFile.in</code> file to suit your needs. Easier way to do it is keep the predefined machines and just edit their parameters, if they are reasonable for your tests. If you need more machines to reproduce a real environment, or less machines to save resources, you’ll need to edit the test scenarios later.</p>

<h2 id="editing-test-scenarios">Editing test scenarios</h2>

<p>ovirt-system-tests’ suites come with test scenarios, that are ran by Lago. As our base test suite was designed to test ovirt-engine setup, these steps are part of test scenarios, not of deployment scripts. We will still need to run these tests to get engine up and running.</p>

<p>We need to remove the tests that are not doing engine setup. Please note that, depending on the patch you are testing, you may want to keep those tests/update them to test the new behaviour introduced by your patch):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd test-scenarios
$ rm 004_basic_sanity.py 005_aaa-ldap.py
</code></pre></div></div>

<p>Also, if you added or removed machines in the Lago initialization file, you’ll need to edit <code class="language-plaintext highlighter-rouge">002_bootstrap.py</code> to reflect the new environment, implementing the code needed to add the new machines to the engine. You may also want to check the engine-setup answer file used by <code class="language-plaintext highlighter-rouge">001_initialize_engine.py</code> and modify it if you need some different answers.</p>

<h2 id="preparing-a-build-with-your-patch">Preparing a build with your patch</h2>

<p>To be able to use your modifications in lago, you must build a modified RPM. Lago is built on <a href="https://repoman.readthedocs.io/en/latest/">repoman</a>, so it can fetch RPMs from several places, including <a href="https://jenkins.ovirt.org/">oVirt Jenkins instance</a>.</p>

<p>The easier way to build an RPM is using jenkins’ <code class="language-plaintext highlighter-rouge">build-artifacts</code> jobs, but they take around 1 hour to run, and the artifacts will be removed after some time. You must also consider that these jobs are used by the scheduled jobs that update the <code class="language-plaintext highlighter-rouge">ovirt-master-snapshot</code> repository, then your job may need to wait on the build queue.</p>

<p>For this example we will use the following job: <a href="https://jenkins.ovirt.org/job/ovirt-engine_4.3_build-artifacts-el7-x86_64/">https://jenkins.ovirt.org/job/ovirt-engine_4.3_build-artifacts-el7-x86_64/</a>.</p>

<p>To build a Gerrit patch manually on it, you must authenticate and click on the “Build with Parameters” link. It will ask for two paramenters:</p>

<ul>
  <li>GERRIT_REFSPEC: Go to your Gerrit patch and click on Download. The URLs have the git refspec, that looks similar to <code class="language-plaintext highlighter-rouge">refs/changes/54/64454/1</code>. This is the value you need.</li>
  <li>GERRIT_BRANCH: No need to change.</li>
</ul>

<p>When it is done, artifacts will be attached to the build page. You will need the build page URL, that looks similar to <code class="language-plaintext highlighter-rouge">https://jenkins.ovirt.org/job/ovirt-engine_4.3_build-artifacts-el7-x86_64/424/</code>.</p>

<p>If you want to build locally, just create the RPM as usual, and use its path instead of the Jenkins URL in the next steps.</p>

<h2 id="running-the-test-suite">Running the test suite</h2>

<p>To run the test suite with the custom patch, run:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd ../../
$ ./run_suite.sh -s $CUSTOM_BUILD_URL manual_suite_master
</code></pre></div></div>

<p>Where <code class="language-plaintext highlighter-rouge">$CUSTOM_BUILD_URL</code> is your Jenkins URL or the path to your custom RPM</p>

<p>If everything was done correctly, Lago will deploy your environment with your custom package, will run the 2 first test scenarios to do the basic setup, and will keep the environment running, so you can do your manual tests. You will want to check Lago documentation to see how to tunnel the engine service to your local machine, so you can use it in your browser.</p>

<h2 id="cleaning-up">Cleaning up</h2>

<p>When you are done, you can kill the environment with the following command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./run_suite.sh -c manual_suite_master
</code></pre></div></div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3007/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3007/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3007/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3007/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/infra/testing/lago/testing-engine-patches-with-lago.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/infra/testing/lago/testing-engine-patches-with-lago.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
