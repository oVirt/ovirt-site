<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>User Portal Permissions | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="User Portal Permissions" />
<meta name="author" content="Allon Mureinik" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2926/develop/release-management/features/infra/user-portal-permissions.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2926/develop/release-management/features/infra/user-portal-permissions.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="User Portal Permissions" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Allon Mureinik" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Allon Mureinik"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"User Portal Permissions","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2926/images/logo.svg"},"name":"Allon Mureinik"},"url":"https://ovirt.github.io/ovirt-site/previews/2926/develop/release-management/features/infra/user-portal-permissions.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2926/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2926/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2926/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2926/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2926/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2926/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2926/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2926/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2926/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2926/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2926/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2926/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2926/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2926/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2926/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2926/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2926/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2926/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2926/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2926/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2926/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2926/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2926//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2926//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2926/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2926/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2926/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2926/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2926/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/869d772390b0b317e4b37bb0714ab68e?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/869d772390b0b317e4b37bb0714ab68e?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Allon Mureinik</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8c026e3f09c38f3f685f886fc95f1dc9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8c026e3f09c38f3f685f886fc95f1dc9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ewoud Kohl van Wijngaarden</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Livnat Peer</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Oved Ourfali</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2926/documentation/'>Documentation is available here.</a></div>

<h1 id="user-portal-permissions">User Portal Permissions</h1>

<h2 id="summary">Summary</h2>

<p>This page details how the User Portal decides what objects to display, specifically in relation to create permissions.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Allon Mureinik</li>
  <li>Email: amureini@redhat.com</li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Status: Released in oVirt 3.1</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<h3 id="query-permissions-and-integration-with-mla">Query Permissions and Integration with MLA</h3>

<p>For each query the engine will manage <code class="language-plaintext highlighter-rouge">queryType</code>, which can be either an Admin query or a User query. Admin query means only admins can execute the query, while User query means that any user can execute the query (administrators included). In addition to the <code class="language-plaintext highlighter-rouge">queryType</code> a parameter, an <code class="language-plaintext highlighter-rouge">isFiltered</code> parameter will be added to the <code class="language-plaintext highlighter-rouge">VdcQueryParametersBase</code> class. This parameter will govern if the query is executed in filtered mode (and should return only the objects the user has user permissions on) or not (and as such should return all the objects). The default is that <code class="language-plaintext highlighter-rouge">isFiltered</code> is set to <code class="language-plaintext highlighter-rouge">false</code>, due to backwards compatibility considerations.</p>

<p>Permission checking will be done in two levels:</p>

<ol>
  <li>Authorization - before executing the query: validating a user is an administrator (i.e., has at least one administrator role) if the query is an Admin query or if <code class="language-plaintext highlighter-rouge">isFiltered</code> is set to <code class="language-plaintext highlighter-rouge">false</code>.</li>
  <li>Filtering - as part of the query execution: joining the “business logic” of the query to a permissions view, providing a single point of entry to managing permission logic.</li>
</ol>

<h3 id="vdcquerytype-enum"><code class="language-plaintext highlighter-rouge">VdcQueryType</code> enum</h3>

<p>A property <code class="language-plaintext highlighter-rouge">queryType</code> will be added to the enum. Most queries are not available to users so the default will be <code class="language-plaintext highlighter-rouge">admin</code>.</p>

<h3 id="vdcqueryparametersbase"><code class="language-plaintext highlighter-rouge">VdcQueryParametersBase</code></h3>

<p>From now on, it will be possible to specify if the query should be executed in admin or in filtered mode. The default will be to execute as admin, for backwards compatibility reasons.</p>

<h3 id="running-a-query">Running a Query</h3>

<p>In case of an admin query (be it due to the query’s internal type or to a request to run as an admin), the query will perform a minimal authorization check to see if the user may execute such queries.</p>

<h3 id="daos">DAOs</h3>

<p>Each method used by a user query will be overloaded with two additional parameters - <code class="language-plaintext highlighter-rouge">userID</code> and <code class="language-plaintext highlighter-rouge">isFiltered</code>. E.g., we would like to have a filtered version of <code class="language-plaintext highlighter-rouge">GetVmInterfacesByVmIdQuery</code>, which uses <code class="language-plaintext highlighter-rouge">VmNetworkInterfaceDAO.getAllForVm(Guid vmID)</code>, so we will overload this method and create <code class="language-plaintext highlighter-rouge">VmNetworkInterfaceDAO.getAllForVm(Guid vmID, Guid userID, boolean isFiltered)</code>.</p>

<h4 id="hibernate-dao-implementations">Hibernate DAO implementations</h4>

<p>Currently, will not be supported. If necessary, an additional method that throws <code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code>, and a test that verifies this exception is thrown so when the Hibernate DAO will be implemented that test will break, and the implementor will remember to implement this method too.</p>

<h3 id="permissions-views">Permissions Views</h3>

<p>A set of n flat views (one per entity type) will be created. The view will hold the <code class="language-plaintext highlighter-rouge">user_id</code> and <code class="language-plaintext highlighter-rouge">entity_id</code> and fields will implement the flattened logic of permissions. E.g., if it’s decided that permissions on pool grant read permissions on the VMs inside it, this will be exposed in the <code class="language-plaintext highlighter-rouge">vm_permissions_view</code> view. Each query implementation will be responsible for joining with the appropriate permissions view. Thus, permission-checking logic will only be implemented in a single place (per type, unfortunately) instead of inside each query.</p>

<h3 id="stored-procedures">Stored Procedures</h3>

<p>Each stored procedure used by a user query will have two parameters added to it - <code class="language-plaintext highlighter-rouge">user_id (UUID)</code> and <code class="language-plaintext highlighter-rouge">is_filtered (boolean)</code>.</p>

<h3 id="inheriting-permissions">Inheriting Permissions</h3>

<p>Today, the User Portal exposes all the objects under an entity if any permission is given on that entity or on the reflecting entities (add link to explanation what is reflecting entities). This behaviour is correct for “manipulate” and “use” permission, but not for “create” permissions. E.g. If a user has the permissions to create a VM in a cluster, he should not be able to see all the VMs in that cluster.</p>

<p>In the suggested solution, an additional column, <code class="language-plaintext highlighter-rouge">allows_viewing_children</code> (<code class="language-plaintext highlighter-rouge">boolean</code>) will be added to the <code class="language-plaintext highlighter-rouge">roles_groups</code> table. Only action groups with <code class="language-plaintext highlighter-rouge">allows_viewing_children=true</code> will provide permissions on the objects contained in the object they are granted on.</p>

<p>Following is a detailed description of the behavior for each entity type.</p>

<ul>
  <li>Data Center - Create VM/Template permission will not grant the ability to view VMs/Templates in the DC.</li>
  <li>Cluster - Create VM/Template permission will not grant the ability to view VMs/Templates in the cluster.</li>
  <li>Storage Domain - Create VM/Template/Disk permission will not grant the ability to view objects contained in the storage domain.</li>
</ul>

<h4 id="creator-roles">Creator Roles</h4>

<p>Two new predefined roles should be added - VM Creator and Template Creator, which only contain the action groups for adding VMs/Templates, respectively, and do not allow users to manipulate existing entities. These new roles will be the way administrators will grant their users the ability to create new VMs/Templates without exposing existing ones. For disks, the existing role Disk Creator will be used.</p>

<h4 id="operator-roles">Operator Roles</h4>

<p>For the modification of an existing templates/vms/disks the VM ADMIN, TEMPLATE ADMIN and DISK ADMIN roles should be given to a user who issues a CreateVMTempalteCommand on the template he created.</p>

<h3 id="entity-description">Entity Description</h3>

<p>No new entities are required for this feature.</p>

<h3 id="crud">CRUD</h3>

<p>No new entities are required for this feature.</p>

<h3 id="user-experience">User Experience</h3>

<p>See Inheriting Permissions.</p>

<h3 id="installationupgrade">Installation/Upgrade</h3>

<p>The three new predefined roles should be created.</p>

<h3 id="user-work-flows">User work-flows</h3>

<h4 id="adding-a-vm">Adding a VM</h4>

<ol>
  <li>The admin grants the VM Creator permission to a user on a host/cluster</li>
  <li>The user can create a new VM on the host/cluster</li>
  <li>Once the user creates the VM, he becomes a VM Operator on this VM</li>
</ol>

<h3 id="events">Events</h3>

<p>No new events are added.</p>

<h2 id="dependencies--related-features-and-projects">Dependencies / Related Features and Projects</h2>

<h3 id="rest-api">REST API</h3>

<p>As part of the user level queries changes, we also added user-level API capabilities to the REST API.
Before these changes, only administrators could login to the API. Now, you can logic as a regular user as well, by specifying the “filter: true” HTTP header.
For example, as a user, in order to get all your VMs through the API you can do the following:</p>

<p><code class="language-plaintext highlighter-rouge">curl http://engine-address:engine-port/api/vms -u "user@domain":password -H</code> <strong><code class="language-plaintext highlighter-rouge">"filter: true"</code></strong></p>

<p>The following endpoints are supported:</p>

<ul>
  <li>/api</li>
  <li>/api/vms</li>
  <li>/api/clusters</li>
  <li>/api/datacenters</li>
  <li>/api/roles</li>
  <li>/api/storagedomains</li>
  <li>/api/templates</li>
  <li>/api/domains</li>
  <li>/api/capabilities</li>
</ul>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p><a href="/ovirt-site/previews/2926/develop/developer-guide/engine/writing-a-new-user-query.html">Writing A New User
Query</a></p>

<h2 id="open-issues">Open Issues</h2>

<ul>
  <li>Should Create Host permissions be inherited for viewing?</li>
  <li>Should we grant VM/Template Creator to any user who is a VM/Template Admin?</li>
  <li>How do Disk Permissions integrate with this solution?</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2926/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2926/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2926/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2926/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/user-portal-permissions.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/infra/user-portal-permissions.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
