<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Backup-Restore API Integration | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Backup-Restore API Integration" />
<meta name="author" content="Andrew Dahms" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2851/develop/release-management/features/storage/backup-restore-api-integration.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2851/develop/release-management/features/storage/backup-restore-api-integration.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Backup-Restore API Integration" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Dahms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew Dahms"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Backup-Restore API Integration","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2851/images/logo.svg"},"name":"Andrew Dahms"},"url":"https://ovirt.github.io/ovirt-site/previews/2851/develop/release-management/features/storage/backup-restore-api-integration.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2851/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2851/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2851/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2851/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2851/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2851/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2851/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2851/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2851/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2851/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2851/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2851/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2851/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2851/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2851/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2851/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2851/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2851/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2851/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2851/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2851/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2851/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2851//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2851//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2851/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2851/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2851/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2851/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2851/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Dahms</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9e57b717174453404c080ead99e2186c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9e57b717174453404c080ead99e2186c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Adam Litke</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/df31c3a16c31d8322c6ecc1334a56698?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/df31c3a16c31d8322c6ecc1334a56698?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Deepak C Shetty</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8f07947836874690665b49430a562713?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8f07947836874690665b49430a562713?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Liron Aravot</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Maor Lipchuk</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9ce16285ca710b3eb5359debcf804d4e?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9ce16285ca710b3eb5359debcf804d4e?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sean Cohen</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7d273672199e572a65e45566637a5b8c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7d273672199e572a65e45566637a5b8c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sharad Mishra</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/e0828325fe5b0b21f26af67deee61123?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/e0828325fe5b0b21f26af67deee61123?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yaniv Dary</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2851/documentation/'>Documentation is available here.</a></div>

<h1 id="backup-restore-api-integration">Backup-Restore API Integration</h1>

<h2 id="backup-and-restore-api-for-independent-software-vendors">Backup and Restore API for Independent Software Vendors</h2>

<h3 id="summary">Summary</h3>

<p>This feature provides the ability for ISVs to back up and restore virtual machines.
A new set of APIs will be introduced in oVirt to facilitate taking full virtual machine backups, and full or file-level restoration of virtual machines.
Backup and Restore will be REST API driven (and not GUI/User driven).</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Feature owner: Ayal Baron <a href="mailto:abaron@redhat.com">abaron@redhat.com</a></li>
  <li>Engine Component owner: Liron Aravot <a href="mailto:laravot@redhat.com">laravot@redhat.com</a></li>
  <li>VDSM Component owner: Federico Simoncelli <a href="mailto:fsimonce@redhat.com">fsimonce@redhat.com</a></li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<p>The backup API provides a set of operations that can be used for implementing a backup solution for virtual machines and data using oVirt.</p>

<h3 id="high-level-architecture">High Level Architecture</h3>

<p>The Backup Appliance can be in the form of a Virtual Appliance (VirtApp) or Host Appliance (HostApp). <strong>Currently we are targetting VirtApp usecase, HostApp usecase will be targetted later.</strong> Backup &amp; Restore API will can be driven by API while some functionalities would be available by GUI as well. Backup/Restore software from ISV will drive these APIs.</p>

<h2 id="vm-backuprestore-suggested-flows">VM Backup/Restore suggested flows</h2>

<h3 id="general-background">General Background</h3>

<p>The oVirt snapshot feature provides the ability to capture the status of a virtual machine at a specific point in time.
The snapshot contains the virtual machine configuration and its disks data in a static way
The underlying operation is to create for each disk in the virtual machine a new volume that will be based on the previous volume using qcow2 format, the original volume will becomes R/O and the new volume will only indicate the differences from the original volume.</p>

<p>The backup API use the snapshot feature to provide a temporary volume on the backup appliance.
The temporary volume will act as an active volume based on the destination snapshot of the virtual machine about to be backed up.
The new temporary volume will provide the backup appliance access to the virtual machine data.
This snapshot which is created as part of the backup API will not be exposed to the user, but will only be exposed at the system level and by the API to the backup appliance.</p>

<h3 id="full-vm-backups">Full VM Backups</h3>

<p>Full VM backup can be implemented for example by using the following oVirt capabilities:</p>

<ol>
  <li>Take a snapshot of the virtual machine to be backed up - (existing oVirt REST API operation)</li>
  <li>Back up the virtual machine configuration at the time of the snapshot (the disk configuration can be backed up as well if needed) - (added capability to oVirt as part of the Backup API)</li>
  <li>Attach the disk snapshots that were created in (1) to the virtual appliance for data backup - (added capability to oVirt as part of the Backup API)</li>
  <li>Data can be backed up</li>
  <li>Detach the disk snapshots that were attached in (3) from the virtual appliance - (added capability to oVirt as part of the Backup API)</li>
</ol>

<h4 id="example-for-vm-backup">Example for VM Backup</h4>

<ul>
  <li>Use existing VM Snapshot/Create a vm snapshot (example):</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/VM_ID/snapshots</code>
<code class="language-plaintext highlighter-rouge">Method = POST (with Content-Type:application/xml header)</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;snapshot&gt;</span>
  <span class="nt">&lt;description&gt;</span>Virtual Machine 1 - Snapshot For Backup<span class="nt">&lt;/description&gt;</span>
<span class="nt">&lt;/snapshot&gt;</span>
</code></pre></div></div>

<ul>
  <li>Grab the wanted vm configuration from the needed snapshot - it’ll be under initialization/configuration/data</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/VM_ID/snapshots/ID</code>
<code class="language-plaintext highlighter-rouge">Method = GET  (with All-Content:true header)</code></p>

<ul>
  <li>Navigate to the wanted disk snapshot by accessing: (<a href="#get-disk-snapshot-data">Example</a>)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">SERVER:PORT/api/vms/GUID/snapshots/GUID/disks</code></p>

<ul>
  <li>Attach the disk snapshot to the vm using the disk id and the snapshot id: (<a href="#attach-disk-to-backup-vm">Example</a>)</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/GUID/disks/</code>
<code class="language-plaintext highlighter-rouge">Method = POST (with Content-Type:application/xml header)</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;disk</span> <span class="na">id=</span><span class="s">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;snapshot</span> <span class="na">id=</span><span class="s">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/disk&gt;</span>
</code></pre></div></div>

<p><strong>note</strong>: you can attempt to plug the disk to the vm by adding <code class="language-plaintext highlighter-rouge">&lt;active&gt;true&lt;/active&gt;</code> to the request body,
 otherwise you’ll need to plug/activate it manually so that the data will be available for the backup.</p>

<ul>
  <li>if needed activate/plug the disk manually (depending on how the previous step was executed):</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/VM_ID/disks/DISK_ID/activate</code>
<code class="language-plaintext highlighter-rouge">Method = POST</code></p>

<ul>
  <li>After copying the data from the disk detach the disk snapshot from the VM using the REST with the following parameters (<a href="#detach-disk-from-backup-vm">Example</a>):</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/GUID/disks/GUID</code>
<code class="language-plaintext highlighter-rouge">Method = DELETE</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;action&gt;</span>
 <span class="nt">&lt;detach&gt;</span>true<span class="nt">&lt;/detach&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div></div>

<h3 id="full-virtual-machine-restoration">Full Virtual Machine Restoration</h3>

<ol>
  <li>Create disks for restore</li>
  <li>Attach the disks for restore to the virtual appliance (Restore the data to it)</li>
  <li>Detach the disks from the virtual appliance.</li>
  <li>Create a vm using the configuration that was saved as part of the backup flow - (added capability to oVirt as part of the Backup API)</li>
  <li>Attach the restored disks to the created vm.</li>
</ol>

<h4 id="example-of-virtual-machine-restoration">Example of Virtual Machine Restoration</h4>

<ol>
  <li>
    <p>Create a disk to restore the data to:</p>
  </li>
  <li>
    <p>Attach the disk to the virtual appliance:</p>
  </li>
</ol>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/GUID/disks/</code>
<code class="language-plaintext highlighter-rouge">Method = POST (with Content-Type:application/xml header)</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;disk</span> <span class="na">id=</span><span class="s">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="nt">&gt;&lt;/disk&gt;</span>
</code></pre></div></div>

<ol>
  <li>After copying the data from the disk detach the disk from the VM: (<a href="#detach-disk-from-backup-vm">Example</a>):</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/GUID/disks/GUID</code>
<code class="language-plaintext highlighter-rouge">Method = DELETE</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;action&gt;</span>
 <span class="nt">&lt;detach&gt;</span>true<span class="nt">&lt;/detach&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div></div>

<ol>
  <li>Create a vm using the configuration that was saved as part of the backup flow:</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">URL = SERVER:PORT/api/vms/</code>
<code class="language-plaintext highlighter-rouge">Method = POST(with Content-Type:application/xml header)</code></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;vm&gt;</span>
 <span class="nt">&lt;cluster&gt;</span>
  <span class="nt">&lt;name&gt;</span>cluster_name<span class="nt">&lt;/name&gt;</span>
 <span class="nt">&lt;/cluster&gt;</span>
 <span class="nt">&lt;initialization&gt;</span>
  <span class="nt">&lt;configuration&gt;</span>
   <span class="nt">&lt;type&gt;</span>ovf<span class="nt">&lt;/type&gt;</span>
    <span class="nt">&lt;data&gt;</span>
     <span class="cp">&lt;![CDATA[..... ]]&gt;</span>
    <span class="nt">&lt;/data&gt;</span>
  <span class="nt">&lt;/configuration&gt;</span>
 <span class="nt">&lt;/initialization&gt;</span>
 <span class="nt">&lt;name&gt;</span>OVERRIDING_NAME<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;/vm&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>The OVF configuration should be passed within CDATA block or after
escaping to prevent error in the parsing of the request.</p>
  </li>
  <li>
    <p>Note that any of the vm properties can be modified during that request by specifying it within the value (the given 
example is with the vm name overridden).</p>
  </li>
</ul>

<h4 id="difference-between-virtual-appliance-and-host-appliance">Difference between Virtual appliance and Host appliance</h4>

<p>Currently per the design, the difference is in the way that the data is would be exposed/restored. Backup - the disks snapshot for backup should be exposed on some host so it could be mounted and backed up through the needed HostApp with the backup software. Restore - an ability to restore the data to an ovirt disk should be introduced.</p>

<h3 id="file-level-backup-and-restoration">File-Level Backup and Restoration</h3>

<p>File level backup and restoration is essentially the same as the described virtual machine backup and restoration flows - as soon as the data is accessible by the backup provider, the required files can be backed up or restored.</p>

<h3 id="lan-free-backup">LAN Free Backup</h3>

<p>Support for LAN-Free backup: oVirt provides SAN access to the disk devices out of the box.</p>

<h3 id="user-interface">User Interface</h3>

<p>N/A</p>

<h3 id="current-status">Current Status</h3>

<ul>
  <li>Live snapshot : Done. Available in oVirt.</li>
  <li>Live Merge: Done. Available in oVirt.</li>
  <li>Guest Quiesce for Application-Level Consistency in Windows/Linux via Guest Agent: Done. Available in oVirt.</li>
  <li>VDSM support : <a href="http://gerrit.ovirt.org/#/q/status:open+project:vdsm+branch:master+topic:backup-restore,n,z">http://gerrit.ovirt.org/#/q/status:open+project:vdsm+branch:master+topic:backup-restore,n,z</a></li>
  <li>oVirt Engine / API support :
    <ul>
      <li>Attach/Detach/Hotplug/Hotunplug Disk snapshot to a vm: <a href="http://gerrit.ovirt.org/#/c/17679/">http://gerrit.ovirt.org/#/c/17679/</a></li>
      <li>Add VM from configuration : <a href="http://gerrit.ovirt.org/15894">http://gerrit.ovirt.org/15894</a></li>
      <li>Get snapshot vm ovf configuration: <a href="http://gerrit.ovirt.org/#/c/16176/">http://gerrit.ovirt.org/#/c/16176/</a></li>
    </ul>
  </li>
  <li>UI support : N/A</li>
</ul>

<h3 id="this-feature-will-be-implemented-in-phases">This feature will be implemented in phases:</h3>

<ol>
  <li>Phase 1 will cover full backup and restoration for VirtApp use case and single-file-level restoration, as well will cover HostApp use case and guest quiesce for application-level consistency. The oVirt Backup and Restore API will provide integration with Microsoft Windows Volume Shadow Copy Service (VSS) using QEMU-GA. QEMU-GA provides VSS support, and live snapshot automatically tries to quiesce whenever possible. (The VSS provider registration will be made in the guest level as part of the Guest Tools deployment.)</li>
  <li>Phase 2 will cover Change Block Tracking (CBT) to cover incremental backups. This also depends on the ongoing community work in qemu block layer to provide differential information.</li>
</ol>

<h3 id="recommendations">Recommendations:</h3>

<ul>
  <li>Block Device ID management considerations: method to track the device ID once attached to the Backup virtual appliance.</li>
  <li>We should just name the snapshot with a proper prefix (e.g. “TSM Backup”) to make it clear what it’s about.</li>
</ul>

<h3 id="future-work">Future Work</h3>

<p>See phases section above</p>

<h4 id="incremental-virtual-machine-backups">Incremental Virtual Machine Backups</h4>

<p>Back up only the virtual machine data that has changed since the last backup. All data is backed up at the disk block level.</p>

<h4 id="differential-virtual-machine-backups">Differential Virtual Machine Backups</h4>

<p>Backup all the changes since the last full backup. Differential backup is a cumulative backup of all changes since last full backup. Incremental backup contains only the changes since the last incremental backup whereas differential backup contains all changes since the last FULL backup.</p>

<h3 id="open-issues">Open Issues</h3>

<h3 id="benefits-to-ovirt">Benefits to oVirt</h3>

<p>Complete API providing ability to do full , file-level &amp; incremental backups/restores of a running VM.</p>

<h3 id="documentation--external-references">Documentation / External references</h3>

<ul>
  <li><a href="/ovirt-site/previews/2851/develop/release-management/features/storage/live-merge.html">LiveMerge</a></li>
</ul>

<h2 id="appendix">Appendix</h2>

<h4 id="python-sdk-examples">Python SDK examples</h4>

<p><a href="https://github.com/laravot/backuprestoreapi/">https://github.com/laravot/backuprestoreapi/</a></p>

<h4 id="get-disk-snapshot-data">Get disk snapshot data</h4>

<p>Navigate to the wanted disk snapshot from REST by accessing: <img src="/ovirt-site/previews/2851/images/wiki/FileRestDesc.png" alt="" /></p>

<h4 id="attach-disk-to-backup-vm">Attach disk to backup VM</h4>

<p>POST the copied disk with the disk id and the snapshot id: <img src="/ovirt-site/previews/2851/images/wiki/AttachDisk.png" alt="" /></p>

<h4 id="detach-disk-from-backup-vm">Detach disk from backup VM</h4>

<p>After the backup VM copy the data from the disk, detach the disk snapshot from the VM using the REST : <img src="/ovirt-site/previews/2851/images/wiki/DetachDisk.png" alt="" /></p>

<h4 id="add-disk-from-scratch">Add disk from scratch</h4>

<p>Adding a disk from scratch for restore VM <img src="/ovirt-site/previews/2851/images/wiki/AddDiskFromScratch.png" alt="" /></p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2851/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2851/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2851/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2851/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/backup-restore-api-integration.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/storage/backup-restore-api-integration.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
