<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>VmPinningToMultipleHosts | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="VmPinningToMultipleHosts" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2986/develop/release-management/features/sla/vmpinningtomultiplehosts.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2986/develop/release-management/features/sla/vmpinningtomultiplehosts.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="VmPinningToMultipleHosts" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"VmPinningToMultipleHosts","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2986/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2986/develop/release-management/features/sla/vmpinningtomultiplehosts.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2986/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2986/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2986/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2986/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2986/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2986/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2986/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2986/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2986/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2986/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2986/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2986/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2986/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2986/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2986/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2986/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2986/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2986/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2986/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2986/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2986/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2986/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2986//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2986//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2986/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2986/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2986/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2986/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2986/develop/release-management/features/sla/">
              <span property="name">Sla</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ef418953a8847ddb3e21e909e53dc0fc?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ef418953a8847ddb3e21e909e53dc0fc?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of David Maroshi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">David Maroshi</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2986/documentation/'>Documentation is available here.</a></div>

<h1 id="vm-pinning-to-multiple-hosts">VM Pinning To Multiple Hosts</h1>

<h3 id="summary">Summary</h3>

<p>In oVirt 3.5 it is possible to pin a VM to a specific host. The pinning functionality provides the following benefits:</p>

<ol>
  <li>Controlled physical hardware configuration for VM (e.g NUMA, CPU, NICs…).</li>
  <li>Prevent VM migration, satisfying administrative constraints. Such as: licensing, physical proximity, optimize CPU utilization, network optimization…</li>
</ol>

<p>oVirt users favor host pinning feature and wish to extend the single host pinning to multiple hosts pinning.
See this <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1107512">RFE</a>.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>
    <p>Name: Dudi Maroshi</p>
  </li>
  <li>
    <p>Email: maroshi@redhat.com</p>
  </li>
</ul>

<h3 id="general-description">General Description</h3>

<h4 id="functional-requirements">Functional requirements</h4>

<p>We name hosts group within a cluster, hosts bundle, or just bundle. The hosts bundle introduction, provides a fine grained migration domain internal to a specific cluster. Limiting specified VM migration (one or more VMs) to the hosts bundle.</p>

<p><strong>Following the rational in the general description above:</strong></p>

<ol>
  <li>User may define many bounding bundles, and assign multiple hosts (in same cluster) to bounding bundle.</li>
  <li>Hosts can be member in more than one bounding bundle.</li>
  <li>User defining a preferred starting host need to chose from the following:
    <ol>
      <li>All hosts in cluster
        <ol>
          <li>Preferred hosts (one or more) in the cluster (all hosts in cluster selection list)</li>
        </ol>
      </li>
      <li>A bounding bundle in the cluster
        <ol>
          <li>Preferred hosts (one or more) in the bounding bundle (shorter selection list)</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>The migration policy will bound the VM to the selected bounding bundle.</li>
  <li>For backward compatibility, user may pin a single host in the bounding bundle.</li>
  <li>Running VM should display its bounding hosts list. The bounding group name if exist or list of bounding host for ad-hoc group.</li>
</ol>

<p><strong>Planned Functionality levels:</strong></p>

<ol>
  <li>Provide VM pinning to multiple host functionality with REST-api</li>
  <li>Provide VM pinning to multiple host functionality with GUI</li>
  <li>Provide management of bounding bundles, and VM bounding to bundle with REST-api</li>
  <li>Provide management of bounding bundles, and VM bounding to bundle with GUI</li>
</ol>

<h3 id="detailed-description">Detailed Description</h3>

<p><strong>Functionality level 1</strong></p>

<p>Requires extensive refactoring in the data access layer and business logic due to large dependency tree.</p>

<h4 id="architecture-flows">Architecture flows</h4>

<p><strong>Functionality level 1</strong></p>

<p>Refactor the current preferred host, from single host to list of hosts. This will require change at database level, change to scheduling, change to all VM types and their management commands. Refactor REST-api structure and mapping to handle preferring multiple hosts.</p>

<h4 id="detailed-design">Detailed design</h4>

<p><strong>Functionality level 1</strong></p>

<ol>
  <li>Refactor database schema (tables, constraints, view)</li>
  <li>Refactor stored procedures to manage hosts removal consistency with VMs</li>
  <li>Refactor all VM entities to accepts list of preferred hosts</li>
  <li>Refactor data access layer to transform hosts bundle presentation from CSV text to list</li>
  <li>Refactor all references of preferred single host, to use list. Requires some logic redesign for managing: NUMA, OVF, host devices.</li>
  <li>Refactor REST-api schema and mapper. With consistency verifications.</li>
</ol>

<p><strong>Accepted XML elements for REST-api in VM element.</strong></p>

<p><strong>Single host pinning by id</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;placement_policy&gt;</span>
    <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">"bbf42054-2e5b-4f3c-8c19-e3428f5fd5c9"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;affinity&gt;</span>pinned<span class="nt">&lt;/affinity&gt;</span>
<span class="nt">&lt;/placement_policy&gt;</span>
</code></pre></div></div>

<p><strong>Single host pinning by name</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;placement_policy&gt;</span>
    <span class="nt">&lt;host&gt;&lt;name&gt;</span>"host-1"<span class="nt">&lt;/name&gt;&lt;/host&gt;</span>
    <span class="nt">&lt;affinity&gt;</span>pinned<span class="nt">&lt;/affinity&gt;</span>
<span class="nt">&lt;/placement_policy&gt;</span>
</code></pre></div></div>

<p><strong>Multiple host pinning by id</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;placement_policy&gt;</span>
    <span class="nt">&lt;hosts&gt;</span>
        <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">"bbf42054-2e5b-4f3c-8c19-e3428f5fd5c9"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;host</span> <span class="na">id=</span><span class="s">"bbf42054-2e5b-4f3c-8c19-e3428f5fd5ca"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/hosts&gt;</span>
<span class="nt">&lt;affinity&gt;</span>pinned<span class="nt">&lt;/affinity&gt;</span>
<span class="nt">&lt;/placement_policy&gt;</span>
</code></pre></div></div>

<p><strong>Multiple host pinning by name</strong></p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;placement_policy&gt;</span>
    <span class="nt">&lt;hosts&gt;</span>
        <span class="nt">&lt;host&gt;&lt;name&gt;</span>"host-1"<span class="nt">&lt;/name&gt;&lt;/host&gt;</span>
        <span class="nt">&lt;host&gt;&lt;name&gt;</span>"host-2"<span class="nt">&lt;/name&gt;&lt;/host&gt;</span>
    <span class="nt">&lt;/hosts&gt;</span>
    <span class="nt">&lt;affinity&gt;</span>pinned<span class="nt">&lt;/affinity&gt;</span>
<span class="nt">&lt;/placement_policy&gt;</span>
</code></pre></div></div>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>The business argument for multiple hosts pinning is the following:</p>

<ol>
  <li>oVirt admin wants to provide high availability for VMs running on hosts group. When hosts group share similar physical hardware configuration.</li>
  <li>oVirt admin wants to provide high availability for host with pinned VM.</li>
  <li>Prevent VM migration outside of the hosts group (see benefit 2 in previous paragraph).</li>
</ol>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>Depends on the following oVirt-engine subsystems: Database, entities, bll, GUI, REST-api</p>

<ol>
  <li>vm_static table and related views. Data access stored procedures.</li>
  <li>All business logic commands referencing preferred host. (16 commands)</li>
  <li>Scheduling manager and validators.</li>
  <li>Business entities dependant on preferred host. (VM, template, numa, host_device)</li>
</ol>

<p>Currently the implementation of NUMA pinning and Host Devices requires <strong>single</strong> host pinning. The command verification method (canDoAction) in each respective command is refactored, and a descriptive error message is provided to prevent multiple host pinning on NUMA or host device.</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2986/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2986/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2986/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2986/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/sla/vmpinningtomultiplehosts.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/sla/vmpinningtomultiplehosts.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
