<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>oVirt Metrics Store - Installation Guide | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="oVirt Metrics Store - Installation Guide" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2955/develop/release-management/features/metrics/metrics-store-installation.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2955/develop/release-management/features/metrics/metrics-store-installation.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="oVirt Metrics Store - Installation Guide" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"oVirt Metrics Store - Installation Guide","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2955/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2955/develop/release-management/features/metrics/metrics-store-installation.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2955/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2955/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2955/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2955/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2955/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2955/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2955/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2955/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2955/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2955/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2955/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2955/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2955/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2955/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2955/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2955/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2955/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2955/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2955/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2955/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2955/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2955/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2955//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2955//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2955/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2955/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2955/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2955/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2955/develop/release-management/features/metrics/">
              <span property="name">Metrics</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7994226372822da5ac75322d097186c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7994226372822da5ac75322d097186c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shirly Radco</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2955/documentation/'>Documentation is available here.</a></div>

<div class="alert alert-warning">
  <p><strong>ATTENTION: This page is no longer up to date. Please follow the link for the updated documentation:</strong>
  <br /></p>
  <ul>
    <li><a href="/ovirt-site/previews/2955/documentation/administration_guide/#monitoring_and_observability">Monitoring and observability</a></li>
  </ul>
</div>

<h1 id="ovirt-metrics---installation-guide">oVirt Metrics - Installation Guide</h1>

<p><a href="/ovirt-site/previews/2955/images/wiki/oVirtMetricsDataFlow.jpg"><img src="/ovirt-site/previews/2955/images/wiki/oVirtMetricsDataFlow.jpg" alt="oVirt Metrics data flow" /></a></p>

<h2 id="ovirt-metrics-store">oVirt metrics store</h2>

<p>The oVirt metrics store is based on OpenShift Logging (Elasticsearch, Kibana, Fluentd, Curator).</p>

<h2 id="ovirt-metrics-store-setup">oVirt Metrics Store Setup</h2>

<p><strong>Note:</strong> Currently, the oVirt Metrics Store should be installed on a new machine, separate from the engine.
It can be installed on a dedicated VM.</p>

<h3 id="metrics-store-machine-prerequisites">Metrics Store Machine Prerequisites</h3>

<p>For an oVirt environment with 50 hosts:</p>
<ul>
  <li>4 CPU cores, 16GB RAM memory .</li>
  <li>We recommends using SSD disks.</li>
  <li>CentOS 7.5.</li>
  <li>Preallocated 500GB partition - It will be used for persistent storage. Use a partition other than root (/) to avoid filling up the partition, for example, /var.</li>
  <li>
    <p>Add the Metrics Store Machine FQDN to your enterprise hostname resolution system, for example, DNS and add a wildcard dns prefix for this address.</p>
  </li>
  <li>Please make sure to follow the <a href="https://docs.okd.io/3.11/install/prerequisites.html#hardware">OpenShift <code class="language-plaintext highlighter-rouge">masters</code> prerequisites</a></li>
</ul>

<h3 id="update-configyml-file">Update config.yml file</h3>

<ol>
  <li>
    <p>Copy  /etc/ovirt-engine-metrics/config.yml.example  to config.yml.</p>

    <p>On the oVirt engine machine, run:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> # cp /etc/ovirt-engine-metrics/config.yml.example /etc/ovirt-engine-metrics/config.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Update the file /etc/ovirt-engine-metrics/config.yml located on the engine machine, with the following lines:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> # vi /etc/ovirt-engine-metrics/config.yml.d/config.yml
</code></pre></div>    </div>
  </li>
  <li>
    <p>Update the values to match the details of your specific environment:</p>
  </li>
</ol>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ovirt_env_name:</code> <strong>Please update this variable</strong>.</p>

    <p>Environment name. It is used to identify data collected in a single central
store, sent from more than one oVirt engine.</p>

    <p>Use the following convention:</p>

    <ul>
      <li>Include only alphanumeric characters and hyphens ( “-“ ).</li>
      <li>Name cannot begin with a hyphen or a number, or end with a hyphen.</li>
      <li>Maximum of 49 characters. Wildcard patterns (e.g. ovirt-metrics*) cannot be used.</li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">elasticsearch_host:</code> (required - no default value)</p>

    <p>Address or hostname (FQDN) of the Elasticsearch server host.</p>
  </li>
</ul>

<h2 id="variables--for-installing-the-ovirt-metrics-store">Variables  for installing the oVirt metrics store</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">openshift_distribution:</code>(default: <code class="language-plaintext highlighter-rouge">origin</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_ansible_files_path:</code>(default: <code class="language-plaintext highlighter-rouge">/root</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">ovirt_elasticsearch_mounted_storage_path:</code>(default:<code class="language-plaintext highlighter-rouge">/var/lib</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">engine_url:</code>(Mandatory. No default )</li>
  <li><code class="language-plaintext highlighter-rouge">engine_user:</code>(Mandatory. No default )`</li>
  <li><code class="language-plaintext highlighter-rouge">engine_password:</code>(Mandatory. No default )</li>
  <li><code class="language-plaintext highlighter-rouge">engine_insecure:</code>(default: <code class="language-plaintext highlighter-rouge">true</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">engine_cafile:</code>(No default )</li>
  <li><code class="language-plaintext highlighter-rouge">public_hosted_zone:</code>(No default )</li>
  <li><code class="language-plaintext highlighter-rouge">create_host_entry:</code>(default: <code class="language-plaintext highlighter-rouge">false</code> )</li>
  <li><code class="language-plaintext highlighter-rouge">root_password:</code>(default: <code class="language-plaintext highlighter-rouge">admin</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">ovirt_cluster_name:</code>(default: <code class="language-plaintext highlighter-rouge">Default</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_ovirt_storage_domain_name:</code>(default: <code class="language-plaintext highlighter-rouge">hosted_storage</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_ovirt_bastion_machine_name:</code>(default: <code class="language-plaintext highlighter-rouge">metrics-store-installer</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_ovirt_all_in_one:</code>(default: <code class="language-plaintext highlighter-rouge">true</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">number_of_openshift_master_vms:</code>(default: <code class="language-plaintext highlighter-rouge">1</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">number_of_openshift_node_vms:</code>(default: <code class="language-plaintext highlighter-rouge">0</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">number_of_openshift_compute_vms:</code>(default: <code class="language-plaintext highlighter-rouge">0</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">number_of_openshift_lb_vms:</code>(default: <code class="language-plaintext highlighter-rouge">0</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_logging_es_cluster_size:</code>(default: 1)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_logging_es_number_of_replicas:</code>(default: 0)</li>
  <li><code class="language-plaintext highlighter-rouge">elasticsearch_disk_size:</code>(default: <code class="language-plaintext highlighter-rouge">500GiB</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_logging:</code> (default:<code class="language-plaintext highlighter-rouge">true</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">template_name:</code> (default:<code class="language-plaintext highlighter-rouge">rhelguest76</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">template_memory:</code> (default:<code class="language-plaintext highlighter-rouge">4GiB</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">template_cpu:</code> (default:2)</li>
</ul>

<h3 id="additional-mandatory-variables-for-red-hat-virtualization">Additional mandatory variables for Red Hat Virtualization:</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">qcow_url:</code>( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_user:</code>( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_pass:</code>( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_pool:</code>( default: [] )</li>
  <li><code class="language-plaintext highlighter-rouge">qcow_url:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_user:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_pass:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">rhsub_pool:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">openshift_rhsub_pool:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">oreg_auth_user:</code> ( No default )</li>
  <li><code class="language-plaintext highlighter-rouge">oreg_auth_password:</code> ( No default )</li>
</ul>

<h3 id="run-ovirt-metrics-store-installation-playbook">Run ovirt-metrics-store-installation playbook</h3>

<p>This playbook creates the vm(s) and generates the files required for the metrics store installation and copies them
to the metrics store machine.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    # /usr/share/ovirt-engine-metrics/setup/ansible/configure_ovirt_machines_for_metrics.sh \
    --playbook=ovirt-metrics-store-installation.yml
</code></pre></div></div>

<h3 id="metrics-store-installation">Metrics Store Installation</h3>

<p>Please follow the metrics store installation instructions: <a href="/ovirt-site/previews/2955/develop/release-management/features/metrics/setting-up-viaq-logging.html">Metrics Store setup on top of OpenShift</a></p>

<p>Once you have finished this step, you should have:</p>

<ul>
  <li>Kibana - <code class="language-plaintext highlighter-rouge">https://kibana.{elasticsearch_host}</code></li>
  <li>OpenShift portal - <code class="language-plaintext highlighter-rouge">https://{elasticsearch_host}:8443</code></li>
</ul>

<h2 id="ovirt-hypervisors-and-engine-setup">oVirt Hypervisors and Engine Setup</h2>

<p>Please follow the instructions: <a href="/ovirt-site/previews/2955/develop/release-management/features/metrics/hypervisors-and-engine-setup.html">Deploy Collectd and Rsyslog on Hypervisors and Engine</a></p>

<h2 id="example-dashboards">Example Dashboards</h2>

<p>Kibana should be available at <code class="language-plaintext highlighter-rouge">https://kibana.{elasticsearch_host}</code></p>

<p>Dashboard examples include <code class="language-plaintext highlighter-rouge">System Dashboard</code>, <code class="language-plaintext highlighter-rouge">Hosts Dashboard</code>, <code class="language-plaintext highlighter-rouge">VMs Dashboard</code>, <code class="language-plaintext highlighter-rouge">Processes Dashboard</code>.</p>

<p>If you wish to import dashboards example, you will need to import visualization and dashboards manually from the Kibana UI.</p>

<ol>
  <li>
    <p>Copy the /etc/ovirt-engine-metrics/dashboards-examples directory to your local machine.</p>
  </li>
  <li>
    <p>Go to the Kibana UI, to the <code class="language-plaintext highlighter-rouge">setting</code> tab -&gt; <code class="language-plaintext highlighter-rouge">indices</code>.</p>
  </li>
  <li>
    <p>In the Kibana UI, go to the <code class="language-plaintext highlighter-rouge">setting</code> tab -&gt; <code class="language-plaintext highlighter-rouge">objects</code>.</p>
  </li>
  <li>
    <p>Import the <code class="language-plaintext highlighter-rouge">Searches</code>.</p>
  </li>
  <li>
    <p>Import the <code class="language-plaintext highlighter-rouge">Visualizations</code>.</p>
  </li>
</ol>

<p><strong>Note:</strong> If you get an error while loading the <code class="language-plaintext highlighter-rouge">Visualizations</code>, check your hosts and make sure Collectd and Rsyslog services are running with no errors. After that try loading the <code class="language-plaintext highlighter-rouge">Visualizations</code> again.</p>

<ol>
  <li>
    <p>Import the <code class="language-plaintext highlighter-rouge">Dashboards</code>.</p>
  </li>
  <li>
    <p>Select the <code class="language-plaintext highlighter-rouge">project.ovirt-metrics-&lt;ovirt-env-name&gt;.&lt;uuid&gt;</code> index.</p>
  </li>
  <li>
    <p>Press the orange button, <code class="language-plaintext highlighter-rouge">Refresh field list</code>.</p>
  </li>
  <li>
    <p>Do steps 7 and 8 for the <code class="language-plaintext highlighter-rouge">project.ovirt-logs-&lt;ovirt-env-name&gt;.&lt;uuid&gt;</code> index.</p>
  </li>
</ol>

<p>You are done! Go to the <code class="language-plaintext highlighter-rouge">Dashboard</code> tab in the Kibana UI and choose a dashboard.</p>

<p>Currently there are 3 example dashboards:</p>

<ul>
  <li>
    <p>System Dashboard - <code class="language-plaintext highlighter-rouge">https://kibana.{elasticsearch_host}/app/kibana#/dashboard/System-Dashboard</code></p>
  </li>
  <li>
    <p>Hosts Dashboard - <code class="language-plaintext highlighter-rouge">https://kibana.{elasticsearch_host}/app/kibana#/dashboard/Hosts-Dashboard</code></p>
  </li>
  <li>
    <p>VMs Dashboard - <code class="language-plaintext highlighter-rouge">https://kibana.{elasticsearch_host}/app/kibana#/dashboard/VMs-Dashboard</code></p>
  </li>
</ul>

<h3 id="viewing-saved-dashboards">Viewing Saved Dashboards</h3>

<p>Once you have created and saved a dashboard, or imported the sample dashboards, you can display them in the Dashboard tab:</p>

<ol>
  <li>Click the Dashboard tab.</li>
  <li>Click the Load Saved Dashboard button to display a list of saved dashboards.</li>
  <li>Click a saved dashboard to load and view it.</li>
</ol>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2955/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2955/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2955/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2955/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/metrics/metrics-store-installation.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/metrics/metrics-store-installation.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
