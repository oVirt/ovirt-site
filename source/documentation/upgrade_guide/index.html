<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Upgrade Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Upgrade Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_upgrading_a_local_database_environment_manually">Upgrading a Local Database Environment Manually</a>
<ul class="sectlevel1">
<li><a href="#Upgrading_from_4-2">1. Upgrading from 4.2 to oVirt 4.3</a>
<ul class="sectlevel2">
<li><a href="#Upgrade_Prerequisites_4-2_local_db">1.1. Prerequisites</a></li>
<li><a href="#Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">1.2. Updating the oVirt Engine</a></li>
<li><a href="#Upgrading_the_Manager_to_4-3_4-2_local_db">1.3. Upgrading the Engine from 4.2 to 4.3</a></li>
<li><a href="#Updating_all_hosts_in_a_cluster_4-2_local_db">1.4. Updating All Hosts in a Cluster</a></li>
<li><a href="#Changing_the_Cluster_Compatibility_Version_4-2_local_db">1.5. Changing the Cluster Compatibility Version</a></li>
<li><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">1.6. Changing Virtual Machine Cluster Compatibility</a></li>
<li><a href="#Changing_the_Data_Center_Compatibility_Version_4-2_local_db">1.7. Changing the Data Center Compatibility Version</a></li>
<li><a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">1.8. Replacing SHA-1 Certificates with SHA-256 Certificates</a></li>
</ul>
</li>
<li><a href="#Upgrading_from_4-3">2. Upgrading from 4.3 to oVirt 4.4</a>
<ul class="sectlevel2">
<li><a href="#Upgrade_Prerequisites_4-3_local_db">2.1. Prerequisites</a></li>
<li><a href="#Analyzing_the_Environment_4-3_local_db">2.2. Analyzing the Environment</a></li>
<li><a href="#Upgrading_the_Manager_to_4-4_4-3_local_db">2.3. Upgrading the oVirt Engine from 4.3 to 4.4</a></li>
<li><a href="#Upgrading_hosts_to_4-4_4-3_local_db">2.4. Migrating hosts and virtual machines from oVirt 4.3 to 4.4</a></li>
<li><a href="#Upgrading_hypervisor_preserving_local_storage_4-3_local_db">2.5. Upgrading oVirt Node while preserving local storage</a></li>
<li><a href="#Changing_the_Cluster_Compatibility_Version_4-3_local_db">2.6. Changing the Cluster Compatibility Version</a></li>
<li><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-3_local_db">2.7. Changing Virtual Machine Cluster Compatibility</a></li>
<li><a href="#Changing_the_Data_Center_Compatibility_Version_4-3_local_db">2.8. Changing the Data Center Compatibility Version</a></li>
<li><a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-3_local_db">2.9. Replacing SHA-1 Certificates with SHA-256 Certificates</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a>
<ul class="sectlevel1">
<li><a href="#Updates_between_Minor_Releases">Appendix A: Updates between minor releases</a>
<ul class="sectlevel2">
<li><a href="#Updating_the_Red_Hat_Virtualization_Manager_minor_updates">Updating the oVirt Engine</a></li>
<li><a href="#Updating_a_self-hosted_engine_minor_updates">Updating a Self-Hosted Engine</a></li>
<li><a href="#Updating_all_hosts_in_a_cluster_minor_updates">Updating All Hosts in a Cluster</a></li>
<li><a href="#Updating_Individual_Hosts_minor_updates">Updating Individual Hosts</a></li>
<li><a href="#Manually_Updating_Hosts_minor_updates">Manually Updating Hosts</a></li>
</ul>
</li>
<li><a href="#Updating_the_Local_Repository_for_an_Offline_Red_Hat_Enterprise_Virtualization_Manager_Installation">Appendix B: Updating the Local Repository for an Offline oVirt Engine Installation</a>
<ul class="sectlevel2">
<li><a href="#_additional_resources">Additional resources</a></li>
</ul>
</li>
<li><a href="#_legal_notice">Legal notice</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h1 id="_upgrade_guide" class="discrete">Upgrade Guide</h1>
</div>
</div>
<h1 id="_upgrading_a_local_database_environment_manually" class="sect0">Upgrading a Local Database Environment Manually</h1>
<div class="sect1">
<h2 id="Upgrading_from_4-2">1. Upgrading from 4.2 to oVirt 4.3</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading your environment from 4.2 to 4.3 involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Upgrade_Prerequisites_4-2_local_db">Make sure you meet the prerequisites, including enabling the correct repositories</a></p>
</li>
<li>
<p><a href="#Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">Update the 4.2 Engine to the latest version of 4.2</a></p>
</li>
<li>
<p><a href="#Upgrading_the_Manager_to_4-3_4-2_local_db">Upgrade the Engine from 4.2 to 4.3</a></p>
</li>
<li>
<p><a href="#Updating_all_hosts_in_a_cluster_4-2_local_db">Update the hosts</a></p>
</li>
<li>
<p><a href="#Changing_the_Cluster_Compatibility_Version_4-2_local_db">Update the compatibility version of the clusters</a></p>
</li>
<li>
<p><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">Reboot any running or suspended virtual machines to update their configuration</a></p>
</li>
<li>
<p><a href="#Changing_the_Data_Center_Compatibility_Version_4-2_local_db">Update the compatibility version of the data centers</a></p>
</li>
<li>
<p>If you previously upgraded to 4.2 without replacing SHA-1 certificates with SHA-256 certificates, <a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">you must replace the certificates now</a>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Upgrade_Prerequisites_4-2_local_db">1.1. Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Plan for any necessary virtual machine downtime. After you update the clusters' compatibility versions during the upgrade, a new hardware configuration is automatically applied to each virtual machine once it reboots. You must reboot any running or suspended virtual machines as soon as possible to apply the configuration changes.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your environment meets the requirements for oVirt 4.4-beta. For a complete list of prerequisites, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4-beta/html-single/planning_and_prerequisites_guide/index#RHV_requirements"><em>Planning and Prerequisites Guide</em></a>.</p>
</li>
<li>
<p>Ensure the hosts have the correct repositories enabled by installing the <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">ovirt-release44.rpm</a> RPM package.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure the Engine has the correct repositories enabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Updating_the_Red_Hat_Virtualization_Manager_4-2_local_db">1.2. Updating the oVirt Engine</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to enable the correct repositories as detailed in <strong>Prerequisites</strong>. Otherwise, the upgrade might fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Updates to the oVirt Engine are released through the Content Delivery Network.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Update the oVirt Engine with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated, reboot the machine to complete the update.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_the_Manager_to_4-3_4-2_local_db">1.3. Upgrading the Engine from 4.2 to 4.3</h3>
<div class="paragraph">
<p>Upgrade the oVirt Engine from 4.2 to 4.3.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the upgrade fails, the <code>engine-setup</code> command attempts to roll your oVirt Engine installation back to its previous state. For this reason, the previous version&#8217;s repositories must not be removed until after the upgrade is complete. If the upgrade fails, detailed instructions display that explain how to restore your installation.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Enable the oVirt 4.3 repositories:</p>
<div class="listingblock">
<div class="content">
<pre># yum install https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</pre>
</div>
</div>
<div class="paragraph">
<p>All other repositories remain the same across oVirt releases.</p>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Run <code>engine-setup</code> and follow the prompts to upgrade the oVirt Engine:</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
</li>
<li>
<p>Update the base operating system:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated, reboot the machine to complete the upgrade.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can now update the hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="Updating_all_hosts_in_a_cluster_4-2_local_db">1.4. Updating All Hosts in a Cluster</h3>
<div class="paragraph">
<p>You can update all hosts in a cluster instead of updating hosts individually. This is particularly useful during upgrades to new versions of oVirt. See <a href="https://github.com/oVirt/ovirt-ansible-cluster-upgrade/blob/master/README.md" class="bare">https://github.com/oVirt/ovirt-ansible-cluster-upgrade/blob/master/README.md</a> for more information about the Ansible role used to automate the updates.</p>
</div>
<div class="paragraph">
<p>Update one cluster at a time.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines are shut down during the update, unless you choose to skip that host instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Clusters</b></span> and select the cluster.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
<li>
<p>Select the hosts to update, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Configure the options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Stop Pinned VMs</strong> shuts down any virtual machines that are pinned to hosts in the cluster, and is selected by default. You can clear this check box to skip updating those hosts so that the pinned virtual machines stay running, such as when a pinned virtual machine is running important services or processes and you do not want it to shut down at an unknown time during the update.</p>
</li>
<li>
<p><strong>Upgrade Timeout (Minutes)</strong> sets the time to wait for an individual host to be updated before the cluster upgrade fails with a timeout. The default is <code>60</code>. You can increase it for large clusters where 60 minutes might not be enough, or reduce it for small clusters where the hosts update quickly.</p>
</li>
<li>
<p><strong>Check Upgrade</strong> checks each host for available updates before running the upgrade process. It is not selected by default, but you can select it if you need to ensure that recent updates are included, such as when you have configured the Engine to check for host updates less frequently than the default.</p>
</li>
<li>
<p><strong>Reboot After Upgrade</strong> reboots each host after it is updated, and is selected by default. You can clear this check box to speed up the process if you are sure that there are no pending updates that require a host reboot.</p>
</li>
<li>
<p><strong>Use Maintenance Policy</strong> sets the cluster&#8217;s scheduling policy to <a href="https://ovirt.org/documentationhtml/administration_guide/sect-cluster_tasks#Cluster_Scheduling_Policy_Settings"><code>cluster_maintenance</code></a> during the update. It is selected by default, so activity is limited and virtual machines cannot start unless they are highly available. You can clear this check box if you have a custom scheduling policy that you want to keep using during the update, but this could have unknown consequences. Ensure your custom policy is compatible with cluster upgrade activity before disabling this option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review the summary of the hosts and virtual machines that will be affected.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can track the progress of host updates in the <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span> view, and in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>).</p>
</div>
<div class="paragraph">
<p>You can track the progress of individual virtual machine migrations in the <strong>Status</strong> column of the <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Virtual Machines</b></span> view. In large environments, you may need to filter the results to show a particular group of virtual machines.</p>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Cluster_Compatibility_Version_4-2_local_db">1.5. Changing the Cluster Compatibility Version</h3>
<div class="paragraph">
<p>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To change the cluster compatibility version, you must have first updated all the hosts in your cluster to a level that supports your desired compatibility level. Check if there is an icon next to the host indicating an update is available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Select the cluster to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>On the <strong>General</strong> tab, change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Cluster Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>An error message might warn that some virtual machines and templates are incorrectly configured. To fix this error, edit each virtual machine manually. The <strong>Edit Virtual Machine</strong> window provides additional validations and warnings that show what to correct. Sometimes the issue is automatically corrected and the virtual machine&#8217;s configuration just needs to be saved again. After editing each virtual machine, you will be able to change the cluster compatibility version.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Changing_Virtual_Machine_Cluster_Compatibility_4-2_local_db">1.6. Changing Virtual Machine Cluster Compatibility</h3>
<div class="paragraph">
<p>After updating a cluster&#8217;s compatibility version, you must update the cluster compatibility version of all running or suspended virtual machines by rebooting them from the Administration Portal, or using the REST API, instead of from within the guest operating system. Virtual machines that require a reboot are marked with the pending changes icon (<span class="image"><img src="common/images/pendingchanges.png" alt="pendingchanges"></span>).</p>
</div>
<div class="paragraph">
<p>Although you can wait to reboot the virtual machines at a convenient time, rebooting immediately is highly recommended so that the virtual machines use the latest configuration. Any virtual machine that has not been rebooted runs with the previous configuration, and subsequent configuration changes made to the virtual machine might overwrite its pending cluster compatibility changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Check which virtual machines require a reboot. In the <strong>Vms:</strong> search bar, enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">next_run_config_exists=True</pre>
</div>
</div>
<div class="paragraph">
<p>The search results show all virtual machines with pending changes.</p>
</div>
</li>
<li>
<p>Select each virtual machine and click <strong>Restart</strong>. Alternatively, if necessary you can reboot a virtual machine from within the virtual machine itself.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the virtual machine starts, the new compatibility version is automatically applied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot change the cluster compatibility version of a virtual machine snapshot that is in preview. You must first commit or undo the preview.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Data_Center_Compatibility_Version_4-2_local_db">1.7. Changing the Data Center Compatibility Version</h3>
<div class="paragraph">
<p>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt with which the data center is intended to be compatible. All clusters in the data center must support the desired compatibility level.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To change the data center compatibility version, you must have first updated the compatibility version of all clusters and virtual machines in the data center.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Select the data center to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Data Center Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you previously upgraded to 4.2 without replacing SHA-1 certificates with SHA-256 certificates, you must do so now.</p>
</div>
</div>
<div class="sect2">
<h3 id="Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-2_local_db">1.8. Replacing SHA-1 Certificates with SHA-256 Certificates</h3>
<div class="paragraph">
<p>oVirt 4.4-beta uses SHA-256 signatures, which provide a more secure way to sign SSL certificates than SHA-1. Newly installed systems do not require any special steps to enable oVirt&#8217;s public key infrastructure (PKI) to use SHA-256 signatures.</p>
</div>
<h4 id="Preventing_Warning_Messages_from_Appearing_in_the_Browser_4-2_local_db" class="discrete">Preventing Warning Messages from Appearing in the Browser</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Define the certificate that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre># names="apache"</pre>
</div>
</div>
</li>
<li>
<p>On the Engine, re-sign the Apache certificate:</p>
<div class="listingblock">
<div class="content">
<pre>for name in $names; do
    subject="$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/"${name}".cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
    )"
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --san=DNS:"${ENGINE_FQDN}" \
        --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the <strong>httpd</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
</ol>
</div>
<h4 id="Replacing_All_Signed_Certificates_with_SHA-256_4-2_local_db" class="discrete">Replacing All Signed Certificates with SHA-256</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Re-sign the CA certificate by backing it up and creating a new certificate in <strong>ca.pem.new</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/private/ca.pem /etc/pki/ovirt-engine/private/ca.pem."$(date +"%Y%m%d%H%M%S")"
# openssl x509 -signkey /etc/pki/ovirt-engine/private/ca.pem -in /etc/pki/ovirt-engine/ca.pem -out /etc/pki/ovirt-engine/ca.pem.new -days 3650 -sha256</pre>
</div>
</div>
</li>
<li>
<p>Replace the existing certificate with the new certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/pki/ovirt-engine/ca.pem.new /etc/pki/ovirt-engine/ca.pem</pre>
</div>
</div>
</li>
<li>
<p>Define the certificates that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine apache websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>If you replaced the oVirt Engine SSL Certificate after the upgrade, run the following instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>For more details see <a href="https://ovirt.org/documentationhtml/administration_guide/appe-red_hat_enterprise_virtualization_and_ssl#Replacing_the_Manager_CA_Certificate">Replacing the oVirt Engine CA Certificate</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>On the Engine, re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">for name in $names; do
   subject="$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/"${name}".cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
        )"
     /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
            --name="${name}" \
            --password=mypass \
            --subject="${subject}" \
            --san=DNS:"${ENGINE_FQDN}" \
            --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd
# systemctl restart ovirt-engine
# systemctl restart ovirt-websocket-proxy
# systemctl restart ovirt-imageio-proxy</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
<li>
<p>Enroll the certificates on the hosts. Repeat the following procedure for each host.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select the host and click <span class="menuseq"><b class="menu">Management</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Maintenance</b></span>.</p>
</li>
<li>
<p>Once the host is in maintenance mode, click <span class="menuseq"><b class="menu">Installation</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Enroll Certificate</b></span>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Upgrading_from_4-3">2. Upgrading from 4.3 to oVirt 4.4</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading your environment from 4.3 to 4.4 involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#Upgrade_Prerequisites_4-3_local_db">Make sure you meet the prerequisites, including enabling the correct repositories</a>.</p>
</li>
<li>
<p><a href="#Analyzing_the_Environment_4-3_local_db">Use the Log Collection Analysis tool to check for issues that might prevent a successful upgrade</a>.</p>
</li>
<li>
<p><a href="#Upgrading_the_Manager_to_4-4_4-3_local_db">Upgrade the Engine from 4.3 to 4.4</a>.</p>
</li>
<li>
<p><a href="#Upgrading_hosts_to_4-4_4-3_local_db">Upgrade hosts while reducing virtual machine downtime</a>.</p>
</li>
<li>
<p><a href="#Upgrading_hypervisor_preserving_local_storage_4-3_local_db">(Optional) Upgrade oVirt Node while preserving local storage</a>.</p>
</li>
<li>
<p><a href="#Changing_the_Cluster_Compatibility_Version_4-3_local_db">Update the compatibility version of the clusters</a>.</p>
</li>
<li>
<p><a href="#Changing_Virtual_Machine_Cluster_Compatibility_4-3_local_db">Reboot any running or suspended virtual machines to update their configuration</a>.</p>
</li>
<li>
<p><a href="#Changing_the_Data_Center_Compatibility_Version_4-3_local_db">Update the compatibility version of the data centers</a>.</p>
</li>
<li>
<p>If you previously upgraded to 4.3 without replacing SHA-1 certificates with SHA-256 certificates, <a href="#Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-3_local_db">you must replace the certificates now</a>.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="Upgrade_Prerequisites_4-3_local_db">2.1. Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>Plan for any necessary virtual machine downtime. After you update the clusters' compatibility versions during the upgrade, a new hardware configuration is automatically applied to each virtual machine once it reboots. You must reboot any running or suspended virtual machines as soon as possible to apply the configuration changes.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure your environment meets the requirements for oVirt 4.4-beta. For a complete list of prerequisites, see the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4-beta/html-single/planning_and_prerequisites_guide/index#RHV_requirements"><em>Planning and Prerequisites Guide</em></a>.</p>
</li>
<li>
<p>Ensure the hosts have the correct repositories enabled by installing the <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm">ovirt-release44.rpm</a> RPM package.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensure the Engine has the correct repositories enabled. For the list of required repositories, see <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Enabling_the_Red_Hat_Virtualization_Manager_Repositories_install_RHVM">Enabling the oVirt Engine Repositories</a> for oVirt 4.4.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Analyzing_the_Environment_4-3_local_db">2.2. Analyzing the Environment</h3>
<div class="paragraph">
<p>Run the Log Collection Analysis tool prior to performing updates and for troubleshooting. The tool analyzes your environment for known issues that might prevent you from performing an update, and provides recommendations to resolve them.</p>
</div>
<div class="paragraph">
<p>The tool gathers detailed information about your system and presents it as an HTML file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Log Collection Analysis tool is available from oVirt 4.2.5.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the Log Collection Analysis tool on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum install rhv-log-collector-analyzer</pre>
</div>
</div>
</li>
<li>
<p>Run the tool:</p>
<div class="listingblock">
<div class="content">
<pre># rhv-log-collector-analyzer --live</pre>
</div>
</div>
<div class="paragraph">
<p>A detailed report is displayed.</p>
</div>
<div class="paragraph">
<p>By default, the report is saved to a file called <code>analyzer_report.html</code>.</p>
</div>
<div class="paragraph">
<p>To save the file to a specific location, use the <code>--html</code> flag and specify the location:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rhv-log-collector-analyzer --live --html=/<em>directory</em>/<em>filename</em>.html</pre>
</div>
</div>
</li>
<li>
<p>You can use the ELinks text mode web browser to read the analyzer reports within the terminal. To install the ELinks browser:</p>
<div class="listingblock">
<div class="content">
<pre># yum install -y elinks</pre>
</div>
</div>
</li>
<li>
<p>Launch ELinks and open <code>analyzer_report.html</code>.</p>
<div class="listingblock">
<div class="content">
<pre># elinks /home/user1/analyzer_report.html</pre>
</div>
</div>
<div class="paragraph">
<p>To navigate the report, use the following commands in ELinks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code><kbd>Insert</kbd></code> to scroll up</p>
</li>
<li>
<p><code><kbd>Delete</kbd></code> to scroll down</p>
</li>
<li>
<p><code><kbd>PageUp</kbd></code> to page up</p>
</li>
<li>
<p><code><kbd>PageDown</kbd></code> to page down</p>
</li>
<li>
<p><code><kbd>Left Bracket</kbd></code> to scroll left</p>
</li>
<li>
<p><code><kbd>Right Bracket</kbd></code> to scroll right</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_the_Manager_to_4-4_4-3_local_db">2.3. Upgrading the oVirt Engine from 4.3 to 4.4</h3>
<div class="paragraph">
<p>oVirt Engine 4.4 is only supported on Enterprise Linux 8.2 or later. A clean installation of Enterprise Linux 8.2 and oVirt Engine 4.4 is required, even if you are using the same physical machine that you use to run oVirt Engine 4.3. The upgrade process requires restoring oVirt Engine 4.3 backup files onto the oVirt Engine 4.4 machine.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>All data centers and clusters in the environment must have the cluster compatibility level set to version 4.3 before you start the procedure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Connected hosts and virtual machines can continue to work while the Engine is being upgraded.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Back up the oVirt Engine 4.3 environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --scope=all --mode=backup --file=backup.bck --log=backuplog.log</pre>
</div>
</div>
</li>
<li>
<p>Copy the backup file to a suitable device.</p>
</li>
<li>
<p>Install oVirt Node 4.4 or Enterprise Linux 8.2 or later. See <a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index#Installing_Hosts_for_RHV_SHE_cockpit_deploy">Installing Hosts for oVirt</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
<li>
<p>Install oVirt Engine 4.4. See one of the <em>Installing oVirt</em> guides.</p>
</li>
<li>
<p>Copy the backup file to the oVirt Engine 4.4 machine and restore it.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-backup --mode=restore --file=backup.bck --provision-all-databases</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the backup contained grants for extra database users, this command creates the extra users with random passwords. You must change these passwords manually if the extra users require access to the restored system. See <a href="https://access.redhat.com/articles/2686731" class="bare">https://access.redhat.com/articles/2686731</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Install optional extension packages if they were installed on the oVirt Engine 4.3 machine.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ovirt-engine-extension-aaa-ldap ovirt-engine-extension-aaa-misc ovirt-engine-extension-logger-log4j</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The configuration for these package extensions must be manually reapplied because they are not migrated as part of the backup and restore process.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Decommission the oVirt Engine 4.3 machine if a different machine is used for oVirt Engine 4.4. Two different Engines must not manage the same hosts or storage.</p>
</li>
<li>
<p>Run <code>engine-setup</code> to configure the Engine.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># engine-setup</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>If you use external CA to sign HTTPS certificates, follow the steps in Replacing the oVirt Engine CA Certificate in the Administration Guide to log in to the Administration portal after the upgrade. Ensure the CA certificate is added to system-wide trust stores of all clients to ensure the foreign menu of virt-viewer works. See <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1313379">BZ#1313379</a> for more information.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The oVirt Engine 4.4 is now installed, with the cluster compatibility version set to 4.3. Now you need to upgrade the hosts in your environment to oVirt 4.4, after which you can change the cluster compatibility version to 4.4.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index">Installing Red Hat Virtualization as a self-hosted engine using the Cockpit web interface</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/">Installing Red Hat Virtualization as a self-hosted engine using the command line</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/">Installing Red Hat Virtualization as a standalone Manager with local databases</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_remote_databases/">Installing Red Hat Virtualization as a standalone Manager with remote databases</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can now update the hosts.</p>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_hosts_to_4-4_4-3_local_db">2.4. Migrating hosts and virtual machines from oVirt 4.3 to 4.4</h3>
<div class="paragraph">
<p>You can migrate hosts and virtual machines from oVirt 4.3 to 4.4 such that you minimize the down-time of virtual machines in your environment.</p>
</div>
<div class="paragraph">
<p>This process requires migrating all virtual machines off of one host so as to make that host available to upgrade to oVirt 4.4. After the upgrade, you can reattach the host to the Engine.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Hosts for oVirt 4.4 require Enterprise Linux 8.2 or later. A clean installation of Enterprise Linux 8.2 or later, or oVirt Node 4.4 is required, even if you are using the same physical machine that you use to run hosts for oVirt 4.3.</p>
</li>
<li>
<p>oVirt Engine 4.4 is installed and running.</p>
</li>
<li>
<p>The compatibility level of the data center and cluster to which the hosts belong is set to 4.3.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Pick a host to upgrade and migrate that host&#8217;s virtual machines to another host in the same 4.3 cluster. You can use Live Migration to minimize virtual machine down-time. For more information, see
<a href="https://ovirt.org/documentation/virtual_machine_management_guide/index#sect-Migrating_Virtual_Machines_Between_Hosts">Migrating Virtual Machines Between Hosts</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
<li>
<p>Install Enterprise Linux 8.2 or later, or oVirt Node 4.4. For more information, see <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Installing_Hosts_for_RHV_SM_localDB_deploy">Installing Hosts for oVirt</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
<li>
<p>Install the appropriate packages to enable the host for oVirt 4.4. For more information, see <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Installing_Hosts_for_RHV_SM_localDB_deploy">Installing Hosts for oVirt</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
<li>
<p>Add this host to the Engine, assigning it to the same cluster. You can now migrate virtual machines onto this host. For more information, see <a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/index#Adding_standard_hosts_to_the_Manager_SM_localDB_deploy">Adding Standard Hosts to the Engine</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat these steps to migrate virtual machines and upgrade hosts for the rest of the hosts in the same cluster, one by one, until all are running oVirt 4.4.</p>
</div>
<div class="ulist">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index">Installing Red Hat Virtualization as a self-hosted engine using the Cockpit web interface</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_command_line/">Installing Red Hat Virtualization as a self-hosted engine using the command line</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_local_databases/">Installing Red Hat Virtualization as a standalone Manager with local databases</a></p>
</li>
<li>
<p><a href="https://ovirt.org/documentation/installing_ovirt_as_a_standalone_manager_with_remote_databases/">Installing Red Hat Virtualization as a standalone Manager with remote databases</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="Upgrading_hypervisor_preserving_local_storage_4-3_local_db">2.5. Upgrading oVirt Node while preserving local storage</h3>
<div class="paragraph">
<p>Environments with local storage cannot migrate virtual machines to a host in another cluster because the local storage is not shared with other storage domains. To upgrade oVirt Node 4.3 hosts that have a local storage domain, reinstall the host while preserving the local storage, create a new local storage domain in the 4.4 environment, and import the previous local storage into the new domain.</p>
</div>
<div class="paragraph">
<p>For Enterprise Linux hosts, if you used separate space for storage domains, such as disks, partitions, or logical volume, you can reinstall while keeping the domains.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>oVirt Engine 4.4 is installed and running.</p>
</li>
<li>
<p>The compatibility level of the data center and cluster to which the host belongs is set to 4.3.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the local storage on the oVirt Node 4.3 host&#8217;s local storage is in maintenance mode before starting this process. Complete these steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the <strong>Data Centers</strong> tab.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab in the <strong>Details</strong> pane and select the storage domain in the results list.</p>
</li>
<li>
<p>Click <strong>Maintenance</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Reinstall the oVirt Node, as described in <a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index#Red_Hat_Virtualization_Hosts_SHE_cockpit_deploy">Installing oVirt Node</a> in the <em>Installation Guide</em>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>When selecting the device on which to install oVirt Node from the Installation Destination screen, do not select the device(s) storing the virtual machines. Only select the device where the operating system should be installed.</p>
</div>
<div class="paragraph">
<p>If you are using kickstart to install the host, ensure that you preserve the devices containing the virtual machines by adding the following to the kickstart file, replacing device with the relevant device.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># clearpart --all --drives=<em>device</em></pre>
</div>
</div>
<div class="paragraph">
<p>For more information on using kickstart, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/performing_an_advanced_rhel_installation/index#kickstart_references">Kickstart references</a> in <em>Red Hat Enterprise Linux 8 Performing an advanced RHEL installation</em>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>On the reinstalled host, create a directory, for example <code class="filename">/data</code> in which to recover the previous environment.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /data</pre>
</div>
</div>
</li>
<li>
<p>Mount the previous local storage in the new directory. In our example, <code class="filename">/dev/sdX1</code> is the local storage:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount /dev/sdX1 /data</pre>
</div>
</div>
</li>
<li>
<p>Set the following permissions for the new directory.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R 36:36 /data
# chmod -R 0755 /data</pre>
</div>
</div>
</li>
<li>
<p>oVirt recommends that you also automatically mount the local storage via <code class="filename">/etc/fstab</code> in case the server requires a reboot:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># blkid | grep -i sdX1
/dev/sdX1: UUID="a81a6879-3764-48d0-8b21-2898c318ef7c" TYPE="ext4"
# vi /etc/fstab
UUID="a81a6879-3764-48d0-8b21-2898c318ef7c" /data    ext4    defaults     0       0</pre>
</div>
</div>
</li>
<li>
<p>In the Administration Portal, create a data center and select <strong>Local</strong> in the <strong>Storage Type</strong> drop-down menu.</p>
</li>
<li>
<p>Configure a cluster on the new data center. See <a href="https://ovirt.org/documentation/administration_guide/index#Creating_a_New_Cluster">Creating a New Cluster</a> in the <em>Administration Guide</em> for more information.</p>
</li>
<li>
<p>Add the host to the Engine. See <a href="https://ovirt.org/documentation/installing_ovirt_as_a_self-hosted_engine_using_the_cockpit_web_interface/index#Adding_standard_hosts_to_the_Manager_SHE_cockpit_deploy">Adding Standard Hosts to the oVirt Manager</a> in one of the <em>Installing oVirt</em> guides for more information.</p>
</li>
<li>
<p>On the host, create a new directory that will be used to create the initial local storage domain. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /localfs
# chown 36:36 /localfs
# chmod -R 0755 /localfs</pre>
</div>
</div>
</li>
<li>
<p>In the Administration Portal, open the <strong>Storage</strong> tab and click <strong>New Domain</strong> to create a new local storage domain.</p>
</li>
<li>
<p>Set the name to <code>localfs</code> and set the path to <code class="filename">/localfs</code>.</p>
</li>
<li>
<p>Once the local storage is active, click <strong>Import Domain</strong> and set the domain&#8217;s details.
For example, define <code>Data</code> as the name, <code>Local on Host</code> as the storage type and <code class="filename">/data</code> as the path.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm the message that appears informing you that storage domains are already attached to the data center.</p>
</li>
<li>
<p>Activate the new storage domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the <strong>Data Centers</strong> tab.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab in the details pane and select the new data storage domain in the results list.</p>
</li>
<li>
<p>Click <strong>Activate</strong>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Once the new storage domain is active, import the virtual machines and their disks:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the <strong>Storage</strong> tab, select <strong>data</strong>.</p>
</li>
<li>
<p>Select the <strong>VM Import</strong> tab in the details pane, select the virtual machines and click <strong>Import</strong>. See <a href="https://ovirt.org/documentation/administration_guide/index#Importing_Virtual_Machines_from_an_Imported_Data_Storage_Domain">Importing Virtual Machines from Imported Data Storage Domains</a> in the <em>Administration Guide</em> for more details.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Once you have ensured that all virtual machines have been successfully imported and are functioning properly, you can move <code>localfs</code> to maintenance mode.</p>
</li>
<li>
<p>Click the <strong>Storage</strong> tab and select <strong>localfs</strong> from the results list.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click the <strong>Data Center</strong> tab in the details pane.</p>
</li>
<li>
<p>Click Maintenance, then click <b class="button">OK</b> to move the storage domain to maintenance mode.</p>
</li>
<li>
<p>Click <strong>Detach</strong>. The Detach Storage confirmation window opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You have now upgraded the host to version 4.4, created a new local storage domain, and imported the 4.3 storage domain and its virtual machines.</p>
</div>
<div class="paragraph">
<p>You can now update the cluster compatibility version.</p>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Cluster_Compatibility_Version_4-3_local_db">2.6. Changing the Cluster Compatibility Version</h3>
<div class="paragraph">
<p>oVirt clusters have a compatibility version. The cluster compatibility version indicates the features of oVirt supported by all of the hosts in the cluster. The cluster compatibility is set according to the version of the least capable host operating system in the cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To change the cluster compatibility version, you must have first updated all the hosts in your cluster to a level that supports your desired compatibility level. Check if there is an icon next to the host indicating an update is available.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Clusters</b></span>.</p>
</li>
<li>
<p>Select the cluster to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>On the <strong>General</strong> tab, change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Cluster Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>An error message might warn that some virtual machines and templates are incorrectly configured. To fix this error, edit each virtual machine manually. The <strong>Edit Virtual Machine</strong> window provides additional validations and warnings that show what to correct. Sometimes the issue is automatically corrected and the virtual machine&#8217;s configuration just needs to be saved again. After editing each virtual machine, you will be able to change the cluster compatibility version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now update the cluster compatibility version for virtual machines in the cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="Changing_Virtual_Machine_Cluster_Compatibility_4-3_local_db">2.7. Changing Virtual Machine Cluster Compatibility</h3>
<div class="paragraph">
<p>After updating a cluster&#8217;s compatibility version, you must update the cluster compatibility version of all running or suspended virtual machines by rebooting them from the Administration Portal, or using the REST API, instead of from within the guest operating system. Virtual machines that require a reboot are marked with the pending changes icon (<span class="image"><img src="common/images/pendingchanges.png" alt="pendingchanges"></span>).</p>
</div>
<div class="paragraph">
<p>Although you can wait to reboot the virtual machines at a convenient time, rebooting immediately is highly recommended so that the virtual machines use the latest configuration. Any virtual machine that has not been rebooted runs with the previous configuration, and subsequent configuration changes made to the virtual machine might overwrite its pending cluster compatibility changes.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Virtual Machines</b></span>.</p>
</li>
<li>
<p>Check which virtual machines require a reboot. In the <strong>Vms:</strong> search bar, enter the following query:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">next_run_config_exists=True</pre>
</div>
</div>
<div class="paragraph">
<p>The search results show all virtual machines with pending changes.</p>
</div>
</li>
<li>
<p>Select each virtual machine and click <strong>Restart</strong>. Alternatively, if necessary you can reboot a virtual machine from within the virtual machine itself.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the virtual machine starts, the new compatibility version is automatically applied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot change the cluster compatibility version of a virtual machine snapshot that is in preview. You must first commit or undo the preview.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now update the data center compatibility version.</p>
</div>
</div>
<div class="sect2">
<h3 id="Changing_the_Data_Center_Compatibility_Version_4-3_local_db">2.8. Changing the Data Center Compatibility Version</h3>
<div class="paragraph">
<p>oVirt data centers have a compatibility version. The compatibility version indicates the version of oVirt with which the data center is intended to be compatible. All clusters in the data center must support the desired compatibility level.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>To change the data center compatibility version, you must have first updated the compatibility version of all clusters and virtual machines in the data center.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Data Centers</b></span>.</p>
</li>
<li>
<p>Select the data center to change and click <b class="button">Edit</b>.</p>
</li>
<li>
<p>Change the <strong>Compatibility Version</strong> to the desired value.</p>
</li>
<li>
<p>Click <b class="button">OK</b>. The <strong>Change Data Center Compatibility Version</strong> confirmation dialog opens.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to confirm.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you previously upgraded to 4.3 without replacing SHA-1 certificates with SHA-256 certificates, you must do so now.</p>
</div>
</div>
<div class="sect2">
<h3 id="Replacing_SHA-1_Certificates_with_SHA-256_Certificates_4-3_local_db">2.9. Replacing SHA-1 Certificates with SHA-256 Certificates</h3>
<div class="paragraph">
<p>oVirt 4.4-beta uses SHA-256 signatures, which provide a more secure way to sign SSL certificates than SHA-1. Newly installed systems do not require any special steps to enable oVirt&#8217;s public key infrastructure (PKI) to use SHA-256 signatures.</p>
</div>
<h4 id="Preventing_Warning_Messages_from_Appearing_in_the_Browser_4-3_local_db" class="discrete">Preventing Warning Messages from Appearing in the Browser</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Define the certificate that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre># names="apache"</pre>
</div>
</div>
</li>
<li>
<p>On the Engine, re-sign the Apache certificate:</p>
<div class="listingblock">
<div class="content">
<pre>for name in $names; do
    subject="$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/"${name}".cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
    )"
   /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
        --name="${name}" \
        --password=mypass \
        --subject="${subject}" \
        --san=DNS:"${ENGINE_FQDN}" \
        --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the <strong>httpd</strong> service:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
</ol>
</div>
<h4 id="Replacing_All_Signed_Certificates_with_SHA-256_4-3_local_db" class="discrete">Replacing All Signed Certificates with SHA-256</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the Engine machine as the root user.</p>
</li>
<li>
<p>Check whether <strong>/etc/pki/ovirt-engine/openssl.conf</strong> includes the line <code>default_md = sha256</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
<div class="paragraph">
<p>If it still includes <code>default_md = sha1</code>, back up the existing configuration and change the default to <code>sha256</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/openssl.conf /etc/pki/ovirt-engine/openssl.conf."$(date +"%Y%m%d%H%M%S")"
# sed -i 's/^default_md = sha1/default_md = sha256/' /etc/pki/ovirt-engine/openssl.conf</pre>
</div>
</div>
</li>
<li>
<p>Re-sign the CA certificate by backing it up and creating a new certificate in <strong>ca.pem.new</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cp -p /etc/pki/ovirt-engine/private/ca.pem /etc/pki/ovirt-engine/private/ca.pem."$(date +"%Y%m%d%H%M%S")"
# openssl x509 -signkey /etc/pki/ovirt-engine/private/ca.pem -in /etc/pki/ovirt-engine/ca.pem -out /etc/pki/ovirt-engine/ca.pem.new -days 3650 -sha256</pre>
</div>
</div>
</li>
<li>
<p>Replace the existing certificate with the new certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mv /etc/pki/ovirt-engine/ca.pem.new /etc/pki/ovirt-engine/ca.pem</pre>
</div>
</div>
</li>
<li>
<p>Define the certificates that should be re-signed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine apache websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>If you replaced the oVirt Engine SSL Certificate after the upgrade, run the following instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># names="engine websocket-proxy jboss imageio-proxy"</pre>
</div>
</div>
<div class="paragraph">
<p>For more details see <a href="https://ovirt.org/documentationhtml/administration_guide/appe-red_hat_enterprise_virtualization_and_ssl#Replacing_the_Manager_CA_Certificate">Replacing the oVirt Engine CA Certificate</a> in the <em>Administration Guide</em>.</p>
</div>
</li>
<li>
<p>On the Engine, re-sign the certificates:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">for name in $names; do
   subject="$(
        openssl \
            x509 \
            -in /etc/pki/ovirt-engine/certs/"${name}".cer \
            -noout \
            -subject \
        | sed \
            's;subject= \(.*\);\1;' \
        )"
     /usr/share/ovirt-engine/bin/pki-enroll-pkcs12.sh \
            --name="${name}" \
            --password=mypass \
            --subject="${subject}" \
            --san=DNS:"${ENGINE_FQDN}" \
            --keep-key
done</pre>
</div>
</div>
</li>
<li>
<p>Restart the following services:</p>
<div class="listingblock">
<div class="content">
<pre># systemctl restart httpd
# systemctl restart ovirt-engine
# systemctl restart ovirt-websocket-proxy
# systemctl restart ovirt-imageio-proxy</pre>
</div>
</div>
</li>
<li>
<p>Connect to the Administration Portal to confirm that the warning no longer appears.</p>
</li>
<li>
<p>If you previously imported a CA or https certificate into the browser, find the certificate(s), remove them from the browser, and reimport the new CA certificate. Install the certificate authority according to the instructions provided by your browser. To get the certificate authority&#8217;s certificate, navigate to <code>http://<em>your-manager-fqdn</em>/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</code>, replacing <em>your-manager-fqdn</em> with the fully qualified domain name (FQDN).</p>
</li>
<li>
<p>Enroll the certificates on the hosts. Repeat the following procedure for each host.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span>.</p>
</li>
<li>
<p>Select the host and click <span class="menuseq"><b class="menu">Management</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Maintenance</b></span>.</p>
</li>
<li>
<p>Once the host is in maintenance mode, click <span class="menuseq"><b class="menu">Installation</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Enroll Certificate</b></span>.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Activate</b></span>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<h1 id="_appendices" class="sect0">Appendices</h1>
<div class="sect1">
<h2 id="Updates_between_Minor_Releases">Appendix A: Updates between minor releases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To update from your current version of 4.4 to the latest version of 4.4, update the Engine and then update the hosts.</p>
</div>
<div class="paragraph">
<p>To update a standalone Engine, follow the standard procedure for minor updates:</p>
</div>
<div class="sect2">
<h3 id="Updating_the_Red_Hat_Virtualization_Manager_minor_updates">Updating the oVirt Engine</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to enable the correct repositories as detailed in <strong>Prerequisites</strong>. Otherwise, the upgrade might fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Updates to the oVirt Engine are released through the Content Delivery Network.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Update the oVirt Engine with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated, reboot the machine to complete the update.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Updating_a_self-hosted_engine_minor_updates">Updating a Self-Hosted Engine</h3>
<div class="paragraph">
<p>To update a self-hosted engine from your current version to the latest version, you must place the environment in global maintenance mode and then follow the standard procedure for updating between minor versions.</p>
</div>
<h4 id="Enabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Enabling Global Maintenance Mode</h4>
<div class="paragraph">
<p>You must place the self-hosted engine environment in global maintenance mode before performing any setup or upgrade tasks on the Engine virtual machine.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to one of the self-hosted engine nodes and enable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=global</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the environment is in maintenance mode before proceeding:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>You should see a message indicating that the cluster is in maintenance mode.</p>
</div>
</li>
</ol>
</div>
<h4 id="Updating_the_Red_Hat_Virtualization_Manager_SHE_minor_updates" class="discrete">Updating the oVirt Engine</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph">
<p>Be sure to enable the correct repositories as detailed in <strong>Prerequisites</strong>. Otherwise, the upgrade might fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Updates to the oVirt Engine are released through the Content Delivery Network.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine virtual machine.</p>
</li>
<li>
<p>Log in to the Engine machine.</p>
</li>
<li>
<p>Check if updated packages are available:</p>
<div class="listingblock">
<div class="content">
<pre># engine-upgrade-check</pre>
</div>
</div>
</li>
<li>
<p>Update the setup packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update ovirt\*setup\*</pre>
</div>
</div>
</li>
<li>
<p>Update the oVirt Engine with the <code>engine-setup</code> script. The <code>engine-setup</code> script prompts you with some configuration questions, then stops the <code>ovirt-engine</code> service, downloads and installs the updated packages, backs up and updates the database, performs post-installation configuration, and starts the <code>ovirt-engine</code> service.</p>
<div class="listingblock">
<div class="content">
<pre># engine-setup</pre>
</div>
</div>
<div class="paragraph">
<p>When the script completes successfully, the following message appears:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Execution of setup completed successfully</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>engine-setup</code> script is also used during the oVirt Engine installation process, and it stores the configuration values supplied. During an update, the stored values are displayed when previewing the configuration, and might not be up to date if <code>engine-config</code> was used to update configuration after installation. For example, if <code>engine-config</code> was used to update <code>SANWipeAfterDelete</code> to <code>true</code> after installation, <code>engine-setup</code> will output "Default SAN wipe after delete: False" in the configuration preview. However, the updated values will not be overwritten by <code>engine-setup</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The update process might take some time. Do not stop the process before it completes.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Update the base operating system and any optional packages installed on the Engine:</p>
<div class="listingblock">
<div class="content">
<pre># yum update</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If any kernel packages were updated:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Disable global maintenance mode</p>
</li>
<li>
<p>Reboot the machine to complete the update.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Related Information</div>
<p><a href="#Disabling_Global_Maintenance_Mode_SHE_minor_updates">Disabling Global Maintenance Mode</a></p>
</div>
<h4 id="Disabling_Global_Maintenance_Mode_SHE_minor_updates" class="discrete">Disabling Global Maintenance Mode</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log in to the Engine virtual machine and shut it down.</p>
</li>
<li>
<p>Log in to one of the self-hosted engine nodes and disable global maintenance mode:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --set-maintenance --mode=none</pre>
</div>
</div>
<div class="paragraph">
<p>When you exit global maintenance mode, ovirt-ha-agent starts the Engine virtual machine, and then the Engine automatically starts. It can take up to ten minutes for the Engine to start.</p>
</div>
</li>
<li>
<p>Confirm that the environment is running:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># hosted-engine --vm-status</pre>
</div>
</div>
<div class="paragraph">
<p>The listed information includes <strong>Engine Status</strong>. The value for <strong>Engine status</strong> should be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"health": "good", "vm": "up", "detail": "Up"}</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When the virtual machine is still booting and the Engine hasn&#8217;t started yet, the <strong>Engine status</strong> is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"reason": "bad vm status", "health": "bad", "vm": "up", "detail": "Powering up"}</pre>
</div>
</div>
<div class="paragraph">
<p>If this happens, wait a few minutes and try again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="Updating_all_hosts_in_a_cluster_minor_updates">Updating All Hosts in a Cluster</h3>
<div class="paragraph">
<p>You can update all hosts in a cluster instead of updating hosts individually. This is particularly useful during upgrades to new versions of oVirt. See <a href="https://github.com/oVirt/ovirt-ansible-cluster-upgrade/blob/master/README.md" class="bare">https://github.com/oVirt/ovirt-ansible-cluster-upgrade/blob/master/README.md</a> for more information about the Ansible role used to automate the updates.</p>
</div>
<div class="paragraph">
<p>Update one cluster at a time.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines are shut down during the update, unless you choose to skip that host instead.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Clusters</b></span> and select the cluster.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
<li>
<p>Select the hosts to update, then click <strong>Next</strong>.</p>
</li>
<li>
<p>Configure the options:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Stop Pinned VMs</strong> shuts down any virtual machines that are pinned to hosts in the cluster, and is selected by default. You can clear this check box to skip updating those hosts so that the pinned virtual machines stay running, such as when a pinned virtual machine is running important services or processes and you do not want it to shut down at an unknown time during the update.</p>
</li>
<li>
<p><strong>Upgrade Timeout (Minutes)</strong> sets the time to wait for an individual host to be updated before the cluster upgrade fails with a timeout. The default is <code>60</code>. You can increase it for large clusters where 60 minutes might not be enough, or reduce it for small clusters where the hosts update quickly.</p>
</li>
<li>
<p><strong>Check Upgrade</strong> checks each host for available updates before running the upgrade process. It is not selected by default, but you can select it if you need to ensure that recent updates are included, such as when you have configured the Engine to check for host updates less frequently than the default.</p>
</li>
<li>
<p><strong>Reboot After Upgrade</strong> reboots each host after it is updated, and is selected by default. You can clear this check box to speed up the process if you are sure that there are no pending updates that require a host reboot.</p>
</li>
<li>
<p><strong>Use Maintenance Policy</strong> sets the cluster&#8217;s scheduling policy to <a href="https://ovirt.org/documentationhtml/administration_guide/sect-cluster_tasks#Cluster_Scheduling_Policy_Settings"><code>cluster_maintenance</code></a> during the update. It is selected by default, so activity is limited and virtual machines cannot start unless they are highly available. You can clear this check box if you have a custom scheduling policy that you want to keep using during the update, but this could have unknown consequences. Ensure your custom policy is compatible with cluster upgrade activity before disabling this option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review the summary of the hosts and virtual machines that will be affected.</p>
</li>
<li>
<p>Click <strong>Upgrade</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can track the progress of host updates in the <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span> view, and in the <strong>Events</strong> section of the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>).</p>
</div>
<div class="paragraph">
<p>You can track the progress of individual virtual machine migrations in the <strong>Status</strong> column of the <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Virtual Machines</b></span> view. In large environments, you may need to filter the results to show a particular group of virtual machines.</p>
</div>
<div class="paragraph">
<p>You can also update hosts individually:</p>
</div>
</div>
<div class="sect2">
<h3 id="Updating_Individual_Hosts_minor_updates">Updating Individual Hosts</h3>
<div class="paragraph">
<p>Use the host upgrade manager to update individual hosts directly from the Administration Portal.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The upgrade manager only checks hosts with a status of <strong>Up</strong> or <strong>Non-operational</strong>, but not <strong>Maintenance</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the correct repositories are enabled. To view a list of currently enabled repositories, run <code>yum repolist</code>.</p>
<div class="ulist">
<ul>
<li>
<p>For oVirt Nodes, the <code>ovirt-release44</code> RPM package enabling the correct repositories is already installed.</p>
</li>
<li>
<p>For Enterprise Linux hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span> and select the host to be updated.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Installation</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Check for Upgrade</b></span> and click <b class="button">OK</b>.</p>
<div class="paragraph">
<p>Open the <strong>Notification Drawer</strong> (<span class="image"><img src="common/images/EventsIcon.png" alt="EventsIcon"></span>) and expand the <strong>Events</strong> section to see the result.</p>
</div>
</li>
<li>
<p>If an update is available, click <span class="menuseq"><b class="menu">Installation</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Upgrade</b></span>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to update the host. Running virtual machines are migrated according to their migration policy. If migration is disabled for any virtual machines, you are prompted to shut them down.</p>
<div class="paragraph">
<p>The details of the host are updated in <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span> and the status transitions through these stages:</p>
</div>
<div class="paragraph">
<p><strong>Maintenance &gt; Installing &gt; Reboot &gt; Up</strong></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>If the update fails, the host&#8217;s status changes to <strong>Install Failed</strong>. From <strong>Install Failed</strong> you can click <span class="menuseq"><b class="menu">Installation</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Upgrade</b></span> again.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat this procedure for each host in the oVirt environment.</p>
</div>
<div class="paragraph">
<p>You should update the hosts from the Administration Portal. However, you can update the hosts using <code>yum update</code> instead:</p>
</div>
</div>
<div class="sect2">
<h3 id="Manually_Updating_Hosts_minor_updates">Manually Updating Hosts</h3>
<div class="paragraph">
<p>You can use the <code>yum</code> command to update your hosts. Update your systems regularly, to ensure timely application of security and bug fixes.</p>
</div>
<div class="ulist">
<div class="title">Limitations</div>
<ul>
<li>
<p>On oVirt Node, the update only preserves modified content in the <code>/etc</code> and <code>/var</code> directories. Modified data in other paths is overwritten during an update.</p>
</li>
<li>
<p>If the cluster has migration enabled, virtual machines are automatically migrated to another host in the cluster.
Update a host when its usage is relatively low.</p>
</li>
<li>
<p>In a self-hosted engine environment, the Engine virtual machine can only migrate between self-hosted engine nodes in the same cluster. It cannot migrate to standard hosts.</p>
</li>
<li>
<p>The cluster must have sufficient memory reserved for its hosts to perform maintenance. Otherwise, virtual machine migrations will hang and fail. You can reduce the memory usage of host updates by shutting down some or all virtual machines before updating hosts.</p>
</li>
<li>
<p>Do not update all hosts at the same time, as one host must remain available to perform Storage Pool Manager (SPM) tasks.</p>
</li>
<li>
<p>You cannot migrate a pinned virtual machine (such as a virtual machine using a vGPU) to another host.
Pinned virtual machines must be shut down before updating the host.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure the correct repositories are enabled. You can check which repositories are currently enabled by running <code>yum repolist</code>.</p>
<div class="ulist">
<ul>
<li>
<p>For oVirt Nodes, the <code>ovirt-release44</code> RPM package enabling the correct repositories is already installed.</p>
</li>
<li>
<p>For Enterprise Linux hosts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install <a href="https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm" class="bare">https://resources.ovirt.org/pub/yum-repo/ovirt-release44.rpm</a></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>In the Administration Portal, click <span class="menuseq"><b class="menu">Compute</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Hosts</b></span> and select the host to be updated.</p>
</li>
<li>
<p>Click <span class="menuseq"><b class="menu">Management</b>&#160;<b class="caret">&#8250;</b> <b class="menuitem">Maintenance</b></span>.</p>
</li>
<li>
<p>Update the host:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Reboot the host to ensure all updates are correctly applied.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Check the imgbased logs to see if any additional package updates have failed for a oVirt Node. If some packages were not successfully reinstalled after the update, check that the packages are listed in <strong>/var/imgbased/persisted-rpms</strong>. Add any missing packages then run <code>rpm -Uvh /var/imgbased/persisted-rpms/*</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Repeat this process for each host in the oVirt environment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Updating_the_Local_Repository_for_an_Offline_Red_Hat_Enterprise_Virtualization_Manager_Installation">Appendix B: Updating the Local Repository for an Offline oVirt Engine Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your oVirt Engine is hosted on a machine that receives packages via FTP from a local repository, you must regularly synchronize the repository to download package updates from the Content Delivery Network, then update or upgrade that machine. Updated packages address security issues, fix bugs, and add enhancements.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the system hosting the repository, synchronize the repository to download the most recent version of each available package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># reposync -l --newest-only /var/ftp/pub/ovirtrepo</pre>
</div>
</div>
<div class="paragraph">
<p>This command might download a large number of packages, and take a long time to complete.</p>
</div>
</li>
<li>
<p>Ensure that the repository is available on the Engine machine, and then update or upgrade the machine.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_additional_resources">Additional resources</h3>
<div class="ulist">
<ul>
<li>
<p>See <a href="#Updating_the_Red_Hat_Virtualization_Manager_minor_updates">Updating the oVirt Engine</a> for information on updating the Engine between minor versions.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal_notice">Legal notice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Certain portions of this text first appeared in the <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.4-beta/html-single/upgrade_guide/">Red Hat Virtualization 4.4-beta Upgrade Guide</a>. Copyright  2020 Red Hat, Inc. Licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-06-16 08:20:49 IDT
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>