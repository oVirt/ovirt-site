<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>LVMCache configuration for gluster brick provisioning | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="LVMCache configuration for gluster brick provisioning" />
<meta name="author" content="Denis Chaplygin" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/glusterbricklvmcache.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/glusterbricklvmcache.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="LVMCache configuration for gluster brick provisioning" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Denis Chaplygin" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Denis Chaplygin"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"LVMCache configuration for gluster brick provisioning","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3195/images/logo.svg"},"name":"Denis Chaplygin"},"url":"https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/glusterbricklvmcache.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3195/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3195/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3195/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3195/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3195/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3195/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3195/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3195/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3195/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/features/gluster/">
              <span property="name">Gluster</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/a47850263e36b9e8a35dcedf316a14ad?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/a47850263e36b9e8a35dcedf316a14ad?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Denis Chaplygin">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Denis Chaplygin</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sahina Bose">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sahina Bose</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3195/documentation/'>Documentation is available here.</a></div>

<h1 id="lvmcache-configuration-for-gluster-brick-provisioning">LVMCache configuration for gluster brick provisioning</h1>

<h2 id="summary">Summary</h2>

<p>This feature is about allowing the user to configure lvmcache on gluster bricks for better performance incase the server has SSDs or faster devices.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: <a href="https://github.com/akashihi">Denis Chaplygin</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Target Release: 4.2</li>
  <li>Status: Planning</li>
  <li>Last updated: February 01, 2018</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>Gluster bricks are directories on the server with a local filesystem that supports extended attributes. While provisiong bricks from oVirt engine, an xfs filesystem is created on logical volumes as per best practices. While creating bricks on SSD devices would be ideal for performance, this is often not practical due to cost factors. In such cases, on servers that have smaller SSD devices, an <a href="http://man7.org/linux/man-pages/man7/lvmcache.7.html">lvmcache</a> can be used to improve the performance of the slower LV housing the gluster bricks.</p>

<p>Currently gluster brick pirovisioning from engine is limited to a single brick created from one or more storage device(s). <a href="glusterhostdiskmanagement.html">This flow</a> uses python-blivet APIs to configure LVM on the node and create a brick mount point. There’s already a feature planned to make this more flexible <a href="gluster-multiple-bricks-per-storage.html">Support for multiple GlusterFS bricks on a block device(s)</a>. The idea is to move away from using python-blivet in favour of Ansible playbooks for brick provisioning.</p>

<h2 id="proposed-user-flow">Proposed User Flow</h2>

<h3 id="changes-to-brick-creation-flow">Changes to brick creation flow</h3>

<p>Add an option to configure and select a device to be used as lvmcache</p>

<p><img src="/ovirt-site/previews/3195/images/wiki/CreateBrickChanges.png" alt="" /></p>

<h2 id="implementation-details">Implementation Details</h2>

<h3 id="change-to-storagedevice-entity">Change to StorageDevice entity</h3>

<p>StorageDevice entity will have the following additional properties</p>

<ul>
  <li>cacheDevicePath</li>
  <li>cacheDeviceType (-if this is returned from vdsm)</li>
  <li>cacheSize</li>
  <li>cacheMode</li>
</ul>

<p>Table storage_device will have the corresponding additional columns.</p>

<h3 id="change-to-createbrickcommand">Change to CreateBrickCommand</h3>

<p>The CreateBrickCommand will be changed to execute an Ansible playbook based on the parameters passed. The playbook will create LV, cache LV and mount the brick.</p>

<p>Ansible playbook will internally use gdeploy to run the brick creation. (? till gluster ansible modules are available - otherwise we could add dependency on gdeploy to provide the gluster ansible modules)</p>

<h3 id="change-to-rest-api">Change to REST API</h3>

<p>There is no REST API available to create brick based on storage devices of host. These APIs need to be added.</p>

<p>New API:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  PUT /clusters/{cluster:id}/hosts/{host:id}/brickdevices/add
</code></pre></div></div>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3195/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3195/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3195/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3195/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2025 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/gluster/glusterbricklvmcache.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/gluster/glusterbricklvmcache.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
