<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Introducing Entity Search | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Introducing Entity Search" />
<meta name="author" content="Laszlo Hornyak" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2729/develop/developer-guide/introducing-entity-search.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2729/develop/developer-guide/introducing-entity-search.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Introducing Entity Search" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Laszlo Hornyak" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Laszlo Hornyak"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Introducing Entity Search","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2729/images/logo.svg"},"name":"Laszlo Hornyak"},"url":"https://ovirt.github.io/ovirt-site/previews/2729/develop/developer-guide/introducing-entity-search.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2729/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2729/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2729/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2729/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2729/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2729/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2729/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2729/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2729/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2729/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2729/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2729//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2729/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Laszlo Hornyak</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Maor Lipchuk</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/bc7a1e6e655b766ad1553b35c30cc83b?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shireesh Anjal</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<!-- TODO: Content review -->

<h1 id="introduction">Introduction</h1>

<p>This article intends to provide step by step instructions for introducing entity search in oVirt for a new entity.</p>

<h1 id="introduce-the-entity-in-database">Introduce the Entity in Database</h1>

<ul>
  <li>Database tables</li>
  <li>Stored Procedures</li>
  <li>DAO interface</li>
  <li>DAO implementation</li>
  <li>DAO JUnit tests</li>
</ul>

<p>The DAO must have a method to fetch list of entities given a query e.g.</p>

<p>`   <code class="language-plaintext highlighter-rouge">*</code>public<code class="language-plaintext highlighter-rouge"> </code>List<code class="language-plaintext highlighter-rouge">&lt;GlusterVolumeEntity&gt; </code>getAllWithQuery(String<code class="language-plaintext highlighter-rouge"> </code>query);`*</p>

<p>You can use the org.ovirt.engine.core.dao.SearchDAO interface, that defines this method.</p>

<h1 id="add-searchtype-entry">Add SearchType entry</h1>

<p>Introduce an entry (say <em>GlusterVolume</em>) for the entity in <em>org.ovirt.engine.core.common.interfaces.SearchType</em></p>

<h1 id="handle-the-new-search-type-in-the-searchquery-command">Handle the new search type in the SearchQuery command</h1>

<ul>
  <li>Introduce a method to prepare the query for fetching list of entities.</li>
</ul>

<p>The genericSearch might be useful to use, as follow:
 ‘’ genericSearch(DbFacade.getInstance().getGlusterVolumeDAO(), true, null); It should be the same as using the following code, but more generic:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    '' protected List`&lt;GlusterVolumeEntity&gt;` searchGlusterVolumes() {
    ''     List`&lt;GlusterVolumeEntity&gt;` returnValue = null;
    ''     QueryData2 data = InitQueryData(true);
    ''     if (data == null) {
    ''         returnValue = new ArrayList`&lt;GlusterVolumeEntity&gt;`();
    ''     } else {
    ''         returnValue = DbFacade.getInstance().getGlusterVolumeDAO().getAllWithQuery(data.getQuery());
    ''     }
    ''     return returnValue;
    '' }
</code></pre></div></div>

<ul>
  <li>
    <p>Modify the source <em>org.ovirt.engine.core.bll.SearchQuery</em> by adding a switch case for the new search type in method <em>executeQueryCommand</em> and invoke the method created in above step</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ''case GlusterVolume: {
 ''        returnValue = searchGlusterVolumes();
 ''        break;
 ''    }
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="changes-in-searchbackend-project">Changes in SearchBackend project</h1>

<p>This code is converted to JavaScript for rendering in browser. Following changes are required:</p>

<h2 id="introduce-a-search-object-for-your-entity">Introduce a Search Object for your entity</h2>

<p>Add an entry in <em>org.ovirt.engine.core.searchbackend.SearchObjects</em></p>

<p>`   <code class="language-plaintext highlighter-rouge">*</code>public<code class="language-plaintext highlighter-rouge"> </code>static<code class="language-plaintext highlighter-rouge"> </code>final<code class="language-plaintext highlighter-rouge"> </code>String<code class="language-plaintext highlighter-rouge"> </code>GLUSTER_VOLUMES_OBJ_NAME<code class="language-plaintext highlighter-rouge"> </code>=<code class="language-plaintext highlighter-rouge"> </code>“VOLUMES”;`*</p>

<p>Add entity name appended with : as a safe search expression in the init method</p>

<p>`   <code class="language-plaintext highlighter-rouge">*</code>SAFE_SEARCH_EXPR.add(GLUSTER_VOLUMES_OBJ_NAME.toLowerCase()<code class="language-plaintext highlighter-rouge"> </code>+<code class="language-plaintext highlighter-rouge"> </code>SEPERATOR);`*</p>

<h2 id="search-field-auto-completion">Search field Auto Completion</h2>

<p>Add the entity (in plural) as a valid basic search verb in the constructor of <em>org.ovirt.engine.core.searchbackend.SearchObjectAutoCompleter</em></p>

<p>`   <code class="language-plaintext highlighter-rouge">*</code>mVerbs.put(SearchObjects.GLUSTER_VOLUMES_OBJ_NAME,<code class="language-plaintext highlighter-rouge"> </code>SearchObjects.GLUSTER_VOLUMES_OBJ_NAME);`*</p>

<p>In case you need to filter the entities based on other related entities e.g. Gluster Volumes that belong to a particular Cluster, introduce a Join with that entity in the same constructor.</p>

<p>`   <code class="language-plaintext highlighter-rouge">*</code>addJoin(SearchObjects.GLUSTER_VOLUMES_OBJ_NAME,<code class="language-plaintext highlighter-rouge"> </code>“cluster_id”,<code class="language-plaintext highlighter-rouge"> </code>SearchObjects.VDC_CLUSTER_OBJ_NAME,<code class="language-plaintext highlighter-rouge"> </code>“vds_group_id”);`*</p>

<p>Modify method <em>getRelatedTableName</em> to return the correct table name for your entity.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ''else if (StringHelper.EqOp(obj, SearchObjects.GLUSTER_VOLUMES_OBJ_NAME)) {
     ''        retval = "gluster_volumes";
     ''    }
</code></pre></div></div>

<p>Modify method <em>getPrimeryKeyName</em> to return the name of the primary key of your entity table</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ''else if (StringHelper.EqOp(obj, SearchObjects.GLUSTER_VOLUMES_OBJ_NAME)) {
     ''        retval = "id";
     ''    }
</code></pre></div></div>

<p>Modify method <em>getDefaultSort</em> to return the default ordering clause to be used in the SQL query while fetching your entity objects from the database.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ''else if (StringHelper.EqOp(obj, SearchObjects.GLUSTER_VOLUMES_OBJ_NAME)) {
     ''        retval = "vol_name ASC ";
     ''    }
</code></pre></div></div>

<p>Modify method <em>getFieldAutoCompleter</em> and introduce an else if for your entity to return an object of the condition field auto completer that you will write for the entity.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ''else if (StringHelper.EqOp(obj, SearchObjects.GLUSTER_VOLUMES_OBJ_NAME)) {
     ''        retval = new GlusterVolumeConditionFieldAutoCompleter();
     ''    }
</code></pre></div></div>

<p>If you have added a cross reference (join) with another object in the earlier step, modify the method <em>getCrossRefAutoCompleter</em> to return an object of the Cross Reference auto completer that you will write.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>     ''} else if (StringHelper.EqOp(obj, SearchObjects.GLUSTER_VOLUMES_OBJ_NAME)) {
     ''        return new GlusterVolumeCrossRefAutoCompleter();
     ''    }
</code></pre></div></div>

<h2 id="entity-condition-field-auto-completer">Entity Condition Field Auto Completer</h2>

<p>Write a new class that extends from <em>BaseConditionFieldAutoCompleter</em>. The job of this class is to provide information about auto completion to be provided for filtering the entities, based on attributes of the entity.</p>

<h3 id="the-constructor">The constructor</h3>

<ul>
  <li>Add verbs for every attribute on which you want to support filtering</li>
  <li>Invoke method buildCompletions after setting all verbs.</li>
  <li>Define the types of every filtering attribute.</li>
  <li>
    <p>Add column name of every filtering attribute</p>

    <p>’’   public GlusterVolumeConditionFieldAutoCompleter() {
  ‘’       super();
  ‘’       // Building the basic verbs Dict
  ‘’       mVerbs.put(“NAME”, “NAME”);
  ‘’       mVerbs.put(“TYPE”, “TYPE”);
         …
  ‘’       // Building the autoCompletion Dict
  ‘’       buildCompletions();
  ‘’       // Building the types dict
  ‘’       getTypeDictionary().put(“NAME”, String.class);
  ‘’       getTypeDictionary().put(“TYPE”, VOLUME_TYPE.class);
  ‘’       …
  ‘’       // building the ColumnName Dict
  ‘’       mColumnNameDict.put(“NAME”, “vol_name”);
  ‘’       mColumnNameDict.put(“TYPE”, “vol_type”);
  ‘’       …
  ‘’       // Building the validation dict
  ‘’       buildBasicValidationTable();
  ‘’   }</p>
  </li>
</ul>

<p>The “verbs” added here, are the first level of auto-completion. As soon as you type your entity name and press colon (e.g. “Volumes :”) in the search text box in the UI, you will get a list of these verbs (along with verbs from the cross reference auto completer, if any), as auto-completion proposals.</p>

<p>The next step is to map every field with what kind of comparisons it supports.</p>

<h3 id="method-getfieldrelationshipautocompleter">Method <em>getFieldRelationshipAutoCompleter</em></h3>

<p>Override this method to return appropriate “condition relation auto completer” for given field. e.g. Return <em>StringConditionRelationAutoCompleter</em> for string fields, <em>NumericConditionRelationAutoCompleter</em> for numeric fields, and so on. This reflects while typing the search string in the UI. As soon as you type the name of a numeric field and press the spacebar, you will see all numeric operators like &lt;, &gt;, =, !=, etc as auto-completion proposals.</p>

<p>The next step is to provide auto-completion for values of these fields. This can be useful if the values must be from a set of predefined values e.g. booleans, flags, enums.</p>

<h3 id="method-getfieldvalueautocompleter">Method <em>getFieldValueAutoCompleter</em></h3>

<p>Override this method to return appropriate “condition value auto completer” for given field. e.g.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   if (fieldName.equals("status")) {
  ''       return new EnumValueAutoCompleter(VOLUME_STATUS.class);
  ''   }
</code></pre></div></div>

<p>In case auto-completion is not required for values of the given field, return null</p>

<p><strong>Note:</strong> If you use <em>EnumValueAutoCompleter</em>, the corresponding enum must provide following two methods:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   public int getValue();
  ''   public static `&lt;enum_name&gt;` forValue(int value);
</code></pre></div></div>

<h2 id="cross-reference-auto-completer">Cross Reference Auto Completer</h2>

<p>Write a new class that extends <em>SearchObjectsBaseAutoCompleter</em> and add required verbs in the constructor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   public GlusterVolumeCrossRefAutoCompleter() {
  ''       mVerbs.put(SearchObjects.VDC_CLUSTER_OBJ_NAME, 
  ''                           SearchObjects.VDC_CLUSTER_OBJ_NAME);
  ''       buildCompletions();
  ''   }
</code></pre></div></div>

<p>These verbs will also get added to the list of auto-completion proposals for the entity.</p>

<p>«Other capabilities provided by the cross reference auto completer, if any, to be added»</p>

<h1 id="gwt-xml-entries">GWT xml entries</h1>

<p>Add entries for the newly created auto completer classes to frontend/webadmin/modules/sharedgwt/src/main/java/org/ovirt/engine/SharedGwt.gwt.xml</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ''   

 ''       ...
 ''       &lt;include name="core/searchbackend/GlusterVolumeConditionFieldAutoCompleter.java" /&gt;
 ''       &lt;include name="core/searchbackend/GlusterVolumeCrossRefAutoCompleter.java" /&gt;
 ''
</code></pre></div></div>

<h1 id="gwt-code">GWT Code</h1>

<p>Following sources need changes in appropriate places to create node(s) for the entity in the system tree, add new tab(s) for the same and link it with the search text box</p>

<ul>
  <li>org.ovirt.engine.ui.uicommonweb.models.CommonModel</li>
  <li>org.ovirt.engine.ui.uicommonweb.models.SystemTreeModel</li>
  <li>New class(es) for the entity tab(s)</li>
</ul>

<p>«More details to be added if required»</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2729/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2729/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2729/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2729/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/introducing-entity-search.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/developer-guide/introducing-entity-search.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
