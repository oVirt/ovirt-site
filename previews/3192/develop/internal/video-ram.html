<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Video RAM | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Video RAM" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3192/develop/internal/video-ram.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3192/develop/internal/video-ram.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Video RAM" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Video RAM","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3192/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3192/develop/internal/video-ram.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3192/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3192/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3192/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3192/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3192/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3192/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3192/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3192/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3192/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/internal/">
              <span property="name">Internal</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f4f3e4820685eab0c3b448e59d3f2703?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f4f3e4820685eab0c3b448e59d3f2703?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Milan Zamazal">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Milan Zamazal</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Much of this developer documentation provides historical context but may not reflect the current state of the project.<br>If you see outdated content please navigate to the page footer and click "<strong>Report an issue on GitHub</strong>".<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3192/documentation/'>User Documentation is available here.</a></div>

<h1 id="video-ram">Video RAM</h1>

<p>There is a lot of confusion about video RAM settings and workings in libvirt/QEMU. This page provides compilation of information on the topic gathered from many sources and represents the best knowledge available as of December 2015.</p>

<h2 id="state-in-ovirt-until-36">State in oVirt until 3.6</h2>

<p>The following video RAM settings were applied in oVirt per PCI device:</p>

<ul>
  <li>ram = 64 MB * number_of_heads</li>
  <li>vram = 32 MB</li>
  <li>vgamem = unset (default 16 MB set by libvirt)</li>
</ul>

<p>Note: If single-PCI option is not set, number_of_heads is always 1 and “heads” option in the Engine defines number of separate video devices. If single-PCI option is set, there is only single video device and “heads” Engine option transforms to number_of_heads above.</p>

<h2 id="libvirt">libvirt</h2>

<p>Meanings of <code class="language-plaintext highlighter-rouge">&lt;video&gt;</code> element attributes in domain XML:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">ram</code> (KB) specifies primary memory bar size, corresponds to <code class="language-plaintext highlighter-rouge">ram_size</code> (B) QEMU command line option.</li>
  <li><code class="language-plaintext highlighter-rouge">vram</code> (KB) specifies secondary memory bar size, corresponds to <code class="language-plaintext highlighter-rouge">vram_size</code> (B) QEMU command line option.</li>
  <li><code class="language-plaintext highlighter-rouge">vgamem</code> (KB) must be set to at least certain minimum value based on screen resolution and number of heads, corresponds to <code class="language-plaintext highlighter-rouge">vgamem_mb</code> (MB) QEMU command line option. <code class="language-plaintext highlighter-rouge">vgamem</code> libvirt option is available since RHEL-7.1; <code class="language-plaintext highlighter-rouge">vgamem_mb</code> QEMU option is available since RHEL-6.7.</li>
</ul>

<h2 id="qxl-qemu-driver">QXL QEMU driver</h2>

<p><strong>Please note</strong> that all the information about video RAM sizes below should be taken with grain of salt. Nobody knows the perfect ultimate answer to that topic, there are different guest OS drivers and as stated above, things may completely change in oVirt 4. Users should be able to override the computed default settings if they use uncommon arrangements or the computed values don’t work well for them. This can be done using before_vm_start VDSM hook.</p>

<p>You can look for implementation details in qxl.c in QEMU sources. But don’t rely on anything, things may change, so it’s a good idea to get confirmation from QEMU and/or libvirt developers about everything.</p>

<p>libvirt <code class="language-plaintext highlighter-rouge">ram</code> represents primary memory bar, 32-bit only. libvirt <code class="language-plaintext highlighter-rouge">vram</code> represents secondary memory bar, 64-bit (it may not be true as of now, there is a separate <code class="language-plaintext highlighter-rouge">vram_size_mb</code> QEMU command line option for that, not necessarily used by libvirt).</p>

<p><code class="language-plaintext highlighter-rouge">vgamem</code> is allocated within <code class="language-plaintext highlighter-rouge">ram</code>. Minimum <code class="language-plaintext highlighter-rouge">ram</code> size, as enforced by QEMU regardless the command line settings, is <code class="language-plaintext highlighter-rouge">2 * vgamem</code>. <code class="language-plaintext highlighter-rouge">vram</code> is allocated separately.</p>

<p>Maximum supported screen resolution is 4 megapixels (2560x1600). Maximum number of heads is 4.</p>

<p>The required memory sizes are basically dependent on screen resolution multiplied by number of heads. But this should actually be the bounding rectangle of the screen arrangement. For instance, let’s assume 4 screens with resolution 1024x768 each. If they are arranged compactly in a single row or in two rows and two columns, it’s fine, memory for 3 megapixels is required. But if three screens are in a row and the fourth screen is below them then the required memory may correspond (depending on the driver) to 4.5 (3072x1536) megapixels; when all the screens are arranged diagonally, it’s 12 (4096x3072) megapixels. We don’t assume such setups when computing memory values.</p>

<p>Due to 32-bit addressing in QEMU, total (for all video cards together) maximum size of <code class="language-plaintext highlighter-rouge">ram</code> is 256 or 512 MB. <strong>TODO</strong>: Check what happens when we specify more.</p>

<p>All memory sizes should be specified as powers of 2. This is not a strict requirement, it’s just advised.</p>

<p>Video RAM is allocated in addition to specified guest main RAM, not within it.</p>

<p>The recommended memory sizes are dependent on particular guest OS and its drivers:</p>

<ul>
  <li>Windows:
    <ul>
      <li>vgamem = screen_width * screen_height * 4</li>
      <li>ram = 4 * vgamem</li>
      <li>vram unimportant (can be e.g. 8 MB)</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li>RHEL-6 (uses UMS driver):
    <ul>
      <li>vgamem = screen_width * screen_height * 4 * number_of_heads</li>
      <li>ram = 4 * vgamem</li>
      <li>vram unimportant (can be e.g. 8 MB)</li>
      <li>Note: <code class="language-plaintext highlighter-rouge">ram</code> may (or may not) work even when it’s reduced to <code class="language-plaintext highlighter-rouge">2 * vgamem</code>, but developers recommend using the larger value.</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li>RHEL-7 (uses KMS driver):
    <ul>
      <li>vgamem = screen_width * screen_height * 4 * number_of_heads</li>
      <li>ram = 4 * vgamem</li>
      <li>vram &gt;= vgamem * 2</li>
      <li>Note: <code class="language-plaintext highlighter-rouge">ram</code> may (or may not) work with much smaller values, but it’s suggested to set it at least so that <code class="language-plaintext highlighter-rouge">ram + vram &gt;= 3 * vgamem</code>.</li>
      <li>Note: An alternative formula for <code class="language-plaintext highlighter-rouge">vram</code> is <code class="language-plaintext highlighter-rouge">screen_width * screen_height * 4 * (number_of_heads + 1)</code>. But developers strongly recommend using at least <code class="language-plaintext highlighter-rouge">vgamem * 2</code>.</li>
    </ul>
  </li>
</ul>

<p>It may not be a good idea to use excessively large memory values just to be safe. The extra (above required minimum) memory may be actually utilized by the guest OS drivers and applications (e.g. Excel or Firefox) for purposes not necessarily very important for graphics performance. As the result, physical RAM may be wasted for no useful purpose.</p>

<h2 id="vncvga-and-vnccirrus">vnc/vga and vnc/cirrus</h2>

<ul>
  <li>The better choice of the two is clearly vnc/vga.</li>
  <li>Multihead is not supported on any of the drivers.</li>
  <li>Default <code class="language-plaintext highlighter-rouge">vram</code> value, 16 MB, is fine for most common uses, except for full HD on Wayland (needs twice as much due to two framebuffers—page-flipping).</li>
  <li>Supported by libvirt only on RHEL-7.</li>
</ul>

<h2 id="new-settings-in-ovirt-36x">New settings in oVirt 3.6.X</h2>

<p>We use the following settings in new oVirt versions (per PCI device):</p>

<ul>
  <li>QXL
    <ul>
      <li>vgamem = 16 MB * number_of_heads</li>
      <li>ram = 4 * vgamem</li>
      <li>vram = 2 * vgamem for RHEL-7 guest OS</li>
      <li>vram = 8 MB for other guest OSes</li>
    </ul>
  </li>
  <li>vnc/vga and vnc/cirrus:
    <ul>
      <li>vram = 16 MB</li>
    </ul>
  </li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3192/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3192/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3192/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3192/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/internal/video-ram.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/internal/video-ram.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
