<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>JsonRpc | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="JsonRpc" />
<meta name="author" content="Andrew Dahms" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3138/develop/release-management/features/infra/jsonrpc.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3138/develop/release-management/features/infra/jsonrpc.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="JsonRpc" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Dahms" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew Dahms"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"JsonRpc","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3138/images/logo.svg"},"name":"Andrew Dahms"},"url":"https://ovirt.github.io/ovirt-site/previews/3138/develop/release-management/features/infra/jsonrpc.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3138/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3138/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3138/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3138/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3138/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3138/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3138/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3138/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3138/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3138/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3138/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3138/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3138/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3138/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3138/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3138/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3138/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3138/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3138/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3138/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3138/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3138/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3138//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3138//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3138/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3138/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3138/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3138/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3138/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Andrew Dahms">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Dahms</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f7875b3d1b4e5cc473f510b59531afcc?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f7875b3d1b4e5cc473f510b59531afcc?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Antoni Puimedon">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Antoni Puimedon</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/194ccfad6c8556f5f2b5cfc5b2fdcfde?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/194ccfad6c8556f5f2b5cfc5b2fdcfde?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Piotr Kliczewski">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Piotr Kliczewski</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sandro Bonazzola">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"><a rel="author" href="https://twitter.com/sandrobonazzola" title="Sandro Bonazzola">Sandro Bonazzola</a></span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Saggi Mizrahi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Saggi Mizrahi</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/9ba64bad62810ce4f4d5ea0df5bb75c2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/9ba64bad62810ce4f4d5ea0df5bb75c2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Yaniv Bronheim">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yaniv Bronheim</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3138/documentation/'>Documentation is available here.</a></div>

<h1 id="json-rpc">Json Rpc</h1>

<h2 id="introduction-of-messaged-based-communication-using-json-rpc-on-top-of-various-transport-protocols">Introduction of messaged based communication using JSON-RPC on top of various transport protocols</h2>

<h3 id="summary">Summary</h3>

<p>Using a phased approach, we are going to a point where messaging is the main communication model between the engine and VDSM as well as the numerous VDSM subsystems. The biggest difference between current implementation and the goal is communication model change from synchronous HTTP to asynchronous TCP. The XML message format is going to be replaced with JSON, which will reduce parsing time.</p>

<h3 id="advantages-of-jsonrpc-over-xmlrpc">Advantages Of JsonRPC Over XmlRPC</h3>

<ul>
  <li>Less data send over the wire</li>
  <li>Faster parsing of message content</li>
  <li>Asynchronous communication</li>
  <li>Enable broker usage by using stomp 1.2 protocol</li>
  <li>Maintains connection and uses heart beats to check its health</li>
</ul>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Saggi Mizrahi (smizrahi)</li>
  <li>Email: <a href="mailto:smizrahi@redhat.com">smizrahi@redhat.com</a></li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>Last updated on â€“ by (WIKI)</li>
  <li>Were currently in <a href="#phase-1">Phase 1</a></li>
</ul>

<h2 id="phases">Phases</h2>

<h3 id="phase-0">Phase 0</h3>

<p>Below is prior state to the messaging changes. The engine uses XML-RPC over HTTP to communicate with the VDSM. There are two connections active between the engine and a VDSM.</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase0.png" alt="" /></p>

<h3 id="phase-1">Phase 1</h3>

<p>This phase is intermediate development milestone which is not meant to be released. It makes introduction of new protocols easier and it paves the way for engine/vdms asynchronous communication. VDSM would listen on a different port for each supported transport.</p>

<p>The engine sends messages by using one of the protocol reactors or apache http client for xml-rpc. VDSM parses messages using appropriate transport reactor and the message body is passed to a json-rpc server for processing. The Server parses json data and calls the appropriate method on the bridge which is mapped to corresponding vdsm object responsible for performing the command.</p>

<p>AMQP protocol is available but not usable due to instability of the protocol implementation used.</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase1.png" alt="" /></p>

<h3 id="phase-2">Phase 2</h3>

<p>For this phase the main addition is protocol detection. Instead of having a dedicated port per protocol there is single port used by protocol detector. It is responsible for performing SSL handshake and peeking at the first message to recognize which reactor should handle communication. After detecting the protocol it passes a socket to the correct reactor for further message processing.</p>

<p>This is going to be released for 3.5</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase2.png" alt="" /></p>

<h3 id="phase-3-to-be-done">Phase 3 (To be done)</h3>

<p>For VDSM the main addition in this phase is a broker. Up until this point protocol reactors ignored brokering semantics. This change adds an actual entity with brokering semantics.</p>

<p>For the engine the main change is to reduce number of active connections to single VDSM. IRS and VDS will share a client using particular protocol.</p>

<p>Broker Features:</p>

<ul>
  <li>Subscriptions</li>
  <li>Topics</li>
</ul>

<p>Low Priority Features:</p>

<ul>
  <li>Queues</li>
  <li>Message acknowledgment\settlement (provided by AMQP 1.0)</li>
</ul>

<p>There is a possibility this phase would be skipped and we would just use existing broker implementation.</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase3.png" alt="" /></p>

<h3 id="phase-4-to-be-done">Phase 4 (To be done)</h3>

<p>In this phase VDSM subsystems would start using json-rpc communication and manage their own topics. There would still be the legacy interface but there will be a move towards a segmented and separate task management per subsystem.</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase4.png" alt="" /></p>

<h3 id="phase-5-to-be-done">Phase 5 (To be done)</h3>

<p>In this phase internal broker will be pulled out (if we are not already using standalone broker implementation). We will remove the xml-rpc interface entirely and more subsystems are being separated. It is encouraged for VDSM subsystems to run in their own processes in this phase.</p>

<p><img src="/ovirt-site/previews/3138/images/wiki/Jsonrpc_phase5.png" alt="" /></p>

<h2 id="external-links">External links</h2>

<ul>
  <li><a href="http://stomp.github.io">STOMP</a></li>
  <li><a href="http://www.jsonrpc.org/">JSON-RPC</a></li>
  <li><a href="http://www.amqp.org/">AMQP</a></li>
</ul>

<h2 id="attachments">Attachments</h2>

<ul>
  <li><a href="http://resources.ovirt.org/old-site-files/wiki/Schemas.tgz"> schema </a> (<a href="https://wiki.gnome.org/Apps/Dia/">dia</a> file containing the schema sources)</li>
</ul>

<p><a href="/ovirt-site/previews/3138/develop/release-management/features/">JsonRpc</a> <a href="/ovirt-site/previews/3138/develop/release-management/releases/3.5/feature.html">JsonRpc</a></p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3138/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3138/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3138/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3138/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/jsonrpc.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/infra/jsonrpc.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
