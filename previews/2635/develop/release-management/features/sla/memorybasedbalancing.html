<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>MemoryBasedBalancing | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="MemoryBasedBalancing" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2635/develop/release-management/features/sla/memorybasedbalancing.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2635/develop/release-management/features/sla/memorybasedbalancing.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MemoryBasedBalancing" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2635/images/logo.svg"}},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"MemoryBasedBalancing","url":"https://ovirt.github.io/ovirt-site/previews/2635/develop/release-management/features/sla/memorybasedbalancing.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2635/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2635/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2635/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2635/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2635/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2635/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2635/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2635/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2635/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2635/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2635/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2635/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2635/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2635/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2635/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2635/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2635/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2635/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2635/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2635/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2635/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2635/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2635/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2635/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2635/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2635/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2635/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2635/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2635/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2635/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2635/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2635/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2635/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2635/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2635/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2635//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2635//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2635/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2635/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2635/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2635/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2635/develop/release-management/features/sla/">
              <span property="name">Sla</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d3e5014dcc318e6606b18a8f5fd90dae?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Sivak</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2635/documentation/'>Documentation is available here.</a></div>

<h1 id="memory-based-balancing">Memory Based Balancing</h1>

<h2 id="cpu-and-memory-based-cluster-auto-balancing">CPU and Memory based cluster auto balancing</h2>

<h3 id="summary">Summary</h3>

<p>The auto balancing cluster policies we have today use only CPU load to compute whether the cluster is reasonably balanced. This is not ideal in situations where the prevalent load is memory based and CPU load is low. The goal of this feature is to add support for memory based balancing rules.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Martin Sivak (Msivak)</li>
  <li>Email: <a href="mailto:msivak@redhat.com">msivak@redhat.com</a></li>
</ul>

<h3 id="detailed-description">Detailed Description</h3>

<p>The issue we are trying to solve can be demonstrated on a lightly loaded cluster:</p>

<p>When you start 100 VM (for example) that only boot and wait in PXE or bootloader menu the total load on the host is going to be close to 0. The current balancing policy can (and will) keep adding VMs to a single host (considering other constraints are not a factor), because it only uses the current CPU load in the scoring function.</p>

<p>It also won’t notice any gross unbalance in the number of VMs running on different hosts if the CPU load is under the “High Load” threshold. And that is by default 80% that is much higher than the accumulated 0% or 1%.</p>

<h4 id="the-proposed-changes">The proposed changes</h4>

<ul>
  <li>When CPU balancing is needed, everything will work as usual with one exception. Memory over-committed hosts won’t be used as destination.</li>
  <li>When no CPU balancing is needed, free memory will control the balancing using the same rules CPU uses: Over-committed hosts will be considered to be willing to donor a VM to an Under-committed host (Evenly balanced policy) or both Over- and Under-committed hosts will be sourcing the VMs for the “middle” loaded hosts (Power saving policy). Memory balancing will get its own set of High and Low limits in terms of free MB of RAM.</li>
  <li>No migration will happen to hosts that are (or will become) either CPU or memory over-committed.</li>
  <li>The memory based balancing can be disabled by using 0 MB as both high and low thresholds.</li>
  <li>Setting only one of the thresholds in memory based balancing (high or low) might lead to unexpected results.</li>
  <li>Unit-tests will be introduced to make sure the old CPU load based behaviour is still the same.</li>
  <li>New weight policy unit for memory load will appear. Each 100 MB of free memory on a host will be worth one negative (better) weight point.</li>
</ul>

<p>The balancing operations are illustrated using the two following pictures:</p>

<p><img src="/ovirt-site/previews/2635/images/wiki/Equally-balanced.png" alt="" /> <img src="/ovirt-site/previews/2635/images/wiki/Power-saving.png" alt="" /></p>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<ul>
  <li>Cluster auto-balancing will be usable for memory loaded clusters as well.</li>
  <li>Refactoring and unit test support will greatly improve the reliability of the Scheduler</li>
</ul>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>This feature has no external dependencies and does not modify any code outside of the engine’s scheduling mechanisms.</p>

<h3 id="documentation--external-references">Documentation / External references</h3>

<p>TBD</p>

<h3 id="testing">Testing</h3>

<ul>
  <li>Unit tests are provided for the basic cases</li>
  <li>There is a simple way (CSV tables) of providing new test scenarios to become part of the test suite</li>
  <li>Manual testing with multiple hosts and VMs is required to see the live behaviour</li>
</ul>

<h3 id="contingency-plan">Contingency Plan</h3>

<p>No memory based scheduling will be available. There is no danger to the existing functionality if this is not accepted.</p>

<h3 id="release-notes">Release Notes</h3>

<p>TBD</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2635/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2635/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2635/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2635/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2021 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/sla/memorybasedbalancing.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/sla/memorybasedbalancing.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
