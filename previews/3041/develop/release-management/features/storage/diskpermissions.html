<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>DiskPermissions | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="DiskPermissions" />
<meta name="author" content="Allon Mureinik" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3041/develop/release-management/features/storage/diskpermissions.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3041/develop/release-management/features/storage/diskpermissions.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="DiskPermissions" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Allon Mureinik" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Allon Mureinik"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"DiskPermissions","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3041/images/logo.svg"},"name":"Allon Mureinik"},"url":"https://ovirt.github.io/ovirt-site/previews/3041/develop/release-management/features/storage/diskpermissions.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3041/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3041/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3041/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3041/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3041/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3041/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3041/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3041/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3041/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3041/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3041/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3041/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3041/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3041/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3041/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3041/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3041/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3041/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3041/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3041/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3041/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3041/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3041//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3041//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3041/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3041/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3041/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3041/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3041/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/869d772390b0b317e4b37bb0714ab68e?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/869d772390b0b317e4b37bb0714ab68e?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Allon Mureinik">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Allon Mureinik</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Daniel Erez">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Daniel Erez</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92d19be4e66f497e670d018d02158d5a?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Livnat Peer">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Livnat Peer</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/90758110b19ee0a2e03473012fdc1bd7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Moti Asayag">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Moti Asayag</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/b1766f2c8efbe055218f5ccdae3bc8da?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/b1766f2c8efbe055218f5ccdae3bc8da?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Omer Frenkel">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Omer Frenkel</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/cd28135f3bdc2a6146213104dfe6bf79?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/cd28135f3bdc2a6146213104dfe6bf79?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Shmuel Leib Melamud">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shmuel Leib Melamud</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3041/documentation/'>Documentation is available here.</a></div>

<h1 id="disk-permissions">Disk Permissions</h1>

<h2 id="summary">Summary</h2>

<p>The Disk Permissions feature is supplementary for Disk related features (Floating Disk, Shared Raw Disk, Direct LUN). It enables permissions management on a Disk.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Moti Asayag</li>
  <li>Email: masayag@redhat.com</li>
</ul>

<h2 id="design">Design</h2>

<p>Disk inherits permissions from the VM it is attached to and from the storage domain it resides on (if there is one)
When granting a user ‘Create VM’ permission, the user will be able to create a VM without creating Disks.
Creating disks requires specific permissions for that, on the storage domain or the storage pool.
Add permissions command will support adding permissions which are already existing in the system without failing the command in can-do-action as done today.
It will serve the client when the user decide not to use permissions nor quota for Disk creation.
When disk is created, ‘DISK_OPERATOR’ role is given to the user which created the Disk.
When creating VM from template, the user should get VM_OPERATOR permissions for the VM (as is now) and DISK_OPERATOR for the VM Disks.</p>

<h3 id="disk-permissions-and-quota">Disk Permissions and Quota</h3>

<p>When Quota is enabled, Disk consumption will be enforced by the Quota, regardless the user’s permissions on the Storage entities.
When Quota is disabled for the Data Center, User must have permissions on Storage domain for disk operations requiring quota(create/move).
Therefore when Quota is set as disabled for the Data Center, the GUI will suggest to add DISK_CREATOR permissions on the relevant storage domains to everyone.
 The following section describes permissions for Disk entities.</p>

<h3 id="disk-actions">Disk Actions</h3>

<p>Required permissions for Disk related actions:</p>

<ul>
  <li>Create disk - requires permissions on the Storage Domain.</li>
  <li>Attach disk to VM - requires permissions on the Disk and on the VM (applies for shared disk as well).</li>
  <li>Detach disk from VM - requires permissions on the VM only. (Unlike attach disk that requires permissions on the VM and on the Disk).</li>
  <li>Activate/Deactivate disk on VM (also Hot Plug) - requires permission on the VM.</li>
  <li>Remove disk (from Disk tab)- permissions on the Disk.</li>
  <li>Update disk - permissions on the Disk.</li>
  <li>Move or copy disk - requires permissions on the Disk and on the target Storage Domain.</li>
  <li>Add disk to VM - requires both permissions on the VM and on the storage domain (same as adding disk and attaching to VM).
    <ul>
      <li>Create - on storage domain</li>
      <li>Attach - on disk and VM</li>
      <li>Activate - on VM</li>
    </ul>
  </li>
  <li>Remove VM - we’ll extend the command to support either deleting disks from the system (the current behavior) or only detach the disks, permissions goes as follows:
    <ul>
      <li>If disks are marked for deletion - requires permissions on the removed Disks and on the VM.</li>
      <li>If disks aren’t marked for deletion - the disks are detached, therefore no permissions required for the Disk, only for removing VM.</li>
    </ul>
  </li>
</ul>

<h3 id="roles">Roles</h3>

<h4 id="new-action-groups-for-disk-object-type">New Action Groups for Disk Object Type</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   CREATE_DISK - AddDisk, AddDiskToVm
   EDIT_DISK_PROPERTIES - UpdateDisk, UpdateVM, Activate/Deactivate
   ATTACH_DISK - AttachDiskToVm
   CONFIGURE_DISK_STORAGE - MoveOrCopyDisk
   DELETE_DISK - RemoveDisk, RemoveVm
</code></pre></div></div>

<h4 id="new-roles">New Roles</h4>

<p>New predefined user role for disks <strong>DISK_OPERATOR</strong> will be given to user when creating a Disk (either from Disk tab or from VM’s disk sub-tab).
DISK_OPERATOR will be associated with the following action groups: CREATE_DISK, EDIT_DISK_PROPERTIES, ATTACH_DISK, CONFIGURE_DISK_STORAGE and DELETE_DISK.</p>

<p>` Add new role to <code class="language-plaintext highlighter-rouge">*</code>PredefinedRoles.java`*
       Add new upgrade script for new roles and updating existing roles.</p>

<h4 id="updated-roles">Updated Roles</h4>

<p>SuperUser, ENGINEPowerUser, ClusterAdmin, DataCenterAdmin, StorageAdmin and VmOperator should be extended with action groups of Disks (CREATE_DISK, EDIT_DISK_PROPERTIES, ATTACH_DISK, DELETE_DISK).
Currently attach/detach is being executed as part of the UpdateVm action.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   Existing roles are Update by upgrade script.
   Extend `*`VdcObjectType`*` with Disk.
</code></pre></div></div>

<h3 id="db-changes">DB Changes</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   Modify create_functions.sql:
   Add support for Disk to `*`fn_get_entity_parents`*` stored-procedure.
   Add support for Disk to `*`fn_get_entity_name`*` stored-procedure.
</code></pre></div></div>

<h3 id="upgrade-db">Upgrade DB</h3>

<p>DB Upgrade should handle the following:</p>

<ul>
  <li>Add “Disk Operator” actions to the following predefined roles:
    <ul>
      <li>SuperUser, ENGINEPowerUser, ClusterAdmin, DataCenterAdmin, VmOperator and StorageAdmin.</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li>Add “Disk Operator” permissions on the relevant Disks to:
    <ul>
      <li>“VM Operator” users (applies to users with permissions on *VM* with *Disks* attached to it).</li>
    </ul>
  </li>
</ul>

<!-- -->

<ul>
  <li>Permissions will be given on storage domains to users with CREATE_VM action group for the storage domains where the VM disks reside on (DISK_CREATOR role).
    <ul>
      <li>CREATE_VM on Cluster will allow creating Disks on the Storage Domains of the Data Center which the Cluster belongs to.</li>
      <li>CREATE_VM on Data Center will allow creating Disks on the Storage Domains of the Data Center.</li>
      <li>CREATE_VM on System will allow creating Disks on all Storage Domains in the System.</li>
    </ul>
  </li>
</ul>

<h3 id="ui-changes">UI Changes</h3>

<p>Add Permissions sub-tab under Disks main tab
Add Disk Operator role to Roles Tree in:
 <em>frontend/webadmin/modules/uicommonweb/src/main/java/org/ovirt/engine/ui/uicommonweb/models/configure/roles_ui/RoleTreeView.java</em></p>

<p>` <code class="language-plaintext highlighter-rouge">*</code>frontend/webadmin/modules/uicompat/src/main/java/org/ovirt/engine/ui/uicompat/Enums.java<code class="language-plaintext highlighter-rouge">*
</code> <code class="language-plaintext highlighter-rouge">*</code>frontend/webadmin/modules/uicompat/src/main/resources/org/ovirt/engine/ui/uicompat/Enums.properties`*</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Permission management for Disks enhances the Disk functionality, provides flexibility to users and protects it from misuse.
Granting permissions on Disk to user is done via the Administrator Portal or using RESTful API.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<p>The Disk Permissions is dependent on the following features:</p>

<ul>
  <li>SharedRawDisk</li>
  <li>Floating Disk</li>
  <li>Direct LUN</li>
</ul>

<p>Affected oVirt projects:</p>

<ul>
  <li>Engine-core</li>
  <li>Admin Portal</li>
</ul>

<h2 id="open-issues">Open issues</h2>

<ul>
  <li>Direct LUN - Add/Remove Direct LUN disk has its own commands or share the same Disk Add/Remove ? If share, need to distinguish the required permission by the Disk in the <em>CommandBase.getPermissionCheckSubjects</em></li>
</ul>

<h2 id="documentation--external-references">Documentation / External references</h2>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3041/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3041/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3041/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3041/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/diskpermissions.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/storage/diskpermissions.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
