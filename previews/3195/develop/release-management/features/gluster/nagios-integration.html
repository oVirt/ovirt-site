<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Nagios Integration | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Nagios Integration" />
<meta name="author" content="Kanagaraj Mayilsamy" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/nagios-integration.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/nagios-integration.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Nagios Integration" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Kanagaraj Mayilsamy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kanagaraj Mayilsamy"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Nagios Integration","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3195/images/logo.svg"},"name":"Kanagaraj Mayilsamy"},"url":"https://ovirt.github.io/ovirt-site/previews/3195/develop/release-management/features/gluster/nagios-integration.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3195/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3195/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3195/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3195/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3195/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3195/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3195/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3195/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3195/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3195/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3195/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3195//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3195/develop/release-management/features/gluster/">
              <span property="name">Gluster</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ad6a629dcee77b9544df139f8407510f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ad6a629dcee77b9544df139f8407510f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Kanagaraj Mayilsamy">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Kanagaraj Mayilsamy</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/acf375efb7552647b1c20465fba8b8cb?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/acf375efb7552647b1c20465fba8b8cb?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Nishanth Thomas">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Nishanth Thomas</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c375d2a16de823ba0f5ca7e4e11ad929?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c375d2a16de823ba0f5ca7e4e11ad929?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ramesh N">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ramesh N</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sahina Bose">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sahina Bose</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3195/documentation/'>Documentation is available here.</a></div>

<h1 id="nagios-integration">Nagios Integration</h1>

<h2 id="summary">Summary</h2>

<p>Currently, administrators of gluster deployments have no easy mechanism to track the health of a Gluster installation - that is, when a brick goes down, split brain occurs, disk is full etc. oVirt provides a poll based mechanism that uses the existing Gluster CLI to identify the volume’s status and node status. This is not sufficient to get data about the issues like split-brain, quota exceeded etc. Also, there’s a 5 min polling interval for brick status and hence the data displayed in oVirt may be considered stale. We need to provide an efficient way for:</p>

<ul>
  <li>Monitoring of critical entities such as hosts, networking, volumes, clusters and services</li>
  <li>Alerting when critical infrastructure components fail and recover, providing administrators with notice of important events. Notification for Alerts can be delivered via email, SNMP. Alerts can be either seen on Nagios UI or on oVirt UI</li>
  <li>Reports providing a historical record of service outages, events and notifications for later review, through Nagios UI interface.</li>
  <li>Trending graphs and reports</li>
</ul>

<p>Since most enterprises already have or are familiar with existing monitoring frameworks like Nagios, we plan to integrate our monitoring solution with these.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature owner: Nishanth Thomas <a href="mailto:nthomas@redhat.com">nthomas@redhat.com</a></li>
</ul>

<h2 id="current-status">Current Status</h2>

<ul>
  <li>Status: Development</li>
  <li>Last updated date: ,</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p><strong>The diagram below provides an overview about the proposed architecture</strong></p>

<p><img src="/ovirt-site/previews/3195/images/wiki/Setup.png" alt="" /> Nagios monitors storage clusters to ensure clusters, hosts, volumes, and software services are functioning properly. In the event of a failure, Nagios can alert technical staff of the problem, allowing them to begin remediation processes before outages affect business processes, end-users, or customers. This is achieved through the checks(Active/Passive) and these checks executed on the monitored resources. Nagios Analyzes the check result and if there is any event that meets the Alert definition, it would be flagged as an Alert on the Nagios server or on oVirt (if it’s deployed) and the appropriate configured notifications (Email, SNMP Traps) will be sent. , In the proposed architecture, we have three main functional blocks- oVirt, Nagios and the Gluster nodes. Nagios server will have the Nagios core installed and a set of infrastructure plugins/addons to execute the checks, process the check result and generate notifications. Gluster nodes will have the infrastructure plugins/addons for check execution and also the plugins which implement the check logic. oVirt will implement (As a UI Plugin) the alert dashboard and the plugins for trending and reporting so that administrator gets a clear view of what is happening in the storage network. External management stations can subscribe for SNMP traps from Nagios so that they get alerted as and when something goes wrong.</p>

<p>At a high-level, each functional block will have the following software components:</p>

<p><strong>Nagios Server</strong></p>

<ul>
  <li>Nagios Core Installed</li>
  <li>NSCA Server</li>
  <li>NRPE Client</li>
  <li>Mk-Livestatus</li>
  <li>PNP4Nagios</li>
  <li>NetSnmp</li>
  <li>Plugins that implements the check logic and also process the check result(like custom event handlers)</li>
</ul>

<p><strong>Gluster Nodes</strong></p>

<ul>
  <li>NRPE Server</li>
  <li>NSCA Client</li>
  <li>Pugins that implements the check logic.</li>
</ul>

<p><strong>oVirt</strong></p>

<ul>
  <li>UI plugins for alert dashboard and trends. The Trends UI plugin is planned for the first phase.</li>
  <li>The <a href="/ovirt-site/previews/3195/develop/release-management/features/ux/uiplugins43.html#ovirt-monitoring-ui-plugin">oVirt Monitoring UI Plugin</a> can also be used to view the Nagios plugin data within oVirt</li>
</ul>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<ul>
  <li>Nagios Core</li>
  <li>Nagios Addons - NRPE , NSCA, MK Livestatus, PNP4Nagios etc</li>
  <li>Nagios plugins</li>
  <li>Ovirt UI Monitoring Plugin</li>
</ul>

<h2 id="packaging">Packaging</h2>

<ul>
  <li>Nagios core will not be packaged and should be installed along with Ovirt</li>
  <li>Nagios addons and plugins will not be packaged and installed. This needs to done separately on the the monitoring nodes and the server</li>
</ul>

<h2 id="user-flows">User Flows</h2>

<h3 id="external-events-from-nagios">External events from Nagios</h3>

<p><strong>Status: Planned</strong></p>

<p>If oVirt is integrated with Nagios for monitoring, any alert/event detected by Nagios needs to be sent to oVirt. This can be done through notification methods.</p>

<p>A new contact will be created which will point to the oVirt REST API entry point and will have the link to the certificate and credentials required to access the API.</p>

<p>The oVirt REST API contact can be associated with the notification method that will post the event details to be added as an external event in oVirt. Whenever a state change occurs that requires notification, this event with all its details is sent to oVirt REST API as an external event. The external event API will create an Audit Log entry for this event and mark the origin as Nagios. The oVirt Dashboard will display these events after applying various filters for cluster and volume events.</p>

<p><img src="/ovirt-site/previews/3195/images/wiki/NagiosToOvirt.png" alt="" /></p>

<h4 id="brick-volume-and-cluster-state">Brick, Volume and Cluster State</h4>

<p>Cluster and volume state is determined by the state of its constituents. Ovirt will get all alerts from Nagios, and use these alerts to show a consolidated status. On an external event, further action will be taken to update the status of Brick, Volume and Cluster.</p>

<p>Brick is a logical entity, which provides basic storage facility for gluster-cluster. A brick can be in one of the following states</p>

<ul>
  <li><strong>UP</strong> – If Brick service is up and brick storage has not crossed the Critical threshold</li>
  <li><strong>DOWN</strong> – If either Brick service is down or brick has consumed all the storage capacity of the brick</li>
</ul>

<p>Volume is treated as a logical entity that serves data, and it’s state needs to reflect this purpose. Volume can have the following states</p>

<ul>
  <li><strong>UP</strong> – Volume is operational and meeting all data serving requirements</li>
  <li><strong>UP-DEGRADED</strong> – Volume is operational but not performing to full optimization. This is applicable to replicated volumes, when a replica brick is down</li>
  <li><strong>UP-PARTIAL</strong> – Volume is operational but some parts of the file system could be inaccessible. This could happen when a sub-volume is down. Applicable for both Replicated and Distributed volumes.</li>
  <li><strong>DOWN</strong> – Volume is crashed or all bricks are down.</li>
  <li><strong>STOPPED</strong> – Volume is shut-down by the Admin intentionally ( Note : For a state change of this nature, no alerts should be generated and no notification needs to be sent. But the event should be generated )</li>
</ul>

<p>The volume states are determined by the participating brick states.</p>

<p>In a cluster, there are services that provide additional functionality like NFS – for NFS access SMB – for SMB access CTDB – for High availability of SMB and NFS SHD – Self Heal daemon Glusterd – Gluster management daemon Quota – Enforcing quota limits on volume Geo-replication – To geo-replicate volume across clusters</p>

<h3 id="nagios-dashboard-and-trends">Nagios Dashboard and Trends</h3>

<p>Dashboard and trends tabs will be added to the oVirt-UI through ui-plugins approach. All the alerts pushed from Nagios to oVirt will be shown in the dashboard. It will also show a summary of the entities currently being manged by oVirt like Hosts, Volumes and Bricks. Alerts will be shown for individual clusters as well. This is planned for a subsequent release.</p>

<p><img src="/ovirt-site/previews/3195/images/wiki/Ovirt-dashboard.png" alt="" /></p>

<p>Trends tab will show the graphs from pnp4nagios. The graphs will be displayed based on the user selection in System Tree. Available from 3.5 If user has selected a particular cluster, the volume utilization graph will be shown for all the volumes in the cluster. In the same way, when a volume is selected in the system tree, brick utilization graph for all the bricks part of that volume will be shown.</p>

<p>The graphs by default will be shown for last 24 hours. The user select a custom time range for displaying the graph data. Graphs shown in the page can be either printed directly or can be saved as a report in PDF format.</p>

<p><img src="/ovirt-site/previews/3195/images/wiki/Ovirt_Monitoring_Trends.png" alt="" /></p>

<h2 id="nagios-specific">Nagios Specific</h2>

<h3 id="auto-configuration-auto-discovery-on-nagios">Auto Configuration/ Auto Discovery on Nagios</h3>

<ul>
  <li>Nagios works with configuration files. It uses configuration files to schedule the jobs to execute the checks(to collect monitoring data), send alerts and notifications</li>
  <li>The configuration files spread over multiple files and directories.</li>
  <li>Nagios configuration needs to be updated when there is any addition/deletion/modification of any logical or physical entities from Ovirt.
    <ul>
      <li>This will be done through a script on Nagios server that will execute the “gluster peer status” and “gluster volume info” commands to discover new entities and update the configuration information</li>
    </ul>
  </li>
</ul>

<h3 id="active-checks-on-remote-nodes">Active Checks on Remote Nodes</h3>

<p><img src="/ovirt-site/previews/3195/images/wiki/Active.png" alt="" /></p>

<ul>
  <li>Active checks are initiated by the Nagios and run on a regularly scheduled basis.</li>
  <li>To execute active checks on gluster nodes, NRPE add-on will be used
    <ul>
      <li>NRPE will execute plug-ins to monitor local resources/attributes like disk usage, CPU load, memory usage, etc. on the gluster nodes</li>
    </ul>
  </li>
  <li>Check results will be send back to the Nagios server and if there is a service state change, alerts/traps will be send based on the configuration.</li>
</ul>

<h3 id="passive-checks-on-remote-nodes">Passive checks on Remote Nodes</h3>

<p><img src="/ovirt-site/previews/3195/images/wiki/Passive.png" alt="" /></p>

<ul>
  <li>Passive checks are initiated and performed external applications/processes and results are submitted to Nagios for processing</li>
  <li>To execute passive checks on gluster nodes, NSCA add-on will be used
    <ul>
      <li>An external application(crontab / application hook / syslog monitor ) checks the status of a host or service.</li>
      <li>The external application passes the results to the NSCA client, which in turn send it to the NSCA server on the monitoring monitoring server.</li>
    </ul>
  </li>
  <li>Nagios server will process the service check result and execute the the specific action if configured.</li>
</ul>

<h3 id="generating-snmp-trapsalerts-from-nagios-server">Generating SNMP Traps/Alerts From Nagios Server</h3>

<p><img src="/ovirt-site/previews/3195/images/wiki/Trap.png" alt="" /></p>

<ul>
  <li>External Program/script/cron jobs or Application hooks monitor the status of specific resources/services.</li>
  <li>The results are passed on to the NSCA client which in turn pass the results to NSCA server on the monitoring server.</li>
  <li>Nagios server will process the result and invokes the event handler script configured for generating the SNMP traps.</li>
  <li>Event handler script generate the SNMP traps with the help of the SNMP trap generator(Netsnmp or anything similar).</li>
  <li>If there is a service state change, Nagios will send alerts(SMS, Email) based on the configuration.</li>
</ul>

<p><em>Alternatively Traps/alerts can be generated based on the result of an active check</em></p>

<h3 id="generating-trapsalerts-based-on-the-syslog-entries">Generating traps/alerts Based on the Syslog Entries</h3>

<p><img src="/ovirt-site/previews/3195/images/wiki/Syslog.png" alt="" /></p>

<ul>
  <li>rsyslog’s omprog filter is used to send passive checks to Nagios server whenever logs of interest appear in syslog.</li>
  <li>omprog allows for the execution of external scripts and this is used to send an NSCA check result</li>
  <li>Currently implemented for quorum and quota logs</li>
</ul>

<h3 id="resourcesentities-monitored-in-the-cluster">Resources/Entities Monitored in the cluster</h3>

<ul>
  <li>List of Physical Resources that need to be monitored :
    <ol>
      <li>Hosts (Servers)</li>
      <li>CPU</li>
      <li>Memory/Swap</li>
      <li>Network</li>
      <li>Disks</li>
    </ol>
  </li>
</ul>

<!-- -->

<ul>
  <li>List of Logical Resources that need to be monitored :
    <ol>
      <li>Cluster(Gluster specific)</li>
      <li>Volume(Gluster specific)</li>
      <li>Brick(Gluster specific)</li>
    </ol>
  </li>
</ul>

<!-- -->

<ul>
  <li>Parameters that should be monitored for logical and physical resources :
    <ol>
      <li>Operational Status</li>
      <li>Utilization</li>
    </ol>
  </li>
</ul>

<!-- -->

<ul>
  <li>Monitoring of Access Services such as:
    <ol>
      <li>SMB</li>
      <li>CTDB</li>
      <li>NFS</li>
    </ol>
  </li>
</ul>

<!-- -->

<ul>
  <li>Monitoring of gluster specific status such as:
    <ol>
      <li>Self-Heal(Gluster specific)</li>
      <li>Geo-Replication(Gluster specific)</li>
      <li>Cluster Quorum</li>
    </ol>
  </li>
</ul>

<!-- -->

<ul>
  <li>TODO: Alerting mechanisms needed for spilt-brain</li>
</ul>

<h2 id="how-to">HOW TO</h2>

<p>This installation has been currently tested on Fedora20 / RHEL6</p>

<p><strong>Pre-requisites</strong>:</p>

<ul>
  <li>Fedora20/ RHEL 6 server to host Nagios server</li>
  <li>Two or more nodes in a gluster trusted pool. (Note: In a pinch for resources, Nagios server can also be installed on one of the nodes)</li>
</ul>

<h3 id="installing-nagios-plugins-on-the-nodes">Installing Nagios plugins on the nodes</h3>

<p>To install the <code class="language-plaintext highlighter-rouge">gluster-nagios-common</code> and <code class="language-plaintext highlighter-rouge">gluster-nagios-addons</code> packages, add the repo at <a href="http://download.gluster.org/pub/gluster/glusterfs-nagios">download.gluster.org repository</a></p>

<p>On Fedora</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>yum <span class="nb">install </span>gluster-nagios-common gluster-nagios-addons
</code></pre></div></div>

<p>On RHEL6</p>

<p>RHEL users must add the EPEL yum repository to obtain the dependency packages</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">    #</span><span class="w"> </span>yum <span class="nb">install </span>http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
<span class="go">
</span><span class="gp">    #</span><span class="w"> </span>yum <span class="nb">install </span>gluster-nagios-common gluster-nagios-addons
</code></pre></div></div>

<p>Make sure that the node can receive nrpe requests from nagios server. You can do this by editing <code class="language-plaintext highlighter-rouge">/etc/nagios/nrpe.cfg</code> and adding the nagios server host ip/name to <code class="language-plaintext highlighter-rouge">allowed_hosts</code></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>service nrpe restart
</code></pre></div></div>

<h3 id="installing-nagios-server-addons-for-monitoring">Installing Nagios server addons for monitoring</h3>

<p>To install the <code class="language-plaintext highlighter-rouge">gluster-nagios-common</code> and <code class="language-plaintext highlighter-rouge">nagios-server-addons</code> packages, add the repo at <a href="http://download.gluster.org/pub/gluster/glusterfs-nagios">download.gluster.org repository</a></p>

<p>On Fedora</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>yum <span class="nb">install </span>gluster-nagios-common nagios-server-addons
</code></pre></div></div>
<p>This will install dependencies like nagios, nrpe, nsca, mk_livestatus if not already installed</p>

<p>On RHEL6</p>

<p>RHEL users must add the EPEL yum repository to obtain the dependency packages</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>yum <span class="nb">install </span>http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
<span class="go">
</span><span class="gp">#</span><span class="w"> </span>yum <span class="nb">install </span>gluster-nagios-common nagios-server-addons
</code></pre></div></div>

<p>Make sure the http/s ports are accessible</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>iptables <span class="nt">-I</span> INPUT 4 <span class="nt">-p</span> tcp <span class="nt">--dport</span> 443 <span class="nt">-m</span> state <span class="nt">--state</span> NEW,ESTABLISHED <span class="nt">-j</span> ACCEPT
<span class="gp">#</span><span class="w"> </span>service iptables save
<span class="gp">#</span><span class="w"> </span>service iptables restart
</code></pre></div></div>

<p>For <code class="language-plaintext highlighter-rouge">mk_livestatus</code> to work, SELinux needs to be in permissive mode.</p>

<p>Note: The below will not survive reboots</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>setenforce 0
</code></pre></div></div>

<p>Run configuration script to detect the nodes/volumes in the gluster trusted pool and to create Nagios services for these</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>/usr/lib64/nagios/plugins/gluster/discovery.py <span class="nt">-c</span> &lt;name <span class="k">for </span>your cluster&gt; <span class="nt">-H</span> &lt;<span class="nb">hostname</span>/ip of any node <span class="k">in </span>your cluster&gt;
</code></pre></div></div>

<p>This will configure monitoring for gluster services on nodes in your cluster and the web UI should be accesible at <server-name-or-ip>/nagios. A sample screenshot from nagios server is below</server-name-or-ip></p>

<p><img src="/ovirt-site/previews/3195/images/wiki/Gluster-Nagios-screenshot.png" alt="" /></p>

<h3 id="instegrating-with-ovirt">Instegrating with oVirt</h3>

<p>Nagios integration is done via 2 options</p>

<p>Option 1. Trends plugin</p>

<p>Checkout the samples-ui-plugins project from gerrit.ovirt.org - <a href="http://gerrit.ovirt.org/gitweb?p=samples-uiplugins.git;a=summary">sample-ui-plugins</a></p>

<p>Create a symlink to gluster-nagios-monitoring/src and gluster-nagios-monitoring/gluster-nagios-monitoring.json under <code class="language-plaintext highlighter-rouge">/usr/share/ovirt-engine/ui-plugins</code></p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span><span class="nb">ln</span> <span class="nt">-s</span> &lt;path to sample-ui-plugins&gt;/gluster-nagios-monitoring/src gluster-nagios-monitoring
<span class="gp">#</span><span class="w"> </span><span class="nb">ln</span> <span class="nt">-s</span> &lt;path to sample-ui-plugins&gt;/gluster-nagios-monitoring/gluster-nagios-monitoring.json gluster-nagios-monitoring.json
</code></pre></div></div>

<p>Edit the <code class="language-plaintext highlighter-rouge">/usr/share/ovirt-engine/ui-plugins/gluster-nagios-monitoring.json</code> as below:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"GlusterNagiosMonitoring"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"plugin/GlusterNagiosMonitoring/start.html"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"resourcePath"</span><span class="p">:</span><span class="w"> </span><span class="s2">"gluster-nagios-monitoring"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"config"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"showDashboard"</span><span class="p">:</span><span class="w"> </span><span class="s2">"true"</span><span class="p">,</span><span class="w">
                    </span><span class="nl">"messageOrigins"</span><span class="p">:[</span><span class="s2">"http://ovirt-engine-hostname:80"</span><span class="p">],</span><span class="w"> </span><span class="err">//path</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">ovirt-engine</span><span class="w"> </span><span class="err">server</span><span class="w">
                    </span><span class="nl">"pnp4nagiosUrl"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://nagios-server"</span><span class="w"> </span><span class="err">//path</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">nagios</span><span class="w"> </span><span class="err">server</span><span class="w">
                  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>You should now see a Trends tab and a Dashboard tab once logged into oVirt like below</p>

<p>Option 2 : Using the Monitoring-UI plugin</p>

<p>Install the <a href="/ovirt-site/previews/3195/develop/release-management/features/ux/uiplugins43.html#ovirt-monitoring-ui-plugin">oVirt Monitoring UI Plugin</a></p>

<p>The Gluster services will be available in a sub-tab under the cluster as well as each host.</p>

<h2 id="detailed-design">Detailed Design</h2>

<p>TO DO</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3195/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3195/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3195/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3195/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2025 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/gluster/nagios-integration.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/gluster/nagios-integration.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
