<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Select Network For Gluster | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="Select Network For Gluster" />
<meta name="author" content="Dan Kenigsberg" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2676/develop/release-management/features/gluster/select-network-for-gluster.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2676/develop/release-management/features/gluster/select-network-for-gluster.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Select Network For Gluster" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Dan Kenigsberg" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Dan Kenigsberg"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2676/images/logo.svg"},"name":"Dan Kenigsberg"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"Select Network For Gluster","url":"https://ovirt.github.io/ovirt-site/previews/2676/develop/release-management/features/gluster/select-network-for-gluster.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2676/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2676/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2676/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2676/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2676/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2676/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2676/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2676/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2676/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2676/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2676/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2676/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2676/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2676/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2676/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2676/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2676/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2676/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2676/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2676/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2676/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2676/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2676/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2676/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2676//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2676/develop/release-management/features/gluster/">
              <span property="name">Gluster</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/ce421080e5d2da87febb626f6e8906c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dan Kenigsberg</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sahina Bose</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"></span><a rel="author" href="https://twitter.com/sandrobonazzola" title="Sandro Bonazzola">Sandro Bonazzola</a></span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2676/documentation/'>Documentation is available here.</a></div>

<h1 id="select-network-for-gluster">Select Network For Gluster</h1>

<h2 id="summary">Summary</h2>

<p>Currently, gluster nodes use the same network for both management traffic and gluster traffic when these nodes are managed by oVirt.
The nodes use the IP address/ host name used when adding the host to oVirt for this.
This causes issues as high glusterfs traffic chokes the management requests and VMs on these hosts sometimes fail to respond.</p>

<p>Gluster does not yet have a mechanism to specify which networks are to be used depending on the type of traffic - internal vs. others.
There’s a planned feature with some details here - <a href="https://web.archive.org/web/20160628142018/http://www.gluster.org/community/documentation/index.php/Features/SplitNetwork">Gluster Split Network</a></p>

<p>With the existing feature set in Gluster, the proposed solution is to separate out the glusterfs traffic at the time of adding bricks to a gluster volume.
Glusterfs uses the IP address specified for the brick for all traffic related to brick on that node.
So, when a host has multiple interfaces, user can choose the interface to be used while adding the brick, by tagging one of the host’s interface with the “Storage network” role.</p>

<p>In case, the user wants to continue to add brick’s using host’s FQDN (for instance, when they have DNS setup outside of oVirt to separate out networks),
no interfaces should be marked with the “Storage network” role.</p>

<p><strong>Limitations</strong></p>

<ul>
  <li>
    <p>In case network addresses of host changes after adding a brick, changing of existing brick’s network address may cause disruption of data services in case of distributed volumes and performance degradation in case of replicate volumes</p>

    <p>“replace-brick commit force” will be used to achieve change in ip address of brick. (Needs to be enhanced in glusterfs to allow changing brick within same host)</p>
  </li>
</ul>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature Owner: Sahina Bose &lt;sabose (at) redhat (dot) com&gt;</li>
  <li>GUI Component Owner: Karnan Chidambarakani &lt;kchidamb (at) redhat (dot) com&gt;</li>
  <li>Engine Component Owner: Sahina Bose &lt;sabose (at) redhat (dot) com&gt;</li>
</ul>

<h2 id="proposed-user-flow">Proposed User Flow</h2>

<h3 id="select-network-in-add-brick">Select network in Add brick</h3>

<ol>
  <li>Add a Network role “Storage network” and create a network with this role at <strong>Cluster</strong> level. This network role should be available only from cluster version 3.6 (possible?)</li>
</ol>

<p><img src="/ovirt-site/previews/2676/images/wiki/ManageGlusterNw.png" alt="" /></p>

<ol>
  <li>Edit a host, and assign the above network role to one of the host’s interface.</li>
</ol>

<p><img src="/ovirt-site/previews/2676/images/wiki/SetupHostGlusterNw.png" alt="" /></p>

<ol>
  <li>In Create Volume/ Add Brick dialog, once the host is selected to add a brick, the IP address from the interface in above step is used to add brick.</li>
</ol>

<ul>
  <li>If the host has no interface with network role “Storage network”, the host’s address is used. This will also cater to the usecase, where users want to continue using the host FQDN to add bricks. (Users may have DNS setup to resolve host name correctly based on internal/external networks)</li>
</ul>

<p>There’s no change to the existing user interface for Add Brick.</p>

<ul>
  <li>Ensure that network with storage network role cannot be removed from cluster if it is used</li>
</ul>

<h3 id="change-network-used-by-brick">Change network used by brick</h3>

<ol>
  <li>Provide an edit brick - where user can pick an IP address. This will call the “replace-brick commit force”. <strong>Disruption in service may occur for distributed volumes as the brick process will be restarted. For replicated volumes, there might be a performance degradation.</strong></li>
</ol>

<p><img src="/ovirt-site/previews/2676/images/wiki/Edit_brick.png" alt="" /></p>

<p>User should be provided an option to change IP address for all bricks on a host.
This would be available under “Bricks” sub-tab of host. This will recursively call the “replace-brick commit force” for each of the bricks selected</p>

<p><img src="/ovirt-site/previews/2676/images/wiki/EditBricks.png" alt="" /></p>

<h2 id="implementation-details">Implementation Details</h2>

<h3 id="change-to-network-roles">Change to Network roles</h3>

<p>Addition of a new Network role - Storage network</p>

<h3 id="change-to-glusterbricks-entity">Change to GlusterBricks entity</h3>

<p><code class="language-plaintext highlighter-rouge">GlusterBricks</code> entity will have an additional property that holds the address used to add the brick.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">brickInterface</code></li>
</ul>

<p>Table gluster_volume_bricks will have an additional column. This will be populated only if brick is using storage network instead of vds.host_address to add the brick.</p>

<table>
  <thead>
    <tr>
      <th>Column name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>interface_id</td>
      <td>UUID</td>
      <td>Nullable. Id of the host’s interface. FK to id of vds_interface table</td>
    </tr>
  </tbody>
</table>

<p><code class="language-plaintext highlighter-rouge">GlusterBrick.getQualifiedName()</code> - changes to use the <code class="language-plaintext highlighter-rouge">brickIPAddress</code> property if not empty otherwise uses <code class="language-plaintext highlighter-rouge">VdsStatic.hostName</code></p>

<h3 id="change-to-glustersyncjob">Change to GlusterSyncJob</h3>

<p>Update the correct IP address returned from gluster CLI output rather than mapping based on host UUID</p>

<h3 id="change-to-vdsm-api">Change to VDSM API</h3>

<p>No change to the <code class="language-plaintext highlighter-rouge">GlusterVolume.addBrick</code> API Existing Parameters: ‘data’: {‘volumeName’: ‘str’, ‘brickList’: [‘str’], ‘*replicaCount’: ‘int’, ‘*stripeCount’: ‘int’, ‘*force’: ‘bool’}</p>

<p>brickList will continue to be array of strings of the form <ip adress="" or="" hostname="">:<brick directory=""></brick></ip></p>

<h3 id="change-to-rest-api">Change to REST API</h3>

<p><strong>POST</strong> <code class="language-plaintext highlighter-rouge">/clusters/{cluster:id}/glustervolumes/{glustervolume:id}/bricks|rel=add</code> - NO CHANGE</p>

<p>GlusterBricks entity has an optional parameter where the network to be used while creating the brick can be passed. If not set, the engine will select the network appropriately</p>

<p>New API:</p>

<p><strong>PUT</strong> <code class="language-plaintext highlighter-rouge">/clusters/{cluster:id}/glustervolumes/{glustervolume:id}/bricks/{brick:id}|rel=update</code></p>

<p>The network to be updated for brick, is passed as a parameter in the GlusterBrickEntity</p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2676/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2676/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2676/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2676/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/gluster/select-network-for-gluster.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/gluster/select-network-for-gluster.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
