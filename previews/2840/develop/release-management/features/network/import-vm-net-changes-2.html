<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Expand vNic profile mapping options for VM import from Storage Domain via REST API | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Expand vNic profile mapping options for VM import from Storage Domain via REST API" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2840/develop/release-management/features/network/import-vm-net-changes-2.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2840/develop/release-management/features/network/import-vm-net-changes-2.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Expand vNic profile mapping options for VM import from Storage Domain via REST API" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Expand vNic profile mapping options for VM import from Storage Domain via REST API","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2840/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2840/develop/release-management/features/network/import-vm-net-changes-2.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2840/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2840/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2840/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2840/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2840/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2840/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2840/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2840/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2840/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2840/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2840/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2840/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2840/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2840/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2840/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2840/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2840/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2840/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2840/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2840/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2840/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2840/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2840//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2840//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2840/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2840/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2840/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2840/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2840/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6703db6314b5ac12132ef66b755faecd?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6703db6314b5ac12132ef66b755faecd?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Eitan Raviv</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2840/documentation/'>Documentation is available here.</a></div>

<h1 id="expand-vnic-profile-mapping-options-for-vm-import-from-storage-domain-via-rest-api">Expand vNic profile mapping options for VM import from Storage Domain via REST API</h1>

<h2 id="summary">Summary</h2>

<p>Up to oVirt Engine 4.2, importing a VM from a storage domain via the REST API 
assumed full knowledge of the target engine profile IDs and employed a fail-fast 
failure policy:</p>

<ul>
  <li>Mapping a vNic profile by profile ID (see import-vm-net-changes) requires the
user to discover the profile IDs on the engine in advance and to keep them 
updated.</li>
  <li>On any error or mismatch in the mapping of the target or the source of any vNic, 
the request is aborted.</li>
</ul>

<p>Requiring a target ID for the import is labor-intensive from the perspective of
the user.
Employing a fail-fast failure policy is desirable when the user would like the 
engine to guard against incomplete or faulty inputs. But when the import is part 
of a Disaster Recovery operation, a permissive behaviour is required in order to 
enable the user to complete the import even if some of the vNics would not be 
fully mapped.</p>

<p>This feature intends to solve the above issues for importing VMs from a 
data-domain storage via the REST API of the engine.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Eitan Raviv</li>
  <li>email: <a href="mailto:eraviv@redhat.com">eraviv@redhat.com</a></li>
</ul>

<h2 id="solution">Solution</h2>

<h3 id="general-behaviour">General behaviour</h3>

<p>Additional functionality has been added to the engine:</p>

<ul>
  <li>Deprecate the old restrictive mode, and add a new permissive mode.</li>
  <li>The permissive mode supports specifying the target profile either using a
profile id or using a pair of profile name and network name. This pair is
unique at the data-center level.</li>
  <li>The permissive mode implements an escalating matching algorithm that tries
 to find the best match for the profile on the engine:
    <ul>
      <li>try to match by target id specified in the user mapping</li>
      <li>else, try to match by target profile name + network name</li>
      <li>else, try to match by source profile name + network name
found on the vNic in the OVF</li>
    </ul>
  </li>
  <li>If none of the above succeeds, the permissive mode applies a ‘no profile’ 
target to the vNic and continues with the request.</li>
  <li>Applying ‘no profile’ means that once the import terminates the vNic will 
be created without any profile or network assigned to it. Any profile\network 
may later be assigned to the vNic via the web-admin GUI or any other means.</li>
  <li>User input for vNic mappings joins all the other inputs of the import under
the ‘registration_configuration’ entry in the request body.</li>
</ul>

<h3 id="profilenetwork-application-rules">Profile\Network application rules</h3>
<ul>
  <li>For a target profile ID to be applied the GUID of the profile needs
to be valid and present on the engine.</li>
  <li>For a profile name + network name pair to be applied the name pair needs to 
match some profile which exists on the engine.</li>
  <li>For any profile to be applied the network it belongs to needs to be attached 
to the cluster into which the import operation is being performed.</li>
  <li>A ‘no profile’ target may be specified by user input in the mappings by using 
empty strings in the target profile name + profile network.</li>
  <li>If no target or empty target entry is specified in the request, the matching 
algorithm will start at the step of trying to match and apply the source OVF
vNic profile.</li>
  <li>If no mapping at all is specified for a vNic, the matching algorithm will 
start at the step of trying to match and apply the source OVF vNic profile.</li>
</ul>

<h4 id="rest-api-request-structure">REST API request structure</h4>

<p>The mapping is comprised of a collection of entries, each of which consists
of the following:</p>

<ul>
  <li>Source network name</li>
  <li>Source network profile name</li>
  <li>Target network profile (with ID or with profile name + profile network)</li>
</ul>

<p>The mappings data would be passed as additional optional data of the 
existing VM import request under the ‘registration_configuration’ entry:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /storagedomains/{storagedomain:id}/vms/{vm:id}/register
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;action&gt;</span>
    <span class="nt">&lt;cluster</span> <span class="na">id=</span><span class="s">"XXX"</span><span class="nt">/&gt;</span>
    ....
    <span class="nt">&lt;registration_configuration&gt;</span>
	    <span class="nt">&lt;vnic_profile_mappings&gt;</span>
	        <span class="nt">&lt;registration_vnic_profile_mapping&gt;</span>
	        	<span class="nt">&lt;from&gt;</span>
	        		<span class="nt">&lt;name&gt;</span>red<span class="nt">&lt;/name&gt;</span>
	        		<span class="nt">&lt;network&gt;</span>
	        			<span class="nt">&lt;name&gt;</span>red<span class="nt">&lt;/name&gt;</span>
					<span class="nt">&lt;/network&gt;</span>
				<span class="nt">&lt;/from&gt;</span>
				<span class="nt">&lt;to&gt;</span>
	        		<span class="nt">&lt;name&gt;</span>blue<span class="nt">&lt;/name&gt;</span>
	        		<span class="nt">&lt;network&gt;</span>
	        			<span class="nt">&lt;name&gt;</span>blue<span class="nt">&lt;/name&gt;</span>
					<span class="nt">&lt;/network&gt;</span>
				<span class="nt">&lt;/to&gt;</span>
	        <span class="nt">&lt;/registration_vnic_profile_mapping&gt;</span>
	        <span class="nt">&lt;registration_vnic_profile_mapping&gt;</span>
	        	<span class="nt">&lt;from&gt;</span>
	        		<span class="nt">&lt;name&gt;</span>orange<span class="nt">&lt;/name&gt;</span>
	        		<span class="nt">&lt;network&gt;</span>
	        			<span class="nt">&lt;name&gt;</span>orange<span class="nt">&lt;/name&gt;</span>
					<span class="nt">&lt;/network&gt;</span>
				<span class="nt">&lt;/from&gt;</span>
				<span class="nt">&lt;to</span> <span class="na">id=</span><span class="s">"738dd914-8ec8-4a8b-8628-34672a5d449b"</span> <span class="nt">/&gt;</span>
	        <span class="nt">&lt;/registration_vnic_profile_mapping&gt;</span>
	        <span class="nt">&lt;registration_vnic_profile_mapping&gt;</span>
	        	<span class="nt">&lt;from&gt;</span>
	        		<span class="nt">&lt;name&gt;</span>yellow<span class="nt">&lt;/name&gt;</span>
	        		<span class="nt">&lt;network&gt;</span>
	        			<span class="nt">&lt;name&gt;</span>yellow<span class="nt">&lt;/name&gt;</span>
					<span class="nt">&lt;/network&gt;</span>
				<span class="nt">&lt;/from&gt;</span>
	        <span class="nt">&lt;/registration_vnic_profile_mapping&gt;</span>
	    <span class="nt">&lt;/vnic_profile_mappings&gt;</span>
    <span class="nt">&lt;/registration_configuration&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div></div>

<h4 id="gui">GUI</h4>
<p>no change from previous behaviour</p>

<h3 id="re-assign-mac-addresses-for-the-vnics-of-an-imported-vm">Re-assign MAC addresses for the vNics of an imported VM</h3>
<p>no change from previous behaviour</p>

<h2 id="related-rfes">Related RFEs</h2>
<ul>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1530814">BZ#1530814</a></li>
</ul>

<h2 id="testing">Testing</h2>

<ul>
  <li>Units tests in the engine and integration tests in OST have been implemented</li>
  <li>Since the behaviour has totally changed, thorough QE testing is recommended.</li>
  <li>Testing for regressions of neighboring flows like import from OVA is recommended.</li>
</ul>

<h2 id="future-plans">Future plans</h2>
<p>N/A</p>

<h2 id="open-issues">Open Issues</h2>
<p>N/A</p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2840/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2840/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2840/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2840/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/import-vm-net-changes-2.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/import-vm-net-changes-2.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
