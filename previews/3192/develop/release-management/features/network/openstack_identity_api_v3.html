<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Support OpenStack Identity API v3 | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Support OpenStack Identity API v3" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/openstack_identity_api_v3.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/openstack_identity_api_v3.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Support OpenStack Identity API v3" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Support OpenStack Identity API v3","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3192/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3192/develop/release-management/features/network/openstack_identity_api_v3.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3192/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3192/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3192/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3192/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3192/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3192/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3192/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3192/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3192/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3192/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3192/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3192//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3192/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dominik Holler">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dominik Holler</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3192/documentation/'>Documentation is available here.</a></div>

<h1 id="support-openstack-identity-api-v3">Support OpenStack Identity API v3</h1>

<h2 id="summary">Summary</h2>

<p>[OpenStack Identity API v2.0][8] is not only deprecated, it is even
removed from the current [OpenStack Identity API specification][1] and replaced
by the OpenStack Identity API v3.</p>

<p>oVirt Engine requires the OpenStack Identity API to access external logical
networks provided by [OpenStack Neutron][2] or [OVN][3], to access images from
[OpenStack Glance][4] and volumes from [OpenStack Cinder][5].</p>

<p>Support for OpenStack Identity API v3 in oVirt Engine will [enable Engine to
access services from OpenStack Neutron][13] which does
[not support Identity API v2.0 anymore][12].
To achieve this only Engine’s OpenStack Network Provider will be updated,
other providers like OpenStack Image, OpenStack Block Storage, and External
Network Provider will continue with Identity API v2.0.</p>

<p>The [oVirt OVN Provider][6] provides the OpenStack Identity API for
[authentication][7], but will continue with OpenStack Identity API v2.0.</p>

<p>Related patches can be found on [gerrit topic:keystone_v3][11].</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>
    <p>Name: <a href="https://github.com/erav">Eitan Raviv</a></p>
  </li>
  <li>
    <p>Email: <a href="mailto:eraviv@redhat.com">eraviv@redhat.com</a></p>
  </li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>This section shows the difference between the versions v2.0 and v3 of OpenStack
Identity API and what this implies for oVirt.</p>

<p>The OpenStack Identity API is used in oVirt to get or provide a token, which is
required to use the other OpenStack APIs, e.g. Networking API.</p>

<h3 id="openstack-identity-api-v20">OpenStack Identity API v2.0</h3>

<p>A typical request to get a token in OpenStack Identity API v2.0 is a HTTP <code class="language-plaintext highlighter-rouge">POST</code>
to <code class="language-plaintext highlighter-rouge">/v2.0/tokens</code> with the content:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "auth": {
    "passwordCredentials": {
      "username": "admin"
      "password": "c314d360aab94a5f"
     },
    "tenantName": "demo",
  }
}
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">tenantName</code> is supported for external providers for oVirt Engine, but
ignored in oVirt Provider OVN. The most relevant part of the response is like
the following:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "access": {
    "token": {
      "id": "aaaaa-bbbbb-ccccc-dddd"
    }
  }
}
</code></pre></div></div>

<h3 id="openstack-identity-api-v3">OpenStack Identity API v3</h3>

<p>Most relevant changes in the data model in version v3 are:</p>
<ul>
  <li>“Tenants” are now known as “projects”</li>
  <li>“Domains”: a high-level container for projects, users and groups</li>
  <li>User, group and project names only have to be unique within their owning domain</li>
  <li>Tokens explicitly represent user+project or user+domain pairs</li>
  <li>The token is returned the X-Subject-Token response header</li>
</ul>

<p>A typical request to get a token in OpenStack Identity API v3 is a HTTP <code class="language-plaintext highlighter-rouge">POST</code>
to <code class="language-plaintext highlighter-rouge">/v3/auth/tokens</code> with the content:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "auth" : {
    "identity" : {
      "methods" : [ "password" ],
      "password" : {
        "user" : {
          "domain" : {
            "name" : "Default"
          },
          "name" : "admin",
          "password" : "c314d360aab94a5f"
        }
      }
    },
    "scope" : {
      "project" : {
        "domain" : {
          "name" : "Default"
        },
        "name" : "admin"
      }
    }
  }
}
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">scope</code> might be not required, e.g. if a default project is configured for
the user. The relevant part of the response looks like this:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 201 Created
X-Subject-Token: gAAAAABbH3sSGLgtxvoHyYDLZd6fSuserBHG2P-3TdykaYnq-eYo7aUBdZK0I
Vary: X-Auth-Token
Content-Type: application/json

{"token": ... }
</code></pre></div></div>

<h3 id="implementation-in-ovirt-engine">Implementation in oVirt Engine</h3>

<p>To support OpenStack Identity API v3 oVirt engine has to be extended to handle
the user domain name, the project name and the domain name of the project.
This requires changes in webadmin, REST-API, the database and the
TokenProvider in the backend.</p>

<p>The version of the OpenStack Identity API is derived from the authentication
URL. If the authentication URL ends with “/v3” or “/v3/”, OpenStack Identity
API v3 will be used, else OpenStack Identity API v2.0 to ensure backward
compatibility.</p>

<p>The default ovirt-provider-ovn has not be modified, because the OpenStack
Identity API v2.0 is not removed.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>oVirt Engine requires an updated version of [OpenStack Java SDK 3.2.x][9] to
accessing OpenStack Identity API v3.</p>

<h2 id="limitations">Limitations</h2>

<p>OpenStack Identity API provides a catalog of multiple endpoints, which
provides the URL to access the OpenStack service. This feature does change
the current implementation in oVirt Engine, which requires the user to specify
this URL manually.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Support for OpenStack Identity API v3 in oVirt Engine is required to enable 
access to services from [OpenStack instances which does not support Identity
API v2.0, especially the OpenStack releases since Qeens.][12]</p>

<h2 id="user-experience">User Experience</h2>

<h3 id="webadmin">Webadmin</h3>

<p>The “Add Provider” popup has to provide inputs for the new properties user
domain name, the project name and the domain name of the project.
To avoid inconsistency between the authentication URL and the API version, the
authentication URL is built from the protocol, host name, API port and version.</p>

<p><img src="/ovirt-site/previews/3192/images/features/network/openstack_idendity_api-add-dialog-provider.png" alt="add a new provider" /></p>

<p>Please note, that the OpenStack user requires permissions to create ports on the
network.</p>

<h3 id="engine-setup">Engine-Setup</h3>

<p>The ovirt-provider-ovn external provider which is configured by engine-setup is
not modified and continues to use OpenStack Identity API v2.0, because of the
Engine and the OVN provider has to support OpenStack Identity API v2.0 for the
sake of backward compatibility anyway and switching to OpenStack Identity API
v3 would be no improvement but introduce the risk of new implementation bugs.</p>

<h2 id="rest-api">REST-API</h2>
<p>The REST-API is extended to handle the user domain name, the project name and
the domain name of the project like the following:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;openstack_network_provider</span> <span class="na">href=</span><span class="s">"/ovirt-engine/api/openstacknetworkproviders/123"</span> <span class="na">id=</span><span class="s">"123"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;actions&gt;</span>
    <span class="nt">&lt;link</span> 
      <span class="na">href=</span><span class="s">"/ovirt-engine/api/openstacknetworkproviders/123/testconnectivity"</span>
      <span class="na">rel=</span><span class="s">"testconnectivity"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;link</span>
      <span class="na">href=</span><span class="s">"/ovirt-engine/api/openstacknetworkproviders/123/importcertificates"</span>
      <span class="na">rel=</span><span class="s">"importcertificates"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/actions&gt;</span>
  <span class="nt">&lt;name&gt;</span>OpenStack Neutron<span class="nt">&lt;/name&gt;</span>
  <span class="nt">&lt;description&gt;</span>network provider for OpenStack<span class="nt">&lt;/description&gt;</span>
  <span class="nt">&lt;link</span>
    <span class="na">href=</span><span class="s">"/ovirt-engine/api/openstacknetworkproviders/123/networks"</span>
    <span class="na">rel=</span><span class="s">"networks"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;link</span>
    <span class="na">href=</span><span class="s">"/ovirt-engine/api/openstacknetworkproviders/123/certificates"</span>
    <span class="na">rel=</span><span class="s">"certificates"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;url&gt;</span>http://192.168.122.104:9696<span class="nt">&lt;/url&gt;</span>
  <span class="nt">&lt;auto_sync&gt;</span>true<span class="nt">&lt;/auto_sync&gt;</span>
  <span class="nt">&lt;read_only&gt;</span>false<span class="nt">&lt;/read_only&gt;</span>
  <span class="nt">&lt;type&gt;</span>external<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;unmanaged&gt;</span>false<span class="nt">&lt;/unmanaged&gt;</span>
  <span class="nt">&lt;requires_authentication&gt;</span>true<span class="nt">&lt;/requires_authentication&gt;</span>
  <span class="nt">&lt;authentication_url&gt;</span>http://192.168.122.104:5000/v3<span class="nt">&lt;/authentication_url&gt;</span>
  <span class="nt">&lt;username&gt;</span>admin@internal<span class="nt">&lt;/username&gt;</span>
  <span class="nt">&lt;project_name&gt;</span>admin<span class="nt">&lt;/project_name&gt;</span><span class="c">&lt;!-- Added --&gt;</span>
  <span class="nt">&lt;user_domain_name&gt;</span>Default<span class="nt">&lt;/user_domain_name&gt;</span><span class="c">&lt;!-- Added --&gt;</span>
  <span class="nt">&lt;project_domain_name&gt;</span>Default<span class="nt">&lt;/project_domain_name&gt;</span><span class="c">&lt;!-- Added --&gt;</span>
<span class="nt">&lt;/openstack_network_provider&gt;</span>
</code></pre></div></div>

<h2 id="installationupgrade">Installation/Upgrade</h2>

<p>No effect on new installations of oVirt Engine.
On upgrade, it has to be ensured that the authentication URL has the expected
format to be splitted like proposed in <a href="#webadmin">Webadmin</a>.</p>

<h2 id="follow-up-features">Follow-Up Features</h2>

<h3 id="implementation-in-ovirt-provider-ovn">Implementation in oVirt Provider OVN</h3>
<p>To support OpenStack Identity API v3 the oVirt Provider OVN to be extended to
handle requests to <code class="language-plaintext highlighter-rouge">/v3/auth/tokens</code>. The <code class="language-plaintext highlighter-rouge">scope</code> can be ignored, like the
<code class="language-plaintext highlighter-rouge">tenantName</code>.
In oVirt Provider OVN’s OpenStack Identity API v2.0 implementation the
user name has to match the following format:
<code class="language-plaintext highlighter-rouge">&lt;admin_username&gt;[@&lt;fqdn&gt;]@&lt;ovirt_profile&gt;</code>, while the optional <code class="language-plaintext highlighter-rouge">&lt;fqdn&gt;</code> is
the Active Directory or LDAP domain. For the reason of consistency, this format
is kept in the OpenStack Identity API v3 implementation and the <code class="language-plaintext highlighter-rouge">user.domain</code>
is ignored.</p>

<h2 id="documentation--external-references">Documentation &amp; External references</h2>

<p><a href="https://developer.openstack.org/api-ref/identity/">OpenStack Identity API Specification</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/network/osn-integration.html">oVirt OpenStack Neutron Integration</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/network/external-network-provider.html">oVirt OVN Integration</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/storage/glance-integration.html">oVirt Glance Integration</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/storage/cinder-integration.html">oVirt Cinder Integration</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/network/ovirt-ovn-provider.html">oVirt Provider OVN</a></p>

<p><a href="/ovirt-site/previews/3192/develop/release-management/features/network/ovirt-ovn-provider.html#authentication-and-authorization-at-the-provider">Authentication and Authorization at the oVirt Provider OVN</a></p>

<p><a href="https://web.archive.org/web/20170127173135/http://developer.openstack.org/api-ref/identity/v2/">OpenStack Identity API v2.0</a></p>

<p><a href="https://github.com/woorea/openstack-java-sdk">OpenStack Java SDK</a></p>

<p><a href="https://trello.com/c/3LN6xSIT/257-engine-support-keystone-v3">Trello</a></p>

<p><a href="https://gerrit.ovirt.org/#/q/topic:keystone_v3">Related patches</a></p>

<p><a href="https://blueprints.launchpad.net/keystone/+spec/removed-as-of-queens">Blueprint for tracking things being removed in the Queens release</a></p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1598391">RFE - Certify OVN from OSP 13 via Neutron API with external OSP provider.</a></p>

<h2 id="testing">Testing</h2>

<h3 id="ovirt-engine">oVirt Engine</h3>

<p>It has to be ensured, that all already available OpenStack related tests of
oVirt Engine are still succeeding, to ensure that already available OpenStack
Identity API v2.0 has no regressions. This might be the case because a new
minor version of [OpenStack Java SDK][9] is used.</p>

<p>To test the OpenStack Identity API v3, all already available tests of OpenStack
network provider can be duplicated to use OpenStack Qeens (keystone 13).</p>

<h2 id="release-notes">Release Notes</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  == Support OpenStack Identity API v3 ==
  oVirt Engine is able to access external Networks provided by OpenStack
  Qeens Neutron
</code></pre></div></div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3192/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3192/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3192/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3192/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/openstack_identity_api_v3.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/openstack_identity_api_v3.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
