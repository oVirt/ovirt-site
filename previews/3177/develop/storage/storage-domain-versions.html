<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Storage Domain Versions | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Storage Domain Versions" />
<meta name="author" content="Federico Simoncelli" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3177/develop/storage/storage-domain-versions.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3177/develop/storage/storage-domain-versions.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Storage Domain Versions" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Federico Simoncelli" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Federico Simoncelli"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Storage Domain Versions","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3177/images/logo.svg"},"name":"Federico Simoncelli"},"url":"https://ovirt.github.io/ovirt-site/previews/3177/develop/storage/storage-domain-versions.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3177/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3177/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3177/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3177/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3177/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3177/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3177/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3177/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3177/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3177/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3177/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3177/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3177/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3177/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3177/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3177/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3177/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3177/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3177/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3177/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3177/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3177/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3177//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3177//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3177/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3177/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3177/develop/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/2cd558daf047b198cf2152940ec6a812?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/2cd558daf047b198cf2152940ec6a812?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Federico Simoncelli">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Federico Simoncelli</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/fdf1234a96717595a057d4edb7258da2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Saggi Mizrahi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Saggi Mizrahi</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Much of this developer documentation provides historical context but may not reflect the current state of the project.<br>If you see outdated content please navigate to the page footer and click "<strong>Report an issue on GitHub</strong>".<br><br>It is <strong>not</strong> user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3177/documentation/'>User Documentation is available here.</a></div>

<!-- TODO: Content review -->

<h1 id="storage-domain-version-0">Storage Domain Version 0</h1>

<h1 id="storage-domain-version-2">Storage Domain Version 2</h1>

<h1 id="storage-domain-version-3">Storage Domain Version 3</h1>

<p>The storage domain version 3 has been introduced in VDSM on the 30th of January 2012 with the commit <code class="language-plaintext highlighter-rouge">8665716c</code>: Use <a href="http://gerrit.ovirt.org/726">SANLock for the SPM resource</a>.
The new format has been introduced to overcome some of the limitations present in the previous formats (with regard to live snapshots, live merges and internationalization)
and mainly to introduce the use of <a href="https://fedorahosted.org/sanlock">SANLock</a>.</p>

<ul>
  <li><strong>Supported Domain Types:</strong> Block (iSCSI, FCP) and File (NFS, local) domains</li>
  <li><strong>Supported Domain Classes:</strong> Data, Export</li>
</ul>

<h2 id="changes">Changes</h2>

<h3 id="vdsm-and-format">VDSM and Format</h3>

<ul>
  <li>Uses <a href="http://gerrit.ovirt.org/726">SANLock to acquire the SPM resource</a></li>
  <li>Uses <a href="http://gerrit.ovirt.org/1253">SANLock to acquire the volume resources (virtualization subsystem, libvirt)</a></li>
  <li>In block domains the permissions of the LVs in the metadata are always RW (to allow live snapshots and live merges)</li>
  <li><a href="http://gerrit.ovirt.org/637">Unicode</a> support in the name and description of:
    <ul>
      <li>Storage Pools</li>
      <li>Storage Domains</li>
      <li>Disks and NICs</li>
      <li>Virtual Machines</li>
    </ul>
  </li>
  <li>New mailbox format (in progress)</li>
</ul>

<h3 id="engine-and-gui">Engine and GUI</h3>

<ul>
  <li>Display the Storage Domain Version (already present in the “Storage” tab)</li>
  <li>Support the creation of Storage Domain V3</li>
  <li>Accept unicode strings for the descriptions (only V3)</li>
  <li>Block the import of VM containing unicode to V2 domains</li>
  <li>Prevent moving Storage Domain Version V3 to 3.0 Data Centers</li>
</ul>

<h2 id="required-actions-on-upgrade">Required Actions On Upgrade</h2>

<h3 id="vdsm">VDSM</h3>

<ul>
  <li>Initialize the resources for all the volumes in the domain</li>
  <li>Set all the LVs to RW</li>
  <li>Check that the volume SIZE in the metadata is consistent with the block size (RAW) or with the qcow2 virtual size (COW) <a href="https://bugzilla.redhat.com/show_bug.cgi?id=811880">BZ811880</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=611183">BZ611183</a>, <a href="https://bugzilla.redhat.com/show_bug.cgi?id=706014">BZ706014</a></li>
</ul>

<h3 id="engine-and-gui-1">Engine and GUI</h3>

<h2 id="rest-api">REST API</h2>

<p>The operation is driven by pool compatibility change. So there is no need for a new REST API.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>All nodes in the cluster must have 5a0b2c9 “Do not lock the image when preparing the VM path” (vdsm &gt;= 4.9.4) to avoid the LVM mda corruption</li>
</ul>

<h2 id="export-domains">Export Domains</h2>

<p>Export domains cannot be upgraded; they must be created in the version 3 format (and previous versions of VDSM won’t be able to attach it to a V1/V2 pool).</p>

<h2 id="upgrade">Upgrade</h2>

<p>At the moment it is planned to support an automatic upgrade to version 3 from the previous versions.</p>

<p><img src="/ovirt-site/previews/3177/images/wiki/DomainUpgrade1.png" alt="" /></p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3177/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3177/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3177/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3177/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/storage/storage-domain-versions.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/storage/storage-domain-versions.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
