<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Network QoS - detailed design | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Network QoS - detailed design" />
<meta name="author" content="Laszlo Hornyak" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2886/develop/release-management/features/network/network-qos-detailed-design.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2886/develop/release-management/features/network/network-qos-detailed-design.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Network QoS - detailed design" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Laszlo Hornyak" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Laszlo Hornyak"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Network QoS - detailed design","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2886/images/logo.svg"},"name":"Laszlo Hornyak"},"url":"https://ovirt.github.io/ovirt-site/previews/2886/develop/release-management/features/network/network-qos-detailed-design.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2886/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2886/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2886/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2886/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2886/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2886/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2886/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2886/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2886/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2886/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2886/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2886/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2886/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2886/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2886/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2886/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2886/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2886/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2886/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2886/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2886/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2886/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2886//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2886//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2886/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2886/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2886/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2886/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2886/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f9883612f789d69b89b9449fb740ca53?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Laszlo Hornyak</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/819d7e00c07db9447fa5705dadfe8c02?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/819d7e00c07db9447fa5705dadfe8c02?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ofri Masad</span></p>
                      
                    </section>
                  </span>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2886/documentation/'>Documentation is available here.</a></div>

<h1 id="network-qos---detailed-design">Network QoS - detailed design</h1>

<h4 id="summary">Summary</h4>

<p>Network Quality of Service feature will be added to oVirt from version 3.3 and will support cluster version 3.3 or higher.
The feature will allow the user to limit the inbound and outbound network traffic in virtual NIC level.
In order to define more natural coupling of the QoS to a VNIC we define a new concept called <strong>VNIC Profile</strong>. The VNIC profile will be applied in oVirt 3.3 to all clusters and will wrap few of the properties currently defined directly on the VNIC.
 see <a href="/ovirt-site/previews/2886/develop/sla/network-qos.html">/Features/Network_QoS</a> for detailed description of the feature</p>

<h4 id="owner">Owner</h4>

<ul>
  <li>Name: Ofri Masad (omasad)</li>
</ul>

<h4 id="current-status">Current status</h4>

<ul>
  <li>Status: design</li>
  <li>patchset</li>
</ul>

<h2 id="design-and-implementation">Design and Implementation</h2>

<p>The Network QoS feature includes two main parts:</p>

<ul>
  <li>VNIC level QoS</li>
  <li>VNIC Profiles</li>
</ul>

<p>The two parts will be developed in parallel</p>

<h3 id="qos">QoS</h3>

<h4 id="gui">GUI</h4>

<p>see : <a href="/ovirt-site/previews/2886/develop/sla/network-qos.html">QoS Feature overview</a></p>

<h4 id="backend">Backend</h4>

<p>We define a new entity called “NetworkQoS” - the QoS properties will be contained in this object.
A NetworkQoS object will be added as a property of the VnicProfile entity.</p>

<h5 id="classes">Classes</h5>

<p><strong><em>engine.core.common.businessentities.network.NetworkQoS**’ - new entity with fields: inboundAverage(Integer), inboundPeak(Integer), inboundBurst(Integer), outboundAverage(Integer), outboundPeak(Integer), outboundBurst(Integer)
**</em>engine.core.dao.network.NetworkQoSDao</strong>’’ - new Dao
<strong><em>engine.core.dao.network.VmVnicProfileDao</em></strong> - add support to the NetworkQoS field</p>

<h4 id="db-change">DB Change</h4>

<p>Add network_qos table with 7 columns.</p>

<table>
  <thead>
    <tr>
      <th>Column Name</th>
      <th>Column Type</th>
      <th>Null? / Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
      <td>UUID</td>
      <td> </td>
    </tr>
    <tr>
      <td>inbound_average</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
    <tr>
      <td>inbound_peak</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
    <tr>
      <td>inbound_burst</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
    <tr>
      <td>outbound_average</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
    <tr>
      <td>outbound_peak</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
    <tr>
      <td>outbound_burst</td>
      <td>Integer</td>
      <td>Null</td>
    </tr>
  </tbody>
</table>

<h4 id="rest-api">REST API</h4>

<p>Not supported in this version</p>

<h4 id="vdsm">VDSM</h4>

<p>libvirt version 1.0.1 or higher is required to enable the QoS feature (vdsm 3.3 will use higher version).</p>

<ul>
  <li>Add support of QoS properties in VDSM API: run VM, hot plug and update VM device verbs (update in schema)</li>
  <li>Add support in the vnic object and the vnic to_xml()</li>
</ul>

<h3 id="vnic-profiles">VNIC Profiles</h3>

<h4 id="gui-vnic-profiles">GUI (VNIC Profiles)</h4>

<p>see : <a href="/ovirt-site/previews/2886/develop/sla/network-qos.html">QoS Feature overview</a></p>

<h4 id="backend-1">Backend</h4>

<h5 id="classes-1">Classes</h5>

<p><strong><em>engine.core.common.businessentities.network.VnicProfile</em></strong> - new class holding the VNIC profile properties <strong><em>engine.core.common.businessentities.network.NetworkInterface**’’ - add fields: vnicProfile(VnicProfile)
**</em>engine.core.common.businessentities.network.Network</strong>’’ - add fields: nnicProfile(VnicProfile)
<strong><em>engine.core.vdsbroker.vdsbroker.VmInfoBuilder**’’ - add support to the QoS properties
**</em>engine.core.utils.ovf.OvfWriter</strong>’ - add support to the QoS properties
<strong><em>engine.core.utils.ovf.OvfReader**’ - add support to the QoS properties
**</em>engine.core.dao.network.VmVnicProfileDao</strong>’’ - new Dao
<strong><em>engine.core.dao.network.VmNetworkInterfaceDao**’’ - add support to the VnicProfile field
**</em>engine.core.dao.network.VmNetworkDao</strong>’’ - add support to the VnicProfile field</p>

<h4 id="db-change-1">DB Change</h4>

<p>Add vnic_profiles table with 7 columns.</p>

<table>
  <thead>
    <tr>
      <th>Column Name</th>
      <th>Column Type</th>
      <th>Null? / Default</th>
      <th>comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>id</td>
      <td>UUID</td>
      <td>key</td>
      <td> </td>
    </tr>
    <tr>
      <td>name</td>
      <td>String</td>
      <td>Not Null</td>
      <td> </td>
    </tr>
    <tr>
      <td>network_id</td>
      <td>UUID</td>
      <td>Not Null</td>
      <td> </td>
    </tr>
    <tr>
      <td>qos_id</td>
      <td>UUID</td>
      <td>Null</td>
      <td> </td>
    </tr>
    <tr>
      <td>port_mirroring</td>
      <td>Boolean</td>
      <td>Null</td>
      <td>moved from network_interface</td>
    </tr>
    <tr>
      <td>custom_properties</td>
      <td>String</td>
      <td>Null</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>Add network_profile_id(UUID</td>
      <td>null) to the <strong>vm_interface</strong> table - Represents the properties of the virtual NIC.</td>
    </tr>
  </tbody>
</table>

<h4 id="rest-api-1">REST API</h4>

<p>Not supported in this version</p>

<h3 id="tests">Tests</h3>

<h4 id="expected-unit-tests">Expected unit-tests</h4>

<h3 id="special-considerations">Special considerations</h3>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>Affected ovirt projects:</p>

<ul>
  <li>API</li>
  <li>backend</li>
  <li>Webadmin</li>
  <li>User Portal</li>
</ul>

<p>Others:</p>

<ul>
  <li>vdsm</li>
</ul>

<h3 id="documentation--external-references">Documentation / External references</h3>

<ul>
  <li>See: <a href="http://libvirt.org/formatdomain.html#elementQoS">http://libvirt.org/formatdomain.html#elementQoS</a> for documentation of the VM level network QoS XML.</li>
  <li>See: <a href="http://libvirt.org/formatnetwork.html#elementsConnect">http://libvirt.org/formatnetwork.html#elementsConnect</a> for documentation of the Host level network QoS XML.</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2886/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2886/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2886/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2886/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/network-qos-detailed-design.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/network-qos-detailed-design.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
