<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>noVNC console | oVirt</title>
<meta name="generator" content="Jekyll v3.9.1" />
<meta property="og:title" content="noVNC console" />
<meta name="author" content="Andrew Dahms" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2753/develop/release-management/features/virt/novnc-console.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2753/develop/release-management/features/virt/novnc-console.html" />
<meta property="og:site_name" content="oVirt" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="noVNC console" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Dahms" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Andrew Dahms"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2753/images/logo.svg"},"name":"Andrew Dahms"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","@type":"WebPage","headline":"noVNC console","url":"https://ovirt.github.io/ovirt-site/previews/2753/develop/release-management/features/virt/novnc-console.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2753/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2753/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2753/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2753/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2753/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2753/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2753/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2753/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2753/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2753/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2753/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <!-- Begin Jekyll Favicon tag v0.2.9 -->
<!-- Classic -->
<link rel="shortcut icon" href="/ovirt-site/previews/2753/favicon.ico">
<link rel="icon" sizes="48x48 32x32 16x16" href="/ovirt-site/previews/2753/favicon.ico">
  <link rel="icon" sizes="16x16" type="image/png" href="/ovirt-site/previews/2753/images/favicon-16x16.png">
  <link rel="icon" sizes="32x32" type="image/png" href="/ovirt-site/previews/2753/images/favicon-32x32.png">
  <link rel="icon" sizes="64x64" type="image/png" href="/ovirt-site/previews/2753/images/favicon-64x64.png">
  <link rel="icon" sizes="144x144" type="image/png" href="/ovirt-site/previews/2753/images/favicon-144x144.png">
<!-- Safari -->
  <link rel="apple-touch-icon" sizes="57x57" href="/ovirt-site/previews/2753/images/favicon-57x57.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/ovirt-site/previews/2753/images/favicon-76x76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/ovirt-site/previews/2753/images/favicon-120x120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/ovirt-site/previews/2753/images/favicon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/ovirt-site/previews/2753/images/favicon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/ovirt-site/previews/2753/images/favicon-180x180.png">
<!-- Chrome -->
  <link rel="icon" sizes="192x192" href="/ovirt-site/previews/2753/images/favicon-192x192.png">
  <link rel="icon" sizes="96x96" href="/ovirt-site/previews/2753/images/favicon-96x96.png">
  <link rel="icon" sizes="48x48" href="/ovirt-site/previews/2753/images/favicon-48x48.png">
<link rel="manifest" href="/ovirt-site/previews/2753/manifest.webmanifest">
<!-- IE -->
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ovirt-site/previews/2753/images/favicon-144x144.png">
<meta name='msapplication-config' content="/ovirt-site/previews/2753/browserconfig.xml">
<!-- End Jekyll Favicon tag -->
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2753/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2753/images/logo.svg">      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2753/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2753/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2753/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2753/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2753//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2753//blogs.ovirt.org/'>Blog</a></li>              </ul>          </div>          <!-- /.navbar-collapse -->      </div>      <!-- /.container-fluid -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2753/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2753/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2753/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2753/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2753/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <header class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d17fe401696c1bc6269a18d0a9c3132c?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Dahms</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/73dbd7b0a4e813ae529563511ec671b4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/73dbd7b0a4e813ae529563511ec671b4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Alon Bar-Lev</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/1e11318f54f0b916c19723ea0154bce9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/1e11318f54f0b916c19723ea0154bce9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Frantisek Kobzik</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8208edfa41f5f2c8b818bf034e96a4ce?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8208edfa41f5f2c8b818bf034e96a4ce?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Gianluca Cecchi</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/cbccb13b9d42aebbf895417aabf7e7da?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/cbccb13b9d42aebbf895417aabf7e7da?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Nicholas Kesick</span></p>
                      
                    </section>
                  </span>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/aa67dddf03cc269feeaf822b83e8c1d6?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/aa67dddf03cc269feeaf822b83e8c1d6?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy">
                  </div>
                  <span class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Simone Tiraboschi</span></p>
                      
                    </section>
                  </span>
                
              </header>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2753/documentation/'>Documentation is available here.</a></div>

<h1 id="novnc-console">noVNC console</h1>

<h2 id="summary">Summary</h2>

<p>The aim of this feature is to make it possible to connect to VM consoles using HTML 5 VNC client called “noVNC” in browsers supporting websockets and HTML5 postMessage function (webkit browsers, Firefox, IE &gt; 10).</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Frank Kobzik (Fkobzik)</li>
  <li>Email: <a href="mailto:fkobzik@redhat.com">fkobzik@redhat.com</a></li>
</ul>

<h2 id="status">Status</h2>

<ul>
  <li>Engine part of implementation (loading noVNC client and making it connect to websocket proxy using postMessage) - DONE</li>
  <li>Websockets proxy customization - DONE</li>
  <li>Security over TLS - DONE</li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<ul>
  <li>Enhanced options for connecting to virtual machine consoles in oVirt</li>
  <li>There is no need for users to have a native VNC client installed when using noVNC</li>
</ul>

<h2 id="details">Details</h2>

<p>The noVNC client utilizes websockets for passing VNC data. However, VNC server in qemu doesn’t support websockets natively and there must be a websocket proxy placed between the client and VNC server. This proxy can run either on any node that has access to the host network, or it can run on each host.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  (Note: There is a patch that integrates websockets directly to qemu, but it  will not be merged into DS at the time we need it to be there. As soon as it's  merged, we should switch to using this  feature instead of standalone websockets server).
</code></pre></div></div>

<p>The noVNC client is a html5 page with javascript which talks to websocket server (e.g. python-websockify). This page is served by engine itself.</p>

<p>Upon establishing the VNC session, the noVNC client (HTML + js) must know where to connect. For passing such information, the HTML5 window.postMessage function can be used. As soon as the client receives the information, it connects to websockets proxy which runs on a particular host:port. Now the VNC information (vnc host:port, ticket) must be passed to the proxy to know where to connect. This information is passed via url path.</p>

<p>The websockets proxy reads data from the path and establishes connection to the VNC server.</p>

<h2 id="novnc-client-and-python-websockify-customization">noVNC client and python-websockify customization</h2>

<p>There are two changes that must be made to noVNC client and websockify.</p>

<h3 id="novnc-client-changes">noVNC client changes</h3>

<p>For our purposes, the noVNC client html page must listen to VNC information passed from the engine using HTML5 postMessage. This requires adding event listener “message” to the page. The handler receives information required for establishing VNC connection via websockets and passes it to websockets proxy. This information is:</p>

<ul>
  <li>vnc host:port</li>
  <li>vnc password (ticket)</li>
</ul>

<p>Additional information that client has to know is:</p>

<ul>
  <li>websocket proxy host:port (passed via parameters in url)</li>
</ul>

<p>The implementation modifies vnc_auto.html page that comes from noVNC client.</p>

<h3 id="websockify-changes">websockify changes</h3>

<p>The implementation is based on nova-novnc proxy which reads a token from a cookie, makes an rpc call to the nova consoleauth node and retrieves all connection information (which is connected to this token).</p>

<p>In VDSM we have no such thing as nova token. We must pass all the connection info somehow. In the initial implementation it was passed via a cookie. However the new implementation passes it using url path.</p>

<p>After the proxy receives the data, it establishes the vnc connection.</p>

<h2 id="location-of-the-websockets-server">Location of the websockets server</h2>

<p>There are three possible places where the websocket server can run. The implementation supports each of these scenarios; the behavior in the engine is set in vdc_options:</p>

<ol>
  <li>On the machine on which the engine is installed (Option WebSocketProxyConfig: Engine:port)</li>
  <li>On a single machine on which the engine is not installed (Option WebSocketProxyConfig: ip/hostname:port, where ip/hostname specify the host where the proxy runs)</li>
  <li>(On each host (Option WebSocketProxyConfig: Host:port)).</li>
</ol>

<h2 id="security-considerations">Security considerations</h2>

<p>The websocket server runs on a specific port and allows clients to connect to any port on its machine. This is a potential security risk in that the attacker could bypass the firewall on server. For further information, see <a href="https://github.com/kanaka/noVNC/issues/49">https://github.com/kanaka/noVNC/issues/49</a>. OpenStack implements a customized version of the proxy (openstack-nova-novncproxy package) and verifies security-related information before a connection to the target host is actually created. With oVirt, this is not easily possible because we do not store the VNC ticket in the engine (afaik the only place in the system with knowledge of the ticket is the target host) so verification is impossible.</p>

<p>To address this issue, the websocket proxy uses digital signatures to verify VNC data. This data is signed by the engine.</p>

<h2 id="secure-communication">Secure communication</h2>

<p>Secure communication is ensured by using TLS. For this reason, websockets server must posses a key and certificate that is used for TLS communication. Moreover, the certificate must be trusted by users in their web browsers (or the client browser must trust the engine’s CA)!</p>

<p>The creation of key/cert pair could be part of engine setup process (together with JBoss, Apache and engine key/cert pairs).</p>

<h2 id="setup">Setup</h2>

<h3 id="setup-websocket-proxy-on-the-engine-during-install">Setup Websocket Proxy on the Engine During Install</h3>

<p>Prerequisities: Browser that has proper websockets and postmessage support (tested with FF and Chrome)</p>

<ul>
  <li>In the engine-setup answer ‘Yes’ to ‘Configure websocket proxy on the machine’”</li>
  <li>Import CA of the engine in your browser. You can download the certificate authority by navigating <code class="language-plaintext highlighter-rouge">https://&lt;your engine address&gt;/ca.crt</code>.</li>
  <li>Set up a VM as usual, set its Display Type to VNC and run it.</li>
  <li>In Console Options dialog, select ‘noVNC’</li>
  <li>Click the console button to invoke the console.
    <ul>
      <li>(The console opens in a new tab and this behavior is usualy blocked by browsers. For opening the console you must allow displaying pop-up windows from engine’s domain.)</li>
    </ul>
  </li>
</ul>

<p>Results: The new browser tab with noVNC session appears.</p>

<h3 id="setup-websocket-proxy-on-the-engine-post-install">Setup Websocket Proxy on the Engine Post Install</h3>

<p>Execute:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  # engine-setup --otopi-environment="OVESETUP_CONFIG/websocketProxyConfig=bool:True"
</code></pre></div></div>

<h3 id="setup-websocket-proxy-on-a-separate-machine">Setup Websocket Proxy on a Separate Machine</h3>

<p>With release 3.5 oVirt supports also the deploy of WebSocket Proxy on a separate host via engine-setup; please follow this instruction: <a href="/ovirt-site/previews/2753/develop/release-management/features/integration/websocketproxy-on-a-separate-host.html">Features/WebSocketProxy on a separate host</a></p>

<h2 id="using-novnc">Using noVNC</h2>

<ul>
  <li>Select or create a VM. While editing it, under console set its Display Type to VNC. Save and start the VM. <img src="/ovirt-site/previews/2753/images/wiki/EditVM_VNC.png" alt="" /></li>
  <li>Right click the VM and choose Console Options.</li>
  <li>Select ‘noVNC’, and click OK to save. <img src="/ovirt-site/previews/2753/images/wiki/ConsoleOptions_noVNC.png" alt="" /></li>
  <li>Click the console button to invoke the console.
    <ul>
      <li>(The console opens in a new tab and this behavior is usualy blocked by browsers. For opening the console you must allow displaying pop-up windows from engine’s domain and you must have Certificate Authority correctly imported in your browser.).</li>
    </ul>
  </li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2753/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2753/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2753/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2753/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/novnc-console.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/virt/novnc-console.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
