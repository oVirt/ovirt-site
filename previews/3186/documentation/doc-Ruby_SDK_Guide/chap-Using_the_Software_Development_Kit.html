<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Using the Software Development Kit | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Using the Software Development Kit" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3186/documentation/doc-Ruby_SDK_Guide/chap-Using_the_Software_Development_Kit.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3186/documentation/doc-Ruby_SDK_Guide/chap-Using_the_Software_Development_Kit.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Using the Software Development Kit" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Using the Software Development Kit","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3186/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3186/documentation/doc-Ruby_SDK_Guide/chap-Using_the_Software_Development_Kit.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3186/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3186/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3186/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3186/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3186/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3186/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3186/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3186/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/download/'>Download</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3186/documentation/'>Documentation</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/documentation/">
              <span property="name">Documentation</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/documentation/doc-Ruby_SDK_Guide/">
              <span property="name">Ruby SDK Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
        
        <section id="content" class="content container">
          
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter defines the modules and classes of the Ruby Software Development Kit and describes their usage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Classes">Classes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">OvirtSDK4</a> module contains the following software development kit classes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Connection</dt>
<dd>
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection">Connection</a> class is the mechanism for connecting to the server and obtaining the reference to the root of the services tree. See <a href="#Connecting_to_the_server">Connecting to the server</a> for details.</p>
</dd>
<dt class="hdlist1">Types</dt>
<dd>
<p>The Type classes implement the types supported by the API. For example, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class is the implementation of the virtual machine type. The classes are data containers and do not contain any logic. You will be working with instances of types.</p>
<div class="paragraph">
<p>Instances of these classes are used as parameters and return values of service methods. The conversion to or from the underlying representation is handled transparently by the software development kit.</p>
</div>
</dd>
<dt class="hdlist1">Services</dt>
<dd>
<p>The Service classes implement the services supported by the API. For example, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/VmsService">VmsService</a> class is the implementation of the service that manages the collection of virtual machines in the system.</p>
<div class="paragraph">
<p>Instances of these classes are automatically created by the SDK when a service is referenced. For example, a new instance of the <code>VmsService</code> class is created automatically by the SDK when you call the <code>vms_service</code> method of the <code>SystemService</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vms_service = connection.system_service.vms_service</code></pre>
</div>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not create instances of these classes manually. The constructor parameters and methods may change in the future.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Error</dt>
<dd>
<p>The <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> class is the base exception class that the software development kit raises when it reports an error.</p>
<div class="paragraph">
<p>Certain specific error classes extend the base error class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AuthError - Authentication or authorization failure</p>
</li>
<li>
<p>ConnectionError - Server name cannot be resolved or server is unreachable</p>
</li>
<li>
<p>NotFoundError - Requested object does not exist</p>
</li>
<li>
<p>TimeoutError - Operation time-out</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Other Classes</dt>
<dd>
<p>Other classes (for example, HTTP client classes, readers, and writers) are used for HTTP communication and for XML parsing and rendering. Using these classes is not recommended, because they comprise internal implementation details that may change in the future. Their backwards-compatibility cannot be relied upon.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Using_Types">Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="creating-and-modifying-instances-of-types">Creating and Modifying Instances of Types</h3>
<div class="paragraph">
<p>Creating or modifying an instance of a type does not have any effect on the server side, unless the changes are explicitly sent to the server calling a service method, as described below. Changes on the server side are not automatically reflected in instances that already exist in memory.</p>
</div>
<div class="paragraph">
<p>The constructors of these classes have multiple optional arguments, one for each attribute of the type. This simplifies the creation of objects, by using nested calls to multiple constructors.</p>
</div>
<div class="paragraph">
<p>In the following example, an instance of a virtual machine is created and its attributes (cluster, template, and memory) are set:</p>
</div>
<div id="Creating_a_Virtual_Machine_Instance_with_Attributes" class="listingblock">
<div class="title">Creating a Virtual Machine Instance with Attributes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">cluster</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Cluster</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
  ),
  <span style="color:#606">template</span>: <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Template</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
  ),
  <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The hashes (for example, <code>cluster: OvirtSDK4::Cluster.new</code>) passed to these constructors are processed recursively.</p>
</div>
<div class="paragraph">
<p>In the following example, plain hashes are used instead of explicitly calling the constructors for the Cluster and Template classes. The SDK internally converts the hashes to the required classes.</p>
</div>
<div class="listingblock">
<div class="title">Creating a Virtual Machine Instance with Attributes Expressed as Plain Hashes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">cluster</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
  },
  <span style="color:#606">template</span>: {
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
  },
  <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using constructors in this way is recommended, but not mandatory.</p>
</div>
<div class="paragraph">
<p>In the following example, a virtual machine instance is created with no arguments in the call to the constructor. You can add the virtual machine instance&#8217;s attributes one by one, using setters, or by using a combination of setters and constructors.</p>
</div>
<div class="listingblock">
<div class="title">Creating a Virtual Machine Instance and Adding Attributes Individually</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new
vm.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>
vm.cluster = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Cluster</span>.new(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>)
vm.template = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Template</span>.new(<span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>)
vm.memory = <span style="color:#00D">1073741824</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes that are defined as lists of objects in the API specification are implemented as Ruby arrays. For example, the <code>custom_properties</code> attributes of the <code>Vm</code> type are defined as a list of objects of type <code>CustomProperty</code>.</p>
</div>
<div class="listingblock">
<div class="title">Adding a List of Attributes as an Array</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
  <span style="color:#606">custom_properties</span>: [
    <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">CustomProperty</span>.new(...),
    <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">CustomProperty</span>.new(...),
    ...
  ]
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attributes that are defined as enumerated values in the API are implemented as constants in a module with the same name as the enumerated type.</p>
</div>
<div class="paragraph">
<p>The following example shows how the status attribute of the <code>Vm</code> type is defined using the <code>VmStatus</code> enumerated value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby"><span style="color:#080;font-weight:bold">case</span> vm.status
<span style="color:#080;font-weight:bold">when</span> <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">DOWN</span>
  ...
<span style="color:#080;font-weight:bold">when</span> <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">IMAGE_LOCKED</span>
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the API specification, the values of <code>enum</code> types are lower case, because that is the convention for XML and JSON. In Ruby, however, the convention is to use <strong>upper case</strong> for these constants.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="retrieving-instance-attributes">Retrieving Instance Attributes</h3>
<div class="paragraph">
<p>You can retrieve instance attributes using the corresponding attribute readers.</p>
</div>
<div class="paragraph">
<p>The following example retrieves the name and memory of the virtual machine instance:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Instance Attributes</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vm.name: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>vm.name<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">vm.memory: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>vm.memory<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
vm.custom_properties.each <span style="color:#080;font-weight:bold">do</span> |custom_property|
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Retrieving Instance Attributes as Links</strong></p>
</div>
<div class="paragraph">
<p>Some instance attributes are returned as links and require the <code>follow_link</code> method to retrieve the data. In the following example, the response to a request for a virtual machine&#8217;s attributes is formatted as XML with a link:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Attributes as a Link</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">&lt;vm id=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">123</span><span style="color:#710">&quot;</span></span> href=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/ovirt-engine/api/vms/123</span><span style="color:#710">&quot;</span></span>&gt;
  &lt;name&gt;myvm&lt;<span style="background-color:hsla(300,100%,50%,0.06)"><span style="color:#404">/</span><span style="color:#808">name&gt;
  &lt;link rel=&quot;diskattachments&quot; href=&quot;</span><span style="color:#404">/</span><span style="color:#C2C">o</span></span>virt-engine/api/vms/<span style="color:#00D">123</span>/diskattachments/<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&gt;
  ...
&lt;/vm&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The link, <code>vm.disk_attachments</code>, does not contain the actual disk attachments. To retrieve the data, the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection">Connection</a> class provides a <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection#follow_link-instance_method">follow_link</a> method that uses the value of the <code>href</code> XML attribute to retrieve the actual data.</p>
</div>
<div class="paragraph">
<p>In the following example, <code>follow_link</code> enables you to go to the disk attachments, and then to each disk, to retrieve the <code>alias</code>:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Service</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm = vm_service.get</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using <code>follow_link</code> to Retrieve Disk Attachment and Disk Alias</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">attachments = connection.follow_link(vm.disk_attachments)
attachments.each <span style="color:#080;font-weight:bold">do</span> |attachment|
  disk = connection.follow_link(attachment.disk)
  puts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">disk.alias: </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>disk.alias<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Services">Services</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="Retrieving_services">Retrieving Services</h3>
<div class="paragraph">
<p>The API provides a set of services, each associated with a server path. For example, the service that manages the collection of virtual machines in the system is located in <code>/vms</code>, and the service that manages the virtual machine with identifier <code>123</code> is located in <code>/vms/123</code>.</p>
</div>
<div class="paragraph">
<p>In the Ruby software development kit, the root of that tree of services is implemented by the <code>system service</code>. It is retrieved by calling the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Connection#system_service-instance_method">system_service</a> method of the connection:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving System Service</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">system_service = connection.system_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have the reference to the <code>system service</code>, you can use it to retrieve references to other services, using the <code>*_service</code> methods (called <code>service locators</code>).</p>
</div>
<div class="paragraph">
<p>For example, to retrieve a reference to the service that manages the collection of virtual machines in the system, you can use the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/SystemService#vms_service-instance_method">vms_service</a> service locator:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Other Services</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vms_service = system_service.vms_service</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve a reference to the service that manages the virtual machine with identifier <code>123</code>, use the service locator of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/SystemService#vms_service-instance_method">vm_service</a> service. The service locator uses the virtual machine identifier as a parameter:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving Virtual Machine Service Using Identifier</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="Ruby">vm_service = vms_service.vms_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The objects returned by the service locator calls are pure services, and do not contain data. For example, the <code>vm_service</code> Ruby object retrieved in the previous example is not the representation of a virtual machine. It is the service that is used to retrieve, update, delete, start, and stop a virtual machine.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="Service_methods">Service Methods</h3>
<div class="paragraph">
<p>After you have located the service you want, you can call its service methods. These methods send requests to the server and do the real work.</p>
</div>
<div class="paragraph">
<p>Services that manage collections of objects usually have the <code>list</code> and <code>add</code> methods.</p>
</div>
<div class="paragraph">
<p>Services that manage a single object usually have the <code>get</code>, <code>update</code>, and <code>remove</code> methods.</p>
</div>
<div class="paragraph">
<p>Services may have additional action methods, which perform actions other than retrieving, creating, updating, or removing. These methods are most commonly found in services that manage a single object.</p>
</div>
<div class="sect3">
<h4 id="get"><code>Get</code></h4>
<div class="paragraph">
<p>The <code>get</code> method retrieves the representation of a single object.</p>
</div>
<div class="paragraph">
<p>The following example locates and retrieves the representation of the virtual machine with identifier <code>123</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages the virtual machine:</span>
vms_service = system_service.vms_service
vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)

<span style="color:#777"># Retrieve the representation of the virtual machine:</span>
vm = vm_service.get</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result will be an instance of the corresponding type. In this case, the result is an instance of the Ruby class <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a>.</p>
</div>
<div class="paragraph">
<p>The <code>get</code> method of some services supports additional parameters that control how to retrieve the representation of the object, or which representation to retrieve, if there is more than one.</p>
</div>
<div class="paragraph">
<p>For example, you may want to retrieve a virtual machine&#8217;s future state, after boot-up. The <code>get</code> method of the service that manages a virtual machine supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/get/parameters/next_run">next_run</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Retrieving a Virtual Machine&#8217;s <code>next_run</code> State</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the representation of the virtual machine; not the</span>
<span style="color:#777"># current one, but the one that will be used after the next</span>
<span style="color:#777"># boot:</span>
vm = vm_service.get(<span style="color:#606">next_run</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference</a> documentation of the software development kit for details.</p>
</div>
<div class="paragraph">
<p>If the object cannot be retrieved, the software development kit will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception, containing details of the failure. This will occur if you try to retrieve a non-existent object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The call to the <code>service locator</code> method never fails, even if the object does not exist, because the <code>service locator</code> method does not send a request to the server.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following examples, the <code>service locator</code> method will succeed, while the <code>get</code> method will raise an exception:</p>
</div>
<div class="listingblock">
<div class="title">Locating the Service of Non-existent Virtual Machine: No Error</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages a virtual machine that does</span>
<span style="color:#777"># not exist. This will succeed.</span>
vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">non_existent_VM</span><span style="color:#710">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Retrieving a Non-existent Virtual Machine Service: Error</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the virtual machine. This will raise an exception.</span>
vm = vm_service.get</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="list"><code>List</code></h4>
<div class="paragraph">
<p>The <code>list</code> method retrieves the representations of multiple objects in a collection.</p>
</div>
<div class="listingblock">
<div class="title">Listing a Collection of Virtual Machines</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the service that manages the collection of virtual</span>
<span style="color:#777"># machines:</span>
vms_service = system_service.vms_service
vms = vms_service.list</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is a Ruby array containing the instances of the corresponding types. In the above example, the response is a list of instances of the Ruby class <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a>.</p>
</div>
<div class="paragraph">
<p>The <code>list</code> method of some services supports additional parameters.</p>
</div>
<div class="paragraph">
<p>For example, almost all of the top-level collections support a <code>search</code> parameter to filter the results, and a <code>max</code> parameter to limit the number of results returned by the server.</p>
</div>
<div class="listingblock">
<div class="title">Listing Ten Virtual Machines Called "my*"</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vms = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=my*</span><span style="color:#710">'</span></span>, <span style="color:#606">max</span>: <span style="color:#00D">10</span>)</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all the list methods support the <code>search</code> or <code>max</code> parameters. Some list methods may support other parameters. See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference</a> documentation for details.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the list of results is empty, the returned value will be an empty Ruby array. It will never be <code>nil</code>.</p>
</div>
<div class="paragraph">
<p>If the list of results cannot be retrieved, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure.</p>
</div>
</div>
<div class="sect3">
<h4 id="add"><code>Add</code></h4>
<div class="paragraph">
<p><code>Add</code> methods add new elements to collections. They receive an instance of the relevant type describing the object to add, send the request to add it, and return an instance of the type describing the added object.</p>
</div>
<div class="listingblock">
<div class="title">Adding a New Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myvm</span><span style="color:#710">'</span></span>,
    <span style="color:#606">cluster</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mycluster</span><span style="color:#710">'</span></span>
    },
    <span style="color:#606">template</span>: {
      <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">mytemplate</span><span style="color:#710">'</span></span>
    }
  )
)</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ruby object returned by the <code>add</code> method is an instance of the relevant type. It is not a service, just a container of data. In the above example, the returned object is an instance of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you need to perform an action on the virtual machine you just added, you must locate the service that manages it and call the service locator:</p>
</div>
<div class="listingblock">
<div class="title">Starting a New Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  ...
)

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Start the virtual machine:</span>
vm_service.start</code></pre>
</div>
</div>
<div class="paragraph">
<p>The creation of most objects is an asynchronous task. For example, if you create a new virtual machine, the <code>add</code> method will return the virtual machine before the virtual machine is completely created and ready to be used. You should poll the status of the object until it is completely created. For a virtual machine that means checking until the status is <code>DOWN</code>.</p>
</div>
<div class="paragraph">
<p>The recommended approach is to create a virtual machine, locate the service that manages the new virtual machine, and retrieve the status repeatedly until the virtual machine status is <code>DOWN</code>, indicating that all the disks have been created.</p>
</div>
<div id="Adding_Virtual_Machine_Locating_Its_Service_and_Retrieving_Status" class="listingblock">
<div class="title">Adding a Virtual Machine, Locating Its Service, and Retrieving Its Status</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Add the virtual machine:</span>
vm = vms_service.add(
  ...
)

<span style="color:#777"># Find the service that manages the virtual machine:</span>
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Wait until the virtual machine is DOWN, indicating that all the</span>
<span style="color:#777"># disks have been created:</span>
loop <span style="color:#080;font-weight:bold">do</span>
  sleep(<span style="color:#00D">5</span>)
  vm = vm_service.get
  <span style="color:#080;font-weight:bold">break</span> <span style="color:#080;font-weight:bold">if</span> vm.status == <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">VmStatus</span>::<span style="color:#036;font-weight:bold">DOWN</span>
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the object cannot be created, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure. It will never return <code>nil</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="update"><code>Update</code></h4>
<div class="paragraph">
<p><code>Update</code> methods update existing objects. They receive an instance of the relevant type describing the update to perform, send the request to update it, and return an instance of the type describing the updated object.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ruby object returned by this update method is an instance of the relevant type. It is not a service, just a container of data. In this particular example the returned object will be an instance of the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Vm">Vm</a> class.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the following example, the <code>service locator</code> method locates the service managing the virtual machine and the <code>update</code> method updates its name:</p>
</div>
<div class="listingblock">
<div class="title">Updating a Virtual Machine Name</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Find the virtual machine and the service that</span>
<span style="color:#777"># manages it:</span>
vm = vms_service.list(<span style="color:#606">search</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">name=myvm</span><span style="color:#710">'</span></span>).first
vm_service = vms_service.vm_service(vm.id)

<span style="color:#777"># Update the name:</span>
updated_vm = vms_service.update(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">newvm</span><span style="color:#710">'</span></span>
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you update an object, update only the attributes you want to update:</p>
</div>
<div class="listingblock">
<div class="title">Updating a Selected Attribute of a Virtual Machine (Recommended)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm = vm_service.get
vm.name = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">newvm</span><span style="color:#710">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Do not update the entire object:</p>
</div>
<div class="listingblock">
<div class="title">Updating All Attributes of a Virtual Machine (Not Recommended)</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby"><span style="color:#777"># Retrieve the current representation:</span>
vms_service.update(vm)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updating all attributes of the virtual machine is a waste of resources and can introduce unexpected bugs on the server side.</p>
</div>
<div class="paragraph">
<p><code>Update</code> methods of some services support additional parameters that can be used to control how or what to update. For example, you may want to update the memory of a virtual machine, not in its current state, but the next time it is started. The <code>update</code> method of the service that manages a virtual machine supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/update/parameters/next_run">next_run</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Updating the Memory of a Virtual Machine at Next Run</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm = vm_service.update(
  <span style="color:#036;font-weight:bold">OvirtSDK4</span>::<span style="color:#036;font-weight:bold">Vm</span>.new(
    <span style="color:#606">memory</span>: <span style="color:#00D">1073741824</span>
  ),
  <span style="color:#606">next_run</span>: <span style="color:#069">true</span>
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the update cannot be performed, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure. It will never return <code>nil</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="remove"><code>Remove</code></h4>
<div class="paragraph">
<p><code>Remove</code> methods remove existing objects. They normally do not support parameters because they are methods of services that manage single objects, and the service already knows what object to remove.</p>
</div>
<div class="listingblock">
<div class="title">Removing a Virtual Machine with Identifier <code>123</code></div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service = vms_service.vm_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)
vms_service.remove</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some <code>remove</code> methods support parameters that control how or what to remove. For example, it is possible to remove a virtual machine while preserving its disks, using the <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/remove">detach_only</a> Boolean parameter:</p>
</div>
<div class="listingblock">
<div class="title">Removing a Virtual Machine while Preserving Disks</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.remove(<span style="color:#606">detach_only</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>remove</code> method returns <code>nil</code> if the object is removed successfully. It does not return the removed object.</p>
</div>
<div class="paragraph">
<p>If the object cannot be removed, the SDK will raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> exception containing the details of the failure.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional-actions">Additional Actions</h4>
<div class="paragraph">
<p>There are additional action methods, apart from the methods described above. The service that manages a virtual machine has methods to start and stop it.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Virtual Machine</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.start</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some action methods include parameters that modify the operation. For example, the <code>start</code> method supports a <a href="http://ovirt.github.io/ovirt-engine-api-model/master/#services/vm/methods/start/parameters/use_cloud_init">use_cloud_init</a> parameter.</p>
</div>
<div class="listingblock">
<div class="title">Starting a Virtual Machine with Cloud-Init</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">vm_service.start(<span style="color:#606">use_cloud_init</span>: <span style="color:#069">true</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Most action methods return <code>nil</code> when they succeed, and raise an <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4/Error">Error</a> when they fail. Some action methods, however, return values. For example, the service that manages storage domains has an <strong>is_attached</strong> action method that checks whether the storage domain is already attached to a data center. The <strong>is_attached</strong> action method returns a Boolean value:</p>
</div>
<div class="listingblock">
<div class="title">Checking for Attached Storage Domain</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="Ruby">sds_service = system_service.storage_domains_service
sd_service = sds_service.storage_domain_service(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">123</span><span style="color:#710">'</span></span>)
<span style="color:#080;font-weight:bold">if</span> sd_service.is_attached
  ...
<span style="color:#080;font-weight:bold">end</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the <a href="http://www.rubydoc.info/gems/ovirt-engine-sdk/OvirtSDK4">reference documentation</a> of the software development kit to see the action methods supported by each service, their parameters, and return values.</p>
</div>
</div>
</div>
</div>
</div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3186/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3186/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3186/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3186/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=documentation&amp;title=Issue:%20/documentation/doc-Ruby_SDK_Guide/chap-Using_the_Software_Development_Kit.html&amp;template=issue_template_documentation.md' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/documentation/doc-Ruby_SDK_Guide/chap-Using_the_Software_Development_Kit.adoc' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
