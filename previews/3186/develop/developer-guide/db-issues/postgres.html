<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Postgres | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Postgres" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3186/develop/developer-guide/db-issues/postgres.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3186/develop/developer-guide/db-issues/postgres.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Postgres" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Postgres","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3186/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3186/develop/developer-guide/db-issues/postgres.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3186/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3186/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3186/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3186/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3186/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3186/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3186/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3186/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3186/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3186/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3186/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3186//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3186/develop/developer-guide/db-issues/">
              <span property="name">Db Issues</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d75560fd509444e4cbc70734dffa0673?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d75560fd509444e4cbc70734dffa0673?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Eli Mesika">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Eli Mesika</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="postgres">Postgres</h1>

<p>This page is obsolete.</p>

<h2 id="installation">Installation</h2>

<p>We are using version 9.1.x</p>

<h2 id="authentication">Authentication</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Trust
Password
GSSAPI
SSPI
Kerberos
Ident
Peer
LDAP
RADIUS
Certificate
PAM
</code></pre></div></div>

<p>details:</p>

<p><a href="http://www.postgresql.org/docs/9.1/static/auth-methods.html">Authentication Methods</a></p>

<h2 id="creating-a-new-user">Creating a new user</h2>

<p><a href="http://www.postgresql.org/docs/9.1/static/sql-createrole.html">Create Role</a></p>

<p><a href="http://www.postgresql.org/docs/9.0/static/sql-createuser.html">Create User</a></p>

<p><a href="http://www.postgresql.org/docs/9.0/static/libpq-pgpass.html">The password file</a></p>

<h2 id="configuration">Configuration</h2>

<p>Default postgres configuration files are under <code class="language-plaintext highlighter-rouge">/var/lib/pgsql/data</code></p>

<h3 id="postgresqlconf">postgresql.conf</h3>

<p><a href="http://www.postgresql.org/docs/current/static/view-pg-settings.html">defaults</a></p>

<p><a href="http://www.postgresql.org/docs/current/static/sql-reset.html">reset</a></p>

<h3 id="reload-configuration">Reload configuration</h3>

<p>If you are making modifications to the Postgres configuration file postgresql.conf (or similar), and you want to new settings to take effect without needing to restart the entire database, there are two ways to accomplish this.</p>

<p>option 1</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> su - postgres /usr/bin/pg_ctl reload option 2
 <span class="nb">echo</span> <span class="s2">"SELECT pg_reload_conf();"</span> | psql <span class="nt">-U</span> &lt;user&gt; &lt;database&gt;
</code></pre></div></div>

<h3 id="connection">Connection</h3>

<p><a href="http://www.postgresql.org/docs/current/static/runtime-config-connection.html">Connection parameters</a></p>

<h3 id="remote-access-listen_addresses">Remote access (listen_addresses)</h3>

<p><a href="http://www.postgresql.org/docs/current/static/auth-pg-hba-conf.html"><code class="language-plaintext highlighter-rouge">pg_hba.conf</code></a></p>

<h3 id="max_connections">max_connections</h3>

<p>The maximum number of client connections allowed.
This is very important to some of the below parameters (particularly work_mem) because there are some memory resources that are or can be allocated on a per-client basis,
so the maximum number of clients suggests the maximum possible memory use.
Generally, PostgreSQL on good hardware can support a few hundred connections.
If you want to have thousands instead, you should consider using connection pooling software to reduce the connection overhead.</p>

<h3 id="shared_buffers">shared_buffers</h3>

<p>The shared_buffers configuration parameter determines how much memory is dedicated to PostgreSQL use for caching data.
One reason the defaults are low because on some platforms (like older Solaris versions and SGI) having large values requires invasive action like recompiling the kernel.
Even on a modern Linux system, the stock kernel will likely not allow setting shared_buffers to over 32MB without adjusting kernel settings first.</p>

<p>If you have a system with 1GB or more of RAM, a reasonable starting value for shared_buffers is 1/4 of the memory in your system.
If you have less ram you’ll have to account more carefully for how much RAM the OS is taking up, closer to 15% is more typical there.
There are some workloads where even larger settings for shared_buffers are effective, but given the way PostgreSQL also relies on the operating system cache it’s unlikely
you’ll find using more than 40% of RAM to work better than a smaller amount.</p>

<h3 id="work_mem">work_mem</h3>

<p>Specifies the amount of memory to be used by internal sort operations and hash tables before writing to temporary disk files.
The value defaults to one megabyte (1MB). Note that for a complex query, several sort or hash operations might be running in parallel;
each operation will be allowed to use as much memory as this value specifies before it starts to write data into temporary files.
Also, several running sessions could be doing such operations concurrently.
Therefore, the total memory used could be many times the value of work_mem; it is necessary to keep this fact in mind when choosing the value.
Sort operations are used for ORDER BY, DISTINCT, and merge joins. Hash tables are used in hash joins, hash-based aggregation, and hash-based processing of IN subqueries.</p>

<h3 id="maintenance_work_mem">maintenance_work_mem</h3>

<p>Specifies the maximum amount of memory to be used by maintenance operations, such as <code class="language-plaintext highlighter-rouge">VACUUM</code>, <code class="language-plaintext highlighter-rouge">CREATE INDEX</code>, and <code class="language-plaintext highlighter-rouge">ALTER TABLE ADD FOREIGN KEY</code>.
It defaults to 16 megabytes (16MB). Since only one of these operations can be executed at a time by a database session, and an installation normally doesn’t have many of them running concurrently,
it’s safe to set this value significantly larger than <code class="language-plaintext highlighter-rouge">work_mem</code>.
Larger settings might improve performance for vacuuming and for restoring database dumps.</p>

<h3 id="synchronous_commit">synchronous_commit</h3>

<p>Asynchronous commit is an option that allows transactions to complete more quickly, at the cost that the most recent transactions may be lost if the database should crash.
In many applications this is an acceptable trade-off.</p>

<p>Asynchronous commit introduces the risk of data loss.
There is a short time window between the report of transaction completion to the client and the time that the transaction is truly committed (that is,
it is guaranteed not to be lost if the server crashes).</p>

<p>The risk that is taken by using asynchronous commit is of data loss, not data corruption.
If the database should crash, it will recover by replaying WAL up to the last record that was flushed.
The database will therefore be restored to a self-consistent state, but any transactions that were not yet flushed to disk will not be reflected in that state.
The net effect is therefore loss of the last few transactions.</p>

<p>The user can select the commit mode of each transaction, so that it is possible to have both synchronous and asynchronous commit transactions running concurrently.
This allows flexible trade-offs between performance and certainty of transaction durability.</p>

<h3 id="guidlines-for-dedicatedshared-server">Guidlines for Dedicated/Shared server</h3>

<p>For the following , a good understanding of the database clock lifecycle is needed.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      page request --&gt; changes --&gt; dirty --&gt; commit to WAL --&gt; Statistics (pg_stat_user_tables etc.) (*) --&gt; Write to disk &amp; clean dirty flag (*)
      (*) - async
</code></pre></div></div>

<p>Dedicated</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        logging can be more verbose
        shared_buffers - 25% of RAM
        work_mem should be `&lt;OS cache size&gt;` / (max_connections * 2)
        maintenance_work_mem - 50MB per each 1GB of RAM
        checkpoint_segments - at least 10 [1]
        checkpoint_timeout
        wal_buffers - 16MB  [2]
</code></pre></div></div>

<p>[1] <a href="http://www.postgresql.org/docs/9.1/static/pgbuffercache.html"><code class="language-plaintext highlighter-rouge">pg_buffercache</code></a> -  <a href="http://www.postgresql.org/docs/9.1/static/pgbuffercache.html">http://www.postgresql.org/docs/9.1/static/pgbuffercache.html</a></p>

<p>[2] <a href="https://www.postgresql.org/docs/9.1/wal-configuration.html">WAL Configuration</a> - <a href="https://www.postgresql.org/docs/9.1/wal-configuration.html">https://www.postgresql.org/docs/9.1/wal-configuration.html</a></p>

<p>Shared</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        reduce logging
        shared_buffers - 10% of RAM
        be very stingy about increasing work_mem
        all other recomendations from the Dedicated section may apply
</code></pre></div></div>

<h3 id="pgtune">pgtune</h3>

<p>pgtune takes the default postgresql.conf and expands the database server to be as powerful as the hardware it’s being deployed on.</p>

<p><a href="http://web.archive.org/web/20150416110332/http://sourcefreedom.com/tuning-postgresql-9-0-with-pgtune/">How to tune your database</a></p>

<h2 id="vacuum">VACUUM</h2>

<p>Cleans up after old transactions, including removing information that is no longer visible and reuse free space.
 ANALYSE looks at tables in the database and collects statistics about them like number of distinct values etc.
Many aspects of query planning depends on this statistics data being accurate.
 From 8.1 , there is a autovaccum daemon that runs in the background and do this work automatically.</p>

<h2 id="logging">Logging</h2>

<p>General logging is important especially if you have unexpected behaviour and you want to find the reason for that
The default logging level is only Errors but this can be easily changed.</p>

<h3 id="log_line_prefix">log_line_prefix</h3>

<p>Controls the line prefix of each log message.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       %t timestamp
       %u user
       %r remote host connection
       %d database connection
       %p pid of connection
</code></pre></div></div>

<h3 id="log_statement">log_statement</h3>

<p>Controls which statements are logged</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       none
       ddl
       mod
       all
</code></pre></div></div>
<h3 id="log_min_duration_statement">log_min_duration_statement</h3>

<p>Controls how long should a query being executed to be logged
Very usefull to find most expensive queries</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3186/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3186/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3186/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3186/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/db-issues/postgres.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/developer-guide/db-issues/postgres.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
