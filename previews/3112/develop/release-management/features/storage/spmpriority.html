<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SPM Priority | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="SPM Priority" />
<meta name="author" content="Daniel Erez" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3112/develop/release-management/features/storage/spmpriority.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3112/develop/release-management/features/storage/spmpriority.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SPM Priority" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Daniel Erez" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Daniel Erez"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"SPM Priority","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3112/images/logo.svg"},"name":"Daniel Erez"},"url":"https://ovirt.github.io/ovirt-site/previews/3112/develop/release-management/features/storage/spmpriority.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3112/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3112/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3112/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3112/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3112/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3112/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3112/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3112/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3112/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3112/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3112/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3112/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3112/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3112/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3112/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3112/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3112/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3112/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3112/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3112/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3112/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3112/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3112//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3112//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3112/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3112/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3112/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3112/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3112/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/93875e42e9b962947becb4e425504fab?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Daniel Erez">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Daniel Erez</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/5a3da0b81e7e9b1e1c78621348bdfe11?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/5a3da0b81e7e9b1e1c78621348bdfe11?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Muli Salem">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Muli Salem</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/92517631861d6438bbc8b312cf9ef0a7?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Oved Ourfali">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Oved Ourfali</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3112/documentation/'>Documentation is available here.</a></div>

<h1 id="spm-priority">SPM Priority</h1>

<h2 id="summary">Summary</h2>

<p>The SPM Priority feature allows the admin to define priorities between hosts regarding the SPM selection process. A host can be given priority <code class="language-plaintext highlighter-rouge">-1</code> which means this host can not be selected to be the SPM.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Feature owner: Muli Salem</li>
  <li>QA Owner: Leonid Natapov (<a href="mailto:lnapatov@redhat.com">lnapatov@redhat.com</a>)</li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Status: Released in oVirt 3.1</li>
</ul>

<h2 id="description">Description</h2>

<p>Currently, the SPM selection process is random, meaning a host is chosen randomly out of the hosts that are currently UP. The SPM Priority feature will allow admins to define the hosts that they prefer to be chosen as SPM.</p>

<h2 id="prd">PRD</h2>

<p>The requirements are the following:</p>

<ol>
  <li>Enable setting a priority between <code class="language-plaintext highlighter-rouge">-1</code> and <code class="language-plaintext highlighter-rouge">10</code> for a host (<code class="language-plaintext highlighter-rouge">10</code> is the highest, <code class="language-plaintext highlighter-rouge">-1</code> means never to choose this host).</li>
  <li>When SPM selection process takes place, use the SPM priority to select an SPM.</li>
  <li>Default for upgrading ovirt will be 5.</li>
</ol>

<h2 id="design">Design</h2>

<h3 id="current-flow">Current flow:</h3>

<ol>
  <li>All hosts that are “UP”, and that have not been attempted to be chosen as SPMs in the Data Center are fetched.</li>
  <li>One is chosen randomly, and the SPM Selection algorithm begins.</li>
  <li>Every host that fails to become the SPM, is added to the <code class="language-plaintext highlighter-rouge">mTriedVdssList</code> of forbidden hosts.</li>
</ol>

<h3 id="new-design">New Design:</h3>

<ol>
  <li>Adding a <code class="language-plaintext highlighter-rouge">vds_spm_priority</code> field to <code class="language-plaintext highlighter-rouge">vds_static</code> (validated to be between <code class="language-plaintext highlighter-rouge">-1</code> and <code class="language-plaintext highlighter-rouge">10</code>). This field is configurable upon host creation and host editing by the admin.</li>
  <li>Replacing the list that is fetched in stage one of the current flow, with a list of prioritized hosts (detailed algorithm below).</li>
</ol>

<h3 id="algorithm-for-selecting-a-host-according-to-priorities">Algorithm for selecting a host according to priorities</h3>

<ol>
  <li>Fetch all hosts that are “UP” in Data Center, and that have not been attempted to be chosen as SPMs in the Data Center. The selection will return the list ordered both by SPM Priority (desc), and secondly by RANDOM().</li>
  <li>The top host is chosen, and the SPM Selection algorithm begins.</li>
  <li>Every host that fails to become the SPM, is added to a the mTriedVdssList of forbidden hosts.</li>
</ol>

<ul>
  <li>Ordering the hosts according to the SPM Priority will make sure that the priorities set by the admin will be taken under consideration.</li>
  <li>Secondly, ordering them with <code class="language-plaintext highlighter-rouge">RANDOM()</code>, randomly sorts each sub group of hosts that have the same priority. This will prevent the same host from being chosen every time, in case there are several hosts with the same priority.</li>
</ul>

<h2 id="affected-commands">Affected Commands</h2>

<ol>
  <li><code class="language-plaintext highlighter-rouge">AddVdsCommand</code> - no change since the parameter held is of type <code class="language-plaintext highlighter-rouge">VdsStatic</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">UpdateVdsCommand</code> - no change since the parameter held is of type <code class="language-plaintext highlighter-rouge">VdsStatic</code>.</li>
</ol>

<h2 id="rest-api-changes">REST API changes</h2>

<p>The <code class="language-plaintext highlighter-rouge">Host</code> resource schema was changed, and now the <code class="language-plaintext highlighter-rouge">storage_manager</code> element is of type <code class="language-plaintext highlighter-rouge">StorageManager</code> instead of <code class="language-plaintext highlighter-rouge">boolean</code>.</p>

<p>The schema for the <code class="language-plaintext highlighter-rouge">StorageManager</code> type is as follows:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"storage_manager"</span> <span class="na">type=</span><span class="s">"StorageManager"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;xs:complexType</span> <span class="na">name=</span><span class="s">"StorageManager"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:simpleContent&gt;</span>
        <span class="nt">&lt;xs:extension</span> <span class="na">base=</span><span class="s">"xs:boolean"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xs:attribute</span> <span class="na">name=</span><span class="s">"priority"</span> <span class="na">type=</span><span class="s">"xs:int"</span><span class="nt">&gt;&lt;/xs:attribute&gt;</span>
        <span class="nt">&lt;/xs:extension&gt;</span>
    <span class="nt">&lt;/xs:simpleContent&gt;</span>
<span class="nt">&lt;/xs:complexType&gt;</span>
</code></pre></div></div>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3112/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3112/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3112/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3112/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/spmpriority.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/storage/spmpriority.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
