<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Isolated ports | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Isolated ports" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3100/develop/release-management/features/network/isolated-ports.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3100/develop/release-management/features/network/isolated-ports.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Isolated ports" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Isolated ports","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3100/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3100/develop/release-management/features/network/isolated-ports.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3100/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3100/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3100/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3100/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3100/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3100/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3100/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3100/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3100/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3100/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3100/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3100/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3100/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3100/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3100/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3100/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3100/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3100/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3100/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3100/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3100/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3100/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3100//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3100//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3100/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3100/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3100/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3100/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3100/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dominik Holler">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dominik Holler</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3100/documentation/'>Documentation is available here.</a></div>

<h1 id="isolated-ports">Isolated ports</h1>

<h2 id="summary">Summary</h2>

<p>This feature enables you to prevent specific VMs on the same logical network
from communicating with and seeing each other.</p>

<p>The state of the feature is tracked in <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1725166">[RFE] Private VLAN / port isolation
</a>. Related patches can be found on <a href="https://gerrit.ovirt.org/#/q/topic:isolated_port">gerrit topic:isolated_port</a>.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>
    <p>Name: <a href="https://github.com/almusil">Aleš Musil</a></p>
  </li>
  <li>
    <p>Email: <a href="mailto:amusil@redhat.com">amusil@redhat.com</a></p>
  </li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>There are scenarios in which multiple VMs that share an uplink should not be
able to communicate with each other. For example when VMs are owned by multiple
customers. The shared uplink might be a connection to the gateway to the
outside network or the DHCP server.</p>

<p>In such scenarios, it is required to isolate the network connections of the VMs
per port, because filtering on MAC addresses does not address all cases,
e.g. <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1651499">Bug 1651499</a> and <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1651467">Bug 1651467</a>.</p>

<p>Such scenarios can be addressed by creating a VLAN tagged logical network with a
dedicated IP subnet per VM, but this is a waste of the limited VLANs and subnets
as described by <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/XE3-9-0E/15-25E/configuration/guide/xe-390-configuration/pvlans.html#77328">Cisco</a>.</p>

<p>For this reason switches commonly provide isolation per port.
There are two <a href="https://www.cisco.com/c/en/us/support/docs/switches/catalyst-6500-series-switches/10584-63.html">popular implementation levels</a> of private VLAN:</p>

<ul>
  <li>
    <p>The simple level prevents ports from communicating with each other by not
forwarding any traffic to any other isolated port.
This is called <a href="https://github.com/torvalds/linux/commit/7d850abd5f4edb1b1ca4b4141a4453305736f564">port isolation</a> in Linux, <a href="https://www.freebsd.org/doc/handbook/network-bridging.html">private interfaces</a> in
FreeBSD, or <a href="https://www.cisco.com/en/US/tech/tk389/tk814/tk841/tsd_technology_support_sub-protocol_home.html">PVLAN Edge (Protected Port)</a> in Cisco context, but probably
every smart or managed switch provides a similar option.</p>
  </li>
  <li>
    <p>Advanced implementations, e.g. from <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/XE3-9-0E/15-25E/configuration/guide/xe-390-configuration/pvlans.html#77328">Cisco</a>, <a href="https://www.freebsd.org/doc/handbook/network-bridging.html">Juniper</a>, <a href="https://www.juniper.net/documentation/en_US/junos/topics/topic-map/private-vlans.html">VMWare</a>, or
<a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.networking.doc/GUID-A9287D46-FDE0-4D64-9348-3905FEAC7FAE.html">Microsoft</a>, support ideas based on <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj679878(v%3Dws.11)#private-virtual-local-area-network-pvlan-and-trunk-mode">RFC 5517</a>.</p>
  </li>
</ul>

<p>Very advanced implementations from  <a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/XE3-9-0E/15-25E/configuration/guide/xe-390-configuration/pvlans.html#77328">Cisco</a>, <a href="https://www.freebsd.org/doc/handbook/network-bridging.html">Juniper</a>, and <a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.networking.doc/GUID-A9287D46-FDE0-4D64-9348-3905FEAC7FAE.html">Microsoft</a>
even enable combining private VLANS with VLAN tagging.</p>

<p>The proposed new oVirt feature extends the <a href="https://www.cisco.com/en/US/tech/tk389/tk814/tk841/tsd_technology_support_sub-protocol_home.html">PVLAN Edge (Protected Port)</a>
feature of the switch to the connected Linux bridge on the oVirt host.</p>

<p><img src="/ovirt-site/previews/3100/images/features/network/isolated_port.png" alt="Diagram of isolated port idea" /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>The implementation requires a <a href="https://github.com/torvalds/linux/commit/7d850abd5f4edb1b1ca4b4141a4453305736f564">Linux kernel</a> and <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1727263">libvirt</a> with port
isolation support.</p>

<p>The switch connected to the oVirt hosts has to support <a href="https://www.cisco.com/c/en/us/support/docs/switches/catalyst-6500-series-switches/10584-63.html">PVLAN Edge (Protected Port)</a>.</p>

<h2 id="limitations">Limitations</h2>

<p>Out of Scope:</p>
<ul>
  <li>Updating the new attribute of the logical network.</li>
  <li>Configuring port isolation per vNIC or vNIC profile.</li>
  <li>The permitted uplink, which will be able to communicate with all VMs, is
immutably the physical network.</li>
  <li>The attribute can only be true for Linux bridge based networks.</li>
  <li>There are many switch models, which are not able to combine the
<a href="https://www.cisco.com/en/US/tech/tk389/tk814/tk841/tsd_technology_support_sub-protocol_home.html">PVLAN Edge (Protected Port)</a> with VLAN tagging. For this reason most
users will not be able to add additional logical networks to the Ethernet
port, which uses this feature.</li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>This feature will help to reduce the number of required VLAN tagged logical
networks.</p>

<h2 id="implementation">Implementation</h2>

<h3 id="entity-description">Entity Description</h3>

<p>Logical networks will get a new boolean attribute. This attribute cannot be
updated after the network is created.
It is not possible to have this attribute on a VLAN profile, because this would
result in inconsistent behavior with the switch connected to the oVirt host.</p>

<h3 id="user-experience">User Experience</h3>

<p>On creating the network, the user can enable this feature for the new, not
external, VM networks via REST API or web UI.</p>

<h3 id="libvirt-xml">Libvirt XML</h3>

<p>If the feature is activated for a logical network connected to a virtual NIC,
the libvirt XML definition of the virtual NIC contains the
<a href="https://libvirt.org/formatdomain.html#elementPort"><code class="language-plaintext highlighter-rouge">&lt;port isolated="yes"/&gt;</code> element</a>, as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;interface type="bridge"&gt;
      &lt;model type="virtio"/&gt;
      &lt;link state="up"/&gt;
      &lt;source bridge="isolated_0"/&gt;
      &lt;port isolated="yes"/&gt;
      &lt;alias name="ua-6e2e236c-84e2-4601-83e4-2b1c66da46c9"/&gt;
      &lt;mac address="56:6f:74:24:00:02"/&gt;
      &lt;mtu size="1500"/&gt;
      &lt;filterref filter="vdsm-no-mac-spoofing"/&gt;
      &lt;bandwidth/&gt;
    &lt;/interface&gt;
</code></pre></div></div>

<h3 id="ensuring-the-prerequisites">Ensuring the Prerequisites</h3>

<p>The feature depends on libvirt from RHEL AV 8.3, because this version of
libvirt introduced support support for <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1727263">isolated ports</a>.</p>

<p>Engine has to ensure that VMs using this feature are scheduled only to
oVirt hosts which provides an appropriate version of libvirt.</p>

<p>For this reason, a cluster version dependent configuration value,
e.g. “IsPortIsolationSupported”, is introduced and set to false for cluster
levels up to 4.4 . If a user is sure that she wants to use this feature already,
because all the oVirt hosts use AV 8.3, she could enable it for cluster level
4.4. The engine would allow only to connect adding relevant networks to VMs,
if IsPortIsolationSupported is true for the cluster level of the VM.</p>

<h2 id="installationupgrade">Installation/Upgrade</h2>

<p>The feature will not affect new or existing installations.</p>

<h2 id="user-work-flows">User work-flows</h2>

<ol>
  <li>The user ensures that there is an unused Ethernet port on all hosts in the
relevant cluster.</li>
  <li>Ensure that the switch prevents communication between the switch ports
connected to the free Ethernet ports.</li>
  <li>Create a new logical network and enables the attributes “VM Network” and
“isolated”.</li>
  <li>Attach the new logical network to the unused Ethernet port on all relevant
hosts in the cluster.</li>
  <li>Attache the new logical network to a vNIC and run the VM.</li>
  <li>Verify that two VMs on the same host cannot communicate with each other.</li>
  <li>Verify that two VMs on separate hosts cannot communicate with each other.</li>
  <li>Verify that these VMs can communicate with the external (northbound, uplink)
network.</li>
</ol>

<h2 id="testing">Testing</h2>

<p>to test the feature in oVirt, it is sufficient to ensure that two VMs on the
same host are able to communicate with the gateway, but not with each other.
For the single host scenario, it is not necessary to configure the switch.</p>

<h2 id="documentation--external-references">Documentation &amp; External references</h2>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1725166">Bug 1725166 - [RFE] Private VLAN / port isolation</a></p>

<p><a href="https://gerrit.ovirt.org/#/q/topic:isolated_port">gerrit topic:isolated_port</a></p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1651499">Bug 1651499 - [clean-traffic-gateway filter] VM DHCP IP does not recover when
network operation is done from Guest </a></p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1651467">Bug 1651467 - [clean-traffic-gateway filter] ARP packet is leaking between
blocked VMs</a></p>

<p><a href="https://www.cisco.com/c/en/us/td/docs/switches/lan/catalyst4500/XE3-9-0E/15-25E/configuration/guide/xe-390-configuration/pvlans.html#77328">Cisco - Catalyst 4500 Series Switch Software Configuration Guide</a></p>

<p><a href="https://www.cisco.com/c/en/us/support/docs/switches/catalyst-6500-series-switches/10584-63.html">Cisco - Private VLAN Catalyst Switch Support Matrix</a></p>

<p><a href="https://github.com/torvalds/linux/commit/7d850abd5f4edb1b1ca4b4141a4453305736f564">Linux - net: bridge: add support for port isolation</a></p>

<p><a href="https://www.freebsd.org/doc/handbook/network-bridging.html">FreeBSD Handbook - Chapter 31. Advanced Networking</a></p>

<p><a href="https://www.juniper.net/documentation/en_US/junos/topics/topic-map/private-vlans.html">Juniper - Private VLANs</a></p>

<p><a href="https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.networking.doc/GUID-A9287D46-FDE0-4D64-9348-3905FEAC7FAE.html">VMWare - Private VLANs</a></p>

<p><a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj679878(v%3Dws.11)#private-virtual-local-area-network-pvlan-and-trunk-mode">Microsoft - Private Virtual Local Area Network (PVLAN) and Trunk Mode</a></p>

<p><a href="https://tools.ietf.org/html/rfc5517">RFC 5517</a></p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1727263">Bug 1727263 - [RFE] Add support for port isolation on linux bridge</a></p>

<p><a href="https://www.cisco.com/en/US/tech/tk389/tk814/tk841/tsd_technology_support_sub-protocol_home.html">Cisco - Private Vlan Edge (protected ports)</a></p>

<p><a href="https://libvirt.org/formatdomain.html#elementPort">libvirt - Isolating guests’s network traffic from each other</a></p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3100/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3100/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3100/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3100/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/isolated-ports.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/isolated-ports.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
