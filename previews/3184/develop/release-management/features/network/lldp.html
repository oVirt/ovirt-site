<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Link Layer Discovery Protocol (LLDP) Support | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Link Layer Discovery Protocol (LLDP) Support" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3184/develop/release-management/features/network/lldp.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3184/develop/release-management/features/network/lldp.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Link Layer Discovery Protocol (LLDP) Support" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Link Layer Discovery Protocol (LLDP) Support","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3184/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3184/develop/release-management/features/network/lldp.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3184/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3184/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3184/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3184/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3184/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3184/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3184/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3184/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3184/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3184/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3184/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3184/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3184/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3184/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3184/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3184/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3184/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3184/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3184/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3184/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3184/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3184/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3184//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3184//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3184/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3184/develop/">
              <span property="name">Joining the developers community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3184/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3184/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3184/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Dominik Holler">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Dominik Holler</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3184/documentation/'>Documentation is available here.</a></div>

<h1 id="link-layer-discovery-protocol-lldp-support">Link Layer Discovery Protocol (LLDP) Support</h1>

<h2 id="summary">Summary</h2>

<p>The <a href="https://ieeexplore.ieee.org/document/7433915">Link Layer Discovery Protocol (LLDP)</a> is a vendor-neutral networking
protocol, used by network devices, especially switches, for advertising their
identity, capabilities and management addresses on an IEEE 802 local area
network (LAN).</p>

<p>The feature will enable oVirt hosts to gather information from their networking
interfaces and let oVirt Engine use this information in a beneficial way.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>
    <p>Name: <a href="https://github.com/almusil">Aleš Musil</a></p>
  </li>
  <li>
    <p>Email: <a href="mailto:amusil@redhat.com">amusil@redhat.com</a></p>
  </li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>To support the integration of oVirt with other software, the information gathered
by LLDP on each host will be provided by oVirt Engine’s REST-API.</p>

<p>Some of the information, like the number of the switch port a network interface
of the host is connected to, might be helpful for the user and will be shown in
the graphical user interface.</p>

<p>At this point in time we do not intend to expose information by LLDP to the
switch.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>LLDP has to be enabled on the switch connected to the relevant oVirt hosts.</p>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>
    <p>There is a delay from receiving the LLDP data on the oVirt host, propagating
the data to the oVirt Engine and presenting the data to the user.
Whatever value we present over REST may be out of date.</p>
  </li>
  <li>
    <p>This feature is only about LLDP, Cisco Discovery Protocol (CDP) is not
addressed.</p>
  </li>
  <li>
    <p>Receiving LLDP on hot plugged network interfaces requires restarting of VDSM,
because receiving LLDP on the network interfaces is enabled during the startup
of VDSM.</p>
  </li>
  <li>
    <p>LLDP is only received on network interfaces with state UP.</p>
  </li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>Information from LLDP provided by oVirt engine’s REST-API will support the
integration of oVirt in other software.</p>

<h2 id="requirements">Requirements</h2>

<ul>
  <li>The following TLVs have to be available in oVirt Engine’s REST API:
    <ul>
      <li>Chassis ID TLV (Type = 1)</li>
      <li>Port ID TLV (Type = 2)</li>
      <li>Port Description TLV (Type = 4), with a value of up to 512 chars</li>
      <li>System Name TLV (Type = 5)</li>
      <li>System Description TLV (Type = 6)</li>
      <li>Management Address TLV (Type = 8)</li>
      <li>Port VLAN Id ( Type = 127, Oui = 0x0080c2 (802.1), Subtype = 1)</li>
      <li>VLAN name (Type = 127, Oui = 0x0080c2 (802.1), Subtype = 3)</li>
      <li>Link Aggregation TLV (Type = 127, Oui = 0x0080c2 (802.1), Subtype = 7)</li>
      <li>Maximum Frame Size TLV (Type = 127,  Oui = 0x00120F (802.3), Subtype = 4)</li>
    </ul>
  </li>
  <li>oVirt should keep track of the hosts and their neighbors which are active
and report only those when queried.</li>
</ul>

<h2 id="approach">Approach</h2>

<p>Steps to present the LLDP information:</p>

<ol>
  <li><a href="#vdsm-implementation-options">Receive LLDP information on the Ethernet cable on the host</a></li>
  <li><a href="#vdsm-implementation-options">Cache the LLDP information on the host</a></li>
  <li><a href="#communication-of-vdsm-and-ovirt-engine">Transport the LLDP information to oVirt Engine</a></li>
  <li>Present LLDP information:
    <ul>
      <li><a href="#rest-api">On REST-API</a></li>
      <li><a href="#follow-up-features">On Web-UI</a></li>
      <li><a href="#follow-up-features">For oVirt Engine internal use</a></li>
    </ul>
  </li>
</ol>

<p>If the LLDP information is used internally in oVirt Engine or in Web-UI, it
would be useful to cache the information in the data base.</p>

<p>To meet the requirements of this feature, there is no need to store the
information in the data base, because the information could be queried when a
REST request is processed processed. This way the age of the information is
kept as minimal as possible.</p>

<p>Thus we opt to avoid the DB completely. When Engine is asked about LLDP data of
a host, it would contact the specific host synchronously in order to provide an
answer.</p>

<h2 id="gathering-the-lldp-data-from-the-hosts">Gathering the LLDP data from the hosts</h2>

<p>There are multiple alternatives for oVirt Engine to gather the LLDP data from
the hosts:</p>

<ul>
  <li>
    <p>Extend VDSM to provide the LLDP data</p>
  </li>
  <li>
    <p>Use <a href="https://docs.ansible.com/ansible/devel/collections/community/general/lldp_module.html">Ansible’s lldp module</a></p>
  </li>
</ul>

<p>Because the Ansible module is flagged as preview and requires lldpd, which is
in only in EPEL repository for RHEL, VDSM has to be extended.</p>

<h2 id="vdsm-implementation-options">VDSM implementation options</h2>

<p>VDSM is planned to collect LLDP information through lldpad or NetworkManager
services.</p>

<ul>
  <li>lldpad is as immediate solution to the data collection as it can be used by
VDSM as a driver without any special work dependency.</li>
  <li>In order to use NetworkManager, a preliminary work is required in VDSM to
fully integrate it as an active configuration driver, replacing the existing
ifcfg usage.</li>
</ul>

<p>The proposal is to start with lldpad as an immediate solution and continue with
NetworkManager when it will be integrated into VDSM to replace the ifcfg usage.
Then NetworkManager will become the default driver that collects LLDP information.</p>

<h4 id="code-module-structure">Code Module structure</h4>

<p>These are the modules involved in the LLDP driver &amp; interface:</p>

<ul>
  <li>vdsm.network.lldpad : lldpad driver, using the lldptool as the cli client.</li>
  <li>vdsm.network.lldp : LLDP API interface, containing the lldpad driver interface
(which implements the LLDP API interface using the lldpad driver).</li>
</ul>

<h3 id="vdsm---lldpad">VDSM - lldpad</h3>

<p>lldpad is a service which is able to send and receive LLDP on network interfaces.
lldpad caches LLDP received information and lldptool can query this information.</p>

<p>The vdsmd service wants the lldpad service to be started as a weak dependency.
The interfaces on which lldap provides LLDP has to be configured explicitly by
VDSM.</p>

<p>VDSM, running in SELinux context <code class="language-plaintext highlighter-rouge">virtd_t</code>, uses the command line client
lldptool to communicate with the lldpad service,
running in SELinux context <code class="language-plaintext highlighter-rouge">lldpad_t</code>. This communication has to be <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1472722">explicitly
allowed</a>.</p>

<h3 id="lldp-report-formats">LLDP report formats</h3>

<p>lldptool and NetworkManager report in LLDP information in different formats.
Even different TLVs are formatted in a different way in the same tool.
For this reason there is a dedicated parsing required for nearly each TLV.</p>

<p>There are two alternatives to handle TLVs without a dedicated parsing function.
They could be discarded, or presented in a format depending on the underlying
tool.
To ensure at least implementation-independent names in the output, TLVs without
a dedicated parsing function are discarded. If an additional TLV is required,
an additional parsing function has to be added to the LLDP driver in VDSM.</p>

<p>lldptool report example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Chassis ID TLV
	MAC: 30:7c:5e:84:e1:a0
Port ID TLV
	Local: 510
Time to Live TLV
	120
System Name TLV
	rack11-sw02-lab4.tlv
System Description TLV
	Juniper Networks, Inc. ...
System Capabilities TLV
	System capabilities:  Bridge, Router
	Enabled capabilities: Bridge, Router
Port Description TLV
	ge-0/0/2
MAC/PHY Configuration Status TLV
	Auto-negotiation supported and enabled
	PMD auto-negotiation capabilities: 0x0001
	MAU type: Unknown [0x0000]
Link Aggregation TLV
	Aggregation capable
	Currently not aggregated
	Aggregated Port ID: 0
Maximum Frame Size TLV
	9216
Port VLAN ID TLV
	PVID: 2000
VLAN Name TLV
	VID 2000: Name foo
VLAN Name TLV
	VID 2001: Name bar
VLAN Name TLV
	VID 2002: Name foobar
Unidentified Org Specific TLV
	OUI: 0x009069, Subtype: 1, Info: 504533373135323130333833
LLDP-MED Capabilities TLV
	Device Type:  netcon
	Capabilities: LLDP-MED, Network Policy, Location Identification, Extended Power via MDI-PSE
End of LLDPDU TLV
</code></pre></div></div>

<p>NetworkManager report example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NEIGHBOR[0].DEVICE:                     enp5s0f0
NEIGHBOR[0].CHASSIS-ID:                 18:EF:63:A1:66:AD
NEIGHBOR[0].PORT-ID:                    Gi0/45
NEIGHBOR[0].PORT-DESCRIPTION:           GigabitEthernet0/45
NEIGHBOR[0].SYSTEM-NAME:                rack11-sw01-lab4.tlv.redhat.com
NEIGHBOR[0].SYSTEM-DESCRIPTION:         Cisco ...
NEIGHBOR[0].SYSTEM-CAPABILITIES:        20 (mac-bridge,router)
NEIGHBOR[0].IEEE-802-1-PVID:            150
NEIGHBOR[0].IEEE-802-1-PPVID:           --
NEIGHBOR[0].IEEE-802-1-PPVID-FLAGS:     --
NEIGHBOR[0].IEEE-802-1-VID:             --
NEIGHBOR[0].IEEE-802-1-VLAN-NAME:       --
NEIGHBOR[0].DESTINATION:                nearest-bridge
NEIGHBOR[0].CHASSIS-ID-TYPE:            4
NEIGHBOR[0].PORT-ID-TYPE:               7
</code></pre></div></div>

<h2 id="communication-of-vdsm-and-ovirt-engine">Communication of VDSM and oVirt Engine</h2>
<p>If the LLDP information is cached in the data base, it would be useful
to update the LLDP information together with the other information about the
network cards on the host by <code class="language-plaintext highlighter-rouge">Host.getCapabilities</code>.</p>

<p>However, at the moment, LLDP information is only required, if requested via the
REST-API. To avoid triggering the extensive <code class="language-plaintext highlighter-rouge">Host.getCapabilities</code>, if only the
LLDP information are needed, the new verb <code class="language-plaintext highlighter-rouge">Host.getLldp</code> is introduced.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">types</span><span class="pi">:</span>
    <span class="na">Tlv</span><span class="pi">:</span> <span class="nl">&amp;Tlv</span>
        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">LLDP Information</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">Tlv</span>
        <span class="na">properties</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Human readable string to describe what the value is</span>
              <span class="s">about.</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">name</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Structured information of the TLV</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">properties</span>
          <span class="na">type</span><span class="pi">:</span> <span class="nv">*StringMap</span>

        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">TLV type of IEEE 802.1AB.</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">type</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>

        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">organizationally unique identifier</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">oui</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>

        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">organizationally defined subtype</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">subtype</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">datatype</span><span class="pi">:</span> <span class="s">uint</span>

    <span class="na">Lldp</span><span class="pi">:</span> <span class="nl">&amp;Lldp</span>
        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">LLDP Information</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">Lldp</span>
        <span class="na">properties</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">Gathering LLDP information is enabled on the NIC</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">enabled</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
          <span class="na">datatype</span><span class="pi">:</span> <span class="s">boolean</span>
        <span class="pi">-</span> <span class="na">description</span><span class="pi">:</span> <span class="s">List of structured information of the TLVs</span>
          <span class="na">name</span><span class="pi">:</span> <span class="s">tlvs</span>
          <span class="na">type</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="nv">*Tlv</span>

    <span class="na">LldpMap</span><span class="pi">:</span> <span class="nl">&amp;LldpMap</span>
        <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">A mapping from interface name to LLDP information</span>
        <span class="na">key-type</span><span class="pi">:</span> <span class="s">string</span>
        <span class="na">name</span><span class="pi">:</span> <span class="nv">*LldpMap</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">map</span>
        <span class="na">value-type</span><span class="pi">:</span> <span class="nv">*Lldp</span>


<span class="na">Host.getLldp</span><span class="pi">:</span>
    <span class="na">added</span><span class="pi">:</span> <span class="s1">'</span><span class="s">4.2'</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Get lldp information of a NIC</span>
    <span class="na">params</span><span class="pi">:</span>
    <span class="pi">-</span>   <span class="na">description</span><span class="pi">:</span> <span class="s">Restrict the reported lldp information. Empty restriction</span>
            <span class="s">means to report all lldp information from all NICs.</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">filter</span>
        <span class="na">type</span><span class="pi">:</span> <span class="nv">*StringListMap</span>
    <span class="na">return</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s">Lldp information of a NIC</span>
        <span class="na">type</span><span class="pi">:</span> <span class="nv">*LldpMap</span>

</code></pre></div></div>

<h2 id="entity-description">Entity Description</h2>

<p>The initial LLDP information is encoded as a list of type, length, value (TLV) tuples.
To express multiple values, e.g. to list the allowed VLANs on a switch port,
the TLV is sent multiple times.
The value may contain structured data.
This way the LLDP data is non-uniform.
This non-uniform LLDP data will be mapped to the following uniform entities.</p>

<p>The entity <code class="language-plaintext highlighter-rouge">Tlv</code> represents the TLV received physically by the oVirt host’s NIC.
A <code class="language-plaintext highlighter-rouge">Tlv</code> is associated to a <code class="language-plaintext highlighter-rouge">VdsNetworkInterface</code>, called
<a href="http://ovirt.github.io/ovirt-engine-api-model/4.2/#types/host_nic"><code class="language-plaintext highlighter-rouge">HostNic</code> in REST-API</a>,
has a <code class="language-plaintext highlighter-rouge">name</code>, a <code class="language-plaintext highlighter-rouge">type</code>, a list of <code class="language-plaintext highlighter-rouge">properties</code> and optional an <code class="language-plaintext highlighter-rouge">oui</code> and a
<code class="language-plaintext highlighter-rouge">subtype</code>.</p>

<p><img src="../../../../images/wiki/EntityTlv.png" alt="Class diagramm of Tlv" title="Class diagramm of Tlv" /></p>

<p>The <code class="language-plaintext highlighter-rouge">name</code> is a human readable string to describe what the value is about and
may not be unique. The name is redundant, because it could be created from
<code class="language-plaintext highlighter-rouge">type</code> and the optional <code class="language-plaintext highlighter-rouge">oui</code> and <code class="language-plaintext highlighter-rouge">subtype</code>. The purpose of <code class="language-plaintext highlighter-rouge">name</code> is
to simplify the reading of the TLV.
The <code class="language-plaintext highlighter-rouge">name</code> of a property is exactly the same string which is used in
<a href="https://ieeexplore.ieee.org/document/7433915">IEEE 802.1AB</a> chapter 8.</p>

<p>The <code class="language-plaintext highlighter-rouge">type</code> is the TLV type of <a href="https://ieeexplore.ieee.org/document/7433915">IEEE 802.1AB</a>.</p>

<p>Organizationally Specific <code class="language-plaintext highlighter-rouge">Tlv</code>s have the <code class="language-plaintext highlighter-rouge">type</code> of <code class="language-plaintext highlighter-rouge">127</code> and the attributes
<code class="language-plaintext highlighter-rouge">oui</code> and <code class="language-plaintext highlighter-rouge">subtype</code>.
The <code class="language-plaintext highlighter-rouge">oui</code> holds the organizationally unique identifier, and the <code class="language-plaintext highlighter-rouge">subtype</code> the
organizationally defined subtype.</p>

<p>The <code class="language-plaintext highlighter-rouge">properties</code> are used to represent structured information transported by the
TLV.</p>

<p>The entity <code class="language-plaintext highlighter-rouge">LldpInfo</code> has a list of all <code class="language-plaintext highlighter-rouge">Tlv</code>s of an interface and shows if the
gathering of the LLDP information is <code class="language-plaintext highlighter-rouge">enabled</code> on the interface. If it is
not <code class="language-plaintext highlighter-rouge">enabled</code>, there is a problem gathering the LLDP information on the interface.
Problems on gathering LLDP information might be that the interface is down or
LLDP is not enabled on the interface.</p>

<h2 id="crud">CRUD</h2>

<p>The CRUD operations are not needed, because the implementation does not use the
data base.</p>

<h2 id="user-experience">User Experience</h2>

<h3 id="rest-api">REST-API</h3>

<p>The LLDP information are read-only. They could be read by a request like</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET https://ovirtexampleengine/ovirt-engine/api/hosts/123/nics/321/linklayerdiscoveryprotocolelements
</code></pre></div></div>

<p>Depending on the HTTP <code class="language-plaintext highlighter-rouge">Accept</code> header used in this request, oVirt Engine will
respond in JSON or XML.
A problem in gathering the LLDP information would result in an empty list of
<code class="language-plaintext highlighter-rouge">link_layer_discovery_protocol_elements</code> on the REST-API.
The response in XML for the <a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=lldp.detailed.pcap">SampleCaptures from Wireshark’s wiki</a> will look like this</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link_layer_discovery_protocol_elements&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Chassis ID<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>chassis ID subtype<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>MAC address<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>chassis ID<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>00:01:30:f9:ad:a0<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>1<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Port ID<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>port ID subtype<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Interface Name<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>port ID<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>1/1<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>2<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Time to Live<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>TTL<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>120<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>3<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Port Description<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>port description<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Summit300-48-Port 1001<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>4<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>System Name<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>system name<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Summit300-48<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>5<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>System Description<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>system description<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Summit300-48 - Version 7.4e.1 (Build 5) by Release_Master 05/27/05 04:53:11<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>6<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>System Capabilities<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>system capabilities<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Bridge, Router<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>enabled capabilities<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>Bridge, Router<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>7<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Management Address<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>management address subtype<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>AFI 802<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>management address<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>00:01:30:f9:ad:a0<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;type&gt;</span>8<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Port VLAN Id<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>port vlan id<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>488<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;subtype&gt;</span>1<span class="nt">&lt;/subtype&gt;</span>
    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Port VLAN Id<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>vlan id<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>488<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>vlan name<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>v2-0488-03-0505<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;subtype&gt;</span>3<span class="nt">&lt;/subtype&gt;</span>
    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>Link Aggregation<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;oui&gt;</span>32962<span class="nt">&lt;/oui&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>Aggregation capable<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>True<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>Currently aggregated<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>True<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>Aggregated Port ID<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>600<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;subtype&gt;</span>7<span class="nt">&lt;/subtype&gt;</span>
    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
  <span class="nt">&lt;link_layer_discovery_protocol_element&gt;</span>
    <span class="nt">&lt;name&gt;</span>MTU<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;oui&gt;</span>4623<span class="nt">&lt;/oui&gt;</span>
    <span class="nt">&lt;properties&gt;</span>
      <span class="nt">&lt;property&gt;</span>
        <span class="nt">&lt;name&gt;</span>mtu<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>9018<span class="nt">&lt;/value&gt;</span>
      <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/properties&gt;</span>
    <span class="nt">&lt;subtype&gt;</span>4<span class="nt">&lt;/subtype&gt;</span>
    <span class="nt">&lt;type&gt;</span>127<span class="nt">&lt;/type&gt;</span>
  <span class="nt">&lt;/link_layer_discovery_protocol_element&gt;</span>
<span class="nt">&lt;/link_layer_discovery_protocol_elements&gt;</span>
</code></pre></div></div>

<h3 id="graphical-user-interface">Graphical User Interface</h3>

<p>LLDP information can be found in <strong>Hosts</strong> &gt; <strong>Network Interfaces</strong> &gt;
<strong>Setup Host Networks</strong>. The interface tooltip will show the relevant
information.</p>

<p><img src="../../../../images/wiki/lldp_ui.png" alt="UI LDDP tooltip" title="UI LLDP tooltip" /></p>

<h2 id="installationupgrade">Installation/Upgrade</h2>

<p>The VDSM package would require the package lldpad and ask the service lldpad to
start.</p>

<p>Describe how the feature will affect new or existing installations.</p>

<h2 id="user-work-flows">User work-flows</h2>

<p>The user gets the information about the networking neighbor via REST-API.</p>

<h2 id="dependencies">Dependencies</h2>

<h3 id="ovirt-engine-side">oVirt Engine Side</h3>

<p>No additional dependencies on oVirt Engine side.</p>

<h3 id="vdsm-host-side">VDSM Host Side</h3>

<p>The package lldpad has to be installed and the demon lldpad has to be running.</p>

<h2 id="documentation--external-references">Documentation &amp; External references</h2>

<p><a href="https://ieeexplore.ieee.org/document/7433915">IEEE Std 802.1AB™-2016, IEEE Standard for Local and metropolitan area networks—Station and Media Access Control Connectivity Discovery</a></p>

<p><a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a></p>

<p><a href="https://docs.ansible.com/ansible/devel/collections/community/general/lldp_module.html">Ansible Docs lldp - get details reported by lldp</a></p>

<p><a href="https://specs.openstack.org/openstack/ironic-inspector-specs/specs/lldp-reporting.html">OpenStack: Introspection LLDP reporting</a></p>

<p><a href="https://wiki.wireshark.org/SampleCaptures?action=AttachFile&amp;do=view&amp;target=lldp.detailed.pcap">SampleCaptures from Wireshark’s wiki</a></p>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1472722">Bug 1472722 - SELinux is preventing /usr/sbin/lldpad from sendto access on the unix_dgram_socket</a></p>

<h2 id="testing">Testing</h2>

<p>Ensure <a href="#prerequisites">prerequisites</a> and use REST-API like in
<a href="#rest-api">example</a> above.</p>

<h2 id="follow-up-features">Follow-Up Features</h2>

<p>Another benefit of this feature is, that the information can be used by oVirt
Engine to configure the hosts in a smarter way. oVirt Engine could detect and
avoid host networking configurations, which do not match the configuration of
the switch port the relevant host’s network interface is connected to.
Example of relevant configuration options are:</p>

<ul>
  <li>The VLAN configuration of the host has to match the VLAN configuration of the
switch port. This could be used by oVirt Engine like following:
    <ul>
      <li>Assuming that interfaces are correctly patched to the correct ports,
which have VLAN and such already assigned, it may be able to already
configure automatically the networks on the host when adding the host.</li>
      <li>Once a network is defined with a specific VLAN-ID, oVirt Engine could
automatically attach it to the proper NIC on all hosts in the cluster.
This would be an even simpler user experience than using labels.</li>
      <li>If a host should be connected to a given VLAN, there might be only a
single network interface of the host which is connected to a switch port
which allows the usage of this VLAN.</li>
    </ul>
  </li>
  <li>
    <p>According to section “5. Switch Configuration” in
<a href="https://www.kernel.org/doc/Documentation/networking/bonding.txt">Linux Ethernet Bonding Driver HOWTO</a>, the bonding modes
balance-rr (0), balance-xor (2), broadcast (3), 802.3ad (4) may require
configuration on switch side.</p>
  </li>
  <li>The switch port might have constraints about the MTU.</li>
</ul>

<p>Information from LLDP provided by the UI might help the user to avoid and
locate manual host network configuration errors caused by a mismatch of switch
port configuration.</p>

<h2 id="release-notes">Release Notes</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  == Link Layer Discovery Protocol (LLDP) Support  ==
  oVirt Engine provides access via REST-API to values gathered on the hosts by LLDP.
</code></pre></div></div>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3184/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3184/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3184/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3184/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2024 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/lldp.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/lldp.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
