<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Guest Reboot | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Guest Reboot" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3125/develop/release-management/features/virt/guest-reboot.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3125/develop/release-management/features/virt/guest-reboot.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Guest Reboot" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Guest Reboot","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3125/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3125/develop/release-management/features/virt/guest-reboot.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3125/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3125/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3125/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3125/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3125/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3125/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3125/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3125/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3125/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/1aea6f5822d7287d6ac8fb61b3905243?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/1aea6f5822d7287d6ac8fb61b3905243?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Martin Betak">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Martin Betak</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3125/documentation/'>Documentation is available here.</a></div>

<h1 id="guest-reboot-preview">Guest Reboot (preview)</h1>

<h2 id="summary">Summary</h2>

<p>Support reboot in both engine and vdsm. Enable users to restart VM with single command.</p>

<h2 id="detailed-description">Detailed description</h2>

<h3 id="current-condition">Current Condition</h3>

<p>The current behavior in the engine requires the user who wishes to reboot VM to wait until the VM is <code class="language-plaintext highlighter-rouge">Down</code>, then press run and wait until it is <code class="language-plaintext highlighter-rouge">Up</code> again. Adding a new button/REST action (with configurable behavior, see <a href="#backend">later</a>) would solve this issue. Also, if the guest OS refuses the “soft” version of shutdown, after some period it goes back to state <code class="language-plaintext highlighter-rouge">Up</code> and this delay period is not configurable.</p>

<h3 id="proposed-changes">Proposed changes</h3>

<p>The reboot will essentially act as a macro of actions shutdown and run with all the consequences for run-once and stateless VM’s. The shutdown part of the reboot is subject to VM’s power-down policy but in case the VM’s config has changed we need to destroy the VM eventually (for the new configuration to be applied on run) so the shutdown part of reboot is in this case forced. Under forced powerdown (shutdown or first phase of reboot) we understand that after the all the graceful method have been tried and the graceful period has timed out we will proceed with vm.destroy() as opposed to just returning the VM to <strong>Up</strong> state.</p>

<h4 id="frontend">Frontend</h4>

<ul>
  <li>Add new button <img src="/ovirt-site/previews/3125/images/wiki/Reboot.png" alt="" /> in the main VM toolbar between the current stop and console buttons.</li>
  <li>Add ‘Reboot’ option to the VM context menu.</li>
  <li>Add context menu option for forced reboot - equivalent of ‘Power Off’ for reboot.</li>
  <li>Add power-down policy selection checkbox (checked if we want to force powerdown) and textbox for specifying number of seconds for graceful powerdown period to EditVM dialog.</li>
</ul>

<h4 id="rest-api">REST API</h4>

<ul>
  <li>Add VM action for reboot (subject to power-down policy)</li>
  <li>Add VM action for forced-reboot (powercycle)</li>
  <li>Add VM attribute for power-down policy</li>
  <li>Add VM attribute for graceful power-down delay</li>
</ul>

<h4 id="backend">Backend</h4>

<p>At the engine level we can differentiate between VMs that the user considers “important” and should not be forcibly terminated if the guest OS doesn’t gracefully power down after given timeout and VMs which the users expects to be rebooted by any means necessary. This power-down policy should be specified as <code class="language-plaintext highlighter-rouge">vm_static</code> attribute and would by applied on both the shutown and the reboot action. If the user would wish for the “harder” behavior he can edit the policy for given VM or just pick the appropriate action from the context menu. We should also provide the user with the ability to specify the graceful-delay as another <code class="language-plaintext highlighter-rouge">vm_static</code> attribute. This delay will be used by VDSM/guest-agent and specifies how long to wait for the guest-agent/acpi until we return failure or resort to the forced destroy/reset.</p>

<h4 id="vdsm">VDSM</h4>

<p>Alter the API of <code class="language-plaintext highlighter-rouge">shutdown</code>. Add two optional boolean parameters: <code class="language-plaintext highlighter-rouge">force</code> and <code class="language-plaintext highlighter-rouge">reboot</code> where <code class="language-plaintext highlighter-rouge">reboot</code> differentiates between shutdown/reboot and <code class="language-plaintext highlighter-rouge">force</code> allows us to specify whether to forcibly destroy/reset VM after all the graceful methods of shutdown/reboot have failed (guest-agent, acpi).</p>

<h4 id="guest-agent">Guest Agent</h4>

<p>Support additional boolean parameter in the desktopShutdown call determining wether we want normal shutdown (<code class="language-plaintext highlighter-rouge">reboot=False</code>) or reboot. This is the simplest change as it boils down to passing -h or -r flag to the underlying script performing the shutdown.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Martin Betak (Mbetak)</li>
  <li>Email: <a href="mailto:mbetak@redhat.com">mbetak@redhat.com</a></li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3125/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3125/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3125/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3125/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/guest-reboot.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/virt/guest-reboot.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
