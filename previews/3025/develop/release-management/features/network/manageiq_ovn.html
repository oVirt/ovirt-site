<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Integrating OVN with ManageIQ | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Integrating OVN with ManageIQ" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3025/develop/release-management/features/network/manageiq_ovn.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3025/develop/release-management/features/network/manageiq_ovn.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Integrating OVN with ManageIQ" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Integrating OVN with ManageIQ","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3025/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3025/develop/release-management/features/network/manageiq_ovn.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3025/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3025/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3025/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3025/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3025/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3025/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3025/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3025/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3025/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3025/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3025/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3025/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3025/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3025/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3025/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3025/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3025/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3025/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3025/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3025/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3025/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3025/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3025//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3025//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3025/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3025/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3025/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3025/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3025/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d3fd70f530336c1d9da52f61cffcd3e4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d3fd70f530336c1d9da52f61cffcd3e4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Alona Kaplan">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Alona Kaplan</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3025/documentation/'>Documentation is available here.</a></div>

<h1 id="integrating-ovn-to-manageiq">Integrating OVN to ManageIQ</h1>

<h2 id="summary">Summary</h2>
<p>Let the ManageIQ operator discover OVN as the network provider of oVirt. Adding the ability to get, add, update and remove networks and subnets and get ports directly from <code class="language-plaintext highlighter-rouge">ovirt-provider-ovn</code>.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>
    <p>Name: <a href="https://github.com/AlonaKaplan">Alona Kaplan</a></p>
  </li>
  <li>
    <p>Email: <a href="mailto:alkaplan@redhat.com">alkaplan@redhat.com</a></p>
  </li>
</ul>

<h2 id="terminology">Terminology</h2>
<ul>
  <li>OVN: Open Virtual Network. OVN is an OVS (Open vSwitch) extension that brings Software Defined Networking to OVS.</li>
  <li>oVirt OVN provider: is a proxy that interacts with OVN. The provider has ‘Neutron like’ API (only implements a subset of the ‘Neutron’ api).</li>
  <li>ManageIQ: is a cloud management platform that allows centralized management of various virtualization, private cloud, public cloud, containers, middleware and software defined networking technologies.</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>
<p>ManageIQ has an infra provider for oVirt. The feature adds automatic discovery of oVirt’s network provider (OVN provider) once the infra provider is added/refreshed.
ManageIQ users will be able to perform CRUD actions on networks and subnets and getting ports directly from/on the OVN provider without passing through oVirt.
ManageIQ already supports automatic discovery of the OpenStack network provider (Neutron) and has all the functionality to communicate with it (CRUD actions for networks and subnets, showing ports and more).
Since oVirt’s OVN provider has ‘Neutron like’ API, the purpose of the feature is to reuse the already existing ManageIQ code (fog-openstack, ManageIQ::Providers::Openstack::NetworkManager) to communicate with the oVirt’s OVN provider.
Since there are some gaps between the ‘Neutron like’ API oVirt’s OVN provider has and the desired API ManageIQ expects to get, some adjustments to the oVirt’s OVN provider are done during the development process.</p>

<h2 id="requirements">Requirements</h2>
<ul>
  <li>Discovery of oVirt network provider on the infra provider add/refresh.</li>
  <li>CRUD actions on the OVN provider entities (networks, subnets).</li>
  <li>Displaying ports.</li>
  <li>Manual refresh of oVirt’s network provider.</li>
  <li>Removing the network provider from ManageIQ in case it is removed from oVirt.</li>
</ul>

<h2 id="limitations">Limitations</h2>
<ul>
  <li>ManageIQ supports only one network provider for one infra provider (such as oVirt infra provider).</li>
  <li>In oVirt there is no way to distinguish between Openstack network provider and OVN provider. Therefore, ManageIQ has no way to find out what provider is the OVN one.
In case oVirt has more than one network provider, the first one (alphabetic order) will be used.</li>
</ul>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>
<ul>
  <li>The ui and the communication code with the network provider is already written in ManageIQ (for Openstack-Neutron). Adding it from scratch to oVirt will take much more time than reusing the code of ManageIQ,</li>
</ul>

<h2 id="benefit-to-manageiq">Benefit to ManageIQ</h2>
<ul>
  <li>Adding more power to the oVirt’s infra manager.</li>
  <li>oVirt users that want to use OVN provider (more than the basic operations oVirt supports) will have to use ManageIQ.</li>
</ul>

<h2 id="gaps-with-the-openstack-network-provider">Gaps with the OpenStack network provider</h2>

<h3 id="gaps">Gaps</h3>
<ul>
  <li>Communication and authentication
    <ul>
      <li>The OpenStack infra manager added to ManageIQ has the Keystone URL. OpenStack infra manager discovers the other OpenStack services via Keystone. The Keystone returns a service catalog with all the URLs and other information about the services. This information is used to communicate with the other services.</li>
      <li>The network manager is an ExtManagementSystem.</li>
      <li>OpenStack’s network manager delegates all its communication and authentication methods to the parent manager (infra manager =&gt; Keystone).</li>
      <li>The oVirt’s infra manager is communicating with oVirt but the network manager should communicate directly with OVN provider. Therefore, the delegation the OpenStack’s network manager has is problematic for oVirt.</li>
    </ul>
  </li>
  <li>Service Catalog
    <ul>
      <li>In oVirt when adding a new network provider, the user supplies two values - <code class="language-plaintext highlighter-rouge">provider_url</code> and <code class="language-plaintext highlighter-rouge">authentication_url</code> (the URL of ‘Keystone’).
First an authentication is done against ‘Keystone’ to get the <code class="language-plaintext highlighter-rouge">token</code> and then oVirt communicates with the provider using the <code class="language-plaintext highlighter-rouge">provider_url</code> (supplying the <code class="language-plaintext highlighter-rouge">token</code> for authentication).</li>
      <li>In ManageIQ the ‘services’ URLs are not supplied by the user but determined from the ‘Keystone’. When ‘Keystone’ is asked for the <code class="language-plaintext highlighter-rouge">token</code> it replies with the <code class="language-plaintext highlighter-rouge">token</code> and a <code class="language-plaintext highlighter-rouge">service_catalog</code> with all the services information (URLs, credentials, etc).</li>
    </ul>
  </li>
  <li>Tenants
    <ul>
      <li>Neutron supports tenants.</li>
      <li>oVirt’s OVN provider doesn’t.</li>
      <li>ManageIQ expects the Neutron network provider to have tenants.</li>
    </ul>
  </li>
  <li>oVirt’s OVN provider has ‘v2’ Neutron like API. However, ‘v2’ API is already considered as legacy.</li>
</ul>

<h3 id="solving-the-gaps">Solving the gaps</h3>
<ul>
  <li>Communication and authentication</li>
  <li>Creating network manager class that doesn’t inherit from the OpenStack one.</li>
  <li>oVirt’s network manager will take responsibility for its communication and authentication reusing the communication and authentication code of the OpenStack infra manager.</li>
  <li>The collector, parser, refresher and entities classes (cloud_network, cloud_subnet, network_port etc) inherit from the OpenStack ones.</li>
  <li>Upon each update of the oVirt’s infra manager
    <ul>
      <li>all the network providers will be retrieved from oVirt.</li>
      <li>only the first network provider will be processed.</li>
      <li>if a network manager doesn’t exist it will be created.</li>
      <li>the network’s provider <code class="language-plaintext highlighter-rouge">authentication_url</code> will be parsed and the network manager will be updated accordingly. The fields that will be updated are: <code class="language-plaintext highlighter-rouge">hostname</code>, <code class="language-plaintext highlighter-rouge">port</code>, <code class="language-plaintext highlighter-rouge">api_version</code> and <code class="language-plaintext highlighter-rouge">security_protocol</code> (‘ssl’ for ‘https’ and ‘non-ssl’ for ‘http’).</li>
    </ul>
  </li>
  <li>Service Catalog
    <ul>
      <li>oVirt’s OVN provider was updated to send also <code class="language-plaintext highlighter-rouge">service_catalog</code> when it is asked for a <code class="language-plaintext highlighter-rouge">token</code>. Only the relevant services will be in the catalog - ‘identity’ (Keystone), ‘network’ and ‘compute’ (see open questions).</li>
      <li>oVirt provider OVN will report a dummy tenant that will be stored in the ‘cloud_tenant’ table of ManageIQ.
        <ul>
          <li>When creating the network manager entities, the user will have to choose this tenant.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="open-questions">Open Questions</h2>
<ul>
  <li><code class="language-plaintext highlighter-rouge">ManageIQ::Providers::Openstack::legacy:OpenstackHandle</code> is responsible to communicate with the openstack-fog. It is placed in a ‘legacy’ directory. Why? Is it going to be replaced soon?</li>
  <li>Why does the <code class="language-plaintext highlighter-rouge">openstack_handle/handle.accessible_tenants</code> method first tries to connect to the ‘compute’ service?
    <ul>
      <li>Current workaround - the oVirt OVN provider reports the ‘compute’ service in the service catalog with the same URL and credentials as the network service.</li>
    </ul>
  </li>
</ul>

<h2 id="user-experience">User Experience</h2>
<h3 id="network-manager-menu">Network Manager menu</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/networks_menu.png" alt="Network Manager menu" /></p>

<h3 id="network-managers-list">Network Managers list</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/network_managers_list.png" alt="Network Managers list" /></p>

<h3 id="specific-network-manager-subnets-list">Specific Network Manager Subnets list</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/specific_network_manager_subnets_list.png" alt="Specific Network Manager Subnets list" /></p>

<h3 id="network-manager---general">Network Manager - general</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/network_manager_general.png" alt="Network Manager - general" /></p>

<h3 id="networks-list">Networks list</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/cloud_networks_list.png" alt="Networks list" /></p>

<h3 id="add-network">Add Network</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/add_cloud_network.png" alt="Add Network" /></p>

<h3 id="subnets-list">Subnets list</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/cloud_subnets_list.png" alt="Subnets list" /></p>

<h3 id="add-subnet">Add Subnet</h3>
<p><img src="/ovirt-site/previews/3025/images/wiki/add_cloud_subnet.png" alt="Add Subnet" /></p>

<h2 id="dependencies">Dependencies</h2>
<ul>
  <li>[OpenStack Networking API v2.0] (https://developer.openstack.org/api-ref/networking/v2/index.html)</li>
  <li>[ovirt-provider-ovn] (https://gerrit.ovirt.org/#/q/project:ovirt-provider-ovn)</li>
</ul>

<h2 id="documentation--external-references">Documentation &amp; External references</h2>
<ul>
  <li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1449157">Bug 1449157 - (RHEV provider)(vm provision) - Specifying vnic profile on virtual nic instead of network</a></li>
  <li><a href="https://blogs.ovirt.org/2016/11/ovirt-software-defined-networking-the-ovn-network-provider/">oVirt Software Defined Networking, The OVN Network Provider</a></li>
</ul>

<h2 id="follow-up-features">Follow-Up Features</h2>
<ul>
  <li>Show/Add/Update of
    <ul>
      <li>Network Routers</li>
      <li>Security Groups</li>
      <li>Floating ips</li>
      <li>Load Balancers</li>
    </ul>
  </li>
  <li>Automatic refresh of oVirt’s network provider.</li>
  <li>When an operator adds an OVN network via ManageIQ, ManageIQ would issue an auto-import of the new network into oVirt.</li>
  <li>Add network provider to oVirt’s infra provider manually via ManageIQ.</li>
  <li>Currenty the OVN provider authorizes users through oVirt. Once authentication plugin will be added to the OVN provider, ManageIQ will have to support it.</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3025/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3025/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3025/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3025/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/manageiq_ovn.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/network/manageiq_ovn.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
