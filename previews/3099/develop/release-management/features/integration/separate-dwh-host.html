<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Separate-DWH-Host | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Separate-DWH-Host" />
<meta name="author" content="Yedidyah Bar David" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3099/develop/release-management/features/integration/separate-dwh-host.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3099/develop/release-management/features/integration/separate-dwh-host.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Separate-DWH-Host" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Yedidyah Bar David" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Yedidyah Bar David"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Separate-DWH-Host","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3099/images/logo.svg"},"name":"Yedidyah Bar David"},"url":"https://ovirt.github.io/ovirt-site/previews/3099/develop/release-management/features/integration/separate-dwh-host.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3099/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3099/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3099/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3099/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3099/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3099/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3099/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3099/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3099/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3099/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3099/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3099/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3099/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3099/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3099/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3099/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3099/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3099/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3099/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3099/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3099/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3099/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3099//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3099//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3099/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3099/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3099/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3099/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3099/develop/release-management/features/integration/">
              <span property="name">Integration</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/a29d28811a6b9fc71f135fc57cbb3ee4?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Yedidyah Bar David">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Yedidyah Bar David</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sandro Bonazzola">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"><a rel="author" href="https://twitter.com/sandrobonazzola" title="Sandro Bonazzola">Sandro Bonazzola</a></span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/7994226372822da5ac75322d097186c9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/7994226372822da5ac75322d097186c9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Shirly Radco">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shirly Radco</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3099/documentation/'>Documentation is available here.</a></div>

<h1 id="separate-dwh-host">Separate DWH Host</h1>

<h2 id="summary">Summary</h2>

<p>Allow ovirt-engine-dwh to be installed and configured by engine-setup on a separate machine, without requiring ovirt-engine to be on the same host.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Didi (Didi)</li>
</ul>

<!-- -->

<ul>
  <li>Email: <a href="mailto:didi@redhat.com">didi@redhat.com</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<p>Implemented, should be available in 3.5.</p>

<h2 id="detailed-description">Detailed Description</h2>

<p>We assume that engine is already setup and running on machine A. We assume that user wants to install dwh on machine B.</p>

<p>We need access to the engine’s database. If on separate host, user will be prompted for them.</p>

<p>We need to also fix bug <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1059283">https://bugzilla.redhat.com/show_bug.cgi?id=1059283</a> - check minimal ETL version, as we’ll not be able to rely on package dependencies anymore.</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<p>DWH sometimes causes a significant load on the engine machine. Installing it on a separate machine will allow distributing the load.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1080997">https://bugzilla.redhat.com/show_bug.cgi?id=1080997</a></p>

<h2 id="testing">Testing</h2>

<p>Install and setup ovirt-engine on machine A, ovirt-engine-dwh on machine B, see that dwhd on B collects data from the engine on A.</p>

<p>On A:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  yum install ovirt-engine-setup
  engine-setup
</code></pre></div></div>

<p>On B:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  yum install ovirt-engine-dwh-setup
  engine-setup
</code></pre></div></div>

<h3 id="dwhd-is-currently-running">dwhd is currently running</h3>

<p>You might get en error from engine-setup ‘dwhd is currently running’.</p>

<p>To fix this, you can try one of the following:</p>

<ul>
  <li>
    <p>Restart dwhd:</p>

    <p>service ovirt-engine-dwhd restart</p>
  </li>
</ul>

<p>and make sure that it stopped and started cleanly (without errors in the log)</p>

<ul>
  <li>Clear DwhCurrentlyRunning</li>
</ul>

<p>Make sure that dwhd is stopped, and then, in the engine’s database,</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  UPDATE dwh_history_timekeeping SET var_value = 0 WHERE var_name = 'DwhCurrentlyRunning';
</code></pre></div></div>

<p>Details:</p>

<p>When upgrading the engine, dwhd must be first stopped, then upgraded, then started. Otherwise it might try to collect inconsistent data, from a database in the middle of an upgrade, or from an upgraded database. In previous versions this was forced by engine-setup. Now that might be impossible, if they are on separate machines. To enforce that, a new flag was added to the database, marking that dwhd is up. It’s set by dwhd on start, cleared on stop, and tested by engine-setup. Another flag was added to mark that dwhd should stop. If engine-setup sees that dwhd is up, it asks it to stop by marking that flag, then waits some time, and eventually times out and aborts if dwhd didn’t mark that it is stopped. The most likely cause of this is an uncontrolled exit of dwhd, e.g. killing it with SIGKILL or unplugging the power of its host.</p>

<p><a href="/ovirt-site/previews/3099/develop/release-management/features/">Separate DWH Host</a> <a href="/ovirt-site/previews/3099/develop/release-management/releases/3.5/feature.html">Separate DWH Host</a></p>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3099/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3099/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3099/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3099/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/integration/separate-dwh-host.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/integration/separate-dwh-host.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
