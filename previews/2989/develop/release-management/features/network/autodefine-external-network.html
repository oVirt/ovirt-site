<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Autodefine External Network | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Autodefine External Network" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/network/autodefine-external-network.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/network/autodefine-external-network.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Autodefine External Network" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Autodefine External Network","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2989/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/network/autodefine-external-network.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2989/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2989/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2989/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2989/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2989/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2989/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2989/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2989/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2989/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/features/network/">
              <span property="name">Network</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6536e276265bfa4de65dbaf52bc396e1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ales Musil">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ales Musil</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2989/documentation/'>Documentation is available here.</a></div>

<h1 id="autodefine-external-network">Autodefine External Network</h1>

<h2 id="summary">Summary</h2>

<p>This feature extends <a href="/ovirt-site/previews/2989/develop/release-management/features/network/provider-physical-network.html">Provider Physical Network</a> 
adding support for auto-defined external network connected to physical ones. 
With this feature implemented, when a physical VM network is created, Engine 
automatically creates an external network based on it, and connects the external
network to the physical one. This makes it easier to use the former feature, and
helps oVirt to model host networks and VM networks separately.</p>

<p>Related patches can be found on <a href="https://gerrit.ovirt.org/#/q/topic:autodefine">gerrit topic:autodefine</a>.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Feature Owner: Ales Musil (amusil)</li>
  <li>E-mail: <a href="mailto:amusil@redhat.com">amusil@redhat.com</a></li>
</ul>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>Provider Physical Network is useful for users who would like to 
manage their network via SDN (such as OVN or Neutron) yet have near-native 
performance. However, without auto-define feature, such admin would have to 
create a physical network (and attach it to hosts), create an external network,
and remember to connect this two networks together. Autodefine helps reducing 
these administrative tasks. In an OvS cluster with an external provider 
attached, the external network is automatically created and connected to the 
physical one.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>Cluster has to be configured with switch type OvS and valid external provider.
The user needs to make sure that connection to external provider is valid.</p>

<h3 id="limitations">Limitations</h3>

<ul>
  <li>
    <p>With OvS switch type in cluster, only external networks are allowed to 
be attached to the VM interface via UI.</p>
  </li>
  <li>
    <p>Physical network linked to any external network cannot be removed. This is for
keeping the consistency of database. In the future we might add a way to 
remove all dependent external networks with physical one.</p>
  </li>
  <li>
    <p>The switch type of existing clusters cannot be changed (from Linux bridge to 
OvS or vice versa) via UI. Thus, we currently do not need to worry about 
auto-defining external networks on top of existing physical networks.</p>
  </li>
  <li>
    <p>Currently, updating the physical network will not update the auto-defined 
external network. This might change in the future.</p>
  </li>
  <li>
    <p>VMs will be scheduled only on hosts that does have attached linked physical 
network to one of itâ€™s interfaces. Same rule applies for hotplug of VM 
interfaces.</p>
  </li>
</ul>

<h2 id="detailed-description">Detailed description</h2>

<h3 id="creating-of-new-physical-network">Creating of new physical network</h3>

<p>When creating new network choose its name. Check the <code class="language-plaintext highlighter-rouge">VM network</code>. If vlan 
tagging is needed, check the <code class="language-plaintext highlighter-rouge">Enable VLAN tagging</code> and put the tag into the 
field. Please note that auto-define can be triggered only on top of network that
is not marked as external.</p>

<p><img src="../../../../images/wiki/auto-define_create.png" alt="Creation of physical network" title="New physical network" /></p>

<p>After confirmation if all conditions were met, the external network connected to 
the physical one, will be created simultaneously. The auto-defined external 
network is named <code class="language-plaintext highlighter-rouge">external_name_of_physical_network</code> (The physical network name
might be shortened so that auto-defined network name is not bigger than 256 
characters).</p>

<p><img src="../../../../images/wiki/auto-define_created.png" alt="Auto-define network created" title="Auto-define external network" /></p>

<p>In case there are clusters with different default external providers in the data 
center the Engine will create multiple external networks for every provider and 
add a number behind to this auto-defined network name.</p>

<p>Please note that all hosts running VMs connected to the external network has
to be attached to the physical network.</p>

<h2 id="implementation">Implementation</h2>

<h3 id="engine">Engine</h3>

<ul>
  <li>
    <p>A new query <code class="language-plaintext highlighter-rouge">GetAllVmNetworksByClusterId</code> that returns only VM networks is 
added. For Cluster with OvS switch type, this query returns only external 
networks.</p>
  </li>
  <li>
    <p>Validations for all limited operations with auto-defined external network and 
its linked physical network. According to <a href="#limitations">Autodefine External Network - Limitations</a></p>
  </li>
  <li>
    <p>Added new command <code class="language-plaintext highlighter-rouge">AutodefineExternalNetwork</code>. This command is 
triggered every time a new network is created. The command validates the 
incoming network and its parameters. Then it finds all clusters with OvS 
switch type attached to incoming network and clusters external providers.
The command continues with creating new external network and connecting it to 
the incoming physical network and attaching to clusters. The command might 
create multiple external networks, one for each external provider in the data 
center. The command will automatically create vNIC profile, with permissions
given only to the user that created the physical network.</p>
  </li>
  <li>
    <p>Added new function <code class="language-plaintext highlighter-rouge">getAllExternalNetworksLinkedToPhysicalNetwork</code> into 
<code class="language-plaintext highlighter-rouge">NetworkDao</code> which returns list of all external networks linked to provided
physical network.</p>
  </li>
</ul>

<h2 id="testing">Testing</h2>

<p>Testing should cover:</p>

<ul>
  <li>
    <p>Addition/Removal new physical network.</p>
  </li>
  <li>
    <p>Physical network linked to external network cannot be 
removed.</p>
  </li>
  <li>
    <p>Only external networks can be used for VM interfaces.</p>
  </li>
  <li>
    <p>Cluster switch type cannot be updated to OvS for existing cluster.</p>
  </li>
  <li>
    <p>VMs cannot be scheduled on hosts without attached physical network linked to 
auto-define network.</p>
  </li>
  <li>
    <p>Interface cannot be hotplugged onto a VM that runs on host that is not 
attached to physical network which is linked to auto-define network.</p>
  </li>
</ul>



        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2989/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2989/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2989/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2989/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/network/autodefine-external-network.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/network/autodefine-external-network.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
