<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Attach shared Storage Domains to a local DC. | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Attach shared Storage Domains to a local DC." />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3048/develop/release-management/features/storage/sharedStorageDomainsAttachedToLocalDC.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3048/develop/release-management/features/storage/sharedStorageDomainsAttachedToLocalDC.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Attach shared Storage Domains to a local DC." />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Attach shared Storage Domains to a local DC.","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3048/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3048/develop/release-management/features/storage/sharedStorageDomainsAttachedToLocalDC.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3048/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3048/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3048/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3048/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3048/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3048/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3048/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3048/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3048/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3048/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3048/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3048/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3048/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3048/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3048/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3048/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3048/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3048/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3048/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3048/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3048/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3048/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3048//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3048//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3048/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3048/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3048/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3048/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3048/develop/release-management/features/storage/">
              <span property="name">Storage</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Maor Lipchuk">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Maor Lipchuk</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3048/documentation/'>Documentation is available here.</a></div>

<h1 id="attach-shared-storage-domains-to-a-local-dc">Attach shared Storage Domains to a local DC.</h1>

<h2 id="overview">Overview</h2>

<p>With the ability to attach and detach a data domain (introduced in 3.5), data domains became a better option for moving VMs/Templates around than an export domain.
In order to gain this ability in local DCs, it should be possible to attach a Storage Domain of a shared type to that DC.
This feature essentially re-defines a local DC as a DC that’s allowed to have just one host, bringing it closer to the general DC concept.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: <a href="https://github.com/maorlipchuk">Maor Lipchuk</a></li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>As part of this feature the user will now have the ability to change an initialized Data Center type (Local vs Shared).
The following updates will be available:</p>
<ol>
  <li>Shared to Local - Only for a Data Center that does not contain more than one Host and more than one cluster, since local Data Center does not support it.
The engine should validate and block this operation with the following messages:
    <ul>
      <li>CLUSTER_CANNOT_ADD_MORE_THEN_ONE_HOST_TO_LOCAL_STORAGE</li>
      <li>VDS_CANNOT_ADD_MORE_THEN_ONE_HOST_TO_LOCAL_STORAGE</li>
    </ul>
  </li>
  <li>Local to Shared - Only for a Data Center that does not contain a local Storage Domain.
The engine should validate and block this operation with the following message ERROR_CANNOT_CHANGE_STORAGE_POOL_TYPE_WITH_LOCAL.</li>
</ol>

<h3 id="functionality">Functionality</h3>

<h4 id="detach-shared-storage-domain-from-local-data-center">Detach shared Storage Domain from local Data Center</h4>
<p>Removing a local DC used to format the master domain attached to it since local SDs can not be detached.
Shared SDs behave differently, since those can be detached.
Based on that, if a local DC will be removed the master Storage Domain will be formatted only if it is a local SD (to keep the previous behaviour) and if it is a shared SD then this Storage Domain will only be detached.</p>

<h4 id="memory-volume-placement">Memory volume placement</h4>
<p>When selecting a Storage Domain to place memory volumes, there are currently three comparators that choose the target Storage Domain:</p>
<ol>
  <li>The number of the VM’s disks in the Storage Domain - prefer the Storage Domain where the VM has the most disks</li>
  <li>Storage type - prefer file storage over block storage</li>
  <li>Free space - prefer Storage Domains with more free space</li>
</ol>

<p>To improve resiliency, shared Storage Domains will be preferable over local Storage Domain as the second criteria (i.e., between the current [1] and [2]).</p>

<h4 id="re-initialize-data-center">Re-Initialize Data Center</h4>
<p>Re-Initialize master should prefer shared domains over local domains
When electing a new master, reconstruction is attempted according to an ascending order of the last time a domain was used as a master (see org.ovirt.engine.core.bll.storage.domain.StorageDomainCommandBase#electNewMaster(boolean, boolean, boolean)).</p>

<p>In a DC that contains both shared and local domains (see bug 1302185), we should add a secondary criteria to prefer shared domains over local domains for resiliency considerations.</p>

<h3 id="ui">UI</h3>

<p>When attaching a shared SD from Data Centers -&gt; Storage sub tab, local Data Centers should now be part of the optional attachable Data Centers (among shared Data Centers).
Same for attaching a Storage Domain from the Data Center main tab, shared Storage Domains should be candidates for attach to a local Data Center.</p>

<h3 id="bugzilla">Bugzilla</h3>

<p>https://bugzilla.redhat.com/show_bug.cgi?id=1353137 - Memory volume placement should prefer shared to local domains
https://bugzilla.redhat.com/show_bug.cgi?id=1353134 - Reconstructing master should prefer shared domains over local domains
https://bugzilla.redhat.com/show_bug.cgi?id=1309212 - Allow changing DC type from local to shared and vice versa
https://bugzilla.redhat.com/show_bug.cgi?id=1302185 - [RFE] Allow attaching shared storage domains to a local DC</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3048/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3048/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3048/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3048/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/storage/sharedStorageDomainsAttachedToLocalDC.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/storage/sharedStorageDomainsAttachedToLocalDC.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
