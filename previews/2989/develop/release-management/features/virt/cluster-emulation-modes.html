<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Cluster emulation modes | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Cluster emulation modes" />
<meta name="author" content="Omer Frenkel" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/virt/cluster-emulation-modes.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/virt/cluster-emulation-modes.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Cluster emulation modes" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Omer Frenkel" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Omer Frenkel"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Cluster emulation modes","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/2989/images/logo.svg"},"name":"Omer Frenkel"},"url":"https://ovirt.github.io/ovirt-site/previews/2989/develop/release-management/features/virt/cluster-emulation-modes.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/2989/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/2989/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/2989/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/2989/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/2989/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/2989/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/2989/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/2989/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/2989/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/2989/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/2989/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/2989//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/2989/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/b1766f2c8efbe055218f5ccdae3bc8da?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/b1766f2c8efbe055218f5ccdae3bc8da?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Omer Frenkel">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Omer Frenkel</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Roy Golan">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Roy Golan</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sandro Bonazzola">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"><a rel="author" href="https://twitter.com/sandrobonazzola" title="Sandro Bonazzola">Sandro Bonazzola</a></span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/2989/documentation/'>Documentation is available here.</a></div>

<h1 id="cluster-emulation-mode">Cluster emulation mode</h1>

<h2 id="summary">Summary</h2>

<p>This feature will enable per cluster emulation mode. EmulatedMachine is a property passed to QEMU as -M flag and Instead of a system-wide config value
A cluster could have a specific value which all host must comply to. If the cluster has no value set, the first host that is active
must comply to a configurable list of values and then set it thereafter.</p>

<h2 id="owner">Owner</h2>

<ul>
  <li>Name: Roy Golan (rgolan)</li>
  <li>Email: <a href="mailto:rgolan@redhat.com">rgolan@redhat.com</a></li>
</ul>

<h2 id="current-status">Current status</h2>

<ul>
  <li>Implementation is done. Review phase. See <a href="http://gerrit.ovirt.org/#/q/status:open+project:ovirt-engine+branch:master+topic:cluster_emulation_modes,n,z">http://gerrit.ovirt.org/#/q/status:open+project:ovirt-engine+branch:master+topic:cluster_emulation_modes,n,z</a></li>
  <li>Last updated: ,</li>
  <li>Target Release: 3.3</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>We want to keep the cluster homogeneous but be able to have different types cross-cluster i.e one cluster to be RHELs and another to be Fedora based.
to achieve that we need a config value, per version with a list of supported emulation types, order by priority:</p>

<h3 id="new-config-value">New Config value</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ClusterEmulationModes(3.0,"rhel6.2.0, pc-1.0")
  ClusterEmulationModes(3.1,"rhel6.3.0, pc-1.0")
  ClusterEmulationModes(3.2,"rhel6.4.0, pc-1.0")
  ClusterEmulationModes(3.3,"rhel6.4.0, pc-1.0")
</code></pre></div></div>

<h3 id="new-host-field">New Host field</h3>

<p>new “supportedEmulatedMachines” field will be added to VDS entitu and vds_dynamic table.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  VDS.supportedEmulatedMachines
  vds_dynamic.supported_emulated_machines
</code></pre></div></div>

<h3 id="new-cluster-field">New Cluster field</h3>

<p>A cluster entity will be added by a new field - emulatedMachine.
 vds_group.emulated_machine default NULL varchar(255) The default is NULL which means the value would be set once a host during the first refresh would have
its reported emulatedMachines list match against the Config Value</p>

<h3 id="new-non_operational-reason">New NON_OPERATIONAL reason</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  NonOperationalReason
   ...,
  EMULATED_MACHINES_INCOMPATIBLE_WITH_CLUSTER ;
</code></pre></div></div>

<p>This new REASON if for host which can’t join the cluster becuase they
don’t comply with the Config ClusterEmulatedMachines or the clusters
emulatedMachine field which is a subset of the config.</p>

<h3 id="handlevdscpuflagsorclusterchangedcommand">HandleVdsCpuFlagsOrClusterChangedCommand</h3>

<p>This commands will match an activated Host against the cluster definition.
If the cluster definition is null then the host will be matched against the config values.
That match will set the cluster definition for the rest of the hosts in that cluster
 consider this pseudo-code:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  operational = false 
  if cluster.emulationMode == NULL
   for configVal in Config.ClusterEmulationMode(3.3)
      if configVal in host.emulationModes 
          cluster.emulationMode = configVal
          operational = true
   else if clusterEmulationMode in host.emulationMode
         operational = true
  if (!operational)
      set host non operationl, reason = EMULATED_MACHINES_INCOMPATIBLE_WITH_CLUSTER
</code></pre></div></div>

<h3 id="run-vm">Run VM</h3>

<p>The OVFs emulatedMachine property will be populated by the cluster’s emulatedMachine field and not by the global config value, which will be deleted as it is not relevant any more</p>

<h3 id="new-ui-subtab-field-readonly">New UI subtab field (readonly)</h3>

<p>TODO A sketch of cluster subtab</p>

<h2 id="benefit-to-ovirt">Benefit to oVirt</h2>

<h2 id="documentation--external-references">Documentation / External references</h2>

<p>Please see <a href="https://bugzilla.redhat.com/show_bug.cgi?id=927874">https://bugzilla.redhat.com/show_bug.cgi?id=927874</a></p>

<h2 id="testing">Testing</h2>

<ul>
  <li>Test case: <strong>Vm start up - A cluster of fedora nodes and cluster of RHEL6 should be both supported out of the box</strong>
    <ul>
      <li>setup:</li>
    </ul>
  </li>
</ul>

<p>Cluster “f” has 1 fedora host, compat version 3.3</p>

<p>Cluster “R” has 1 RHEL6 host. compat version 3.3</p>

<p>DB config values for clusterEmulationMode = “el6,pc-1.0” version 3.3</p>

<ul>
  <li>
    <ul>
      <li>test:</li>
    </ul>
  </li>
</ul>

<p>create a VM on each cluster and start it</p>

<ul>
  <li>
    <ul>
      <li>expected result:</li>
    </ul>
  </li>
</ul>

<p>A vm is able to start on each of the clusters.</p>

<ul>
  <li>Test case: <strong>Host with unsupported emulation mode goes NON-OPERATIONAL with reason UNSUPPORTED_EMULATION_MODE</strong>
    <ul>
      <li>setup:</li>
    </ul>
  </li>
</ul>

<p>use the same setup as the former case</p>

<ul>
  <li>
    <ul>
      <li>test:</li>
    </ul>
  </li>
</ul>

<p>add a RHEL6 node to cluster “f”</p>

<ul>
  <li>
    <ul>
      <li>expected result:</li>
    </ul>
  </li>
</ul>

<p>host should go NON_OPERATIONAL with reason UNSUPPORTED_EMULATION_MODE</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/2989/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/2989/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/2989/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/2989/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/cluster-emulation-modes.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/master/source/develop/release-management/features/virt/cluster-emulation-modes.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
