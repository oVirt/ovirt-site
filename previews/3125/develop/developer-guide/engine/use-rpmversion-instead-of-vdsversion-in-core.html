<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Use RpmVersion instead of VdsVersion in core | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Use RpmVersion instead of VdsVersion in core" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3125/develop/developer-guide/engine/use-rpmversion-instead-of-vdsversion-in-core.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3125/develop/developer-guide/engine/use-rpmversion-instead-of-vdsversion-in-core.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Use RpmVersion instead of VdsVersion in core" />
<meta name="twitter:site" content="@ovirt" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Use RpmVersion instead of VdsVersion in core","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3125/images/logo.svg"}},"url":"https://ovirt.github.io/ovirt-site/previews/3125/develop/developer-guide/engine/use-rpmversion-instead-of-vdsversion-in-core.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3125/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3125/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3125/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3125/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3125/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3125/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3125/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3125/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3125/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3125/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3125/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3125//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/developer-guide/">
              <span property="name">Developer Guide</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3125/develop/developer-guide/engine/">
              <span property="name">Engine</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/d75560fd509444e4cbc70734dffa0673?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/d75560fd509444e4cbc70734dffa0673?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Eli Mesika">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Eli Mesika</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          
<h1 id="use-rpmversion-instead-of-vdsversion-in-core">Use RpmVersion instead of VdsVersion in core</h1>

<h2 id="overview">Overview</h2>

<p>Currently we have 3 version classes in oVirt core code:
a. Version (used for compatiblity level)
b. VdsVersion (reports VDS version)
c. RpmVersion (extends Version)
 The VdsVersion is an old code that is no longer relevant to oVirt 3.1 This document describes the steps required to depricate VdsVersion and use RpmVersion instead.</p>

<p>The requirement is that we use from now on RpmVersion (including when clients display the host version)
 It seems that the version is stored correctly in the database and only manipulated by the oVirt code code and clients code. So, no database upgrade is required.</p>

<h3 id="plan">Plan</h3>

<p>1) currently the vdsm version is stored in the vds_dynamic table, since this information is static, it should be moved first to vds_static.
2) Change VDS getVersion to return RpmVersion.
3) Clients should use RpmVersion.getValue to display the version in Host General Tab and in About box.
4) Clients currently have code that checks for available hosts according to compatability version [1], we will have to remove that code and supply backend queries to get this information. This will enforce the logic to be in the backend and not beeing multiplied by clients.
5) We will have to see how GWT supports RpmVersion since GWT regex is based on our compat regex and not on java.util.regex.
6) Remove VdsVersion.
7) Add/Change relevant tests.</p>

<h3 id="tests">Tests</h3>

<p>We should make sure 3.0 clusters continue working including ovirt-nodes
Test that all clients gets and displays version correctly.
All BLL/DAO tests should pass</p>

<h3 id="risks">Risks</h3>

<p>Since the change may lead to backward comatability issues, this change will require an intensive pre-integration effort.</p>

<p>[1] For example ; ClusterGuideModel.java</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   for (VDS vds : allHosts)
   {
      if ((!Linq.IsHostBelongsToAnyOfClusters(clusters, vds))
           &amp;&amp; (vds.getstatus() == VDSStatus.Maintenance || vds.getstatus() == VDSStatus.PendingApproval)
           &amp;&amp; (vds.getVersion().getFullVersion() == null || Extensions.GetFriendlyVersion(vds.getVersion()
             .getFullVersion()).compareTo(minimalClusterVersion) &gt;= 0))
         {
            availableHosts.add(vds);
         }
   }
</code></pre></div></div>

<p>All of the above is actually business logic code that must be dove in oVirt code code.</p>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3125/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3125/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3125/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3125/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/developer-guide/engine/use-rpmversion-instead-of-vdsversion-in-core.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/developer-guide/engine/use-rpmversion-instead-of-vdsversion-in-core.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
