<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Gluster Volume Capacity | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Gluster Volume Capacity" />
<meta name="author" content="Anmol" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3026/develop/release-management/features/gluster/gluster-volume-capacity.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3026/develop/release-management/features/gluster/gluster-volume-capacity.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gluster Volume Capacity" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Anmol" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Anmol"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"Gluster Volume Capacity","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3026/images/logo.svg"},"name":"Anmol"},"url":"https://ovirt.github.io/ovirt-site/previews/3026/develop/release-management/features/gluster/gluster-volume-capacity.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3026/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3026/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3026/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3026/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3026/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3026/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3026/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3026/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3026/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3026/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3026/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3026/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3026/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3026/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3026/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3026/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3026/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3026/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3026/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3026/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3026/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3026/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3026//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3026//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3026/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3026/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3026/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3026/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3026/develop/release-management/features/gluster/">
              <span property="name">Gluster</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c84a93cea154156669002c83a39ff7e2?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c84a93cea154156669002c83a39ff7e2?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Anmol">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Anmol</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/c375d2a16de823ba0f5ca7e4e11ad929?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/c375d2a16de823ba0f5ca7e4e11ad929?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ramesh N">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ramesh N</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/450b77aa4b277aa954e42c0cbaed64f1?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sahina Bose">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Sahina Bose</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/393519c4c5d345f038570fa4a3849d85?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/393519c4c5d345f038570fa4a3849d85?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Shubhendu Tripathi">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Shubhendu Tripathi</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3026/documentation/'>Documentation is available here.</a></div>

<h1 id="gluster-volume-capacity">Gluster Volume Capacity</h1>

<h2 id="summary">Summary</h2>

<p>A gluster storage administrator would like to view the capacity information (total , used and free) on a volume. This feature provides support for that.</p>

<h2 id="owner">Owner</h2>

<h2 id="current-status">Current Status</h2>

<ul>
  <li>Status: Completed</li>
  <li>Available in: oVirt 3.5</li>
  <li>Last updated date: ,</li>
</ul>

<h2 id="detailed-description">Detailed Description</h2>

<p>This feature helps the user to know the volume capacity information. Capacity information will be shown in the Volumes tab and it will be updated in background by the Ovirt Engine.</p>

<h2 id="dependencies--related-features">Dependencies / Related Features</h2>

<h2 id="user-flows">User Flows</h2>

<p>To view Gluster Volume Capacity, User goes to “Volumes” tab where capacity information will be displayed as part of each volume row. A new column ‘Space Used’ will be shown just before the ‘Activities’ column. Capacity information will be shown as progress bar with percentage of usage and a refresh icon to refresh the detail.On hovering the refresh icon user can get information about when the last update was made.</p>

<p><img src="/ovirt-site/previews/3026/images/wiki/VolumeCapacity.png" alt="" /></p>

<p>The brick capacities are listed in the “Bricks” sub tab of the “Volumes” tab.User can click on a specific volume and view the capacities of its bricks in the “Bricks” sub tab.On refreshing the volume capacity in the volume tab by clicking on the clock icon in the volume tab,the bricks capacities are also refreshed.Details such as the progress bar containing the brick usage percentage are shown across each brick in the selected volume.</p>

<p><img src="/ovirt-site/previews/3026/images/wiki/VolumeBrickCapacity.png" alt="" /></p>

<h2 id="getting-the-volume-capacity-details">Getting the volume capacity details</h2>

<p>Volume capacity information will be fetched by GlusterSyncJob as part of getting Volume advanced details. ‘glusterVolumeStatus’ VDSM verb will be enhanced to get the capacity information as part of volume status. Capacity information will be fetched when ‘detail’ options is passed. Internally VDSM can use any of the following ways to determine the capacity information.</p>

<h3 id="using-libgfapi">Using libgfapi</h3>

<p>In this approach VDSM uses the APIs from libgfapi to get the details of a gluster volume. There are certain issues with the said API and not opting for using this option.</p>

<h3 id="by-mounting-the-volume-and-running-df-command">By mounting the volume and running “df” command</h3>

<p>In this approach VDSM mounts the gluster volume first and then uses the “df” command to get the volume capacity details. This approach is bit expensive but foolproof. Opted to use this approach and go ahead.</p>

<h3 id="by-collating-details-from-advanced-volume-details">By collating details from advanced volume details</h3>

<p>In this approach VDSM needs to collate the details from advanced details of the volume and populate the capacity details. This approach would be light weight. Planning to migrate to this approach at later stage as more details like raw capacity for volumes, bricks etc. are required.</p>

<h2 id="detailed-design">Detailed Design</h2>

<h3 id="entities">Entities</h3>

<h4 id="gluster_volumes">Gluster_Volumes</h4>

<p>Following three columns will be added to gluster_volumes table.</p>

<table>
  <thead>
    <tr>
      <th>Column</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>totalSize</td>
      <td>long</td>
      <td>total volume size</td>
    </tr>
    <tr>
      <td>freeSize</td>
      <td>long</td>
      <td>free volume size</td>
    </tr>
    <tr>
      <td>usedSize</td>
      <td>long</td>
      <td>used volume size</td>
    </tr>
  </tbody>
</table>

<h4 id="glustervolumesizeinfo">GlusterVolumeSizeInfo</h4>

<p>A new entity GlusterVolumeSizeInfo will be added to GlusterVolumeEntity.</p>

<table>
  <thead>
    <tr>
      <th>Column</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>volumeId</td>
      <td>GUID</td>
      <td>respective gluster volume id</td>
    </tr>
    <tr>
      <td>volumeName</td>
      <td>String</td>
      <td>Volume Name</td>
    </tr>
    <tr>
      <td>totalSize</td>
      <td>long</td>
      <td>total volume size</td>
    </tr>
    <tr>
      <td>freeSize</td>
      <td>long</td>
      <td>free volume size</td>
    </tr>
    <tr>
      <td>usedSize</td>
      <td>long</td>
      <td>used volume size</td>
    </tr>
    <tr>
      <td>updatedAt</td>
      <td>Date</td>
      <td>Capacity Info Lasted updated at</td>
    </tr>
  </tbody>
</table>

<h3 id="query">Query</h3>

<h4 id="getglustervolumesizeinfoquery">GetGlusterVolumeSizeInfoQuery</h4>

<p>Makes a call to Gluster and get the volume capacity details. The details are returned into an instance of GlusterVolumeSizeInfo.</p>

<h3 id="rest-api">REST API</h3>

<ul>
  <li>
    <p>Add statistics GET action on the gluster volume resource</p>

    <p>/api/clusters/{cluster-id}/glustervolumes/{volume-id}/statistics</p>
  </li>
</ul>

<p>This will return the volume capacity details. The details listed under volume capacity details would be -</p>

<ul>
  <li>Free Size</li>
  <li>Used Size</li>
  <li>Total Size</li>
</ul>

<p>The output format would look like -</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;statistics&gt;
    &lt;statistic id="{id}"&gt;
        &lt;name&gt;memory.total.size&lt;/name&gt;
        &lt;description&gt;Total size&lt;/description&gt;
        &lt;values type="INTEGER"&gt;
            &lt;value&gt;
                &lt;datum&gt;{value}&lt;/datum&gt;
            &lt;/value&gt;
        &lt;/values&gt;
        &lt;type&gt;GAUGE&lt;/type&gt;
        &lt;unit&gt;BYTES&lt;/unit&gt;
        &lt;gluster_volume href="/ovirt-site/previews/3026/ovirt-engine/api/clusters/{cluster-id}/glustervolumes/{volume-id}" id="{volume-id}"/&gt;
    &lt;/statistic&gt;
    &lt;statistic id="{id}"&gt;
        &lt;name&gt;memory.free.size&lt;/name&gt;
        &lt;description&gt;Free size&lt;/description&gt;
        &lt;values type="INTEGER"&gt;
            &lt;value&gt;
                &lt;datum&gt;{value}&lt;/datum&gt;
            &lt;/value&gt;
        &lt;/values&gt;
        &lt;type&gt;GAUGE&lt;/type&gt;
        &lt;unit&gt;BYTES&lt;/unit&gt;
        &lt;gluster_volume href="/ovirt-site/previews/3026/ovirt-engine/api/clusters/{cluster-id}/glustervolumes/{volume-id}" id="{volume-id}"/&gt;
    &lt;/statistic&gt;
    &lt;statistic id="{id}"&gt;
        &lt;name&gt;memory.used.size&lt;/name&gt;
        &lt;description&gt;Used size&lt;/description&gt;
        &lt;values type="INTEGER"&gt;
            &lt;value&gt;
                &lt;datum&gt;{value}&lt;/datum&gt;
            &lt;/value&gt;
        &lt;/values&gt;
        &lt;type&gt;GAUGE&lt;/type&gt;
        &lt;unit&gt;BYTES&lt;/unit&gt;
        &lt;gluster_volume href="/ovirt-site/previews/3026/ovirt-engine/api/clusters/{cluster-id}/glustervolumes/{volume-id}" id="{volume-id}"/&gt;
    &lt;/statistic&gt;
&lt;/statistics&gt; 
</code></pre></div></div>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3026/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3026/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3026/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3026/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2022 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/gluster/gluster-volume-capacity.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/gluster/gluster-volume-capacity.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
