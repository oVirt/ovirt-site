<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>OS info | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="OS info" />
<meta name="author" content="Maor Lipchuk" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3117/develop/release-management/features/virt/os-info.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3117/develop/release-management/features/virt/os-info.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="OS info" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Maor Lipchuk" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Maor Lipchuk"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"OS info","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3117/images/logo.svg"},"name":"Maor Lipchuk"},"url":"https://ovirt.github.io/ovirt-site/previews/3117/develop/release-management/features/virt/os-info.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3117/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3117/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3117/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3117/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3117/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3117/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3117/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3117/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3117/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3117/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3117/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3117/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3117/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3117/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3117/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3117/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3117/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3117/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3117/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3117/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3117/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3117/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3117//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3117//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3117/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3117/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3117/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3117/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3117/develop/release-management/features/virt/">
              <span property="name">Virt</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/db6bc448daa2b0b1315b0184bbcc9b77?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Maor Lipchuk">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Maor Lipchuk</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/6a6ee5db5d55d1918022cb4a22f64286?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Roy Golan">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Roy Golan</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/65fafd7adcef0c369b149759491fae7f?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Sandro Bonazzola">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard"><a rel="author" href="https://twitter.com/sandrobonazzola" title="Sandro Bonazzola">Sandro Bonazzola</a></span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3117/documentation/'>Documentation is available here.</a></div>

<h1 id="os-info">OS info</h1>

<h3 id="summary">Summary</h3>

<p>This feature enables ovirt to configure all its OS info in one place, out of the code, and in a way admins could extend it or easily configure it.
It aims to merge all configuration items from the Config (currently vdc_options table) and the VmOsType.java enum to one file-based repository.</p>

<h3 id="owner">Owner</h3>

<ul>
  <li>Name: Roy Golan (rgolan)</li>
  <li>Email: <a href="mailto:rgolan@redhat.com">rgolan@redhat.com</a></li>
</ul>

<h3 id="current-status">Current status</h3>

<ul>
  <li>WIP, patches submitted gerrit.ovirt.org/#/q/topic:osinfo,n,z. &gt;90% implemented and verified.last bits of searchengine integration</li>
  <li>Last updated: ,</li>
  <li>Target Release: 3.3</li>
</ul>

<h3 id="history">History</h3>

<p>Engine is keeping a <strong>VmOsType.java</strong> enum to list some of the OS capabilities such as 64 bit support. other capabilities are kept in the DB as lists, based upon
the enum member name. examples:
There’s a general config value for min/max memory to use for all OSs.
sound card to attach to vm is a config value - Config.desktopAudioDeviceType=default,ich6,windowsXP,ac97 UI and REST has a static traslation beased on the enum members
UI builds a the image icon url based on the names as well. list goes on with config values per windows os product key, sysprep file path and so on
=== current implementation downsides === while our state is static for we compile and rely on the VmOsType members, its not extendible, its hard-coded, and config values must compy with the hard-coded names.</p>

<h2 id="new-design">New Design</h2>

<h3 id="file-based-configuration">File based configuration</h3>

<p>oVirt will keep its own repository of OS configuration, in a properties file format, under <strong>$ENGINE_USR</strong> which and that could be extended in <strong>$ENGINE_ETC</strong>. Engine will load all files sorted by name, to supply defaults and a way to override them.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  $ENGINE_USR/conf/osinfo-default.properties
  $ENGINE_ETC/conf/osinfo.conf.d/00-osinfo.properties  &lt;-- a symlink to osinfo-default.properties
</code></pre></div></div>

<p>The format is key=value and have several features:</p>

<h4 id="value-versions">Value versions</h4>

<p>values can be different per compatibility versions;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    os.rhel6.key.value = foo                           // a general version value
    os.rhel6.key.value.version.3.2 = bar     // 3.2 compatibility version value
</code></pre></div></div>

<h4 id="value-overriding">value overriding</h4>

<p>Supports versions of configuration through file prefix e.g - all or some entries in this file can be overridden by entries in 10-osinfo.properties</p>

<h4 id="inheritance">Inheritance</h4>

<p>Specify the ‘derivedFrom’ key and the os id to inherit all its values except id.</p>

<h4 id="i18n">I18N</h4>

<p>This file is also loaded as a String Bundle so name and description can contain non-ASCII values. This file is the default en-us locale while loading 10-osinfo_he-il.properties will contain Hebrew locale values e.g os.linux.name.value = לינוקס</p>

<p>snip from <strong>osinfo-defaults.properties</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  os.default.id.value = 0
  # name is I18N if the one creates a 01-os_${LOCALE}.properties with the co-responding name property
  os.default.name.value = default OS
  # OS family values: Linux/Windows/Other
  os.default.family.value = Other
  # CPU architecture (*not* the bus width 64/32 bit). Currently only x86 is supported
  # but ppc7 is a work in progress and possibly arm someday as well
  os.default.cpuArchitecture.value = x86
  os.default.bus.value = 32
  os.default.resources.minimum.ram.value = 256
  os.default.resources.maximum.ram.value = 64000
  os.default.resources.minimum.disksize.value = 1
  os.default.resources.minimum.numberOsCpus.value = 1
  os.default.spiceSupport.value = true

  os.default_64.derivedFrom.value = default
  os.default_64.bus.value = 64
</code></pre></div></div>

<h3 id="engines-os-repository">Engine’s Os Repository</h3>

<p>On engine startup, engine will seek the <strong>@ENGINE_ETC</strong> dir and will load by order all <strong>*.properties</strong> file under <strong>conf/osinfo.conf.d</strong>.
The properties will be kept in an internal tree so its easy to walk it for values, parent values and values with compatibility version
All components besides UI can get an instance of <strong>OsRepositoryImpl</strong> or indirectly query it by a backend VDC Query- <strong>OsRepositoryQuery</strong>
FUTURE: serialize the OsRepository to the UI instead of a exposing pats of it in a query? - had significant hard time with GWT to serialize the OsRepository to the UI
due to my usage of <em>java.util.prefs.Preferences</em>.</p>

<p>OsRepository interface;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    /**
    * Interface for accessing all Virtual OSs information.
    */
    public interface OsRepository {
     /**
      * @return all loaded os ids
      */
     public ArrayList`&lt;Integer&gt;` getOsIds();
     /**
      * @return map of osId to the the os name
      */
     public HashMap`&lt;Integer, String&gt;` getOsNames();
     public String getOsName(int osId);
     /**
      * OS families are basically windows,linux and other.
      * @param osId
      * @return
      */
     public String getOsFamily(int osId);
     /**
      * @return a list of OSs who's {@link OsRepository#getOsFamily(int)} returns "linux"
      */
     public ArrayList`&lt;Integer&gt;` getLinuxOSs();
     public ArrayList`&lt;Integer&gt;` get64bitOss();
     /**
      * @return a list of OSs who's {@link OsRepository#getOsFamily(int)} returns "windows"
      */
     public ArrayList`&lt;Integer&gt;` getWindowsOss();
     /**
      * @return minimum RAM in mb
      */
     public int getMinimumRam(int osId, Version version);
     /**
      * @return maximum RAM in mb
      */
     public int getMaximumRam(int osId, Version version);
     /**
      * @return if that OS could be connected with SPICE
      */
     public boolean hasSpiceSupport(int osId, Version version);
     /**
      * this is Windows OSs specific path to the sysprep file
      * @param osId
      * @param version
      * @return
      */
     public String getSysprepPath(int osId, Version version);
     /**
      * this Windows OSs specific product key
      * @param osId
      * @param version
      * @return
      */
     public String getProductKey(int osId, Version version);
     /**
      * a convenience method the for  family type "linux"
      * @param osId
      * @return
      */
     public boolean isLinux(int osId);
     /**
      * a convenience method the for  family type "windows"
      * @param osId
      * @return
      */
     public boolean isWindows(int osId);
     /**
      * @param osId
      * @return list of supported network devices
      */
     ArrayList`&lt;String&gt;` getNetworkDevices(int osId, Version version);
     /**
      * @param osId
      * @param version
      * @return a specific sound device for the given os.
      */
     String getSoundDevice(int osId, Version version);
     /**
      * early windows versions require a numeric identifier for sysprep to tell
      * the timezone. In later versions this was rectified and they use a universal name.
      * @param osId
      * @param version
      * @return
      */
     boolean isTimezoneValueInteger(int osId, Version version);
</code></pre></div></div>

<h3 id="integration-with-other-info-providers">Integration with other info providers</h3>

<p>As the info is kept as a properties, its very easy to dump external sources such as libosinfo to oVirt’s format. Using libosinfo python bindings a simple script could be used to dump properties to <strong>$ENGINE_ETC</strong> dir. <em>FUTURE</em>: supply a python script which will harvest libosinfo db and convert it to our properties format</p>

<h3 id="benefit-to-ovirt">Benefit to oVirt</h3>

<p>Richer information base of OSs. Easily extended by admins using scripts/manual editing, making oVirt more configurable and extendible.</p>

<h3 id="dependencies--related-features">Dependencies / Related Features</h3>

<p>Other Host architecture such as <strong>PPC</strong> [1] could be added more easily as now the Os Repository can have distinction based on architecture type. Combine this with adding a new cluster architecture flag and OSs can be filtered exclusively to fit the virtualization constraints. e.g <strong>PPC</strong> supported OSs may have specific driver support which doesn’t comply with x86. By getting all OSs which are ppc architecture, we can specify their supported device list:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  os.RHEL6.architecture = ppc
  os.RHEL6.devices.network = DEVICE_A, DEVICE_B    //list of network devices which are supported by PPC type host.
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>[1] [support for PPC 64 bit](/Features/Engine_support_for_PPC64</td>
      <td>Engine)</td>
    </tr>
  </tbody>
</table>

<h3 id="testing">Testing</h3>

<table>
  <thead>
    <tr>
      <th>Test case</th>
      <th>setup</th>
      <th>expected</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1. *.properties files are loaded by order</td>
      <td>place 20-overload.properties under /etc/ovirt-engine/osinfo.conf.d</td>
      <td>check the logs record for loading and see values from the files are effective. Non *.properties files are not loaded.</td>
    </tr>
    <tr>
      <td>2. Minimum memory is enforced</td>
      <td>add new vm, provision memory lower than 256mb and hit OK</td>
      <td>you get a canDo action with the range of allowed values</td>
    </tr>
    <tr>
      <td>3. Override os.Other.resources.minimum.ram.value to 1024</td>
      <td>place a 20-overrload.properties with os.Other.resources.minimum.ram.value=1024 under /etc/ovirt-engine/osinfo.conf.d. Restart Jboss</td>
      <td>repeat test case #2. values lower than 1024 should fail.</td>
    </tr>
    <tr>
      <td>4. Version value are effective</td>
      <td>append to 20-overrload.properties with os.other.resources.minimum.ram.value.3.3=2042 . Restart Jboss</td>
      <td>repeat test case #3 . values lower than 2042 should fail for VMs on cluster level 3.3.</td>
    </tr>
    <tr>
      <td>5. Add new os</td>
      <td>append to 20-overload.properties</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                                                        ` os.osx_10_6.id.value = 3000`                                                                                                       
                                                        ` os.osx_10_6.name.value = Snow Leopard`                                                                                             
                                                        ` os.osx_10_6.derivedFrom.value = linux`                                                                                             

                                                        Restart jboss                                                                                                                        | Edit a current VM and change its os to "Snow Leopard". Test case #2 should pass.                                      |
</code></pre></div></div>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3117/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3117/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3117/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3117/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/virt/os-info.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/virt/os-info.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
