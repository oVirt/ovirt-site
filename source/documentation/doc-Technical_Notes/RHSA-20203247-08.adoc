= RHSA-2020:3247-08 Important: RHV Manager (ovirt-engine) 4.4 security, bug fix, and enhancement update

The bugs in this chapter are addressed by advisory RHSA-2020:3247-08. Further information about this advisory is available at https://access.redhat.com/errata/RHSA-2020:3247.

== apache-commons-configuration

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1798117[1798117]

Rebase of the apache-commons-configuration package to version 1.10. This update includes minor bug fixes and enhancements.
Apache release notes are available here: https://commons.apache.org/proper/commons-configuration/changes-report.html#a1.10




== apache-commons-digester

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1798114[1798114]

Rebase of the apache-commons-digester package to version 2.1.
This update is a minor release with new features.
Apache release notes are available here:
http://commons.apache.org/proper/commons-digester/commons-digester-2.1/RELEASE-NOTES.txt




== apache-sshd

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1796809[1796809]

The apache-sshd library is not bundled anymore in the rhvm-dependencies package.
The apache-sshd library is now packaged in its own rpm package.




== distribution

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1798127[1798127]

apache-commons-collections4 has been packaged for Red Hat Virtualization Manager consumption. The package is an extension of the Java Collections Framework.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1807047[1807047]

The m2crypto package has been built for use with the current version of RHV Manager. This package enables you to call OpenSSL functions from Python scripts.




== makeself

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1700867[1700867]

The amkeself package has been rebased to version: 2.4.0.
Highlights, important fixes, or notable enhancements:

* v2.3.0: Support for archive encryption via GPG or OpenSSL. Added LZO and LZ4 compression support. Options to set the packaging date and stop the umask from being overridden. Optionally ignore check for available disk space when extracting. New option to check for root permissions before extracting.
* v2.3.1: Various compatibility updates. Added unit tests for Travis CI in the GitHub repo. New --tar-extra, --untar-extra, --gpg-extra, --gpg-asymmetric-encrypt-sign options.
* v2.4.0: Added optional support for SHA256 archive integrity checksums.




== openstack-java-sdk

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1698009[1698009]

The openstack-java-sdk package has been rebased to version: 3.2.8. Highlights and notable enhancements: Refactored the package to use newer versions of these dependent libraries:

- Upgraded jackson to com.fasterxml version 2.9.x
- Upgraded commons-httpclient to org.apache.httpcomponents version 4.5




== ovirt-cockpit-sso

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1826248[1826248]

Previously, the 'Host console SSO' feature did not work with python3, which is the default python on RHEL 8. The code was initially written for Python2 and was not properly modified for Python3. The current release fixes this issue: The 'Host console SSO' feature works with Python3.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1701530[1701530]

Rebase package(s) to version: 0.1.2

With this update, the ovirt-cockpit-sso package supports RHEL 8.




== ovirt-engine

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1670102[1670102]

Previously, to get the Cinder Library (cinderlib), you had to install the OpenStack repository. The current release fixes this issue by providing a separate repository for cinderlib.

To enable the repository, enter:
----
$ dnf config-manager --set-enabled rhel-8-openstack-cinderlib-rpms
----

To install cinderlib, enter:
----
$ sudo dnf install python3-cinderlib
----




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1687345[1687345]

Previously, RHV Manager created live virtual machine snapshots synchronously. If creating the snapshot exceeded the timeout period (default 180 seconds), the operation failed. These failures tended to happen with virtual machines that had large memory loads or clusters that had slow storage speeds.

With this enhancement, the live snapshot operation is asynchronous and runs until it is complete, regardless of how long it takes.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1797316[1797316]

Upgrade package(s) to version: rhv-4.4.0-23

Highlights and important bug fixes: Enhancements to VM snapshots caused a regression due to inconsistencies between the VDSM and RHV Manager versions. This upgrade fixes the issue by synchronizing the RHV Manager version to match the VDSM version.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1806276[1806276]

Previously, the *ovirt-provider-ovn* network provider was non-functional on RHV 4.3.9 Hosted-Engine. This happened because, with FDP 20.A (bug 1791388), the OVS/OVN service no longer had the permissions to read the private SSL/TLS key file. The current release fixes this issue: It updates the private SSL/TLS key file permissions. OVS/OVN reads the key file and works as expected.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1821164[1821164]

While the RHV Manager is creating a virtual machine (VM) snapshot, it can time out and fail while trying to freeze the file system. If this happens, more than one VM can write data to the same logical volume and corrupt the data on it. In the current release, you can prevent this condition by configuring the Manager to freeze the VM's guest filesystems before creating a snapshot. To enable this behavior, run the engine-config tool and set the `LiveSnapshotPerformFreezeInEngine` key-value pair to `true`.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1829656[1829656]

Known issue: Unsubscribed RHVH hosts do not get package updates when you perform a 'Check for upgrade' operation. Instead, you get a 'no updates found' message. This happens because RHVH hosts that are not registered to Red Hat Subscription Management (RHSM) do not have repos enabled. Workaround: To get updates, register the RHVH host with Red Hat Subscription Management (RHSM).




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1325468[1325468]

After a high-availability virtual machine (HA VM) crashes, the RHV Manager tries to restart it indefinitely. At first, with a short delay between restarts. After a specified number of failed retries, the delay is longer.

Also, the Manager starts crashed HA VMs in order of priority, delaying lower-priority VMs until higher-priority VMs are 'Up.'

The current release adds new configuration options:

* `RetryToRunAutoStartVmShortIntervalInSeconds`, the short delay, in seconds. The default value is `30`.
* `RetryToRunAutoStartVmLongIntervalInSeconds`, the long delay, in seconds. The default value is `1800`, which equals 30 minutes.
* `NumOfTriesToRunFailedAutoStartVmInShortIntervals`, the number of restart tries with short delays before switching to long delays. The default value is `10` tries.
* `MaxTimeAutoStartBlockedOnPriority`, the maximum time, in minutes, before starting a lower-priority VM. The default value is `10` minutes.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1358501[1358501]

Network operations that span multiple hosts may take a long time. This enhancement shows you when these operations finish: It records start and end events in the Events Tab of the Administration Portal and engine.log.  If you use the Administration Portal to trigger the network operation, the portal also displays a pop-up notification when the operation is complete.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1547937[1547937]

This release adds a progress bar for the disk synchronization stage of Live Storage Migration.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1593800[1593800]

When creating a new MAC address pool, its ranges must not overlap with each other or with any ranges in existing MAC address pools.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1643886[1643886]

This update adds support for Hyper V enlightenment for Windows virtual machines on hosts running RHEL 8.2 with cluster compatibility level set to 4.4. Specifically, Windows virtual machines now support the following Hyper V functionality:

- reset
- vpindex
- runtime
- frequencies
- reenlightenment
- tlbflush




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1650505[1650505]

Previously, after increasing the cluster compatibility version of a cluster with virtual machines that had outstanding configuration changes, those changes were reverted. The current release fixes this issue. It applies both the outstanding configuration changes and the new cluster compatibility version to the virtual machines.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1651406[1651406]

The current release enables you to migrate a group of virtual machines (VMs) that are in positive enforcing affinity with each other.

* You can use the new checkbox in the Migrate VM dialog to migrate this type of affinity group.
* You can use the following REST API to migrate this type of affinity group: http://ovirt.github.io/ovirt-engine-api-model/4.4/#services/vm/methods/migrate/parameters/migrate_vms_in_affinity_closure.
* Putting a host into maintenance also migrates this type of affinity group.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1658101[1658101]

In this release, when updating a Virtual Machine using a REST API, not specifying the console value now means that the console state should not be changed. As a result, the console keeps its previous state.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1664479[1664479]

When you use the engine ("Master") to set the high-availability host running the engine virtual machine (VM) to maintenance mode, the ovirt-ha-agent migrates the engine VM to another host. Previously, in specific cases, such as when these VMs had an old compatibility version, this type of migration failed. The current release fixes this problem.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1700036[1700036]

This enhancement adds support for DMTF Redfish to RHV. To use this functionality, you use the Administration Portal to edit a Host's properties. On the Host's *Power Management* tab,  you click *+* to add a new power management device. In the *Edit fence agent* window, you set *Type* to *redfish* and fill-in additional details like login information and IP/FQDN of the agent.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1703112[1703112]

In some scenarios, the PCI address of a hotplugged SR-IOV vNIC was overwritten by an empty value, and as a result, the NIC name in the virtual machine was changed following a reboot. In this release, the vNIC PCI address is stored in the database and the NIC name persists following a virtual machine reboot.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1707225[1707225]

Before this update, there was no way to backup and restore the Cinderlib database. With this update, the engine-backup command includes the Cinderlib database.

For example, to backup the engine including the Cinderlib database:

----
# engine-backup --scope=all --mode=backup --file=cinderlib_from_old_engine --log=log_cinderlib_from_old_engine
----

To restore this same database:

----
# engine-backup --mode=restore --file=/root/cinderlib_from_old_engine --log=/root/log_cinderlib_from_old_engine --provision-all-databases --restore-permissions
----



.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1712890[1712890]

With this update, when you upgrade RHV, engine-setup notifies you if virtual machines in the environment have snapshots whose cluster levels are incompatible with the RHV version you are upgrading to. It is safe to let it proceed, but it is not safe to use these snapshots after the upgrade. For example, it is not safe to preview these snapshots.

There is an exception to the above: engine-setup does not notify you if the virtual machine is running the {engine-name} as a self-hosted engine. For hosted-engine, it provides an automatic "Yes" and upgrades the virtual machine without prompting or notifying you. It is unsafe to use snapshots of the hosted-engine virtual machine after the upgrade.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1718818[1718818]

This enhancement enables you to attach a SCSI host device, `scsi_hostdev`, to a virtual machine and specify the optimal driver for the type of SCSI device:

* *scsi_generic*: (Default) Enables the guest operating system to access OS-supported SCSI host devices attached to the host. Use this driver for SCSI media changers that require raw access, such as tape or CD changers.
* *scsi_block*: Similar to *scsi_generic* but better speed and reliability. Use for SCSI disk devices. If trim or discard for the underlying device is desired, and it’s a hard disk, use this driver.
* *scsi_hd*: Provides performance with lowered overhead. Supports large numbers of devices. Uses the standard SCSI device naming scheme. Can be used with aio-native. Use this driver for high-performance SSDs.
* *virtio_blk_pci*: Provides the highest performance without the SCSI overhead. Supports identifying devices by their serial numbers.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1729511[1729511]

During installation or upgrade to Red Had Virtualization 4.3, engine-setup failed if the PKI Organization Name in the CA certificate included non-ASCII characters.
In this release, the upgrade engine-setup process completes successfully.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1729811[1729811]

Previously, the guest_cur_user_name of the vm_dynamic database table was limited to 255 characters, not enough for more than approximately 100 user names.  As a result,  when too many users logged in, updating the table failed with an error. The current release fixes this issue by changing the field type from VARCHAR(255) to TEXT.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1731590[1731590]

Before this update, previewing a snapshot of a virtual machine, where the snapshot of one or more of the machine's disks did not exist or had no image with active set to "true", caused a null pointer exception to appear in the logs, and the virtual machine remained locked.
With this update, before a snapshot preview occurs, a database query checks for any damaged images in the set of virtual machine images. If the query finds a damaged image, the preview operation is blocked. After you fix the damaged image, the preview operation should work.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1733031[1733031]

To transfer virtual machines between data centers, you use data storage domains because export domains were deprecated. However, moving a data storage domain to a data center that has a higher compatibility level (DC level) can upgrade its storage format version, for example, from V3 to V5. This higher format version can prevent you from reattaching the data storage domain to the original data center and transferring additional virtual machines.

In the current release,  if you encounter this situation, the Administration Portal asks you to confirm that you want to update the storage domain format, for example, from 'V3' to 'V5'. It also warns that you will not be able to attach it back to an older data center with a lower DC level.

To work around this issue, you can create a destination data center that has the same compatibility level as the source data center. When you finish transferring the virtual machines, you can increase the DC level.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1743269[1743269]

Previously, upgrading RHV from version 4.2 to 4.3 made the 10-setup-ovirt-provider-ovn.conf file world-readable. The current release fixes this issue, so the file has no unnecessary permissions.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1745384[1745384]

Previously, trying to update the IPv6 gateway in the Setup Networks dialog removed it from the network attachment. The current release fixes this issue: You can update the IPv6 gateway if the related network has the default route role.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1749284[1749284]

Before this update, the live snapshot operation was synchronized, such that if VDSM required more than 180 seconds to create a snapshot, the operation failed, preventing snapshots of some virtual machines, such as those with large memory loads, or slow storage.

With this update, the live snapshot operation is asynchronous, so the operation runs until it ends successfully, regardless of how long it takes.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1750212[1750212]

Previously, when you tried to delete the snapshot of a virtual machine with a LUN disk, RHV parsed its image ID incorrectly and used "mapper" as its value. This issue produced a null pointer error (NPE) and made the deletion fail. The current release fixes this issue, so the image ID parses correctly and the deletion succeeds.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1764943[1764943]

Previously, while creating virtual machine snapshots, if the VDSM's command to freeze a virtual machines' file systems exceeded the snapshot command's 3-minute timeout period, creating snapshots failed, causing virtual machines and disks to lock.

The current release adds two key-value pairs to the engine configuration. You can configure these using the engine-config tool:

- Setting `LiveSnapshotPerformFreezeInEngine` to `true` enables the {engine-name} to freeze VMs' file systems before it creates a snapshot of them.
- Setting `LiveSnapshotAllowInconsistent` to `true` enables the {engine-name} to continue creating snapshots if it fails to freeze VMs' file systems.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1767319[1767319]

In this release, modifying a MAC address pool or modifying the range of a MAC address pool that has any overlap with existing MAC address pool ranges, is strictly forbidden.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1768844[1768844]

With this enhancement, when you add a host to a cluster, it has the advanced virtualization channel enabled, so the host uses the latest supported libvirt and qemu packages.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1769463[1769463]

Previously, in a large environment, the oVirt's REST API's response to a request for the cluster list was slow: This slowness was caused by processing a lot of surplus data from the engine database about out-of-sync hosts on the cluster which eventually was not included in the response. The current release fixes this issue. The query excludes the surplus data, and the API responds quickly.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1819960[1819960]

Previously, if you used the update template script example of the ovirt-engine-sdk to import a virtual machine or template from an OVF configuration, it failed with a null-pointer exception (NPE). This happened because the script example did not supply the Storage Pool Id and Source Storage Domain Id. The current release fixes this issue. Now, the script gets the correct ID values from the image, so importing a template succeeds.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1821930[1821930]

With this enhancement, RHEL 7-based hosts have SPICE encryption enabled during host deployment. Only TLSv1.2 and newer protocols are enabled. Available ciphers are limited as described in BZ1563271

RHEL 8-based hosts do not have SPICE encryption enabled. Instead, they rely on defined RHEL crypto policies (similar to VDSM BZ1179273).




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1834523[1834523]

Previously, adding or removing a smart card to a running virtual machine did not work. The current release fixes this issue. When you add or remove a smart card, it saves this change to the virtual machine's next run configuration. In the Administration Portal, the virtual machine indicates that a next run configuration exists, and lists "Smartcard" as a changed field. When you restart the virtual machine, it applies the new configuration to the virtual machine.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1838493[1838493]

Previously, creating a live snapshot with memory while LiveSnapshotPerformFreezeInEngine was set to True, resulted in a virtual machine file system that is frozen when previewing or committing the snapshot with memory restore.
In this release, the virtual machine runs successfully after creating a preview snapshot from a memory snapshot.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1845473[1845473]

Previously, exporting a virtual machine or template to an OVA file incorrectly sets its format in the OVF metadata file to "RAW". This issue causes problems using the OVA file. The current release fixes this issue. Exporting to OVA sets the format in the OVF metadata file to "COW", which represents the disk's actual format, qcow2.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1080097[1080097]

In this release, it is now possible to edit the properties of a Floating Disk in the *Storage* > *Disks* tab of the Administration Portal. For example, the user can edit the *Description*, *Alias*, and *Size* of the disk.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1427717[1427717]

The current release adds the ability for you to select affinity groups while creating or editing a virtual machine (VM) or host. Previously, you could only add a VM or host by editing an affinity group.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1546838[1546838]

The current release displays a new warning when you use 'localhost' as an FQDN: "[WARNING] Using the name 'localhost' is not recommended, and may cause problems later on."




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1585986[1585986]

Previously, if you lowered the cluster compatibility version, the change did not propagate to the self-hosted engine virtual machine. As a result, the self-hosted engine virtual machine was not compatible with the new cluster version; you could not start or migrate it to another host in the cluster. The current release fixes this issue: The lower cluster compatibility version propagates to the self-hosted engine virtual machine; you can start and migrate it.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1647440[1647440]

The current release adds a new feature: On the VM list page, the tooltip for the VM type icon shows a list of the fields you have changed between the current and the next run of the virtual machine.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1656621[1656621]

Previously, an imported VM always had 'Cloud-Init/Sysprep' turned on. The Manager created a VmInit even when one did not exist in the OVF file of the OVA. The current release fixes this issue: The imported VM only has 'Cloud-Init/Sysprep' turned on if the OVA had it enable. Otherwise, it is disabled.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1666913[1666913]

With this enhancement, if a network name contains spaces or is longer than 15 characters, the Administration Portal notifies you that the RHV Manager will rename the network using the host network's UUID as a basis for the new name.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1671876[1671876]

Suppose a Host has a pair of bonded NICs using `(Mode 1) Active-Backup`. Previously, the user clicked *Refresh Capabilities* to get the current status of this bonded pair. In the current release, if the active NIC changes, it refreshes the state of the bond in the Administration Portal and REST API. You do not need to click *Refresh Capabilities*.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1679110[1679110]

This enhancement moves the pop-up ("toast") notifications from the upper right corner to the lower right corner, so they no longer cover the action buttons. Now, the notifications rise from the bottom right corner to within 400 px of the top.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1679471[1679471]

Previously, the console client resources page showed truncated titles for some locales. The current release fixes this issue. It re-arranges the console client resources page layout as part of migrating from Patternfly 3 to Patternfly 4 and fixes the truncated titles.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1700021[1700021]

Previously, if a Certificate Authority `ca.pem` file was not present, the engine-setup tool automatically regenerated all PKI files, requiring you to reinstall or re-enroll certificates for all hosts.

Now, if `ca.pem` is not present but other PKI files are, engine-setup prompts you to restore ca.pem from backup without regenerating all PKI files. If a backup is present and you select this option, then you no longer need to reinstall or re-enroll certificates for all hosts.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1710491[1710491]

With this enhancement, an EVENT_ID is logged when a virtual machine's guest operating system reboots. External systems such as Cloudforms and Manage IQ rely on the EVENT_ID log messages to keep track of the virtual machine's state.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1716590[1716590]

With this enhancement, on the "System" tab of the "New Virtual Machine" and "Edit Virtual Machine" windows, the "Serial Number Policy" displays the value of the "Cluster default" setting. If you are adding or editing a VM and are deciding whether to override the cluster-level serial number policy, seeing that information here is convenient. Previously, to see the cluster's default serial number policy, you had to close the VM window and navigate to the Cluster window.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1728472[1728472]

Previously, the RHV Manager reported network out of sync because the Linux kernel applied the default gateway IPv6 router advertisements, and the IPv6 routing table was not configured by RHV. The current release fixes this issue. The IPv6 routing table is configured by RHV. NetworkManager manages the default gateway IPv6 router advertisements.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1730264[1730264]

Previously, enabling port mirroring on networks whose user-visible name was longer than 15 characters failed. This happened because port mirroring tried to use this long user-visible network name, which was not a valid network name. The current release fixes this issue. Now, instead of the user-visible name, port mirroring uses the VDSM network name. Therefore, you can enable port mirroring for networks whose user-visible name is longer than 15 characters.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1740978[1740978]

When a VM from the older compatibility version is imported, its configuration has to be updated to be compatible with the current cluster compatibility version. This enhancement adds a warning to the audit log that lists the updated parameters.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1754363[1754363]

With this release, the number of DNS configuration SQL queries that the Red Hat Virtualization Manager runs is significantly reduced, which improves the Manager's ability to scale.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1758289[1758289]

When you remove a host from the RHV Manager, it can create duplicate entries for a host-unreachable event in the RHV Manager database. Later, if you add the host back to the RHV Manager, these entries can cause networking issues. With this enhancement, if this type of event happens, the RHV Manager prints a message to the events tab and log. The message notifies users of the issue and explains how to avoid networking issues if they add the host back to RHV Manager.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1788424[1788424]

Previously, if you disabled the virtio-scsi drive and imported the virtual machine that had a direct LUN attached, the import validation failed with a "Cannot import VM. VirtIO-SCSI is disabled for the VM" error. This happened because the validation tried to verify that the virtio-scsi drive was still attached to the VM. The current release fixes this issue. If the Disk Interface Type is not virtio-scsi, the validation does not search for the virtio-scsi drive. Disk Interface Type uses an alternative driver, and the validation passes.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1810893[1810893]

Previously, using the Administration Portal to import a storage domain omitted custom mount options for NFS storage servers. The current release fixes this issue by including the custom mount options.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1812875[1812875]

Previously, when the Administration Portal was configured to use French language, the user could not create virtual machines. This was caused by French translations that were missing from the user interface. The current release fixes this issue. It provides the missing translations. Users can configure and create virtual machines while the Administration Portal is configured to use the French language.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1475774[1475774]

Previously, when creating/managing an iSCSI storage domain, there was no indication that the operation may take a long time.
In this release, the following message has been added:
“Loading...
A large number of LUNs may slow down the operation.”




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1600059[1600059]

Previously, when High Availability was selected for a new virtual machine, the Lease Storage Domain was set to a bootable Storage Domain automatically if the user did not already select one.
In this release, a bootable Storage Domain is set as the lease Storage Domain for new High Availability virtual machines.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1640908[1640908]

Previously, if there were hundreds of Fiber Channel LUNs, the Administration Portal dialog box for adding or managing storage domains took too long to render and might become unresponsive. This enhancement improves performance: It displays a portion of the LUNs in a table and provides right and left arrows that users can click to see the next or previous set of LUNs. As a result, the window renders normally and remains responsive regardless of how many LUNs are present.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1650417[1650417]

Previously, if a host failed and if the RHV Manager tried to start the high-availability virtual machine (HA VM) before the NFS lease expired, OFD locking caused the HA VM to fail with the error, "Failed to get "write" lock Is another process using the image?."  If the HA VM failed three times in a row, the Manager could not start it again, breaking the HA functionality.
The current release fixes this issue. RHV Manager would continue to try starting the VM even after three failures (the frequency of the attempts decreases over time). Eventually, once the lock expires, the VM would be started.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1659161[1659161]

Previously, changing the template version of a VM pool created from a delete-protected VM made the VM pool non-editable and unusable. The current release fixes this issue: It prevents you from changing the template version of the VM pool whose VMs are delete-protected and fails with an error message.






.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1683108[1683108]

This release adds a new 'status' column to the affinity group table that shows whether all of an affinity group's rules are satisfied (status = ok) or not (status = broken). The "Enforcing" option does not affect this status.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1692592[1692592]

Previously, items with number ten and higher on the BIOS boot menu were not assigned sequential indexes. This made it difficult to select those items. The current release fixes this issue. Now, items ten and higher are assigned letter indexes. Users can select those items by entering the corresponding letter.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1693628[1693628]

Previously, the state of the user session was not saved correctly in the Engine database, causing many unnecessary database updates to be performed. The current release fixes this issue: Now, the user session state is saved correctly on the first update.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1693813[1693813]

Previously, if you updated the Data Center (DC) level, and the DC had a VM with a lower custom compatibility level than the DC's level, the VM could not resume due to a "not supported custom compatibility version."
The current release fixes this issue: It validates the DC before upgrading the DC level. If the validation finds VMs with old custom compatibility levels, it does not upgrade the DC level: Instead, it displays "Cannot update Data Center compatibility version. Please resume/power off the following VMs before updating the Data Center."




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1696245[1696245]

Previously, while cloning a virtual machine, you could only edit the name of the virtual machine in the Clone Virtual Machine window. With this enhancement, you can fully customize any of the virtual machine settings in the Clone Virtual Machine window. This means, for example, that you can clone a virtual machine into a different storage domain.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1700338[1700338]

This enhancement enables you to use the RHV Manager's REST API to manage subscriptions and receive notifications based on specific events. In previous versions, you could do this only in the Administration Portal.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1703428[1703428]

Previously, when importing a KVM into Red Hat Virtualization, "Hardware Clock Time Offset" was not set. As a result, the Manager machine did not recognize the guest agent installed in the virtual machine.
In this release, the Manager machine recognizes the guest agent on a virtual machine imported from KVM, and the "Hardware Clock Time Offset" won't be null.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1712255[1712255]

Support for datacenter and cluster levels earlier than version 4.2 has been removed.






.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1731212[1731212]

Previously, the RHV landing page did not support scrolling. With lower screen resolutions, some users could not use the log in menu option for the Administration Portal or VM Portal. The current release fixes this issue by migrating the landing and login pages to PatternFly 4, which displays horizontal and vertical scroll bars when needed. Users can access the entire screen regardless of their screen resolution or zoom setting.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1733843[1733843]

Previously, exporting a virtual machine (VM) to an Open Virtual Appliance (OVA) file archive failed if the VM was running on the Host performing the export operation. The export process failed because doing so created a virtual machine snapshot, and while the image was in use, the RHV Manager could not tear down the virtual machine. The current release fixes this issue. If the VM is running, the RHV Manager skips tearing down the image. Exporting the OVA of a running VM succeeds.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1737234[1737234]

Previously, if you sent the RHV Manager an API command to attach a non-existing ISO to a VM, it attached an empty CD or left an existing one intact. The current release fixes this issue. Now, the Manager checks if the specified ISO exists, and throws an error if it doesn't.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1745019[1745019]

The current release adds support for running virtual machines on hosts that have an Intel Snow Ridge CPU. There are two ways to enable this capability:

- Enable a virtual machine's *Pass-Through Host CPU* setting and configure it to *Start Running On* on *Specific Host(s)* that have a Snow Ridge CPU.
- Set `cpuflags` in the virtual machine's custom properties to `+gfni,+cldemote`.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1751215[1751215]

Previously, after upgrading to RHV version 4.1 to 4.3, the Graphical Console for the self-hosted engine virtual machine was locked because the default display in version 4.1  is VGA. The current release fixes this issue. While upgrading to version 4.3, it changes the default display to VNC. As a result, the Graphical Console for the Hosted-Engine virtual machine is changeable.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1777954[1777954]

Previously, for the list of virtual machine templates in the Administration Portal, a paging bug hid every other page, and the templates on those pages, from view. The current release fixes this issue and displays every page of templates correctly.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1779580[1779580]

The current release updates the *Documentation* section of  the RHV welcome or landing page. This makes it is easier to access the current documentation and facilitate access to translated documentation in the future.

- The links now point to the online documentation on the Red Hat customer portal.
- The "Introduction to the Administration Portal" guide and "REST API v3 Guide" are now obsolete and have been removed.
- The rhvm-doc package is obsolete and has been removed.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1784049[1784049]

Previously, if you ran a virtual machine (VMs) with an old operating system such as RHEL 6 and the BIOS Type was a Q35 Chipset, it caused a kernel panic. The current release fixes this issue. If a VM has an old operating system and the BIOS Type is a Q35 Chipset, it uses the VirtIO-transitional model for some devices, which enables the VM to run normally.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1831031[1831031]

This enhancement increases the maximum memory limit for virtual machines to 6TB. This also applies to virtual machines with cluster level 4.3 in RHV 4.4.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1679730[1679730]

This update adds an audit log warning on an out-of-range IPv4 gateway static configuration for a host NIC. The validity of the gateway is assessed compared to the configured IP address and netmask. This gives users better feedback and helps them notice incorrect configurations.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1698102[1698102]

Previously, engine-setup did not provide enough information about configuring ovirt-provider-ovn. The current release fixes this issue by providing more information in the engine-setup prompt and documentation that helps users understand their choice and follow up actions.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1720795[1720795]

Previously, the Manager searched for guest tools only on ISO domains, not data domains. The current release fixes this issue: Now, if the Manager detects a new tool on data domains or ISO domains, it displays a mark for the Windows VM.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1770237[1770237]

Previously, the virtual machine (VM) instance type edit and create dialog displayed a vNIC profile editor. This item gave users the impression they could associate a vNIC profile with an instance type, which is not valid. The current release fixes this issue by removing the vNIC profile editor from the instance edit and create dialog.




== ovirt-engine-metrics

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1711006[1711006]

This enhancement adds support for using the Metrics Store configuration file to set virtual machine NIC parameters. For example, this enhancement enables you to run the ovirt-metrics-store-installation playbook on a network that does not have DHCP.




== ovirt-engine-ui-extensions

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1714528[1714528]

Previously, some HTML elements in Cluster Upgrade dialog had missing or duplicated IDs, which impaired automated UI testing. The current release fixes this issue. It provides missing IDs and removes duplicates to improve automated UI testing.




== ovirt-scheduler-proxy

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1720686[1720686]

With this rebase ovirt-scheduler-proxy packages have been updated to version 0.1.9 introducing support for RHEL 8 and a refactor of the code for Python3 and Java 11 support.




== ovirt-web-ui

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1750482[1750482]

Previously, when you used the VM Portal to configure a virtual machine (VM) to use Windows OS, it failed with the error, "Invalid time zone for given OS type." This happened because the VM's timezone for Windows OS was not set properly.
The current release fixes this issue. If the time zone in the VM template or VM is not compatible with the VM OS, it uses the default time zone. For Windows, this default is "GMT Standard Time". For other OSs, it is "Etc/GMT". Now, you can use the VM Portal to configure a VM to use Windows OS.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1596178[1596178]

Previously, the VM Portal was inconsistent in how it displayed pool cards. After a user took all of the virtual machines from them, the VM Portal removed automatic pool cards but continued displaying manual pool cards.
The current release fixes this issue: VM Portal always displays a pool card, and the card has a new label that shows how many virtual machines the user can take from the pool.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1724959[1724959]

Previously, the About dialog in the VM Portal provided a link to GitHub for reporting issues. However, RHV customers should use the Customer Portal to report issues. The current release fixes this issue. Now, the About dialog provides a link to the Red Hat Customer Portal.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1752995[1752995]

With this update, the default action in the VM Portal's dashboard for a running virtual machine is to open a console. Before this update, the default action was "Suspend".

Specifically, the default operation for a running VM is set to "SPICE Console" if the virtual machine supports SPICE, or "VNC Console" if the virtual machine only supports VNC.

For a virtual machine running in headless mode, the default action is still "Suspend".




== rhv-log-collector-analyzer

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1818745[1818745]

With this release, Red Hat Virtualization is ported to Python 3. It no longer depends on Python 2.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1809875[1809875]

Before this update, a problem in the per Data-Center loop collecting images information caused incomplete data for analysis for all but the last Data-Center collected. With this update, the information is properly collected for all Data-Centers, resolving the issue.




== rhvm-branding-rhv

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1751268[1751268]

The current release adds a new *Insights* section to the RHV welcome or landing page. This section contains two links:

- "Insights Guide" links to the "Deploying Insights in Red Hat Virtualization Manager" topic in the Administration Guide.
- "Insights Dashboard" links to the Red Hat Insights Dashboard on the Customer Portal at https://cloud.redhat.com/insights/overview




== rhvm-dependencies

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1796811[1796811]

The apache-sshd library is not bundled anymore in the rhvm-dependencies package.
The apache-sshd library is now packaged in its own rpm package.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1796817[1796817]

The Object-Oriented SNMP API for Java Managers and Agents (snmp4j) library is no longer bundled with the rhvm-dependencies package. It is now provided as a standalone rpm package (Bug #1796815).




== snmp4j

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1796815[1796815]

The Object-Oriented SNMP API for Java Managers and Agents (snmp4j) library has been packaged for RHV-M consumption.
The library was previously provided by the rhvm-dependencies package and is now provided as a standalone package.




== vdsm

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1660071[1660071]

Previously, when migrating a paused virtual machine, the Red Hat Virtualization Manager did not always recognize that the migration completed. With this update, the Manager immediately recognizes when migration is complete.




== vulnerability

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1767483[1767483]

A flaw was found in the Apache Commons BeanUtils, where the class property in PropertyUtilsBean is not suppressed by default. This flaw allows an attacker to access the classloader.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1801149[1801149]

A flaw was found in quartz through version 2.3.0. A XXE attack is possible in the Terracotta Quartz Scheduler using a job description. The highest threat from this vulnerability is to data confidentiality and integrity as well as system availability.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1686454[1686454]

A cross-site scripting vulnerability was discovered in bootstrap. If an attacker could control the data given to tooltip or popover, they could inject HTML or Javascript into the rendered page when tooltip or popover events fired.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1764791[1764791]

A flaw was found in Connect2id Nimbus JOSE+JWT prior to version 7.9. While processing JSON web tokens (JWT), nimbus-jose-jwt can throw various uncaught exceptions resulting in an application crash, information disclosure, or authentication bypass. The highest threat from this vulnerability is to data confidentiality and system availability.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1765660[1765660]

An XSS vulnerability was discovered in noVNC in which arbitrary HTML could be injected into the noVNC web page. An attacker having access to a VNC server could use target host values in a crafted URL to gain access to secure information (such as VM tokens).




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1781001[1781001]

A cross-site scripting vulnerability was reported in the oVirt-engine's OAuth authorization endpoint. URL parameters were included in the HTML response without escaping. This flaw would allow an attacker to craft malicious HTML pages that can run scripts in the context of the user's oVirt session.





.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1828406[1828406]

A Cross-site scripting (XSS) vulnerability exists in JQuery. This flaw allows an attacker with the ability to supply input to the ‘HTML’ function to inject Javascript into the page where that input is rendered, and have it delivered by the browser.




.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1847420[1847420]

An Open redirect vulnerability was found in ovirt-engine versions 4.4 and earlier, where it allows remote attackers to redirect users to arbitrary web sites and attempt phishing attacks. Once the target has opened the malicious URL in their browser, the critical part of the URL is no longer visible. The highest threat from this vulnerability is on confidentiality.




== ws-commons-util

.BZ#link:https://bugzilla.redhat.com/show_bug.cgi?id=1799171[1799171]

With this rebase, package ws-commons-utils has been updated to version 1.0.2 which provides following changes:

- Updated a non-static "newDecoder" method in the Base64 class to be static.
- Fixed the completely broken CharSetXMLWriter.
