<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>NtpSupport | oVirt</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="NtpSupport" />
<meta name="author" content="Andrew Cathrow" />
<meta property="og:locale" content="en" />
<meta name="description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<meta property="og:description" content="oVirt is a free open-source virtualization solution for your entire enterprise" />
<link rel="canonical" href="https://ovirt.github.io/ovirt-site/previews/3136/develop/release-management/features/infra/ntpsupport.html" />
<meta property="og:url" content="https://ovirt.github.io/ovirt-site/previews/3136/develop/release-management/features/infra/ntpsupport.html" />
<meta property="og:site_name" content="oVirt" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="NtpSupport" />
<meta name="twitter:site" content="@ovirt" />
<meta name="twitter:creator" content="@Andrew Cathrow" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew Cathrow"},"description":"oVirt is a free open-source virtualization solution for your entire enterprise","headline":"NtpSupport","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ovirt.github.io/ovirt-site/previews/3136/images/logo.svg"},"name":"Andrew Cathrow"},"url":"https://ovirt.github.io/ovirt-site/previews/3136/develop/release-management/features/infra/ntpsupport.html"}</script>
<!-- End Jekyll SEO tag -->

  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <link rel="stylesheet" href="/ovirt-site/previews/3136/stylesheets/fonts.css" />
  <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
  <link rel="stylesheet" href="/ovirt-site/previews/3136/stylesheets/application.css" />
  <link rel="stylesheet" href="/ovirt-site/previews/3136/stylesheets/print.css" media="print" />
  <link rel="stylesheet" href="/ovirt-site/previews/3136/stylesheets/coderay.css" media="screen" />
  <link rel="stylesheet" href="/ovirt-site/previews/3136/stylesheets/asciidoc.css" />
  <script src="/ovirt-site/previews/3136/javascripts/vendor/jquery.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3136/javascripts/vendor/bootstrap.min.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3136/javascripts/vendor/bootstrap-sortable.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3136/javascripts/vendor/moment.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3136/javascripts/vendor/fullcalendar/fullcalendar.js" type="text/javascript"></script>
  <script src="/ovirt-site/previews/3136/javascripts/lib/cal-widget.js" type="text/javascript"></script>
  <link href='/ovirt-site/previews/3136/favicon.ico' rel='shortcut icon' sizes='36x36 24x24 16x16' type='image/x-icon'/>
<link href='/ovirt-site/previews/3136/favicon.png' rel='icon' sizes='196x196' type='image/png'/>
<meta content='/ovirt-site/previews/3136/mstile-icon-128x128.png' name='msapplication-TileImage'/>
<meta content='transparent' name='msapplication-TileColor'/>
<link href='/ovirt-site/previews/3136/manifest.webmanifest' rel='manifest'/>
<meta content='/ovirt-site/previews/3136/browserconfig.xml' name='msapplication-config'/>
</head>
<body class=""><header class='masthead hidden-print' id='branding' role='banner'><section class='hgroup'></section><div id='access'><nav id="mainNav" class="navbar navbar-fixed-top affix-top">  <div class="container">    <div class="col-sm-2 navbar-header">      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#menu_id0980fddf">        <span class="sr-only">Toggle navigation</span>        <span>Menu</span>        <span class="fa fa-bars"></span>      </button>      <a class="navbar-brand" href="/ovirt-site/previews/3136/">        <img id="logo" alt="oVirt" src="/ovirt-site/previews/3136/images/logo.svg" />      </a>    </div>    <!-- Collect the nav links, forms, and other content for toggling -->    <div class="col-sm-10">      <div class="navbar-collapse collapse" id="menu_id0980fddf">        <ul class="nav navbar-nav" role="menubar">          <li class="hidden active">            <a href="#page-wrap"></a>          </li><li role='menuitem'>  <a href='/ovirt-site/previews/3136/download/'>Download</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3136/documentation/'>Documentation</a></li><li class='active' role='menuitem'>  <a href='/ovirt-site/previews/3136/develop/'>Developers</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3136/community/'>Community</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3136//lists.ovirt.org/archives/'>Forum</a></li><li role='menuitem'>  <a href='/ovirt-site/previews/3136//blogs.ovirt.org/'>Blog</a></li>        </ul>      </div>      <!-- /.navbar-collapse -->    </div>  </div></nav></div></header><main id="page-wrap" class="page-wrap" aria-label="Content">
      <section id="page" class="page">
        <!-- adapted from https://github.com/git-no/jekyll-breadcrumbs -->
<nav class="breadcrumbs bootstrap hidden-sm-down" aria-label="breadcrumb">

   <ol class="breadcrumb list-unstyled" vocab="http://schema.org/" typeof="BreadcrumbList">

      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3136/">
              <span property="name"></span>
              <meta property="position" content="1" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3136/develop/">
              <span property="name">Developers Community</span>
              <meta property="position" content="2" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3136/develop/release-management/">
              <span property="name">Release Management</span>
              <meta property="position" content="3" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3136/develop/release-management/features/">
              <span property="name">Features (Design documents)</span>
              <meta property="position" content="4" />
           </a>
        </li>
      
        
        
        <li class="breadcrumb-item" property="itemListElement" typeof="ListItem">
           <a property="item" typeof="WebPage" href="/ovirt-site/previews/3136/develop/release-management/features/infra/">
              <span property="name">Infra</span>
              <meta property="position" content="5" />
           </a>
        </li>
      
        
        
          

   </ol>

</nav>

        
          
            <header class="post-header col-md-4 pad-sides well well-lg">
              <h2 class="post-title entry-title">Authors:</h2>
              <div class="post-meta">
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/228553f5b6a2308e918dc1a2593dd8ec?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/228553f5b6a2308e918dc1a2593dd8ec?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Andrew Cathrow">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Andrew Cathrow</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/f2a780691e3b42529b31c3845bd121ce?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/f2a780691e3b42529b31c3845bd121ce?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Barak Azulay">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Barak Azulay</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/8c026e3f09c38f3f685f886fc95f1dc9?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/8c026e3f09c38f3f685f886fc95f1dc9?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Ewoud Kohl van Wijngaarden">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Ewoud Kohl van Wijngaarden</span></p>
                      
                    </section>
                  </div>
                
                  
                  
                  
                  <div class="blogger_avatar">
                    <img
                      src="https://secure.gravatar.com/avatar/e37ec99e8f2caef5e1238d05dfc36de6?s=32&amp;d=mm&amp;r=g"
                      srcset="https://secure.gravatar.com/avatar/e37ec99e8f2caef5e1238d05dfc36de6?s=64&amp;d=mm&amp;r=g 2x"
                      class="avatar avatar-32 photo"
                      height="32"
                      width="32"
                      loading="lazy"
                      alt="avatar of Robert Middleswarth">
                  </div>
                  <div class="byline">
                    <section class="entry-meta">
                      
                        <p><span class="author vcard">Robert Middleswarth</span></p>
                      
                    </section>
                  </div>
                
                </div>
            </header>
          
        
        <section id="content" class="content container">
          <div class='alert alert-warning'>Feature pages are design documents that developers have created while collaborating on oVirt.<br><br>Most of them are&nbsp;<strong>outdated</strong>, but provide historical design context.<br><br>They are&nbsp;<strong>not</strong>&nbsp;user documentation and should not be treated as such.<br><br><a href='/ovirt-site/previews/3136/documentation/'>Documentation is available here.</a></div>

<h1 id="ntp-support">Ntp Support</h1>

<h2 id="adding-ntp-support">Adding NTP Support</h2>

<h3 id="feature-necessity">Feature necessity</h3>

<p>KVM is very sensitive to time issues especially when migrating a VM between 2 hosts with a big time gap. In a large deployment we need to make sure that the time is synched on all the hosts in the setup.</p>

<h3 id="feture-description">Feture Description</h3>

<p>The intent is to use the organization’s NTP server to sync time on all the hosts in ovirt setup. The Info should be obtained from the user during the installation, and pupulated/configured on all the hosts in an ovirt system through bootstrap &amp; registration.</p>

<h3 id="assumptions">Assumptions</h3>

<ul>
  <li>Organizations will prefer using their own NTP server rather than install a new one for ovirt.</li>
  <li>The NTP server should be configured only once (during ovirt installation), and populated to all hosts through bootstrap and registration.</li>
  <li>Changing the NTP server after engine installation is not supported - and will require manuall steps to sync it to all the hosts in the setup.</li>
  <li>The NTP server is accesible from all the hosts</li>
  <li>This is not retro active - this will only apply to new hosts that are added to the system</li>
</ul>

<h3 id="what-needs-to-be-done">What needs to be done</h3>

<h5 id="ovirt-setup">ovirt-setup</h5>

<ul>
  <li>Need to extract NTP server details from user during the installation</li>
  <li>If NTP client is setup on ovirt-server then default to this value</li>
  <li>The NTP config should be optional</li>
  <li>Need to update the ntp server in vdc_option table</li>
  <li>Need to configure the ovirt-server ntp to sync with the NTP server</li>
</ul>

<h5 id="database">DataBase</h5>

<ul>
  <li>need to add the NTP server configuration to the vdc_options table</li>
</ul>

<h5 id="engineboostrapregistration-code">Engine:boostrap:registration code</h5>

<ul>
  <li>Need to utilize this new NTP config option (if given) during bootstrap</li>
  <li>Need to utilize this new NTP config option (if given) during registration/approval</li>
  <li>Need to add support for the optional NTP server in vds_installer.py</li>
</ul>

<h5 id="vdsm-bootstrap">vdsm-bootstrap</h5>

<ul>
  <li>vdsm-bootstrap - should support configuring NTP on any host bootstrapped</li>
  <li>bootstrapping code now has to support ovirt-node as well</li>
</ul>

<h5 id="vdsm-registration">vdsm-registration</h5>

<ul>
  <li>The registration code should support the optional NTP configuration</li>
  <li>need to utilize ovirt functions</li>
</ul>

<h4 id="optional-additional-tasks">Optional Additional tasks</h4>

<ul>
  <li>VDSM to report the configured NTP servers</li>
  <li>
    <p>Engine to alert on:</p>

    <ul>
      <li>mismatch in hypervisor’s NTP configuration.</li>
      <li>time diff from ovirt-engine service is greater than X (x = config param ???)</li>
    </ul>
  </li>
  <li>UI - display the reported NTP configureation</li>
  <li>Add a new ovirt-setup-lugin package to enable configuring the ovirt-engine server to NTP server.</li>
  <li>At regular interval (config setting) check time difference between ovirt-engine and nodes and raise alert (add notification)</li>
</ul>

<h3 id="questions">Questions</h3>

<ul>
  <li>Should we support more than 1 NTP server ? Answer: NTP requires 2 server to work at all and recommends at least 3 NTP servers.</li>
  <li>Should we expose this config through the ovirt-config utility ? Yes</li>
  <li>should we skip the NTP config if the NTP server is not accessible on bootstrap : No</li>
</ul>




        </section>
      </section>
    </main>

    <script src="/ovirt-site/previews/3136/javascripts/lib/headings_anchors.js" type="text/javascript"></script><footer class='text-center' id='footer'><hr class='visible-print'><ul class='footer-nav-list'><li><a href='/ovirt-site/previews/3136/privacy-policy.html' target='_blank' title='Privacy policy'>Privacy policy</a></li><li><a href='/ovirt-site/previews/3136/community/about.html' target='_blank' title='About'>About</a></li><li><a href='/ovirt-site/previews/3136/general-disclaimer.html' target='_blank' title='Disclaimers'>Disclaimers</a></li></ul>&copy; 2013&ndash;2023 oVirt<div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/issues/new?labels=content&amp;title=Issue:%20/develop/release-management/features/infra/ntpsupport.html&amp;template=' target='_blank' title='Report an issue'><i class="icon fab fa-github"></i>Report an issue with this page</a></div><div class='edit-this-page'><a href='https://github.com/oVirt/ovirt-site/edit/main/source/develop/release-management/features/infra/ntpsupport.md' target='_blank' title='Edit this page'><i class="icon fab fa-github"></i>Edit this page</a></div></footer></body>

</html>
